<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SOMETHING RIGHT IN MY HEART</title>
      <link href="2020/11/03/SOMETHING-RIGHT-IN-MY-HEART/"/>
      <url>2020/11/03/SOMETHING-RIGHT-IN-MY-HEART/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look."><div class="hbe-input-container"><input type="password" id="hbePass" placeholder="Hey, password is required here." /><label>Hey, password is required here.</label><div class="bottom-line"></div></div><script id="hbeData" type="hbeData" data-hmacdigest="f7c455b21ace961ff2a908296b528ea7be1fbe1bbc034c9851bc958b00c9a587">cc9e447045b3911cca48686c7cd14e3aad5bd800abf1c1247acdb3830958df4aaeba2e56dae48196fdd7b714c58279e48a5c3589b805718ee5daca7324b09e1f8e5b7d16c7fe42f25cbae48c53e0a926dc41fc4b7b9d90b352be6e973e3cfe95</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> SomethingRight </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|TST-Paper Reading Notes</title>
      <link href="2020/11/01/NLP-TST-Paper-Reading-Notes/"/>
      <url>2020/11/01/NLP-TST-Paper-Reading-Notes/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢ä¸»è¦è®°å½•ä¸€ä¸‹é˜…è¯»è¿‡çš„é‡è¦çš„æ–‡æœ¬é£æ ¼è½¬æ¢çš„paperï¼Œå¯èƒ½ä¸ä¼šéå¸¸è¯¦ç»†ï¼Œä½†æ˜¯ä¼šè®°å½•æ ¸å¿ƒå†…å®¹ï¼Œé‡åˆ°è‡ªå·±éå¸¸å–œæ¬¢çš„æˆ–è€…çœŸçš„ç‰¹åˆ«æ–°é¢–çš„ï¼Œå¯èƒ½ä¼šè¯¦ç»†çš„å†™å§ï¼Œä¸»è¦æ˜¯paperå¤ªå¤šäº†ï¼Œå…¨éƒ¨è¯¦ç»†çš„å†™æ²¡æ—¶é—´ï½</p><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬é£æ ¼è½¬æ¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|TST-DualRL model</title>
      <link href="2020/10/28/NLP-TST-DualRL-model/"/>
      <url>2020/10/28/NLP-TST-DualRL-model/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢è®²è§£ä¸€ä¸‹IJCAI2019çš„ä¸€ç¯‡å…³äºtext style transferçš„è®ºæ–‡ï¼šã€ŠA Dual Reinforcement Learning Framework for Unsupervised Text Style Transferã€‹ã€‚</p><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬é£æ ¼è½¬æ¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> DualRL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|RE-Dialogue-based relation extraction</title>
      <link href="2020/10/28/NLP-RE-Dialogue-based-relation-extraction/"/>
      <url>2020/10/28/NLP-RE-Dialogue-based-relation-extraction/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸¤ç¯‡è®ºæ–‡ï¼šã€ŠDialogue-Based Relation Extractionã€‹ä¸ã€ŠDialogue Relation Extraction with Document-level Heterogeneous Graph Attention Networksã€‹ã€‚</p><a id="more"></a><h2 id="Dialogue-Based-Relation-Extraction-ACL2020"><a href="#Dialogue-Based-Relation-Extraction-ACL2020" class="headerlink" title="Dialogue-Based Relation Extraction(ACL2020)"></a>Dialogue-Based Relation Extraction(ACL2020)</h2><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>ç›®å‰çš„document-level RE datasetéƒ½æ˜¯ä½¿ç”¨æ¯”è¾ƒæ­£å¼çš„æ–‡æœ¬æ„å»ºè€Œæˆçš„ï¼Œè¿™æ ·æ„å»ºçš„æ•°æ®é›†å†…éƒ¨å«æœ‰ä¸°å¯Œçš„é€»è¾‘æ¨ç†å…³ç³»ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„ä¿¡æ¯èƒ½å¤Ÿæå–å‡ºå…³é”®ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨dialogue relation extractionä¸­ï¼Œå¯¹è¯æ–‡æœ¬å¾€å¾€æ˜¯éæ­£å¼çš„ã€è¯­æ³•ä¸ä¸¥è°¨çš„ï¼Œè™½ç„¶é€»è¾‘ç®€å•ï¼Œä½†æ˜¯å…¶ä¿¡æ¯å¯†åº¦ä½ï¼Œä¸”å¾ˆå®¹æ˜“æœ‰æ­§ä¹‰çš„é—®é¢˜ã€‚è€Œç›®å‰é’ˆå¯¹äºDREä»»åŠ¡ä»ç„¶æ²¡æœ‰å¼•èµ·å¹¿æ³›çš„ç ”ç©¶ã€‚æ‰€ä»¥è¿™ç¯‡paperæ„å»ºäº†ç¬¬ä¸€ä¸ªdialogue-based RE datasetâ€”â€”DialogREï¼Œå¹¶ä¸”æå‡ºäº†æ–°çš„è¯„ä»·æŒ‡æ ‡ï¼š$F1_c$ä»¥åŠç›¸å…³çš„baselineï¼Œç”¨äºä»¥åçš„ç ”ç©¶ã€‚</p><blockquote><p>ä¹‹å‰ä¸€ç›´å¾ˆå–œæ¬¢ã€Šè€å‹è®°ã€‹ï¼Œæœ‰äººèƒ½å¤Ÿæ ¹æ®ã€Šè€å‹è®°ã€‹æ¥æ„å»ºæ•°æ®é›†ï¼ŒçœŸæ˜¯æœ‰ç”Ÿä¹‹å¹´å•Šï¼çˆ±äº†çˆ±äº†ğŸ¤©</p></blockquote><h3 id="Statistics-of-DialogRE"><a href="#Statistics-of-DialogRE" class="headerlink" title="Statistics of DialogRE"></a>Statistics of DialogRE</h3><p><img src="/2020/10/28/NLP-RE-Dialogue-based-relation-extraction/statistics_DialogRE.jpg" style="zoom:50%;"></p><p>DialogREæ•°æ®é›†æ˜¯æ ¹æ®ç¾å›½ç”µè§†æƒ…æ™¯å–œå‰§ã€Šè€å‹è®°ã€‹ä¸­å…±10å­£çš„å°è¯æ„å»ºè€Œæ¥ï¼Œå…±æœ‰1788ä¸ªdialogueï¼Œ10168ä¸ªtriple, å…¶ä¸­train:dev:test=6:2:2ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬çš„å½¢å¼è¿˜æ˜¯SPOï¼Œä¸å…¶ä»–çš„REå¹¶æ— åŒºåˆ«ã€‚ä½†æ˜¯DialogREä¸å…¶ä»–çš„document-level RE datasetæœ€å¤§çš„ä¸åŒæ˜¯ï¼š1. argument pairçš„relation span sentencesçš„æ¯”ä¾‹(95.6%)è¦å…¶ä»–çš„æ•°æ®é›†(40.7%)é«˜å¾—å¤šé«˜å¾—å¤š(95.6%)ï¼›2.ä»¥speakerä¸ºä¸­å¿ƒï¼Œ77.3%çš„tripleå…¨æ˜¯speaker nameï¼Œ90.0%çš„tripleè‡³å°‘åŒ…å«ä¸€ä¸ªspeaker nameï¼›3.ä¿¡æ¯å¯†åº¦ä½ï¼Œåªæœ‰0.21/per senã€‚DialogREæ•°æ®é›†ä¸å…¶ä»–æ•°æ®é›†çš„æ¯”è¾ƒå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/28/NLP-RE-Dialogue-based-relation-extraction/DialogRE_otherRE.jpg" alt></p><p>ä¸‹é¢æ˜¯dialogREæ•°æ®é›†ä¸­çš„relation typeï¼š</p><p><img src="/2020/10/28/NLP-RE-Dialogue-based-relation-extraction/dialog_realtion_type.jpg" alt></p><p>âš ï¸åœ¨dialogREä¸­ï¼Œæœ‰ä¸€ä¸ªæ¦‚å¿µå«åštriggerï¼Œå…¶å®å’ŒDocREDä¸­çš„evidenceæ˜¯å·®ä¸å¤šçš„ï¼Œç”¨æ¥è¯æ˜argument pairçš„relationçš„æ­£ç¡®æ€§ã€‚</p><h3 id="Task-formulation-and-Evaluation"><a href="#Task-formulation-and-Evaluation" class="headerlink" title="Task formulation and Evaluation"></a>Task formulation and Evaluation</h3><p>ç»™å®šä¸€ä¸ªdialogueï¼š$D=s_1:t_1,â€¦,s_m:t_m$ä»¥åŠargument pair: $(a_1,a_2)$ï¼Œå…¶ä¸­$s_i,t_i$è¡¨ç¤ºç¬¬$i$è½®çš„speaker idä¸textï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¾—åˆ°$(a_1,a_2)$çš„relationã€‚æœ‰ä¸¤ä¸ªè¯„ä»·æ–¹æ³•ï¼š$F1$ä¸$F1_c$ã€‚$F1$å…¶å®å°±æ˜¯æˆ‘ä»¬å¯»å¸¸ç”¨çš„ï¼Œè€Œ$F1_c$æ˜¯è¿™ç¯‡paperä½œè€…ä¸“é—¨è®¾è®¡çš„ï¼Œä¸‹é¢å…·ä½“è®²è®²ï½</p><p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€äº›ç¬¦å·ï¼š$O_i$è¡¨ç¤ºå‰$i$è½®å¯¹è¯ä¸­ï¼Œä½¿ç”¨æ¨¡å‹é¢„æµ‹å¾—å‡ºçš„argument pair$(a_1,a_2)$çš„relation type setï¼Œ$L$è¡¨ç¤ºåœ¨æ•´ä¸ªå¯¹è¯ä¸­argument pair$(a_1,a_2)$çš„çœŸå®çš„relation type setï¼Œ$R$è¡¨ç¤ºæ‰€æœ‰çš„36ä¸ªrelation typeï¼Œæ‰€ä»¥ï¼š$O_i,L\in R$ï¼›æˆ‘ä»¬å®šä¹‰è¾…åŠ©å‡½æ•°$j(x)$ï¼Œå¦‚æœ$x$ä¸å‡ºç°åœ¨$D$ä¸­ï¼Œé‚£ä¹ˆè¿”å›$m$ï¼Œå¦åˆ™çš„è¯ï¼Œè¿”å›$x$ç¬¬ä¸€æ¬¡å‡ºç°çš„å¯¹è¯è½®æ•°$i$ï¼›æˆ‘ä»¬å®šä¹‰è¾…åŠ©å‡½æ•°$i(r)$ï¼Œè¡¨ç¤ºï¼šå¯¹äºæ¯ä¸€ä¸ªrelation type $r\in L$ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªtrigger for $r$ï¼Œé‚£ä¹ˆ$i(r)=j(\lambda_r)$ï¼Œå…¶ä¸­$\lambda_r$è¡¨ç¤ºtriggerï¼Œå¦åˆ™$i(r)=m$ï¼Œå¯¹äºrelation $r{\in} R {\text \ }L$ï¼Œ$i(r)=1$ã€‚æˆ‘ä»¬ä½¿ç”¨$E_i$è¡¨ç¤ºå‰$i$è½®å¯ä»¥è¯„ä¼°çš„relation type setï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">E_i=\{r|i\geq max\{j(a_1),j(a_2),i(r)\}\}</script><p>$E_i$çš„æ„æ€æ˜¯ï¼šåœ¨å‰$i$è½®å¯¹è¯ä¸­ï¼Œå¦‚æœå‡ºç°äº†$a_1,a_2$ä»¥åŠä¸relation $r$ç›¸å…³çš„triggerçš„è¯ï¼Œé‚£ä¹ˆrelation $r$å°±æ˜¯å¯è¯„ä¼°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½œä¸ºå€™é€‰ã€‚ä¹‹æ‰€ä»¥è¿™æ ·å®šä¹‰ï¼Œæ˜¯å› ä¸ºè¿™æ ·åšå¯ä»¥çŸ¥é“å¯¹äºæ¯ä¸€ä¸ªargument pairï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥æ¨ç®—é¢„æµ‹å…¶relationå¤§æ¦‚éœ€è¦å¤šå°‘è½®æ•°ã€‚ä¹‹åï¼Œæˆ‘ä»¬å®šä¹‰conversation precisionä¸recallä¾æ—§conversation F1ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P_c(D,a_1,a_2)=\frac{\sum_{i=1}^{m}|O_i\cap L\cap E_i|}{\sum_{i=1}^{m}|O_i\cap E_i|} \\R_c(D,a_1,a_2)=\frac{\sum_{i=1}^{m}|O_i\cap L\cap E_i|}{\sum_{i=1}^{m}|L\cap E_i|} \\P_c=\frac{\sum_{D^{\prime},a_1^{\prime},a_2^{\prime}}P_c(D^{\prime},a_1^{\prime},a_2^{\prime})}{\sum_{D^{\prime},a_1^{\prime},a_2^{\prime}}1} \\R_c=\frac{\sum_{D^{\prime},a_1^{\prime},a_2^{\prime}}R_c(D^{\prime},a_1^{\prime},a_2^{\prime})}{\sum_{D^{\prime},a_1^{\prime},a_2^{\prime}}1} \\F1_c=\frac{2P_cR_c}{P_c+R_c}</script><h3 id="Baseline"><a href="#Baseline" class="headerlink" title="Baseline"></a>Baseline</h3><p>åœ¨paperä¸­ï¼Œä»‹ç»äº†å››ç§baselineï¼šMajorityã€CNN/LSTM/BILSTMã€BERTã€BERT$_s$ã€‚æ‰€è°“çš„Majorityå°±æ˜¯ï¼šå¦‚æœä¸€ä¸ªargument pairçš„relationæ²¡å‡ºç°åœ¨training setå½“ä¸­ï¼Œé‚£ä¹ˆè¾“å‡ºtraining setä¸­æ•°ç›®æœ€å¤§çš„relation typeï¼Œå¦åˆ™çš„è¯ï¼Œè¾“å‡ºä¸argument pairæœ€ç›¸å…³çš„relation typeï¼›CNN/LSTM/BILSTMæŒ‡çš„æ˜¯ï¼šé‡‡ç”¨CNN/LSTM/BILSTMä½œä¸ºç¼–ç å™¨ï¼›BERTæŒ‡çš„æ˜¯ï¼šé‡‡ç”¨BERTä»¥åŠBERT-likeé¢„è®­ç»ƒæ¨¡å‹ä½œä¸ºç¼–ç å™¨ï¼Œä¸è¿‡å…¶è¾“å…¥æ ¼å¼æ˜¯ï¼š$[CLS]d[SEP]a_1[SEP]a_2[SEP]$ï¼›BERT$_s$æ˜¯ä½œè€…æ‰€æ”¹è¿›çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯ï¼šä»ç„¶é‡‡ç”¨BERTä»¥åŠBERT-likeé¢„è®­ç»ƒæ¨¡å‹ä½œä¸ºç¼–ç å™¨ï¼Œä½†æ˜¯å…¶è¾“å…¥æ ¼å¼æ˜¯ï¼š$[CLS]\hat d[SEP]\hat a_1[SEP]\hat a_2[SEP]$ï¼Œå…¶ä¸­ï¼š</p><script type="math/tex; mode=display">\hat d=\hat s_1:\hat t_1,...,\hat s_n:\hat t_n \\\hat s_i=\begin{cases}[S1] & if \ s_i=a_1 \\ [S2] & if \ s_1=a_2 \\ s_1 & otherwise \end{cases}</script><p>å…¶ä¸­ï¼Œ$[S1],[S2]$è¡¨ç¤ºä¸¤ä¸ªæ–°çš„ç‰¹æ®Šçš„tokenã€‚</p><h3 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h3><p>æ”¾ä¸€ä¸‹ä¸Šè¿°å››ç§æ–¹æ³•åœ¨DialogREæ•°æ®é›†ä¸Šçš„ç»“æœ:</p><p><img src="/2020/10/28/NLP-RE-Dialogue-based-relation-extraction/dialogRE_result2.jpg" alt></p><p>ä¸‹é¢æ˜¯åŠ äº†argument typeä¹‹åçš„ç»“æœï¼Œå‘ç°ç»“æœæ˜¯æœ‰æå‡çš„ï¼Œè¯´æ˜argument typeæ˜¯æœ‰ä½œç”¨çš„ã€‚</p><p><img src="/2020/10/28/NLP-RE-Dialogue-based-relation-extraction/dialog_result_1.jpg" style="zoom:50%;"></p><p>æ€»çš„æ¥è¯´ï¼ŒDialogREæ˜¯ä¸€ä¸ªæ–°çš„å·¥ä½œï¼Œåœ¨è¿™ä¸ªä¸Šé¢è¿˜æ˜¯å¯ä»¥åšå¾ˆå¤šçš„å·¥ä½œçš„ã€‚</p><h2 id="Dialogue-Relation-Extraction-with-Document-level-Heterogeneous-Graph-Attention-Networks-arxiv2020"><a href="#Dialogue-Relation-Extraction-with-Document-level-Heterogeneous-Graph-Attention-Networks-arxiv2020" class="headerlink" title="Dialogue Relation Extraction with Document-level Heterogeneous Graph Attention Networks(arxiv2020)"></a>Dialogue Relation Extraction with Document-level Heterogeneous Graph Attention Networks(arxiv2020)</h2><h3 id="Background-1"><a href="#Background-1" class="headerlink" title="Background"></a>Background</h3><h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><h3 id="Experiment-1"><a href="#Experiment-1" class="headerlink" title="Experiment"></a>Experiment</h3><h2 id><a href="#" class="headerlink" title=" "></a> </h2><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>ã€ŠDialogue-Based Relation Extractionã€‹</p><p>ã€ŠDialogue Relation Extraction with Document-level Heterogeneous Graph Attention Networksã€‹</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å…³ç³»æŠ½å– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> dialogue-based RE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|RE-Integrate GNN into Document-level RE task|PART TWO</title>
      <link href="2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/"/>
      <url>2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/</url>
      
        <content type="html"><![CDATA[<p>æ¥ç€ä¸Šä¸€ç¯‡åšå®¢ï¼Œè¿™ç¯‡åšå®¢ä¹Ÿæ˜¯è®²è§£å›¾ç¥ç»ç½‘ç»œåœ¨Document-levelå…³ç³»æŠ½å–ä¸Šçš„åº”ç”¨ï¼Œå…±è®²è§£4ç¯‡è®ºæ–‡ï¼šã€ŠGlobal-to-Local Neural Networks for Document-Level Relation Extractionã€‹ã€ã€ŠHIN: Hierarchical Inference Network for Document-Level Relation Extractionã€‹ã€ã€ŠDocument-Level Relation Extraction with Adaptive Thresholding and Localized Context Poolingã€‹ã€ã€ŠEntity and Evidence Guided Relation Extraction for DocREDã€‹ã€‚</p><a id="more"></a><h2 id="Global-to-Local-Neural-Networks-for-Document-Level-Relation-Extraction-EMNLP2020"><a href="#Global-to-Local-Neural-Networks-for-Document-Level-Relation-Extraction-EMNLP2020" class="headerlink" title="Global-to-Local Neural Networks for Document-Level Relation Extraction(EMNLP2020)"></a>Global-to-Local Neural Networks for Document-Level Relation Extraction(EMNLP2020)</h2><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé€šè¿‡ä»ç²—ç²’åº¦ã€ç»†ç²’åº¦ã€context informationçš„è§’åº¦å¯¹entityä¹‹é—´çš„relationè¿›è¡Œå»ºæ¨¡ã€‚å…·ä½“è§£å†³çš„é—®é¢˜æ˜¯ï¼šç¬¬ä¸€ï¼šæ€ä¹ˆå¯¹documentä¸­çš„å¤æ‚è¯­ä¹‰è¿›è¡Œå»ºæ¨¡ï¼Ÿ(ä½¿ç”¨BERT)ï¼›ç¬¬äºŒï¼šæ€ä¹ˆå­¦ä¹ æœ‰æ•ˆåœ°entity representationï¼Ÿ(ä½¿ç”¨RGCN)ï¼›ç¬¬ä¸‰ï¼šå…¶ä»–çš„relationä¹Ÿå¯¹äºå½“å‰ç›®æ ‡entityä¹‹é—´çš„relationäº§ç”Ÿå½±å“ï¼Œå¦‚æœæœ‰æ•ˆçš„åˆ©ç”¨ï¼Ÿ(context-aware)ã€‚å°†è¿™ä¸‰ä¸ªæ–¹é¢èšåˆèµ·æ¥ï¼Œå°±æ˜¯GLREæ¨¡å‹ã€‚</p><blockquote><p>ç›®å‰åœ¨doucment-level REä¸­ï¼Œå­˜åœ¨ç€ä¸‰æ–¹é¢çš„é—®é¢˜ï¼šlogical reasoningã€coreference reasoningã€common-sense reasoningã€‚</p></blockquote><h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/GLRE_model.jpg" alt></p><p>GLREæ¨¡å‹åˆ†ä¸ºå››éƒ¨åˆ†ï¼š<strong>encoding layerã€global representation layerã€local representationã€classifier layerã€‚</strong></p><ul><li><p><strong>encoding layerï¼š</strong>å‡è®¾è¾“å…¥çš„documentè¡¨ç¤ºä¸ºï¼š$\cal D=\{w_1,w_2,â€¦,w_k\}$ï¼Œå…¶ä¸­$w_i$è¡¨ç¤ºçš„æ˜¯ç¬¬$i$ä¸ªwordï¼Œæˆ‘ä»¬ä½¿ç”¨BERTæ¥å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H=[h_1,h_2,...,h_k]=BERT([w_1,w_2,...,w_k])</script><p>$H$æ˜¯BERTæœ€åä¸€å±‚çš„è¾“å‡ºã€‚</p></li><li><p><strong>global representation layerï¼š</strong>GLREæ¨¡å‹åŒæ ·æ˜¯åŸºäºgraphçš„æ¨¡å‹ã€‚åŒæ ·æ˜¯ç»§æ‰¿EoGæ¨¡å‹ï¼Œå…¶ä¸­æœ‰ä¸‰ç§nodeï¼šmention nodeã€entity nodeä¸sentence nodeã€‚å¯¹äºä¸‰ç§nodeçš„è¡¨ç¤ºï¼Œæˆ‘ä»¬éƒ½æ˜¯å°†å…¶æœ¬èº«çš„avg embeddingä¸å„è‡ªçš„type embeddingè¿›è¡Œconatã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºmention nodeï¼š$n_{m_i}=[avg_{w_j\in m_i}(h_j);t_m]$ï¼›å¯¹äºentity nodeï¼š$n_{e_i}=[avg_{m_j\in e_i}(n_{m_j});t_{e}]$ï¼›å¯¹äºsentence nodeï¼š$n_{s_i}=[avg_{h_j\in s_i}(h_j);t_s]$ã€‚æœ‰äº”ç§edgeï¼šmention-mention edge(åŒä¸€ä¸ªsentenceä¸­çš„æ‰€æœ‰mentionsä¹‹é—´åŠ ä¸€æ¡è¾¹)ã€mention-entity edge(entityä¸å…¶mentionä¹‹é—´åŠ ä¸€æ¡è¾¹)ã€mention-sentence edge(å¦‚æœmention nodeä¸sentence nodeåŠ ä¸€æ¡è¾¹)ã€entity-sentence edge(å¦‚æœä¸€ä¸ªentityè‡³å°‘æœ‰ä¸€ä¸ªmentionå‡ºç°åœ¨sentenceä¸­ï¼Œé‚£ä¹ˆentity nodeä¸sentenceä¹‹é—´åŠ ä¸€æ¡è¾¹)ã€sentence-sentence edge(æ‰€æœ‰çš„sentence nodeä¹‹é—´åŠ ä¸€æ¡è¾¹)ã€‚<strong>âš ï¸å’ŒEoGæ¨¡å‹ä¸€æ ·ï¼ŒåŒæ ·æ²¡æœ‰entity-entity edgeï¼</strong>æ„å»ºå¥½graphä¹‹åï¼Œåœ¨GLREæ¨¡å‹ä¸­ï¼Œstackäº†Lå±‚çš„R-GCNï¼Œå…·ä½“çš„aggregateçš„å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">n^{l+1}_{i}=\sigma(\sum_{x\in {\cal X}}\sum_{j\in {\cal N_{x}^{i}}}\frac{1}{|\cal N_{x}^{i}|}W^l_xn^l_j+W^l_0n^l_i)</script><p>å…¶ä¸­ï¼Œ$\cal N_{x}^{i}$è¡¨ç¤ºåœ¨$x$è¿™ç§edge typeä¸‹ï¼Œnode içš„é‚»æ¥èŠ‚ç‚¹çš„é›†åˆï¼Œè¯´åˆ°åº•ï¼Œè¿˜æ˜¯å’ŒGCNå¤„ç†å¼‚è´¨å›¾çš„æ–¹å¼æ²¡å•¥åŒºåˆ«ã€‚æˆ‘ä»¬å°†Lå±‚ä¹‹åçš„æ¯ä¸€ä¸ªnodeçš„representationç§°ä¸ºentity global representationï¼Œè®°åšï¼š$e^{glo}_{i}$ã€‚</p></li><li><p><strong>local representation layerï¼š</strong>å¦‚æœè¯´global rep layeræ˜¯æƒ³åœ¨document-levelä¸Šå¯¹ä¸åŒçš„entityä¹‹é—´çš„è¯­ä¹‰ä¿¡æ¯è¿›è¡Œå»ºæ¨¡ï¼Œé‚£ä¹ˆlocal rep layeræ˜¯åœ¨å¯¹åŒä¸€ä¸ªentityçš„ä¸åŒçš„mentionä¹‹é—´çš„ä¿¡æ¯è¿›è¡Œå»ºæ¨¡ï¼Œä»è€Œå¾—åˆ°æ›´åŠ å¥½çš„entity repï¼Œå› ä¸ºåœ¨ä¸åŒçš„entity pairä¸­ï¼Œentityçš„è¡¨ç¤ºè‚¯å®šæ˜¯ä¸åŒçš„ï¼Œå¦‚æœåªç”¨global rep layerçš„ç»“æœçš„è¯ï¼Œé‚£ä¹ˆentityçš„è¡¨ç¤ºå°±æ˜¯å”¯ä¸€çš„äº†ï¼Œè‚¯å®šå¯¹æœ€åç»“æœä¼šæœ‰å½±å“ã€‚æ€ä¹ˆåšå‘¢ï¼Ÿåœ¨GLREä¸­ï¼Œé‡‡ç”¨çš„æ˜¯multi-head self attentionã€‚å¯¹äºentity pair $(e_a,e_b)$ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">e^{loc}_a=LN(MHead_a(e^{glo}_a,\{n_{s_i}\}_{s_i\in \cal S_a},\{n_{m_j}\}_{m_j\in \cal M_a})) \\e^{loc}_b=LN(MHead_b(e^{glo}_b,\{n_{s_i}\}_{s_i\in \cal S_b},\{n_{m_j}\}_{m_j\in \cal M_b}))</script><p>å…¶ä¸­ï¼Œ$\cal S_a$è¡¨ç¤ºçš„æ˜¯entity a çš„mentionsæ‰€åœ¨çš„sentenceçš„é›†åˆï¼Œ$\cal M_a$è¡¨ç¤ºçš„æ˜¯enity açš„mentionçš„é›†åˆã€‚</p></li><li><p><strong>classifier layerï¼š</strong>å¾—åˆ°$e^{glo}$ä¸$e^{loc}$ä¹‹åï¼Œæˆ‘ä»¬å°†ä¸¤è€…èšåˆã€‚å¯¹äºentity pair $(e_a,e_b)$ï¼Œå…·ä½“æ¥è¯´ï¼š</p><script type="math/tex; mode=display">\tilde e_a=[e^{glo}_a;e^{loc}_a;\Delta(\delta_{ab})] \\\tilde e_b=[e^{glo}_b;e^{loc}_b;\Delta(\delta_{ba})]</script><p>å…¶ä¸­ï¼Œ$\delta_{ab}$è¡¨ç¤ºçš„æ˜¯entity açš„ç¬¬ä¸€ä¸ªmentionä¸entity bçš„ç›¸å¯¹è·ç¦»ã€‚æœ€åçš„è¡¨ç¤ºæ˜¯ï¼š$o_r=[\tilde e_a;\tilde e_b]$ã€‚ä¸ºäº†è¿›ä¸€æ­¥æŒ–æ˜ä¿¡æ¯ï¼Œpaperä¸­è¯´çš„æ˜¯documentçš„topic informationèƒ½å¤Ÿæš—å«æŸäº›relationï¼Œæ‰€ä»¥å†ä¸€æ¬¡ä½¿ç”¨self-attention(ä¸transformerä¸åŒï¼Œåå­—å«åšcontext-aware),å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">o_c=\sum_{i=0}^{p}\theta_io_i=\sum_{i=0}^{p}\frac{exp(o_iWo^{\prime}_{i})}{\sum_{j=0}^{p}exp(o_jWo^{\prime}_{j})}</script><p>ç„¶åå°†$o_c$è¾“å…¥åˆ°ä¸€ä¸ªFFNå±‚è¿›è¡Œåˆ†ç±»ï¼Œå³ï¼š$y_r=sigmoid(FFN([o_r,;o_c]))$ï¼Œæœ€åçš„lossä½¿ç”¨CEã€‚</p></li></ul><h3 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCDRã€DocRED</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/GLRE_result.jpg" style="zoom:50%;"></p><p>è¯´å®è¯ï¼Œè¿™ä¸ªç»“æœä¸€èˆ¬ã€‚ä½†æ˜¯è¿™ç¯‡è®ºæ–‡çš„ablationä¸error analysiså¾ˆæœ‰æ„æ€ã€‚GLREåœ¨é•¿è·ç¦»çš„entity pairçš„å…³ç³»æŠ½å–ä¸Šå–å¾—äº†æ¯”è¾ƒå¥½çš„ç»“æœ(&gt;=3)ï¼Œpaperä¸­ç»™å®ƒå½’å› äºglobal rep layerçš„æ„å»ºï¼ŒåŒæ—¶local rep layerçš„æ„å»ºå‡å°‘äº†å™ªéŸ³ã€‚</p></li><li><p>æ¶ˆèå®éªŒç»“è®º</p><ol><li><p>BERTå¯¹äºæœ€ç»ˆçš„ç»“æœå½±å“å¾ˆå¤§ï¼Œpaperä¸­åšäº†å‡ ç»„å®éªŒï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/GLRE_result_pretrained_model.jpg" style="zoom:50%;"></p></li><li><p>å½“local rep layerè¢«ç§»é™¤ä¹‹åï¼ŒF1å€¼ä¸‹é™å¾ˆå¿«ï¼Œè¿™è¯´æ˜multi-head self attentionèƒ½å¤Ÿæœ‰é€‰æ‹©æ€§çš„aggregatemention repï¼Œè¿‡æ»¤æ‰ä¸€äº›å™ªéŸ³ï¼Œçœ‹æ¥ä¸æ˜¯æ‰€æœ‰çš„mentionéƒ½æœ‰entity repéƒ½æœ‰ç”¨ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/GLRE_result_ablation.jpg" style="zoom:50%;"></p></li></ol></li><li><p>Case study</p><ol><li>Logical reasoningå¾ˆé‡è¦ï¼ŒGLREæ¨¡å‹ä¸­ï¼Œå®Œå…¨é RGCNï¼Œæ²¡æœ‰å¦å¤–å†æä¸€å¥—æœºåˆ¶æ¥ç»“å±€logical reasoningï¼›</li><li>å½“ä¸€ä¸ªå¥å­ä¸­ï¼Œå¾ˆå¤šentityç”¨<code>and</code>è¿™æ ·çš„è¯è¿æ¥çš„æ—¶å€™ï¼Œå¾€å¾€æ¨¡å‹æ— æ³•å¯¹å¥¹ä»¬ä¹‹é—´çš„å…³ç³»è¿›è¡Œå»ºæ¨¡ï¼Œpaperä¸­è¯´åœ¨GLREæ¨¡å‹ä¸­æ˜¯é context-awareæ¥è§£å†³çš„ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ•ˆæœä¸€èˆ¬å§ï¼›</li><li>æ€ä¹ˆå¼•å…¥å…ˆéªŒçŸ¥è¯†å¾ˆé‡è¦ï¼Œå› ä¸ºå¾ˆå¤šcommon senseä¸ä¼šå‡ºç°åœ¨è®­ç»ƒé›†é‡Œé¢ï¼Œè€Œå¾ˆå¤šrelationçš„åˆ¤æ–­éƒ½éœ€è¦ç”¨åˆ°å…ˆéªŒçŸ¥è¯†ï¼Œè¿™ä¸ªæ—¶å€™æ€ä¹ˆåšï¼ŸGLREä¹Ÿæ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼›</li><li>å½“ä¸€ä¸ªå¥å­çš„ä¸»è¯­ç­‰éƒ¨åˆ†ç¼ºå¤±æ—¶ï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿåœ¨GLREä¸­ï¼Œæ˜¯é€šè¿‡å»ºç«‹global rep layeræ¥è§£å†³çš„ï¼Œä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼›</li><li>å½“ä»£è¯æœ‰æ­§ä¹‰çš„æ—¶å€™ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ</li><li>paperç»Ÿè®¡äº†ä¸€ä¸‹ï¼Œlogical reasoning(40.9%)ã€component missing error(28.8%)ã€prior knowledge missing error(13.6%)ã€coreference reasoning errorï¼Ÿ(12.9%)ã€‚ </li></ol></li></ol><p>æ€»çš„æ¥è¯´ï¼ŒGLREæ¨¡å‹ä¸€èˆ¬ï¼Œä½†æ˜¯å…¶case studyä¸æ¶ˆèå®éªŒåšçš„è¿˜æ˜¯è›®å¥½çš„ï¼Œå¾ˆæœ‰å¯å‘æ€§ã€‚</p><h2 id="HIN-Hierarchical-Inference-Network-for-Document-Level-Relation-Extraction-PAKDD2020"><a href="#HIN-Hierarchical-Inference-Network-for-Document-Level-Relation-Extraction-PAKDD2020" class="headerlink" title="HIN: Hierarchical Inference Network for Document-Level Relation Extraction(PAKDD2020)"></a>HIN: Hierarchical Inference Network for Document-Level Relation Extraction(PAKDD2020)</h2><h3 id="Background-1"><a href="#Background-1" class="headerlink" title="Background"></a>Background</h3><p>HINæ¨¡å‹è¿˜æ˜¯è›®å¥½æ‡‚çš„ï¼Œå®ƒå¹¶ä¸æ˜¯ä»åŸºäºgraphçš„æ–¹å¼ä¸Šæ¥è§£å†³document-level REçš„ï¼Œè€Œæ˜¯é€šè¿‡ä»entity-levelã€sentence-levelã€document-levelè¿™æ ·å±‚çº§çš„æ–¹å¼æ¥åšï¼Œæœ‰ç‚¹ç±»ä¼¼äºæ–‡æœ¬åˆ†ç±»æ¨¡å‹HANã€‚</p><h3 id="Model-1"><a href="#Model-1" class="headerlink" title="Model"></a>Model</h3><p>  å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/HIN_model.jpg" alt></p><p>HINæ¨¡å‹åˆ†ä¸ºå››éƒ¨åˆ†ï¼š<strong>input layerã€entity-level inference moduleã€hierarchical document-level inference moduleã€prediction layerã€‚</strong></p><ul><li><p><strong>input layerï¼š</strong>åŸå§‹çš„è¾“å…¥æœ‰ä¸‰éƒ¨åˆ†ï¼š<strong>word embeddingã€entity type embeddingã€coreference embeddingã€‚</strong>å…¶ä¸­ï¼Œword embeddingå°±æ˜¯æ¯ä¸€ä¸ªtokençš„word embeddingï¼Œå…¶ç»´åº¦ï¼š$d_w$ï¼›entity type embeddingæŒ‡çš„æ˜¯å°†entity çš„typeä¿¡æ¯è½¬æ¢ä¸ºä¸€ä¸ªdense vectorï¼Œå…¶ç»´åº¦æ˜¯ï¼š$d_t$ï¼›coreference embeddingæŒ‡çš„æ˜¯åŒä¸€ä¸ªentityçš„ä¸åŒçš„mentionè¢«åˆ†é…åŒä¸€ä¸ªentity idï¼Œå…¶ç»´åº¦ï¼š$d_c$ã€‚è¿™ä¸€å±‚çš„è¾“å‡ºæ˜¯è¿™ä¸‰è€…çš„concatã€‚</p></li><li><p><strong>entity-level inference moduleï¼š</strong>é¦–å…ˆä½¿ç”¨BILSTMæ¥å¯¹documentè¿›è¡Œç¼–ç ï¼Œå³ï¼š$h_i=BILSTM(w_i),i\in[1,n]$ï¼Œ$n$è¡¨ç¤ºä¸€ä¸ªdocumentä¸­æ‰€æœ‰çš„tokenæ•°ç›®ï¼›æ¯ä¸€ä¸ªmentionçš„repæ˜¯å…¶æ¯ä¸€ä¸ªwordçš„avgï¼Œæ¯ä¸€ä¸ªentityæ˜¯å…¶æ‰€æœ‰çš„mention repçš„avgï¼Œå³ï¼š$e_l=avg_{w_i\in e_l}(h_i),\ E_a=avg_{e_l\in E_a}(e_l)$ï¼Œå…¶ä¸­ï¼Œ$e_l$è¡¨ç¤ºæŸä¸€ä¸ªmentionçš„repï¼Œ$E_a$è¡¨ç¤ºæŸä¸€ä¸ªentityçš„repã€‚ç”±äºæ”¶åˆ°multi-head attentionçš„å½±å“ï¼šå°†vectoræ˜ å°„åˆ°ä¸åŒçš„latent spaceä¼šenrich æ¨¡å‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨HINæ¨¡å‹ä¸­ï¼Œä¹Ÿæ˜¯åŒæ ·çš„åšæ³•ï¼Œå°†å¾—åˆ°çš„entity repæ˜ å°„åˆ°ä¸åŒçš„$K$ä¸ªlatent spaceï¼Œå³ï¼š</p><script type="math/tex; mode=display">E^k_a=W^{(1)}_k(RELU(W^{(0)}_kE_a))</script><p>ä¹‹åï¼Œç”±äºåˆæ”¶åˆ°TransEç®—æ³•çš„å½±å“ï¼ŒçŸ¥ï¼š$e_h+e\approx e_t$ï¼Œæ‰€ä»¥ä½œè€…è®¤ä¸º$E_b-E_a$èƒ½å¤Ÿåœ¨æŸç§ç¨‹åº¦ä¸Šååº”entity pair $(e_a,e_b)$çš„relationã€‚æ‰€ä»¥ç¬¬kä¸ªlatent spaceçš„ç»“æœæ˜¯ï¼š</p><script type="math/tex; mode=display">I^k_e=[E^k_aR^kE^k_b;E^k_b-E^k_a;E^k_a;E^k_b]</script><p>æœ€ç»ˆæˆ‘ä»¬å°†kä¸ªlatent spaceçš„ç»“æœè¿›è¡Œconcatï¼Œå½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹ŸåŠ å…¥ç›¸å¯¹è·ç¦»è¿›ä¸€æ­¥ä¸°å¯Œä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">I_e=G_e([I^1_e,I^2_e,...,e^K_e;M_{ba}-M_{ab}])</script><p>å…¶ä¸­ï¼Œ$G_e$æ˜¯FFNï¼Œ$d_{ab}$æ˜¯ç›¸å¯¹è·ç¦»ã€‚</p></li><li><p><strong>hierarchical document-level inference moduleï¼š</strong>è¿™ä¸€éƒ¨åˆ†åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šsentence-level inferenceä¸document-level inferenceã€‚åœ¨sentence-level inferenceä¸­ï¼Œå‡è®¾ä¸€ä¸ªdocumentæœ‰$L$ä¸ªå¥å­ï¼Œ$w_{jt}$è¡¨ç¤ºç¬¬$j$ä¸ªsentenceçš„ç¬¬$t$ä¸ªwordï¼Œæˆ‘ä»¬ä½¿ç”¨BILSTMå¯¹æ¯ä¸€ä¸ªsentenceè¿›è¡Œç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">h_{jt}=BILSTM(w_{jt}),j=1,...,L</script><p>ç„¶åå€Ÿé‰´HANæ¨¡å‹ï¼Œå¯¹$h_{jt}$ä½¿ç”¨attentionï¼Œç„¶åå¾—åˆ°sentence vectorï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\alpha_{jt}=u^T_wtanh(W_wh_{jt}+b_w) \\a_{jt}=\frac{exp(\alpha_{jt})}{\sum_{t}exp(\alpha_{jt})} \\S_j=\sum_{t}a_{jt}h_{jt}</script><p>å…¶ä¸­ï¼Œ$S_j$å°±æ˜¯ç¬¬jä¸ªsentenceçš„sentence vectorã€‚æˆ‘ä»¬è¿›ä¸€æ­¥å°†å…¶ä¸$I_e$è¿›è¡Œèåˆï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">I_{sj}=G_s([S_j;I_e;S_j-I_e;S_j  \ o \ I_e]) \\</script><p>$S_{sj}$å°±æ˜¯æœ€ç»ˆçš„ç¬¬jä¸ªsentenceçš„sentence vectorã€‚</p><p>åœ¨document-level inferenceä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯å€Ÿé‰´HANæ¨¡å‹ï¼Œä½¿ç”¨BISLTM+attentionçš„æ–¹å¼ï¼Œå¾—åˆ°æœ€ç»ˆdocument vectorï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">c_{sj}=BILSTM_D(I_{sj}),j\in[1,L] \\\alpha_{j}=u^T_stanh(W_sc_{sj}+b_s) \\a_{jt}=\frac{exp(\alpha_{j})}{\sum_{j}exp(\alpha_{j})} \\I_d=\sum_{j}a_{j}c_{sj}</script><p>$I_d$å°±æ˜¯æœ€ç»ˆçš„document vectorã€‚</p></li><li><p><strong>prediction layerï¼š</strong>æˆ‘ä»¬é¦–å…ˆå¯¹entity-level inference repä¸document-level inference repè¿›è¡Œconcatï¼Œå†è¾“å…¥åˆ°FFNä¸­è¿›è¡Œæœ€ç»ˆå¾—åˆ†ç±»ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(r|E_a,E_b)=sigmoid(W_r \left[\begin{matrix}I_e \\ I_d \end{matrix}\right]+b_r)</script><p>æœ€ç»ˆçš„lossé‡‡ç”¨CEã€‚</p></li></ul><h3 id="Experiment-1"><a href="#Experiment-1" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šDocRED</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/HIN_result.jpg" alt></p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/HIN_ablation.jpg" alt></p><p>ä»ç»“æœçœ‹ï¼Œæ›´åŠ ä¸€èˆ¬äº†ï¼Œè€Œååœ¨case studyä¸­æ‰€è¯´æ˜çš„logical reasoningã€coreference reasoningã€combine common-sense informationé—®é¢˜ä¹Ÿæ²¡æœ‰è§£å†³ã€‚</p></li></ol><h2 id="Document-Level-Relation-Extraction-with-Adaptive-Thresholding-and-Localized-Context-Pooling-arxiv2020"><a href="#Document-Level-Relation-Extraction-with-Adaptive-Thresholding-and-Localized-Context-Pooling-arxiv2020" class="headerlink" title="Document-Level Relation Extraction with Adaptive Thresholding and Localized Context Pooling(arxiv2020)"></a>Document-Level Relation Extraction with Adaptive Thresholding and Localized Context Pooling(arxiv2020)</h2><h3 id="Background-2"><a href="#Background-2" class="headerlink" title="Background"></a>Background</h3><p>è¿™ç¯‡æ–‡ç« æ˜¯JDæ”¾åœ¨arxivä¸Šçš„æ–‡ç« ï¼Œä»ç»“æœæ¥çœ‹æ˜¯ç›®å‰çš„top1ï¼Œå€¼å¾—ä¸€è¯»ã€‚å®ƒä¹Ÿæ˜¯è§£å†³document-level REã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šç›®å‰ä¸»æµçš„åšæ³•æ˜¯é‡‡ç”¨åŸºäºgraphçš„æ–¹æ³•æ¥åšï¼Œä½†æ˜¯å¾ˆå¤šåŸºäºBERTçš„å·¥ä½œ(è­¬å¦‚corefBERT)ä¹Ÿèƒ½å¤Ÿå¾—åˆ°å¾ˆå¥½çš„ç»“æœï¼Œå¹¶ä¸”åœ¨åŸºäºgraphçš„æ¨¡å‹çš„å®éªŒéƒ¨åˆ†ï¼Œä¹Ÿéƒ½è¯æ˜äº†BERTä»¥åŠBERT-likeé¢„è®­ç»ƒæ¨¡å‹çš„å·¨å¤§æå‡ï¼Œä»¥è‡³äºè®©äººæ€€ç–‘æ˜¯å¦æœ‰å¿…è¦å¼•å…¥GNNï¼Ÿä½œè€…å‘ç°å¦‚æœåªç”¨BERTçš„è¯ï¼Œé‚£ä¹ˆå¯¹äºä¸åŒçš„entity pairï¼Œentityçš„repéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé‚£æ˜¯å¦èƒ½å¤Ÿä¸å¼•å…¥graphçš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè¿™å°±æœ‰äº†ATLOPæ¨¡å‹ã€‚</p><blockquote><p>è¯´å®è¯ï¼Œè¿™ç¯‡paperæ›´å¤šçš„æ˜¯è§£å†³å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜ï¼Œå› ä¸ºå³ä¾¿ä¸æ˜¯document-level REï¼Œå¦å¤–éšä¾¿æ¥ä¸ªå¤šæ ‡ç­¾åˆ†ç±»ï¼Œåº”è¯¥ä¹Ÿå¯ä»¥å¾—åˆ°å¾ˆå¥½çš„æ•ˆæœã€‚</p></blockquote><h3 id="Model-2"><a href="#Model-2" class="headerlink" title="Model"></a>Model</h3><p>ATLOPæ¨¡å‹æ•´ä½“æ˜¯åŸºäºBERTè€Œä¸æ˜¯graphæ¥åšçš„ã€‚æ‰€ä»¥æˆ‘åˆ†ä¸¤éƒ¨åˆ†é˜è¿°ï¼šä¸»ä½“éƒ¨åˆ†+æ”¹è‰¯éƒ¨åˆ†ã€‚</p><h4 id="backbone"><a href="#backbone" class="headerlink" title="backbone"></a>backbone</h4><ul><li><p><strong>task definitionï¼š</strong>ç»™å®šdocument $d$ä»¥åŠä¸€ç³»åˆ—entity $\{e_i\}_{i=1}^{n}$ï¼Œç›®æ ‡æ˜¯å¾—åˆ°entity pair $(e_s,e_o)$çš„relation $r$ï¼Œ$r\in {\cal R}\cup \{NA\}$ã€‚</p></li><li><p><strong>encoderï¼š</strong>ç»™å®šdocument $d=[x_t]_{t=1}^l$ï¼Œå¯¹äºæ¯ä¸€ä¸ªå¯èƒ½çš„mentionçš„å¼€å¤´ä¸ç»“å°¾ï¼ŒåŠ å…¥<code>*</code>æ¥è¿›è¡Œæ ‡æ³¨ï¼Œç„¶åå°†sentenceè¾“å…¥åˆ°BERTå½“ä¸­ï¼Œå¾—åˆ°contextualçš„repã€‚å³ï¼š$[h_1,â€¦,h_l]=BERT([x_1,â€¦,x_l])$ã€‚mention embeddingç”±mentioné¦–éƒ¨çš„<code>*</code>repæ¥è¡¨ç¤ºï¼Œentity repæ˜¯å¯¹å…¶æ‰€æœ‰çš„mentionçš„repè¿›è¡Œlogexpsumå¾—åˆ°çš„ï¼Œå³ï¼š$h_{e_i}=log\sum_{j=1}^{N_{e_i}}exp(h_{m_j^i})$ï¼Œå…¶ä¸­$m_j^i$è¡¨ç¤ºentity $e_i$çš„ç¬¬$j$ä¸ªmentionã€‚</p></li><li><p><strong>binary classificationï¼š</strong>å¯¹äºentity pair $(h_{e_s},h_{e_o})$ï¼Œæˆ‘ä»¬å¯¹å…¶åˆ†åˆ«è¿›è¡Œç¼–ç ï¼Œå¹¶ä½¿ç”¨bilinearå¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">z_s=tanh(W_sh_{e_s}) \\z_o=tanh(W_oh_{e_o}) \\P(r|e_s,e_o)=sigmoid(z^T_sW_rz_o+b_r)</script><p>åœ¨ATLOPé‡Œï¼Œä¸ºäº†å‡å°‘$W_r$çš„å‚æ•°é‡ï¼Œä½¿ç”¨äº†group bilinearçš„æŠ€æœ¯ï¼Œå…¶å®å°±æ˜¯multi-head attentionçš„æ€æƒ³ï¼Œå°±æ˜¯å°†$h_{e_s}ä¸h_{e_o}$çš„ç»´åº¦åˆ†ä¸ºkä»½ï¼Œåˆ†åˆ«è¿›è¡Œbilinearæ“ä½œï¼Œæœ€åå¯¹ç»“æœè¿›è¡Œconcatï¼Œå†ä½¿ç”¨sigmoidå¾—åˆ°ç»“æœã€‚</p></li></ul><h4 id="improvement"><a href="#improvement" class="headerlink" title="improvement"></a>improvement</h4><p><strong>adaptive thresholding</strong></p><p>backboneä¸­æè¿°çš„å°±æ˜¯ä¸åŸºäºgraphçš„åŸºæœ¬æ“ä½œï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä½¿ç”¨sigmoidå‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦ç¡®å®šä¸€ä¸ªé˜ˆå€¼(ä¸€èˆ¬æ˜¯0.5)ï¼Œå½“ç»“æœå¤§äºè¿™ä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»™å®ƒpositive labelï¼Œå½“å®ƒå°äºè¿™ä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»™å®ƒnegative labelã€‚ä½†æ˜¯ä½œè€…å‘ç°ï¼Œå¯¹äºDREè¿™æ ·çš„å¤šå®ä½“å¤šæ ‡ç­¾é—®é¢˜ï¼Œä¸åŒçš„entity pairçš„ä¸åŒçš„realtionåˆ¤æ–­ï¼Œåº”è¯¥æ˜¯æœ‰ä¸åŒçš„é˜ˆå€¼æ‰èƒ½å¤Ÿå¾—åˆ°æ›´å¥½çš„ç»“æœã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šæ‰‹åŠ¨å»è¯•ä¸åŒçš„é˜ˆå€¼åœ¨devä¸Šçš„æ•ˆæœï¼Œé€‰å–F1å€¼æœ€å¥½çš„é˜ˆå€¼ã€‚ä½†æ˜¯äººå·¥é€‰æ‹©ä»ç„¶æ— æ³•è¾¾åˆ°æœ€ä¼˜è§£(è¿‘ä¼¼æœ€ä¼˜è§£)ï¼Œæ˜¯å¦å¯ä»¥è®©æ¨¡å‹è‡ªå·±æ¥é€‰æ‹©é˜ˆå€¼å‘¢ï¼Ÿåœ¨ATLOPæ¨¡å‹ä¸­ï¼Œè®¾è®¡äº†adaptive thresholdingæœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/ATLOP_adaptive_thresholding.jpg" style="zoom:50%;"></p><p>å…·ä½“æ¥è¯´ï¼Œå¯¹äºç»™å®šçš„entity pair $T=(e_s,e_o)$ï¼Œæˆ‘ä»¬å®šä¹‰å®ƒçš„positive label set($\cal P_T$)ä¸negative label set($\cal P_N$)ï¼šå‰è€…æ˜¯$T$æœ‰çš„relationï¼Œåè€…æ˜¯$T$æ²¡æœ‰çš„realtionã€‚æˆ‘ä»¬è¿½æ±‚çš„æ˜¯ï¼š<strong>positive labelçš„logitsæ¯”negative labelçš„è¦é«˜ï¼Œå¹¶ä¸”ä¸¤è€…å·®è·è¶Šå¤§è¶Šå¥½ã€‚</strong>å› æ­¤ï¼Œåœ¨ATLOPæ¨¡å‹ä¸­ï¼Œå¼•å…¥äº†<code>TH</code>è¿™ä¸ªclass(<code>TH</code>classçš„æ¦‚ç‡è®¡ç®—ä»ç„¶å’Œè®¡ç®—æ™®é€šçš„relationæ˜¯ä¸€æ ·çš„)ï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå¯¹äºç»™å®šçš„entity pairï¼Œæˆ‘ä»¬è¿”å›çš„relation classæ˜¯æ¯”<code>TH</code>classçš„logitsè¦é«˜çš„classã€‚å…·ä½“çš„å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\cal L_1=\sum_{r\in P_T}log(\frac{exp(logits_r)}{sum_{r^{\prime}\in \cal P_T\cup\{TH\}}exp(logits_r^{\prime})}) \\\cal L_2=log(\frac{exp(logits_{TH})}{sum_{r^{\prime}\in \cal P_T\cup\{TH\}}exp(logits_r^{\prime})}) \\\cal L=L_1+L_2</script><p>è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸è®¡ç®—negative labelçš„lossï¼ŸğŸ§</p><p><strong>localized context pooling</strong></p><p>å¯¹äºä¸åŒentity pairä¸­çš„entityï¼Œå…¶å®æœ€ç»ˆç”¨äºåˆ†ç±»çš„repæ˜¯ä¸€æ ·çš„ï¼Œè€Œå®é™…ä¸Šï¼Œå¯¹äºä¸åŒçš„entity pairï¼Œå®ƒæ‰€è¡¨è¾¾çš„ä¿¡æ¯å´æœ‰å¯èƒ½å®Œå…¨ä¸ä¸€æ ·ï¼Œå¹¶ä¸”åœ¨documentä¸­ä¸ä¹‹ç›¸å…³çš„ä¿¡æ¯çš„ä½ç½®ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ATLOPæ¨¡å‹ä¸­ï¼Œæå‡ºäº†LOPæŠ€æœ¯ã€‚</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/ATLOP_LOP.jpg" style="zoom:50%;"></p><p>å…·ä½“æ¥è¯´ï¼ŒLOPæŠ€æœ¯ï¼Œå°±æ˜¯ä½¿ç”¨BERTä¸­æœ€åä¸€ä¸ªtransformer layerä¸­çš„multi-head self attentionï¼Œå°†å…¶èå…¥åˆ°æœ€ç»ˆæ¯ä¸€ä¸ªentityçš„repä¸­ï¼Œä»è€Œåœ¨ä¸åŒçš„entity pairä¸­ï¼Œæ¯ä¸€ä¸ªentityçš„repèƒ½å¤Ÿèšåˆå…¶æœ€ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸ªäººè®¤ä¸ºè¿™æ˜¯è¿™ç¯‡paperä¸­æœ€å‡ºå½©çš„åœ°æ–¹ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">A^{(s,o)}=A^E_sÂ·A^E_o \\q^{(s,o)}=\sum_{i=1}^{H}A^{(s,o)}_i \\a^{(s,o)}=q^{(s,o)} \ or \ 1^Tq^{(s,o)} \\c^{(s,o)}=H^Ta^{(s,o)}</script><p>å…¶ä¸­$A^E_sã€A^E_o$æ˜¯entity-level attentionï¼Œç„¶åæˆ‘ä»¬å°†$c^{(s,o)}$ä¸$h_{e_s}ã€h_{e_o}$ç›¸ç»“åˆï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">z_s^{(s,o)}=tanh(W_sh_{e_s}+W_{c_1}c^{(s,o)}) \\z_o^{(s,o)}=tanh(W_oh_{e_o}+W_{c_2}c^{(s,o)}) \\</script><p>æ¥ä¸‹æ¥æ“ä½œå°±æ˜¯ä¸€æ ·çš„äº†ï¼Œç›´æ¥é€å…¥sigmoidå°±è¡Œã€‚</p><h3 id="Experiment-2"><a href="#Experiment-2" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCDRã€GDAã€DocRED</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/ATLOP_result_docred.jpg" alt></p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/ATLOP_result_CDR_GDA.jpg" style="zoom:50%;"></p><p>ä»ç»“æœä¸Šçœ‹ï¼Œéå¸¸å¯ä»¥ã€‚</p></li><li><p>æ¶ˆèå®éªŒ</p><p>ä½œè€…å¯¹å„ä¸ªcomponentä¸­è¿›è¡Œäº†æ¶ˆèå®éªŒ(dev)ï¼Œå¦‚ä¸‹</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task-PART-TWO/ATLOP_ablation_1.jpg" style="zoom: 50%;"></p><p>è¯´å®è¯ï¼Œè¿™ä¸ªadaptive thresholding lossçš„æ•ˆæœçœŸæ˜¯å‡ºä¹æˆ‘çš„æ„æ–™ï¼Œæˆ‘æ„Ÿè§‰æ‰åˆ°41.74%æœ‰ç‚¹å¤ªä¸æ­£å¸¸äº†ï¼Œå³ä¾¿ä¸ç”¨BERTï¼Œç”¨BILSTMä¹Ÿèƒ½è¾¾åˆ°50%ï¼Œä¸æ˜¯å¾ˆæ‡‚è¿™ä¸ªç»“æœã€‚ğŸ§</p></li></ol><h2 id="Entity-and-Evidence-Guided-Relation-Extraction-for-DocRED-arxiv2020"><a href="#Entity-and-Evidence-Guided-Relation-Extraction-for-DocRED-arxiv2020" class="headerlink" title="Entity and Evidence Guided Relation Extraction for DocRED(arxiv2020)"></a>Entity and Evidence Guided Relation Extraction for DocRED(arxiv2020)</h2><h3 id="Background-3"><a href="#Background-3" class="headerlink" title="Background"></a>Background</h3><h3 id="Model-3"><a href="#Model-3" class="headerlink" title="Model"></a>Model</h3><h3 id="Experiment-3"><a href="#Experiment-3" class="headerlink" title="Experiment"></a>Experiment</h3><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>ã€ŠGlobal-to-Local Neural Networks for Document-Level Relation Extractionã€‹</p><p>ã€ŠHIN: Hierarchical Inference Network for Document-Level Relation Extractionã€‹</p><p>ã€ŠDocument-Level Relation Extraction with Adaptive Thresholding and Localized Context Poolingã€‹</p><p>ã€ŠEntity and Evidence Guided Relation Extraction for DocREDã€‹</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å…³ç³»æŠ½å– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Document-level RE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|RE-Integrate GNN into Document-level RE task|PART ONE</title>
      <link href="2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/"/>
      <url>2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢ä¸»è¦æ˜¯è®²è§£å›¾ç¥ç»ç½‘ç»œåœ¨Document-levelå…³ç³»æŠ½å–ä¸Šçš„åº”ç”¨ï¼Œå…±è®²è§£4ç¯‡è®ºæ–‡ï¼šã€ŠInter-sentence Relation Extraction with Document-level Graph Convolutional Neural Networkã€‹ã€ã€ŠConnecting the Dots: Document-level Neural Relation Extraction with Edge-oriented Graphsã€‹ã€ã€ŠReasoning with Latent Structure Reï¬nement for Document-Level Relation Extractionã€‹ã€ã€ŠDouble Graph Based Reasoning for Document-level Relation Extractionã€‹ã€‚</p><a id="more"></a><h2 id="Inter-sentence-Relation-Extraction-with-Document-level-Graph-Convolutional-Neural-Network-ACL2019"><a href="#Inter-sentence-Relation-Extraction-with-Document-level-Graph-Convolutional-Neural-Network-ACL2019" class="headerlink" title="Inter-sentence Relation Extraction with Document-level Graph Convolutional Neural Network(ACL2019)"></a>Inter-sentence Relation Extraction with Document-level Graph Convolutional Neural Network(ACL2019)</h2><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>æ–‡æ¡£çº§å…³ç³»æŠ½å–çš„éš¾ç‚¹åœ¨äºï¼šæˆ‘ä»¬å¾€å¾€éœ€è¦æŠ½å–çš„entity pairæ˜¯span across multi-sentencesï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¯¹entityçš„localã€non-localã€semanticã€dependencyç­‰ä¿¡æ¯è¿›è¡Œæå–å’Œå»ºæ¨¡ã€‚è¿™ç¯‡paperæå‡ºçš„GCNNï¼Œæ­£æ˜¯ä»¥wordä¸ºnodeï¼Œwordsä¹‹é—´çš„localä¸non-local dependencyä½œä¸ºedgeï¼Œæ¥æ„å»ºdocument-level graphï¼Œä»è€Œè§£å†³æ–‡æ¡£çº§å…³ç³»æŠ½å–é—®é¢˜ã€‚</p><h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/GCNN_model.jpg" alt></p><p>GCNNæ¨¡å‹åˆ†ä¸º4éƒ¨åˆ†ï¼š<strong>input layerã€graph constructionã€GCNN layerã€MIL-based relation classificationã€‚</strong></p><ul><li><p><strong>task definitionï¼š</strong>ç»™å®šä¸€ä¸ªdocument $t$: $[w_1,w_2,â€¦,w_n]$ï¼Œ$e_1,e_2$æ˜¯$t$ä¸­çš„ä¸¤ä¸ªentityï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šæå–å‡º$e_1$ä¸$e_2$ä¹‹é—´çš„relationã€‚</p></li><li><p><strong>input layerï¼š</strong>å¯¹äºdocumentä¸­çš„æ¯ä¸€ä¸ªword $i$ï¼Œæˆ‘ä»¬å°†å®ƒæœ¬èº«ä»¥åŠå®ƒä¸æˆ‘ä»¬target entity pairçš„çš„ç›¸å¯¹ä½ç½®åˆ†åˆ«ç¼–ç ä¸ºä¸‰ä¸ªå‘é‡ï¼š$w_i,d^1_i,d^2_i$ï¼Œå¦‚æœä¸€ä¸ªentityæœ‰å¤šä¸ªmentionçš„è¯ï¼Œé‚£ä¹ˆå°±é€‰æ‹©ä¸å½“å‰wordæœ€æ¥è¿‘çš„mentionæ¥è®¡ç®—ç›¸å¯¹ä½ç½®ã€‚æœ€åï¼Œæ¯ä¸€ä¸ªwordçš„representationä¸ºï¼š$x_i=[w_i;d^1_i;d^2_i]$ã€‚</p></li><li><p><strong>graph constructionï¼š</strong>æˆ‘ä»¬éœ€è¦æ ¹æ®documentæ¥æ„å»ºgraphã€‚åœ¨GCNNä¸­ï¼Œnode setå°±æ˜¯æ¯ä¸€ä¸ªwordï¼Œedge setæœ‰5ç§ï¼š</p><ul><li><strong>Syntactic dependency edgeï¼š</strong>å¥æ³•ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ¯ä¸€ä¸ªsentenceä¸­çš„wordä¹‹é—´çš„å¥æ³•å…³ç³»å»ºç«‹edgeï¼›</li><li><strong>Coreference edgeï¼š</strong>æŒ‡ä»£ï¼Œå¯¹äºè¡¨ç¤ºåŒä¸€ä¸ªå«ä¹‰çš„phraseï¼Œè¿›è¡Œè¿æ¥ï¼›</li><li><strong>Adjacent sentence edgeï¼š</strong>å°†sentenceçš„æ ¹ç»“ç‚¹é±¼ä¸Šä¸‹æ–‡sentenceçš„æ ¹ç»“ç‚¹è¿›è¡Œè¿æ¥ï¼›</li><li><strong>Adjacent word edgeï¼š</strong>å¯¹äºåŒä¸€ä¸ªsentenceï¼Œæˆ‘ä»¬å»è¿æ¥å½“å‰wordçš„å‰åèŠ‚ç‚¹ï¼›</li><li><strong>self node edgeï¼š</strong>wordä¸æœ¬èº«è¿›è¡Œè¿æ¥ï¼›</li></ul></li><li><p><strong>GCNN layerï¼š</strong>åœ¨æ„å»ºå¥½doucment graphçš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨GCNNæ¥è®¡ç®—å¾—åˆ°æ¯ä¸€ä¸ªnodeçš„representationã€‚è¿™é‡Œä½¿ç”¨çš„GCNNä¸æ™®é€šçš„GCNä¸åŒï¼Œè¿™é‡Œåœ¨aggregate node representationçš„æ—¶å€™ï¼Œåªä½¿ç”¨äº†å…¶é‚»åŸŸçš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹äºä¸åŒç±»å‹çš„edgeï¼Œåˆ†åˆ«ä½¿ç”¨GCN(æ¯•ç«ŸGCNåªèƒ½ç”¨äºåŒè´¨å›¾)ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯æ‰€æœ‰ç±»å‹çš„graphçš„ç»“æœçš„åŠ å’Œã€‚æˆ‘è®¤ä¸ºè¿™é‡Œæ˜¯GCNNæ¨¡å‹æœ€å‡ºå½©çš„åœ°æ–¹äº†ï¼Œè™½ç„¶ç°åœ¨æ¥çœ‹å¹¶æ²¡æœ‰ä»€ä¹ˆå¾ˆæ–°é¢–çš„ï¼Œä¸è¿‡è¿™ç§GCNçš„ä½¿ç”¨æ–¹æ³•å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œå‚è§how power GNNè¿™ç¯‡è®ºæ–‡ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">x^{k+1}_i=f(\sum_{u\in v(i)}(W^k_{l(i,u)}x^k_u+b^k_{l(i,u)}))</script><p>å…¶ä¸­ï¼Œ$f()$è¡¨ç¤ºæŸç§encoder(e.g. relu)ã€‚</p></li><li><p><strong>MIL-based relation classificationï¼š</strong>è¿™é‡Œä½¿ç”¨MILã€‚å› ä¸ºåœ¨ä¸€ç¯‡documentä¸­ï¼Œæ¯ä¸€ä¸ªentityä¼šæœ‰å¤šä¸ªmentionï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå»èšåˆtarget entityæ‰€æœ‰çš„mentionï¼Œå¹¶é€šè¿‡bi-affine pairwise scoringæ¥è¿›è¡Œæœ€ç»ˆçš„å…³ç³»åˆ†ç±»ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">x_i^{head}=W^{(1)}_{head}(RELU(W^{(0)}_{head}x_i^K)) \\x_i^{tail}=W^{(1)}_{tail}(RELU(W^{(0)}_{tail}x_i^K)) \\scores(e^{head},e^{tail})=log\sum_{i\in E^{head},j\in E^{tail}}exp((x^{head}_iR)x^{tail}_j)</script></li></ul><h3 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCDRã€CHR(è¿™ç§ä¸¤ä¸ªbiochemistryé¢†åŸŸçš„document-level å…³ç³»æŠ½å–æ•°æ®é›†)</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/GCNN_result.jpg" style="zoom:50%;"></p><p>ç»“æœå°±ä¸åˆ†æäº†ï¼Œæ²¡ä»€ä¹ˆå¥½åˆ†æçš„ï¼Œæ€»çš„æ¥è¯´ï¼ŒGCNNä¸­è§„ä¸­çŸ©å§ï¼Œæ²¡æœ‰å¤ªå‡ºè‰²çš„åœ°æ–¹ï¼Œç¼ºç‚¹åœ¨äºï¼šæ„å»ºäº†å¼‚è´¨å›¾ï¼Œä½†æ˜¯å´æ²¡æœ‰è€ƒè™‘åˆ°ä¸åŒç±»å‹çš„edgeçš„ä½œç”¨ï¼›å¯¹äºmentionçš„å¤„ç†ä¸å¤Ÿå¥½ï¼›logical reasoningå‡ ä¹æ²¡æœ‰å¦å¤–å¤„ç†ï¼Œçº¯é GCNNï¼›edgeçš„æ„å»ºéœ€è¦å…¶ä»–çš„å·¥å…·ï¼Œä¸ä¸€å®šå‡†ç¡®ï¼›å¯¹äºword representationçš„è¡¨ç¤ºä¸å¤Ÿã€‚</p></li></ol><h2 id="Connecting-the-Dots-Document-level-Neural-Relation-Extraction-with-Edge-oriented-Graphs-EMNLP2019"><a href="#Connecting-the-Dots-Document-level-Neural-Relation-Extraction-with-Edge-oriented-Graphs-EMNLP2019" class="headerlink" title="Connecting the Dots: Document-level Neural Relation Extraction with Edge-oriented Graphs(EMNLP2019)"></a>Connecting the Dots: Document-level Neural Relation Extraction with Edge-oriented Graphs(EMNLP2019)</h2><h3 id="Background-1"><a href="#Background-1" class="headerlink" title="Background"></a>Background</h3><p>è¿™ç¯‡paperä¹Ÿæ˜¯è§£å†³document-level relation extractioné—®é¢˜ï¼Œæå‡ºçš„æ¨¡å‹åŸºäºä»¥ä¸‹å‡ ä¸ªå‘ç°ï¼š1. ä¹‹å‰å¾ˆå¤šçš„graph based modeléƒ½æ˜¯åŸºäºnodeçš„ï¼Œç„¶è€Œä½œè€…å‘ç°entity ä¹‹é—´çš„relationï¼Œå¯ä»¥é€šè¿‡èŠ‚ç‚¹ä¹‹é—´è·¯å¾„æ¥å½¢æˆå”¯ä¸€çš„edge representationï¼Œä»è€Œæ›´å¥½åœ°å¾—åˆ°è¡¨è¾¾ï¼›2.æ¯ä¸€ä¸ªtarget entityçš„mentionså¯¹äºentityä¹‹é—´çš„relationæ˜¯éå¸¸é‡è¦çš„ã€‚è¿™ç¯‡paperæå‡ºçš„EoGæ¨¡å‹å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><h3 id="Model-1"><a href="#Model-1" class="headerlink" title="Model"></a>Model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/EoG_model.jpg" alt></p><p>EoGæ¨¡å‹åˆ†ä¸ºå››éƒ¨åˆ†ï¼š<strong>sentence encdoing layerã€graph constructionã€inference layerã€classification layerã€‚</strong></p><ul><li><p><strong>task definitionï¼š</strong>ç»™å®šæ ‡æ³¨å¥½çš„document(entityä¸mentions)ï¼Œç›®æ ‡æ˜¯æŠ½å–å‡ºæ‰€æœ‰entity pairçš„relationã€‚</p></li><li><p><strong>sentence encoding layerï¼š</strong>doucmentä¸­çš„æ¯ä¸€ä¸ªsentenceçš„wordéƒ½è¢«ç¼–ç ä¸ºä¸€ä¸ªvectorï¼Œå®é™…ä¸Šï¼Œè¿™æ ·å¾—åˆ°çš„æ˜¯4ç»´çš„å¼ é‡[batch_size,nums_seqs,seq_length,embedding_dim]ï¼Œç„¶åå°†å…¶è¾“é€åˆ°BILSTMä¸­è¿›è¡Œç¼–ç ï¼Œå¾—åˆ°contxtual representationã€‚</p></li><li><p><strong>graph costructionï¼š</strong>graph constructionåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šnode constructionä¸edge constructionã€‚</p><ul><li><p><strong>node constructionï¼š</strong>åœ¨EoGæ¨¡å‹ä¸­ï¼Œæœ‰ä¸‰ç§nodeï¼šmention node($n_m$)ã€entity node($n_e$)ã€sentence node($n_s$)ã€‚mention nodeæ˜¯æ‰€æœ‰entityçš„mentionsçš„é›†åˆã€‚æ¯ä¸€ä¸ªmention nodeçš„representationæ˜¯æ­¤mentionçš„æ‰€æœ‰word embeddingçš„å¹³å‡ï¼›entity nodeæ˜¯æ‰€æœ‰entityçš„é›†åˆï¼Œæ¯ä¸€ä¸ªentity nodeçš„representationæ˜¯è¯¥entityæ‰€æœ‰çš„mentionsçš„å¹³å‡ï¼›sentence nodeæ˜¯æ‰€æœ‰sentenceçš„é›†åˆï¼Œæ¯ä¸€ä¸ªsentence nodeæ˜¯è¯¥sentenceä¸­æ‰€æœ‰word embeddingçš„å¹³å‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¸ºäº†åŒºåˆ«ä¸åŒç±»å‹çš„nodeï¼Œè¿˜ç»™æ¯ä¸€ä¸ªnodeçš„representationä¸Šconcatå¯¹åº”ç±»å‹çš„node embeddingã€‚æ‰€ä»¥æœ€ç»ˆçš„è¡¨ç¤º:</p><script type="math/tex; mode=display">n_m=[avg_{w_i\in m}(w_i);t_m] \\n_e=[avg_{m_i\in e}(m_i);t_e] \\n_s=[avg_{w_i\in s}(w_i);t_s] \\</script></li><li><p><strong>edge constructionï¼š</strong>æœ‰äº”ç§edgeï¼šmention-mention(MM)ã€mention-entity(ME)ã€mention-sentence(MS)ã€entity-sentence(ES)ã€sentence-sentence(SS)ã€‚MM edgeï¼Œæˆ‘ä»¬æ˜¯è¿æ¥ä¸¤ä¸ªåœ¨åŒä¸€ä¸ªsentenceçš„ä¸¤ä¸ªmentionï¼Œå¹¶ä¸”å…¶è¡¨ç¤ºæˆ‘ä»¬æ˜¯concatè¿™ä¸¤ä¸ªmentionæœ¬èº«çš„representation+context+ä¸¤ä¸ªmentionçš„è·ç¦»ã€‚å…·ä½“å…¬å¼ï¼š</p><script type="math/tex; mode=display">x_{MM}=[n_{m_i};n_{m_j};c_{m_i,m_j};d_{m_i,m_j}] \\</script><p>$x_{MM}$è¡¨ç¤ºçš„æ˜¯å¯¹äºmention pair $(m_i,m_j)$çš„MM edgeï¼Œå½“i=1ï¼Œj=2æ—¶ï¼Œ$x_{MM}=[n_{m_1};n_{m_2};c_{m_1,m_2};d_{m_1,m_2}]$,å…¶ä¸­$c_{m_1,m_2}$çš„è®¡ç®—å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\alpha_{k,i}=n^T_{m_k}w_i \\a_{k,i}=\frac{exp(\alpha_{k,i})}{\sum_{j\in[1,n],j\not\in m_k}exp(\alpha_{k,j})} \\a_i=(a_{1,i}+ a_{2,i})/2 \\c_{m_1,m_2}=H^Ta \\k=\{1,2\}</script><p>å…¶ä¸­ï¼Œ$a_i$è¡¨ç¤ºsentenceçš„ç¬¬$i$ä¸ªwordå¯¹æ­¤mention pairçš„é‡è¦æ€§ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯attention weightã€‚</p><p>ME edgeï¼Œæˆ‘ä»¬è¿æ¥æ‰€æœ‰çš„mentionä¸å…¶å¯¹åº”çš„entityï¼Œ$x_{ME}=[n_m;n_e]$ï¼›</p><p>MS edgeï¼Œå°†mentionä¸æ­¤mentionæ‰€åœ¨çš„sentence nodeè¿›è¡Œè¿æ¥ï¼Œ$x_{MS}=[n_m,n_s]$ ;</p><p>ES edgeï¼Œå¦‚æœä¸€ä¸ªsentenceä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªentityçš„mentionï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†setence nodeä¸entity nodeè¿›è¡Œè¿æ¥ï¼Œ$x_{ES}=[n_e;n_s]$;</p><p>SS edgeï¼šå°†æ‰€æœ‰çš„sentence nodeè¿›è¡Œè¿æ¥ï¼Œä»¥è·å¾—non-local informationï¼Œ$x_{SS}=[n_{s_i};n_{s_j};d_{s_i,s_j}]$ï¼Œå…¶ä¸­$d_{s_i,s_j}$è¡¨ç¤ºä¸¤ä¸ªsentenceçš„è·ç¦»vectorã€‚</p><p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„æ˜¯<strong>æå–å‡ºentity pairçš„relation</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹æ‰€æœ‰çš„edge representationéƒ½åšä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œä»è€Œè®©å…¶å”¯ç‹¬ä¸€è‡´ã€‚å³ï¼š$e^{(1)}_z=W_zx_z,z\in[MM,ME,MS,ES,SS]$ã€‚</p></li></ul></li><li><p><strong>inference layerï¼š</strong>ç”±äºæˆ‘ä»¬æ²¡æœ‰ç›´æ¥çš„EEedgeï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¾—åˆ°entityä¹‹é—´çš„å”¯ä¸€è·¯å¾„çš„è¡¨ç¤ºï¼Œæ¥äº§ç”ŸEE edgeçš„representationã€‚è¿™é‡Œä½¿ç”¨äº†two-step inference mechanismæ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><ul><li><p>the first stepï¼šåˆ©ç”¨ä¸­é—´èŠ‚ç‚¹$k$åœ¨ä¸¤ä¸ªèŠ‚ç‚¹$i$å’Œ$j$ä¹‹é—´äº§ç”Ÿä¸€æ¡è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f(e^{(l)}_{ik},e^{(l)}_{kj})=\sigma(e^{(l)}_{ik}\odot e^{(l)}_{kj})</script></li><li><p>The second stepï¼šå°†åŸå§‹çš„edge(å¦‚æœæœ‰çš„è¯)ä¸æ‰€æœ‰æ–°äº§ç”Ÿçš„edgeè¿›è¡Œèšåˆï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">e^{(2l)}_{ij}=\beta e^{(2l)}_{ij}+(1-\beta)\sum_{k\not=i,j}f(e^{(l)}_{ik},e^{(l)}_{kj})</script><p>é‡å¤ä¸Šè¿°ä¸¤æ­¥Næ¬¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ¯”è¾ƒå……åˆ†æ··åˆçš„EE edgeã€‚å®é™…ä¸Šï¼Œè¿™ä¸€æ­¥å°±æ˜¯ä¸ºäº†è§£å†³logical reasoningã€‚</p></li></ul></li><li><p><strong>classification layerï¼š</strong>è¿™é‡Œä½¿ç”¨softmaxè¿›è¡Œåˆ†ç±»ï¼Œå› ä¸ºå®éªŒæ‰€ä½¿ç”¨çš„ä¸¤ä¸ªæ•°æ®é›†å…¶å®éƒ½æ˜¯æ¯ä¸€ä¸ªentity pairéƒ½åªæœ‰ä¸€ä¸ªrelationã€‚å…·ä½“å…¬å¼ï¼š</p><script type="math/tex; mode=display">y=softmax(W_ce_{EE}+b_c)</script></li></ul><h3 id="Experiment-1"><a href="#Experiment-1" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCDRã€GDA</p></li><li><p>å®éªŒç»“æœï¼š</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/EoG_result.jpg" alt></p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/EoG.jpg" style="zoom:50%;"></p><p>ç»“æœæ²¡ä»€ä¹ˆå¥½çœ‹çš„ï¼Œä¸»è¦æ¥çœ‹ä¸€ä¸‹ablationã€‚</p></li><li><p>ablation</p><p>EoGæ¨¡å‹åšäº†ä¸€äº›æ¶ˆèå®éªŒã€‚é¦–å…ˆæ˜¯å¯¹EoG(full)ã€EoG(NoInf)ã€EoG(Sent)åœ¨ä¸åŒé•¿åº¦çš„entity pairè¿›è¡Œå®éªŒï¼š</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/EoG_result2.jpg" style="zoom:50%;"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“entity pairä¹‹é—´ç›¸å·®4å¥ä»¥ä¸Šæ—¶ï¼Œç»“æœæ˜æ˜¾è¦å¥½ï¼Œè¿™è¯´æ˜åŸå§‹çš„EoGå¿½ç•¥äº†ä¸€äº›é‡è¦èŠ‚ç‚¹ä¹‹é—´çš„äº¤äº’ä¿¡æ¯ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½è®©æ¨¡å‹è‡ªåŠ¨é€‰æ‹©å“ªäº›èŠ‚ç‚¹è¦äº¤äº’ï¼Œå“ªäº›èŠ‚ç‚¹ä¸è¦äº¤äº’å‘¢ï¼Ÿ(åœ¨LSRå°±æ˜¯è¿™ä¹ˆåšçš„)é™¤æ­¤ä¹‹å¤–ï¼Œä½œè€…è¿˜å¯¹ä¸åŒçš„compnentè¿›è¡Œäº†æ¶ˆèå®éªŒã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/EoG_ablation.jpg" style="zoom:50%;"></p><p>ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå»æ‰SSå¯¹ç»“æœå½±å“å·¨å¤§ï¼Œè¿™è¯´æ˜å¯¹äºdocument-level REï¼Œæå–inter-sentenceä¹‹é—´çš„äº¤äº’ä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦å¤–ï¼ŒMMä¼¼ä¹å¯¹ç»“æœå½±å“æœ€å°ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºMMå¯¹äºentity pairçš„relation identificationæ˜¯éå¸¸é‡è¦çš„ï¼Œåªæ˜¯EoGé‡Œé¢æ„é€ çš„æ–¹å¼ä¸å¯¹ï¼Œåœ¨ä¹‹åçš„GAINæ¨¡å‹é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°MMå¯¹ç»“æœæå‡å·¨å¤§ï¼Œå½“ç„¶æ„å»ºæ–¹å¼ä¸ä¸€æ ·ã€‚</p></li><li><p>å½“ç„¶äº†ï¼Œæœ€åè¿˜åšäº†ä¸€äº›bad caseçš„åˆ†æï¼Œæœ‰ä¸‰ç§ï¼šä½¿ç”¨andç›¸è¿æ¥çš„entityï¼Œmodelæ— æ³•æ‰¾åˆ°å¥¹ä»¬ä¹‹é—´çš„relationï¼›ç¼ºå°‘coreferenceï¼›3.ä¸å®Œå…¨çš„å®ä½“é“¾æ¥ã€‚ä¸ªäººè§‰å¾—EoGæ¨¡å‹æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å¼€ç«¯ï¼Œæä¾›äº†å¾ˆå¤šæ€è·¯ï¼Œå€¼å¾—ç»†ç»†å“è¯»ã€‚</p></li></ol><h2 id="Reasoning-with-Latent-Structure-Reï¬nement-for-Document-Level-Relation-Extraction-ACL2020"><a href="#Reasoning-with-Latent-Structure-Reï¬nement-for-Document-Level-Relation-Extraction-ACL2020" class="headerlink" title="Reasoning with Latent Structure Reï¬nement for Document-Level Relation Extraction(ACL2020)"></a>Reasoning with Latent Structure Reï¬nement for Document-Level Relation Extraction(ACL2020)</h2><h3 id="Background-2"><a href="#Background-2" class="headerlink" title="Background"></a>Background</h3><p>è¿™ç¯‡æˆ‘ä¸ªäººæ„Ÿè§‰æ˜¯EoGæ¨¡å‹çš„æ”¹è‰¯ï¼Œé’ˆå¯¹çš„é—®é¢˜å°±æ˜¯ï¼šåœ¨EoGæ¨¡å‹çš„æ¶ˆèå®éªŒä¸­ï¼Œå‘ç°full versionåœ¨é•¿åº¦å¤§äº4æ—¶çš„æ•ˆæœè¦æ¯”åŸå§‹çš„EoGæ¨¡å‹è¦å¥½ï¼Œé‚£ä¹ˆåœ¨fullçš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦å¯ä»¥è®©æ¨¡å‹è‡ªåŠ¨é€‰æ‹©å“ªäº›è¾¹é‡è¦ï¼Œé‚£äº›ä¸é‡è¦å‘¢ï¼Ÿè¿™å°±æ˜¯LSRæ¨¡å‹ã€‚</p><blockquote><p>ä¸ªäººè§‰å¾—è¿™ç¯‡ç›¸å¯¹è¾ƒéš¾ï¼Œä¸»è¦æ˜¯å…¶ä½¿ç”¨çŸ©é˜µæ ‘åŸç†ï¼Œå¯¹æ•°å­¦è¦æ±‚è¾ƒé«˜ï¼Œå¦‚æœè§‰å¾—çœ‹ä¸æ‡‚ï¼Œåªçœ‹ä¸ªå¤§æ¦‚ä¹Ÿæ˜¯OKçš„ï¼Œè¿™ç¯‡ä¸ªäººè§‰å¾—æ²¡æœ‰followçš„ä»·å€¼ã€‚</p></blockquote><h3 id="Model-2"><a href="#Model-2" class="headerlink" title="Model"></a>Model</h3><p>LSRæ¨¡å‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>node constructorã€dynamic reasonerã€classiferã€‚</strong></p><ul><li><p><strong>node constructorï¼š</strong>è¿™ä¸€éƒ¨åˆ†åˆ†ä¸ºä¸¤å°éƒ¨åˆ†ï¼šcontext encodingä¸node extractionï¼Œä¸»è¦å°±æ˜¯å¯¹documentä¸­çš„æ‰€æœ‰wordè¿›è¡Œç¼–ç ï¼Œå¹¶å¾—åˆ°graphæ‰€æœ‰ç±»å‹çš„nodeçš„representationã€‚å…ˆæ”¾å›¾Â·</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/LSR_node_constructor.jpg" alt></p><ul><li><p>Context encodingï¼šå¯¹äºç»™å®šçš„document $d$ï¼Œæˆ‘ä»¬å°†å…¶è¾“å…¥åˆ°ä¸€ä¸ªencoderä¸­(BILSTM/BERT etc)ï¼Œå¾—åˆ°contextual representationã€‚</p></li><li><p>node extractionï¼šåœ¨LSRä¸­ï¼Œæœ‰ä¸‰ç§nodeï¼šmention nodeã€entity nodeä»¥åŠmeta dependancy path nodeã€‚mention nodeè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªsentenceä¸­entityçš„æ‰€æœ‰çš„mentionï¼Œå…¶è¡¨ç¤ºæ˜¯è¯¥mentionä¸­çš„æ‰€æœ‰wordçš„representationçš„å¹³å‡ï¼›entity nodeæŒ‡çš„æ˜¯entity nodeï¼Œå…¶è¡¨ç¤ºæ˜¯æ‰€æœ‰mention nodeçš„representationçš„å¹³å‡ï¼›MDPè¡¨ç¤ºä¸€ä¸ªå¥å­ä¸­æ‰€æœ‰mentionçš„æœ€çŸ­ä¾èµ–è·¯å¾„é›†ï¼Œåœ¨MDPå…ƒä¾èµ–è·¯å¾„ä¸­ï¼Œmentionå’Œå•è¯çš„è¡¨ç¤ºåˆ†åˆ«è¢«æå–ä¸ºæåŠèŠ‚ç‚¹å’ŒMDPèŠ‚ç‚¹ã€‚(è¯´å®è¯ï¼Œä¸æ˜¯å¾ˆæ‡‚MDPã€‚ğŸ§)</p><blockquote><p>âš ï¸LSRä¸EoGæ¨¡å‹ä¸åŒçš„åœ°æ–¹ä¹‹ä¸€åœ¨äºï¼šmention nodeä¸entity nodeä¸€æ ·çš„ï¼Œä½†æ˜¯LSRæ²¡æœ‰sentence nodeï¼Œå¹¶ä¸”ä½¿ç”¨äº†MDP nodeæ¥ä»£æ›¿ï¼Œæœ¬è´¨ä¸Šå·®ä¸å¤šå§ï¼Œä¸è¿‡ç›¸æ¯”äºsentence nodeï¼ŒMDP nodeèƒ½å¤Ÿè¿‡æ»¤æ‰æ— å…³ä¿¡æ¯(paperåŸè¯ğŸ§)ï¼Œä½†æ˜¯è¯´å®è¯ï¼Œåœ¨context encodingä¸­ï¼Œå·²ç»å¼•å…¥äº†æ— å…³ä¿¡æ¯å§ï¼Œè€Œä¸”åœ¨ä¹‹åçš„å®éªŒä¸­ï¼Œç¡®å®ä¹Ÿè¯æ˜MDPæ²¡å•¥ç”¨ã€‚</p></blockquote></li></ul></li><li><p><strong>dynamic reasonerï¼š</strong>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯inferenceï¼Œå› ä¸ºåœ¨EoGé‡Œé¢ï¼Œå·²ç»è¯æ˜äº†æ²¡æœ‰inferenceå¯¹æœ€ç»ˆç»“æœå½±å“è¿˜æ˜¯è›®å¤§çš„ã€‚ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>structure inductionä¸multi-hop reasioning</strong>ã€‚å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/LSR_dynamic_reasoner.jpg" style="zoom:50%;"></p><ul><li><p>structure inductionï¼šè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ç”¨æ¥å­¦ä¹ æ–‡æ¡£å›¾çš„ç»“æ„ï¼Œä»è€Œå¾—åˆ°æ–‡æ¡£å›¾çš„é‚»æ¥çŸ©é˜µï¼Œä»è€Œä»¥ä¾¿ä½¿ç”¨GCNæ¥è¿›è¡Œaggregateã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">s_{ij}=(tanh(W_pu_i)^TW_b(tanh(W_cu_j)) \\s_i^r=W_ru_i \\P_{ij}=\begin{cases} 0,&if \ i=j, \\ exp(s_{ij}),&otherwise \end{cases} \\L_{ij}=\begin{cases}\sum_{i^{'}=1}^{n}P_{i^{'}j},&if \ i=j, \\ -P_{ij},&otherwise \end{cases} \\\tilde L_{ij}=\begin{cases} exp(s_i^r), &if \ i=1,\\ 0, &if \ i>1 \end{cases} \\A_{ij}=(1-\delta_{1,j})P_{ij}[\tilde L^{-1}]_{ij}-(1-\delta_{i,1})P_{ij}[\tilde L^{-1}]_{ij}</script><p>å…¶ä¸­ï¼Œ$s_{ij}$è¡¨ç¤ºçš„æ˜¯node iä¸node jä¹‹é—´çš„å…³è”åº¦ï¼Œ$s_i^r$è¡¨ç¤ºçš„æ˜¯node iè¢«å½“ä½œstructure root nodeçš„éè§„èŒƒåŒ–æ¦‚ç‡ï¼Œ$P_{ij}$è¡¨ç¤ºçš„æ˜¯node iä¸node jä¹‹é—´çš„edgeçš„æƒé‡ï¼Œ$L$æ˜¯laplaceçŸ©é˜µï¼Œ$\tilde L$æ˜¯å˜ä½“ï¼Œä¸ºäº†è¿›ä¸€æ­¥è®¡ç®—ç”¨çš„ï¼Œ$A$è¡¨ç¤ºçš„æ˜¯æ–‡æ¡£å›¾çš„é‚»æ¥çŸ©é˜µã€‚</p><blockquote><p>è¿™é‡Œä½¿ç”¨äº†structure attention networkä»¥åŠçŸ©é˜µæ ‘åŸç†çš„æ€æƒ³ï¼Œè¿™é‡Œä¸å…·ä½“å±•å¼€ï¼Œæƒ³è¦æ·±ç©¶çš„å¯ä»¥ç™¾åº¦æˆ–è€…Googleã€‚</p></blockquote></li><li><p>multi-hot reasoningï¼šåœ¨å¾—åˆ°é‚»æ¥çŸ©é˜µä¹‹åï¼ŒLSRä¾¿ä½¿ç”¨GCNæ¥å¯¹graphè¿›è¡Œaggregateã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">u^l_i=\sigma(\sum_{j=1}^{n}A_{ij}W^lu_{j}^{l-1}+b^l)</script><p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤å¤šæ¬¡dynamic reasoneræ¨¡å—ï¼Œä»è€Œå¾—åˆ°æ›´åŠ ä¸°å¯Œçš„node representationã€‚</p></li></ul></li><li><p><strong>classifierï¼š</strong>è¿™ä¸€æ­¥å°±æ˜¯ç›´æ¥å¯¹entity pairè¿›è¡Œå…³ç³»åˆ†ç±»ï¼Œä½¿ç”¨sigmoidå‡½æ•°ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(r|e_i,e_j)=\sigma(e_i^TW_ee_j+b_e)</script></li></ul><h3 id="Experiment-2"><a href="#Experiment-2" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCDRã€GDAã€DocRED</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/LSR_result.jpg" alt></p><p>ä»åœ¨DocREDä¸Šçš„ç»“æœæ¥çœ‹ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å¥½ã€‚æˆ‘ä»¬åœ¨æ¥çœ‹ä¸€ä¸‹å…¶åœ¨CDRä¸GDAæ•°æ®é›†ä¸Šçš„ç»“æœã€‚</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/LSR_CDR_GDA.jpg" alt></p><p>åœ¨æ²¡æœ‰MDPèŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œå–å¾—äº†SOTAï¼Œè¯´æ˜MDPçš„ä½œç”¨ä¸€èˆ¬ã€‚æ€»çš„æ¥è¯´ï¼ŒLSRæ¨¡å‹ç¡®å®å¾ˆæ–°é¢–ï¼Œä½†æ˜¯followçš„ä»·å€¼ä¸€èˆ¬ã€‚</p></li></ol><h2 id="Double-Graph-Based-Reasoning-for-Document-level-Relation-Extraction-EMNLP2020"><a href="#Double-Graph-Based-Reasoning-for-Document-level-Relation-Extraction-EMNLP2020" class="headerlink" title="Double Graph Based Reasoning for Document-level Relation Extraction(EMNLP2020)"></a>Double Graph Based Reasoning for Document-level Relation Extraction(EMNLP2020)</h2><h3 id="Background-3"><a href="#Background-3" class="headerlink" title="Background"></a>Background</h3><p>è¿™ç¯‡paperä¹Ÿæ˜¯ç»§æ‰¿äº†EoGæ¨¡å‹ï¼Œä¸»è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š1.ä¸€ä¸ªrelationçš„subjectä¸objectå¯èƒ½ä½äºä¸åŒçš„sentenceï¼Œä¸èƒ½ä»…ä»…åˆ©ç”¨ä¸€ä¸ªå¥å­æ¥å¾—åˆ°relationï¼›2.åŒä¸€ä¸ªentityå¯èƒ½ä¼šå‡ºç°åœ¨ä¸åŒçš„sentenceå½“ä¸­ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨cross-sentence context informationï¼Œä»è€Œæ›´å¥½çš„è¡¨ç¤ºentityï¼›3.å¾ˆå¤šrelationéœ€è¦logical reasoning(main issue)ã€‚ä¸ºæ­¤æå‡ºäº†GAINæ¨¡å‹ã€‚ä¸ªäººè®¤ä¸ºè¿™ç¯‡paperçš„æ¨¡å‹æ¯”è¾ƒä¼˜é›…ï¼ŒæŒºå¥½çš„ã€‚</p><h3 id="Model-3"><a href="#Model-3" class="headerlink" title="Model"></a>Model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/GAIN_model.jpg" alt></p><p>GAINæ¨¡å‹åˆ†ä¸ºå››éƒ¨åˆ†ï¼š<strong>encoding moduleã€mention-level graph aggregation moduleã€entity-level graph aggregation moduleã€classification moduleã€‚</strong></p><ul><li><p><strong>task definitionï¼š</strong>ç»™å®šä¸€ç¯‡å«æœ‰$N$ä¸ªsentenceçš„documntï¼š$\cal D=\{s_i\}_{i=1}^{N}ï¼Œs_i=\{w_j\}_{j=1}^{M}$ï¼Œä»¥åŠ$P$ä¸ªentityï¼š$\cal E=\{e_i\}_{i=1}^{P},e_i=\{m_j\}_{j=1}^{Q}$ï¼Œå…¶ä¸­$e_i$è¡¨ç¤ºç¬¬$i$ä¸ªentityï¼Œ$m_j$è¡¨ç¤ºç¬¬$i$ä¸ªentityçš„ç¬¬$j$ä¸ªmentionã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯entityä¹‹é—´çš„relationã€‚</p></li><li><p><strong>encoding moduleï¼š</strong>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯å°†documentä¸­çš„wordç»è¿‡ç¼–ç ï¼Œå¾—åˆ°contextual representationã€‚ç»™å®šæœ‰nä¸ªwordçš„documentï¼š$\cal D=\{w_i\}_{i=1}^{n}$,ç„¶åå°†word embeddingä¸type embeddingä»¥åŠcoreference embeddingè¿›è¡Œconcatï¼Œå¾—åˆ°final word embeddingï¼Œå³ï¼š</p><script type="math/tex; mode=display">x_i=[E_w(w_i);E_t(t_i);E_c(c_i)]</script><p>å…¶ä¸­ï¼Œ$t_i$ä¸$c_i$æ˜¯$w_i$å¯¹åº”çš„named entity type idä¸entity idï¼Œå¯¹äºé‚£äº›ä¸å±äºä»»ä½•entityçš„wordï¼Œæˆ‘ä»¬å¼•å…¥<code>None</code>typeã€‚å¾—åˆ°final word embeddingä¹‹åï¼Œæˆ‘ä»¬å°†å…¶è¾“å…¥åˆ°ä¸€ä¸ªencoderå½“ä¸­(BISLTM/BERT etc)ï¼Œå¾—åˆ°è¿™ä¸€å±‚çš„è¾“å‡ºï¼š</p><script type="math/tex; mode=display">[g_1,...,g_n]=Encoder([x_1,...,x_n])</script></li><li><p><strong>mention-level graph aggregation moduleï¼š</strong>è¿™ä¸ªgraphçš„æ„å»ºä¸»è¦æ˜¯å¯¹mentionä¹‹é—´çš„å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚åœ¨mention-level graphå½“ä¸­ï¼Œ<strong>node setï¼šmention nodeä¸document nodeã€‚</strong>mention nodeå°±æ˜¯è¡¨ç¤ºæ¯ä¸€ä¸ªmentionï¼Œdocument nodeæ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¯¹document informationè¿›è¡Œå»ºæ¨¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è§†å…¶ä¸ºä¸€ä¸ªä¸­ç»§èŠ‚ç‚¹ï¼Œè®©ä¸åŒmentionä¹‹é—´çš„äº¤äº’å˜å¾—æ›´åŠ å®¹æ˜“ã€‚<strong>edge setï¼šintra-entity edgeã€inter-entity edgeã€document edgeã€‚</strong>intra-entity edgeæ˜¯è®©åŒä¸€ä¸ªentityçš„mentionå½¼æ­¤è¿æ¥ï¼›inter-entity edgeæ˜¯è®©ä¸€ä¸ªå¥å­å†…çš„ä¸åŒentityçš„mentionä¹‹é—´è¿›è¡Œè¿æ¥ï¼›document edgeæ˜¯è®©æ‰€æœ‰çš„mentionä¸document nodeè¿›è¡Œè¿æ¥ã€‚</p><p>æ„å»ºå¥½graphä¹‹åï¼ŒGAINæ¨¡å‹ä½¿ç”¨ä¸GCNNä¸­åŒæ ·çš„GCNï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">h^{(l+1)}_{u}=\sigma(\sum_{k\in{\cal K}}\sum_{v\in \cal N_k(u)}W^{(l)}_kh^{(l)}_v+b^{(l)}_k)</script><p>ä½†æ˜¯è¿™ç§è™½ç„¶å¾ˆæ¥è¿‘WL-testï¼Œä½†æ˜¯ä¼šå­˜åœ¨èŒƒæ•°ä¸æ”¶æ•›çš„æƒ…å†µï¼Œè¿™ä¸ªçœŸçš„ä¸éœ€è¦è€ƒè™‘ä¸€ä¸‹å—ï¼ŸğŸ§åœ¨stack Nå±‚GCNä¹‹åï¼Œå¯¹äºæ¯ä¸€ä¸ªnodeï¼Œæˆ‘ä»¬å»concatæ‰€æœ‰layerçš„representationï¼Œæ¥ä½œä¸ºæ¯ä¸€ä¸ªnodeçš„final representationï¼Œå³ï¼š$m_u=[h^{(0)}_u;h^{(1)}_u;â€¦,h^{(N)}_u]$ã€‚</p></li><li><p><strong>entity-level graph inference moduleï¼š</strong>è¿™ä¸€æ­¥å°±æ˜¯è¿›è¡Œinferenceï¼Œå¾—åˆ°entity-entityçš„è¡¨ç¤ºï¼Œç”¨äºæœ€ç»ˆçš„åˆ†ç±»ï¼Œæ‰€ä»¥path reasoning mechanismå¾ˆé‡è¦ã€‚åœ¨entity-level graphä¸­ï¼Œæˆ‘ä»¬å°†åŒä¸€ä¸ªentityçš„æ‰€æœ‰mentionçš„è¡¨ç¤ºçš„å¹³å‡ä½œä¸ºæ­¤entityçš„è¡¨ç¤ºï¼Œå³ï¼š$e_i=\frac{1}{N}\sum_n m_n$ã€‚entity nodeä¹‹é—´çš„è¾¹è¡¨ç¤ºï¼š$e_{ij}=\sigma(W_q[e_i;e_j]+b_q),\sigma \text{æ˜¯æ¿€æ´»å‡½æ•°}$ã€‚å¯¹äºentity pairä¹‹é—´ä¸åŒçš„è·¯å¾„ï¼Œå…¶è¡¨ç¤ºæ˜¯ï¼š$p^i_{h,t}=[e_{ho};e_{ot};e_{to};e_{oh}]$ï¼Œå½“ç„¶äº†ï¼Œentity pairä¹‹é—´çš„pathä¼šæœ‰å¤šä¸ªï¼Œæˆ‘ä»¬ä½¿ç”¨attentionæœºåˆ¶ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">s_i=\sigma ([e_h;e_t]W_lp^i_{h,t}) \\\alpha_i=\frac{exp(s_i)}{\sum_jexp(s_j)} \\p_{h,t}=\sum_i\alpha_ip^i_{h,t}</script><p>å…¶ä¸­ï¼Œ$\sigma$æ˜¯æŸä¸€ä¸ªæ¿€æ´»å‡½æ•°ã€‚è¿™é‡Œåªä½¿ç”¨äº†2-hopï¼Œå¦‚æœä½¿ç”¨multi-hopï¼Œæ•ˆæœä¼šä¸ä¼šæ›´å¥½ï¼ŸğŸ§</p></li><li><p><strong>classification moduleï¼š</strong>è¿™é‡Œå°±æ˜¯æœ€ç»ˆçš„åˆ†ç±»ã€‚ä½†æ˜¯è¿™é‡Œå€Ÿç”¨äº†ESIMä¸­è¡¨ç¤ºï¼Œå¯¹äºenitty pair $(e_h,e_t)$ï¼Œå…¶ç»¼åˆçš„inferential path informationæ˜¯ï¼š</p><script type="math/tex; mode=display">I_{h,t}=[e_h;e_t;|e_h-e_t|;e_h\odot e_t;m_{doc};p_{h,t}]</script><p>å…¶ä¸­ï¼Œ$m_{doc}$å°±æ˜¯document nodeï¼Œç„¶åæˆ‘ä»¬å°†å…¶çœ‹ä½œä¸€ä¸ªå¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜ï¼Œä½¿ç”¨sigmoidå‡½æ•°ï¼Œæ¥å®Œæˆåˆ†ç±»ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(r|e_h,e_t)=sigmoid(W_b\sigma(W_aI_{h,t}+b_a)+b_b)</script><p>æœ€ç»ˆçš„lossä½¿ç”¨CEã€‚</p></li></ul><h3 id="Experiment-3"><a href="#Experiment-3" class="headerlink" title="Experiment"></a>Experiment</h3><ol><li><p>æ•°æ®é›†ï¼šDocRED</p></li><li><p>å®éªŒç»“æœ</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/GAIN_result.jpg" alt></p><p>ä»ç»“æœä¸Šçœ‹ï¼ŒGAINçš„æ•ˆæœæ˜¯ä»¤äººæƒŠè‰³çš„ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹ablationï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-Document-level-RE-task/GAIN_result_2.jpg" alt></p><p>ä»æ¶ˆèå®éªŒæ¥çœ‹ï¼Œå¯ä»¥å‘ç°å„ä¸ªæ¨¡å—å¯¹äºç»“æœçš„è¯å½±å“éƒ½æ˜¯éå¸¸å·¨å¤§çš„ï¼Œå¾ˆä¼˜é›…ï¼Œæ²¡æœ‰å¤šä½™çš„è®¾è®¡ã€‚</p><p>ç›®å‰æ¥çœ‹ï¼Œä¸»è¦çš„å¤„ç†ï¼šencodingï¼Ÿæ€ä¹ˆæ„å»ºå›¾ï¼Œæ‰èƒ½å¤Ÿåˆ©ç”¨å¥½mentionã€entityã€sentenceã€documentçš„ä¿¡æ¯ï¼ˆedge-oriented or node-orientedï¼‰ï¼Ÿheterogeneous graphçš„å¤„ç†ï¼Ÿlogical reasoningçš„å¤„ç†ï¼Ÿé•¿æœŸå»ºæ¨¡å¾ˆé‡è¦ï¼Œæ€ä¹ˆæ›´å¥½åœ°å¤„ç†ï¼Ÿ</p></li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>ã€ŠInter-sentence Relation Extraction with Document-level Graph Convolutional Neural Networkã€‹</p><p>codeï¼šè§EoGçš„codeï¼Œå·®ä¸å¤š</p><p>ã€ŠConnecting the Dots: Document-level Neural Relation Extraction with Edge-oriented Graphsã€‹</p><p>codeï¼š<a href="https://github.com/fenchri/edge-oriented-graph" target="_blank" rel="noopener">https://github.com/fenchri/edge-oriented-graph</a></p><p>ã€ŠReasoning with Latent Structure Reï¬nement for Document-Level Relation Extractionã€‹</p><p>codeï¼š<a href="https://github.com/nanguoshun/LSR" target="_blank" rel="noopener">https://github.com/nanguoshun/LSR</a></p><p>ã€ŠDouble Graph Based Reasoning for Document-level Relation Extractionã€‹</p><p>codeï¼š<a href="https://github.com/DreamInvoker/GAIN" target="_blank" rel="noopener">https://github.com/DreamInvoker/GAIN</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å…³ç³»æŠ½å– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Document-level RE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|RE-Integrate GNN into sentence-level RE task</title>
      <link href="2020/10/24/NLP-RE-Integrate-GNN-into-sentence-level-RE-task/"/>
      <url>2020/10/24/NLP-RE-Integrate-GNN-into-sentence-level-RE-task/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£å›¾ç¥ç»ç½‘ç»œåœ¨sentence-levelçš„å…³ç³»æŠ½å–ä»»åŠ¡ä¸­çš„åº”ç”¨ï¼Œå…±è®²è§£ä¸‰ç¯‡paperï¼šã€ŠGraph Neural Networks with Generated Parameters for Relation Extractionã€‹ã€ã€ŠGraphRel: Modeling Text as Relational Graphs for Joint Entity and Relation Extractionã€‹ã€ã€ŠA General Framework for Information Extraction using Dynamic Span Graphsã€‹ã€‚</p><a id="more"></a><h2 id="Graph-Neural-Networks-with-Generated-Parameters-for-Relation-Extraction-ACL2019"><a href="#Graph-Neural-Networks-with-Generated-Parameters-for-Relation-Extraction-ACL2019" class="headerlink" title="Graph Neural Networks with Generated Parameters for Relation Extraction(ACL2019)"></a>Graph Neural Networks with Generated Parameters for Relation Extraction(ACL2019)</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>å›¾ç¥ç»ç½‘ç»œåœ¨å›¾å…³ç³»æ¨ç†ä¸­çš„æ•ˆæœéå¸¸å¼ºå¤§ï¼Œä½†æ˜¯ç›®å‰ä»¥åçš„GNNåªèƒ½åœ¨é¢„å®šä¹‰å¥½çš„å›¾ä¸Šè¿›è¡Œï¼Œæ— æ³•ç›´æ¥åœ¨éç»“æ„åŒ–çš„æ–‡æœ¬ä¸­ç›´æ¥åº”ç”¨ã€‚æ‰€ä»¥åœ¨è¿™ç¯‡paperä¸­ï¼Œå°±æ˜¯é‡‡ç”¨ spectral GCNæ¥è¿›è¡Œaggegateã€‚ä½†æ˜¯è¦ä½¿ç”¨GCNçš„è¯ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªæ¡ä»¶ï¼š1.æœ€å¥½æ˜¯æ— å‘å›¾ï¼Œå¦‚æœæ˜¯æœ‰å‘å›¾çš„è¯ï¼Œåˆ™éœ€è¦å†æ ¹æ®é—®é¢˜è¿›è¡Œè°ƒæ•´ï¼Œå¾ˆéº»çƒ¦ï¼Œä¸€èˆ¬æ˜¯è¦æ±‚æ— å‘å›¾ï¼›2.è¾¹çš„ç±»å‹å¿…é¡»ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯åŒè´¨å›¾ã€‚æ‰€ä»¥é—®é¢˜å°±åœ¨äºï¼šæ€ä¹ˆå»æ„å»ºä¸€ä¸ªæ— å‘å›¾ï¼Ÿæ€ä¹ˆå¾—åˆ°é‚»æ¥çŸ©é˜µï¼Ÿè¿™å°±æ˜¯GPGNNæ‰€è¦è§£å†³çš„é—®é¢˜ã€‚</p><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/24/NLP-RE-Integrate-GNN-into-sentence-level-RE-task/GPGNN_model.jpg" alt></p><p>æ•´ä½“æ¨¡å‹æ¶æ„åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>encoding moduleã€propagation moduleã€classification moduleã€‚</strong></p><ul><li><p><strong>task definitionï¼š</strong>ç»™å®šä¸€ä¸ªsentenceï¼š$s=(x_0,x_1,â€¦,x_{l-1})$ï¼Œrelationçš„é›†åˆï¼š$\cal R$ï¼Œä»¥åŠsentenceä¸­çš„entitesï¼š${\cal V}=\{v_1,v_2,â€¦,v_{|\cal V|}\}$ï¼Œå…¶ä¸­$v_i$ç”±å•ä¸ªæˆ–è€…å¤šä¸ªtokenæ„æˆã€‚æˆ‘ä»¬è¦åšçš„æ˜¯ï¼šå¯¹æ¯ä¸€ä¸ªentity pair $(v_i,v_j)$ï¼Œæˆ‘ä»¬å»å¾—å‡ºå®ƒçš„rleation $r_{v_i,v_j}$ã€‚</p></li><li><p><strong>encoding moduleï¼š</strong>é¦–å…ˆæ ¹æ®textæ¥æ„å»ºå…¨è¿æ¥çš„GNNï¼š$\cal G=(V,E)$ï¼Œæ‰€æœ‰çš„entityå°±æ˜¯nodeã€‚ç„¶åæˆ‘ä»¬å¯¹entity pairè¿›è¡Œencodingï¼Œå¾—åˆ°é‚»æ¥çŸ©é˜µã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">A_{i,j}^{(n)}=[MLP_n(BILSTM_n((E(x_0^{i,j}),E(x_1^{i,j}),...,E(x_{l-1}^{i,j}))))] \\E(x_t^{i,j})=[x_t;p_t^{i,j}] \\</script><p>å…¶ä¸­ï¼Œ$x_t$è¡¨ç¤ºword $x_t$çš„word embedding(é‡‡ç”¨GloVe)ï¼Œ$p_t^{i,j}$è¡¨ç¤ºword $x_t$ç›¸å¯¹äºentity pair $(v_i,v_j)$çš„position embedding(sentneceä¸­çš„æ¯ä¸€ä¸ªtokenè¦ä¹ˆå±äºentity $v_i$ï¼Œè¦ä¹ˆå±äºentity $v_j$ï¼Œè¦ä¹ˆéƒ½ä¸å±äº)ï¼Œæˆ‘ä»¬è¿™ä¸¤è€…è¿›è¡Œconcatï¼Œå¾—å‡ºçš„$E(x_t^{i,j})$è¡¨ç¤ºç›¸å¯¹äºentity pair $(v_i,v_j)$çš„word $x_t$çš„embeddingï¼›$A_{i,j}^{(n)}$è¡¨ç¤ºçš„æ˜¯ç¬¬$n$å±‚çš„entity pair $v_i,v_j$çš„è¾¹çš„å‚æ•°ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå°±æ˜¯é‚»æ¥çŸ©é˜µã€‚</p></li><li><p><strong>propagation moduleï¼š</strong>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯ä¼ ç»Ÿçš„aggregateã€‚ä»ç¬¬$n$å±‚æ›´æ–°åˆ°ç¬¬$n+1$å±‚çš„å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">h_i^{(n+1)}=\sum_{v_j\in {\cal N_{(v_i)}}}\sigma(A^{(n)}_{i,j}h^{(n)}_{j})</script><p>å…¶ä¸­ï¼Œ$\sigma$è¡¨ç¤ºæŸä¸€ç§æ¿€æ´»å‡½æ•°ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼š$h^{(0)}_i$æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿè®ºæ–‡é‡Œçš„æ²¡çœ‹æ‡‚ã€‚ã€‚ã€‚</p></li><li><p><strong>classification moduleï¼š</strong>concatæ‰€æœ‰layerçš„$v_i$ä¸$v_j$çš„è¡¨ç¤ºï¼Œç„¶åä½¿ç”¨softmaxï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">r_{v_i,v_j}=[[h^1_{v_i}\odot h^1_{v_j}];...;h^K_{v_i}\odot h^K_{v_j}]] \\{\cal P}(r_{v_i,v_j}|h,t,s)=softmax(MLP(r_{v_i,v_j})) \\</script><p>æœ€ç»ˆçš„lossä½¿ç”¨CE lossï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">L=\sum_{s\in S}\sum_{i\not=j}log{\cal P}(r_{v_i,v_j}|h,t,s)</script></li></ul><h2 id="GraphRel-Modeling-Text-as-Relational-Graphs-for-Joint-Entity-and-Relation-Extraction-ACL2019"><a href="#GraphRel-Modeling-Text-as-Relational-Graphs-for-Joint-Entity-and-Relation-Extraction-ACL2019" class="headerlink" title="GraphRel: Modeling Text as Relational Graphs for Joint Entity and Relation Extraction(ACL2019)"></a>GraphRel: Modeling Text as Relational Graphs for Joint Entity and Relation Extraction(ACL2019)</h2><h3 id="background-1"><a href="#background-1" class="headerlink" title="background"></a>background</h3><h3 id="model-1"><a href="#model-1" class="headerlink" title="model"></a>model</h3><h3 id="experiment"><a href="#experiment" class="headerlink" title="experiment"></a>experiment</h3><h2 id="A-General-Framework-for-Information-Extraction-using-Dynamic-Span-Graphs-NAACL2019"><a href="#A-General-Framework-for-Information-Extraction-using-Dynamic-Span-Graphs-NAACL2019" class="headerlink" title="A General Framework for Information Extraction using Dynamic Span Graphs(NAACL2019)"></a>A General Framework for Information Extraction using Dynamic Span Graphs(NAACL2019)</h2><h3 id="background-2"><a href="#background-2" class="headerlink" title="background"></a>background</h3><h3 id="model-2"><a href="#model-2" class="headerlink" title="model"></a>model</h3><h3 id="experiment-1"><a href="#experiment-1" class="headerlink" title="experiment"></a>experiment</h3><h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p>ã€ŠGraph Neural Networks with Generated Parameters for Relation Extractionã€‹</p><p>ã€ŠGraphRel: Modeling Text as Relational Graphs for Joint Entity and Relation Extractionã€‹</p><p>ã€ŠA General Framework for Information Extraction using Dynamic Span Graphsã€‹</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å…³ç³»æŠ½å– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Sentence-level RE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|RE-DocRED and SCIREX Dataset</title>
      <link href="2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/"/>
      <url>2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹Document-level å…³ç³»æŠ½å–ä¸Šçš„æœ€æ–°çš„ä¸¤ä¸ªæ•°æ®é›†ï¼šDocREDä»¥åŠSCIREXï¼Œpaperåç§°ï¼šã€ŠDocRED: A Large-Scale Document-Level Relation Extraction Datasetã€‹ã€ã€ŠSCIREX: A Challenge Dataset for Document-Level Information Extractionã€‹ã€‚</p><a id="more"></a><h2 id="DocRED-dataset"><a href="#DocRED-dataset" class="headerlink" title="DocRED dataset"></a>DocRED dataset</h2><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>DocREDæ•°æ®é›†æ˜¯å‘è¡¨åœ¨ACL2019ä¸Šçš„ã€ŠDocRED: A Large-Scale Document-Level Relation Extraction Datasetã€‹ã€‚å…³ç³»æŠ½å–æ˜¯NLPä¸­ä¸€ä¸ªéå¸¸åŸºç¡€ä¸”é‡è¦çš„ä»»åŠ¡ï¼Œä¸»è¦æ˜¯ï¼šè¾¨åˆ«textä¸­å®ä½“ä¹‹é—´çš„relation factsã€‚ä½†æ˜¯åœ¨ç›®å‰çš„relation extractionä¸­ï¼Œä¸»è¦éƒ½æ˜¯é›†ä¸­åœ¨sentence-levelä¸Šï¼Œä¹Ÿå°±æ˜¯æå–å¥å­å†…çš„å®ä½“ï¼Œå¹¶è¯†åˆ«å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ä½†æ˜¯åœ¨å®é™…çš„é—®é¢˜å½“ä¸­ï¼Œå¾ˆå¤šå®ä½“ä¹‹é—´çš„å…³ç³»éœ€è¦é€šè¿‡å¤šä¸ªå¥å­æ¥è·å¾—ï¼Œæ‰€ä»¥å°†sentence-levelçš„raltion extractionæ‰©å±•åˆ°document-level çš„relation extractionæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚è€Œç›®å‰å·²æœ‰çš„document-levelçš„æ•°æ®é›†ï¼Œè¦ä¹ˆæ•°æ®é‡ä¸å¤Ÿå¤§ï¼Œè¦ä¹ˆæœ‰å¾ˆå¤šçš„å™ªéŸ³ï¼Œè¦ä¹ˆæ„é€ çš„æ•°æ®é›†åªé€‚ç”¨äºæŸä¸€ä¸ªé¢†åŸŸï¼Œè¿™å¯¹äºæ„å»ºgeneral domainä¸‹çš„document-level relation extraction modelæ˜¯ä¸åˆ©çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±æœ‰äº†DocREDã€‚</p><h3 id="Statistics-of-DocRED"><a href="#Statistics-of-DocRED" class="headerlink" title="Statistics of DocRED"></a>Statistics of DocRED</h3><p>DocREDæ˜¯æ ¹æ®wikipediaå’Œwikidataæ„å»ºè€Œæ¥ï¼Œæœ€åDocREDçš„å„é¡¹æ•°å€¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/statistic_docred.jpg" alt></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨DocREDä¸­ï¼Œå¹³å‡æ¯ä¸€ä¸ªdocumentçš„wordå¤§æ¦‚åœ¨198.2ï½209.7ä¹‹é—´ï¼Œè¯´å®è¯ï¼Œè¿™ä¸ªç¨‹åº¦å…¶å®åªèƒ½ç®—æ˜¯paragraphï¼Œç¦»documentè¿˜å·®çš„æ¯”è¾ƒè¿œï¼Œè¿™ä¸€ç‚¹SCIREXæ•°æ®é›†å¼¥è¡¥äº†(å¹³å‡æœ‰5000å·¦å³)ã€‚</p><h3 id="Baseline"><a href="#Baseline" class="headerlink" title="Baseline"></a>Baseline</h3><p>paperä¸­å®éªŒäº†å½“æ—¶SOTAçš„ä¸‰ç§æ¨¡å‹ã€‚å¤§è‡´çš„è¿‡ç¨‹æ˜¯ï¼šé¦–å…ˆå¯¹äºä¸€ç¯‡doucmentè¡¨ç¤ºä¸ºï¼š$\cal D=\{w_i\}_{i=1}^{n}$ï¼Œå…¶ä¸­$w_i$è¡¨ç¤ºç¬¬$i$ä¸ªwordï¼Œæˆ‘ä»¬å°†å…¶è¾“å…¥åˆ°CNN/LSTM/BILSTMå½“ä¸­ï¼Œå¾—åˆ°encoderåçš„$\{h_i\}_{i=1}^{n}$ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ°entitiesçš„representationï¼Œæœ€åé¢„æµ‹æ¯ä¸€ä¸ªentity pairçš„relation typeã€‚ä¸‹é¢è®²è§£ä¸€äº›detailsï¼š</p><ul><li><p><strong>word featuresï¼š</strong>å¯¹äºsentenceä¸­çš„æ¯ä¸€ä¸ªwordï¼Œå®ƒçš„feature=[GloVe_word_embedding; entity_type_embedding; coreferance_embedding]â€‹ã€‚</p></li><li><p><strong>named entity mention representationï¼š</strong>è¿™é‡Œéœ€è¦æ˜ç¡®named entity mentionä¸entityçš„åŒºåˆ«ã€‚named entity mentionæŒ‡çš„æ˜¯ä¸entityç›¸å…³çš„wordçš„é›†åˆï¼ŒåŒ…æ‹¬æŒ‡ä»£ã€ç¼©å†™ã€nicknameç­‰ç­‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼š<code>åŒ—äº¬å¤§å­¦</code>æ˜¯ä¸€ä¸ªentityï¼Œå®ƒçš„named entity mentionå¯ä»¥æœ‰ï¼š<code>åŒ—å¤§</code>ã€<code>på¤§</code>ã€<code>è´µæ ¡</code>ã€<code>ä½ åŒ—</code> ã€<code>éš”å£</code>ç­‰ç­‰ã€‚é‚£ä¹ˆåœ¨relation extractionä¸­ï¼Œæˆ‘ä»¬è¦åšçš„recognize named entity mentionsã€‚å½“æˆ‘ä»¬identity named entity mentionsåï¼Œæˆ‘ä»¬æ€ä¹ˆè¡¨ç¤ºentityå‘¢ï¼Ÿentity $e_i$å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">e_i=\frac {1}{K}\sum_{i=1}^{K}m_k \\m_k=\frac{1}{t-s+1}\sum_{j=t}^{s}h_j</script><p>å…¶ä¸­ï¼Œ$K$è¡¨ç¤ºentity $e_i$æ‰€æœ‰çš„mentionsçš„æ•°é‡ï¼Œ$m_k$è¡¨ç¤ºç¬¬$k$ä¸ªmentionï¼Œtä¸sæ˜¯ç¬¬$K$ä¸ªmentionçš„å¼€å¤´ä¸ç»“å°¾çš„indexã€‚</p></li><li><p><strong>predictionï¼š</strong>å¯¹äºrelation extractionï¼Œæˆ‘ä»¬æ˜¯å°†å…¶è§†ä¸ºä¸€ä¸ªå¤šæ ‡ç­¾åˆ†ç±»çš„é—®é¢˜ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯sigmoidå‡½æ•°ï¼Œå¯¹äºæ¯ä¸€ä¸ªentity pair $(e_i,e_j)$ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\tilde e_i=[e_i;E(d_{ij})], \ \tilde e_j=[e_j;E(d_{ji})] \\P(r|e_i,e_j)=sigmoid(\tilde e_i^TW_r\tilde e_j+b_r)</script><p>å…¶ä¸­ï¼Œ$d_{ij}$ä¸$d_{ji}$è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªentityåœ¨documentä¸­ç¬¬ä¸€ä¸ªmentionä¹‹é—´çš„ç›¸å¯¹è·ç¦»ï¼Œ$E$æ˜¯ä¸€ä¸ªembedding matrixã€‚</p></li></ul><h3 id="experiment"><a href="#experiment" class="headerlink" title="experiment"></a>experiment</h3><p>å…ˆæ”¾ç»“æœï½</p><p><img src="/2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/result_docred.jpg" alt></p><p><img src="/2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/human_perfance_docred.jpg" style="zoom:50%;"></p><ul><li>å¯¹äºDocREDï¼Œè¯„ä»·æŒ‡æ ‡é‡‡ç”¨çš„æ˜¯F1å’ŒAUCï¼Œä½†æ˜¯ä¸ºäº†é¿å…è®­ç»ƒé›†ä¸éªŒè¯é›†/æµ‹è¯•é›†ä¸Šrelation factsçš„overlapï¼Œæ‰€ä»¥åˆæå‡ºäº†Ign F1å’ŒIgn AUCæŒ‡æ ‡ï¼Œä»¥è·å¾—æ›´å¥½çš„æ•ˆæœã€‚</li><li>ä»ä¸Šé¢çš„è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰çš„baselineçš„æ•ˆæœä¸humançš„performanceç›¸å»ç”šè¿œï¼Œè¿˜æœ‰å¾ˆå¤§çš„å¯ä»¥æé«˜çš„ç©ºé—´ã€‚</li><li>åœ¨DocREDä¸­ï¼Œé™¤äº†å…³ç³»åˆ†ç±»ä»»åŠ¡ï¼Œè¿˜æå‡ºäº†å¦ä¸€ä¸ªå­ä»»åŠ¡â€”â€”identity å…³ç³»å®ä¾‹(relation instances)å’Œæ”¯æŒè¯æ®(supporting envidences)ï¼Œç”¨äºè¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</li><li>æ€»çš„æ¥çœ‹ï¼ŒDocREDæ˜¯ä¸€ä¸ªgeneral domain document-level relation extraction datasetsï¼Œç›®å‰å·²æœ‰çš„æ–¹æ³•çš„æ•ˆæœä¸human performanceç›¸å»ç”šè¿œï¼Œæœ‰å¾ˆå¤§çš„æå‡ç©ºé—´ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥åšçš„æ–¹å‘ã€‚</li></ul><h3 id="Data-format"><a href="#Data-format" class="headerlink" title="Data format"></a>Data format</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#39;title&#39;,</span><br><span class="line">  &#39;sents&#39;:     [</span><br><span class="line">                  [word in sent 0],</span><br><span class="line">                  [word in sent 1]</span><br><span class="line">               ]</span><br><span class="line">  &#39;vertexSet&#39;: [</span><br><span class="line">                  [</span><br><span class="line">                    &#123; &#39;name&#39;: mention_name, </span><br><span class="line">                      &#39;sent_id&#39;: mention in which sentence, </span><br><span class="line">                      &#39;pos&#39;: postion of mention in a sentence, </span><br><span class="line">                      &#39;type&#39;: NER_type&#125;</span><br><span class="line">                    &#123;anthor mention&#125;</span><br><span class="line">                  ], </span><br><span class="line">                  [anthoer entity]</span><br><span class="line">                ]</span><br><span class="line">  &#39;labels&#39;:   [</span><br><span class="line">                &#123;</span><br><span class="line">                  &#39;h&#39;: idx of head entity in vertexSet,</span><br><span class="line">                  &#39;t&#39;: idx of tail entity in vertexSet,</span><br><span class="line">                  &#39;r&#39;: relation,</span><br><span class="line">                  &#39;evidence&#39;: evidence sentences&#39; id</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SCIREX-dataset"><a href="#SCIREX-dataset" class="headerlink" title="SCIREX dataset"></a>SCIREX dataset</h2><h3 id="Background-1"><a href="#Background-1" class="headerlink" title="Background"></a>Background</h3><p>SCIREXæ•°æ®é›†æ˜¯å‘è¡¨åœ¨ACL2020ä¸Šçš„ã€ŠSCIREX: A Challenge Dataset for Document-Level Information Extractionã€‹ã€‚å®ƒæå‡ºçš„ä¸»è¦èƒŒæ™¯ä¸DocREDç±»ä¼¼ï¼Œç›®å‰ä¸»è¦çš„relation extractionä¸»è¦éƒ½æ˜¯å›´ç»•ç€sentence-levelè¿›è¡Œçš„ï¼Œä½†æ˜¯å®é™…é—®é¢˜ä¸­ï¼Œentityä¹‹é—´çš„relationå¾€å¾€è¦é€šè¿‡å¤šä¸ªsentence æ¨ç†å¾—åˆ°ï¼Œè€Œé’ˆå¯¹sentence-levelçš„modelæ— æ³•å¤„ç†è¿™ç§é—®é¢˜ï¼Œæ‰€ä»¥æœ‰å¿…è¦å°†sentence-levelæ‰©å±•åˆ°document-level relation extraction/information extractionã€‚è€Œç›®å‰å·²æœ‰çš„document-level information extraction datasetsï¼Œè¿œè¿œä¸èƒ½æ»¡è¶³document-level IE/REçš„è¦æ±‚ï¼Œæœ€æ¥è¿‘çš„æ˜¯DocREDæ•°æ®é›†ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®é›†æ˜¯ä»wikipiedia paragraphä¸­æ„å»ºçš„ï¼Œæ‰€ä»¥å®ƒçš„é•¿åº¦è¿œè¿œä¸èƒ½è¾¾åˆ°documentçš„è¦æ±‚(DocREDå¤§çº¦åœ¨200 word/doc)ï¼Œæ‰€ä»¥å°±æœ‰äº†SICREXã€‚</p><h3 id="Statistics-of-SCIREX"><a href="#Statistics-of-SCIREX" class="headerlink" title="Statistics of SCIREX"></a>Statistics of SCIREX</h3><p>SCIREXæ˜¯æ ¹æ®scientific articlesæ„å»ºè€Œæ¥ï¼Œå…·ä½“æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/scirex.jpg" style="zoom:50%;"></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çŸ¥é“ï¼ŒSCIREXæ•°æ®é›†æ¯ä¸€ç¯‡documentæœ‰5737ä¸ªwordï¼Œæ¯”DocREDä¸­çš„documenté•¿çš„å¤šï¼Œå¯ä»¥è¯´æ˜¯çœŸçš„documentäº†ï¼›æ­¤å¤–ï¼ŒSCIREXå…±æœ‰438ç¯‡documentï¼Œè™½ç„¶ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æ˜¯ä»æ€»çš„wordæ¥è¯´ï¼ŒSCIREXçš„wordæ•°ç›®æ˜¯DocREDçš„2å€(human-annotated version)ã€‚</p><h3 id="Tasks-in-SICREX"><a href="#Tasks-in-SICREX" class="headerlink" title="Tasks in SICREX"></a>Tasks in SICREX</h3><p>åœ¨SCIREXæ•°æ®é›†ä¸­ï¼Œä½œè€…å®šä¹‰äº†å››ç§ä»»åŠ¡ï¼š<strong>entity recognitionã€salient entity recognitionã€coreferenceã€relation extractionã€‚</strong></p><ul><li><strong>entity recognitionï¼š</strong>è¿™ä¸ªå…¶å®å’ŒDocREDä¸­çš„named entity mention recognitionæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡åˆæœ‰ç‚¹ä¸å¤ªä¸€æ ·ã€‚åœ¨SCIREXä¸­ï¼Œå…±æœ‰å››ç§entityï¼šMethodã€Taskã€Metricã€Datasetï¼Œå„è‡ªçš„mentionsæ˜¯è¿™å››ç§entityçš„å„ç§mention(å¥½åƒå’Œæ²¡è¯´ä¸€æ ·ğŸ¤£ï¼Œè¿™ä¸ªåœ¨DocREDçš„ä»‹ç»é‡Œæœ‰çš„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°)ã€‚æ€»ä¹‹è¿™ä¸ªä»»åŠ¡æ˜¯ï¼šè¯†åˆ«å„ç§entity mentionså¹¶åˆ†ç±»åˆ°å„è‡ªçš„entity typeä¸­ã€‚</li><li><strong>salient entity recognitionï¼š</strong>ç”±äºå‡ºç°åœ¨documentä¸­çš„æ¯ä¸€ä¸ªentity mentionsçš„é‡è¦æ€§ç¨‹åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚å°±æ¯”å¦‚relation workä¸­æåˆ°çš„taskç›¸æ¯”äºæ–‡ç« ä¸»ä½“çš„taskï¼Œé‡è¦æ€§è¦å°çš„å¤šï¼Œæ‰€ä»¥å°±æœ‰å¿…è¦è¿›è¡Œsalient entity recognitionã€‚</li><li><strong>coreferenceï¼š</strong>è¿™ä¸ªä»»åŠ¡æ˜¯identityåœ¨å•ç¯‡documentä¸­æŒ‡å‘åŒä¸€ä¸ªentityçš„mentionsçš„é›†åˆ(cluster)ã€‚</li><li><strong>relation extractionï¼š</strong>REæ˜¯æŒ‡åœ¨å•ç¯‡documentä¸­æå–entitiesä¹‹é—´Nå…ƒå…³ç³»çš„ä»»åŠ¡ã€‚åœ¨SCIREXä¸­ï¼Œæœ‰2å…ƒå…³ç³»ã€ä¸‰å…ƒå…³ç³»ä»¥åŠå››å…ƒå…³ç³»ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨SCIREXä¸­ï¼ŒN-å…ƒå…³ç³»ä¸èƒ½è¢«åˆ‡åˆ†ä¸ºå¤šä¸ªäºŒå…ƒå…³ç³»ï¼Œå› ä¸ºä¸€ä¸ªDatasetså¯èƒ½ä¼šæœ‰å¤šä¸ªTaskï¼Œä¸€ä¸ªä»»åŠ¡å¯èƒ½ä¼šæœ‰å¤šç§Metricï¼Œæ‰€ä»¥metricä¸èƒ½ä»…ä»…æ ¹æ®Datasetæˆ–è€…Taskæ¥å†³å®šã€‚</li></ul><h3 id="Baseline-1"><a href="#Baseline-1" class="headerlink" title="Baseline"></a>Baseline</h3><p>SCIREXä¸­ç»™å‡ºäº†ä¸€ä¸ªéå¸¸å¼ºçš„Baselineï¼Œä½†æ˜¯æˆ‘ä¸ªäººè§‰å¾—æ¯”è¾ƒé—æ†¾çš„æ˜¯ï¼Œè¿™ç¯‡paperæ²¡æœ‰ç»™å‡ºhuman performanceï¼Œä¸çŸ¥é“up boundæ˜¯æ€ä¹ˆæ ·çš„ã€‚baselineå…·ä½“å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/scirex-model.jpg" alt></p><ul><li><p><strong>Document representationï¼š</strong>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªè¾“å…¥çš„æ–‡æ¡£$\cal D$è¡¨ç¤ºä¸ºï¼š$[s_1,â€¦,s_{|S|}]$ï¼Œå…¶ä¸­$s_i$è¡¨ç¤ºç¬¬iä¸ªsection(sectionå¯ä»¥ç†è§£ä¸ºparagraph)ï¼Œå…±æœ‰$|S|$ä¸ªsectionã€‚document encodingåˆ†ä¸ºä¸¤æ­¥ï¼šsection-level and document-levelã€‚æ¯ä¸€ä¸ªsectionçš„tokens embeddingé€šè¿‡SCIBERTæ¥å¾—åˆ°ï¼Œæ¯ä¸€ä¸ªsection-level token embeddingçš„ç»´åº¦æ˜¯ï¼š[tokens_nums,embedding_dim]ï¼Œå¾—åˆ°ä¹‹åï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰çš„section-level token embeddingè¿›è¡Œconcatï¼Œç»´åº¦æ˜¯ï¼š[|S|*tokens_nums,embedding_dim]ï¼Œç„¶åè¾“å…¥åˆ°ä¸€ä¸ªBILSTMå½“ä¸­ï¼Œå¾—åˆ°ç»“æœ$e_iï¼Œi\in\{1,..,|S|\}$ã€‚æ³¨æ„å¦‚æœæ˜¯batchè¾“å…¥çš„è¯ï¼Œç»è¿‡BILSTMçš„å¾—åˆ°çš„ç»´åº¦æ˜¯ï¼š[batch_size,|S|*token_nums,embedding_dim]ã€‚</p></li><li><p><strong>Mention identification and classificationï¼š</strong>åœ¨å¾—åˆ°token embeddingä¹‹åï¼Œç»è¿‡BILSTM+CRFï¼Œå»å¯¹mentionsè¿›è¡Œidentificationä¸classificationã€‚</p></li><li><p><strong>Mention representationï¼š</strong>å¾—åˆ°mentionsä¹‹åï¼Œæˆ‘ä»¬å°±è¦æ‰§è¡Œä¹‹åçš„<strong>salient mention classification</strong>ä¸<strong>relation extraction</strong>ä»»åŠ¡ï¼Œä½†æ˜¯è¦æ‰§è¡Œè¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œéœ€è¦å…ˆå¾—åˆ°mention embeddingã€‚é‚£ä¹ˆå¯¹äºä¸€ä¸ªmention $m_j$ï¼Œå®ƒçš„representationæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿå…·ä½“å¦‚ä¸‹ï¼š</p><p>å¯¹äºä¸€ä¸ªmention $m_j$,ä»–æ‰€åŒ…å«çš„wordsè¡¨ç¤ºä¸ºï¼š$\{w_{j_1},w_{j_2},â€¦,w_{j_N}\}$ï¼Œ$m_j$çš„mention embeddingæ˜¯ï¼š</p><script type="math/tex; mode=display">me_j=[e_{j_1};e_{j_N};\sum_{k=1}^{N}\alpha_{j_k}e_{j_k}]</script><p>$e_{j_1}$ä¸$e_{j_n}$åˆ†åˆ«è¡¨ç¤ºè¯¥mentionçš„first wordä¸last wordçš„token embeddingã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šå°†spanåœ¨æ–‡æ¡£ä¸­çš„ç›¸å¯¹ä½ç½®ä¿¡æ¯åŠ å…¥åˆ°å…¶ä¸­ï¼Œä»¥è·å¾—æ›´å¤šçš„ä¿¡æ¯ã€‚</p></li><li><p><strong>Salient mention classificationï¼š</strong>è¿™ä¸ªä»»åŠ¡å°±æ˜¯å»çœ‹æ¯ä¸€ä¸ªmentionæ˜¯ä¸æ˜¯salientï¼Œæ˜¯ä¸€ä¸ªäºŒåˆ†ç±»çš„ä»»åŠ¡ã€‚</p></li><li><p><strong>Pairwise coreference resolutionï¼š</strong>è¿™ä¸ªä»»åŠ¡å°±æ˜¯è®¡ç®—æ¯ä¸€å¯¹mention pair$(m_i,m_j)$çš„coreference score $c_{ij}$ã€‚</p></li><li><p><strong>Mention clusteringï¼š</strong>ç»™å®šmention pairçš„é›†åˆï¼Œä»¥åŠä»–ä»¬å¯¹åº”çš„coreference scoreï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œå±‚æ¬¡èšç±»ï¼Œæ¯ä¸€ä¸ªclusteréƒ½è¡¨ç¤ºä¸€ä¸ªentityã€‚</p></li><li><p><strong>Salient entity cluster classificationï¼š</strong>è¿™ä¸€æ­¥åœ¨ä¸Šä¸€æ­¥çš„mention clusteringçš„åŸºç¡€ä¸Šï¼Œè¿‡æ»¤æ‰é‚£äº›ä¸å¤Ÿsalientçš„clusterï¼Œåªç•™ä¸‹salientçš„clusterï¼Œä»è€Œç”¨äºæœ€åçš„relation extraction taskã€‚å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿpaperé‡Œé¢é‡‡ç”¨äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯åªè¦è¿™ä¸ªclusteré‡Œé¢å‡ºç°äº†ä¸€ä¸ªsalient mentionï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªclusteræ˜¯salientï¼Œå°±ä¿ç•™è¯¥clusterã€‚è¿™ä¸€æ­¥æœ€ç»ˆçš„è¾“å‡ºclusterçš„é›†åˆï¼š$C=\{C_1,..,C_L\}$ï¼Œå…¶ä¸­$C_i$æ˜¯åŒä¸€ä¸ªtypeçš„mentionçš„é›†åˆã€‚</p></li><li><p><strong>Relation extractionï¼š</strong>è¿™æ˜¯æœ€ç»ˆçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸Šè¿°çš„salient clusterï¼Œæ„å»ºæ‰€æœ‰clusterçš„äºŒå…ƒç»„å’Œå››å…ƒç»„ï¼Œç„¶åæˆ‘ä»¬è¦åˆ¤æ–­è¿™äº›äºŒå…ƒç»„ä¸å››å…ƒç»„æ˜¯å¦åœ¨documentä¸­expressed or not expressedã€‚æ€ä¹ˆåšå‘¢ï¼Ÿè¿™é‡Œä»¥å››å…ƒç»„ä¸ºä¾‹ï¼š</p><p>å‡è®¾å¯¹äºä¸€ä¸ªå››å…ƒç»„ï¼š$R=(C_1,C_2,C_3,C_4)$ï¼Œå…¶ä¸­$C_i$è¡¨ç¤ºä¸€ä¸ªclusterï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªtwo-stepçš„precedureæ¥è·å¾— Rçš„vectorï¼šé¦–å…ˆæ„å»ºä¸€ä¸ªsection embeddingï¼Œç„¶åaggregate æ‰€æœ‰çš„section embeddingï¼Œä»è€Œå¾—åˆ°document embeddingã€‚å¯¹äº$\forall C_i \in R$ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡max-pooling å‡ºç°åœ¨section $s$ ä¸­çš„$C_i$ä¸­çš„mentionsçš„span embeddingï¼Œä»è€Œå¾—åˆ°$C_i$åœ¨section $s$çš„section embedding $E^s_i$ã€‚relation $R$åœ¨section $s$çš„section embeddingæ˜¯ï¼š$E^s_R=FFN([E^s_1,E^s_2,E^s_3,E^s_4])$ï¼›ç„¶årelation $R$çš„document embeddingæ˜¯ï¼š$E_R=\frac{1}{|S|}\sum_{s=1}^{|S|}E^s_R$ã€‚æœ€ç»ˆçš„åˆ†ç±»æ˜¯å°†$E_R$è¾“å…¥åˆ°å¦ä¸€ä¸ªFFNå±‚ï¼Œç„¶åè¿›è¡Œåˆ†ç±»ã€‚lossä¸ºbinary CEã€‚</p></li></ul><h3 id="experiment-1"><a href="#experiment-1" class="headerlink" title="experiment"></a>experiment</h3><p><img src="/2020/10/24/NLP-RE-DocRED-and-SCIREX-Dataset/scirex_result_1.jpg" alt></p><p>å·¦å›¾æ˜¯æœ¬æ–‡æå‡ºçš„æ¨¡å‹ä¸DYGIE++æ¨¡å‹åœ¨å„ä¸ªå­ä»»åŠ¡ä¸Šè¿›è¡Œå¯¹æ¯”ï¼Œå³å›¾æ˜¯æœ¬æ–‡æå‡ºçš„æ¨¡å‹çš„å„ä¸ªå­ä»»åŠ¡ä¸Šçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé‡‡ç”¨ç«¯åˆ°ç«¯çš„çƒ¦äº‹ï¼Œæœ€ç»ˆçš„relation extractionçš„ç»“æœéå¸¸ä½ï¼Œè€Œé‡‡ç”¨glod inputçš„ç»“æœï¼Œè¦é«˜å¾—å¤šï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°<strong>salient entity cluster classification</strong>æ˜¯æ•´ä¸ªç«¯åˆ°ç«¯ç³»ç»Ÿçš„å½±å“æœ€å¤§çš„ä¸€æ­¥ã€‚æ„Ÿè§‰è¿˜æ˜¯æœ‰å¾ˆå¤§æå‡ç©ºé—´çš„ã€‚</p><h3 id="Data-format-1"><a href="#Data-format-1" class="headerlink" title="Data format"></a>Data format</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;doc_id&quot; : str &#x3D; Document Id as used by Semantic Scholar,</span><br><span class="line">    &quot;words&quot; : List[str] &#x3D; List of words in the document,</span><br><span class="line">    &quot;sentences&quot; : List[Span] &#x3D; Spans indexing into words array that indicate sentences,</span><br><span class="line">    &quot;sections&quot; : List[Span] &#x3D; Spans indexing into words array that indicate sections,</span><br><span class="line">    &quot;ner&quot; : List[TypedMention] &#x3D; Typed Spans indexing into words indicating mentions ,</span><br><span class="line">    &quot;coref&quot; : Dict[EntityName, List[Span]] &#x3D; Salient Entities in the document and mentions belonging to it,</span><br><span class="line">    &quot;n_ary_relations&quot; : List[Dict[EntityType, EntityName]] &#x3D; List of Relations where each Relation is a dictionary with 5 keys (Method, Metric, Task, Material, Score),</span><br><span class="line">    &quot;method_subrelations&quot; : Dict[EntityName, List[Tuple[Span, SubEntityName]]] &#x3D; Each Methods may be subdivided into simpler submethods and Submenthods in coref array. For example, DLDL+VGG-Face is broken into two methods DLDL , VGG-Face.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Span &#x3D; Tuple[int, int] # Inclusive start and Exclusive end index</span><br><span class="line">TypedMention &#x3D; Tuple[int, int, EntityType]</span><br><span class="line">EntityType &#x3D; Union[&quot;Method&quot;, &quot;Metric&quot;, &quot;Task&quot;, &quot;Material&quot;]</span><br><span class="line">EntityName &#x3D; str</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>ã€ŠDocRED: A Large-Scale Document-Level Relation Extraction Datasetã€‹</p><p>codeï¼š<a href="https://github.com/thunlp/DocRED" target="_blank" rel="noopener">https://github.com/thunlp/DocRED</a></p><p>ã€ŠSCIREX: A Challenge Dataset for Document-Level Information Extractionã€‹</p><p>codeï¼š<a href="https://github.com/allenai/SciREX" target="_blank" rel="noopener">https://github.com/allenai/SciREX</a></p><p><a href="https://blog.csdn.net/qq_38556984/article/details/108835600" target="_blank" rel="noopener">https://blog.csdn.net/qq_38556984/article/details/108835600</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å…³ç³»æŠ½å– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> DocRED </tag>
            
            <tag> SCIREX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|Multimodal NER</title>
      <link href="2020/10/21/NLP-Multimodal-NER/"/>
      <url>2020/10/21/NLP-Multimodal-NER/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è§£è¯»ä¸€ä¸‹ç›®å‰å¤šæ¨¡æ€NERä¸Šè´¨é‡æ¯”è¾ƒå¥½çš„è®ºæ–‡ï¼šã€ŠAdaptive Co-Attention Network for Named Entity Recognition in Tweetsã€‹ã€ã€ŠVisual Attention Model for Name Tagging in Multimodal Social Mediaã€‹ã€ã€ŠMultimodal Named Entity Recognition for Short Social Media Postsã€‹ã€ã€ŠImproving Multimodal Named Entity Recognition via Entity Span Detection with Uniï¬ed Multimodal Transformerã€‹ã€‚</p><a id="more"></a><h2 id="Adaptive-Co-Attention-Network-for-Named-Entity-Recognition-in-Tweets-AAAI2018"><a href="#Adaptive-Co-Attention-Network-for-Named-Entity-Recognition-in-Tweets-AAAI2018" class="headerlink" title="Adaptive Co-Attention Network for Named Entity Recognition in Tweets(AAAI2018)"></a>Adaptive Co-Attention Network for Named Entity Recognition in Tweets(AAAI2018)</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>NERæ˜¯NLPæœ€åŸºç¡€ä¸”é‡è¦çš„ä»»åŠ¡ä¹‹ä¸€ï¼Œä½†æ˜¯ä¼ ç»Ÿçš„NERéƒ½æ˜¯åªé’ˆå¯¹ä¸textual contentè¿›è¡Œå»ºæ¨¡ã€‚åœ¨ç¤¾äº¤åª’ä½“ä¸Šï¼Œ<strong>å¾ˆå¤šçš„æ¨æ–‡éƒ½æ˜¯æ–‡å­—+å›¾ç‰‡çš„å½¢å¼ï¼Œå¹¶ä¸”ç¤¾äº¤åª’ä½“ä¸Šçš„æ–‡å­—å¾€å¾€æ¯”è¾ƒå£è¯­åŒ–ã€è¯­æ³•ä¹Ÿæ¯”è¾ƒinformalã€å­—æ•°æ¯”è¾ƒå°‘ã€å¾ˆå¤šæ–‡å­—å†…å®¹åªæœ‰ç»“åˆimageæ‰èƒ½ç†è§£ï¼Œ</strong>å•çº¯å¯¹textè¿›è¡Œå»ºæ¨¡ï¼Œå¾€å¾€å¾—ä¸åˆ°å¾ˆå¥½çš„ç»“æœï¼Œè€Œimageå¯¹äºNERæä¾›äº†å¾ˆå¥½çš„è¾…åŠ©ä¿¡æ¯ï¼Œæ‰€ä»¥å¦‚ä½•åˆ©ç”¨imageä¿¡æ¯æ¥è¿›è¡ŒNERï¼Œæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ã€‚è¿™ç¯‡paperæ­£æ˜¯é’ˆå¯¹è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæ„å»ºäº†twitteræ•°æ®é›†ï¼Œå¹¶æå‡ºäº†ACNæ¨¡å‹ã€‚</p><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/21/NLP-Multimodal-NER/ACN_model.jpg" alt></p><p>ACNæ¨¡å‹ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>feature extractorã€adaptive co-attention netowrkã€CRF tagging</strong>ã€‚</p><ul><li><p><strong>feature extractorï¼š</strong>è¿™ä¸€éƒ¨åˆ†åˆ†ä¸ºä¸¤ä¸ªå°éƒ¨åˆ†ï¼šimage feature extractionä¸text feature extractionã€‚</p><ul><li>å¯¹äºimageï¼Œé‡‡ç”¨VGG16æ¥å¯¹iamgeè¿›è¡Œencodingï¼Œæˆ‘ä»¬æŠ½å–æœ€åä¸€å±‚çš„è¾“å‡ºä½œä¸ºimageçš„representationï¼Œè¡¨ç¤ºä¸ºï¼š$\tilde v_I=\{\tilde v_i|\tilde v_i\in R^{d_v},i=1,â€¦,N\}$ï¼Œå…¶ä¸­$d_v$è¡¨ç¤ºæ¯ä¸€ä¸ªregionçš„ç»´åº¦ï¼Œå…±æœ‰7x7ä¸ªregionï¼Œå³ï¼š$N=49$ï¼Œæ‰€ä»¥ä¸€å¼ imageè¾“å‡ºçš„ç»´åº¦æ˜¯ï¼š$N\times d_v$ã€‚ä¸ºäº†èƒ½å¤Ÿä¸ä¹‹åçš„textè¿›è¡Œäº¤äº’ï¼Œç»´åº¦ä¸textç›¸åŒï¼Œå¯¹å…¶è¿›è¡Œäº†éçº¿æ€§å˜æ¢ï¼Œå¹¶ä½¿ç”¨tanhè¿›è¡Œæ¿€æ´»ï¼Œå¾—ï¼š$v_I=tanh(W_I\tilde v_I+B+I)$ï¼Œ$v_I$æ˜¯æœ€ç»ˆçš„imageçš„representationã€‚</li><li>å¯¹äºtextï¼Œæ˜¯character-level word embeddingä¸word embeddingçš„concatã€‚é¦–å…ˆæ˜¯character embeddingï¼Œä½¿ç”¨å¤šä¸ªä¸åŒçš„cnnæ¥å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œå¹¶ä½¿ç”¨tanhè¿›è¡Œæ¿€æ´»ï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªç»“æœä½¿ç”¨max-over-time poolingï¼Œæœ€åå…¨éƒ¨è¿›è¡Œconcat(å¸¸è§„æ“ä½œäº†ï¼Œæ²¡å•¥æ–°é¢–çš„ã€‚)ï¼Œå¾—åˆ°character-level word embeddingï¼š$w^{â€˜}$ï¼›å°†$w^{â€˜}$ä¸$w^{â€˜â€™}$è¿›è¡Œconcatï¼Œå¾—åˆ°$w$ï¼Œå°†$w$è¾“å…¥åˆ°BILSTMï¼Œå¾—åˆ°encodingåçš„å¥å­çš„tokençš„è¡¨ç¤ºï¼š$x=\{h_j|h_j\in R^d,j\in 1,2,â€¦,n\}$ï¼Œ$n$è¡¨ç¤ºå¥å­çš„é•¿åº¦ã€‚</li></ul></li><li><p><strong>Adaptive co-attention networkï¼š</strong>åœ¨å¾—åˆ°imageä¸textçš„representationä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›å°†ä¸¤è€…è¿›è¡Œèåˆã€‚ä½†æ˜¯å¯¹äºsentenceä¸­çš„æ¯ä¸€ä¸ªtokenï¼Œä¸æ˜¯æ‰€æœ‰çš„image regionéƒ½æœ‰ç”¨ï¼Œåè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¯¹äºimageä¸­çš„æ¯ä¸€ä¸ªregionï¼Œä¸æ˜¯sentenceä¸­çš„æ‰€æœ‰tokenéƒ½ä¸å…¶ç›¸å…³ï¼Œé‚£ä¹ˆä¸€ç§å¾ˆå¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨co-attentionï¼Œå³ï¼šimageå¯¹textè¿›è¡Œattention(word-guided visual attention)ä¸textå¯¹textè¿›è¡Œattention(image-guided textual attention)ä¸ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><p><strong>word-guided visual attentionï¼š</strong>ä¸æ˜¯æ‰€æœ‰çš„image regionéƒ½ä¸sentenceä¸­çš„tokenç›¸å…³ï¼Œå¦‚æœå°†imageä¸­æ‰€æœ‰çš„ä¿¡æ¯å…¨éƒ¨ç»™sentenceï¼Œé‚£ä¹ˆä¼šå¼•å…¥å¾ˆå¤šå™ªéŸ³ï¼ŒæŸå®³æ¨¡å‹æ€§èƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬è®¾è®¡äº†word-guided visual attentionï¼Œä»è€Œè®©æ¨¡å‹è‡ªåŠ¨è¿‡æ»¤æ‰ä¸sentneceæ— å…³çš„image regionï¼Œåªç•™ä¸‹æœ€ç›¸å…³çš„regionã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">z_t=tanh(W_{v_I}v_I\oplus (W_{h_t}h_t+b_{h_t})) \\\alpha_t=softmax(W_{\alpha_t}z_t+b_{\alpha_t}) \\\tilde v_t=\sum_{i=1}^{N}\alpha_{t,i}v_i \\v_i\in v_I,i=1,...,N</script><p>æ³¨æ„ï¼Œ$v_I\in E^{N\times d_v}$ï¼Œ$h_t\in R^d$ï¼Œæœ€ç»ˆçš„$\tilde v_t\in R^{dâ€™}$ã€‚</p></li><li><p><strong>image-guided textual attentionï¼š</strong>é™¤äº†imageä¸­çš„ä¿¡æ¯å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›å¯¹textæœ¬èº«è¿›è¡Œå»ºæ¨¡ï¼Œä¹Ÿå°±æ˜¯åœ¨textä¸­æ‰¾åˆ°ä¸æ¯ä¸€ä¸ªtokenç›¸å…³çš„wordsã€‚åšæ³•æ˜¯ï¼šåœ¨word-guided visual attentionçš„åŸºç¡€ä¸Šï¼Œç»§ç»­ä½¿ç”¨ç›¸ä¼¼çš„co-attentionæœºåˆ¶ï¼Œæ¥å¾—åˆ°æ–°çš„ç»“æœã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">z_t^{'}=tanh(W_{x}x\oplus (W_{x,\tilde v_t}\tilde v_t+b_{x,\tilde v_t})) \\\beta_t=softmax(W_{\beta_t}z_t^{'}+b_{\beta_t}) \\\tilde h_t=\sum_{i=1}^{n}\beta_{t,i}h_i \\h_i\in x,i=1,...,n</script><p>ä½†å®é™…ä¸Šï¼Œè¿™ç§åšæ³•å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„ï¼Ÿå½“ç„¶æœ‰å•Šï¼ŒBERTï¼ä»Šå¹´ACL2020çš„UMTæ¨¡å‹å°±ä½¿ç”¨BERTæ¥åšï¼Œå–å¾—äº†å¾ˆå¤§çš„æé«˜ã€‚</p></li><li><p><strong>Gated multimodal fusionï¼š</strong>å¾—åˆ°attentionä¹‹åçš„$\tilde v_t$ä¸$\tilde h_t$ï¼Œ$t=1,â€¦,n$ï¼Œç„¶åæˆ‘ä»¬è®¾è®¡GMFæœºåˆ¶ï¼Œæ¥è¿‡æ»¤ä¸€äº›ä¿¡æ¯ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">h_{\tilde v_t}=tanh(W_{\tilde v_t}\tilde v^t+b_{\tilde v_t}) \\h_{\tilde h_t}=tanh(W_{\tilde h_t}\tilde h^t+b_{\tilde h_t}) \\g_t=sigmoid(W_{g_t}(h_{\tilde v_t}\oplus h_{\tilde h_t})) \\m_t=g_th_{\tilde v_t}+(1-g_t)h_{\tilde h_t}</script></li><li><p><strong>Filtration gateï¼š</strong>ç”±äºimageçš„ä¿¡æ¯ä¸æ˜¯å¿…é¡»çš„ï¼Œè€Œtextçš„ä¿¡æ¯æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥åœ¨æœ€ç»ˆè¾“å…¥åˆ°CRFä¹‹å‰ï¼Œéœ€è¦å†æ¬¡è°ƒæ•´ä¸¤è€…çš„æ¯”é‡ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">s_t=sigmoid(W_{s_t,h_t}h_t \oplus (W_{m,s_t}m_t+b_{m_t,s_t})) \\u_t=s_t(tanh(W_{m_tm_t+b_{m_t}})) \\\tilde m_t=W_{\tilde m_t}(h_t\oplus u_t)</script><p>ä»å…¬å¼ä¸­å¯ä»¥çœ‹å‡ºï¼Œ$s_t$æ§åˆ¶ç€imageä¿¡æ¯çš„æ¯”ä¾‹ï¼Œå½“æˆ‘ä»¬ä¸éœ€è¦imageä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è®©å…¶è¶Šæ¥è¿‘äº0ï¼Œå¦‚æœè¶Šéœ€è¦imageçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±è®©å…¶è¶Šæ¥è¿‘äº1ã€‚</p></li></ul></li><li><p><strong>CRF taggingï¼š</strong>æ²¡ä»€ä¹ˆå¯è®²çš„ï¼Œå°±æ˜¯æ ‡å‡†çš„CRFå±‚ã€‚</p></li></ul><h3 id="experiment"><a href="#experiment" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼štwitteræ•°æ®é›†(released by this paper)</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/21/NLP-Multimodal-NER/ACN_result.jpg" alt></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç¯‡paperæå‡ºçš„modelæ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ï¼Œå¦å¤–Â·ï¼Œä»ablationå®éªŒä¸­å¯ä»¥çœ‹åˆ°ï¼Œå„ä¸ªcomponentè®¾è®¡çš„è¿˜æ˜¯æ¯”è¾ƒåˆç†çš„ï¼Œæ€»ä¹‹æ˜¯ä¸€ç‰‡å¾ˆç»å…¸çš„è®ºæ–‡ï¼Œå€¼å¾—å¤šè¯»ä¸€è¯»ã€‚</p></li></ol><h2 id="Visual-Attention-Model-for-Name-Tagging-in-Multimodal-Social-Media-ACL2018"><a href="#Visual-Attention-Model-for-Name-Tagging-in-Multimodal-Social-Media-ACL2018" class="headerlink" title="Visual Attention Model for Name Tagging in Multimodal Social Media(ACL2018)"></a>Visual Attention Model for Name Tagging in Multimodal Social Media(ACL2018)</h2><h3 id="background-1"><a href="#background-1" class="headerlink" title="background"></a>background</h3><p>è¿™ç¯‡paperåŒæ ·æ˜¯é’ˆå¯¹multimodal NERï¼Œé’ˆå¯¹çš„é—®é¢˜ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š<strong>å¦‚ä½•æ›´å¥½çš„åˆ©ç”¨imageä¿¡æ¯æ¥å¤åˆ¶NERä»»åŠ¡ï¼Ÿ</strong>åœ¨è¿™ç¯‡paperä¸­ï¼Œè®¾è®¡äº†ä¸€ç§çš„æ–°çš„attentionæœºåˆ¶å’Œgateæœºåˆ¶ï¼Œä»è€Œå–å¾—äº†SOTAçš„ç»“æœã€‚</p><h3 id="model-1"><a href="#model-1" class="headerlink" title="model"></a>model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/21/NLP-Multimodal-NER/VATT_model.jpg" alt></p><p>GVAttçš„æ•´ä½“ç»“æ„åˆ†ä¸ºéƒ¨åˆ†ï¼š<strong>feature representationã€Visual attention modelã€visual modulation moduleã€‚</strong></p><ul><li><p><strong>feature representationï¼š</strong>åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼štext representationä¸visual representationã€‚å¯¹äºå‰è€…ï¼Œæ˜¯word embeddingä¸character-level word embeddingçš„concatã€‚æ‰€è°“çš„character-level word embeddingæ˜¯æŒ‡å°†character embeddingè¾“å…¥åˆ°BILSTMå½“ä¸­(å¸¸è§„æ“ä½œ)ã€‚å¯¹äºåè€…ï¼Œé‡‡ç”¨çš„æ˜¯ResNetï¼Œä¿ç•™ä¸¤éƒ¨åˆ†ï¼š$V_g$ä¸$V_r$ï¼Œ$V_g$æ˜¯æŒ‡æœ€åçš„å…¨è¿æ¥å±‚çš„è¾“å‡ºï¼Œç»´åº¦æ˜¯ï¼š$V_g\in R^{1024}$ï¼Œ$V_r$æ˜¯è¾“å…¥åˆ°æœ€åçš„å…¨è¿æ¥å±‚ä¹‹å‰çš„è¾“å‡ºï¼Œå…¶ç»´åº¦æ˜¯ï¼š$V_r\in R^{1024\times 49}$ã€‚è¿™é‡Œä¹‹æ‰€ä»¥ä¿ç•™äº†ä¸¤ä¸ªï¼Œæ˜¯å› ä¸ºåé¢åšäº†å®éªŒæ¯”è¾ƒï¼Œå¹¶ä¸æ˜¯æ•´å¼ imageéƒ½ä¸sentenceç›¸å…³ï¼Œä¸ç›¸å…³çš„éƒ¨åˆ†åè€Œä¼šå¼•å…¥å™ªéŸ³ã€‚</p></li><li><p><strong>visual attention modelï¼š</strong>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è¦è§£å†³ï¼šå¯¹äºsentenceä¸­çš„æ¯ä¸€ä¸ªtokenï¼Œå¦‚ä½•ä¿ç•™ä¸å…¶æœ€ç›¸å…³çš„image regionï¼Œå¹¶ä¸”å»é™¤ä¸å…¶ä¸ç›¸å…³çš„regionï¼Ÿå³ï¼šæå–å‡ºä¸sentenceä¸­ç›¸å…³çš„image region featureï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">Q=LSTM(S) \\P_t=tanh(W_tQ) \\P_v=tanh(W_vV_r) \\A=P_t\oplus P_v \\E=softmax(W_aA+b_a) \\v_c=\sum\alpha_iv_i,\alpha\in E,v_i\in V_r</script><p>å…¶ä¸­ï¼Œ$S$è¡¨ç¤ºfeature representationä¸­çš„concatåçš„text embeddingï¼Œæœ€åå¾—åˆ°çš„$v_c$æœ€ä¸ºä¹‹åçš„BISLTMçš„åˆå§‹è¾“å…¥ã€‚å¦å¤–å†æä¸€å¥ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨çš„æ˜¯$V_r$ï¼Œæ˜¯å› ä¸ºä¹‹åçš„å®éªŒè¡¨æ˜äº†ä½¿ç”¨$V_r$çš„æ•ˆæœè¦æ¯”$v_g$æ›´å¥½ã€‚</p></li><li><p><strong>visual modulation moduleï¼š</strong>è®¾ç½®è¿™ä¸€å±‚çš„ç›®çš„æ˜¯ï¼šå°†ç¬¬äºŒæ­¥æå–å‡ºçš„visualä¿¡æ¯ä¸text embeddingè¿›è¡Œç»“åˆã€‚é¦–æ¬¡å°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„text embeddingè¾“å‡ºåˆ°BILSTMå½“ä¸­ï¼Œå¾—åˆ°$h_i$ï¼›ç„¶åä»¿ç…§LSTMçš„æ›´æ–°æ–¹å¼ï¼Œè®¾è®¡äº†gateæœºåˆ¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\beta_v=sigmoid(W_vh_i+U_vv_c+b_v) \\\beta_w=sigmoid(W_wh_i+U_wv_c+b_w) \\m=tanh(W_mh_i+U_mv_c+b_m) \\w_m=\beta_wh_i+\beta_vm</script><p>æœ€ç»ˆè®¡ç®—å¾—åˆ°çš„$w_m$ä½œä¸ºCRFå±‚çš„è¾“å…¥ï¼ŒCRFå°±æ˜¯æ ‡å‡†çš„CRFå±‚ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p></li></ul><h3 id="experiment-1"><a href="#experiment-1" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼štwitterã€snap captions</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/21/NLP-Multimodal-NER/gvatt_result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼Œå¾ˆä¸é”™ï¼Œè™½ç„¶paperé‡Œé¢æ²¡æœ‰ä¸ªACNæ¨¡å‹è¿›è¡Œå¯¹æ¯”ï¼Œä½†æ˜¯ä»twitteræ•°æ®é›†ç»“æœæ¥çœ‹ï¼ŒF1å€¼é«˜äº†è¿‘10ä¸ªç™¾åˆ†ç‚¹ï¼nbï¼</p></li></ol><h2 id="Multimodal-Named-Entity-Recognition-for-Short-Social-Media-Posts-NAACL2018"><a href="#Multimodal-Named-Entity-Recognition-for-Short-Social-Media-Posts-NAACL2018" class="headerlink" title="Multimodal Named Entity Recognition for Short Social Media Posts(NAACL2018)"></a>Multimodal Named Entity Recognition for Short Social Media Posts(NAACL2018)</h2><h3 id="background-2"><a href="#background-2" class="headerlink" title="background"></a>background</h3><p>è¿™ç¯‡paperä¹Ÿæ˜¯é’ˆå¯¹multimodal NERï¼Œè§£å†³çš„é—®é¢˜ä¹Ÿæ˜¯ä¸¤ä¸ªï¼š1.social mediaä¸Šçš„tweetsæ˜¯éå¸¸ä¸è§„èŒƒçš„ã€informalå¹¶ä¸”å­—æ•°è¾ƒå°‘ï¼Œæ‰€ä»¥ä¸€æ–¹é¢å› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯ä¼šå¼•èµ·ä¸€è¯å¤šä¹‰æ€§é—®é¢˜ï¼Œæ­¤å¤–ï¼Œç”±äºä¸è§„èŒƒçš„ä½¿ç”¨ï¼Œä½¿å¾—ä¼šäº§ç”Ÿå¾ˆå¤šæœªçŸ¥çš„tokenï¼Œè¿™ä¸ªæ€ä¹ˆè§£å†³ï¼Ÿ(å…¶å®ç°åœ¨æ¥çœ‹å°±å¾ˆå¥½è§£å†³ï¼Œä¸ŠBERTå•Š)ï¼›2.æ€ä¹ˆè®©imageä¸textæ›´å¥½è¿›è¡Œäº¤äº’ï¼Ÿä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå°±æœ‰äº†MNERæ¨¡å‹ã€‚</p><h3 id="model-2"><a href="#model-2" class="headerlink" title="model"></a>model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/21/NLP-Multimodal-NER/MNER_model.jpg" style="zoom:50%;"></p><p>æ•´ä½“æ¨¡å‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>featuresã€modality attention moduleã€BILSTM+CRF</strong>ã€‚</p><ul><li><p><strong>task definitionï¼š</strong>è¾“å…¥çš„sentenceè¡¨ç¤ºä¸ºï¼š$x=\{x_t\}_{t=1}^{T}$ï¼Œå…¶å¯¹åº”çš„æ ‡ç­¾æ˜¯:$y=\{y_t\}_{t=1}^{T}$ï¼Œæ¯ä¸€ä¸ªtokenç”±ä¸‰ç§modalityç»„æˆï¼š$x_t=\{x_t^{(w)},x_t^{(c)},x_t^{(v)}\}$ï¼Œåˆ†åˆ«è¡¨ç¤ºword embeddingã€character embeddingã€visual embeddingã€‚</p></li><li><p><strong>featuresï¼š</strong>å…±åˆ†ä¸ºä¸‰ç§ï¼šword embeddingã€character embeddingã€visual embeddingã€‚word embeddingç”±GloVeåˆå§‹åŒ–ï¼Œå¹¶åœ¨trainingè¿‡ç¨‹è¿›è¡Œæ›´æ–°ï¼›character embeddingæ˜¯å°†character embeddingé€å…¥BILSTMå½“ä¸­ï¼Œå¾—å‡ºçš„è¾“å‡ºï¼›visual embeddingæ˜¯ä½¿ç”¨GoogleNetçš„æœ€åä¸€å±‚çš„è¾“å‡ºã€‚</p></li><li><p><strong>modality attention moduleï¼š</strong>åœ¨ä¹‹å‰çš„paperä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯concat textä¸imageçš„ä¿¡æ¯ï¼Œç„¶åå†è¾“å…¥åˆ°CRFå½“ä¸­ï¼Œä½†æ˜¯concatçš„æ–¹å¼ä¼šæŸå¤±ä¿¡æ¯ï¼Œé€ æˆæ•ˆæœä¸‹é™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ç¯‡paperåˆ†åˆ«å¯¹ä¸‰ä¸ªmodalityè¿›è¡Œç¼–ç ï¼Œå†è¿›è¡ŒåŠ æƒæ±‚å’Œã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">[a_t^{(w)},a_t^{(c)},a_t^{(v)}]=sigmoid(W_m[x_t^{(w)};x_t^{(c)};x_t^{(v)}]+b_m) \\\alpha_{t}^{(m)}=\frac{exp(a_t^{(m)})}{\sum_{m^{'}\in \{w,c,v\}}exp(a_t^{(m^{'})})} ,\forall m\in \{w,c,v\} \\\overline x_t=\sum_{m\in \{w,c,v\}}\alpha_t^{(m)}x_t^{(m)}</script><p>$\overline x_t$æ˜¯æœ€ç»ˆåˆ°BILSTM+CRFçš„è¾“å…¥ã€‚</p></li><li><p><strong>BILSTM+CRFï¼š</strong>è¿™å°±æ˜¯æ ‡å‡†çš„BILSTM+CRFï¼Œä¸å†èµ˜è¿°ã€‚</p></li></ul><h3 id="experiment-2"><a href="#experiment-2" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼šsnap caption</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/21/NLP-Multimodal-NER/MNER_result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼Œè¿˜è¡Œå§ï¼Œæ²¡å•¥äº®ç‚¹ã€‚</p></li></ol><h2 id="Improving-Multimodal-Named-Entity-Recognition-via-Entity-Span-Detection-with-Uniï¬ed-Multimodal-Transformer-ACL2020"><a href="#Improving-Multimodal-Named-Entity-Recognition-via-Entity-Span-Detection-with-Uniï¬ed-Multimodal-Transformer-ACL2020" class="headerlink" title="Improving Multimodal Named Entity Recognition via Entity Span Detection with Uniï¬ed Multimodal Transformer(ACL2020)"></a>Improving Multimodal Named Entity Recognition via Entity Span Detection with Uniï¬ed Multimodal Transformer(ACL2020)</h2><h3 id="background-3"><a href="#background-3" class="headerlink" title="background"></a>background</h3><p>è¿™æ˜¯æœ€æ–°çš„multimodal NERçš„paperï¼Œä¸»è¦è§£å†³çš„é—®é¢˜æœ‰ï¼š1.textä¸imageçš„äº¤äº’ä¸å¤Ÿï¼Œå³ä¾¿èƒ½å¤Ÿå¾—åˆ°ç®€å•äº¤äº’åçš„ç»“æœï¼Œä½†æ˜¯textå¯¹image contextå¹¶ä¸æ•æ„Ÿï¼›2.ä¹‹å‰çš„ç ”ç©¶å¹¶æ²¡æœ‰è€ƒè™‘imageå¸¦æ¥çš„biasã€‚é’ˆå¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç¯‡paperæå‡ºäº†MMI moduleï¼Œé’ˆå¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œè¿™ç¯‡paperè®¾è®¡äº†ESDè¾…åŠ©ä»»åŠ¡æ¥è§£å†³ã€‚å…·ä½“çš„ä¸‹é¢å°èŠ‚å°†è¯¦ç»†çš„ä»‹ç»ã€‚</p><h3 id="model-3"><a href="#model-3" class="headerlink" title="model"></a>model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/21/NLP-Multimodal-NER/UMT_model.jpg" alt></p><p>æ•´ä½“æ¨¡å‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>unimodal input representationã€multimodal transformerã€unified multimodal transformerã€‚</strong></p><ul><li><p><strong>unimodal input representationï¼š</strong>ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šword representationä¸visual representationã€‚å¯¹äºå‰è€…ï¼Œpaperä¸­ä½¿ç”¨äº†BERTï¼Œä¸€æ–¹é¢æ˜¯èƒ½å¤Ÿå¾—åˆ°æ›´åŠ å¼ºå¤§çš„representationï¼Œå¦ä¸€æ–¹é¢ä¹Ÿèƒ½å¤Ÿè§£å†³ä¸€è¯å¤šä¹‰æ€§é—®é¢˜ã€‚å‡è®¾è¾“å…¥çš„å¥å­ä¸ºï¼š$S^{â€˜}=(s_0,s_1,â€¦,s_{n+1})$ï¼Œå…¶ä¸­$s_0ã€s_{n+1}$åˆ†åˆ«è¡¨ç¤º[CLS]ä¸[SEP] tokenï¼Œé€šè¿‡ä¸‰ç§embeddingç›¸åŠ ï¼Œå¾—åˆ°çš„å¥å­è¡¨ç¤ºä¸ºï¼š$X=(x_0,x_1,â€¦,x_{n+1})$ï¼Œé€šè¿‡BERTä¹‹åï¼Œä¸ºï¼š$C=(c_0,c_1,â€¦,c_{n+1})$ï¼Œå…¶ä¸­$c_i\in R^d$ï¼›å¯¹äºåè€…ï¼Œé‡‡ç”¨ResNetæ¥å¯¹imageè¿›è¡Œç¼–ç ï¼Œæˆ‘ä»¬ä¿ç•™ResNetçš„æœ€åä¸€ä¸ªå·ç§¯å±‚çš„è¾“å‡ºä½œä¸ºè¯¥imageçš„representationï¼Œä¸ºï¼š$U=(u_1,u_2,â€¦,u_49)$ï¼Œ$u_i$è¡¨ç¤ºä¸€ä¸ªregionï¼Œä¸”å…¶ç»´åº¦æ˜¯ï¼š$R^{2048}$ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œè®©å…¶ç»´åº¦ä¸word representationçš„ç»´åº¦ä¸€æ ·ï¼Œä¸ºï¼š$V=(v_1,â€¦,v_{49}),v_i\in R^d$ã€‚</p></li><li><p><strong>multimodal transformerï¼š</strong>åœ¨æ­£å¼å¯¹wordä¸visualè¿›è¡Œäº¤äº’ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹word representationå†ä½¿ç”¨ä¸€å±‚æ ‡å‡†çš„transformer layerï¼Œæˆ‘ä¸ªäººç†è§£æ˜¯å¢åŠ éçº¿æ€§ï¼Œä¸åŠ å…¶å®ä¹Ÿè¯´çš„é€šï¼Œå¾—åˆ°$R=(r_0,r_1,â€¦,r_{n+1})$ã€‚æ¥ä¸‹æ¥ï¼Œè®¾è®¡äº†MMI moduleï¼Œè®©wordä¸visualè¿›è¡Œäº¤äº’ã€‚å…·ä½“åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šimage-aware word representationä¸word-aware visual representationã€‚</p><ul><li><p><strong>image-aware word representationï¼š</strong>è¿™ä¸€æ­¥æ˜¯imageå¯¹wordè¿›è¡Œattentionï¼Œå¾—åˆ°æ›´å¥½çš„word representationã€‚é‚£ä¹ˆï¼Œå°±æ˜¯$V$ä½œä¸ºqueryï¼Œ$R$ä½œä¸ºkeyå’Œvalueï¼Œä½¿ç”¨m-head cross-modal attentionï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">CA_i(V,R)=softmax(\frac{[W_{q_i}V]^T[W_{k_i}R]}{\sqrt {d/m}})[W_{v_i}R]^T \\MH-CA(V,R)=W^{'}[CA_1(V,R),CA_2(V,R),...,CA_m(V,R)]^T \\\tilde P=LN(V+MH-CA(V,R)) \\P=LN(\tilde P+FFN(\tilde P))</script><p>å…¶ä¸­ï¼Œ$P=(p_1,â€¦,p_{49})$ã€‚ä½†æ˜¯è¿™ä¸ªä¸æˆ‘ä»¬æœ€ç»ˆæƒ³è¦å¾—åˆ°æ›´å¥½çš„word representationçš„ç›®æ ‡ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†$R$ä½œä¸ºqueryï¼Œ$P$ä½œä¸ºkeyå’Œvalueï¼Œå†è¾“å…¥åˆ°ä¸€ä¸ªä¸ä¸Šè¿°ä¸€æ ·çš„transformer layerï¼Œå¾—åˆ°$A=(a_0,a_1,â€¦,a_{n+1})$ã€‚</p></li><li><p><strong>word-aware visual representationï¼š</strong>è¿™é‡Œæ˜¯wordå¯¹visualè¿›è¡Œattentionï¼Œæ‰€ä»¥å°†word $R$ä½œä¸ºqueryï¼Œ$V$ä½œä¸ºkeyå’Œvalueï¼Œåº”ç”¨å’Œä¸Šè¿°ä¸€æ ·çš„transformer layerï¼Œå¾—åˆ°$Q=(q_0,q_1,â€¦,q_{n+1})$ã€‚ç„¶åæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæ§åˆ¶visual informationçš„è¾“å…¥ï¼Œæ‰€ä»¥æœ‰è®¾è®¡äº†visual gateï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">g=sigmoid(W_a^TA+W_q^TQ) \\B=gQ</script><p>$B$å°±æ˜¯æœ€ç»ˆçš„visual representationã€‚</p></li><li><p><strong>CRFï¼š</strong>æˆ‘ä»¬å°†$A$ä¸$B$è¿›è¡Œconcatï¼Œå¹¶ä¸”è¾“é€åˆ°æ ‡å‡†çš„CRF kayerå½“ä¸­ã€‚</p></li></ul></li><li><p><strong>unified multimodal transformerï¼š</strong>åœ¨ä¸Šä¸€æ­¥çš„multimodal transformerå½“ä¸­ï¼Œéƒ½æ˜¯åœ¨å…³æ³¨å¦‚ä½•å¯¹textå’Œimageä¹‹é—´çš„å…³ç³»è¿›è¡Œå»ºæ¨¡ï¼Œä½†æ˜¯è¿™æ ·å¾ˆå®¹æ˜“å¯¼è‡´æ¨¡å‹è¿‡åˆ†å»å…³æ³¨imageä¸­æœ‰çš„entityï¼Œå¯¹äºåœ¨sentenceä¸­ä½†æ˜¯ä¸åœ¨imageä¸­çš„å®ä½“å…³æ³¨ä¸å¤Ÿï¼Œå› æ­¤ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®¾è®¡äº†ESDè¾…åŠ©ä»»åŠ¡ï¼Œç”¨æ¥é¢„æµ‹entityçš„typeã€‚å‡è®¾ä¸€ä¸ªå¥å­çš„æ ‡æ³¨ä¸ºï¼š$z=(z_0,â€¦,z_{n+1})$ï¼Œå…¶ä¸­$z_i\in \cal Z$ï¼Œ$\cal Z=\{B,I,O\}$ï¼Œæˆ‘ä»¬å°†å…¶è¾“é€åˆ°ä¸€ä¸ªtransformer layer+CRF layerã€‚ç„¶åæˆ‘ä»¬æƒ³è¦å°†å…¶è¾…åŠ©ä¸æœ€ç»ˆçš„é¢„æµ‹ï¼Œæ‰€ä»¥è®¾è®¡äº†ä¸€ä¸ªconversion matrixï¼š$W^c\in R^{|\cal Z|\times |\cal Y|}$ï¼Œå…¶ä¸­$\cal Z=\{B,I,O\}$ï¼Œ${\cal Y}=\{B-PEC,I-PEC,â€¦\}$ï¼Œå¦‚æœ$\cal Z_j$ä¸æ˜¯$\cal Y_k$çš„ç›¸å…³labelï¼Œé‚£ä¹ˆ$W^c_{j,k}=0$ï¼Œå¦åˆ™ä¸º$W^c_{j,k}=\frac{1}{|C_j|}$ã€‚</p></li></ul><h3 id="experiment-3"><a href="#experiment-3" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼štwitter2015ã€twitter2017</p></li><li><p>detailsï¼šè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œresnetå‚æ•°ä¸æ›´æ–°ï¼Œbertå‚æ•°æ›´æ–°ï¼Œseq_lengthä¸º128ï¼Œbatch_sizeä¸º16ã€‚</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/21/NLP-Multimodal-NER/UMT_result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼Œæå‡è¿˜æ˜¯æŒºå¤§çš„ï¼Œä¸ªäººè§‰å¾—æ˜¯å¾—ç›ŠäºBERTçš„ä½¿ç”¨ä»¥åŠè®¾è®¡çš„ESDè¾…åŠ©ä»»åŠ¡ï¼Œè¿˜æ˜¯ä¸é”™çš„ã€‚</p></li><li><p>æ¶ˆèå®éªŒ</p><p><img src="/2020/10/21/NLP-Multimodal-NER/UMT_ablation.jpg" alt></p><p>è¿™æ˜¯paperå½“ä¸­æ¶ˆèå®éªŒçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨UMTæ¨¡å‹ä¸­ï¼Œå„ä¸ªcomponentéƒ½æ¯”è¾ƒé‡è¦ï¼Œå»æ‰éƒ½ä¼šæœ‰å½±å“ï¼Œä½†æ˜¯ç›¸æ¯”æ¥è¯´ï¼ŒESDè¾…åŠ©ä»»åŠ¡å‘æŒ¥äº†æ›´å¤§çš„ä½œç”¨ï¼Œä¹‹åå¯ä»¥æä¸€æ³¢ã€‚</p></li><li><p>base caseåˆ†æï¼šåœ¨paperçš„base caseåˆ†æä¸­ï¼Œä¸»è¦çš„é”™è¯¯åœ¨äºï¼šå½“imageä¸textå®Œå…¨ä¸ç›¸å…³çš„æ—¶å€™ï¼ŒBERT-CRFé¢„æµ‹ä¼šæ­£ç¡®ï¼Œè€ŒUMTé¢„æµ‹é”™è¯¯ï¼Œå®é™…ä¸Šå°±ç›¸å½“äºimageæ˜¯å™ªéŸ³ï¼Œåœ¨æ•´ä¸ªæ•°æ®é›†ä¸­ï¼Œå¤§æ¦‚æœ‰5%çš„æ¯”ä¾‹ã€‚</p></li></ol><p>å°å°çš„æ€»ç»“ä¸€ä¸‹å§ï¼šå¯¹ä¸Multimodal NERä»»åŠ¡ï¼Œç›®å‰ä¸»è¦çš„éš¾ç‚¹æ˜¯ï¼š1.å¦‚ä½•è®¾è®¡æ›´å¥½çš„æœºåˆ¶ï¼Œä»è€Œè®©tokenåœ¨imageæ‰¾åˆ°ä¸å…¶æœ€ç›¸å…³çš„regionï¼Ÿ2.åœ¨1çš„åŸºç¡€ä¸Šï¼Œæ€ä¹ˆå¯¹textå’Œimage regionæ›´å¥½åœ°è¿›è¡Œèåˆï¼Ÿ3.imageå½“ä¸­å…¶å®åªæœ‰å¾ˆå°‘çš„å®ä½“ï¼Œå¯¹äºsentenceä¸­çš„å…¶ä»–å®ä½“ï¼Œimageå…¶å®å¹¶ä¸èƒ½æä¾›æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œæ€ä¹ˆå»è§£å†³è¿™ç§æƒ…å†µï¼Ÿ4.å½“imageä¸textå®Œå…¨ä¸ç›¸å…³æ—¶ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ</p><h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p>ã€ŠAdaptive Co-Attention Network for Named Entity Recognition in Tweetsã€‹</p><p>ã€ŠVisual Attention Model for Name Tagging in Multimodal Social Mediaã€‹</p><p>ã€ŠMultimodal Named Entity Recognition for Short Social Media Postsã€‹</p><p>ã€ŠImproving Multimodal Named Entity Recognition via Entity Span Detection with Uniï¬ed Multimodal Transformerã€‹</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Multimodal NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|Cross-Lingual NER</title>
      <link href="2020/10/19/NLP-Cross-Lingual-NER/"/>
      <url>2020/10/19/NLP-Cross-Lingual-NER/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹cross-lingual NERï¼Œè§£è¯»ä»Šå¹´MSRAå‘è¡¨çš„ä¸‰ç¯‡è®ºæ–‡ï¼šã€ŠEnhanced Meta-Learning for Cross-lingual Named Entity Recognition with Minimal Resourcesã€‹ã€ã€ŠSingle-/Multi-Source Cross-Lingual NER via Teacher-Student Learning on Unlabeled Data in Target Languageã€‹ã€ã€ŠUniTrans : Unifying Model Transfer and Data Transfer for Cross-Lingual Named Entity Recognition with Unlabeled Dataã€‹ï¼Œä»¥åŠé™„å¸¦çš„ã€ŠGRN: Gated Relation Network to Enhance Convolutional Neural Network for Named Entity Recognitionã€‹ã€‚</p><a id="more"></a><h2 id="Enhanced-Meta-Learning-for-Cross-lingual-Named-Entity-Recognition-with-Minimal-Resources-AAAI2020"><a href="#Enhanced-Meta-Learning-for-Cross-lingual-Named-Entity-Recognition-with-Minimal-Resources-AAAI2020" class="headerlink" title="Enhanced Meta-Learning for Cross-lingual Named Entity Recognition with Minimal Resources(AAAI2020)"></a>Enhanced Meta-Learning for Cross-lingual Named Entity Recognition with Minimal Resources(AAAI2020)</h2><h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>å½“æˆ‘ä»¬æƒ³è¦åœ¨target languageä¸Šè¿›è¡ŒNERä»»åŠ¡çš„æ—¶å€™ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„labled dataçš„è¯ï¼Œcross-lingual NERæ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼ã€‚æ‰€è°“çš„cross-lingual NERæŒ‡çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰labeled source language dataä¸unlabeled target language dataï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹åœ¨labeled source languageä¸Šå­¦ä¹ åˆ°çš„çŸ¥è¯†èƒ½å¤Ÿè¿ç§»ç»™unlabeled target languageï¼Œä»è€Œä½¿å¾—target language dataåœ¨æ²¡æœ‰labelçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿå–å¾—å¾ˆå¥½çš„ç»“æœã€‚ç›®å‰å·²æœ‰çš„cross-lingual NER modelä¸»è¦åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š<strong>methods based on direct transfer ä¸methods based on annotation projection</strong>ã€‚</p><ul><li>æ‰€è°“çš„methods based on direct transferæŒ‡çš„æ˜¯ï¼šæˆ‘ä»¬ä½¿ç”¨source language dataå»è®­ç»ƒä¸€ä¸ªNER modelï¼Œç„¶åç›´æ¥åœ¨target language dataä¸Šè¿›è¡Œtestï¼Œè¿™ç§æ–¹æ³•çš„å…³é”®åœ¨äºï¼šæ€ä¹ˆå¾—åˆ°å¹¶åœ¨æ¨¡å‹ä¸­èå…¥ä¸€äº›language-independent featureï¼Œå¸¸ç”¨çš„æ˜¯ï¼šcross-lingual word embeddingï¼Œword clusterç­‰ç­‰ã€‚</li><li>æ‰€è°“çš„methods based on annotation projectionæŒ‡çš„æ˜¯ï¼šæˆ‘ä»¬å°†source language dataåœ¨word level/phrase levelä¸Šç»™ä»–ç¿»è¯‘æˆtarget language dataï¼Œå½“ç„¶labelä¹Ÿæ˜¯copyè¿‡å»ï¼Œç„¶åæ¨¡å‹ä½¿ç”¨ç¿»è¯‘åçš„target language dataè¿›è¡Œè®­ç»ƒï¼Œæœ€ååœ¨åŸæœ‰unlabeled target language dataè¿›è¡Œtestã€‚</li></ul><p>æœ¬ç¯‡paperæå‡ºçš„æ–¹æ³•å±äºç¬¬ä¸€ç§ï¼Œå› ä¸ºä½œè€…è®¤ä¸ºè¿™ç§æ–¹æ³•è¿˜æœ‰æå‡çš„ç©ºé—´ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæœ€è¿‘æœ‰paperæ˜¾ç¤ºï¼š<strong>é€šè¿‡å»ºç«‹ä¸€ä¸ªcross-lingual encoderï¼Œä»»ä½•å¥å­éƒ½èƒ½å¤Ÿè¢«encodeåˆ°åŒä¸€ä¸ªfeature space</strong>ã€‚å¦å¤–ï¼Œåœ¨mBERTä¸­ï¼Œè¿˜ç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªç»“è®ºï¼šé€šè¿‡mBERTï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„ä½™å¼¦ç›¸ä¼¼åº¦æ¥è®¡ç®—ä¸åŒè¯­è¨€çš„å¥å­çš„similarityï¼Œè¿™æ ·çš„è¯ï¼Œç»™å®šä¸€ä¸ªtarget language exampleï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨source language dataä¸­å¬å›å‡ºä¸€äº›ä¸å…¶åœ¨ç»“æ„/è¯­ä¹‰ä¸Šç›¸ä¼¼çš„å¥å­ã€‚æ‰€ä»¥åœ¨æ­£å¼å¯¹unlabeled language dataè¿›è¡Œtestä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åœ¨source language dataä¸­æ‰¾åˆ°ä¸ç»™å®šçš„unlabeled language dataä¸­ç›¸ä¼¼çš„é‚£äº›sampleï¼Œä»è€Œä½¿ç”¨è¿™äº›sampleæ¥å¯¹æ¨¡å‹è¿›è¡Œfine-tuningï¼Œæ¥æå‡æ•ˆæœï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼æ­¤å¤–ï¼Œå¬å›çš„exampleä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå°‘çš„æ•°ç›®ï¼Œä»è€Œé¿å…å¼•å…¥é¢å¤–çš„å™ªéŸ³ï¼Œä¼¤å®³æ¨¡å‹çš„æ€§èƒ½ã€‚åˆ°æ­¤ï¼Œcross-lingual NERä»»åŠ¡å°±è½¬åŒ–ä¸ºäº†ï¼š<strong>æ¨¡å‹éœ€è¦åœ¨ä¸€ä¸ªå°æ•°ç›®çš„è®­ç»ƒé›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå¹¶åœ¨æ–°çš„target languageä¸Šå–å¾—æ¯”è¾ƒå¥½çš„ç»“æœã€‚</strong>è¿™å°±å¾ˆè‡ªç„¶åœ°å¼•å…¥äº†meta learningã€‚</p><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><p>é¦–å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯meta learningã€‚æ‰€è°“çš„meta learningï¼Œä¹Ÿå«åšLTL(å­¦ä¼šå­¦ä¹ )ï¼Œå®ƒé€‚ç”¨äºï¼šæ¨¡å‹åªéœ€è¦ä½¿ç”¨å°‘é‡æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿåœ¨é€‚ç”¨äºä¸€ä¸ªæ–°çš„ä»»åŠ¡ï¼Œ<strong>å®ƒå¼ºè°ƒçš„æ˜¯fast adaptationã€‚</strong>ç›®å‰å¸¸ç”¨çš„meta learningç®—æ³•ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šleanrning a metric space ã€learning a good parameters initializationã€learning  an optimizerï¼Œæœ¬ç¯‡paperé‡‡ç”¨çš„MAMLç®—æ³•å±äºç¬¬äºŒç±»ã€‚OKï¼Œç‚¹åˆ°ä¸ºæ­¢ï¼Œä¸‹é¢å°†è®²è§£å¦‚ä½•åˆ©ç”¨meta learningæ¥è¿›è¡Œcross-lingual NERä»»åŠ¡ã€‚</p><ol><li><p><strong>é—®é¢˜å®šä¹‰</strong></p><p>æˆ‘ä»¬æŠŠlabeled source language dataè®°åšï¼š $D^S_{train}=\{x^{(i)}\}_{i=1}^{N}$ ï¼Œunlabeled target language dataè®°åšï¼š$D^T_{test}=\{x^{(j)}\}_{j=1}^{M}$ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šå¸Œæœ›ä½¿ç”¨$D^S_{train}$æ¥è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œä»è€Œè®©æ¨¡å‹èƒ½å¤Ÿåœ¨$D^S_{test}$æœ‰ç€å¾ˆå¥½çš„æ•ˆæœã€‚        </p></li><li><p><strong>Base modelï¼š</strong>ä½¿ç”¨é¢„è®­ç»ƒçš„mBERTï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ªsoftmaxç”¨äºtokenè§£ç ï¼ŒæŸå¤±å‡½æ•°é‡‡ç”¨CEã€‚</p></li><li><p><strong>enhanced meta learning approachï¼š</strong>åœ¨è¿™ç¯‡paperé‡Œï¼Œä½¿ç”¨MAMLç®—æ³•æ¥è¿›è¡Œmeta learningã€‚ä¸äº†è§£çš„MAMLç®—æ³•è¯·çœ‹è¿™ä¸ª<a href="https://zhuanlan.zhihu.com/p/57864886" target="_blank" rel="noopener">link</a>ã€‚æ•´ä¸ªç®—æ³•å…¶å®åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼štaskçš„æ„å»ºã€meta-training(åœ¨MAMLä¸­å°±æ˜¯é¢„è®­ç»ƒé˜¶æ®µ)ä¸adaptation(åœ¨MAMLä¸­å°±æ˜¯å¾®è°ƒé˜¶æ®µ)ã€‚</p><ol><li><p><strong>taskçš„æ„å»º</strong>    </p><p>åœ¨æ‰§è¡ŒMAMLç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºtaskï¼Œå› ä¸ºåœ¨MAMLä¸­ï¼Œä¸€ä¸ªtaskå°±ç›¸å½“äºä¸€ä¸ªæ ·æœ¬ã€‚å¯¹äº$D^S_{train}$ä¸­æ¯ä¸€ä¸ªæ ·æœ¬$x^{(i)}$ï¼Œæˆ‘ä»¬å°†å…¶æœ¬èº«å½“ä½œmeta task $\tau_i$çš„æµ‹è¯•é›†$D^{\tau_i}_{test}$(å…¶å®å°±æ˜¯query set)ï¼Œä»source language dataå¬å›çš„ä¸$x^{(i)}$æœ€ç›¸ä¼¼çš„æ ·æœ¬çš„é›†åˆä½œä¸ºmeta  task $\tau_i$çš„è®­ç»ƒé›†$D^{\tau_i}_{train}$(å…¶å®å°±æ˜¯support set)ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªmeta  task $\tau_i$å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">\tau_i=(D^{\tau_i}_{test},D^{\tau_i}_{test}),i\in 1,2,3,4,5,...,N</script><p>å…·ä½“æ€ä¹ˆå¬å›å‘¢ï¼Ÿå…¶å®å°±æ˜¯é€šè¿‡mBERTå¾—åˆ°$x^{(i)}$çš„sentence presentationï¼Œç„¶åè®¡ç®—$x^{(i)}$ä¸$x^{(j)}$çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œé€‰å–æœ€ç›¸ä¼¼çš„Kä¸ªæ ·æœ¬å³å¯ã€‚</p></li><li><p><strong>meta-training</strong></p><p>è¿™ä¸€æ­¥å¯ä»¥çœ‹ä½œæ˜¯é¢„è®­ç»ƒï¼Œæ¨¡å‹åœ¨å¤šä¸ªä¸åŒtaskè¿›è¡Œè®­ç»ƒï¼Œä»è€Œèƒ½å¤Ÿè®©æ¨¡å‹è·å¾—å¾ˆå¼ºçš„æ³›åŒ–èƒ½åŠ›ï¼Œä¹‹ååœ¨ç›®æ ‡taskå½“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦fine-tuningå¾ˆå°‘çš„æ¬¡æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°å¾ˆå¥½çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯<strong>fast adaption</strong>ã€‚è¿™ä¸€æ­¥æ ¸å¿ƒçš„ä¸œè¥¿å«åšï¼š<strong>gradient by gradient</strong>ã€‚å…·ä½“å°±æ˜¯ï¼šæˆ‘ä»¬éšæœºsampleä¸€äº›taskä½œä¸ºä¸€ä¸ªbatchæ¥è®­ç»ƒæ¨¡å‹çš„å‚æ•°$\theta$ï¼Œåœ¨è¿™ä¸€ä¸ªbatchçš„å‚æ•°æ›´æ–°çš„æ—¶å€™ï¼Œæ˜¯ä¸€ä¸ªæ ·æœ¬ä¸€ä¸ªæ ·æœ¬æ¥è¿›è¡Œå‚æ•°æ›´æ–°çš„ï¼Œç­‰åˆ°ä¸€ä¸ªbatchç»“æŸåï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„å‚æ•°$\theta^{â€˜}$ï¼Œç„¶åç”¨$\theta^{â€˜}$æ¥æ›´æ–°æœ€åŸå§‹çš„å‚æ•°$\theta$ã€‚å½“ç„¶äº†ï¼Œé¢„è®­ç»ƒå¯ä»¥æ‰§è¡Œå¾ˆå¤šæ¬¡ã€‚</p></li><li><p><strong>adaptation</strong></p><p>è¿™ä¸€æ­¥æ˜¯æ¨¡å‹åœ¨target language dataä¸Šè¿›è¡Œå¾®è°ƒã€‚å½“ç„¶äº†ï¼Œå…·ä½“çš„taskçš„æ„å»ºæ–¹æ³•ä¹Ÿæ˜¯ç¬¬ä¸€æ­¥è¯´çš„ä¸€æ ·ï¼Œä¸è¿‡ä½¿ç”¨çš„æ ·æœ¬å…¨éƒ¨æ¥è‡ªäºtarget language dataã€‚<strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€æ­¥ä¸­æˆ‘ä»¬åªæœ‰ä¸€æ¬¡çš„å‚æ•°æ›´æ–°ã€‚</strong>æ•´ä½“çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/meta-learning.jpg" alt></p><p>å½“ç„¶äº†ï¼Œç”±äºä¸åŒè¯­è¨€çš„å¥å­ä¹‹é—´çš„å¯¹é½å¾ˆé‡è¦ï¼Œä¸ºäº†è®©æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°è¿™ç§å¯¹é½ï¼Œmodelè¿˜åœ¨token-levelä¸Šå¯¹entityè¿›è¡Œäº†maskã€‚è¿˜æœ‰ä¸€ä¸ªmax lossçš„æ“ä½œï¼Œå…·ä½“å°±æ˜¯ï¼šä¼ ç»Ÿçš„CE lossï¼Œå®ƒå¯¹æ¯ä¸€ä¸ªtoken çš„losséƒ½æ˜¯å¹³ç­‰å¯¹å¾…ï¼Œä½†æ˜¯è¿™æ˜¯ä¸å¯¹çš„ï¼Œä¸åŒçš„tokenå®ƒå¯¹æ•´ä½“çš„lossè´¡çŒ®æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‡å»æ‰€æœ‰token lossä¸­æœ€å¤§å€¼ï¼Œä»è€Œè®©é‚£äº›loss æ¯”è¾ƒé«˜çš„tokenèƒ½å¤Ÿå­¦ä¹ çš„æ›´åŠ å……åˆ†ã€‚å½“ç„¶åœ¨æœ¬paperé‡Œæ²¡æœ‰ä½¿ç”¨ï¼Œå› ä¸ºæœ¬æ¥è®­ç»ƒæ•°æ®å°±å°‘ï¼Œæ²¡æœ‰å¿…è¦ï¼Œè€Œä¸”è¿™æ ·æå¾ˆå®¹æ˜“è¿‡åº¦å­¦ä¹ äº†ï¼Œä»è€Œä¼¤å®³æ¨¡å‹çš„æ€§èƒ½ã€‚</p></li></ol></li></ol><h3 id="experiment"><a href="#experiment" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCoNLL-2002/2003ã€Europeana Newspapersã€MSRAï¼Œenä½œä¸ºsource languageï¼Œå…¶ä»–è¯­è¨€ä½œä¸ºtarget languageã€‚</p></li><li><p>å®éªŒç»“æœ</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/meta-learning result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼Œè¿˜æ˜¯ä¸é”™çš„ã€‚ä¸ªäººè®¤ä¸ºè¿™ç§æ€è·¯è¿˜æ˜¯è›®æ–°é¢–çš„ã€‚</p></li></ol><h2 id="Single-Multi-Source-Cross-Lingual-NER-via-Teacher-Student-Learning-on-Unlabeled-Data-in-Target-Language-ACL2020"><a href="#Single-Multi-Source-Cross-Lingual-NER-via-Teacher-Student-Learning-on-Unlabeled-Data-in-Target-Language-ACL2020" class="headerlink" title="Single-/Multi-Source Cross-Lingual NER via Teacher-Student Learning on Unlabeled Data in Target Language(ACL2020)"></a>Single-/Multi-Source Cross-Lingual NER via Teacher-Student Learning on Unlabeled Data in Target Language(ACL2020)</h2><h3 id="background-1"><a href="#background-1" class="headerlink" title="background"></a>background</h3><p>è¿™ç¯‡è®ºæ–‡å‡è®¾çš„ä»»åŠ¡æ›´åŠ çš„ä¸¥è‹›ï¼šä¹‹å‰çš„cross-lingual NERéƒ½æ˜¯æœ‰å¯ç”¨çš„labeled source language dataï¼Œé‚£å¦‚æœæ²¡æœ‰å¯ç”¨çš„labeled source language dataï¼Œè¦æ€ä¹ˆæ ·æ‰èƒ½åœ¨unlabeled target language dataä¸Šå–å¾—å¥½çš„æ•ˆæœå‘¢ï¼Ÿå®ƒé¦–å…ˆå¯¹åœ¨cross-lingual NERä¸Šä¸¤ç§æ–¹æ³•è¿›è¡Œäº†å¯¹æ¯”ï¼š</p><ul><li><strong>methods based on direct transfer</strong>ç¼ºç‚¹çš„åœ¨äºï¼šæ²¡æœ‰å¾ˆå¥½åœ°åˆ©ç”¨unlabeled target language dataï¼Œå¹¶ä¸”æ¨¡å‹æ•ˆæœéå¸¸ä¾èµ–language-independent featureï¼›</li><li><strong>methods based on annotation projection</strong>çš„ç¼ºç‚¹åœ¨äºï¼šéœ€è¦parallel text of target language dataï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡å¯¹source language dataè¿›è¡Œç¿»è¯‘å¾—åˆ°ï¼Œè¿™æ ·ä»¥æ¥ï¼Œéš¾å…ä¼šå¼•å…¥å™ªéŸ³ï¼Œå¯¹æœ€ç»ˆæ¨¡å‹çš„æ€§èƒ½å­˜åœ¨æŸå®³ï¼ŒåŒæ—¶è¿™ç§æ–¹æ³•å¯¹äºzero-source cross-lingual NERçš„æƒ…å†µä¸é€‚ç”¨ã€‚</li></ul><p>å¯¹ä¸¤ç§æ–¹æ³•è¿›è¡Œåˆ†æä¹‹åï¼Œ<strong>æˆ‘ä»¬å¸Œæœ›æ„å»ºçš„æ¨¡å‹ï¼Œèƒ½å¤Ÿå¤„ç†zero-source cross-lingual NERè¿™ç§æƒ…å†µï¼ŒåŒæ—¶èƒ½å¤Ÿå¾ˆå¥½åœ°åˆ©ç”¨unlabeled target language dataä¸­çš„ä¿¡æ¯ã€‚</strong>å…·ä½“çš„åšæ³•æ˜¯ï¼šé‡‡ç”¨teacher-student learning(å€Ÿé‰´äº†çŸ¥è¯†è’¸é¦)ã€‚</p><h3 id="model-1"><a href="#model-1" class="headerlink" title="model"></a>model</h3><p>æ•´ä¸ªæ¨¡å‹åˆ†ä¸ºä¸¤å¤§æƒ…å†µï¼šsingle source cross-lingual NERå’Œmulti-source cross-lingual NERï¼Œéƒ½æ˜¯é‡‡ç”¨teacher-student learningçš„æ–¹å¼æ¥è¿›è¡Œè®­ç»ƒã€‚</p><ol><li><p><strong>single source cross-lingual NER</strong></p><ol><li><p>trainingï¼šå¯¹äºsingle source cross-lingual NERï¼Œæˆ‘ä»¬æŠŠåœ¨source languageä¸Šè®­ç»ƒå¥½çš„æ¨¡å‹ä½œä¸ºteacher modelã€‚å…·ä½“åœ¨è¿™ç¯‡paperé‡Œé¢ï¼Œé€‰å–mBERTä½œä¸ºteacher modelï¼Œstudent modelå¯ä»¥ä¸teacher modelä¸€æ ·çš„ç»“æ„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ä¸€æ ·çš„ç»“æ„ã€‚æˆ‘ä»¬æŠŠä½¿ç”¨åunlabeled target language dataå»è®­ç»ƒstudent modelï¼Œè®©å…¶å»æ¨¡æ‹Ÿteacher modelè¾“å‡ºçš„å®ä½“æ ‡ç­¾çš„åˆ†å¸ƒã€‚æŸå¤±å‡½æ•°é‡‡ç”¨MSEï¼Œè§£ç ä½¿ç”¨softmaxã€‚<strong>æ³¨æ„ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸å»æ›´æ–°teacher modelçš„å‚æ•°ã€‚</strong>æ¨¡å‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/single-source model.jpg" alt></p></li><li><p>inferenceï¼šæˆ‘ä»¬åªä½¿ç”¨srtudent model æ¥è¿›è¡Œinferenceï¼Œè§£ç ä»ç„¶é‡‡ç”¨softmaxã€‚</p></li></ol></li><li><p><strong>multi-source cross-lingual NER</strong></p><ol><li><p>trainingï¼šå¯¹äºmulti-source cross-lingual NERï¼Œæˆ‘ä»¬æŠŠKä¸ªåœ¨source language dataä¸Šè®­ç»ƒå¥½çš„æ¨¡å‹å½“ä½œteacher model(æ³¨æ„ï¼Œå…±æœ‰Kä¸ªmodelï¼Œæ¯ä¸€ä¸ªæ¨¡å‹åœ¨ä¸€ç§source languageä¸Šè®­ç»ƒè¿‡)ï¼Œsutdent modelçš„ç»“æ„ä»ç„¶å¯ä»¥ç›¸åŒæˆ–è€…ä¸åŒã€‚ä½†æ˜¯ä¸single source cross-lingual NERä¸åŒçš„åœ¨äºï¼Œstudent modelæ˜¯è¦æ‹Ÿåˆteacher modelçš„è¾“å‡ºçš„åˆ†å¸ƒï¼Œè€Œteacher modelæœ‰å¤šä¸ªï¼Œéœ€è¦å¯¹å¤šä¸ªteacher modelsè¿›è¡Œèåˆï¼Œå®é™…ä¸Šå°±æ˜¯å¤šä¸ªteacher modelçš„è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒè¿›è¡ŒåŠ æƒèåˆï¼Œæƒé‡å°±æ˜¯ä¸åŒteacher modelsçš„ç›¸å¯¹é‡è¦æ€§ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\tilde p(x_i^{'},\theta_T)=\sum_{k=1}^{K}\alpha_k\tilde p(x_i^{'},\theta_T^{(k)})</script><p>å…¶ä¸­ï¼Œ$\tilde p(x_i^{â€˜},\theta_T^{(k)})$è¡¨ç¤ºç¬¬$k$ä¸ªteacher modelçš„è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒï¼Œ$\alpha_k$è¡¨ç¤ºç¬¬$k$ä¸ªteacher modelçš„æƒé‡ã€‚å…³é”®æ˜¯$\alpha_k$æ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿåœ¨è¿™ç¯‡paperä¸­ï¼Œè®¾è®¡ä¸€ä¸ªlanguage identiï¬cation auxiliary taskï¼Œæ¥è®¡ç®—$\alpha_k$ã€‚</p><p><strong>language identiï¬cation auxiliary task</strong></p><p>è¿™ä¸ªä»»åŠ¡é€šè¿‡å­¦ä¹ å¾—åˆ°ä¸åŒlanguageçš„language embeddingï¼Œæ¥è®¡ç®—source languageä¸target languageçš„ç›¸ä¼¼åº¦ï¼Œä»è€Œç»™å„ä¸ªteacher modelsåˆ†é…æƒé‡ã€‚å‡è®¾ç¬¬kç§source languageçš„æ•°æ®é›†è¡¨ç¤ºä¸ºï¼š$D^{(k)}_{src}=\{(u^{(k)},k)\}$ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ï¼šå»å­¦ä¹ æ‰€æœ‰çš„ source language embedding vectorï¼š$\mu^{(k)}\in R^mï¼Œk\in 1,2,3,..,K$ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">{\cal L}(P,M)=-\frac{1}{Z}\sum_{(u^{(k)},k)\in D_{src}}CE(softmax(g^T(u)MP),k)+\gamma||PP^T-I||_F^2</script><p>å…¶ä¸­ï¼Œ$P\in R^{m\times K}=\{\mu^{(1)},\mu^{(2)},â€¦,\mu^{(K)}\}$ï¼ŒKè¡¨ç¤ºKç§è¯­è¨€ï¼Œmè¡¨ç¤ºå…¶embedding dimensionï¼Œ$g^T(u)$è¡¨ç¤ºå¾—åˆ°$u$çš„sentence embeddingï¼Œ$k$æˆ‘ä¸ªäººè§‰å¾—æ˜¯ä¸€ä¸ªone-hot vectorï¼Œè¦ä¸ç„¶ä¸å¯¹åŠ²ã€‚å¾—åˆ°$P$ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—$\alpha$äº†ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\alpha_k=\frac{1}{|D_{tgt}|}\sum_{x^{'}\in D_{tgt}}\frac{exp(g^T(x^{'})M\mu^{(k)}/\tau)}{\sum_{i=1}^Kexp(g^T(x^{'})M\mu^{(i)}/\tau)}</script><p>å…¶ä¸­ï¼Œ$|D_{tgt}|$è¡¨ç¤ºtarget language dataä¸­çš„æ ·æœ¬æ•°ç›®ï¼Œ$\tau$è®¾ç½®ä¸ºæ‰€æœ‰çš„$g^T(x^{â€˜})M\mu^{(k)}/\tau)$çš„æ–¹å·®ï¼Œä»è€Œä¿è¯å¾—åˆ°çš„$\alpha$ä¸ä¼šä¸º0ä¹Ÿä¸ä¼šä¸º1ã€‚æ€»çš„æ¥çœ‹ï¼Œè¿™ä¸ªä»»åŠ¡è¿˜æ˜¯è›®ç®€å•çš„ï¼Œä½†æ˜¯å¾ˆworkã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<strong>åœ¨å®é™…å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹$M$ä½¿ç”¨äº†ä½ç§©è¿‘ä¼¼ï¼Œä»è€Œå‡å°‘å‚æ•°é‡ï¼ŒåŠ å¿«è®­ç»ƒã€‚</strong></p></li><li><p>inferenceï¼šè¿˜æ˜¯åªä½¿ç”¨student modelæ¥è¿›è¡Œinferenceï¼Œè§£ç ä½¿ç”¨softmaxã€‚</p></li></ol></li></ol><h3 id="experiment-1"><a href="#experiment-1" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCoNLL-2002ã€CoNLL-2003</p></li><li><p>hypoparametersçš„è®¾ç½®å‚è€ƒåŸå§‹è®ºæ–‡</p></li><li><p>å®éªŒç»“æœ</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/single-result.jpg" style="zoom:50%;"></p></li></ol><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/multi-result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼Œæ•ˆæœæ˜¯æƒŠäººçš„ï¼Œåœ¨single source cross-lingual NERä¸­ï¼Œä»…ä»…ä½¿ç”¨unlabeled target language dataï¼Œå°±è¶…è¶Šäº†meta learningé‚£ç¯‡çš„ç»“æœï¼›å¯¹äºmulti-source cross-lingual NERä¸­ï¼Œæ•ˆæœæ›´æ˜¯å¤§å¹…æé«˜ï¼Œè¯´æ˜teacher-student learningè¿™ç§æ–¹æ³•æœ‰ç€å¾ˆå¤§çš„æ½œåŠ›ã€‚ä¹‹åå¯ä»¥å†åœ¨è¿™ä¸Šé¢åšä¸€äº›æ¢ç´¢ã€‚</p><h2 id="UniTrans-Unifying-Model-Transfer-and-Data-Transfer-for-Cross-Lingual-Named-Entity-Recognition-with-Unlabeled-Data-IJCAI2020"><a href="#UniTrans-Unifying-Model-Transfer-and-Data-Transfer-for-Cross-Lingual-Named-Entity-Recognition-with-Unlabeled-Data-IJCAI2020" class="headerlink" title="UniTrans : Unifying Model Transfer and Data Transfer for Cross-Lingual Named Entity Recognition with Unlabeled Data(IJCAI2020)"></a>UniTrans : Unifying Model Transfer and Data Transfer for Cross-Lingual Named Entity Recognition with Unlabeled Data(IJCAI2020)</h2><h3 id="background-2"><a href="#background-2" class="headerlink" title="background"></a>background</h3><p>è¿™ç¯‡åŒæ ·ä¹Ÿæ˜¯ç ”ç©¶zero-resource cross-lingual NERã€‚ç›®å‰åœ¨cross-lingual NERå¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹åœ¨ä¸Šé¢åº”æåˆ°è¿‡äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚è¿™ç¯‡paperå¸Œæœ›èƒ½å¤Ÿå¯¹ä¸¤ç§æ–¹æ³•è¿›è¡Œç»“åˆï¼Œä»è€Œå……åˆ†åˆ©ç”¨ä¸¤è€…çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶é¿å…å…¶ç¼ºç‚¹ã€‚æ‰€ä»¥å°±æå‡ºäº†unitransæ¨¡å‹ã€‚é¢å¤–è¯´ä¸€å¥ï¼Œè¿™ç¯‡paperåº”è¯¥æ˜¯zero-resource cross-lingual NERçš„SOTAï¼Œç»“æœå¤§å¹…è¶…è¶Šä¹‹å‰æ‰€è®²è§£çš„ä¸¤ç¯‡paperï¼Œéå¸¸ä¼˜ç§€çš„è®ºæ–‡ï¼Œå€¼å¾—ä¸€è¯»ã€‚</p><h3 id="model-2"><a href="#model-2" class="headerlink" title="model"></a>model</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/unitrans.jpg" alt></p><p>unitransæ•´ä½“çš„æ¶æ„æ˜¯ï¼š1.æˆ‘ä»¬é¦–å…ˆç¡®å®šä¸€ä¸ªbase modelï¼Œç„¶åä½¿ç”¨source language training data $D_{src}$æ¥è®­ç»ƒbase modelå¾—åˆ°æ–°çš„å‚æ•°ä¸º$\theta_{src}$ çš„ modelï¼›å¯¹source language dataé€šè¿‡word-to-word translationæ¥å¾—åˆ°ç¿»è¯‘åçš„target language data $D_{trans}$ï¼ŒåŸºäº$\theta_{src}$,ä½¿ç”¨ç¿»è¯‘åçš„$D_{trans}$æ¥å¯¹å‚æ•°ä¸º$\theta_{src}$çš„NER modelè¿›è¡Œfine-tuneï¼Œå¹¶å°†fine-tuningåçš„NER modelä½œä¸ºteacher model(å‚æ•°ï¼š$\theta_{teach}$)ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨$D_{trans}$æ¥è®­ç»ƒbase modelï¼Œå¾—åˆ°å‚æ•°ä¸º$\theta_{trans}$çš„æ¨¡å‹(ä¸åŸºäº$\theta_{src}$)ï¼›2.æˆ‘ä»¬å¾—åˆ°ä¸‰ä¸ªæ¨¡å‹ï¼ˆ$\theta_{src}ã€\theta_{teach}ã€\theta_{trans}$ï¼‰ä¹‹åï¼Œé€šè¿‡è®¾è®¡ä¸€ç§votingæœºåˆ¶ï¼Œå»å¾—åˆ°unlabeled target language dataçš„pseudo labelï¼Œç„¶åä½¿ç”¨pseudo labelæ¥è®­ç»ƒstudent modelã€‚ä¸‹é¢ä¾æ¬¡è®²è§£å…¶ä¸­é‡è¦çš„compomentã€‚</p><p><strong>base modelï¼š</strong>åœ¨è¿™ç¯‡paperä¸­ï¼Œå°±æ˜¯ä¸€ä¸ªmBERT+softmaxï¼Œlosså°±æ˜¯entity-levelçš„ce lossã€‚</p><p><strong>word-to-word translationï¼š</strong>è¿™ä¸€éƒ¨åˆ†å€Ÿé‰´çš„æ˜¯ã€ŠWord translation without parallel dataã€‹paperä¸­çš„åšæ³•ã€‚å…·ä½“åšæ³•æ˜¯ï¼šå‡è®¾æˆ‘ä»¬å·²ç»å¾—åˆ°source languageä¸target languageçš„word embeddingï¼š$Sï¼ŒT\in R^{d\times D}$ï¼Œå¹¶ä¸”å¾—åˆ°äº†Då¯¹wordçš„è¯å…¸ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªå˜åŒ–ï¼Œä½¿å¾—ä¸¤ä¸ªè¯­è¨€çš„wordå¯ä»¥ç›¸äº’è½¬æ¢ã€‚å…¬å¼æ˜¯ï¼š</p><script type="math/tex; mode=display">P=argmin_{P^{'}}||P^{'}S-T||_F</script><p>å¾—åˆ°$P$ä¹‹åï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªsource language wordï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€è¿‘é‚»çš„æ–¹æ³•æ¥æ‰¾åˆ°å¯¹åº”çš„ç¿»è¯‘ã€‚ä½†æ˜¯å…³é”®æ˜¯æ€ä¹ˆæ‰¾åˆ°æœ€è¿‘é‚»å‘¢ï¼Ÿæ–¹æ³•æ˜¯å®šä¹‰CSLSæ–¹æ³•æ¥è¡¡é‡ä¸åŒè¯­è¨€çš„wordä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚å…·ä½“å¯ä»¥å‚çœ‹<a href="https://zhuanlan.zhihu.com/p/30218451" target="_blank" rel="noopener">link</a>ã€‚</p><p><strong>knowleage distillationï¼š</strong>å¾—åˆ°ä¸‰ä¸ªæ¨¡å‹($\theta_{src}ã€\theta_{teach}ã€\theta_{trans}$)ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›æ¨¡å‹çš„çŸ¥è¯†è’¸é¦ç»™studentã€‚å…·ä½“åšæ³•æ˜¯å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬å°†unlabeled target language dataè¾“å…¥åˆ°$\theta_{teach}$ä¸$\theta_{stu}$ä¸­ï¼Œæ¥è®©$\theta_{stu}$æ¨¡å‹å»æ‹Ÿåˆ$\theta_{teach}$çš„è¾“å‡ºçš„åˆ†å¸ƒï¼Œlossä½¿ç”¨MSEï¼›è¿™æ ·åšï¼Œä¸ä»…å¯ä»¥å°†$\theta_{teach}$çš„çŸ¥è¯†è’¸é¦ç»™$\theta_{stu}$ï¼ŒåŒæ—¶è¿˜èƒ½è®©$\theta_{stu}$å­¦ä¹ åˆ°unlabeled language dataä¸­çš„ä¿¡æ¯ï¼›</li><li>æˆ‘ä»¬å¸Œæœ›è¿›ä¸€æ­¥æå‡student modelçš„æ•ˆæœï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼šæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¾—åˆ°unlabel target language dataçš„pseudo labelï¼Œç„¶åä½¿ç”¨pseudo labelæ¥è®­ç»ƒstudent modelã€‚å…·ä½“æ€ä¹ˆå¾—åˆ°pesudo labelå‘¢ï¼Ÿæˆ‘ä»¬è®¾è®¡äº†ä¸€ç§voting æœºåˆ¶ï¼Œæˆ‘ä»¬å°†unlabel target langugaeè¾“å…¥åˆ°ä¸‰ä¸ªæ¨¡å‹å½“ä¸­ï¼Œåªæœ‰å½“ä¸‰ä¸ªæ¨¡å‹çš„è¾“å‡ºçš„ç»“æœå®Œå…¨ç›¸ç­‰æ—¶ï¼Œæˆ‘ä»¬æ‰ç»™å…¶æ ‡ä¸Šlabelï¼Œç„¶åä½¿ç”¨è¿™äº›æ•°æ®æ¥è®­ç»ƒsutdent modelã€‚</li><li>ç»¼åˆç¬¬ä¸€æ­¥ä¸ç¬¬äºŒæ­¥ï¼Œknowledge distillationçš„æ€»çš„lossï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š</li></ol><script type="math/tex; mode=display">{\cal L}(\theta_{stu})=\frac{1}{|{\cal D}_T|}\sum_{\tilde x\in {\cal D}_T}(\eta{\cal L}_{hard}^{\tilde x}+{\cal L}_{soft}^{\tilde x})</script><p>å…¶ä¸­ï¼Œ${\cal L}_{hard}^{\tilde x}$æ˜¯ç¬¬äºŒæ­¥çš„lossï¼Œ${\cal L}_{soft}^{\tilde x}$æ˜¯ç¬¬ä¸€æ­¥çš„lossï¼Œ$\eta=1$ã€‚</p><p><strong>inferenceï¼š</strong>æˆ‘ä»¬åªä½¿ç”¨student modelï¼Œå¦å¤–æ³¨æ„ï¼Œè§£ç ä½¿ç”¨CRFã€‚</p><h3 id="experiment-2"><a href="#experiment-2" class="headerlink" title="experiment"></a>experiment</h3><ol><li><p>æ•°æ®é›†ï¼šCoNLL-2002ã€CoNLL-2003ã€NoDaLiDa-2019</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/unitrans-result.jpg" alt></p><p>ä»ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•ˆæœæå‡éå¸¸å¤§ï¼Œè¿™ä¸ªè¿˜å¯ä»¥é€šè¿‡teacher ensemblingè¿›ä¸€æ­¥æå‡æ•ˆæœã€‚ä½œè€…ä¹Ÿåšäº†ä¸€äº›æ¶ˆèå®éªŒï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/19/NLP-Cross-Lingual-NER/ablation.jpg" alt></p><p>è¿™ç¯‡è®ºæ–‡ç»“æœçœŸçš„å¤ªå¼ºäº†ï¼Œç”šè‡³ç»™æˆ‘æ„Ÿè§‰ä½¿ç”¨teacher-student learningè¿™ç§æ–¹å¼æ¥åšcross-lingual NERï¼Œè¿™ç¯‡paperåˆ°é¡¶äº†ã€‚</p></li></ol><h2 id="GRN-model-not-for-cross-lingual-NER"><a href="#GRN-model-not-for-cross-lingual-NER" class="headerlink" title="GRN model(not for cross-lingual NER)"></a>GRN model(not for cross-lingual NER)</h2><h3 id="background-3"><a href="#background-3" class="headerlink" title="background"></a>background</h3><p>GRNæ¨¡å‹æ˜¯2019å¹´MSRAå‘è¡¨åœ¨AAAIä¸Šçš„ã€ŠGRN: Gated Relation Network to Enhance Convolutional Neural Network for Named Entity Recognitionã€‹ã€‚åœ¨NERä»»åŠ¡ä¸­ï¼Œç”±äºå…¶å¯¹wordçš„ä½ç½®ä¿¡æ¯æå…¶æ•æ„Ÿï¼Œæ‰€ä»¥å¸¸ç”¨çš„ç¼–ç å™¨å¸¸å¸¸ä½¿ç”¨RNNï¼Œä½†æ˜¯RNNç³»åˆ—çš„ç¼–ç å™¨æœ€å¤§çš„ç¼ºç‚¹å°±åœ¨äºå¹¶è¡Œæ•ˆç‡å¤ªä½ï¼Œè€ŒCNNç›¸æ¯”RNNæ¥è¯´ï¼Œæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºï¼šå¹¶è¡Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯å…¶ç¼ºç‚¹åœ¨äºCNNåªèƒ½å¯¹wordå‘¨è¾¹çš„ä¿¡æ¯è¿›è¡Œå»ºæ¨¡ï¼Œæ•æ‰å±€éƒ¨context informationï¼Œä½†æ˜¯CNNå¯¹global context informationçš„æ•æ‰èƒ½åŠ›å¤ªå¼±ï¼ŒåŸºäºCNNçš„NERæ¨¡å‹(IDCNN)åœ¨NERä»»åŠ¡ä¸Šçš„ç»“æœéƒ½å¼±äºRNNç³»åˆ—çš„NERæ¨¡å‹ï¼Œ<strong>æ‰€ä»¥ï¼Œæ˜¯å¦èƒ½å¤Ÿè®¾è®¡æŸç§æœºåˆ¶ï¼Œè®©CNNèƒ½å¤Ÿæ•æ‰åˆ°global context informationå‘¢ï¼Ÿ</strong>åœ¨GRNé‡Œï¼Œé€šè¿‡ä½¿ç”¨gatingæœºåˆ¶å¯¹sentenceä¸­çš„ä»»æ„ä¸¤ä¸ªwordä¹‹é—´çš„relationè¿›è¡Œå»ºæ¨¡ï¼Œä»è€Œè®©CNNæ•æ‰global context informationçš„èƒ½åŠ›å¤§å¤§æé«˜ï¼Œè¿™å°±æ˜¯GRNæå‡ºçš„èƒŒæ™¯ã€‚</p><blockquote><p>åæ§½ä¸€ä¸‹ï¼Œè¿™ç¯‡è¯´å®è¯å¾ˆä¸€èˆ¬ï¼ŒideaçœŸçš„ä¸€èˆ¬ï¼Œ2019å¹´ï¼ŒBERTéƒ½å‡ºæ¥äº†ï¼Œåœ¨GRNçš„å®éªŒé‡Œï¼Œéƒ½æ²¡æœ‰ä½¿ç”¨BERTæ¥è¿›è¡Œå¯¹æ¯”ï¼Œç»“æœä¹Ÿæ²¡å•¥è¯´æœåŠ›ã€‚</p></blockquote><h3 id="GRN-model"><a href="#GRN-model" class="headerlink" title="GRN model"></a>GRN model</h3><p>æ•´ä¸ªGRNæ¨¡å‹åˆ†ä¸ºå››å±‚ï¼š<strong>representation layerã€context layerã€relation layerã€CRF layerã€‚</strong></p><ol><li><p><strong>representation layerï¼š</strong>å‡è®¾è¾“å…¥çš„sentenceè¡¨ç¤ºä¸ºï¼š$s=\{s_1,s_2,â€¦,s_T\}$ï¼Œæ¯ä¸€ä¸ªtokenå¯¹åº”çš„æ ‡ç­¾è¡¨ç¤ºä¸ºï¼š$y=\{y_1,y_2,..,y_T\}$ã€‚æ•´ä¸ªlayerçš„è¾“å‡ºæœ‰ä¸¤éƒ¨åˆ†ï¼šç”±GloVeåˆå§‹åŒ–çš„word embedding(update in training stage)+char embeddingé€šè¿‡kernel=3çš„CNN+max-over-time poolingï¼Œä»è€Œå¾—åˆ°char featureã€‚ç¬¬ä¸€éƒ¨åˆ†è¡¨ç¤ºä¸ºï¼š$w_i=E(s_i)$ï¼›ç¬¬äºŒéƒ¨åˆ†ï¼š$c_i$ï¼Œè¾“å‡ºæ˜¯ä¸¤è€…concatçš„ç»“æœï¼š$z_i=[c_i,w_i]$ã€‚</p></li><li><p><strong>context layerï¼š</strong>è¿™ä¸€å±‚ä¸»è¦æ˜¯æ•æ‰wordçš„å±€éƒ¨ä¿¡æ¯ã€‚å…·ä½“åšæ³•æ˜¯ï¼šä½¿ç”¨å¤šä¸ªä¸åŒkernel sizeçš„CNN(ç­‰é•¿å·ç§¯ï¼Œkernel size=1ï¼Œ3ï¼Œ5)æ¥å¾—åˆ°encodingçš„è¾“å‡ºï¼Œå·ç§¯çš„æ¿€æ´»å‡½æ•°ä½¿ç”¨$tanh$ï¼Œç„¶åå¯¹ä½¿ç”¨æ¿€æ´»å‡½æ•°ä¹‹åçš„ç»“æœè¿›è¡Œconcatï¼Œå†ä½¿ç”¨max pooling(ä¸æ˜¯global max poolingï¼Œæ‰€ä»¥ç»´åº¦æ•°ç›®ä¸å˜)ã€‚</p></li><li><p><strong>relation layerï¼š</strong>è¿™ä¸€å±‚çš„ç›®çš„ä¸»è¦æ˜¯ç”¨æ¥å¯¹sentenceä¸­çš„ä»»æ„ä¸¤ä¸ªwordä¹‹é—´çš„å…³ç³»è¿›è¡Œmodelingï¼Œå¹¶åˆ©ç”¨gatingæœºåˆ¶æ¥è·å–å…¨å±€å†…å®¹ä¿¡æ¯ï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹(å…¶å®è¿˜æ˜¯attentionï¼Œæ²¡å•¥åˆ›æ–°ï¼Œä¸è¿‡è¿™ä¸ªlayerçš„å®ç°codeè¿˜æ˜¯å¯ä»¥å»çœ‹çœ‹çš„)ï¼š</p><script type="math/tex; mode=display">\alpha_{i,j}=\sigma(W[x_i;x_j]+b_x) \\r_i=\frac{1}{T}\sum_{j=1}^{T}\alpha_{ij}*x_j \\p_i=tanh(r_i)</script><p>å…¶ä¸­ï¼Œ$r_i$å°±æ˜¯word $x_i$çš„å…¨å±€fusion featureï¼Œå½“ç„¶äº†ï¼Œä¸ºäº†å¢åŠ éçº¿æ€§ï¼Œå¯¹$r_i$ä½¿ç”¨tanhè¿›è¡Œå˜æ¢ï¼Œå¾—åˆ°$p_i$ï¼Œè¿™å°±æ˜¯æœ€ç»ˆè¾“å…¥åˆ°CRFçš„è¾“å…¥ã€‚</p></li><li><p><strong>CRF layerï¼š</strong>å°±æ˜¯æ ‡å‡†çš„CRF layerã€‚</p></li></ol><h3 id="experiment-3"><a href="#experiment-3" class="headerlink" title="experiment"></a>experiment</h3><ol><li>æ•°æ®é›†ï¼šCoNLL-2003 English NERã€OntoNotes 5.0</li><li>hypoparametersçš„è®¾ç½®è¯·å‚è€ƒåŸå§‹è®ºæ–‡ï¼Œå…·ä½“ç»“æœå°±ä¸æ”¾äº†ï¼Œåæ­£å°±åœ¨å½“æ—¶è¾¾åˆ°äº†SOTAï¼Œanywayã€‚</li></ol><h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p>ã€ŠEnhanced Meta-Learning for Cross-lingual Named Entity Recognition with Minimal Resourcesã€‹</p><p>codeï¼š<strong><a href="https://github.com/microsoft/vert-papers/tree/master/papers/Meta-Cross" target="_blank" rel="noopener">https://github.com/microsoft/vert-papers/tree/master/papers/Meta-Cross</a></strong></p><p>ã€ŠSingle-/Multi-Source Cross-Lingual NER via Teacher-Student Learning on Unlabeled Data in Target Languageã€‹ã€</p><p>codeï¼š<strong><a href="https://github.com/microsoft/vert-papers/tree/master/papers/SingleMulti-TS" target="_blank" rel="noopener">https://github.com/microsoft/vert-papers/tree/master/papers/SingleMulti-TS</a></strong></p><p>ã€ŠUniTrans : Unifying Model Transfer and Data Transfer for Cross-Lingual Named Entity Recognition with Unlabeled Dataã€‹</p><p>codeï¼š <strong><a href="https://github.com/microsoft/vert-papers/tree/master/papers/UniTrans" target="_blank" rel="noopener">https://github.com/microsoft/vert-papers/tree/master/papers/UniTrans</a></strong></p><p>ã€ŠGRN: Gated Relation Network to Enhance Convolutional Neural Network for Named Entity Recognitionã€‹ã€‚</p><p>codeï¼š<strong><a href="https://github.com/HuiChen24/NER-GRN" target="_blank" rel="noopener">https://github.com/HuiChen24/NER-GRN</a></strong></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> cross-lingual NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|Adaptive Embedding paradigm in ChineseNER</title>
      <link href="2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸­æ–‡NERçš„Adaptive Embedding paradigmã€‚æ‰€è°“çš„Adaptive Embedding paradigmï¼ŒæŒ‡çš„æ˜¯åªåœ¨embeddingéƒ¨åˆ†è¿›è¡Œæ”¹è¿›ï¼Œä»è€Œè®©æˆ‘ä»¬ä¸éœ€è¦è®¾è®¡éå¸¸çš„å¤æ‚çš„ç»“æ„ï¼Œèƒ½å¤Ÿè¿ç§»åˆ°ä¸åŒçš„æ¨¡å‹ç»“æ„ä¸Š(RNN/CNN/transformer etc)ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•çš„å¥½å¤„å°±åœ¨äºå…¶å¯è¿ç§»æ€§ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£ä¸‰ç¯‡è®ºæ–‡ï¼šã€ŠAn Encoding Strategy Based Word-Character LSTM for Chinese NERã€‹ã€ã€ŠA Neural Multi-digraph Model for Chinese NER with Gazetteersã€‹ä»¥åŠACL2020çš„ã€ŠSimplify the Usage of Lexicon in Chinese NERã€‹ã€‚</p><a id="more"></a><h2 id="WC-LSTMæ¨¡å‹"><a href="#WC-LSTMæ¨¡å‹" class="headerlink" title="WC-LSTMæ¨¡å‹"></a>WC-LSTMæ¨¡å‹</h2><h3 id="æå‡ºçš„èƒŒæ™¯"><a href="#æå‡ºçš„èƒŒæ™¯" class="headerlink" title="æå‡ºçš„èƒŒæ™¯"></a>æå‡ºçš„èƒŒæ™¯</h3><p>WC-LSTMæ¨¡å‹æ˜¯2019å¹´å‘è¡¨åœ¨NAACLä¸Šçš„ã€ŠAn Encoding Strategy Based Word-Character LSTM for Chinese NERã€‹è®ºæ–‡ã€‚æå‡ºçš„èƒŒæ™¯è¿˜æ˜¯å› ä¸ºLatticeLSTMæ¨¡å‹ã€‚LatticeLSTMæ˜¯è¯æ±‡å¢å¼ºçš„å…¸å‹æ¨¡å‹ï¼Œä½†æ˜¯å…¶å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼š<strong>ç”±äºæ¯ä¸€ä¸ªsentenceæ‰€è¢«åŒ¹é…åˆ°çš„wordçš„æ•°é‡ä¸ä½ç½®éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯¼è‡´LatticeLSTMæ¨¡å‹æ— æ³•batchè®­ç»ƒä¸inferenceã€‚</strong>åœ¨WC-LSTMä¸­ï¼Œä¸ºäº†å®ç°å¹¶è¡ŒåŒ–ï¼Œéœ€è¦å¯¹æ¯ä¸€ä¸ªcharacteræ‰€åŒ¹é…åˆ°çš„wordsè¿›è¡Œç¼–ç ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªfixed embeddingï¼Œå†ä¸characteræœ¬èº«çš„embeddingè¿›è¡Œèåˆï¼Œæœ€åè¾“é€åˆ°ç½‘ç»œä¸­è¿›è¡Œè®­ç»ƒã€‚æ‰€ä»¥ï¼Œå…³é”®å°±åœ¨äºï¼š<strong>æ€ä¹ˆå¾—åˆ°ä¸€ä¸ªfixed embeddingï¼Ÿ</strong>ä¸‹é¢å…·ä½“ä»‹ç»ã€‚</p><h3 id="WC-LSTMæ¨¡å‹ä»‹ç»"><a href="#WC-LSTMæ¨¡å‹ä»‹ç»" class="headerlink" title="WC-LSTMæ¨¡å‹ä»‹ç»"></a>WC-LSTMæ¨¡å‹ä»‹ç»</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/wc-lstm.jpg" alt></p><ol><li><strong>inputï¼š</strong>è¾“å…¥æœ‰ä¸¤éƒ¨åˆ†ï¼šsentenceä»¥åŠä¸sentenceç›¸åŒ¹é…çš„lexicon wordsï¼Œå‡è®¾è¾“å…¥çš„sentenceè¡¨ç¤ºä¸ºï¼š$s=\{c_1,c_2,â€¦,c_n\}$ï¼Œå…¶ä¸­$c_i$è¡¨ç¤ºsentenceçš„ç¬¬$i$ä¸ªcharacterï¼›lexicon wordsè¡¨ç¤ºä¸ºï¼š$c_{b,e}$ï¼Œåœ¨å‰å‘çš„wc-lstmä¸­ï¼Œä½¿ç”¨$\overrightarrow{ws_i} $æ¥è¡¨ç¤ºä»¥$c_i$çš„ç»“å°¾çš„matched lexicon wordsçš„é›†åˆï¼Œåå‘çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚æ‰€ä»¥æœ€ç»ˆçš„è¾“å…¥æ˜¯ï¼š$\overrightarrow{rs}=\{(c_1,\overrightarrow{ws_1}),(c_2,\overrightarrow{ws_2}),â€¦,(c_n,\overrightarrow{ws_n})\}$ï¼Œåœ¨WC-LSTMä¸­ï¼Œä½¿ç”¨åŒå‘çš„LSTMï¼Œæ‰€ä»¥è¿˜æœ‰$\overleftarrow{rs}=\{(c_n,\overleftarrow{ws_n}),(c_{n-1},\overleftarrow{ws_{n-1}}),â€¦,(c_1,\overleftarrow{ws_1})\}$ã€‚</li><li><strong>word-character embedding layerï¼š</strong>åœ¨$\overrightarrow {rs}$ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªcharacter $c_i$ï¼Œå¯¹åº”ä¸€ä¸ªlexicon wordsé›†åˆ$\overrightarrow{ws_i}=\{\overrightarrow{w_{i1}},â€¦,\overrightarrow{w_{s^p_i}}\}$ï¼Œ$\overrightarrow{ws_i}$ä¸­çš„wordæ•°ç›®è®°ä¸ºï¼š$s^t_i$ï¼Œå¯¹äºä¸€ä¸ªbatchæ¥è¯´ï¼Œæˆ‘é—¨é€šè¿‡paddingçš„æ–¹å¼è®©æ¯ä¸€ä¸ªsentenceçš„ç›¸åŒä½ç½®æœ‰åŒæ ·çš„$s^p_i$ã€‚æ¯ä¸€ä¸ªcharacterçš„embeddingï¼Œå¯ä»¥é€šè¿‡æŸ¥pretrained char embedding tableå¾—åˆ°ï¼Œè®°åšï¼š$x^c_i=e^c(c_i)$ï¼Œæ¯ä¸€ä¸ªlexicon wordçš„embeddingä¹Ÿå¯ä»¥æŸ¥è¡¨ï¼Œè®°åšï¼š$x^{\overrightarrow{w}}_{il}=e(\overrightarrow{w_{il}})$ã€‚</li><li><strong>word encoding strategyï¼š</strong>åœ¨WC-LSTMä¸­ï¼Œæ¢ç´¢äº†å››ç§encodingç­–ç•¥ï¼šæœ€çŸ­è¯æ±‡ä¿¡æ¯ã€æœ€é•¿è¯æ±‡ä¿¡æ¯ã€avgã€self-attentionã€‚æœ€çŸ­è¯æ±‡ä¿¡æ¯æŒ‡çš„æ˜¯ï¼šä½¿ç”¨$c_i$ä¸­çš„è¯æ±‡é›†åˆä¸­é•¿åº¦æœ€çŸ­çš„è¯ä½œä¸º$c_i$çš„è¯æ±‡ä¿¡æ¯ï¼›æœ€é•¿è¯æ±‡ä¿¡æ¯æŒ‡çš„æ˜¯ï¼šä½¿ç”¨å½“å‰characterçš„è¯æ±‡é›†åˆä¸­çš„æœ€é•¿çš„è¯ä½œä¸º$c_i$çš„è¯æ±‡ä¿¡æ¯ï¼›avgæ˜¯å¯¹æ‰€æœ‰çš„è¯æ±‡ä¿¡æ¯è¿›è¡Œç®€å•çš„ç®—æœ¯å¹³å‡ï¼›self-attentionå°±æ˜¯è‡ªå·±å¯¹è‡ªå·±è¿›è¡Œattentionï¼Œæ¯”è¾ƒç®€å•ã€‚å¾—åˆ°$c_i$çš„è¯æ±‡ä¿¡æ¯åï¼Œå°†å…¶ä¸$c_i$çš„embedingè¿›è¡Œconcatï¼Œä½œä¸ºåç»­çš„è¾“å…¥ã€‚</li><li><strong>wc-lstmï¼š</strong>è¿™å°±æ˜¯å‰å‘çš„LSTMçš„ç»“æœä¸åå‘çš„LSTMçš„ç»“æœè¿›è¡Œconcatï¼Œä½œä¸ºCRFçš„è¾“å…¥ã€‚</li><li><strong>decodingï¼š</strong>ä½¿ç”¨æ ‡å‡†çš„CRFå±‚ã€‚</li></ol><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><ol><li>æ•°æ®é›†ï¼šOntoNotesã€MSRAã€Weiboã€resume</li><li>å®éªŒç»“æœå°±ä¸æ”¾äº†ï¼Œæ¯”Latticeåªç¨å¾®å¥½ä¸€ç‚¹ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯é¢„æ–™ä¹‹ä¸­çš„ï¼Œæ¯•ç«Ÿwc-lstmçš„ä¸»è¦ç›®çš„æ˜¯å¹¶è¡ŒåŒ–ã€‚</li><li>å®éªŒè¿˜æ¢ç©¶äº†ä¸åŒçš„encodingç­–ç•¥ï¼Œæœ€åå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼šå¦‚æœè®­ç»ƒæ•°æ®æ¯”è¾ƒå……è¶³çš„è¯ï¼Œå»ºè®®ä½¿ç”¨self-attentionå’Œavgï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°è¾ƒå¤šï¼Œå¦‚æœè®­ç»ƒæ•°æ®æ¯”è¾ƒå°‘çš„è¯ï¼Œå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œä»è€Œåœ¨æµ‹è¯•é›†ä¸Šè¡¨ç°ä¸å¥½ï¼›å¦‚æœè®­ç»ƒæ•°æ®æ¯”è¾ƒå°‘çš„è¯ï¼Œæœ€çŸ­è¯æ±‡ä¿¡æ¯å’Œæœ€é•¿è¯æ±‡ä¿¡æ¯åˆ†åˆ«é€‚ç”¨äºå¯¹åµŒå¥—å®ä½“ä¸flatå®ä½“æœ‰è¦æ±‚çš„æƒ…å†µã€‚(åæ§½ä¸€ä¸‹ï¼Œè¿™ç»“è®ºæœ‰å•¥ç”¨ï¼Ÿæˆ‘ä¸åšå®éªŒæˆ‘ä¹ŸçŸ¥é“å•ŠğŸ¶)</li></ol><h2 id="Multi-digraphæ¨¡å‹"><a href="#Multi-digraphæ¨¡å‹" class="headerlink" title="Multi-digraphæ¨¡å‹"></a>Multi-digraphæ¨¡å‹</h2><h3 id="æå‡ºçš„èƒŒæ™¯-1"><a href="#æå‡ºçš„èƒŒæ™¯-1" class="headerlink" title="æå‡ºçš„èƒŒæ™¯"></a>æå‡ºçš„èƒŒæ™¯</h3><p>Multi-digraphæ¨¡å‹æ˜¯2019å¹´å‘è¡¨åœ¨ACLä¸Šçš„ã€ŠA Neural Multi-digraph Model for Chinese NER with Gazetteersã€‹è®ºæ–‡ã€‚è¿™ä¸ªæ¨¡å‹æ‰€å…³æ³¨çš„é—®é¢˜word conflictsï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ï¼šåœ¨èåˆè¯æ±‡ä¿¡æ¯çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¤šä¸ªè¯æ±‡è¡¨çš„è¯ï¼Œä¸åŒçš„è¯æ±‡è¡¨å¯¹äºæŸäº›è¯æœ‰ä¸åŒçš„åŒ¹é…ï¼Œè¿™æ ·çš„è¯å¯¹äºå¥å­ä¸­çš„characterçš„æ ‡æ³¨å°±ä¼šæœ‰å¹²æ‰°ï¼Œ<strong>é‚£ä¹ˆæ€ä¹ˆå¾ˆå¥½åœ°å»ºæ¨¡characterä¸è¯å…¸ä¹‹é—´çš„å…³ç³»ä»¥åŠæ€ä¹ˆå¾ˆå¥½åœ°èåˆä¸åŒè¯å…¸çš„è¯æ±‡ä¿¡æ¯ï¼Ÿ</strong>è¿™å°±æ˜¯multi-digraphæ¨¡å‹æå‡ºçš„èƒŒæ™¯ã€‚</p><h3 id="Multi-digraphæ¨¡å‹ä»‹ç»"><a href="#Multi-digraphæ¨¡å‹ä»‹ç»" class="headerlink" title="Multi-digraphæ¨¡å‹ä»‹ç»"></a>Multi-digraphæ¨¡å‹ä»‹ç»</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/multi-graph.jpg" style="zoom: 67%;"></p><p>æ•´ä½“æ¨¡å‹ä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼šembeddingéƒ¨åˆ†+(LSTM+CRF)éƒ¨åˆ†ï¼Œç¬¬äºŒéƒ¨åˆ†æ²¡ä»€ä¹ˆå¯è®²çš„ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹embeddingéƒ¨åˆ†ã€‚</p><p>embeding éƒ¨åˆ†ä¸»è¦æ˜¯æ ¹æ®GGNNæ¥è¿›è¡Œæ„å»ºã€‚æ€ä¹ˆæ„å»ºå›¾å‘¢ï¼Ÿé¦–å…ˆæ˜ç¡®æ¨¡å‹çš„è¾“å…¥ï¼šsentenceä»¥åŠå®ä½“è¯å…¸(gazetteer)ï¼Œé‚£ä¹ˆnode setå°±æ˜¯ï¼šsentenceä¸­æ¯ä¸€ä¸ªchatacterä½œä¸ºnode+<strong>æ¯ä¸€ç§è¯å…¸çš„æ¯ä¸€ç±»</strong>å¯¹åº”ä¸€å¯¹èŠ‚ç‚¹(èµ·å§‹ä¸ç»“æŸ)ï¼Œä¸Šæ–¹æœ‰å››ç§è¯å…¸ï¼Œå› æ­¤æœ‰å››å¯¹èŠ‚ç‚¹ã€‚åœ¨æ¨¡å‹å›¾ä¸­ï¼Œraw spaceä¸­äº”é¢œå…­è‰²çš„ç®­å¤´å°±æ˜¯edgeã€‚æ„å»ºå¥½å›¾åï¼Œå°±å¯ä»¥ä½¿ç”¨GGNNæ¥è¿›è¡Œaggregateï¼Œä»è€Œäº§ç”Ÿæ›´å¥½çš„node representationã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯GGNNï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦é€‰æ‹©GGNNè€Œä¸æ˜¯å…¶ä»–çš„GNNã€‚</p><p><strong>GGNN</strong>ï¼šå…¨ç§°æ˜¯Gated graph sequence neural networksï¼Œæ˜¯ä¸€ç§spatial GNNï¼Œå…¶aggregateçš„æ–¹å¼ä¼˜ç‚¹ç±»ä¼¼äºGRUï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/ggnn.jpg" alt></p><p>å…¶ä¸­ï¼Œ$h_v^{(1)}$è¡¨ç¤ºçš„æ˜¯åˆå§‹çš„embeddingï¼Œå…·ä½“çš„å¯è§<a href="https://zhuanlan.zhihu.com/p/83410937" target="_blank" rel="noopener">link</a>ã€‚ä»aggregateæ›´æ–°çš„æ–¹å¼æ¥çœ‹ï¼Œå°±æ˜¯çŸ¥é“GGNNç›¸æ¯”äºGCNç­‰GNNæ¥è¯´ï¼Œæœ€å¤§çš„ä¼˜åŠ¿æ˜¯æ¯”è¾ƒé€‚ç”¨äºåºåˆ—ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æå–æ–‡æœ¬ä¿¡æ¯ã€‚ä¸è¿‡è¯´å®è¯ï¼Œè¿™é‡Œä½¿ç”¨GNNæœ‰ç‚¹å¼ºè¡Œä¸Šçš„æ„æ€ï¼Œæ²¡çœ‹å‡ºæ¥ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨GGNNã€‚ğŸ§</p><h3 id="å®éªŒç»“æœ-1"><a href="#å®éªŒç»“æœ-1" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><ol><li><p>æ•°æ®é›†ï¼šOntoNotesã€MSRAã€Weiboã€E-commerce(released by this paper)</p></li><li><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/multi-digraph-result.jpg" style="zoom:80%;"></p><p>åœ¨OntoNoteså’ŒMSRAä¸Šçš„ç»“æœæ¯”å¤§éƒ¨åˆ†æ¨¡å‹è¦å¥½ï¼Œåœ¨Weiboæ•°æ®é›†ä¸Šçš„ç»“æœè¦å·®ä¸€äº›ï¼Œæ‰€ä»¥å¤šåŠ è¯æ±‡è¡¨æœç„¶è¿˜æ˜¯ç‹é“å•Šï¼Œä¸è¿‡ç›¸å¯¹çš„ï¼Œä¼°è®¡ä¹Ÿæ— æ³•å¹¶è¡Œäº†å§ã€‚</p></li></ol><h2 id="SoftLexiconæ¨¡å‹"><a href="#SoftLexiconæ¨¡å‹" class="headerlink" title="SoftLexiconæ¨¡å‹"></a>SoftLexiconæ¨¡å‹</h2><h3 id="æå‡ºçš„èƒŒæ™¯-2"><a href="#æå‡ºçš„èƒŒæ™¯-2" class="headerlink" title="æå‡ºçš„èƒŒæ™¯"></a>æå‡ºçš„èƒŒæ™¯</h3><p>åƒLatticeLSTMæ¨¡å‹ï¼Œå®ƒçš„ç¼ºç‚¹å°±æ˜¯ï¼š<strong>1.æ¨¡å‹ç»“æ„è¿‡äºå¤æ‚ï¼Œæ— æ³•è¿ç§»åˆ°å…¶ä»–æ¶æ„ä¸Šï¼Œè€Œä¸”æ— æ³•å¹¶è¡ŒåŒ–ï¼›2.å¹¶æ²¡æœ‰å®Œå…¨èå…¥lexiconçš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¿¡æ¯æŸå¤±ã€‚</strong>é’ˆå¯¹ç¬¬ä¸€ç‚¹ï¼Œsoftlexiconå’Œwclstmæ¨¡å‹ä¸€æ ·ï¼Œé€šè¿‡å°†characteræ‰€åŒ¹é…åˆ°çš„lexicon wordsç¼–ç ä¸ºä¸€ä¸ªfixed vectorï¼Œå¹¶ä¸character embeddingè¿›è¡Œconcatï¼Œä½œä¸ºåç»­æ¨¡å‹çš„è¾“å…¥ï¼›é’ˆå¯¹ç¬¬äºŒç‚¹ï¼Œsoftlexiconé€šè¿‡categorizing æ‰€åŒ¹é…åˆ°çš„lexicon wordsï¼Œä»è€Œé¿å…ä¿¡æ¯æŸå¤±ã€‚å…·ä½“çš„åœ¨ä¸‹é¢å°èŠ‚ä»‹ç»ï½</p><h3 id="SoftLexiconæ¨¡å‹ä»‹ç»"><a href="#SoftLexiconæ¨¡å‹ä»‹ç»" class="headerlink" title="SoftLexiconæ¨¡å‹ä»‹ç»"></a>SoftLexiconæ¨¡å‹ä»‹ç»</h3><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/softlexicon.jpg" alt></p><p>å‡è®¾è¾“å…¥çš„sentenceè¡¨ç¤ºä¸ºï¼š$s=\{c_1,c_2,â€¦,c_n\}$ï¼Œ$w_{i,j}$è¡¨ç¤ºsentenceä¸­ä¸lexiconä¸­ç›¸åŒ¹é…çš„wordã€‚ä¸ºäº†ä¸æŸå¤±ä»»ä½•ä¿¡æ¯ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹æ‰€æœ‰çš„ä¸character $c_i$ç›¸åŒ¹é…çš„lexicon wordséƒ½é‡‡ç”¨<code>BMES</code>æ¥è¿›è¡Œç¼–ç ï¼Œä»è€Œæ¯ä¸€ä¸ªcharacteréƒ½æœ‰4ä¸ªword setsã€‚å…¶å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">B(c_i)=\{w_{i,k},\forall w_{i,k}\in L,i<k<=n\} \\M(c_i)=\{w_{j,k},\forall w_{j,k}\in L,1<=i<j<k<=n\} \\E(c_i)=\{w_{j,i},\forall w_{j,i}\in L,1<=j<i<=n\} \\S(c_i)=\{c_i,\exists c_i\in L\}</script><p>å…¶ä¸­ï¼Œ$L$æ˜¯lexicon,å½“ç„¶å¦‚æœword setä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆä¼šæ·»åŠ ä¸€ä¸ª<code>NONE</code>è¿›å»ã€‚å…·ä½“çš„ä¾‹å­å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/softlexicon_example.jpg" alt></p><p>å¯¹äºæ¯ä¸€ä¸ªcharacter $c_i$ï¼Œæˆ‘ä»¬éƒ½èƒ½å¾—åˆ°word setsã€‚å¾—åˆ°word setsä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹word setsè¿›è¡Œå‹ç¼©ã€‚è®ºæ–‡é‡Œå®éªŒäº†ä¸¤ç§æ–¹æ³•ï¼šmean-poolingä¸weighting methodï¼Œå®éªŒè¡¨æ˜åè€…è¦æ›´å¥½ä¸€äº›ã€‚å…·ä½“æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬è¦è®¡ç®—character $c_i$çš„$B(c_i)$çš„representation vectorï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯ä¸€ä¸ªwordçš„frequencyä½œä¸ºè¯¥è¯çš„æƒé‡ï¼Œä¹‹æ‰€ä»¥è¿™æ ·åšè€Œæ²¡æœ‰ä½¿ç”¨åƒattentionè¿™æ ·çš„æ–¹æ³•ï¼Œæ˜¯å› ä¸ºæƒ³è¦æé«˜é€Ÿåº¦ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">v^s(S)=\frac{4}{Z}\sum_{w\in S}z(w)e^w(w) \\Z=\sum_{w\in B\cup M\cup E\cup S}z(w)</script><p>å…¶ä¸­ï¼Œ$S\in \{B,M,E,S\}$ï¼Œ$z(w)$è¡¨ç¤ºword $w$çš„è¯é¢‘ã€‚</p><p>åˆ†åˆ«å¾—åˆ°<code>BMES</code>çš„representation vectorä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¸characterè¿›è¡Œconcatï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">x^c=[x^c,e^s(B,M,E,S)] \\e^s(B,M,E,S)=[v^s(B),v^s(M),v^s(E),v^s(S)]</script><p>ç„¶åå°†$x^c$è¾“å…¥åˆ°BILSTM+CRFä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</p><h3 id="å®éªŒç»“æœ-2"><a href="#å®éªŒç»“æœ-2" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><ol><li><p>æ•°æ®é›†ï¼šOntoNotesã€MSRAã€Weiboã€resume</p></li><li><p>å®éªŒç»“æœ</p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/ontonotes_msra_softlexicon.jpg" alt></p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/weibo_softmlexicon.jpg" style="zoom:50%;"></p><p><img src="/2020/10/19/NLP-NER-SimpleLexicon%E6%A8%A1%E5%9E%8B/resume_softlexicon.jpg" style="zoom:50%;"></p><p>ä»ç»“æœä¸Šçœ‹ï¼Œè¿˜æ˜¯ä¸é”™çš„ï¼Œè€Œä¸”speedä¸Šæœ‰äº†å¾ˆå¤§çš„æå‡ã€‚</p></li></ol><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠAn Encoding Strategy Based Word-Character LSTM for Chinese NERã€‹</p><p>wc-lstm codeï¼š<a href="https://github.com/liuwei1206/CCW-NER" target="_blank" rel="noopener">https://github.com/liuwei1206/CCW-NER</a></p><p>ã€ŠA Neural Multi-digraph Model for Chinese NER with Gazetteersã€‹</p><p>multi-digraph codeï¼š<a href="https://github.com/PhantomGrapes/MultiDigraphNER" target="_blank" rel="noopener">https://github.com/PhantomGrapes/MultiDigraphNER</a></p><p>ã€ŠSimplify the Usage of Lexicon in Chinese NERã€‹</p><p>softlexicon codeï¼š<a href="https://github.com/v-mipeng/LexiconAugmentedNER" target="_blank" rel="noopener">https://github.com/v-mipeng/LexiconAugmentedNER</a></p><p>ã€ŠGATED GRAPH SEQUENCE NEURAL NETWORKSã€‹</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> WC-LSTM </tag>
            
            <tag> Multi-digraph </tag>
            
            <tag> SoftLexicon </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|NER-FLATæ¨¡å‹</title>
      <link href="2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹ã€ŠFLAT: Chinese NER Using Flat-Lattice Transformerã€‹è®ºæ–‡ï¼Œå³ï¼šFLATæ¨¡å‹ï¼Œè¿™æ˜¯ä»Šå¹´ACL2020ä¸ŠNERä»»åŠ¡çš„SOTAï¼Œä¸ªäººè§‰å¾—æ¨¡å‹è®¾è®¡ä¸Šéå¸¸ä¼˜é›…ï¼Œéå¸¸å€¼å¾—ä¸€è¯»ï¼Œé¢„æµ‹ä»¥åä¼šæˆä¸ºæ¯”èµ›çš„æ ‡é…ğŸ§ã€‚</p><a id="more"></a><h2 id="FLATæ¨¡å‹æå‡ºçš„èƒŒæ™¯"><a href="#FLATæ¨¡å‹æå‡ºçš„èƒŒæ™¯" class="headerlink" title="FLATæ¨¡å‹æå‡ºçš„èƒŒæ™¯"></a>FLATæ¨¡å‹æå‡ºçš„èƒŒæ™¯</h2><p>å¯¹äºä¸­æ–‡NERä»»åŠ¡ï¼Œè¯æ±‡å¢å¼ºæ˜¯æœ‰æ•ˆæå‡æ•ˆæœçš„æ–¹æ³•ä¹‹ä¸€ã€‚LatticeLSTMæ˜¯è¯æ±‡å¢å¼ºçš„å…¸å‹æ¨¡å‹ã€‚ä½†æ˜¯è¿™ç§Latticeç»“æ„ï¼Œå…¶æ¨¡å‹ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸”ç”±äºlexicon wordæ’å…¥ä½ç½®çš„åŠ¨æ€æ€§ï¼Œå¯¼è‡´LatticeLSTMæ¨¡å‹æ— æ³•å¹¶è¡Œï¼Œæ‰€ä»¥LatticeLSTMæ— æ³•å¾ˆå¥½çš„åˆ©ç”¨GPUåŠ é€Ÿï¼Œå…¶trainingä»¥åŠinferenceçš„é€Ÿåº¦éå¸¸æ…¢ã€‚æ‰€ä»¥æ€ä¹ˆæ—¢èƒ½å¤Ÿå¾ˆå¥½çš„èå…¥lexiconä¿¡æ¯ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿåœ¨ä¸é™ä½æ•ˆæœç”šè‡³æå‡æ•ˆæœçš„åŒæ—¶ï¼Œå¤§å¹…æå‡trainingä»¥åŠinferenceçš„é€Ÿåº¦ï¼Œè¿™å°±æ˜¯FLATæ¨¡å‹æå‡ºçš„èƒŒæ™¯ã€‚ç›®å‰åœ¨NERä¸­ï¼Œå¤„ç†latticeç»“æ„çš„æ–¹å¼æœ‰ä¸¤å¤§ç±»ï¼š1. è®¾è®¡ä¸€ä¸ªæ¡†æ¶ï¼Œèƒ½å¤Ÿå…¼å®¹è¯æ±‡ä¿¡æ¯çš„è¾“å…¥ï¼Œå…¸å‹çš„æ¨¡å‹æœ‰ï¼šLatticeLSTMã€LRCNNï¼Œè¿™ç§æ¨¡å‹çš„ç¼ºç‚¹æ˜¯æ— æ³•å¯¹é•¿æœŸä¾èµ–è¿›è¡Œå»ºæ¨¡ï¼›2.å°†latticeç»“æ„è½¬æ¢ä¸ºgraphç»“æ„ï¼Œå…¸å‹çš„æ¨¡å‹æœ‰ï¼šLGNã€CGNï¼Œè¿™ç§æ¨¡å‹çš„ç¼ºç‚¹æ˜¯ï¼š1.åºåˆ—ç»“æ„å’Œgraphç»“æ„è¿˜æ˜¯æœ‰ä¸€å®šçš„å·®åˆ«ï¼›2.é€šå¸¸éœ€è¦ä½¿ç”¨RNNæ¥æ•è·é¡ºåºä¿¡æ¯ã€‚è€ŒFLATåŸºäºtransformerï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œä½†æ˜¯vanilla transformerå¯¹äºä½ç½®ä¿¡æ¯çš„æ•æ‰å…¶å®æ˜¯å¾ˆå¼±çš„ï¼Œå¾ˆå¤šå®éªŒè¡¨æ˜transformerå¯¹äºNERè¿™ç§å¯¹äºä½ç½®ä¿¡æ¯è¦æ±‚å¾ˆé«˜çš„ä»»åŠ¡ï¼Œå¹¶ä¸æ˜¯å¾ˆé€‚åˆï¼Œæ‰€ä»¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“çš„å°†åœ¨ä¸‹é¢å‡ èŠ‚ä»‹ç»ã€‚</p><h2 id="FLATæ¨¡å‹ä»‹ç»"><a href="#FLATæ¨¡å‹ä»‹ç»" class="headerlink" title="FLATæ¨¡å‹ä»‹ç»"></a>FLATæ¨¡å‹ä»‹ç»</h2><p>å…ˆæ”¾æ¨¡å‹å›¾ï½</p><p><img src="/2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/FLAT.jpg" alt></p><p>ä¸Šå›¾æ˜¯FLATæ¨¡å‹çš„æ•´ä½“ç»“æ„ã€‚æ•´ä½“ç»“æ„å°±æ˜¯transformerçš„encoderéƒ¨åˆ†+CRFã€‚ä¸»è¦çš„æ”¹è¿›å°±æ˜¯åœ¨position encodingéƒ¨åˆ†ï¼Œå› ä¸ºtransformerä½¿ç”¨çš„æ˜¯self-attnetionï¼Œè¿™ç§ç‚¹ç§¯çš„æ–¹å¼ï¼Œç ´åäº†transformerçš„è·ç¦»æ„ŸçŸ¥å’Œæ–¹å‘æ„ŸçŸ¥æ€§ã€‚å…·ä½“æ€ä¹ˆæ”¹å‘¢ï¼Ÿä¸‹é¢å…·ä½“ä»‹ç»ã€‚</p><ol><li><p>åœ¨FLATä¸­ï¼Œå°†latticeç»“æ„è½¬æ¢ä¸ºflat ç»“æ„ã€‚æ€ä¹ˆåšå‘¢ï¼Ÿæ¯ä¸€ä¸ªcharacterä»¥åŠmathced lexicon wordéƒ½æœ‰head indexä¸tail indexã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å°†latticeè½¬æ¢ä¸ºflatç»“æ„ï¼Œè€Œä¸”ç”±äºæœ‰äº†head indexä¸tail indexï¼Œæ‰€ä»¥è½¬æ¢æ˜¯å¯ä»¥é€†è½¬çš„ã€‚</p></li><li><p>åœ¨FLATä¸­ï¼Œå®šä¹‰äº†æ–°çš„ç›¸å¯¹ä½ç½®ç¼–ç ã€‚å¯¹äºspan $x_i$ä¸$x_j$ï¼Œå®ƒçš„headä¸tailåˆ†åˆ«è¡¨ç¤ºä¸ºï¼š$head[i],tail[i]$ä¸$head[j],tail[j]$ã€‚$x_i$ä¸$x_j$çš„å…³ç³»å¯ä»¥ç”¨ä»¥ä¸‹å››ä¸ªç›¸å¯¹è·ç¦»æ¥è¡¨ç¤ºï¼š</p><script type="math/tex; mode=display">d_{ij}^{(hh)}=head[i]-head[j] \\d_{ij}^{(ht)}=head[i]-tail[j] \\d_{ij}^{(th)}=tail[i]-head[j] \\d_{ij}^{(tt)}=tail[i]-tail[j] \\</script><p>æœ€ç»ˆï¼Œç›¸å¯¹ä½ç½®ç¼–ç è®¡ç®—å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">R_{ij}=RELU(W_r(p_{ d_{ij}^{(hh)}}\bigoplus p_{d_{ij}^{(hh)}} \bigoplus p_{d_{ij}^{(th)}} \bigoplus p_{d_{ij}^{(tt)}} )  ) \\p_d^{2k}=sin(\frac {d}{10000^{2k/d_{model}}}) \\p_d^{2k+1}=cos(\frac {d}{10000^{2k/d_{model}}}) \\d\in \{d_{ij}^{hh},d_{ij}^{ht},d_{ij}^{th},d_{ij}^{tt}\}</script><p>èåˆåçš„$R$çš„ç»´åº¦æ˜¯ï¼š$[batch_size,hidden_size,seq_len,seq_len]$ã€‚å½“ç„¶äº†ï¼Œæ—¢ç„¶ä½¿ç”¨äº†ç›¸å¯¹ä½ç½®ç¼–ç ï¼Œé‚£ä¹ˆvanilla transformerä¸­çš„self attentionçš„æ–¹å¼å°±ä¸èƒ½ç”¨äº†(é€‚ç”¨äºç»å¯¹ä½ç½®ç¼–ç )ï¼Œæ‰€ä»¥åœ¨FLATä¸­ï¼Œé‡‡ç”¨çš„æ˜¯transformer-xlä¸­çš„variant self attentionï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">A_{i,j}^{*}=W_{q}^{T} E_{x_i}^TE_{x_j}W_{k,E}+ W_q^âŠ¤E_{x_i}^âŠ¤R_{ij}W_{k,R} +u^âŠ¤E_{x_j}W_{k,E} + v^âŠ¤R_{ij}W_{k,R}</script><p>å…³äºè¿™ä¸ªæ˜¯æ€ä¹ˆæ¥çš„ï¼Œå¯ä»¥å‚è€ƒtransformer-xlåŸå§‹è®ºæ–‡æˆ–è€…<a href="https://zhuanlan.zhihu.com/p/84159401" target="_blank" rel="noopener">link</a>ã€‚</p></li></ol><h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ol><li><p>æ•°æ®é›†ï¼šOntoNotesã€MSRAã€Weiboã€Resume</p></li><li><p>å‚æ•°è®¾ç½®ï¼š</p><p><img src="/2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/params_MSRA+ontonotes.jpg" style="zoom:50%;"></p><p><img src="/2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/prams_weibo+resume.jpg" style="zoom:50%;"></p></li><li><p>å®éªŒç»“æœ</p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹FLATä»¥åŠå…¶ä»–çš„æ¨¡å‹åœ¨å››ä¸ªæ•°æ®é›†ä¸Šçš„è¡¨ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒFLATçš„ç»“æœéƒ½è¶…è¿‡äº†ä¹‹å‰æå‡ºçš„æ¨¡å‹ã€‚</p><p><img src="/2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/result.jpg" alt></p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹åŠ ä¸Šäº†BERTä¹‹åçš„ç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚NB!ä»¥åæ¯”èµ›å¯ä»¥æèµ·æ¥äº†å°±ä¸ä¸€å®šæ˜¯BERT+BILSTM+CRFäº†ï¼Œä¹Ÿå¯ä»¥æ˜¯æ˜¯BERT+FLAT+CRFï¼Œä¸è¿‡è¯æ±‡è¡¨åœ¨å…¶ä¸­è¿˜æ˜¯å äº†å¤§éƒ¨åˆ†ä½œç”¨ï¼Œä»¥åè¦ç”¨çš„å¥½çš„è¯ï¼Œå°±å¾—åˆ¶ä½œè¯æ±‡è¡¨äº†ã€‚ğŸ§</p><p><img src="/2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/bert.jpg" style="zoom:80%;"></p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ¨ç†é€Ÿåº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨batchçš„æƒ…å†µä¸‹ï¼Œinferanceçš„é€Ÿåº¦æ¯”å…¶ä»–æ¨¡å‹å¿«ä¸Šå¥½å‡ å€ï¼ŒFLAT nbï¼è¿™ä¸ªå®éªŒå¦å¤–è®©æˆ‘éå¸¸æƒŠå¥‡çš„æ˜¯ï¼ŒåŸå§‹çš„LatticeLSTMçš„codeæ˜¯ä¸èƒ½batchè®­ç»ƒçš„ï¼Œä½†æ˜¯è¿™ç¯‡paperçš„ä½œè€…è‡ªå·±æ‰‹æ’¸äº†ä¸€ä¸ªbatchçš„LatticeLSTMï¼Œå‘å¤§ä½¬ä½å¤´ï¼Œæœ‰ç©ºå»çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚<a href="https://github.com/LeeSureman/Batch_Parallel_LatticeLSTM" target="_blank" rel="noopener">code</a></p><p><img src="/2020/10/18/NLP-NER-FLAT%E6%A8%A1%E5%9E%8B/speed.jpg" alt></p></li></ol><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠFLAT: Chinese NER Using Flat-Lattice Transformerã€‹</p><p>ã€ŠTransformer-XL: Attentive Language Models Beyond a Fixed-Length Contextã€‹</p><p>codeï¼š<a href="https://github.com/LeeSureman/Flat-Lattice-Transformer" target="_blank" rel="noopener">https://github.com/LeeSureman/Flat-Lattice-Transformer</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> FLAT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|NER-CGNæ¨¡å‹</title>
      <link href="2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹ã€ŠLeverage Lexical Knowledge for Chinese Named Entity Recognition via Collaborative Graph Networkã€‹è®ºæ–‡ï¼Œå³ï¼šCGNæ¨¡å‹ï¼Œä¸ªäººè®¤ä¸ºè¿™ç¯‡æ–‡ç« å°†GNNåº”ç”¨åˆ°NERä»»åŠ¡ä¸­çš„æ–¹å¼éå¸¸çš„ä¼˜é›…ï¼Œå€¼å¾—ä¸€è¯»ã€‚</p><a id="more"></a><h2 id="CGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯"><a href="#CGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯" class="headerlink" title="CGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯"></a>CGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯</h2><p>è¯æ±‡å¢å¼ºæ˜¯ç›®å‰NERä¸­æå‡æ¨¡å‹æ•ˆæœæœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ã€‚LatticeLSTMæ˜¯è¯æ±‡å¢å¼ºçš„å¼€å±±ä¹‹ä½œã€‚ä½†æ˜¯LatticeLSTMä¸­ï¼Œä»ç„¶æœ‰ä¸‰ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼š<strong>æ— æ³•å¹¶è¡ŒåŒ–ã€æ²¡æœ‰é›†æˆself-matched lexicon wordsåˆ°characterä¸­ã€æ²¡æœ‰ç›´æ¥é›†æˆä¸å½“å‰characteræœ€æ¥è¿‘çš„lexicon wordsçš„ä¿¡æ¯ï¼ˆä¼šå¯¼è‡´word conflictsé—®é¢˜ï¼‰ã€‚</strong>CGNæ¨¡å‹æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œè¢«æå‡ºæ¥çš„ã€‚</p><blockquote><p>psï¼šlatticeLSTMæ¨¡å‹ä¸€å®šè¦å¥½å¥½ç ”è¯»ä¸€ä¸‹ï¼Œå¯¹äºè¯æ±‡å¢å¼ºç±»NERæ¨¡å‹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäºlatticeLSTMæ¨¡å‹çš„ç¼ºé™·æ”¹è¿›è€Œæ¥ã€‚</p></blockquote><h2 id="CGNæ¨¡å‹ä»‹ç»"><a href="#CGNæ¨¡å‹ä»‹ç»" class="headerlink" title="CGNæ¨¡å‹ä»‹ç»"></a>CGNæ¨¡å‹ä»‹ç»</h2><p>è¿˜æ˜¯å…ˆæ”¾æ¨¡å‹å›¾ï¼Œå†é€æ­¥ä»‹ç»ï½</p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/CGN.jpg" alt></p><p>æ•´ä¸ªæ¨¡å‹åˆ†ä¸ºå››å±‚ï¼š<strong>encoding layerã€graph layerã€fusion layerã€decoding layerï¼Œ</strong>ä¸‹é¢è¯¦ç»†ä»‹ç»ï½</p><ol><li><p><strong>encoding layerï¼š</strong>æ¨¡å‹çš„è¾“å…¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šsentenceä»¥åŠä¸sentenceç›¸åŒ¹é…çš„lexicon wordsï¼Œåˆ†åˆ«è¡¨ç¤ºä¸ºï¼š$s=\{c_1,c_2,â€¦,c_n\},l=\{l_1,l_2,â€¦,l_m\}$ï¼Œå…¶ä¸­$c_i$è¡¨ç¤ºsentenceçš„ç¬¬iä¸ªcharacterï¼Œ$l_i$è¡¨ç¤ºä¸sentenceç›¸åŒ¹é…çš„ç¬¬iä¸ªlexicon wordã€‚é€šè¿‡ä½¿ç”¨pretrained char embedding tableï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ¯ä¸€ä¸ªcharacterçš„char embeddingï¼š$x_i=e^c(c_i)$ï¼›å¾—åˆ°char embedingï¼Œæˆ‘ä»¬éœ€è¦å°†è¾“å…¥åˆ°BILSTMè¿›è¡Œç¼–ç ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†æ•è·å¥å­çš„é¡ºåºå…³ç³»ï¼Œå¾—åˆ°contextual representationï¼›å¯¹äºmatched lexicon wordsï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡ä½¿ç”¨pretrained word embedding tableï¼Œå¾—åˆ°æ¯ä¸€ä¸ªwordçš„embeddingï¼š$wv_i=e^w(l_i)$ã€‚æœ€ç»ˆencoding layerçš„è¾“å‡ºæ˜¯å¯¹è¿™ä¸¤è€…è¿›è¡Œconcatçš„ç»“æœï¼Œè¡¨ç¤ºä¸ºï¼š$Node_f=[h_1,h_2,â€¦,h_n,wv_1,wv_2,â€¦,wv_m]$ï¼Œå…¶ç»´åº¦æ˜¯ï¼š$[batch_size,n+m,hidden_size]$ï¼Œ<strong>æˆ‘è®¤ä¸ºè¿™æ ·èåˆlexicon wordçš„æ–¹å¼æ˜¯æ›´åŠ ä¼˜é›…çš„ï¼Œå› ä¸ºè¿™æ ·ä¸ä»…å¯ä»¥èåˆlexicon word informationï¼ŒåŒæ—¶è¿˜è§£å†³äº†latticeLSTMæ¨¡å‹æ— æ³•å¹¶è¡Œçš„é—®é¢˜ã€‚</strong></p></li><li><p><strong>graph layerï¼š</strong>è¿™ä¸€å±‚å°±æ˜¯ä½¿ç”¨GNNæ¥è§£å†³åé¢çš„ä¸¤ä¸ªé—®é¢˜çš„ã€‚æ€»å…±åˆ†ä¸ºä¸‰ä¸ªgraphå±‚ï¼š<strong>Containing graphã€Transition graphã€Lattice graphã€‚</strong>ä¸‹é¢ä¾æ¬¡ä»‹ç»ï¼šå›¾çš„æ„å»ºä»¥åŠaggregateã€‚</p><ul><li><p>å›¾çš„æ„å»º</p><ul><li><p><strong>Containing graph(C-graph)ï¼š</strong>è¿™ä¸€å±‚æ˜¯ä¸ºäº†é›†æˆself-matched wordsåˆ°characterä¸­è€Œè®¾è®¡çš„ï¼Œä¸»è¦å°±æ˜¯å»ºæ¨¡characterä¸self-matched wordsçš„å…³ç³»ã€‚é‚£ä¹ˆæ€ä¹ˆæ„å»ºå‘¢ï¼Ÿæ—¢ç„¶æ˜¯graphï¼Œå°±è¦é¦–å…ˆç¡®å®šnode setä¸edge setï¼ŒC-graphä¸­çš„nodeå°±æ˜¯æ‰€æœ‰çš„characterä¸matched lexicon wordsï¼›C-graphä¸­çš„edgeæ˜¯ï¼šæˆ‘ä»¬é¦–å…ˆæ ¹æ®æ‰€æœ‰çš„characterä¸matched lexicon wordsæ¥æ„é€ é‚»æ¥çŸ©é˜µ(è¡Œä»£è¡¨wordï¼Œåˆ—ä»£è¡¨character)ï¼Œå¦‚æœword $i$åŒ…å«character $j$çš„è¯ï¼Œé‚£ä¹ˆé‚»æ¥çŸ©é˜µä¸­çš„$(i,j)$çš„å€¼ä¸º1ï¼Œå¦åˆ™ä¸º0ï¼Œå¯¹åº”äºC-graphçš„è¯ï¼Œå°±æ˜¯wordä¸characteræœ‰è¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/C-graph.jpg" style="zoom:50%;"></p></li><li><p><strong>Transition graph(T-graph)ï¼š</strong>è¿™ä¸€å±‚æ˜¯ä¸ºäº†ç›´æ¥é›†æˆä¸å½“å‰characteræœ€æ¥è¿‘çš„lexicon wordä¿¡æ¯(preceding or following)ã€‚æ€ä¹ˆæ„å»ºå›¾å‘¢ï¼Ÿnode setè¿˜æ˜¯æœ‰C-graphä¸€æ ·ï¼Œä½†æ˜¯edge setä¸ä¸€æ ·ï¼Œedgeæ˜¯ï¼šæˆ‘ä»¬ä»ç„¶æ˜¯æ›´åŠ node setæ¥æ„å»ºé‚»æ¥çŸ©é˜µ(è¡Œï¼šwords+characterï¼Œåˆ—ï¼šword+character)ï¼Œå¦‚æœword $i$æˆ–è€…character $m$æ˜¯ character $j$çš„æœ€æ¥è¿‘çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆé‚»æ¥çŸ©é˜µä¸­çš„$(i,j) or (m,j)$çš„å€¼ä¸º1ï¼ŒåŒæ—¶ä¸ºäº†æ•è·wordä¸wordä¹‹é—´çš„å…³ç³»ï¼Œå¦‚æœword $i$æ˜¯word $k$ çš„precedingæˆ–è€…followingçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆ$(i,k)$çš„å€¼ä¸º1ã€‚å¯¹åº”äºT-graphçš„è¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/t-graph.jpg" style="zoom:50%;"></p></li><li><p><strong>Lattice-graph(L-graph)ï¼š</strong>å¯¹åº”äºLatticeLSTMä¸­çš„Latticeç»“æ„ï¼Œä¸»è¦æ˜¯èƒ½å¤Ÿæ•è·åˆ°self-matched wordçš„å±€éƒ¨ä¿¡æ¯ä»¥åŠéšå¼çš„çš„é›†æˆæœ€æ¥è¿‘çš„lexicon word(ä¸ªäººè®¤ä¸ºåŠ è¿™ä¸ªå…¶å®å°±æ˜¯ä¸ºäº†èåˆæ›´å¤šä¿¡æ¯ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ä½œç”¨ï¼Œå°±ç®—ä¸åŠ ä¹Ÿæ˜¯OKçš„ï¼Œé€»è¾‘ä¸Šæ²¡æœ‰ä»€ä¹ˆé”™è¯¯æˆ–è€…ä¸é€šï¼Œä½†æ˜¯æ•ˆæœå¯èƒ½å°±ä¸ä¼šè¿™ä¹ˆå¥½äº†)ã€‚æ€ä¹ˆæ„å»ºå›¾å‘¢ï¼Ÿnode setä¸å‰é¢çš„ä¸€æ ·ï¼Œedge set1ä¸ä¸€æ ·ï¼Œedgeæ˜¯ï¼šæˆ‘ä»¬æ ¹æ®node setæ¥æ„å»ºé‚»æ¥çŸ©é˜µ(è¡Œï¼šword+characterï¼Œåˆ—ï¼šword+character)ï¼Œå¦‚æœcharacter $m$æ˜¯character $j$æœ€æ¥è¿‘çš„characterï¼Œé‚£ä¹ˆ$(m,j)$çš„å€¼ä¸ºï¼Œé‚£å…¶å®ç›¸å¯¹çš„ï¼Œ$(j,m)$çš„å€¼ä¹Ÿä¸º1ï¼Œå¦å¤–ï¼Œå¦‚æœcharacter $j$æ˜¯word $i$çš„é¦–ä½æˆ–è€…å°¾ä½ï¼Œé‚£ä¹ˆ$(i,j)$çš„å€¼ä¸º1ã€‚å¯¹åº”åˆ°L-graphä¸Šçš„è¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/l-graph.jpg" style="zoom:50%;"></p></li></ul></li><li><p>aggeragte</p><p>æ„å»ºå®Œå›¾ä¹‹åï¼Œæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªgraphï¼Œéƒ½ä½¿ç”¨GATæ¨¡å‹æ¥è¿›è¡Œencoding(ä¸çŸ¥é“å¯ä¸å¯ä»¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ç†è§£çš„aggregateå°±æ˜¯encodingğŸ§)ã€‚å‡è®¾æœ‰å¯¹äºä¸€ä¸ªgraphï¼Œæœ‰Må±‚ã€‚ç¬¬$j$å±‚çš„è¾“å…¥æ˜¯node featureï¼š$NF^{j-1}=\{f_1,f_2,..,f_N\}$ä»¥åŠé‚»æ¥çŸ©é˜µ$A$ï¼Œå…¶ä¸­$f_i\in R^Fï¼ŒA\in R^{N\times N}$ï¼Œç¬¬$j$å±‚çš„è¾“å‡ºæ˜¯æ–°çš„node featureï¼š$NF^{j+1}=\{f_1^{â€˜},f_2^{â€˜},â€¦,f_N^{â€˜}\}$ã€‚å…·ä½“æ€ä¹ˆè®¡ç®—å‘¢ï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f_i^{'}=||_{k=1}^{K}\sigma (\sum_{j\in \cal N_i}\alpha_{ij}^kW^kf_j) ,\ å…¶ä¸­\\\alpha_{ij}^k=\frac {exp(LeakyRelu(a^T[W^kf_i||W^Kf_j]))}{\sum_{k\in \cal N_i}exp(LeakyRelu(a^T[W^kf_i||W^Kf_k]))}</script><p>å…¶ä¸­ï¼Œ$K$è¡¨ç¤ºçš„æ˜¯æœ‰$K$ä¸ªheadï¼Œåœ¨GATä¸­ï¼Œä½¿ç”¨äº†multihead attention(ä½†ä¸æ˜¯self-attention)ï¼Œ$||$è¡¨ç¤ºconcatï¼Œ$\alpha_{ij}^k$è¡¨ç¤ºçš„æ˜¯ç¬¬kä¸ªheadä¸­ï¼Œé‚»åŸŸå†…ç¬¬$j$ä¸ªnodeå¯¹$i$ nodeçš„é‡è¦æ€§ç¨‹åº¦ï¼Œ$\sigma$æ˜¯æ¿€æ´»å‡½æ•°ï¼Œä¸æ˜¯sigmoidå‡½æ•°ï¼Œ$a^T$è¡¨ç¤ºçš„æ˜¯å•å±‚çš„FFNï¼Œæ¿€æ´»å‡½æ•°é€‰æ‹©leakyreluã€‚å¯¹äºGATçš„æœ€åä¸€å±‚ï¼Œåˆ™æ˜¯å…ˆavgï¼Œç„¶ååœ¨ä½¿ç”¨æ¿€æ´»å‡½æ•°æ¥æ¿€æ´»ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f_i^{final}=\sigma(\frac{1}{K}\sum_{k=1}^K\sum_{j\in \cal N_i}\alpha_{ij}^kW^kf_j)</script><p>å½“ç„¶äº†ï¼Œè¿™æ˜¯å¯¹äºä¸€ä¸ªgraphï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸‰ä¸ªgraphï¼Œæ‰€ä»¥ä¸‰ä¸ªgraphçš„è¾“å‡ºçš„node featureå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">G_1=GAT_1(Node_f,A^C) \\G_2=GAT_2(Node_f,A^T) \\G_3=GAT_3(Node_f,A^L)</script><p>å…¶ä¸­ï¼Œ$G_k\in R^{F^{â€˜} \times (n+m)},k=\{1,2,3\}$ã€‚åœ¨å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºçš„node featureä¹‹åï¼Œæˆ‘ä»¬åªå–å‰$n$åˆ—ï¼Œåé¢çš„$m$åˆ—ä¸è¦ï¼Œå› ä¸ºæˆ‘ä»¬è¦å¾—åˆ°çš„æ˜¯characterçš„representationï¼Œç„¶åè¾“é€åˆ°CRFã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">Q_k=G_k[:,0:n],k=\{1,2,3\}</script></li></ul></li><li><p><strong>Fusion layerï¼š</strong>è¿™ä¸€å±‚å°±æ˜¯å¯¹ä¸Šä¸€å±‚å¾—åˆ°çš„å„ç§node featureè¿›è¡Œfusionã€‚è¿™é‡Œå°±æ˜¯ç®€å•çš„ä½¿ç”¨äº†ç›¸åŠ ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">R=W_1H+W_2Q_1+W_3Q_2+W_4Q_3</script><p>$H$æ˜¯æœ€åˆçš„char embeddingé€å…¥BILSTMä¹‹åï¼Œå¾—å‡ºçš„contextual representationã€‚</p></li><li><p><strong>Decoding layerï¼š</strong>è¿™ä¸€å±‚å°±æ˜¯ä½¿ç”¨æ ‡å‡†çš„CRFæ¥è§£ç ï¼ŒåŠ å…¥äº†L2æ­£åˆ™ã€‚</p></li></ol><h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ol><li><p>æ•°æ®é›†ï¼šOntoNotesã€MSRAã€Weibo</p></li><li><p>å‚æ•°è®¾ç½®ï¼šbatch sizeï¼š64(MSRA)ï¼Œ20(OntoNotes)ï¼Œ10(Weibo);optimizer:Adam(MSRA)ã€GD(OntoNotes and Weibo)</p></li><li><p>å®éªŒç»“æœï¼š</p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/weibo.jpg" alt></p></li></ol><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/ontonotes.jpg" style="zoom:50%;"></p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/msra.jpg" style="zoom:50%;"></p><p><img src="/2020/10/18/NLP-NER-CGN%E6%A8%A1%E5%9E%8B/speed.jpg" style="zoom:50%;"></p><p>ä»ç»“æœæ¥çœ‹ï¼ŒCGNè¿˜æ˜¯ä¸é”™çš„ï¼Œå°¤å…¶æ˜¯åœ¨Weiboæ•°æ®é›†ä¸Šï¼Œæå‡éå¸¸å¤§ã€‚å¦å¤–ä¸€ç¯‡ä½¿ç”¨GNNæ¥åšçš„LGNæ¨¡å‹ï¼Œä»paperä¸­å‘å¸ƒçš„ç»“æœæ¥çœ‹ï¼Œontonotesä»¥åŠmsraçš„ç»“æœè¦æ¯”CGNå¥½ä¸Šä¸€ç‚¹ç‚¹ï¼Œä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸ºCGNèåˆlexiconçš„æ–¹å¼è¦æ›´åŠ ä¼˜é›…ä¸€äº›ï¼Œè€Œä¸”æ‰©å±•æ€§æ¯”è¾ƒå¼ºã€‚å½“ç„¶äº†ï¼ŒFLATå‡ºæ¥ä¹‹åï¼Œå‡ ä¹ç§’æ€CGNå’ŒLGNï¼Œä¸è¿‡è¦æ˜¯è¿˜æ˜¯æƒ³ç”¨GNNæ¥åšNERçš„è¯ï¼ŒCGNæ˜¯ä¸€ä¸ªå¯ä»¥followçš„å·¥ä½œï¼Œä¸ªäººæƒ³æ³•ğŸ§ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠA Lexicon-Based Graph Neural Network for Chinese NERã€‹</p><p>codeï¼š<a href="https://github.com/DianboWork/Graph4CNER" target="_blank" rel="noopener">https://github.com/DianboWork/Graph4CNER</a></p><p>GATè®²è§£ï¼š<a href="https://zhuanlan.zhihu.com/p/81350196?utm_source=wechat_session" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/81350196?utm_source=wechat_session</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> CGN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|NER-LGNæ¨¡å‹</title>
      <link href="2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹ã€ŠA Lexicon-Based Graph Neural Network for Chinese NERã€‹è®ºæ–‡ï¼Œå³ï¼šLGNæ¨¡å‹ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œè¿™ç¯‡è®ºæ–‡ä¸LRCNNæ˜¯åŒä¸€ä¸ªä½œè€…ã€‚</p><a id="more"></a><h2 id="LGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯"><a href="#LGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯" class="headerlink" title="LGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯"></a>LGNæ¨¡å‹æå‡ºçš„èƒŒæ™¯</h2><p>LGNç€çœ¼è§£å†³çš„é—®é¢˜ä¸LRCNNæ¨¡å‹æ˜¯ä¸€æ ·çš„ï¼ˆä¸¤ä¸ªæ¨¡å‹æ¥è‡ªäºåŒä¸€ä½œè€…ï¼‰ï¼Œå°±æ˜¯LatticeLSTMä¸­å­˜åœ¨ç€ä¸€ä¸ªé—®é¢˜ï¼šlexicon conflictsã€‚åœ¨LRCNNæ¨¡å‹ä¸­ï¼Œæ˜¯é€šè¿‡rethinking mechanismæ¥è§£å†³ï¼Œè€Œåœ¨LGNæ¨¡å‹ä¸­ï¼Œåˆ™æ˜¯é€šè¿‡GNNæ¥è¿›è¡Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå¯ä»¥ç”¨GNNæ¥è§£å†³å‘¢ï¼Ÿå› ä¸ºå¯¹äºword conflictsé—®é¢˜ï¼Œå¾ˆé‡è¦çš„å°±æ˜¯è¦åˆ©ç”¨å¥å­çš„å…¨å±€ä¿¡æ¯å’Œé«˜å±‚ç‰¹å¾æ¥è¿›è¡Œè§£å†³ï¼Œè€ŒGNNå¯¹äºå…¨å±€ä¿¡æ¯çš„å»ºæ¨¡å’Œèšåˆæœ‰ç€éå¸¸å¼ºå¤§çš„èƒ½åŠ›ã€‚å…·ä½“æ˜¯æ€ä¹ˆè§£å†³çš„å°†åœ¨ä¸‹é¢å‡ å°èŠ‚å…·ä½“è¯´æ˜ã€‚</p><h2 id="LGNæ¨¡å‹ä»‹ç»"><a href="#LGNæ¨¡å‹ä»‹ç»" class="headerlink" title="LGNæ¨¡å‹ä»‹ç»"></a>LGNæ¨¡å‹ä»‹ç»</h2><p>å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/graph.jpg" alt></p><ol><li><p><strong>å›¾çš„æ„å»ºåŠnodeä¸edgeçš„åˆå§‹åŒ–</strong>ã€‚æ—¢ç„¶ä½¿ç”¨äº†GNNæ¥è§£å†³ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼š<strong>å¦‚ä½•æ„å»ºå›¾ï¼Ÿ</strong></p><ol><li>nodeï¼šåœ¨LGNæ¨¡å‹ä¸­ï¼Œsentenceä¸­çš„charå½“ä½œnodeï¼Œnodeçš„åˆå§‹åŒ–å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨char embeddingï¼Œè€Œæ˜¯å°†å…¶è¾“å…¥åˆ°LSTMå½“ä¸­ï¼Œè¾“å‡ºçš„ç»“æœå½“ä½œnodeçš„åˆå§‹åŒ–ï¼›</li><li>edgeï¼šlexiconä¸­çš„wordè¢«å½“ä½œedgeï¼Œ(edgeçš„åˆå§‹åŒ–ç›´æ¥ä½¿ç”¨word embeddingå³å¯)ï¼Œedgeçš„æŒ‡å‘æ˜¯ä»é¦–ä¸ªå­—æŒ‡å‘å°¾ä¸ªå­—ï¼Œä»¥æ­¤æ¥æ„å»ºä¸€ä¸ªæœ‰å‘å›¾ã€‚</li><li>global relay nodeï¼šæ­¤å¤–ï¼Œåœ¨LGNä¸­ï¼Œè¿˜è®¾ç½®äº†å…¨å±€ä¸­ç»§èŠ‚ç‚¹æ¥è·å–å…¨å±€ä¿¡æ¯æ¥ç”¨ä»¥è§£å†³word conflictsé—®é¢˜ã€‚</li><li>ä½¿ç”¨å…¬å¼æ¥è¡¨ç¤ºï¼šå‡è®¾å¥å­è¡¨ç¤ºä¸ºï¼š$s=\{c_1,c_2,â€¦,c_n\}$ï¼Œ$c_i$è¡¨ç¤ºç¬¬$i$ä¸ªå­—ï¼Œlexiconä¸­çš„wordè¡¨ç¤ºä¸ºï¼š$w_{b,e}=\{c_b,c_{b+1},â€¦,c_{e-1},c_e\}$ï¼Œ$b,e$åˆ†åˆ«è¡¨ç¤ºè¯¥è¯çš„é¦–éƒ¨ä¸å°¾éƒ¨çš„indexï¼Œæ•´ä¸ªå›¾è¡¨ç¤ºä¸ºï¼š$\cal G=(V,E)$ï¼Œ$c_i\in \cal V$ï¼Œ$e_{b,e}\in \cal E$ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŸå›¾è½¬ç½®åçš„åå‘å›¾è¡¨ç¤ºä¸ºï¼š$\cal G^T$ã€‚æˆ‘ä»¬æœ€ç»ˆçš„æ˜¯</li></ol></li><li><p><strong>å›¾çš„Local Aggregationã€‚</strong>local aggregationåˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼šnode aggregationå’Œedge aggregationã€‚ä¸‹é¢ä¾æ¬¡ä»‹ç»ã€‚</p><ol><li>node aggregationå…¶å®å’Œæ™®é€šçš„GNNä¸€æ ·ï¼Œå°±æ˜¯èšåˆå…¶é‚»åŸŸç‰¹å¾ï¼Œåœ¨è¿™é‡Œï¼Œä½¿ç”¨transformerä¸­çš„multihead attentionæ¥è¿›è¡Œèšåˆï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</li></ol><script type="math/tex; mode=display">e\rightarrow c:\tilde c_i^t=MultiAtt(c^t_i,\{\forall [c^t_k,e^t_{k,i}]\})</script><p>å…¶ä¸­ï¼Œ$\tilde c^t_i$è¡¨ç¤ºç¬¬iä¸ªcharçš„ç¬¬tæ¬¡step aggregateä¹‹åçš„ç»“æœ(ä¸ªäººç†è§£æ˜¯ä¸ºè®¡ç®—$c^{t+1}_i$åšå‡†å¤‡)ï¼Œ$c^t_i$è¡¨ç¤ºç¬¬iä¸ªcharçš„ç¬¬tæ¬¡stepçš„ç»“æœï¼Œ$e^{t}_{k,i}$è¡¨ç¤ºç¬¬tæ¬¡stepçš„indexä»kåˆ°içš„edgeçš„stateã€‚</p><ol><li>edge aggregationä¹Ÿæ˜¯ä¸€æ ·ï¼Œèšåˆå…¶é‚»åŸŸç‰¹å¾ã€‚å¯¹äº$e^t_{b,e}$ï¼Œå®ƒçš„é‚»åŸŸç‰¹å¾æœ‰indexä»båˆ°eçš„æ‰€æœ‰charçš„ä¿¡æ¯ã€‚æ‰€ä»¥åŒæ ·é€šè¿‡multihead attentionæ¥è¿›è¡Œèšåˆï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š<script type="math/tex; mode=display">c\rightarrow e:\tilde e^{t}_{b,e}=MultiAtt(e^t_{b,e},C^t_{b,e})</script>å…¶ä¸­$C^t_{b,e}$è¡¨ç¤ºindexä»båˆ°eçš„char sequence embeddingã€‚</li></ol></li><li><p><strong>Global aggregationã€‚</strong>ç”±äºå¥å­å¹¶ä¸æ˜¯å®Œå…¨çš„sequentialçš„ï¼Œæ‰€ä»¥ä¸ºäº†æ•è·é•¿æœŸä¾èµ–å’Œé«˜å±‚ç‰¹å¾ï¼Œåœ¨LGNå½“ä¸­è®¾ç½®äº†global relay nodeæ¥aggregate nodeå’Œedgeã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">g^t_c=MultiAtt(g^t,C^t_{1,n}) \\g^t_e=MultiAtt(g^t,\{\forall e^t\in\cal E\}) \\c,e\rightarrow g:\tilde g^t=[g^t_c;g^t_e]</script><p>å…¶ä¸­ï¼Œ$C^t_{1,n}$è¡¨ç¤ºç¬¬tä¸ªstepçš„æ•´ä¸ªå¥å­çš„hidden stateï¼Œ$g^t$è¡¨ç¤ºçš„æ˜¯ç¬¬tä¸ªstepæ•´ä¸ªå›¾çš„å…¨å±€ä¿¡æ¯ã€‚</p></li><li><p><strong>Node updateã€‚</strong>åœ¨è¿›è¡Œèšåˆä¹‹åï¼Œå°±è¦å¼€å§‹å¯¹nodeè¿›è¡Œæ›´æ–°ã€‚å…·ä½“å…¬å¸å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/node update.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$\cal X^t_i$è¡¨ç¤ºçš„æ˜¯node iä¸å…¨å±€ä¸­ç»§èŠ‚ç‚¹$\tilde g^{t-1}$çš„concatï¼Œ$\xi ^t_i$è¡¨ç¤ºçš„æ˜¯bigramçš„concatï¼Œè¿™ä¸ªå®é™…ä¸Šå’ŒLSTMæœ‰ç‚¹åƒã€‚</p></li><li><p><strong>Edge updateã€‚</strong>è¿™ä¸ªä¸node updateæ˜¯ä¸€æ ·çš„ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/edge update.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$\cal X^t_{b,e}$è¡¨ç¤ºçš„æ˜¯aggregation edge $\tilde e^{t-1}_{b,e}$ä¸å…¨å±€ä¸­ç»§èŠ‚ç‚¹$\tilde g^{t-1}$çš„concatã€‚</p></li><li><p><strong>Global relay node updateã€‚</strong>ä¸ä¸Šè¿°ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/relay node update.jpg" style="zoom:50%;"></p></li><li><p>é‡å¤2-6æ­¥éª¤è‹¥å¹²æ¬¡ï¼Œä¹‹åæ¥å…¥CRFï¼Œè¿™æ²¡ä»€ä¹ˆå¯ä»¥è¯´çš„ã€‚</p></li></ol><h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ol><li><p>æ•°æ®é›†ï¼šOntoNotesã€MSRAã€Weiboã€Resume</p></li><li><p>å‚æ•°è®¾ç½®ï¼šAdam optimizer(learning rate=2e-5 on MSRA and OntoNotes, 2e-4 on Weibo and resume)ï¼›droput(0.5 on embedding ,0.2 on aggregation module)ï¼›embedding size and state size is 50ï¼›</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/msra_and_weibo.jpg" alt></p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/resume.jpg" style="zoom:50%;"></p><p><img src="/2020/10/15/NLP-NER-LGN%E6%A8%A1%E5%9E%8B/ontonotes.jpg" style="zoom:50%;"></p></li></ol><p>ä»ç»“æœæ¥çœ‹ï¼Œè¦æ¯”LatticeLSTMè¦å¥½ï¼Œä½†æ˜¯æœ‰æ„æ€çš„æ˜¯ï¼Œè¿™ä¸ªç»“æœè¦æ¯”è¿™ä¸ªä½œè€…æå‡ºçš„LRCNNè¦å·®ä¸€äº›ï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œéƒ½æ˜¯19å¹´å‘çš„ï¼Œä¸€ä¸ªåœ¨emnlp(this paper)ï¼Œä¸€ä¸ªåœ¨ijcaiï¼Œanywayï¼Œenjoyã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠA Lexicon-Based Graph Neural Network for Chinese NERã€‹</p><p>codeï¼š<a href="https://github.com/RowitZou/LGN" target="_blank" rel="noopener">https://github.com/RowitZou/LGN</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> LGN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|NER-LRCNNæ¨¡å‹</title>
      <link href="2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹ã€ŠCNN-Based Chinese NER with Lexicon Rethinkingã€‹è®ºæ–‡ï¼Œå³ï¼šLRCNNæ¨¡å‹ã€‚</p><a id="more"></a><h2 id="LRCNNæ¨¡å‹æå‡ºçš„èƒŒæ™¯"><a href="#LRCNNæ¨¡å‹æå‡ºçš„èƒŒæ™¯" class="headerlink" title="LRCNNæ¨¡å‹æå‡ºçš„èƒŒæ™¯"></a>LRCNNæ¨¡å‹æå‡ºçš„èƒŒæ™¯</h2><p>è¯æ±‡å¢å¼ºè¢«è¯æ˜æ˜¯æœ‰æ•ˆæå‡NERæ€§èƒ½çš„æ–¹å¼ã€‚å…¶ä¸­æœ€å…·å¼€åˆ›æ€§çš„å·¥ä½œå°±æ˜¯LatticeLSTMï¼Œé€šè¿‡è®¾è®¡å·§å¦™çš„gateæœºåˆ¶å°†è¯æ±‡ä¿¡æ¯èå…¥åˆ°char level modelä¸­ï¼Œå¤§å¹…æé«˜äº†æ•ˆæœã€‚ä½†æ˜¯LatticeLSTMå­˜åœ¨ç€ä¸¤ä¸ªéå¸¸ä¸¥é‡çš„ç¼ºé™·ï¼š</p><p><strong>1. æ— æ³•å¹¶è¡ŒåŒ–ã€‚</strong>åœ¨LatticeLSTMä¸­ï¼Œå¼•å…¥çš„è¯æ±‡ä¿¡æ¯çš„ä½ç½®ä¸æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨batchæ¥åŠ é€Ÿè®­ç»ƒï¼›</p><p><strong>2. æ— æ³•æœ‰æ•ˆå¤„ç†è¯æ±‡ä¿¡æ¯å†²çªçš„é—®é¢˜</strong>ã€‚è­¬å¦‚ï¼šå¹¿å·å¸‚é•¿éš†å…¬å›­ï¼Œåœ¨lexiconä¸­æœ‰ï¼š<code>å¹¿å·å¸‚</code>ï¼Œ<code>å¸‚é•¿</code>ï¼Œ<code>é•¿éš†</code>ï¼Œç”±äº <code>é•¿</code> æ˜¯ <code>å¸‚é•¿</code> ä¸ <code>é•¿éš†</code>çš„ç»„æˆéƒ¨åˆ†ï¼Œæ‰€ä»¥æ¨¡å‹å¯¹äº<code>é•¿</code>è¿™ä¸ªå­—çš„æ ‡è®°å°±ä¼šå‡ºç°åå·®ï¼Œå› ä¸ºæ¨¡å‹ä¸çŸ¥é“è¦æ€ä¹ˆå¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œä»è€Œå¾ˆå¯èƒ½æ ‡è®°å‡ºé”™ï¼Œæ¢å¥è¯è¯´ï¼Œè¯æ±‡ä¸­çš„æŸäº›è¯ä¼šå¯¹æ¨¡å‹ä¸­çš„å­—çš„æ ‡è®°è¿›è¡Œè¯¯å¯¼ã€‚ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå°±æœ‰äº†LRCNNæ¨¡å‹ã€‚</p><h2 id="LRCNNæ¨¡å‹ä»‹ç»"><a href="#LRCNNæ¨¡å‹ä»‹ç»" class="headerlink" title="LRCNNæ¨¡å‹ä»‹ç»"></a>LRCNNæ¨¡å‹ä»‹ç»</h2><p>åœ¨LRCNNæ¨¡å‹ä¸­ï¼Œ<strong>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</strong>LRCNNé‡‡ç”¨äº†CNNè€Œä¸æ˜¯RNNæ¥å¯¹å¥å­è¿›è¡Œç¼–ç ï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨ä¸åŒçš„cnn layerï¼Œä¸åŒé•¿åº¦çš„è¯æ±‡å°†è¢«èå…¥æ¨¡å‹ä¸­ï¼›<strong>å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼š</strong>LRCNNæ¨¡å‹ä½¿ç”¨äº†rethinking mechanismã€‚å…ˆæ”¾å›¾ï½</p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/LRCNN.jpg" alt></p><p>å…·ä½“çš„LRCNNæ¨¡å‹æè¿°å¦‚ä¸‹ï¼š</p><ol><li><p>å‡è®¾è¾“å…¥çš„å¥å­è¡¨ç¤ºï¼š$C=\{c_1,c_2,â€¦,c_M\}\in\cal R^{M \times d}$ï¼ŒåŸºäºå­—çš„è¯æ±‡è¡¨ä¸º$\cal V$ï¼Œå…¶ä¸­$c_i$æ˜¯ç¬¬$i$ä¸ªå­—çš„char embeddingï¼Œä¸”$c_i\in \cal R^d$ï¼Œå¥å­ä¸­ä¸lexiconç›¸åŒ¹é…çš„æ¯ä¸€ä¸ªè¯è¯­è¡¨ç¤ºä¸ºï¼š$w_m^l=\{c_m,â€¦,c_{m+l-1}\}$ï¼Œå…¶ä¸­$c_m$è¡¨ç¤ºè¿™ä¸ªè¯è¯­çš„é¦–ä¸ªå­—ï¼Œ$l$æ˜¯è¿™ä¸ªè¯è¯­çš„é•¿åº¦ã€‚</p></li><li><p>åœ¨å¥å­ç¼–ç å±‚ï¼ŒLRCNNæ¨¡å‹stackå¤šå±‚çš„cnn layerï¼Œä¸»è¦ç›®çš„å°±æ˜¯ï¼šä¸ä»…èƒ½å¤Ÿå¾ˆå¥½çš„èå…¥è¯æ±‡ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿå¹¶è¡ŒåŒ–åŠ é€Ÿè®­ç»ƒã€‚å…·ä½“æ¥è¯´ï¼šé‡‡ç”¨window sizeä¸º2çš„ä¸€ç»´å·ç§¯ï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œæˆ‘ä»¬å°†char embeddingå½“ä½œç¬¬ä¸€å±‚ï¼Œé‚£ä¹ˆä½¿ç”¨ä¸€æ¬¡å·ç§¯åï¼Œå¯ä»¥å¾—åˆ°ç¬¬äºŒå±‚ï¼Œè¿™ä¸€å±‚ä¸­æ¯ä¸€ä¸ªtokenéƒ½æ˜¯ä¸€ä¸ªbigramï¼Œå¦‚æœåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåœ¨ä½¿ç”¨ä¸€æ¬¡å·ç§¯ï¼Œå°±å¯ä»¥å¾—åˆ°trigramï¼Œä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸æ–­åœ°æ‰©å¤§æ„Ÿå—é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯æ±‡ä¿¡æ¯èå…¥å…¶ä¸­ï¼Œå…·ä½“æ¥è¯´ï¼šè­¬å¦‚<code>å¹¿å·</code>æ˜¯lexiconä¸­çš„è¯ï¼Œä¹Ÿæ˜¯å·ç§¯åçš„bigramï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨badanan attentionï¼Œä»è€Œå°†bigramä¿¡æ¯ä¸è¯æ±‡ä¿¡æ¯è¿›è¡Œèåˆã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/cnn_attention.jpg" style="zoom: 33%;"></p><p>å…¶ä¸­$X_m^l$è¡¨ç¤ºçš„æ˜¯èåˆä¹‹åçš„ç»“æœã€‚</p></li><li><p>ç”±äºCNNçš„åˆ†å±‚ç»“æ„ï¼Œä½å±‚çš„è¯æ±‡æ— æ³•å½±å“åˆ°é«˜å±‚çš„è¯æ±‡ï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒLRCNNæ¨¡å‹ä¸­åº”ç”¨äº†rethinking mechanismã€‚æ‰€è°“åœ°rethinking mechanismæŒ‡çš„æ˜¯ï¼šä½¿ç”¨æœ€é¡¶å±‚çš„CNNçš„feature mapæ¥æŒ‡å¯¼ä½å±‚çš„lexicon conflictsé—®é¢˜ã€‚å…·ä½“åšæ³•æ˜¯ï¼šå‘æ¯ä¸€å±‚CNNæ·»åŠ ä¸€ä¸ªfeedback layeræ¥è°ƒæ•´lexiconçš„æƒé‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœé«˜å±‚ç‰¹å¾ä¸­æ²¡æœ‰å¾—åˆ°<code>å¹¿å·å¸‚</code>ä¸<code>é•¿éš†</code>ï¼Œé‚£ä¹ˆä½å±‚çš„<code>å¸‚é•¿</code>è¿™ä¸€è¯æ±‡å°†ä¼šå¯¹æœ€ç»ˆçš„æ ‡æ³¨äº§ç”Ÿè¯¯å¯¼ï¼Œæ‰€ä»¥éœ€è¦<code>å¹¿å·å¸‚</code>æ¥é™ä½<code>å¸‚é•¿</code>ä¸€è¯åœ¨è¾“å‡ºç‰¹å¾ä¸­çš„æƒé‡ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/rethinking.jpg" style="zoom:50%;"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä¸­$W,U,b$éƒ½æ˜¯reuse attention moduleä¸­çš„å‚æ•°ï¼Œä¸ºäº†é¿å…è¿‡æ‹Ÿåˆã€‚</p></li><li><p>ç»è¿‡$L$å±‚ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°$L$ä¸ªmultigramçš„ä¿¡æ¯ï¼Œå…¶ç»´åº¦éƒ½æ˜¯$[batch_size,hidden_size,seq_length]$ã€‚æ¥ä¸‹æ¥ï¼Œä¸ºäº†è®©å¥å­çš„æ¯ä¸€ä¸ªå­—èƒ½å¤Ÿè‡ªé€‚åº”çš„é€‰æ‹©ä¸åŒgramçš„feature mapï¼ŒLRCNNå€Ÿé‰´äº†ã€ŠDensely Connected CNN with Multi-scale Feature Attention for Text Classificationã€‹<a href="https://blog.csdn.net/guoyuhaoaaa/article/details/81842767" target="_blank" rel="noopener">link</a> paperä¸­çš„multi-scale attentionæœºåˆ¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/multi-scale attention.jpg" style="zoom: 33%;"></p><p>å…¶ä¸­ï¼Œ$s_m^l$è¡¨ç¤ºçš„æ˜¯ç¬¬Lå±‚çš„featureçš„ç¬¬mä¸ªå­—å¯¹å…¶Dä¸ªç‰¹å¾è¿›è¡Œæ±‚å’Œå¾—åˆ°çš„scalarï¼Œæˆ‘ä»¬æœ€ç»ˆè¾“å…¥åˆ°CRFå±‚çš„æ˜¯ï¼š$X^{att}=\{X_1^{att},X_2^{att},â€¦,X_M^{att}\}$ã€‚</p></li></ol><h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ol><li><p>æ•°æ®é›†ä»ç„¶æ˜¯é‚£å››ä¸ªï¼šMSRAã€OntoNotesã€Weiboã€Resume</p></li><li><p>å‚æ•°è®¾å®šï¼šinitial learning rateï¼š0.0015 with decay rateï¼š0.05ï¼Œdropout rateï¼š0.5  on char embedding,lexicon embedding,cnn layers; char embedding(50) and lexicon embedding(50) were initialized by pretained embedding and fine_tuned during training; four cnn layer with 128 output channels for other datasets except MSRA(5 cnn layer with 300 channels);use earlystopping.</p></li><li><p>ç»“æœ</p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/msra.jpg" style="zoom:50%;"></p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/ontonotes.jpg" style="zoom:50%;"></p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/weibo.jpg" style="zoom:50%;"></p><p><img src="/2020/10/13/NLP-NER-LRCNN%E6%A8%A1%E5%9E%8B/resume.jpg" style="zoom:50%;"></p></li></ol><p>ä»å®éªŒç»“æœæ¥çœ‹ï¼ŒLRCNNè¿˜æ˜¯ä¸é”™çš„ï¼Œä¸è¿‡æˆ‘ä¸ªäººçš„æ„Ÿè§‰å°±æ˜¯è¿˜æ˜¯å¤ªè¿‡äºå¤æ‚äº†ï¼Œä¸»è¦æ˜¯rethinkingé‚£å—ï¼Œåº”è¯¥ä¸æ˜¯å¾ˆå¥½è¿ç§»åˆ°å…¶ä»–æ¨¡å‹ä¸Šã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠCNN-Based Chinese NER with Lexicon Rethinkingã€‹</p><p>ã€ŠDensely Connected CNN with Multi-scale Feature Attention for Text Classificationã€‹</p><p>LRCNN-code:<a href="https://github.com/gungunXD/LR-CNN" target="_blank" rel="noopener">https://github.com/gungunXD/LR-CNN</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> LRCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|NER-LatticeLSTMæ¨¡å‹</title>
      <link href="2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¼šæ›´æ–°ä¸€ç³»åˆ—NERçš„paperè§£è¯»ï¼Œè®¡åˆ’2å‘¨æ—¶é—´å°†NERçš„é‡è¦çš„è®ºæ–‡åˆ·å®Œï¼Œæœ‰ä¸€ä¸ªæƒ³åšçš„äº‹æƒ…å˜»å˜»ğŸ˜ã€‚è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹ã€ŠChinese NER Using Lattice LSTMã€‹è®ºæ–‡ï¼Œå³ï¼šLatticeLSTMæ¨¡å‹ã€‚</p><a id="more"></a><p>LatticeLSTMæ¨¡å‹æ¥æºäº2018å¹´ACLä¸Šçš„ã€ŠChinese NER Using Lattice LSTMã€‹è®ºæ–‡ã€‚éå¸¸ç»å…¸ï¼Œè€Œä¸”å®ƒreleaseçš„codeéå¸¸çš„è§„èŒƒï¼Œå¾ˆå€¼å¾—ä¸€è¯»ï½</p><h2 id="LatticeLSTMæ¨¡å‹æå‡ºçš„èƒŒæ™¯"><a href="#LatticeLSTMæ¨¡å‹æå‡ºçš„èƒŒæ™¯" class="headerlink" title="LatticeLSTMæ¨¡å‹æå‡ºçš„èƒŒæ™¯"></a>LatticeLSTMæ¨¡å‹æå‡ºçš„èƒŒæ™¯</h2><p>ç›®å‰åœ¨NERä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåŸºäºchar levelçš„modelä¸åŸºäºword levelçš„modelã€‚å¯¹äºç›®å‰çš„baselineâ€”LSTM+CRFï¼Œå¾ˆå¤šå®éªŒä¸­éƒ½è¯æ˜äº†ï¼šå¯¹äºä¸­æ–‡ï¼ŒåŸºäºword levelçš„modelè¦æ¯”åŸºäºchar levelçš„modelè¦å¥½ã€‚ä½†æ˜¯ä¸¤è€…ä¹Ÿéƒ½æœ‰å„è‡ªçš„ä¼˜åŠ£åŠ¿ã€‚char level modelæœ€å¤§çš„ç¼ºç‚¹åœ¨äºï¼š<strong>æ— æ³•å¾ˆå¥½çš„åˆ©ç”¨å­—ä¸å­—ä¹‹é—´çš„æœ‰æ•ˆä¿¡æ¯</strong>ï¼›word level modelæœ€å¤§çš„ç¼ºç‚¹åœ¨äºï¼š<strong>åœ¨ä¸­æ–‡ä¸­ï¼Œä¸€èˆ¬éƒ½éœ€è¦åˆ†è¯ï¼Œåˆ†è¯çš„å‡†ç¡®ç‡ç›´æ¥å½±å“åˆ°æœ€ç»ˆçš„NERç»“æœï¼Œæ‰€ä»¥ä¸å¥½çš„åˆ†è¯ä¼šå¸¦æ¥ä¸å¥½çš„NERç»“æœï¼Œè€Œç›®å‰word level modelè¿˜æ— æ³•å¾ˆå¥½åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</strong>åŸºäºè¿™ä¸ªèƒŒæ™¯ï¼Œä¸€ä¸ªå¾ˆè‡ªç„¶åœ°æƒ³æ³•å°±æ˜¯ï¼š<strong>å¦‚æœèƒ½å°†è¯æ±‡çš„ä¿¡æ¯èå…¥åˆ°char level modelä¸­ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿæé«˜æ¨¡å‹çš„æ•ˆæœ</strong>ï¼Œè¿™å°±æ˜¯LatticeLSTMæ¨¡å‹ã€‚</p><blockquote><p>æ³¨æ„ï¼šåœ¨ä¸­è‹±æ–‡ä¸­ï¼Œcharä¸wordçš„å«ä¹‰æ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨ä¸­æ–‡ä¸­ï¼šcharæŒ‡çš„æ˜¯å•ä¸ªå­—ï¼ŒwordæŒ‡çš„æ˜¯è¯è¯­ã€‚</p></blockquote><h2 id="LatticeLSTMæ¨¡å‹ä»‹ç»"><a href="#LatticeLSTMæ¨¡å‹ä»‹ç»" class="headerlink" title="LatticeLSTMæ¨¡å‹ä»‹ç»"></a>LatticeLSTMæ¨¡å‹ä»‹ç»</h2><p>ä¸ªäººè®¤ä¸ºè¿™ç¯‡æ–‡ç« æ•°å­¦ç¬¦å·è¾ƒå¤šï¼Œè€Œä¸”æ•´ä½“é€»è¾‘å¹¶ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œæ‰€ä»¥ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼ˆè™½ç„¶å…¬å¼å€’æ˜¯æŒºç®€å•çš„ï¼‰ï¼Œå…ˆæ”¾æ¨¡å‹å›¾å§ï½</p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/LatticeLSTM.jpg" alt></p><ul><li><p><strong>æ¨¡å‹è¾“å…¥ï¼š</strong>å‡è®¾è¾“å…¥çš„åºåˆ—ä¸º$\{c_1,c_2,c_3,â€¦,c_n\}$ï¼Œå…¶ä¸­$c_i$è¡¨ç¤ºç¬¬$i$ä¸ªå­—ï¼Œé‚£ä¹ˆæ•´ä¸ªæ¨¡å‹çš„è¾“å…¥æœ‰ä¸¤éƒ¨åˆ†ï¼š$\{c_1,c_2,c_3,â€¦,c_n\}$ä»¥åŠä¸è¯å…¸$\cal D$ç›¸åŒ¹é…çš„æ‰€æœ‰è¯è¯­ã€‚</p></li><li><p><strong>embedding+LSTMï¼š</strong>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯å°†è¯æ±‡ä¿¡æ¯èå…¥åˆ°char level modelä¸­ã€‚æœ‰ä¸‰å¤§éƒ¨åˆ†ï¼šå­—æœ¬èº«çš„char embeddingåŠLSTMéƒ¨åˆ†ã€ä»¥å½“å‰å­—ä¸ºç»“å°¾çš„ç›¸å…³çš„è¯è¯­çš„embeddingä¿¡æ¯ä»¥åŠLSTMéƒ¨åˆ†ã€ä¸¤è€…çš„èåˆã€‚</p><blockquote><p>æ³¨æ„ï¼Œåœ¨è®ºæ–‡é‡Œé¢ï¼Œæ¼”ç¤ºçš„æ˜¯å•å‘çš„LSTMï¼Œä½†æ˜¯å¦‚æœå»çœ‹ä»£ç çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°ä¹Ÿå¯ä»¥ä½¿ç”¨åŒå‘çš„LSTMï¼Œåªè¦æŠŠforwardå’Œbackwardçš„ç»“æœæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶åè¾“é€åˆ°CRFä¸­å³å¯ã€‚</p></blockquote><ul><li><strong>å­—$c_j$çš„char embedding</strong>è¾ƒä¸ºç®€å•ï¼Œå…·ä½“è¡¨ç¤ºå¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">x_{j}^{c}=e^c(c_j)\\h^{c}_{j}=LSTM(x_{j}^{c})</script><ul><li><p>å¯¹äº<strong>ä»¥å½“å‰å­—ä¸ºç»“å°¾çš„ç›¸å…³çš„è¯è¯­çš„embeddingä¿¡æ¯</strong>çš„è®¡ç®—ï¼Œç›¸å¯¹æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œä½†æ˜¯æ€»ä½“æ€æƒ³è¿˜æ˜¯ç®€å•çš„ã€‚ä»¥<code>æ¡¥</code>ä¸ºä¾‹ï¼Œä¸å®ƒç›¸å…³çš„è¯è¯­ä¿¡æ¯æœ‰ï¼š<code>é•¿æ±Ÿå¤§æ¡¥</code>ä¸<code>å¤§æ¡¥</code>ã€‚å…·ä½“è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/equation_lexicon embedding.svg" alt></p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/equation_lexicon_embedding_2.svg" alt></p><p>è¿™ä¸ªå…¶å®å’Œæ™®é€šçš„LSTMå¾ˆåƒï¼Œåªä¸è¿‡ä¸æ›´æ–°è¾“å‡ºã€‚å…¶ä¸­ï¼Œ$x_{b,e}^{w}$è¡¨ç¤ºæ˜¯indexä»båˆ°eçš„è¯è¯­çš„embeddingï¼Œå…¬å¼æ˜¯ï¼š$x_{b,e}^{w}=e^w(w_{b,e}^{d})$ï¼Œ$h_{b}^{c}$è¡¨ç¤ºçš„æ˜¯è¯è¯­é¦–ä¸ªå­—çš„LSTMçš„è¾“å‡ºçš„hidden stateï¼Œ$c_{b}^{c}$è¡¨ç¤ºçš„æ˜¯è¯è¯­é¦–ä¸ªå­—çš„LSTMçš„è¾“å‡ºçš„cell stateï¼Œé€šè¿‡è¿™ä¸€æ­¥ï¼Œå¾—åˆ°çš„å°±æ˜¯æ¨¡å‹å›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯æ±‡çš„cellå€¼ï¼š$c_{b,e}^{w}$ã€‚</p></li><li><p><strong>å­—æœ¬èº«çš„ä¿¡æ¯ä¸è¯æ±‡ä¿¡æ¯è¿›è¡Œèåˆ</strong>ã€‚ä»¥<code>æ¡¥</code>ä¸ºä¾‹ï¼Œæœ‰ä¸‰éƒ¨åˆ†çš„ä¿¡æ¯ï¼š<code>æ¡¥</code>ã€<code>é•¿æ±Ÿå¤§æ¡¥</code>ã€<code>å¤§æ¡¥</code>ã€‚èåˆçš„æ–¹å¼å…¶å®å°±æ˜¯softmaxã€‚å…·ä½“å¦‚ä¸‹ï¼š</p></li></ul><script type="math/tex; mode=display">i_{b,e}^{c}=\sigma(W\left[\begin{matrix} x_{e}^{c} \\ c_{b,e}^{w} \end{matrix}\right]+b)\\i_{e}^{c}=\sigma(W\left[\begin{matrix} x_{e}^{c} \\ h_{j-1}^{c} \end{matrix}\right]+b)\\(i_{e}^{c}å°±æ˜¯char è¾“å…¥åˆ°LSTMå½“ä¸­ï¼Œè®¡ç®—çš„è¾“å…¥é—¨ï¼)</script><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/softmax.jpg" style="zoom:50%;"></p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/softmax1.jpg" style="zoom:50%;"></p><p>è¿™ä¸€æ­¥æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„æ˜¯$c_{j}^{c}$ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„è¾“å…¥åˆ°CRFä¸­çš„æ˜¯$h_{j}^{c}$ï¼Œå…¶è®¡ç®—å…¬å¼ä¸LSTMæ˜¯ä¸€æ ·çš„ï¼Œä¸ºï¼š$h_{j}^{c}=o_{j}^{c}*tanh(c_j^c)$ã€‚åé¢çš„å°±æ˜¯CRFæ¨¡å‹äº†ï¼Œæ¯”è¾ƒç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€åçš„lossï¼ŒåŠ äº†L2æ­£åˆ™é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p></li></ul><h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ul><li>æ•°æ®é›†ï¼šMSRAã€OntoNotesã€Weiboã€resume(released by this paper)</li></ul><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/data.jpg" style="zoom:50%;"></p><ul><li>è¯„ä»·æŒ‡æ ‡ï¼šP/R/F1(exact match)</li><li><p>ä½¿ç”¨äº†pretrained word embeddingï¼Œåœ¨å¤§è§„æ¨¡çš„æ— ç›‘ç£çš„è¯­æ–™ä¸­ä½¿ç”¨word2vecç®—æ³•ï¼Œå¾—åˆ°å­—å‘é‡ä¸è¯å‘é‡ï¼Œå¹¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­fine-tuneã€‚</p></li><li><p>å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š</p></li></ul><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/å‚æ•°.jpg" style="zoom:50%;"></p><ul><li>ç»“æœï¼š</li></ul><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/ontonotes-result.jpg" style="zoom:50%;"></p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/msra-result.jpg" style="zoom:50%;"></p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/weibo.jpg" style="zoom:50%;"></p><p><img src="/2020/10/11/NLP-NER-LatticeLSTM%E6%A8%A1%E5%9E%8B/resume.jpg" style="zoom:50%;"></p><p>ä»å®éªŒç»“æœæ¥çœ‹ï¼ŒLatticeLSTMåœ¨å››ä¸ªæ•°æ®é›†ä¸Šéƒ½è¾¾åˆ°äº†SOTAï¼Œå¹¶ä¸”ç›¸æ¯”äºbaseï¼ˆLSTM+CRFï¼‰æ¥è¯´ï¼Œæå‡æ•ˆæœæ˜¯éå¸¸æ˜¾è‘—çš„ã€‚</p><ul><li>æœ‰æ„æ€çš„ç»“è®º</li></ul><p>paperæœ€åï¼Œè¿˜åšäº†ä¸€äº›æœ‰æ„æ€çš„å®éªŒï¼Œæ€»ç»“èµ·æ¥æœ‰å¦‚ä¸‹ç»“è®ºï¼š</p><ol><li>éšç€åºåˆ—é•¿åº¦è¶Šæ¥è¶Šé•¿ï¼ŒNERçš„ç»“æœF1å€¼ä¹Ÿæ˜¯é€æ¸ä¸‹è·Œçš„ï¼Œä½†æ˜¯LatticeLSTMä¸‹è·Œçš„é€Ÿåº¦è¦æ…¢ä¸€äº›ï¼Œæ‰€ä»¥æ›´åŠ é²æ£’ã€‚</li><li>lexiconçš„è¯è¯­ä¼šå½±å“åˆ°æœ€ç»ˆçš„ç»“æœï¼Œæ‰€ä»¥åˆ¶ä½œlexiconè¦æ›´åŠ å°å¿ƒè°¨æ…ä¸€äº›ï¼Œç¡®ä¿å¾—åˆ°å°½é‡å‡†ç¡®çš„è¯è¯­ã€‚</li></ol><h2 id="æ ¸å¿ƒä»£ç èµ°è¯»"><a href="#æ ¸å¿ƒä»£ç èµ°è¯»" class="headerlink" title="æ ¸å¿ƒä»£ç èµ°è¯»"></a>æ ¸å¿ƒä»£ç èµ°è¯»</h2><p>åŸå§‹ä»£ç æŒºæ¸…æ™°çš„ï¼Œè¯»èµ·æ¥åº”è¯¥ä¸éš¾ï¼Œæœ€æ ¸å¿ƒçš„ä»£ç æ˜¯latticelstm.pyï¼Œåç»­çš„bilstm.pyä»¥åŠbilstmcrf.pyéƒ½æœ‰è°ƒç”¨latticelstm.pyä¸­çš„latticelstméƒ¨åˆ†ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œæˆ‘å°±æ”¾ä¸€ä¸‹latticelstmçš„ä»£ç éƒ¨åˆ†å§ï¼Œè¦æ˜¯æ„Ÿå…´è¶£çš„è¯ï¼Œç›´æ¥å»è¯»å®Œæ•´çš„åŸå§‹ä»£ç å°±å¯ä»¥äº†ï½<a href="https://github.com/jiesutd/LatticeLSTM" target="_blank" rel="noopener">code link</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiInputLSTMCell</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""A basic LSTM cell."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, input_size, hidden_size, use_bias=True)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Most parts are copied from torch.nn.LSTMCell.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        super(MultiInputLSTMCell, self).__init__()</span><br><span class="line">        self.input_size = input_size</span><br><span class="line">        self.hidden_size = hidden_size</span><br><span class="line">        self.use_bias = use_bias</span><br><span class="line">        self.weight_ih = nn.Parameter(</span><br><span class="line">            torch.FloatTensor(input_size, <span class="number">3</span> * hidden_size))</span><br><span class="line">        self.weight_hh = nn.Parameter(</span><br><span class="line">            torch.FloatTensor(hidden_size, <span class="number">3</span> * hidden_size))</span><br><span class="line">        self.alpha_weight_ih = nn.Parameter(</span><br><span class="line">            torch.FloatTensor(input_size, hidden_size))</span><br><span class="line">        self.alpha_weight_hh = nn.Parameter(</span><br><span class="line">            torch.FloatTensor(hidden_size, hidden_size))</span><br><span class="line">        <span class="keyword">if</span> use_bias:</span><br><span class="line">            self.bias = nn.Parameter(torch.FloatTensor(<span class="number">3</span> * hidden_size))</span><br><span class="line">            self.alpha_bias = nn.Parameter(torch.FloatTensor(hidden_size))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.register_parameter(<span class="string">'bias'</span>, <span class="literal">None</span>)</span><br><span class="line">            self.register_parameter(<span class="string">'alpha_bias'</span>, <span class="literal">None</span>)</span><br><span class="line">        self.reset_parameters()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_parameters</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialize parameters following the way proposed in the paper.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        init.orthogonal(self.weight_ih.data)</span><br><span class="line">        init.orthogonal(self.alpha_weight_ih.data)</span><br><span class="line"></span><br><span class="line">        weight_hh_data = torch.eye(self.hidden_size)</span><br><span class="line">        weight_hh_data = weight_hh_data.repeat(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">        self.weight_hh.data.set_(weight_hh_data)</span><br><span class="line"></span><br><span class="line">        alpha_weight_hh_data = torch.eye(self.hidden_size)</span><br><span class="line">        alpha_weight_hh_data = alpha_weight_hh_data.repeat(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.alpha_weight_hh.data.set_(alpha_weight_hh_data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The bias is just set to zero vectors.</span></span><br><span class="line">        <span class="keyword">if</span> self.use_bias:</span><br><span class="line">            init.constant(self.bias.data, val=<span class="number">0</span>)</span><br><span class="line">            init.constant(self.alpha_bias.data, val=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, input_, c_input, hx)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            batch = 1</span></span><br><span class="line"><span class="string">            input_: A (batch, input_size) tensor containing input</span></span><br><span class="line"><span class="string">                features.</span></span><br><span class="line"><span class="string">            c_input: A  list with size c_num,each element is the input ct from skip word (batch, hidden_size).</span></span><br><span class="line"><span class="string">            hx: A tuple (h_0, c_0), which contains the initial hidden</span></span><br><span class="line"><span class="string">                and cell state, where the size of both states is</span></span><br><span class="line"><span class="string">                (batch, hidden_size).</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            h_1, c_1: Tensors containing the next hidden and cell state.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        h_0, c_0 = hx <span class="comment"># åˆå§‹çš„hidden stateä¸cell valueï¼Œshape=[batch_size,hidden_size]</span></span><br><span class="line">        batch_size = h_0.size(<span class="number">0</span>) <span class="comment"># è®°ä½pytorchä¸­è¿™ç§è·å–æŒ‡å®šç»´åº¦çš„æ–¹å¼</span></span><br><span class="line">        <span class="keyword">assert</span>(batch_size == <span class="number">1</span>)</span><br><span class="line">        bias_batch = (self.bias.unsqueeze(<span class="number">0</span>).expand(batch_size, *self.bias.size()))</span><br><span class="line">        wh_b = torch.addmm(bias_batch, h_0, self.weight_hh) <span class="comment">#[batch_size,3*hidden_size]</span></span><br><span class="line">        wi = torch.mm(input_, self.weight_ih) <span class="comment">#[batch_size,3*hidden_size]</span></span><br><span class="line">        i, o, g = torch.split(wh_b + wi, split_size=self.hidden_size, dim=<span class="number">1</span>) <span class="comment">#element size:[batch_size,hidden_size]</span></span><br><span class="line">        g = torch.tanh(g) <span class="comment"># totile g</span></span><br><span class="line">        o = torch.sigmoid(o) <span class="comment"># è¾“å‡ºé—¨</span></span><br><span class="line">        c_num = len(c_input) <span class="comment"># è¯æ±‡çš„æ•°ç›®</span></span><br><span class="line">        <span class="keyword">if</span> c_num == <span class="number">0</span>:</span><br><span class="line">            f = <span class="number">1</span> - i <span class="comment"># é—å¿˜é—¨</span></span><br><span class="line">            c_1 = f*c_0 + i*g <span class="comment"># cellå€¼</span></span><br><span class="line">            h_1 = o * torch.tanh(c_1) <span class="comment"># æ–°çš„ hidden state</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c_input_var = torch.cat(c_input, <span class="number">0</span>) <span class="comment">#[c_num,hidden_size]</span></span><br><span class="line">            alpha_bias_batch = (self.alpha_bias.unsqueeze(<span class="number">0</span>).expand(batch_size, *self.alpha_bias.size())) <span class="comment"># [batch_size,hidden_size]</span></span><br><span class="line">            c_input_var = c_input_var.squeeze(<span class="number">1</span>) <span class="comment">## [c_num, hidden_size]</span></span><br><span class="line">            alpha_wi = torch.addmm(self.alpha_bias, input_, self.alpha_weight_ih).expand(c_num, self.hidden_size)</span><br><span class="line">            alpha_wh = torch.mm(c_input_var, self.alpha_weight_hh)<span class="comment">#[batch_size,hidden_size]</span></span><br><span class="line">            alpha = torch.sigmoid(alpha_wi + alpha_wh) <span class="comment">#[batch_size,hidden_size]</span></span><br><span class="line">            <span class="comment">## alpha  = i concat alpha</span></span><br><span class="line">            alpha = torch.exp(torch.cat([i, alpha],<span class="number">0</span>))</span><br><span class="line">            alpha_sum = alpha.sum(<span class="number">0</span>)</span><br><span class="line">            <span class="comment">## alpha = softmax for each hidden element</span></span><br><span class="line">            alpha = torch.div(alpha, alpha_sum)</span><br><span class="line">            merge_i_c = torch.cat([g, c_input_var],<span class="number">0</span>)</span><br><span class="line">            c_1 = merge_i_c * alpha</span><br><span class="line">            c_1 = c_1.sum(<span class="number">0</span>).unsqueeze(<span class="number">0</span>)</span><br><span class="line">            h_1 = o * torch.tanh(c_1)</span><br><span class="line">        <span class="keyword">return</span> h_1, c_1</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        s = <span class="string">'&#123;name&#125;(&#123;input_size&#125;, &#123;hidden_size&#125;)'</span></span><br><span class="line">        <span class="keyword">return</span> s.format(name=self.__class__.__name__, **self.__dict__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LatticeLSTM</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""A module that runs multiple steps of LSTM."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, input_dim, hidden_dim, word_drop, word_alphabet_size, word_emb_dim, pretrain_word_emb=None, left2right=True, fix_word_emb=True, gpu=True,  use_bias = True)</span>:</span></span><br><span class="line">        super(LatticeLSTM, self).__init__()</span><br><span class="line">        skip_direction = <span class="string">"forward"</span> <span class="keyword">if</span> left2right <span class="keyword">else</span> <span class="string">"backward"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"build LatticeLSTM... "</span>, skip_direction, <span class="string">", Fix emb:"</span>, fix_word_emb, <span class="string">" gaz drop:"</span>, word_drop</span><br><span class="line">        self.gpu = gpu</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.word_emb = nn.Embedding(word_alphabet_size, word_emb_dim)</span><br><span class="line">        <span class="keyword">if</span> pretrain_word_emb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"load pretrain word emb..."</span>, pretrain_word_emb.shape</span><br><span class="line">            self.word_emb.weight.data.copy_(torch.from_numpy(pretrain_word_emb))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.word_emb.weight.data.copy_(torch.from_numpy(self.random_embedding(word_alphabet_size, word_emb_dim)))</span><br><span class="line">        <span class="keyword">if</span> fix_word_emb:</span><br><span class="line">            self.word_emb.weight.requires_grad = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        self.word_dropout = nn.Dropout(word_drop)</span><br><span class="line"></span><br><span class="line">        self.rnn = MultiInputLSTMCell(input_dim, hidden_dim)</span><br><span class="line">        self.word_rnn = WordLSTMCell(word_emb_dim, hidden_dim)</span><br><span class="line">        self.left2right = left2right</span><br><span class="line">        <span class="keyword">if</span> self.gpu:</span><br><span class="line">            self.rnn = self.rnn.cuda()</span><br><span class="line">            self.word_emb = self.word_emb.cuda()</span><br><span class="line">            self.word_dropout = self.word_dropout.cuda()</span><br><span class="line">            self.word_rnn = self.word_rnn.cuda()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">random_embedding</span><span class="params">(self, vocab_size, embedding_dim)</span>:</span></span><br><span class="line">        pretrain_emb = np.empty([vocab_size, embedding_dim])</span><br><span class="line">        scale = np.sqrt(<span class="number">3.0</span> / embedding_dim)</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(vocab_size):</span><br><span class="line">            pretrain_emb[index,:] = np.random.uniform(-scale, scale, [<span class="number">1</span>, embedding_dim])</span><br><span class="line">        <span class="keyword">return</span> pretrain_emb</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, input, skip_input_list, hidden=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">            input: variable (batch, seq_len), batch = 1</span></span><br><span class="line"><span class="string">            skip_input_list: [skip_input, volatile_flag]</span></span><br><span class="line"><span class="string">            skip_input: three dimension list, with length is seq_len. Each element is a list of matched word id and its length. </span></span><br><span class="line"><span class="string">                        example: [[], [[25,13],[2,3]]] 25/13 is word id, 2,3 is word length . </span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        volatile_flag = skip_input_list[<span class="number">1</span>]</span><br><span class="line">        skip_input = skip_input_list[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.left2right:</span><br><span class="line">            skip_input = convert_forward_gaz_to_backward(skip_input)</span><br><span class="line">        input = input.transpose(<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">        seq_len = input.size(<span class="number">0</span>)</span><br><span class="line">        batch_size = input.size(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">assert</span>(batch_size == <span class="number">1</span>)</span><br><span class="line">        hidden_out = []</span><br><span class="line">        memory_out = []</span><br><span class="line">        <span class="keyword">if</span> hidden:</span><br><span class="line">            (hx,cx)= hidden</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hx = autograd.Variable(torch.zeros(batch_size, self.hidden_dim))</span><br><span class="line">            cx = autograd.Variable(torch.zeros(batch_size, self.hidden_dim))</span><br><span class="line">            <span class="keyword">if</span> self.gpu:</span><br><span class="line">                hx = hx.cuda()</span><br><span class="line">                cx = cx.cuda()</span><br><span class="line">        </span><br><span class="line">        id_list = range(seq_len)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.left2right:</span><br><span class="line">            id_list = list(reversed(id_list))</span><br><span class="line">        input_c_list = init_list_of_objects(seq_len)</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> id_list:</span><br><span class="line">            (hx,cx) = self.rnn(input[t], input_c_list[t], (hx,cx))</span><br><span class="line">            hidden_out.append(hx)</span><br><span class="line">            memory_out.append(cx)</span><br><span class="line">            <span class="keyword">if</span> skip_input[t]:</span><br><span class="line">                matched_num = len(skip_input[t][<span class="number">0</span>])</span><br><span class="line">                word_var = autograd.Variable(torch.LongTensor(skip_input[t][<span class="number">0</span>]),volatile =  volatile_flag)</span><br><span class="line">                <span class="keyword">if</span> self.gpu:</span><br><span class="line">                    word_var = word_var.cuda()</span><br><span class="line">                word_emb = self.word_emb(word_var)</span><br><span class="line">                word_emb = self.word_dropout(word_emb)</span><br><span class="line">                ct = self.word_rnn(word_emb, (hx,cx))</span><br><span class="line">                <span class="keyword">assert</span>(ct.size(<span class="number">0</span>)==len(skip_input[t][<span class="number">1</span>]))</span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> range(matched_num):</span><br><span class="line">                    length = skip_input[t][<span class="number">1</span>][idx]</span><br><span class="line">                    <span class="keyword">if</span> self.left2right:</span><br><span class="line">                        <span class="comment"># if t+length &lt;= seq_len -1:</span></span><br><span class="line">                        input_c_list[t+length<span class="number">-1</span>].append(ct[idx,:].unsqueeze(<span class="number">0</span>))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># if t-length &gt;=0:</span></span><br><span class="line">                        input_c_list[t-length+<span class="number">1</span>].append(ct[idx,:].unsqueeze(<span class="number">0</span>))</span><br><span class="line">                <span class="comment"># print len(a)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.left2right:</span><br><span class="line">            hidden_out = list(reversed(hidden_out))</span><br><span class="line">            memory_out = list(reversed(memory_out))</span><br><span class="line">        output_hidden, output_memory = torch.cat(hidden_out, <span class="number">0</span>), torch.cat(memory_out, <span class="number">0</span>)</span><br><span class="line">        <span class="comment">#(batch, seq_len, hidden_dim)</span></span><br><span class="line">        <span class="comment"># print output_hidden.size()</span></span><br><span class="line">        <span class="keyword">return</span> output_hidden.unsqueeze(<span class="number">0</span>), output_memory.unsqueeze(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿è®°å½•ä¸€ä¸‹å¦å¤–çœ‹çš„ä¸€ç‰‡IDCNN+CRFçš„è®ºæ–‡ï¼Œæ¯”è¾ƒç®€å•ï¼Œè€Œä¸”æ•ˆæœä¸€èˆ¬ï¼Œä¸»è¦çš„å–ç‚¹å°±æ˜¯å¿«ï¼Œä½†å®é™…ä¸Šæˆ‘æ„Ÿè§‰æ²¡æœ‰å¿«å¤šå°‘ã€‚</p><h2 id="IDCNN-CRFæ¨¡å‹"><a href="#IDCNN-CRFæ¨¡å‹" class="headerlink" title="IDCNN+CRFæ¨¡å‹"></a>IDCNN+CRFæ¨¡å‹</h2><p>åœ¨NERä¸­ï¼ŒRNNç³»åˆ—çš„æ¨¡å‹æˆä¸ºäº†æ ‡å‡†çš„æå–æ–‡æœ¬è¡¨ç¤ºçš„æ¨¡å‹ï¼Œä½†æ˜¯RNNä¸€ä¸ªå¾ˆå¤§çš„ç¼ºé™·æ˜¯ï¼šæ— æ³•å¹¶è¡ŒåŒ–ï¼Œä»è€Œå¯¼è‡´æ•´ä¸ªæ¨¡å‹è¿è¡Œéå¸¸æ…¢ï¼Œè®¡ç®—å¤æ‚åº¦ä¸åºåˆ—é•¿åº¦æˆæ­£ç›¸å…³ã€‚è€ŒCNNç³»åˆ—çš„æ¨¡å‹çš„ä¸€å¤§ä¼˜åŠ¿å°±æ˜¯å¯ä»¥å¹¶è¡ŒåŒ–ï¼Œä¸”è®¡ç®—å¤æ‚åº¦ä¸åºåˆ—é•¿åº¦æ— å…³ï¼Œåªä¸å±‚æ•°æœ‰å…³ã€‚ä½†æ˜¯CNNåº”ç”¨äºNERçš„ä¸€ä¸ªéå¸¸å¤§çš„é—®é¢˜åœ¨äºï¼šæ¯ä¸€æ¬¡çš„å·ç§¯æ„Ÿå—é‡è¾ƒå°ï¼Œå¯¹äºNERè¿™ç§éå¸¸çœ‹é‡å¥å­é•¿ä¾èµ–çš„NLPä»»åŠ¡ï¼Œå…·æœ‰å¾ˆå¤§çš„åŠ£åŠ¿ï¼Œä¸€ç§åŠæ³•æ˜¯é€šè¿‡ä¸æ–­å åŠ å·ç§¯å±‚æ¥æ‰©å¤§æ„Ÿå—é‡ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šå¯¼è‡´æ¨¡å‹çš„è®¡ç®—å¤æ‚åº¦ä¸åºåˆ—é•¿åº¦æˆæ­£ç›¸å…³ã€‚æ‰€ä»¥ï¼Œ<strong>å¦‚ä½•èƒ½å¤Ÿè®©æ•´ä¸ªæ¨¡å‹å¹¶è¡ŒåŒ–ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿè¾ƒå¥½åœ°æ•æ‰åˆ°æ•´ä¸ªå¥å­çš„é•¿ä¾èµ–å…³ç³»å‘¢ï¼Ÿ</strong>è¿™å°±æ˜¯IDCNN+CRFæ¨¡å‹çš„ç”±æ¥ã€‚è‡³äºä»€ä¹ˆæ˜¯ç©ºæ´å·ç§¯ï¼Œè¯·è§<a href="https://zhuanlan.zhihu.com/p/113285797" target="_blank" rel="noopener">link</a>.</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠChinese NER Using Lattice LSTMã€‹</p><p>ã€ŠFast and Accurate Entity Recognition with Iterated Dilated Convolutionsã€‹</p><p><a href="https://zhuanlan.zhihu.com/p/143272435" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/143272435</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> å‘½åå®ä½“è¯†åˆ« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> å‘½åå®ä½“è¯†åˆ« </tag>
            
            <tag> LatticeLSTM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tensorflow1.xçš„é›¶ç¢ç¬”è®°</title>
      <link href="2020/10/04/Tensorflow1-x%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/"/>
      <url>2020/10/04/Tensorflow1-x%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>ä¸–äº‹è‰°éš¾ï¼Œå³ä¾¿tensorflow2.0å·²ç»å‡ºæ¥äº†ï¼Œä½†æ˜¯å·¥ä¸šç•Œå…¨éƒ½æ˜¯1.xçš„ä»£ç ï¼Œè¿˜æ˜¯å¾—å­¦tensorflow1.xå•ŠğŸ˜­ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å­¦ä¹ tensorflow1.xä¸­é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p><a id="more"></a><p><strong>1.tensorboard</strong></p><p>å…³äºtensorboardï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨å‘½ä»¤<code>tensorboard --logdir=&#39;your logs path&#39;</code>.ä¸€èˆ¬ä½¿ç”¨tensorbaordï¼Œéƒ½æ˜¯ä¸ºäº†æŸ¥çœ‹graphçš„ç»“æ„ï¼Œä»¥åŠå„ç§lossã€å‚æ•°çš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>tf.summary</code>ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<a href="https://www.cnblogs.com/baby-lily/p/10931302.html" target="_blank" rel="noopener">link</a></p><ul><li>é¦–å…ˆå°†éœ€è¦å¯è§†åŒ–çš„å…¨éƒ¨å†™å…¥summaryï¼›</li><li><p>ç„¶ååˆå¹¶æ‰€æœ‰summaryï¼›</p></li><li><p>åˆ›å»ºsummary_file_writerï¼Œå°†å›¾å†™å…¥æ–‡ä»¶ï¼›</p></li><li>ä¸æ–­çš„å†™å…¥æ•°æ®ã€‚</li></ul><p>å¦å¤–ï¼Œå¸¸ç”¨çš„summaryæœ‰ï¼š</p><ul><li><code>tf.summary.scalar(&quot;loss&quot;,loss)</code>ï¼Œå¸¸ç”¨äºlossï¼Œaccuracyç­‰ï¼›</li><li><code>tf.summary.histogram(layer_name+&quot;/weight&quot;,W)</code>ï¼Œç”¨äºæ˜¾ç¤ºå‚æ•°çš„å˜åŒ–æƒ…å†µã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">"KMP_DUPLICATE_LIB_OK"</span>]=<span class="string">"TRUE"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x_data=np.linspace(<span class="number">-1</span>,<span class="number">1</span>,<span class="number">300</span>)[:,np.newaxis].astype(np.float32)</span><br><span class="line">noise=np.random.normal(<span class="number">0</span>,<span class="number">0.5</span>,x_data.shape)</span><br><span class="line">y_data=np.square(x_data)<span class="number">-0.5</span>+noise</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_layer</span><span class="params">(inputs,in_size,out_size,hidden_layer_name,activation_func=None)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å®šä¹‰è‡ªå·±çš„å±‚</span></span><br><span class="line"><span class="string">    :param inputs:è¾“å…¥çš„å¼ é‡</span></span><br><span class="line"><span class="string">    :param in_size: è¾“å…¥çš„ç»´åº¦</span></span><br><span class="line"><span class="string">    :param out_size: è¾“å‡ºçš„ç»´åº¦</span></span><br><span class="line"><span class="string">    :param activation_func: æ¿€æ´»å‡½æ•°</span></span><br><span class="line"><span class="string">    :return: è¾“å‡ºå¼ é‡</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    hidden_size=inputs.shape[<span class="number">1</span>].value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> hidden_size != in_size:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"wrong demension!"</span>)</span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(hidden_layer_name):</span><br><span class="line">        W=tf.get_variable(name=<span class="string">'W'</span>,shape=[in_size,out_size],dtype=tf.float32,initializer=tf.random_normal_initializer())</span><br><span class="line">        tf.summary.histogram(hidden_layer_name+<span class="string">"/weight"</span>,W)</span><br><span class="line">        b=tf.get_variable(name=<span class="string">'b'</span>,shape=[<span class="number">1</span>,out_size],dtype=tf.float32,initializer=tf.constant_initializer(<span class="number">0.0</span>))</span><br><span class="line">        tf.summary.histogram(hidden_layer_name + <span class="string">"/bias"</span>, b)</span><br><span class="line"></span><br><span class="line">    a=tf.matmul(inputs,W)+b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> activation_func == <span class="literal">None</span>:</span><br><span class="line">        outputs=a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        outputs=activation_func(a)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> outputs</span><br><span class="line"></span><br><span class="line">xs=tf.placeholder(dtype=tf.float32,shape=[<span class="literal">None</span>,<span class="number">1</span>])</span><br><span class="line">ys=tf.placeholder(dtype=tf.float32,shape=[<span class="literal">None</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">hidden_result=add_layer(xs,<span class="number">1</span>,<span class="number">10</span>,<span class="string">"hidden_layer"</span>,tf.nn.relu)</span><br><span class="line">outputs=add_layer(hidden_result,<span class="number">10</span>,<span class="number">1</span>,<span class="string">"output_layer"</span>,<span class="literal">None</span>)</span><br><span class="line">tf.summary.histogram(<span class="string">"output_layer/outputs"</span>,outputs)</span><br><span class="line"></span><br><span class="line">loss=tf.reduce_mean(tf.reduce_sum(tf.square(ys-outputs),axis=<span class="number">-1</span>),axis=<span class="number">-1</span>)</span><br><span class="line">tf.summary.scalar(<span class="string">"loss"</span>,loss)</span><br><span class="line">train_step=tf.train.GradientDescentOptimizer(learning_rate=<span class="number">0.1</span>).minimize(loss)</span><br><span class="line"></span><br><span class="line">init=tf.global_variables_initializer()</span><br><span class="line"></span><br><span class="line">fig=plt.figure()</span><br><span class="line">ax=fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">ax.scatter(x_data,y_data)</span><br><span class="line">plt.ion()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    merged_summary_all=tf.summary.merge_all()</span><br><span class="line">    summary_writer=tf.summary.FileWriter(<span class="string">"logs/"</span>,sess.graph)</span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        sess.run(train_step,feed_dict=&#123;xs:x_data,ys:y_data&#125;)</span><br><span class="line">        summary_str=sess.run(merged_summary_all,feed_dict=&#123;xs:x_data,ys:y_data&#125;)</span><br><span class="line">        summary_writer.add_summary(summary_str,step)</span><br><span class="line">        print(step,sess.run(loss,feed_dict=&#123;xs:x_data,ys:y_data&#125;))</span><br></pre></td></tr></table></figure><p>15308202070</p>]]></content>
      
      
      
        <tags>
            
            <tag> tensorflow1.x </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++|æ‹“æ‰‘æ’åº</title>
      <link href="2020/10/02/C-%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"/>
      <url>2020/10/02/C-%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡åˆ·é¢˜äº†ï¼Œä»Šå¤©åˆ·åˆ·é¢˜ï¼Œä¿æŒä¸€ä¸‹æ‰‹æ„Ÿï¼ŒåŒæ—¶ä¹Ÿå¯¹ç¢°åˆ°çš„å¾ˆå¤šå¥½ä¹…ä¸ç”¨çš„åŸºç¡€çš„æ•°æ®ç»“æ„åšä¸€ä¸‹å›é¡¾ã€‚</p><a id="more"></a><h2 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h2><p><strong>å®šä¹‰ï¼š</strong>å¯¹ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾(Directed Acyclic Graph, DAG)Gè¿›è¡Œæ‹“æ‰‘æ’åºï¼Œæ˜¯å°†Gä¸­æ‰€æœ‰é¡¶ç‚¹æ’æˆä¸€ä¸ªçº¿æ€§åºåˆ—ï¼Œä½¿å¾—å›¾ä¸­ä»»æ„ä¸€å¯¹é¡¶ç‚¹uå’Œvï¼Œè‹¥<uï¼Œv> âˆˆE(G)ï¼Œåˆ™uåœ¨çº¿æ€§åºåˆ—ä¸­å‡ºç°åœ¨vä¹‹å‰ã€‚é€šå¸¸ï¼Œè¿™æ ·çš„çº¿æ€§åºåˆ—ç§°ä¸ºæ»¡è¶³æ‹“æ‰‘æ¬¡åº(Topological Order)çš„åºåˆ—ï¼Œç®€ç§°<strong>æ‹“æ‰‘åºåˆ—</strong>ã€‚</uï¼Œv></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>åªæœ‰DAGæ‰æœ‰æ‹“æ‰‘æ’åºï¼Œåè¿‡æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªæœ‰å‘å›¾æ²¡æœ‰æ‹“æ‰‘æ’åºï¼Œè¯´æ˜è¿™ä¸ªå›¾æ˜¯éDAGçš„ï¼Œé€†å¦å‘½é¢˜å½“ç„¶æˆç«‹ã€‚</strong>ä¸€èˆ¬æ¥è¯´ï¼Œæ‹“æ‰‘æ’åºç”¨æ¥è§£å†³å›¾çš„æ˜¯å¦æœ‰ç¯çš„é—®é¢˜ã€‚</p><p><strong>æ‹“æ‰‘æ’åºçš„æ­¥éª¤æ˜¯ï¼š</strong></p><ul><li>ä»æœ‰å‘å›¾ä¸­é€‰æ‹©æ‰€æœ‰å…¥åº¦ä¸º0çš„nodeï¼Œç„¶åè¾“å‡ºï¼›</li><li><p>ä»æœ‰å‘å›¾ä¸­åˆ é™¤è¯¥èŠ‚ç‚¹ä»¥åŠä»¥è¿™ä¸ªnodeä¸ºå°¾çš„è¾¹(å³æ‰€æœ‰æŒ‡å‘è¯¥nodeçš„è¾¹)</p></li><li><p>é‡å¤ä¸Šé¢ä¸¤æ­¥ï¼ŒçŸ¥é“æœ€åå›¾ä¸ºç©ºï¼ˆæ˜¯DAGï¼Œå¯ä»¥è¾“å‡ºæ‹“æ‰‘æ’åºåºåˆ—ï¼‰ï¼Œæˆ–è€…å›¾ä¸ä¸ºç©ºä½†æ˜¯æ— æ³•æ‰¾å‡ºå…¥åº¦ä¸º0çš„nodeï¼ˆéDAGï¼‰ã€‚</p></li></ul><p>ä¸‹é¢æœ‰ä¸¤ä¸ªä¾‹å­ï¼Œæ¥è‡ªleetcodeã€‚</p><h2 id="è¯¾ç¨‹è¡¨"><a href="#è¯¾ç¨‹è¡¨" class="headerlink" title="è¯¾ç¨‹è¡¨"></a>è¯¾ç¨‹è¡¨</h2><p>ä½ è¿™ä¸ªå­¦æœŸå¿…é¡»é€‰ä¿® <code>numCourse</code> é—¨è¯¾ç¨‹ï¼Œè®°ä¸º <code>0</code> åˆ° <code>numCourse-1</code> ã€‚</p><p>åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬ï¼š<code>[0,1]</code></p><p>ç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¯·ä½ åˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿ </p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 2, [[1,0]] </span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆè¯¾ç¨‹ 0ã€‚æ‰€ä»¥è¿™æ˜¯å¯èƒ½çš„ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 2, [[1,0],[0,1]]</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ï¼›å¹¶ä¸”å­¦ä¹ è¯¾ç¨‹ 0 ä¹‹å‰ï¼Œä½ è¿˜åº”å…ˆå®Œæˆè¯¾ç¨‹ 1ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ol><li>è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”± <strong>è¾¹ç¼˜åˆ—è¡¨</strong> è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯ é‚»æ¥çŸ©é˜µ ã€‚è¯¦æƒ…è¯·å‚è§<a href="http://blog.csdn.net/woaidapaopao/article/details/51732947" target="_blank" rel="noopener">å›¾çš„è¡¨ç¤ºæ³•</a>ã€‚</li><li>ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚</li><li><code>1 &lt;= numCourses &lt;= 10^5</code></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">canFinish</span><span class="params">(<span class="keyword">int</span> numCourses, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; prerequisites)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(numCourses==<span class="number">0</span> || prerequisites.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">indegree</span><span class="params">(numCourses,<span class="number">0</span>)</span></span>;<span class="comment">//å…¥åº¦è¡¨</span></span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; <span class="title">graph</span><span class="params">(numCourses,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;())</span></span>; <span class="comment">//æœ‰å‘å›¾çš„é‚»æ¥çŸ©é˜µï¼Œè®°å¾—è¦åˆå§‹åŒ–ï¼Œè‡³å°‘è¦åˆå§‹åŒ–å…¶ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;prerequisites.<span class="built_in">size</span>();i++)&#123;<span class="comment">//æ„å»ºé‚»æ¥çŸ©é˜µ</span></span><br><span class="line">            graph[prerequisites[i][<span class="number">1</span>]].push_back(prerequisites[i][<span class="number">0</span>]);</span><br><span class="line">            indegree[prerequisites[i][<span class="number">0</span>]]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;<span class="comment">//é˜Ÿåˆ—ï¼ŒBFSï¼Œå…¶å®æ‹“æ‰‘æ’åºè¿˜å¯ä»¥ç”¨DFSï¼Œä½†æ˜¯æ²¡æœ‰BFSè¿™ä¸ªå¥½ç†è§£ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±ç™¾åº¦/Googleæœä¸€ä¸‹</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;indegree.<span class="built_in">size</span>();i++)&#123;<span class="comment">//å°†å…¥åº¦ä¸º0çš„nodeåŠ å…¥é˜Ÿåˆ—ä¸­</span></span><br><span class="line">            <span class="keyword">if</span>(indegree[i]==<span class="number">0</span>) q.push(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;<span class="comment">//ç»Ÿè®¡å…¥åº¦ä¸º0çš„èŠ‚ç‚¹æ•°</span></span><br><span class="line">        <span class="keyword">while</span>(q.empty()==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> temp=q.front();</span><br><span class="line">            q.pop();<span class="comment">//åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">            cnt++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;graph[temp].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                indegree[graph[temp][i]]--;<span class="comment">//åˆ é™¤ç›¸åº”çš„è¾¹</span></span><br><span class="line">                <span class="keyword">if</span>(indegree[graph[temp][i]]==<span class="number">0</span>)&#123;</span><br><span class="line">                    q.push(graph[temp][i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cnt==numCourses;<span class="comment">//å¦‚æœä¸æœ€åˆçš„èŠ‚ç‚¹æ•°ç›¸åŒï¼Œè¯´æ˜æ— ç¯ï¼Œå¦‚æœä¸ç›¸åŒï¼Œè¯´æ˜æœ‰ç¯ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="è¯¾ç¨‹è¡¨2"><a href="#è¯¾ç¨‹è¡¨2" class="headerlink" title="è¯¾ç¨‹è¡¨2"></a>è¯¾ç¨‹è¡¨2</h2><p>ç°åœ¨ä½ æ€»å…±æœ‰ n é—¨è¯¾éœ€è¦é€‰ï¼Œè®°ä¸º 0 åˆ° n-1ã€‚</p><p>åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬: [0,1]</p><p>ç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¿”å›ä½ ä¸ºäº†å­¦å®Œæ‰€æœ‰è¯¾ç¨‹æ‰€å®‰æ’çš„å­¦ä¹ é¡ºåºã€‚</p><p>å¯èƒ½ä¼šæœ‰å¤šä¸ªæ­£ç¡®çš„é¡ºåºï¼Œä½ åªè¦è¿”å›ä¸€ç§å°±å¯ä»¥äº†ã€‚å¦‚æœä¸å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼Œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚</p><p>ç¤ºä¾‹ 1:</p><p>â€‹    è¾“å…¥: 2, [[1,0]]<br>â€‹    è¾“å‡º: [0,1]<br>â€‹    è§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 1ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºä¸º [0,1] ã€‚<br>ç¤ºä¾‹ 2:</p><p>â€‹    è¾“å…¥: 4, [[1,0],[2,0],[3,1],[3,2]]<br>â€‹    è¾“å‡º: [0,1,2,3] or [0,2,1,3]<br>â€‹    è§£é‡Š: æ€»å…±æœ‰ 4 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 3ï¼Œä½ åº”è¯¥å…ˆå®Œæˆè¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2ã€‚å¹¶ä¸”è¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2 éƒ½åº”è¯¥æ’åœ¨è¯¾ç¨‹ 0 ä¹‹åã€‚<br>â€‹    å› æ­¤ï¼Œä¸€ä¸ªæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºæ˜¯ [0,1,2,3] ã€‚å¦ä¸€ä¸ªæ­£ç¡®çš„æ’åºæ˜¯ [0,2,1,3] ã€‚<br>è¯´æ˜:</p><p>è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”±è¾¹ç¼˜åˆ—è¡¨è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯é‚»æ¥çŸ©é˜µã€‚è¯¦æƒ…è¯·å‚è§å›¾çš„è¡¨ç¤ºæ³•ã€‚<br>ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">findOrder</span><span class="params">(<span class="keyword">int</span> numCourses, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; prerequisites)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(numCourses==<span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">indegree</span><span class="params">(numCourses,<span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; <span class="title">graph</span><span class="params">(numCourses,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;())</span></span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;prerequisites.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            graph[prerequisites[i][<span class="number">1</span>]].push_back(prerequisites[i][<span class="number">0</span>]);</span><br><span class="line">            indegree[prerequisites[i][<span class="number">0</span>]]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;indegree.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(indegree[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                q.push(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(q.empty()==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> temp=q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            cnt++;</span><br><span class="line">            ans.push_back(temp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;graph[temp].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                indegree[graph[temp][i]]--;</span><br><span class="line">                <span class="keyword">if</span>(indegree[graph[temp][i]]==<span class="number">0</span>)&#123;</span><br><span class="line">                    q.push(graph[temp][i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(cnt==numCourses) <span class="keyword">return</span> ans; <span class="comment">//è¦åšä¸€ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­è¾“å‡ºçš„èŠ‚ç‚¹æ•°ä¸æœ€å¼€å§‹çš„èŠ‚ç‚¹æ•°æ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™è¾“å‡ºï¼Œä¸ç›¸åŒè¯´æ˜æœ‰ç¯ï¼Œåˆ™ä¸è¾“å‡ºã€‚</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>overï½â˜•ï¸</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ‹“æ‰‘æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|é¢„è®­ç»ƒæ¨¡å‹-SentenceBERT</title>
      <link href="2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/"/>
      <url>2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹SBERTæ¨¡å‹ï¼Œå…¶å®è¿™ä¸ªæ¨¡å‹æ€è·¯å¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å°†InferSentä¸­çš„BILSTMæ¢æˆäº†BERTã€‚ä½†æ˜¯å‘¢ï¼Œè¿™ç¯‡æ–‡ç« å¯¹sentence embeddingåšäº†è¾ƒä¸ºè¯¦ç»†çš„ä»‹ç»ï¼Œè¯»å®Œä¹‹åï¼Œå¯¹sentence embeddingæœ‰äº†è¾ƒä¸ºè¯¦ç»†çš„äº†è§£ï¼Œæ‰€ä»¥ï¼Œè®°å½•ä¸€ä¸‹ï½</p><a id="more"></a><h2 id="Sentence-BERTæ¨¡å‹"><a href="#Sentence-BERTæ¨¡å‹" class="headerlink" title="Sentence-BERTæ¨¡å‹"></a>Sentence-BERTæ¨¡å‹</h2><p>BERTæ¨¡å‹åœ¨å„ç§NLUä»»åŠ¡ä¸­åŸºæœ¬ä¸Šæ˜¯éƒ½è¿œè¶…ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä½†æ˜¯ä»ç„¶æœ‰ä¸è¶³ã€‚è­¬å¦‚åœ¨æ–‡æœ¬åŒ¹é…(oræ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—)ä»»åŠ¡ä¸­ï¼ŒBERTçš„åšæ³•æ˜¯ï¼šå°†ä¸¤ä¸ªå¥å­ç”¨[SEP]tokenè¿æ¥èµ·æ¥ä½œä¸ºä¸€ä¸ªå¥å­ï¼Œå†è¾“å…¥åˆ°BERTä¸­ã€‚ä½†æ˜¯è¿™ä¹ˆåšçš„ç¼ºç‚¹æ˜¯ï¼šå½“æˆ‘ä»¬çš„æ•°æ®é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œè®ºæ–‡è¯´çš„æ˜¯ä»10000ä¸ªå¥å­ä¸­æ‰¾åˆ°ä¸ç›®æ ‡å¥å­æœ€ä¸ºç›¸ä¼¼çš„å¥å­ï¼ŒèŠ±è´¹çš„æ—¶é—´ä¸º65å°æ—¶ï¼Œè¿™æ˜¾ç„¶æ˜¯éå¸¸ä½æ•ˆçš„ã€‚å¦å¤–ï¼Œä¹Ÿæœ‰ç ”ç©¶äººå‘˜å°†å•ä¸ªå¥å­è¾“å…¥åˆ°BERTå½“ä¸­ï¼Œå¯¹æœ€åä¸€ä¸ªtransformer layerè¿›è¡Œå¹³å‡æˆ–è€…åªä½¿ç”¨[CLS]tokençš„å¼ é‡ï¼Œä½†æ˜¯æ•ˆæœè¿˜ä¸å¦‚GloVe embeddingã€‚äºæ˜¯ï¼Œä¸ºäº†é™ä½æ–‡æœ¬åŒ¹é…çš„è®¡ç®—é‡ä¸æ—¶é—´ï¼Œå¹¶å¾—åˆ°å¥½çš„sentence embeddingï¼Œå°±æœ‰äº†Sentence-BERTæ¨¡å‹ã€‚</p><h3 id="Sentence-BERTæ¨¡å‹æ¶æ„"><a href="#Sentence-BERTæ¨¡å‹æ¶æ„" class="headerlink" title="Sentence-BERTæ¨¡å‹æ¶æ„"></a>Sentence-BERTæ¨¡å‹æ¶æ„</h3><p>æ ¹æ®ä¸åŒçš„æ•°æ®ç»„ç»‡å½¢å¼ï¼ŒSBERTæœ‰ç€ä¸åŒçš„ç»“æ„ã€‚åœ¨è®ºæ–‡å½“ä¸­ï¼Œæå‡ºäº†ä¸‰ç§æƒ…å†µä¸‹çš„æ¨¡å‹ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>å½“è¾“å…¥æ•°æ®æ˜¯[sentence1,sentence2,label]ï¼Œlabelæ˜¯ç¦»æ•£çš„ï¼Œ(å¯¹åº”çš„ä»»åŠ¡æœ‰NLI/RTE)ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/lisan.jpg" alt></p><p>è¿™ä¸ªç»“æ„å®Œå…¨å€Ÿé‰´äºInferSentæ¨¡å‹ï¼Œåªä¸è¿‡æ˜¯å°†BILSTMéƒ¨åˆ†ç”¨BERTæ¥è¿›è¡Œæ›¿æ¢ï¼Œæ³¨æ„ï¼šä¸¤ä¸ªå¥å­ä½¿ç”¨çš„BERTéƒ¨åˆ†å…±äº«æƒé‡ã€‚å¯¹äºBERTéƒ¨åˆ†è¾“å‡ºçš„ç»“æœï¼Œè®ºæ–‡ä¸­æ¢ç©¶äº†ä¸åŒçš„poolingç­–ç•¥ï¼šåªä½¿ç”¨[CLS]tokenå¯¹åº”çš„å¼ é‡ã€ä½¿ç”¨Global max poolingã€ä½¿ç”¨Global avg poolingã€‚(æœ€ç»ˆæ˜¯avg poolingç­–ç•¥æˆ–è€…åªä½¿ç”¨[CLS]tokenå¯¹åº”çš„å¼ é‡æœ€å¥½ï¼Œè¿™ä¸InferSentä¸­æ‰€å¾—å‡ºçš„ç»“è®ºæ˜¯ä¸ä¸€æ ·çš„ï¼ŒInferSentä¸­ä½¿ç”¨max poolingæœ€å¥½)ã€‚å¾—åˆ°$u$ å’Œ$v$è¿™ä¸¤ä¸ªå¥å‘é‡ä¹‹åï¼Œç„¶åå†è¿›è¡Œæ‹¼æ¥ï¼Œåœ¨è¿™é‡Œï¼Œå»æ‰äº†$u*v$è¿™ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®éªŒè¡¨æ˜ï¼ŒåŠ äº†è¿™ä¸€éƒ¨åˆ†ï¼Œæ•ˆæœåè€Œä¸‹é™äº†ã€‚æœ€åå°†æ‹¼æ¥åçš„ç»“æœè¾“å…¥åˆ°softmaxä¸­è¿›è¡Œåˆ†ç±»å³å¯ã€‚loss functioné‡‡ç”¨äº¤å‰ç†µã€‚æ•°æ®é‡‡ç”¨SNLIå’ŒMultiNLIè¿›è¡Œfine-tuneï¼Œpre-trainç›´æ¥é‡‡ç”¨ä½¿ç”¨wikipediaé¢„è®­ç»ƒå¾—åˆ°çš„æƒé‡å³å¯ã€‚</p><blockquote><p>ä¼˜åŒ–å™¨é‡‡ç”¨Adamï¼Œ16 batch sizeï¼Œwarm up 16%ï¼Œpoolingç­–ç•¥æ˜¯avgã€‚</p></blockquote><ul><li>å½“è¾“å…¥æ•°æ®æ˜¯[sentence1,sentence2,label]ï¼Œlabelæ˜¯è¿ç»­çš„ï¼Œ(å¯¹åº”çš„ä»»åŠ¡æœ‰STS(è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—))ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/lianxu.jpg" alt></p><p>æ•´ä½“ç»“æ„ä¸ç¬¬ä¸€ç§ç›¸åŒï¼Œä¸åŒçš„åœ°æ–¹æ˜¯ï¼šåœ¨å¾—åˆ°å„è‡ªçš„å¥å‘é‡ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æ¥è¿›è¡Œåº¦é‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„è­¬å¦‚çš®å°”æ£®ç›¸å…³ç³»æ•°ã€‚loss functioné‡‡ç”¨MSEã€‚æ³¨æ„ï¼šè®ºæ–‡é‡Œè¯´æ²¡æœ‰ä»»ä½•ä¸STSç›¸å…³çš„æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨ç¬¬ä¸€ç§æ¶æ„è¿›è¡Œfine-tuneä¹‹åï¼Œæˆ‘ä»¬å°†æ‹¼æ¥ä¸softmaxç»™æ‹¿æ‰ï¼Œæ¢æˆcosine similarityå°±å¯ä»¥äº†ã€‚</p><ul><li>å½“è¾“å…¥æ•°æ®æ˜¯[queryï¼Œpositive_answerï¼Œnegative_answer],ï¼ˆå¯¹åº”çš„ä»»åŠ¡æœ‰é—®ç­”åŒ¹é…)ï¼Œå…·ä½“ç»“æ„ä¸ç¬¬ä¸€ç§ç»“æ„ç›¸åŒï¼Œä½†æ˜¯é‡‡ç”¨çš„loss functionä¸ºtriplet lossï¼Œå…¬å¼å¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">loss=max(||s_a-s_p||-||s_a,s_n||+\epsilon,0)</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›queryä¸positive answerçš„è·ç¦»æ¯”queryä¸negative answerçš„è·ç¦»è¦å°è‡³å°‘$\epsilon$ã€‚è¿™æ ·çš„è¯ï¼Œè­¬å¦‚åœ¨é—®ç­”åŒ¹é…é‡Œé¢ï¼Œæˆ‘ä»¬æœ€åå°±ä¼šæ›´åŠ å€¾å‘äºå¬å›æ­£ç¡®çš„å›ç­”ï¼Œè€Œä¸æ˜¯é”™è¯¯çš„å›ç­”ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œè¡¡é‡queryå¥å‘é‡ä¸ç­”æ¡ˆå¥å‘é‡ä¹‹é—´çš„è·ç¦»é‡‡ç”¨çš„æ˜¯æ¬§å‡ é‡Œå¾—è·ç¦»ï¼Œ$\epsilon=1$ã€‚</p><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="/2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/result1.jpg" alt></p><p><img src="/2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/result2.jpg" style="zoom:50%;"></p><p><img src="/2020/08/04/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B-SentenceBERT/result3.jpg" style="zoom:50%;"></p><p>ä»ç»“æœæ¥çœ‹ï¼Œç¡®å®è¦æ¯”æ™®é€šçš„InferSentæˆ–è€…USEè¦å¥½ã€‚å¦å¤–ï¼Œæˆ‘è§‰å¾—è¿™ç¯‡è®ºæ–‡æ›´å¤§çš„æ„ä¹‰åœ¨äºå®é™…åº”ç”¨å§ï¼Œæ•´ä½“æ²¡æœ‰å¤ªå¤§çš„åˆ›æ–°ã€‚</p><h2 id="Universal-Sentence-Encoderæ¨¡å‹"><a href="#Universal-Sentence-Encoderæ¨¡å‹" class="headerlink" title="Universal Sentence Encoderæ¨¡å‹"></a>Universal Sentence Encoderæ¨¡å‹</h2><p>æ‰“ç®—å†æ¥çœ‹ä¸€ä¸‹sentence embeddingçš„éƒ¨åˆ†å§ï¼Œå› ä¸ºä¹‹å‰è¢«é—®åˆ°äº†ï¼Œæˆ‘å´åªç­”ä¸Šäº†InferSentä»¥åŠä¸€äº›æ™®é€šçš„æ–¹æ¡ˆã€‚ã€‚ã€‚æƒ­æ„§å•Šã€‚å…¶å®é™¤äº†InferSentä¹‹å¤–ï¼ŒUSEä¹Ÿæ˜¯éå¸¸è‘—åçš„ä¸€ä¸ªæ¨¡å‹ï¼Œä¸‹é¢å…·ä½“è®²è§£ä¸€ä¸‹ï½å¤§è‡´æ¥è¯´ï¼Œå°±æ˜¯USEæœ‰ä¸¤ä¸ªencoderï¼šä¸€ä¸ªæ˜¯transformerï¼Œä¸€ä¸ªæ˜¯DANï¼Œå‰è€…å‡†ç¡®ç‡é«˜ä½†æ˜¯è®¡ç®—ä»£ä»·å¤§ï¼Œåè€…å‡†ç¡®ç‡ç•¥æœ‰ä¸‹é™ä½†æ˜¯è®¡ç®—ä»£ä»·å°ï¼Œä¸¤è€…éƒ½åœ¨å¤šä¸ªæ•°æ®ä¸Šè¿›è¡Œè¿ç§»å­¦ä¹ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Sentence-BERT </tag>
            
            <tag> é¢„è®­ç»ƒæ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|è·¨è¯­è¨€é¢„è®­ç»ƒæ¨¡å‹</title>
      <link href="2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ¥æ€»ç»“ä¸€ä¸‹ç›®å‰åœ¨è·¨è¯­è¨€é¢„è®­ç»ƒæ¨¡å‹æ–¹é¢çš„å·¥ä½œï¼Œå½“ç„¶å•¦ï¼Œä»Šå¹´ACLæœ‰å¾ˆå¤šæ”¹è¿›çš„å·¥ä½œï¼Œä¹‹åä¼šå†å†™ä¸€ç¯‡ã€‚è¿™ç¯‡ä¸»è¦è®²è§£çš„æ¨¡å‹æ˜¯ï¼šMultingual-BERTã€XLMã€XLM-Rã€MASSã€MultiFiTã€‚</p><a id="more"></a><h2 id="Multilingual-BERT-m-BERT"><a href="#Multilingual-BERT-m-BERT" class="headerlink" title="Multilingual-BERT(m-BERT)"></a>Multilingual-BERT(m-BERT)</h2><h3 id="æå‡ºèƒŒæ™¯"><a href="#æå‡ºèƒŒæ™¯" class="headerlink" title="æå‡ºèƒŒæ™¯"></a>æå‡ºèƒŒæ™¯</h3><p>m-BERTæ¥æºäºã€ŠHow multilingual is Multilingual BERT?ã€‹è®ºæ–‡ã€‚ä¸»è¦æ˜¯æƒ³æ¢ç´¢ï¼šå¤šè¯­è¨€BERTåˆ°åº•å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿä»¥åŠå¤šè¯­è¨€BERTåœ¨é›¶æ ·æœ¬è¿ç§»å­¦ä¹ ä¸Šçš„è¡¨ç°å¦‚ä½•ï¼Ÿä¸»è¦æ€è·¯æ˜¯å°†m-BERTåœ¨å¤šè¯­è¨€ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªè¯­è¨€è¿›è¡Œfine-tuneï¼Œå¹¶åœ¨å¦ä¸€ç§è¯­è¨€ä¸Šè¿›è¡Œè¯„ä¼°ï¼Œfine-tune+evalåœ¨NERä¸POSä¸¤ä¸ªä»»åŠ¡è¿›è¡Œäº†å®éªŒï¼Œæœ€åå¹¶åšäº†ä¸€äº›probingå®éªŒæ¥æ¢ç©¶m-BERTçš„è·¨è¯­è¨€è¿ç§»å­¦ä¹ æ•ˆæœä»¥åŠå…¶è¡¨å¾èƒ½åŠ›ã€‚</p><h3 id="å®éªŒæ€è·¯"><a href="#å®éªŒæ€è·¯" class="headerlink" title="å®éªŒæ€è·¯"></a>å®éªŒæ€è·¯</h3><p>m-BERTä»ç„¶æ˜¯ç”±12å±‚çš„transformer layerç»„æˆï¼Œä½†æ˜¯å®ƒçš„è®­ç»ƒè¯­æ–™æ˜¯104ç§è¯­è¨€çš„ç»´åŸºç™¾ç§‘é¡µé¢æ•°æ®ï¼Œå¹¶ä¸”æ‰€æœ‰è¯­è¨€å…±äº«ä¸€ä¸ªè¯æ±‡è¡¨ã€‚æ³¨æ„ï¼šå¤šè¯­è¨€BERTåœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œæ—¢æ²¡æœ‰ä½¿ç”¨ä»»ä½•è¾“å…¥æ•°æ®çš„è¯­è¨€æ ‡æ³¨ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ä»»ä½•ç¿»è¯‘æœºåˆ¶æ¥è®¡ç®—å¯¹åº”è¯­è¨€çš„è¡¨ç¤ºã€‚æœ€åä½œè€…æ˜¯åœ¨NERä¸POSä¸¤ä¸ªä»»åŠ¡ä¸Šè¿›è¡Œå®éªŒï¼Œè¿™ä¸¤ä¸ªä»»åŠ¡éƒ½æ˜¯å…ˆåœ¨ä¸€ç§è¯­è¨€ä¸Šè¿›è¡Œå¾®è°ƒï¼Œç„¶ååœ¨å¦ä¸€ç§è¯­è¨€ä¸Šè¿›è¡Œè¯„ä¼°ï¼Œä»è€Œæ¥æ¢ç©¶m-BERTåœ¨è·¨è¯­è¨€è¿ç§»å­¦ä¹ ä¸Šçš„æ•ˆæœã€‚å…·ä½“ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/m-BERT result1.jpg" alt></p><p>ä»ç»“æœä¸Šæ¥çœ‹ï¼Œfine-tuneä¸evalé˜¶æ®µæ‰€ä½¿ç”¨çš„è¯­è¨€è¶Šç›¸ä¼¼ï¼Œæ•ˆæœè¶Šå¥½ï¼›ç»“æœæœ€å¥½çš„æƒ…å†µæ˜¯fine-tuneä¸evalä½¿ç”¨åŒä¸€ç§è¯­è¨€ã€‚</p><p>é™¤äº†ä¸Šè¿°å®éªŒå¤–ï¼Œä½œè€…è¿˜æ¢ç©¶äº†lexical overlapå¯¹ç»“æœçš„å½±å“ã€‚æ‰€è°“çš„lexical overlapï¼ŒæŒ‡çš„æ˜¯ï¼šç”±äºåœ¨m-BERTå½“ä¸­ï¼Œæ‰€æœ‰è¯­è¨€å…±äº«ä¸€ä¸ªè¯æ±‡è¡¨ï¼Œå½“fine-tuneé˜¶æ®µå‡ºç°äº†è¯„ä¼°é˜¶æ®µæ‰€ä½¿ç”¨çš„è¯­è¨€çš„å•è¯åï¼Œå°±ä¼šäº§ç”Ÿä¸€ç§è·¨è¯­è¨€çš„è¿ç§»ã€‚ä½œè€…è®¾è®¡äº†ä¸€äº›å®éªŒæ¥æ¢ç©¶äº†è·¨è¯­è¨€è¿ç§»å­¦ä¹ çš„æ•ˆæœæ˜¯æœ‰å¤šå¤§ç¨‹åº¦ä¾èµ–äºè¿™ä¸ªlexical overlapï¼›ä»¥åŠå½“æ²¡æœ‰è¿™ç§lexical overlapçš„æ—¶å€™ï¼Œè·¨è¯­è¨€è¿ç§»å­¦ä¹ çš„æ•ˆæœã€‚</p><p>åœ¨NERä»»åŠ¡ä¸­ï¼Œä¸ºäº†æµ‹é‡lexical overlapçš„å½±å“ï¼Œå®šä¹‰äº†$E_{train}$ä¸$E_{eval}$æ¥åˆ†åˆ«è¡¨ç¤ºè®­ç»ƒé›†ä¸æµ‹è¯•é›†ä¸Šçš„å®ä½“çš„é›†åˆï¼Œè®¡ç®—overlapçš„å…¬å¼æ˜¯ï¼š</p><script type="math/tex; mode=display">overlap=|E_{train}\bigcap E_{eval}|/|E_{train}\bigcup E_{eval}|</script><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/overlap.jpg" style="zoom:67%;"></p><p>ä»ä¸Šè¿°ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè‹±æ–‡BERTçš„æ•ˆæœéå¸¸ä¾èµ–äºoverlapï¼Œè¿ç§»å­¦ä¹ çš„æ•ˆæœä¼šéšç€overlapçš„ä¸‹é™è€Œä¸‹é™ï¼›è€Œå¯¹äºå¤šè¯­è¨€BERTè€Œè¨€ï¼Œoverlapå¯¹äºå…¶æ•ˆæœçš„å½±å“å¹¶ä¸å¤§ï¼Œè¯´æ˜å¤šè¯­è¨€BERTåœ¨ä¸åŒçš„æ–‡æœ¬ä¸Šå…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚</p><p>å¦å¤–ï¼Œä½œè€…è¿˜åšäº†ä¸€äº›å®éªŒæ¥æ¢ç©¶å¤šè¯­è¨€BERTåœ¨å¤šè¯­è¨€æ–‡æœ¬æ··åˆï¼ˆCode-switchingï¼‰å’ŒéŸ³è¯‘ï¼ˆtransliterationï¼‰çš„æƒ…å†µä¸‹è¡¨å¾èƒ½åŠ›ã€‚å…·ä½“æ¥è¯´ï¼Œä½œè€…è¿›ä¸€æ­¥åœ¨UDè¯­æ–™åº“ä¸Šæµ‹è¯•äº†å°åœ°è¯­ï¼ˆHIï¼‰å’Œè‹±è¯­ï¼ˆENï¼‰ã€‚å¤šè¯­è¨€æ–‡æœ¬æ··åˆæ˜¯æŒ‡ä¸€ä¸ªè¡¨è¾¾é‡Œé¢å‚æ‚å¤šç§è¯­è¨€ï¼Œè€ŒéŸ³è¯‘åˆ™æŒ‡å°†å‘éŸ³ç›¸ä¼¼çš„å¤–æ¥è¯è¯­ç›´æ¥é€šè¿‡è¯»éŸ³ç¿»è¯‘è¿‡æ¥ï¼Œæ¯”å¦‚é…· ï¼ˆcoolï¼‰å’Œè¿ªæ–¯ç§‘ï¼ˆdiscoï¼‰ç­‰ã€‚</p><h2 id="XLM"><a href="#XLM" class="headerlink" title="XLM"></a>XLM</h2><h3 id="æå‡ºèƒŒæ™¯-1"><a href="#æå‡ºèƒŒæ™¯-1" class="headerlink" title="æå‡ºèƒŒæ™¯"></a>æå‡ºèƒŒæ™¯</h3><p>æ¨¡å‹æ¥æºäºã€ŠCross-lingual Language Model Pretrainingã€‹è®ºæ–‡ã€‚å®ƒçš„æå‡ºèƒŒæ™¯æ˜¯ï¼šå‘BERTã€XLNetç­‰æ¨¡å‹éƒ½æ˜¯åœ¨å•ä¸€è¯­è¨€ä¸Šè¿›è¡Œé¢„è®­ç»ƒå’Œfine-tuneï¼Œæ¢ä¸€ç§è¯­è¨€å°±éœ€è¦é‡æ–°è¿›è¡Œé¢„è®­ç»ƒ+fine-tuneï¼Œé‚£èƒ½ä¸èƒ½ä½¿ç”¨å¤šç§è¯­è¨€åŒæ—¶è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œä¹‹åé€šè¿‡ä¸€ä¸ªæ¨¡å‹å°±å¯ä»¥åœ¨å¤šä¸ªè¯­è¨€ä¸Šè¿›è¡Œä¸‹æ¸¸çš„ä»»åŠ¡å‘¢ï¼Ÿè¿™å°±æ˜¯XLMæ¨¡å‹ã€‚å…·ä½“åšæ³•æ˜¯ï¼šæå‡ºäº†åªä½¿ç”¨å•ç§è¯­è¨€çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ä¸ä½¿ç”¨è·¨è¯­è¨€çš„å¹³è¡Œè¯­æ–™çš„æœ‰ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œä»è€Œåœ¨è·¨è¯­è¨€åˆ†ç±»ã€ç›‘ç£ç¿»è¯‘ä¸æ— ç›‘ç£ç¿»è¯‘ä¸­å–å¾—äº†SOTAçš„æ•ˆæœã€‚</p><h3 id="å®éªŒæ€è·¯-1"><a href="#å®éªŒæ€è·¯-1" class="headerlink" title="å®éªŒæ€è·¯"></a>å®éªŒæ€è·¯</h3><p>ä½œè€…ä¸»è¦æå‡ºäº†ä¸‰ç§loss fucntionï¼šCLMã€MLMã€TLMã€‚</p><ul><li>CLMï¼šæ— ç›‘ç£å•è¯­å•å‘LMè®­ç»ƒä»»åŠ¡ï¼Œä½¿ç”¨Transformeråœ¨ç»™å®šå‰åºè¯è¯­çš„æƒ…å†µä¸‹é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„æ¦‚ç‡ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªtransformerè¯­è¨€æ¨¡å‹ã€‚</li><li>MLMï¼šæ— ç›‘ç£å•è¯­åŒå‘LMè®­ç»ƒä»»åŠ¡ï¼Œè¿™ä¸ªä¸BERTçš„MLMåŸºæœ¬ä¸Šä¸€æ ·çš„ï¼Œ ä¸åŒçš„åœ°æ–¹åœ¨äºï¼šBERTä¸­ï¼Œè¾“å…¥çš„æ˜¯å¥å­å¯¹ï¼Œå¹¶ä¸”æˆ‘ä»¬æ˜¯å»éšæœºMASKæ‰15%çš„tokenï¼Œä½¿ç”¨çš„æ—¶å€™ï¼Œ80%ä½¿ç”¨ [MASK] token æ›¿æ¢ï¼Œ10%ç”¨éšæœº token æ›¿æ¢ï¼Œæœ€å10%ä¸å˜ï¼›è€Œåœ¨XLMä¸­ï¼Œä½¿ç”¨çš„æ˜¯ç”±ä»»æ„æ•°é‡çš„å¥å­ç»„æˆçš„æ–‡æœ¬æµä»£æ›¿æˆå¯¹çš„å¥å­(æœ€é•¿ä¸º256ä¸ªtoken)ã€‚ä¸ºäº†å‡è¡¡ç¨€æœ‰tokenså’Œé«˜é¢‘tokensï¼Œå€Ÿé‰´æ¥word2vecä¸­å¯¹é«˜é¢‘è¯é‡‡æ ·çš„æ–¹æ³•ï¼šæ–‡æœ¬æµä¸­çš„tokensæ˜¯ä»¥å¤šé¡¹å¼åˆ†å¸ƒè¿›è¡Œé‡‡æ ·çš„ï¼Œå¹¶ä¸”å…¶æƒé‡ä¸å®ƒä»¬çš„é€†æ–‡æœ¬é¢‘ç‡çš„å¹³æ–¹æ ¹æˆæ­£æ¯”ã€‚å¦å¤–ï¼Œå»æ‰äº†segment embeddingï¼Œä»è€Œæ¢ç”¨äº†language embeddingã€‚</li><li>TLMï¼šæœ‰ç›‘ç£ç¿»è¯‘LMè®­ç»ƒä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡ä¸»è¦æ˜¯ä¸ºè·¨è¯­è¨€ä»»åŠ¡æ‰€å‡†å¤‡çš„ã€‚TLMæ˜¯å¯¹MLMçš„ä¸€ç§æ‰©å±•ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†å¹¶è¡Œçš„ç¿»è¯‘å¥å­æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶åå¯¹ä¸¤ä¸ªå¥å­è¿›è¡Œmaskæ“ä½œã€‚è­¬å¦‚æˆ‘ä»¬è¦åšç¿»è¯‘çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡TLMï¼Œå°±å¯ä»¥å¼•å¯¼sourceä¸targetå¥å­çš„è¡¨å¾è¿›è¡Œå¯¹é½ã€‚å¦å¤–ï¼Œè¿™é‡Œä¹Ÿæ˜¯å»æ‰äº†segment embeddingï¼Œæ¢ç”¨äº†language embeddingã€‚</li></ul><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/XLM.jpg" alt></p><p>ç„¶åæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨CLMæˆ–è€…MLMæ¥è¿›è¡Œå•è¯­è¨€çš„é¢„è®­ç»ƒï¼Œç„¶åæ ¹æ®ä¸‹æ¸¸ä»»åŠ¡æ¥å†³å®šæ˜¯å¦è¦åŠ TLMã€‚è®ºæ–‡é‡Œä¸»è¦æ˜¯åœ¨è·¨è¯­è¨€åˆ†ç±»(XNLIæ•°æ®é›†)ã€æœ‰ç›‘ç£ç¿»è¯‘ä¸æ— ç›‘ç£ç¿»è¯‘ä»»åŠ¡ä¸Šè¿›è¡Œå®éªŒã€‚ç»“æœå¦‚ä¸‹ï¼š</p><p><strong>XNLI</strong></p><p>ä½œè€…æ˜¯å…ˆç”¨MLMåœ¨å„ä¸ªè¯­è¨€çš„å•è¯­è¯­æ–™ä¸Šè¿›è¡Œè®­ç»ƒï¼Œç„¶åå†ç”¨è‹±æ–‡è®­ç»ƒé›†è¿›è¡Œfinetuneï¼Œæœ€ååœ¨å¤šä¸ªè¯­ç§ä¸Šè¯„ä¼°ã€‚ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/XLM result1.jpg" alt></p><p><strong>æ— ç›‘ç£æœºç¿»</strong></p><p>ä¸€èˆ¬çš„å¥—è·¯æ˜¯ï¼šDAE+back translationã€‚DAEæŒ‡çš„æ˜¯ï¼šè­¬å¦‚æˆ‘ä»¬è¦è¿›è¡Œè‹±è¯‘ä¸­è¿™æ ·ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªencoder-decoderæ¡†æ¶ï¼Œå°†è‹±æ–‡æ•°æ®+å™ªå£°è¾“å…¥åˆ°encoderä¸­ï¼Œç„¶ådecoderå‡ºåŸå§‹çš„è‹±æ–‡æ•°æ®ï¼Œä¸­æ–‡ä¹Ÿå¯ä»¥è¿™æ ·åšï¼›back translationæŒ‡çš„æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥å°†è‹±æ–‡é€šè¿‡encoder-decoderï¼Œå¾—ç¿»è¯‘çš„ä¸­æ–‡ï¼Œç„¶åå°†ç¿»è¯‘åçš„ä¸­æ–‡+å™ªå£°å†é€šè¿‡encoder-decoderï¼Œè¿˜åŸæˆåŸå§‹çš„è‹±æ–‡ã€‚åœ¨XLMä¸­ï¼Œä½¿ç”¨CLM/MLMæ¥åˆå§‹åŒ–encoderä¸decoderéƒ¨åˆ†ï¼Œç„¶åæŒ‰ç…§DAE+back translationçš„æ¡†æ¶æ¥è®­ç»ƒå³å¯ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/UMT.jpg" style="zoom:50%;"></p><p><strong>æœ‰ç›‘ç£æœºç¿»</strong></p><p>è¿™ä¸ªå°±æ˜¯æ™®é€šçš„ç¿»è¯‘ï¼Œæ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/MT.jpg" style="zoom:50%;"></p><p>è®ºæ–‡å¦å¤–è¿˜æ¢ç©¶æ¥æ¨¡å‹åœ¨low-resource languageä¸Šçš„ç»“æœä»¥åŠæ— ç›‘ç£å¤šè¯­è¨€æƒ…å†µä¸‹ç”Ÿæˆçš„embeddingçš„æƒ…å†µã€‚</p><h2 id="XLM-R"><a href="#XLM-R" class="headerlink" title="XLM-R"></a>XLM-R</h2><p>XLM-Ræ¥æºäºã€ŠUnsupervised Cross-lingual Representation Learning at Scaleã€‹è®ºæ–‡ï¼Œæ˜¯å¯¹XLMæ¨¡å‹çš„æ‹“å±•ï¼Œä¸»è¦æ˜¯å€Ÿé‰´äº†RoBERTaæ¨¡å‹çš„å¥—è·¯(å¤§åŠ›å‡ºå¥‡è¿¹ï¼Ÿ)ã€‚å…·ä½“è€Œè¨€å°±æ˜¯ï¼ŒXLM-Ræ¨¡å‹åœ¨100ç§è¯­è¨€ä¸Šä½¿ç”¨è¶…è¿‡2.5Tçš„æ•°æ®è¿›è¡Œè®­ç»ƒã€‚ç›¸å¯¹äºXLMï¼ŒXLM-Rä½¿ç”¨äº†è¿‡æ»¤åçš„CommonCrawlæ•°æ®é›†ï¼Œæœ€ç»ˆXLM-Råœ¨XNLIã€MLQAã€multilingual-NERè¿™äº›å¤šè¯­è¨€ä»»åŠ¡ä¸Šå‡å–å¾—äº†æœ€å¥½çš„å®éªŒæ•ˆæœã€‚ä¸»è¦çš„æ”¹è¿›æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>åœ¨æ¨¡å‹éƒ¨åˆ†ï¼Œæ•´ä½“ä¸XLMåŸºæœ¬ä¸€æ ·ï¼Œä¸XLMæ¨¡å‹ä¸åŒçš„åœ°æ–¹åœ¨äºï¼šå»æ‰äº†language embeddingï¼›</li><li>XLM-Ræ‰©å±•åˆ°100ç§è¯­è¨€ï¼Œä¸XLM-100ä¸åŒçš„åœ¨äºï¼šåœ¨æ¶ˆèåˆ†æä¸­ä½¿ç”¨äº†ä¸ƒç§ä¸åŒçš„è¯­è¨€ï¼šè‹±è¯­ã€æ³•è¯­ã€å¾·è¯­ã€ä¿„è¯­ã€ä¸­æ–‡ã€æ–¯ç“¦å¸Œé‡Œè¯­ã€ä¹Œå°”å¤šè¯­ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥å°†high-resource languageä¸low-resource languageéƒ½åŒ…å«è¿›æ¥ï¼Œå¯ä»¥æ¯”è¾ƒæ­£ç¡®çš„è¯„ä»·æ¨¡å‹ã€‚</li><li>ä½¿ç”¨æ›´å¤šçš„æ•°æ®ï¼Œè¿™ä¸RoBERTaç±»ä¼¼ï¼Œæ›´å¤šçš„æ•°æ®èƒ½å¤Ÿæå‡æœ€ç»ˆçš„æ•ˆæœã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºlow-resource languageï¼Œæˆ‘ä»¬å»å¢åŠ å®ƒçš„æ•°ç›®(ç±»ä¼¼äºä¸Šé‡‡æ ·ï¼Ÿ)ã€‚</li></ul><p>æœ€åå°±æ˜¯ä¸€äº›å®éªŒç»“æœï¼Œæ²¡ä»€ä¹ˆå¤ªå¤šå¯è¯´çš„ã€‚</p><h2 id="MASS"><a href="#MASS" class="headerlink" title="MASS"></a>MASS</h2><p>MASSæ¥æºäºã€ŠMASS: Masked Sequence to Sequence Pre-training for Language Generationã€‹è®ºæ–‡ã€‚MASSæ¨¡å‹æå‡ºçš„èƒŒæ™¯æ˜¯ï¼šç›®å‰åƒBERTè¿™æ ·çš„é¢„è®­ç»ƒæ¨¡å‹åœ¨å„ç§NLUä»»åŠ¡ä¸­è¡¨ç°çš„éƒ½å·²ç»å¾ˆå¥½äº†ï¼Œä½†æ˜¯åœ¨NLGä»»åŠ¡ä¸Šï¼Œå´ä¸€ç›´è¡¨ç°ä¸ä½³ï¼Œè€Œä¸”ç”±äºNLGä»»åŠ¡æ ‡æ³¨æ•°æ®è¾ƒå°‘ï¼Œæ‰€ä»¥æ›´åŠ éœ€è¦è¿›è¡Œpre-trainã€‚åœ¨seq2seqæ¶æ„ä¸­ï¼Œä¸€èˆ¬çš„æƒ³æ³•æ˜¯ï¼šå¯¹encoderä¸decoderéƒ½è¿›è¡Œpre-trainï¼Œä½†æ˜¯è¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±åœ¨äºï¼šè¿™æ ·è®­ç»ƒå¾—åˆ°çš„encoderä¸decoderçš„åˆ†å¸ƒæœ‰å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºå°±æ˜¯ç¡¬ç”Ÿç”Ÿåœ°å°†ä¸¤ä¸ªè¯­è¨€æ¨¡å‹æ‰åœ¨ä¸€èµ·ã€‚<strong>æ‰€ä»¥ï¼šè¦æ€ä¹ˆå¯¹encoderä¸decoderéƒ½è¿›è¡Œpre-trainï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯å®ƒä»¬çš„åˆ†å¸ƒæ˜¯ä¸€è‡´çš„å‘¢ï¼Ÿ</strong>è¿™å°±æœ‰äº†MASSã€‚</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/MASS.jpg" alt></p><p>ä¸Šé¢æ˜¯MASSçš„æ¶æ„ï¼Œå®ƒæ•´ä½“çš„è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><strong>encoder</strong>ï¼šè¾“å…¥æ˜¯è¢«éšæœºmaskæ‰ä¹‹åçš„å¥å­ï¼Œä½†æ˜¯ä¸BERTä¸åŒçš„åœ°æ–¹åœ¨äºï¼šMASSä¸­æ˜¯éšæœºmaskæ‰ä¸€æ®µè¿ç»­çš„tokenç‰‡æ®µï¼Œè€Œä¸æ˜¯éšæœºmaskï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼šè¿«ä½¿æ¨¡å‹ä»æœªè¢«maskæ‰çš„è¯ä¸­æå–æ›´å¤šçš„è¯­ä¹‰ä¿¡æ¯ï¼Œä»è€Œç”¨äºåç»­decoderéƒ¨åˆ†çš„é¢„æµ‹ã€‚åœ¨å®éªŒä¸­ï¼Œmaskçš„æœ€ä½³æ¯”ä¾‹åœ¨50%å·¦å³ã€‚</li><li><strong>decoder</strong>ï¼šè¾“å…¥æ˜¯ä¸encoderåŒæ ·çš„å¥å­ï¼Œä½†æ˜¯maskæ‰çš„æ­£å¥½å’Œencoderç›¸åï¼Œå’Œç¿»è¯‘ä¸€æ ·ï¼Œè¿«ä½¿decoderé€šè¿‡encoderæ¥å¾—åˆ°çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå¼ºåŒ–attentionéƒ¨åˆ†ï¼Œå¦å¤–ï¼Œåªé¢„æµ‹encoderéƒ¨åˆ†åˆ«maskæ‰çš„è¯ï¼Œèƒ½å¤ŸåŠ å¿«è®­ç»ƒã€‚</li></ul><p>MASSæ¨¡å‹çš„loss functionå°±æ˜¯log-ä¼¼ç„¶å‡½æ•°ï¼Œè¿™ä¸ªæ²¡å¤ªå¤šå¯è®²çš„ã€‚</p><p>å¦å¤–ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼šä½œè€…å¯¹k(maskæ‰çš„tokençš„é•¿åº¦)è¿›è¡Œäº†æ¢ç©¶ï¼Œå¹¶å°†BERTä¸GPTå½’ç»“äºMASSæ¨¡å‹çš„ç‰¹ä¾‹ã€‚å…·ä½“æ¥è¯´ï¼Œå½“kä¸º1çš„æ—¶å€™ï¼Œencoderéƒ¨åˆ†å°±åªmaskæ‰ä¸€ä¸ªtokenï¼Œdecoderéƒ¨åˆ†maskæ‰æ‰€æœ‰tokenï¼Œæ¥é¢„æµ‹encoderä¸­è¢«maskæ‰çš„tokenï¼Œä»è¿™ä¸ªè§’åº¦æ¥çœ‹çš„è¯ï¼Œencoderå°±åƒæ˜¯BERTä¸­çš„backboneï¼Œè€Œdecoderå°±åƒæ˜¯classifierï¼›å½“kç­‰äºå¥å­é•¿åº¦çš„æ—¶å€™ï¼Œencoderéƒ¨åˆ†æˆ‘ä»¬å…¨éƒ¨maskæ‰ï¼Œdecoderéƒ¨åˆ†æˆ‘ä»¬éƒ½ä¸maskï¼Œè¿™æ ·çš„è¯ï¼Œencoderéƒ¨åˆ†æ²¡æœ‰è¾“å…¥ï¼Œdecoderéƒ¨åˆ†å°±ç›¸å½“äºGPTã€‚æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/MASS-bert-GPT.jpg" alt></p><h2 id="MultiFiT"><a href="#MultiFiT" class="headerlink" title="MultiFiT"></a>MultiFiT</h2><p>MultiFiTæ¥æºäºã€ŠMultiFiT: Efï¬cient Multi-lingual Language Model Fine-tuningã€‹è®ºæ–‡ã€‚å®ƒæå‡ºçš„èƒŒæ™¯æ˜¯ï¼šç›®å‰å¤§å¤šæ•°é¢„è®­ç»ƒæ¨¡å‹éƒ½æ˜¯åœ¨high sourceè¯­è¨€ä¸Šè¿›è¡Œçš„ï¼Œè­¬å¦‚ï¼šè‹±è¯­ã€æ±‰è¯­ç­‰ç­‰ï¼Œä½†æ˜¯åœ¨é‚£äº›low sourceè¯­è¨€ä¸Šè¡¨ç°ä¸å¥½ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« å°±æå‡ºäº†ä¸€ä¸ªMultiFiTæ¨¡å‹ï¼Œèƒ½å¤Ÿåœ¨low sourceè¯­è¨€ä¸Šå–å¾—è¾ƒå¥½çš„ç»“æœã€‚</p><blockquote><p>è¿™é‡Œè¯´çš„high sourceä¸low sourceæ˜¯ä»¥æ ‡æ³¨æ•°æ®çš„å¤šå°‘æ¥åˆ¤æ–­çš„ï¼Œå¦‚æœæ ‡æ³¨æ•°æ®æ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯å®ƒæ˜¯high sourceè¯­è¨€ï¼Œå¦‚æœæ ‡æ³¨çš„æ•°æ®æ¯”è¾ƒå°‘ï¼Œç”šè‡³æ²¡æœ‰ï¼Œæˆ‘ä»¬å°±è¯´å®ƒæ˜¯low sourceè¯­è¨€ã€‚</p></blockquote><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/Multifit.jpg" style="zoom:50%;"></p><p>ä¸Šé¢æ˜¯MultifiTæ¨¡å‹çš„æ¶æ„å›¾ï¼Œæ€»å…±æ˜¯ï¼š1ä¸ªsubword embedidng layer+4ä¸ªQRNN layer+1ä¸ªaggregation layer+2ä¸ªlinear layerã€‚è¿™æ˜¯æœ‰ç›‘ç£çš„æƒ…å½¢ï¼Œå¯¹äºæ— ç›‘ç£çš„æƒ…å½¢ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ ‡æ³¨æ•°æ®ï¼Œè®ºæ–‡ä¸­ä¹Ÿæå‡ºäº†æ¡†æ¶ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/multifit-unsu.jpg" style="zoom:50%;"></p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>é¢„è®­ç»ƒï¼šé¦–å…ˆåœ¨ç›®æ ‡è¯­è¨€è¯­æ–™ä¸­è¿›è¡Œå•è¯­é¢„æ–™çš„é¢„è®­ç»ƒï¼›</li><li>fine-tuneï¼šä½¿ç”¨ç›®æ ‡è¯­è¨€çš„ä»»åŠ¡é¢„æ–™è¿›è¡Œfine-tuneï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨ä»»åŠ¡è¯­æ–™å†ä¸€æ¬¡è¿›è¡Œäº†é¢„è®­ç»ƒï¼›</li><li>ä½¿ç”¨è·¨è¯­è¨€åˆ†ç±»å™¨(å›¾ä¸­çš„æ˜¯LASER)ï¼Œæ¥å¯¹ç›®æ ‡ä»»åŠ¡è¯­æ–™è¿›è¡Œé¢„æµ‹ï¼Œå¹¶ä½¿ç”¨é¢„æµ‹æ ‡ç­¾æ¥è¿›è¡Œå•è¯­çš„è®­ç»ƒï¼Œç›¸å½“äºçŸ¥è¯†è’¸é¦ã€‚</li></ul><p><img src="/2020/07/24/NLP-%E8%B7%A8%E8%AF%AD%E8%A8%80%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/multifit-result.jpg" alt></p><p>æœ€åæ˜¯åœ¨MLDocä¸CLSæ•°æ®é›†ä¸Šè¿›è¡Œäº†å®éªŒï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯åœ¨æœ‰ç›‘ç£çš„æƒ…å½¢ä¸‹è¿˜æ˜¯æ— ç›‘ç£çš„æƒ…å½¢ä¸‹ï¼ŒMultiFiTæ¨¡å‹å–çš„ç»“æœéƒ½è¦æ¯”ä¹‹å‰çš„ç»“æœè¦å¥½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Multilingual-BERT </tag>
            
            <tag> XLM </tag>
            
            <tag> XLM-R </tag>
            
            <tag> MASS </tag>
            
            <tag> MultiFiT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|distillç³»åˆ—é¢„è®­ç»ƒæ¨¡å‹</title>
      <link href="2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰å…³äºé¢„è®­ç»ƒæ¨¡å‹çš„æ”¹è¿›å¤§æ¦‚æ˜¯ï¼šæ¨¡å‹å°å‹åŒ–(è’¸é¦ã€å‰ªæã€é‡åŒ–(æ··åˆç²¾åº¦è®­ç»ƒ)ç­‰)ã€ç½‘ç»œç»“æ„çš„æ”¹è¿›ã€å¤šä»»åŠ¡å­¦ä¹ ã€æ›´å¤§çš„æ¨¡å‹(å¢åŠ æ¨¡å‹capacityã€å¢åŠ ç®—åŠ›ç­‰)ã€è·¨è¯­è¨€é¢„è®­ç»ƒæ¨¡å‹ç­‰ç­‰ï¼Œå…·ä½“çš„å¯ä»¥çœ‹çœ‹FDUé‚±é”¡é¹è€å¸ˆå…³äºPTMsçš„surveyã€‚è¿™ä¸€ç¯‡åšå®¢ä¸»è¦ä»‹ç»distillç³»åˆ—çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä¸»è¦æ˜¯ä»‹ç»distiilBERTã€tinyBERTã€fastBERTã€‚(psï¼šæœ€è¿‘å’Œå¤§ä½¬ä»¬äº¤æµï¼Œæ·±åˆ»åœ°æ„è¯†åˆ°è‡ªå·±å¤ªèœäº†ã€‚ã€‚ã€‚å®³ï¼ŒåŠªåŠ›å§ã€‚ï¼‰</p><a id="more"></a><h2 id="distillBERTæ¨¡å‹"><a href="#distillBERTæ¨¡å‹" class="headerlink" title="distillBERTæ¨¡å‹"></a>distillBERTæ¨¡å‹</h2><p>Googleæ‰€å‘å¸ƒçš„BERTä»¥åŠåç»­å¯¹BERTè¿›è¡Œæ”¹è¿›çš„ä¸€ç³»åˆ—é¢„è®­ç»ƒæ¨¡å‹ï¼Œè™½ç„¶æ•ˆæœéå¸¸å¥½ï¼Œä½†æ˜¯åœ¨infernceçš„é€Ÿåº¦ä»ç„¶æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œæ— æ³•æ»¡è¶³ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå¤šçš„åœºæ™¯ã€‚è€Œhintonç­‰äººåœ¨2014å¹´æå‡ºçš„çŸ¥è¯†è’¸é¦æ–¹æ³•æ˜¯æå‡é€Ÿåº¦çš„æ–¹æ³•ä¹‹ä¸€ã€‚è€ŒdistillBERTæ­£æ˜¯å°†çŸ¥è¯†è’¸é¦æ–¹æ³•åº”ç”¨äºBERTæ¨¡å‹æ‰€äº§ç”Ÿçš„ä¸€ç§é¢„è®­ç»ƒæ¨¡å‹ã€‚</p><p>é¦–å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹çŸ¥è¯†è’¸é¦ï¼Œå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç½‘ç»œï¼šteacher modelä¸student modelã€‚teacher modelåŸæœ‰çš„é¢„è®­ç»ƒæ¨¡å‹(è­¬å¦‚BERT)ï¼Œé€šè¿‡teacher modelå¾—åˆ°çš„ç»“æœçš„soft labelä½œä¸ºstudent modelå­¦ä¹ çš„ä¸€éƒ¨åˆ†ã€‚student modelçš„è®­ç»ƒç”±soft labelä¸hard labelç»„æˆã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨soft labelå‘¢ï¼Ÿå› ä¸ºä½œè€…è®¤ä¸ºsoftlabelä¸­åŒ…å«æœ‰hard labelä¸­æ²¡æœ‰ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ ·æœ¬çš„æ¦‚ç‡ä¿¡æ¯ï¼Œå¯ä»¥è¾¾åˆ°æ³›åŒ–çš„æ•ˆæœã€‚</p></blockquote><h3 id="distillBERTæ¨¡å‹æ¶æ„"><a href="#distillBERTæ¨¡å‹æ¶æ„" class="headerlink" title="distillBERTæ¨¡å‹æ¶æ„"></a>distillBERTæ¨¡å‹æ¶æ„</h3><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/distillbert.jpg" alt></p><p>ä¸Šé¢æ˜¯distllBERTçš„ç»“æ„å›¾ï¼Œæ•´ä½“æ¥è¯´ä¸BERTéå¸¸ç±»ä¼¼ï¼Œæ”¹åŠ¨çš„åœ°æ–¹å¦‚ä¸‹ï¼š</p><ul><li>å°†åŸå§‹çš„BERT-baseä½œä¸ºteacher modelï¼Œå¹¶æ¯ä¸¤å±‚åªé€‰æ‹©ä¸€å±‚ä½œä¸ºstudent modelçš„layerï¼Œä¹Ÿå°±æ˜¯è¯´å°†BERTçš„å±‚æ•°å‡å°‘äº†ä¸€åŠï¼Œæ¯ä¸€å±‚çš„å‚æ•°åˆå§‹åŒ–ä¸ºteacher modelçš„å‚æ•°ï¼Œå³ï¼šç”¨teacherçš„ç¬¬2å±‚åˆå§‹åŒ–studentçš„ç¬¬1å±‚ï¼Œteacherçš„ç¬¬4å±‚åˆå§‹åŒ–studentçš„ç¬¬2å±‚ï¼›</li><li>å»æ‰äº†token type embeddingå’Œpoolerï¼Œä¹Ÿå°±æ˜¯å»æ‰äº†segment embeddingï¼›</li><li>ä½¿ç”¨ä¸RoBERTaç±»ä¼¼çš„åŠ¨æ€maskingçš„æ–¹æ³•ï¼Œå¹¶ä¸”å»æ‰äº†NSP lossã€‚</li></ul><p>å¦å¤–ï¼Œå…³äºdistillBERTçš„é¢„è®­ç»ƒé˜¶æ®µçš„lossï¼Œå…±åˆ†ä¸º3éƒ¨åˆ†ï¼Œè¿™é‡Œéœ€è¦å¥½å¥½æä¸€ä¸‹ï¼š</p><p><strong>$L_{ce}$ loss</strong></p><p>æ‰€è°“çš„$L_{ce}$ lossæŒ‡çš„æ˜¯ï¼šteacherç½‘ç»œsoftmaxå±‚è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒå’Œstudentç½‘ç»œsoftmaxå±‚è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒçš„äº¤å‰ç†µï¼ˆæ³¨ï¼šMLMä»»åŠ¡çš„è¾“å‡ºï¼‰ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><blockquote><p>è¿™é‡Œæœ‰ç‚¹é—®é¢˜ï¼Œåœ¨ä»£ç é‡Œä½¿ç”¨çš„KL divergenceï¼Œè€Œä¸æ˜¯CEã€‚ã€‚ã€‚å°±æŒ‰ä»£ç æ¥å§ã€‚ã€‚ã€‚</p></blockquote><script type="math/tex; mode=display">softmax-temperature:p_i=\frac {exp(z_i/T)}{\sum_{j}exp(z_j/T)}</script><script type="math/tex; mode=display">L_{ce}=-\sum_{i}t_ilog(s_i)</script><p>å…¶ä¸­ï¼Œ$t_iã€s_i$åˆ†åˆ«è¡¨ç¤ºteacher modelä¸student modelçš„soft labelï¼Œä»–ä»¬çš„è®¡ç®—å…¬å¼æ˜¯$softmax-temperature$ã€‚</p><p><strong>$L_{mlm}$ loss</strong></p><p>$L_{mlm}$æŸå¤±å°±æ˜¯BERTå½“ä¸­æ‰€è¯´çš„MLM lossï¼Œæ³¨æ„ï¼šè¿™ä¸ªæ˜¯student modelæœ¬èº«çš„mlmã€‚</p><p><strong>$L_{cos}$ loss</strong></p><p>è®¡ç®—teacher hidden stateå’Œstudent hidden stateçš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚å®˜æ–¹ä»£ç ç”¨çš„æ˜¯ï¼šnn.CosineEmbeddingLossã€‚</p><p><strong>æˆ‘ä»¬æœ€ç»ˆçš„lossæ˜¯ä¸‰ç§lossçš„çº¿æ€§ç›¸åŠ ï¼Œæ¥å¯¹student modelè¿›è¡Œpre-trainingã€‚</strong></p><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/distillbert result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼ŒdistillBERTçš„è¡¨ç°ä¸BERTæ¥è¿‘ï¼Œä¿ç•™äº†97%çš„æ•ˆæœï¼Œå‚æ•°é‡å‡å°‘äº†40%ï¼Œé€Ÿåº¦å¿«å‡º71%ï¼Œå¯ä»¥è¯´éå¸¸çš„ä¼˜ç§€äº†ã€‚</p><h2 id="tinyBERTæ¨¡å‹"><a href="#tinyBERTæ¨¡å‹" class="headerlink" title="tinyBERTæ¨¡å‹"></a>tinyBERTæ¨¡å‹</h2><p>tinyBERTæ˜¯å¦å¤–ä¸€ç§ä½¿ç”¨çŸ¥è¯†è’¸é¦æ–¹æ³•çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚å®ƒæå‡ºçš„èƒŒæ™¯æ˜¯ï¼štransformer layerä¸­çš„attentionæœºåˆ¶èƒ½å¤Ÿæå–å‡ºéå¸¸ä¸°å¯Œçš„è¯­è¨€çŸ¥è¯†ï¼Œä½†æ˜¯åœ¨ä¹‹å‰çš„distillBERTä¸­å¹¶æ²¡æœ‰å°†è¿™äº›è¯­è¨€çŸ¥è¯†è®©student modelç»™å­¦ä¹ åˆ°ã€‚æ‰€ä»¥tinyBERTæå‡ºäº†ä¸€ä¸ªä¸¤æ®µå¼çš„çŸ¥è¯†è’¸é¦çš„æ¡†æ¶ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="tinyBERTæ¨¡å‹æ¶æ„"><a href="#tinyBERTæ¨¡å‹æ¶æ„" class="headerlink" title="tinyBERTæ¨¡å‹æ¶æ„"></a>tinyBERTæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆç›´æ¥æ”¾tinyBERTçš„ç»“æ„å›¾ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/tinyBERT.jpg" alt></p><p>aå›¾æ˜¯tinyBERTçš„æ¶æ„å›¾ï¼Œä¸»è¦æ˜¯å¯¹å››ä¸ªéƒ¨åˆ†è¿›è¡Œè’¸é¦ï¼Œå¦‚ä¸‹ï¼š</p><ul><li><strong>embedding-layer distillationï¼š</strong>åœ¨tinyBERTæ¨¡å‹ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦å¸Œæœ›æ¨¡å‹èƒ½å¤Ÿå­¦åˆ°ä¸teacher modelç›¸ä¼¼ç”šè‡³æ˜¯ç›¸åŒçš„è¯­ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨MSEæŸå¤±å‡½æ•°æ¥å¯¹è¿›è¡Œè’¸é¦ã€‚å…·ä½“å…¬å¼æ˜¯ï¼šå‡è®¾teacher modelçš„embedding $E^S$çš„ç»´åº¦æ˜¯$d$ï¼ŒtinyBERTçš„embedding $E^T$ç»´åº¦æ˜¯$dâ€™$ï¼Œå¹¶ä¸”$dâ€™&lt;d$ï¼Œloss formation å¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">{\cal L_{emd}}=MSE(E^SW_e,E^T)</script><ul><li><strong>Transformer-layer distillationï¼š</strong>å¯¹äºtransformer layeræ¥è¯´ï¼Œè’¸é¦çš„æœ‰ä¸¤éƒ¨åˆ†ï¼šattention lossä¸hidden lossã€‚attention lossä¸»è¦æ˜¯å¸Œæœ›tinyBERTä¸­çš„multi-head self attentionå¾—åˆ°çš„scoresèƒ½å¤Ÿæ¥è¿‘teacher modelçš„scoresï¼Œå› ä¸ºæœ‰ç ”ç©¶è¡¨æ˜attentionèƒ½å¤Ÿå­¦åˆ°å¾ˆå¤šè¯­ä¹‰çŸ¥è¯†ï¼ŒåŒ…æ‹¬è¯­æ³•ç­‰ç­‰ã€‚å…¬å¼å¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">{\cal L_{attn}}=\frac {1}{h}\sum_{i=1}^{h}MSE(A_{i}^{S},A_{i}^{T})</script><p>å…¶ä¸­ï¼Œhè¡¨ç¤ºheadçš„æ•°ç›®ã€‚</p><p>hidden lossæŒ‡çš„æ˜¯å¸Œæœ›é€šè¿‡ä¸€ä¸ªtransformer layerå¾—åˆ°çš„è¾“å‡ºç»“æœå°½å¯èƒ½çš„é è¿‘teacher modelçš„ç»“æœï¼Œå…·ä½“æ˜¯bå›¾ã€‚å…¬å¼æ˜¯ï¼š</p><script type="math/tex; mode=display">{\cal L_{hide}}=MSE(H^SW_h,H^T)</script><ul><li><strong>predcition-layer distillationï¼š</strong>è¿™æ˜¯é‡‡ç”¨äº†äº¤å‰ç†µã€‚å…¬å¼å¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">{\cal L_{pred}}=-softmax(z^T)log\_softmax(z^S/t)</script><p>åœ¨tinyBERTä¸­ï¼Œæˆ‘ä»¬æ˜¯é¦–å…ˆåœ¨é¢„è®­ç»ƒé˜¶æ®µï¼Œä½¿ç”¨embedding-layer distillationä¸transformer-layer distillationï¼Œåœ¨finetuneé˜¶æ®µä½¿ç”¨prediction-layer distillationã€‚å¦å¤–ï¼Œéœ€è¦è®²è§£çš„æ˜¯ï¼štinyBERTæ˜¯å¦‚ä½•å¯¹å±‚æ•°è¿›è¡Œè’¸é¦çš„ï¼Ÿ</p><p>åœ¨distllBERTä¸­ï¼Œæˆ‘ä»¬æ˜¯æ¯ä¸¤å±‚é€‰æ‹©ä¸€å±‚ï¼Œä½†æ˜¯åœ¨tinyBERTä¸­å¹¶ä¸æ˜¯è¿™ä¹ˆçš„ç®€å•ç²—æš´ã€‚å‡è®¾teacher modelæœ‰Nå±‚ï¼Œæˆ‘ä»¬çš„student modelç”±Må±‚ï¼Œæ€ä¹ˆè¿›è¡Œæ˜ å°„å‘¢ï¼Ÿå…·ä½“æ˜¯ï¼š$0=g(0)ï¼ŒN+1=g(M+1)ï¼Œn=g(m)$ã€‚ä¹Ÿå°±è¯´ï¼Œembeddingå±‚å¯¹åº”äºteacher modelçš„embeddingå±‚ï¼Œprediction layerå¯¹å¯¹åº”äºteacher modelçš„prediction layerï¼Œå¯¹äºä¸­é—´çš„ Transformer å±‚ï¼ŒTinyBERT é‡‡ç”¨ k å±‚è’¸é¦çš„æ–¹æ³•ï¼Œå³ g(m) = m Ã— N / Mã€‚ä¾‹å¦‚ TinyBERT æœ‰ 4 å±‚ Transformerï¼ŒBERT æœ‰ 12 å±‚ Transformerï¼Œåˆ™ TinyBERT ç¬¬ 1 å±‚ Transformer å­¦ä¹ çš„æ˜¯ BERT çš„ç¬¬ 3 å±‚ï¼›è€ŒTinyBERT ç¬¬ 2 å±‚å­¦ä¹  BERT çš„ç¬¬ 6 å±‚ã€‚</p><h3 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/tinyBERT result.jpg" alt></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è’¸é¦æˆåŒæ ·çš„å±‚æ•°çš„æ—¶å€™ï¼ŒtinyBERTçš„ç»“æœè¦æ¯”distillBERTè¦å¥½å¾ˆå¤šï¼Œåœ¨æŸäº›æ•°æ®é›†ä¸Šç”šè‡³å¯ä»¥ä¸BERTæŒå¹³ï¼Œè¿˜æ˜¯éå¸¸éå¸¸ä¼˜ç§€çš„ã€‚ç„¶åä½œè€…åˆåšäº†å¾ˆå¤šæ¶ˆèåˆ†æï¼Œå…·ä½“ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/tinyBERT result2.jpg" alt></p><p>ä»ç»“æœä¸Šæ¥è¯´ï¼Œæ‰€æœ‰çš„è’¸é¦objectiveéƒ½æ˜¯æœ‰ç”¨çš„ï¼Œå°¤å…¶æ˜¯å¯¹transfomer layerçš„è’¸é¦ï¼Œå½“æˆ‘ä»¬å»æ‰transformer layerçš„æ—¶å€™ï¼Œç»“æœä¸‹é™çš„éå¸¸å‰å®³ï¼Œæ‰€ä»¥ï¼Œå¯¹äºtransformer layerçš„è’¸é¦æ˜¯å…³é”®ã€‚</p><h2 id="fastBERTæ¨¡å‹"><a href="#fastBERTæ¨¡å‹" class="headerlink" title="fastBERTæ¨¡å‹"></a>fastBERTæ¨¡å‹</h2><p>fastBERTæ˜¯ä»Šå¹´åœ¨ACLä¸Šå‘å¸ƒçš„ä¸€ä¸ªæ–°çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä¸ªäººè§‰å¾—åœ¨å‡å°æ¨¡å‹å‚æ•°ä¸åŠ é€Ÿinferenceé€Ÿåº¦ä¸Šæ˜¯éå¸¸ä¼˜é›…çš„ï¼Œå€¼å¾—ä¸€è¯»ã€‚å®ƒæ•´ä½“çš„åˆ›æ–°æœ‰ä¸¤ä¸ªï¼šæ ·æœ¬è‡ªé€‚åº”æœºåˆ¶ä¸è‡ªè’¸é¦æ–¹æ³•ã€‚å…·ä½“çš„ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»ï½</p><h3 id="fastBERTæ¨¡å‹ç»“æ„"><a href="#fastBERTæ¨¡å‹ç»“æ„" class="headerlink" title="fastBERTæ¨¡å‹ç»“æ„"></a>fastBERTæ¨¡å‹ç»“æ„</h3><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/fastBERT.jpg" alt></p><p>æ•´ä½“æ¶æ„è¿˜æ˜¯å¾ˆå¥½æ‡‚çš„ï¼Œä¸»è¦åˆ†ä¸ºbackboneä¸branchä¸¤éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>backboneï¼šä¸BERT-baseä¸€æ ·ï¼Œ12å±‚çš„transformerï¼Œåœ¨æœ€ååŠ äº†ä¸€å±‚teacher classifierã€‚</li><li>branchï¼šbranchä½¿ç”¨çš„æ˜¯classifierï¼Œæ³¨æ„è¿™é‡Œçš„classifieræ˜¯æ ¹æ®teacher classifierè’¸é¦æ¥çš„ã€‚è®ºæ–‡ç§°ä¸ºè‡ªè’¸é¦æ–¹æ³•ã€‚å³ï¼šåœ¨pre-trainingä¸fine-tuningçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½åªå»æ›´æ–°backboneçš„å‚æ•°ï¼Œä¹‹åå†frozenbackboneçš„å‚æ•°ï¼Œç”¨branch classifieræ¥è’¸é¦backboneä¸­çš„classifierçš„æ¦‚ç‡åˆ†å¸ƒã€‚</li></ul><p>æ•´ä½“æ¨¡å‹çš„è®­ç»ƒä¸inferenceçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>pre-trainingï¼šç›´æ¥é‡‡ç”¨BERTã€ROBERTaç­‰æ¨¡å‹å°±å¯ä»¥ï¼›</li><li>fine-tuning for backboneï¼šç»™BERTåŠ ä¸Šæœ€åä¸€å±‚çš„classifierï¼Œç”¨æ ‡æ³¨çš„æ¥è¿›è¡Œè®­ç»ƒï¼Œè¿™ä¸ä¼ ç»Ÿçš„BERTçš„finetuningæ˜¯ä¸€æ ·çš„ï¼›</li><li>self-distillation for branchï¼šè¿™é‡Œä½¿ç”¨æ— æ ‡ç­¾æ•°æ®å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬å°†backboneçš„åˆ†å¸ƒè’¸é¦ç»™branch classfierã€‚è¿™é‡Œä½¿ç”¨KLæ•£åº¦æ¥è¡¡é‡ä¸¤è€…æ¦‚ç‡åˆ†å¸ƒï¼Œå’ŒdistillBERTä¸€æ ·ï¼›æœ€åçš„losså°±æ˜¯æ‰€æœ‰branchçš„KLæ•£åº¦ä¹‹å’Œï¼›</li><li>Adaptive inferenceï¼šæ ¹æ®branchçš„åˆ†ç±»å™¨çš„ç»“æœæ¥å¯¹æ ·æœ¬è¿›è¡Œè¿‡æ»¤ï¼Œç®€å•çš„æ ·æœ¬è¶Šæ—©ç»™å‡ºç»“æœï¼Œè¶Šéš¾çš„æ ·æœ¬è¶Šæ™šç»™å‡ºç»“æœã€‚åœ¨è®ºæ–‡é‡Œï¼Œä½œè€…åŸºäºç†µç»™å‡ºäº†ä¸ç¡®å®šæ€§åº¦é‡ï¼Œæ¥è¡¡é‡æ ·æœ¬çš„ä¸ç¡®å®šç¨‹åº¦ã€‚å…¬å¼å¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">Uncertainty=\frac {\sum_{i=1}^{N}p_s(i)logp_s(i)}{log(1/N)}</script><p>åœ¨æ¯ä¸€å±‚ï¼Œä½œè€…éƒ½æ˜¯ç”¨ä¸ç¡®å®šæ€§æ¥è¡¡é‡æ ·æœ¬æ˜¯å¦è¢«èˆå¼ƒï¼Œæ ·æœ¬çš„ä¸ç¡®å®šæ€§å¦‚æœåœ¨æ¯ä¸€å±‚ä½äºé˜ˆå€¼ï¼Œç„¶åå°±è¢«ç«‹å³ä¸¢å¼ƒï¼Œå¦åˆ™çš„è¯ï¼Œå°±ä¿ç•™è¿›å…¥ä¸‹ä¸€å±‚ï¼›å¦å¤–ä½œè€…åšå®éªŒéªŒè¯äº†ï¼šä½ä¸ç¡®å®šæ€§çš„æ ·æœ¬è¢«æ­£ç¡®åˆ†ç±»çš„æ¦‚ç‡é«˜ï¼Œé«˜ä¸ç¡®å®šæ€§çš„æ ·æœ¬è¢«æ­£ç¡®åˆ†ç±»çš„æ¦‚ç‡ä½ï¼Œæ‰€ä»¥å³ä¾¿åœ¨ç¬¬ä¸€å±‚å°±è¢«èˆå¼ƒäº†ï¼Œä½†æ˜¯è¢«é”™è¯¯åˆ†ç±»çš„æ¦‚ç‡å¾ˆå°ã€‚<strong>è¿™ä¸ªæœºåˆ¶å«åšæ ·æœ¬è‡ªé€‚åº”æœºåˆ¶ã€‚</strong>è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦å¤§å¹…æé«˜inferenceçš„é€Ÿåº¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†é˜ˆå€¼è®¾ç½®çš„å¤§ä¸€ç‚¹ï¼Œè¿™æ ·çš„è¯ï¼Œå¤§éƒ¨åˆ†çš„æ ·æœ¬çš„ç»“æœåœ¨æ—©æœŸå°±è¢«è¾“å‡ºäº†ã€‚</p><h3 id="ç»“æœ-2"><a href="#ç»“æœ-2" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/07/18/NLP-distill%E7%B3%BB%E5%88%97%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/fastbert-result.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼ŒfastBERTè¦æ¯”distilBERTè¦å¥½ï¼Œå…¶å®æˆ‘è§‰å¾—å®ƒåº”è¯¥å’Œtinybertè¿™æ ·çš„æ¨¡å‹æ¯”è¾ƒï¼Œdistilbertç®—æ˜¯å¾ˆæ—©çš„æ¨¡å‹ï¼Œæ€»è§‰å¾—ç»“æœä¸å¤ªsolidã€‚å¦å¤–fastBERTæ¨¡å‹ç›®å‰åªé€‚ç”¨äºåˆ†ç±»ä»»åŠ¡ï¼Œå¯¹äºå…¶ä»–çš„åºåˆ—æ ‡æ³¨ç­‰ä»»åŠ¡éƒ½ä¸å¤ªé€‚ç”¨ï¼Œä¸è¿‡æˆ‘è§‰å¾—å·²ç»å¤Ÿäº†ï¼Œç°å®ä¸­å¾ˆå¤šä»»åŠ¡éƒ½å¯ä»¥è¢«å½“ä½œåˆ†ç±»ä»»åŠ¡æ¥åšï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§çš„åº”ç”¨ä»·å€¼çš„ã€‚</p><h2 id="MobileBERTæ¨¡å‹"><a href="#MobileBERTæ¨¡å‹" class="headerlink" title="MobileBERTæ¨¡å‹"></a>MobileBERTæ¨¡å‹</h2><p>mobile-BERTæ¥æºäºã€ŠMobileBERT: a Compact Task-Agnostic BERT for Resource-Limited Devicesã€‹è®ºæ–‡ã€‚æˆ‘ä¸ªäººè§‰å¾—æ•´ä½“æ¨¡å‹å¹¶ä¸ä¼˜é›…</p><h3 id="MobileBERTæ¨¡å‹æ¶æ„"><a href="#MobileBERTæ¨¡å‹æ¶æ„" class="headerlink" title="MobileBERTæ¨¡å‹æ¶æ„"></a>MobileBERTæ¨¡å‹æ¶æ„</h3><p>pass</p><h3 id="ç»“æœ-3"><a href="#ç»“æœ-3" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> distillBERT </tag>
            
            <tag> tinyBERT </tag>
            
            <tag> fastBERT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorchçš„é›¶ç¢ç¬”è®°</title>
      <link href="2020/07/11/Pytorch%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/"/>
      <url>2020/07/11/Pytorch%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦pytorchï¼Œè™½ç„¶ä¸TF2å¾ˆç±»ä¼¼äº†ï¼Œä½†æ˜¯æ„Ÿè§‰å¾ˆå¤šåœ°æ–¹è¿˜æ˜¯ä¸å¤ªä¸€æ ·ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦å°±æ˜¯è®°å½•ä¸€ä¸‹å­¦ä¹ pytorchä¸­é‡åˆ°çš„apiã€‚</p><a id="more"></a><p><strong>torch.tensorä¸torch.from_numpy</strong></p><p>Torch.tensorå¯ä»¥å°†numpyå¯¹è±¡è½¬åŒ–ä¸ºtensorï¼Œä½†æ˜¯å¾—åˆ°çš„tensorä¸åŸæ¥çš„æ•°æ®ä¸å…±äº«å†…å­˜ï¼›</p><p>torch.from_numpyä¹Ÿå¯ä»¥å°†numpyå¯¹è±¡è½¬åŒ–ä¸ºtensorï¼Œä½†æ˜¯å¾—åˆ°çš„tensorä¸åŸæ¥çš„æ•°æ®å…±äº«å†…å­˜ã€‚</p><p><strong>nn.Conv2d</strong></p><p>nn.Conv2d(in_channels,out_channels,kernel_size,strides=1,padding=0)</p><p>å…¶ä¸­ï¼Œin_channelsè¡¨ç¤ºè¾“å…¥çš„channelsæ•°ç›®ï¼Œout_channelsè¡¨ç¤ºè¾“å‡ºçš„channelsæ•°ç›®ï¼Œkernel_sizeè¡¨ç¤ºå·ç§¯æ ¸å¤§å°ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªtupleã€‚<strong>æ³¨æ„ï¼šåœ¨nn.conv2d</strong>ä¸­ï¼Œæ— æ¿€æ´»å‡½æ•°ï¼Œéœ€è¦ä½¿ç”¨nn.functionalä¸­çš„å‡½æ•°æ¥æ¿€æ´»ã€‚è¾“å…¥çš„ç»´åº¦æ˜¯(batch_size,channels,height,width)ï¼Œä¸tensorflowä¸å¤ªä¸€æ ·ã€‚</p><p><strong>nn.MaxPool2d</strong></p><p>nn.MaxPool2d(kernel_size,stride=0,padding=1)</p><p>è¾“å…¥ç»´åº¦æ˜¯(batch_size,channels,height,width)ï¼Œè¾“å‡ºç»´åº¦æ˜¯ï¼š(batch_size,channels,height_out,width_out)ã€‚</p><p><strong>nn.Linear</strong></p><p>è¾“å…¥çš„ç»´åº¦æ˜¯:(batch_size,seq_length,hidden_size)ï¼Œè¿™ä¸ªä¸å·ç§¯å±‚çš„è¾“å…¥æ˜¯ä¸ä¸€æ ·çš„ï¼</p><p><strong>nn.LSTM(input_size=10,hidden_size=20,num_layers=1,batch_first=False,bidirectional=False)</strong></p><p>Input_sizeè¡¨ç¤ºè¾“å…¥çš„å¼ é‡çš„æœ€åä¸€ä¸ªç»´åº¦</p><p>hidden_sizeè¡¨ç¤ºè¾“å‡ºçš„å¼ é‡çš„æœ€åä¸€ä¸ªç»´åº¦</p><p>num_layersè¡¨ç¤ºå åŠ çš„LSTMçš„æ•°ç›®ï¼Œé»˜è®¤ä¸º1</p><p>batch_first=Trueè¡¨ç¤ºbatch_sizeæ”¾åœ¨ç¬¬0ç»´ï¼Œé‚£ä¹ˆè¾“å…¥çš„ç»´åº¦æ˜¯ï¼š(batch_size,seq_length,input_size)ï¼›é»˜è®¤ä¸ºfalseï¼Œå³è¾“å…¥çš„ç»´åº¦æ˜¯ï¼š(seq_length,batch_size,input_size)</p><p>bidirectional=Trueè¡¨ç¤ºæ˜¯BILSTMï¼›é»˜è®¤ä¸ºfalseã€‚</p><p><strong>pytorchä¸­çš„å„ç§loss function<a href="https://www.jianshu.com/p/579a0f4cbf24" target="_blank" rel="noopener">é“¾æ¥</a></strong></p><p>nn.NLLLoss()è¡¨ç¤ºè´Ÿå¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œé€‚ç”¨äºå¤šåˆ†ç±»ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨nn.LogSoftmax;</p><p>nn.CrossEntropyLossè¡¨ç¤ºäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œé€‚ç”¨äºå¤šåˆ†ç±»ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªä¹‹å‰ï¼Œä¸éœ€è¦ä½¿ç”¨softmaxï¼Œåªéœ€è¦å¾—åˆ°logitså°±å¯ä»¥äº†ï¼Œç»“æœä¸nn.NLLLossç»“æœä¸€æ ·ï¼›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> torch.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">x_input=torch.randn(<span class="number">3</span>,<span class="number">3</span>)<span class="comment">#éšæœºç”Ÿæˆè¾“å…¥ </span></span><br><span class="line">print(<span class="string">'x_input:\n'</span>,x_input) </span><br><span class="line">y_target=torch.tensor([<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>])<span class="comment">#è®¾ç½®è¾“å‡ºå…·ä½“å€¼ print('y_target\n',y_target)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡ç®—è¾“å…¥softmaxï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°æ¯ä¸€è¡ŒåŠ åˆ°ä¸€èµ·ç»“æœéƒ½æ˜¯1</span></span><br><span class="line">softmax_func=nn.Softmax(dim=<span class="number">1</span>)</span><br><span class="line">soft_output=softmax_func(x_input)</span><br><span class="line">print(<span class="string">'soft_output:\n'</span>,soft_output)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨softmaxçš„åŸºç¡€ä¸Šå–log</span></span><br><span class="line">log_output=torch.log(soft_output)</span><br><span class="line">print(<span class="string">'log_output:\n'</span>,log_output)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹æ¯”softmaxä¸logçš„ç»“åˆä¸nn.LogSoftmaxloss(è´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±)çš„è¾“å‡ºç»“æœï¼Œå‘ç°ä¸¤è€…æ˜¯ä¸€è‡´çš„ã€‚</span></span><br><span class="line">logsoftmax_func=nn.LogSoftmax(dim=<span class="number">1</span>)</span><br><span class="line">logsoftmax_output=logsoftmax_func(x_input)</span><br><span class="line">print(<span class="string">'logsoftmax_output:\n'</span>,logsoftmax_output)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pytorchä¸­å…³äºNLLLossçš„é»˜è®¤å‚æ•°é…ç½®ä¸ºï¼šreducetion=Trueã€size_average=True</span></span><br><span class="line">nllloss_func=nn.NLLLoss()</span><br><span class="line">nlloss_output=nllloss_func(logsoftmax_output,y_target)</span><br><span class="line">print(<span class="string">'nlloss_output:\n'</span>,nlloss_output)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›´æ¥ä½¿ç”¨pytorchä¸­çš„loss_func=nn.CrossEntropyLoss()çœ‹ä¸ç»è¿‡NLLLossçš„è®¡ç®—æ˜¯ä¸æ˜¯ä¸€æ ·</span></span><br><span class="line">crossentropyloss=nn.CrossEntropyLoss()</span><br><span class="line">crossentropyloss_output=crossentropyloss(x_input,y_target)</span><br><span class="line">print(<span class="string">'crossentropyloss_output:\n'</span>,crossentropyloss_output)</span><br></pre></td></tr></table></figure><p><strong>np.randomä¸­çš„å„ç§api</strong></p><ul><li>np.random.normal(size=(3,4,5))</li><li>np.random.randint(low=1,high=10,size=(3,4,5))</li><li>np.random.randn(3,4,5)</li><li>np.random.choice(tensor,size=(3,4,5))</li><li>np.random.rand(3,4,5)</li></ul><p><strong>permute</strong></p><p>ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨permuteæ¥äº¤æ¢ç»´åº¦ï¼Œä¸€èˆ¬ä¸ç”¨transposeï¼Œæ³¨æ„åœ¨ä½¿ç”¨permuteçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯:x.permute(1,2,3)ã€‚</p><p><strong>viewä¸reshape</strong><a href="https://www.jianshu.com/p/035d174eb5a6" target="_blank" rel="noopener">è®²è§£</a></p><p>å¦‚æœæˆ‘ä»¬åœ¨ä½¿ç”¨viewä¹‹å‰ï¼Œä½¿ç”¨äº†transposeä¸permuteç­‰æ“ä½œï¼Œæˆ‘ä»¬ä¸€èˆ¬è¦ç´§è·Ÿç€contiguous()ï¼Œç„¶åå†è°ƒç”¨viewï¼Œè¦ä¸ç„¶ä¼šæŠ¥é”™ï¼›</p><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨contiguous+viewè¿™æ ·çš„æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨reshapeï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šåˆ›å»ºæ–°çš„tensorã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|BERTæºç è§£è¯»</title>
      <link href="2020/07/04/NLP-BERT%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/"/>
      <url>2020/07/04/NLP-BERT%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨çœ‹é¢„è®­ç»ƒæ¨¡å‹ï¼Œå‘ç°å¤§éƒ¨åˆ†æ¨¡å‹çš„æºä»£ç åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨Googleå®˜æ–¹å‘å¸ƒçš„BERTæºç çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„(ä½†æ˜¯å…¨éƒ½æ˜¯TF1.xğŸ˜·ï¼Œè¿™ç‚¹æˆ‘è¦åæ§½äº†ï¼ŒæŒ‰é“ç†TF2.xå‡ºæ¥ä¹‹åï¼ŒGoogleåœ¨å¤§åŠ›æ¨å¹¿TF2.xï¼Œç„¶è€Œè¿Googleè‡ªå·±å‘å¸ƒçš„ELECTRAã€Adapter-BERTã€ALBERTç­‰ç­‰æºä»£ç éƒ½æ˜¯import tensorflow.compat.v1 as tfğŸ˜·ï¼Œexcuse meï¼Ÿ)ã€‚æ‰€ä»¥è¿˜æ˜¯å›å¤´å†ä»”ç»†çœ‹äº†ä¸€éåŸæ¥BERTçš„æºä»£ç ã€‚ä¸è¿‡ï¼Œæ•´ä½“é˜…è¯»ä¸‹æ¥ï¼Œæ„Ÿè§‰è¿˜æ˜¯éå¸¸é¡ºç•…çš„ï¼Œä¸å¾—ä¸è¯´ä»£ç å†™çš„çœŸçš„å¥½ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹è‡ªå·±çœ‹BERTæºä»£ç çš„è¿‡ç¨‹ã€‚</p><a id="more"></a><h2 id="BERTæ•´ä½“ä»£ç ç»“æ„"><a href="#BERTæ•´ä½“ä»£ç ç»“æ„" class="headerlink" title="BERTæ•´ä½“ä»£ç ç»“æ„"></a>BERTæ•´ä½“ä»£ç ç»“æ„</h2><p>BERTåŸç†æˆ‘åœ¨è¿™é‡Œå°±ä¸å¤šå•°å—¦äº†ï¼Œç½‘ä¸Šä¸€å¤§å †ï¼Œå½“ç„¶æ›´åŠ æ¨èçš„æ˜¯å–çœ‹åŸå§‹è®ºæ–‡ã€‚é¦–å…ˆæ¥çœ‹çœ‹BERTçš„ä»£ç æ–‡ä»¶ä¸æ•´ä½“ç»“æ„ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ create_pretraining_data.py</span><br><span class="line">â”œâ”€â”€ extract_features.py</span><br><span class="line">â”œâ”€â”€ modeling.py</span><br><span class="line">â”œâ”€â”€ modeling_test.py</span><br><span class="line">â”œâ”€â”€ multilingual.md</span><br><span class="line">â”œâ”€â”€ optimization.py</span><br><span class="line">â”œâ”€â”€ optimization_test.py</span><br><span class="line">â”œâ”€â”€ predicting_movie_reviews_with_bert_on_tf_hub.ipynb</span><br><span class="line">â”œâ”€â”€ requirements.txt</span><br><span class="line">â”œâ”€â”€ run_classifier.py</span><br><span class="line">â”œâ”€â”€ run_classifier_with_tfhub.py</span><br><span class="line">â”œâ”€â”€ run_pretraining.py</span><br><span class="line">â”œâ”€â”€ run_squad.py</span><br><span class="line">â”œâ”€â”€ sample_text.txt</span><br><span class="line">â”œâ”€â”€ tokenization.py</span><br><span class="line">â””â”€â”€ tokenization_test.py</span><br></pre></td></tr></table></figure><ul><li>create_pretraining_data.pyï¼šç”¨æ¥åˆ›å»ºè®­ç»ƒå®ä¾‹ï¼›</li><li>extract_features.pyï¼šæå–å‡ºé¢„è®­ç»ƒçš„ç‰¹å¾ï¼›</li><li>modeling.pyï¼šBERTçš„æ ¸å¿ƒå»ºæ¨¡æ–‡ä»¶ï¼Œæ¨¡å‹ä¸»ä½“éƒ¨åˆ†ï¼›</li><li>modeling_test.pyï¼šå¯¹modeling.pyæ–‡ä»¶è¿›è¡Œunittestæµ‹è¯•ï¼›</li><li>optimization.pyï¼šè‡ªå®šä¹‰çš„ä¼˜åŒ–å™¨ï¼›</li><li>optimization_test.pyï¼šå¯¹optimization.pyæ–‡ä»¶çš„unittestæµ‹è¯•ï¼›</li><li>predicting_movie_reviews_with_bert_on_tf_hub.ipynbï¼šé€šè¿‡è°ƒç”¨tfhubæ¥ä½¿ç”¨BERTè¿›è¡Œé¢„æµ‹ï¼›</li><li>run_classifier.pyï¼šåœ¨å¤šç§æ•°æ®é›†ä¸Š(è­¬å¦‚ï¼šMRPCã€XNLIã€MNLIã€COLA)æ¥è¿›è¡ŒBERTæ¨¡å‹çš„finetuneï¼›</li><li>run_classifier_with_tfhub.pyï¼šé€šè¿‡è°ƒç”¨tfhubæ¥è¿›è¡Œfinetuneï¼›</li><li>run_pretraining.pyï¼šé€šè¿‡MLMä¸NSPä»»åŠ¡æ¥å¯¹æ¨¡å‹è¿›è¡Œé¢„è®­ç»ƒï¼›</li><li>run_squad.pyï¼šåœ¨squadæ•°æ®é›†ä¸Šè¿›è¡Œfinetuneï¼›</li><li>tokenization.pyï¼šå¯¹åŸå§‹æ•°æ®è¿›è¡Œæ¸…æ´—ã€åˆ†è¯ç­‰æ“ä½œï¼›</li><li>tokenization_test.pyï¼šå¯¹ tokenization.pyæ–‡ä»¶è¿›è¡Œunittestæµ‹è¯•ã€‚</li></ul><p>ä»¥ä¸Šå°±æ˜¯å„æ–‡ä»¶çš„å¤§è‡´ç®€ä»‹ï¼Œä¸‹é¢å°†å¯¹æ ¸å¿ƒä»£ç æ–‡ä»¶è¿›è¡Œèµ°è¯»ï¼Œtnesorçš„ç»´åº¦ä»¥åŠé‡è¦æ³¨é‡Šæˆ‘å‡å·²åœ¨ä»£ç é‡Œå†™æ˜ï½</p><h2 id="æ ¸å¿ƒä»£ç æ–‡ä»¶èµ°è¯»"><a href="#æ ¸å¿ƒä»£ç æ–‡ä»¶èµ°è¯»" class="headerlink" title="æ ¸å¿ƒä»£ç æ–‡ä»¶èµ°è¯»"></a>æ ¸å¿ƒä»£ç æ–‡ä»¶èµ°è¯»</h2><h3 id="modeling-py"><a href="#modeling-py" class="headerlink" title="modeling.py"></a>modeling.py</h3><p>modeling.pyæ–‡ä»¶æ˜¯BERTæ¨¡å‹çš„å®ç°ã€‚é¦–å…ˆæ¥çœ‹BertConfigç±»ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertConfig</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""Configuration for `BertModel`."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">               vocab_size,</span></span></span><br><span class="line"><span class="function"><span class="params">               hidden_size=<span class="number">768</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               num_hidden_layers=<span class="number">12</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               num_attention_heads=<span class="number">12</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               intermediate_size=<span class="number">3072</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               hidden_act=<span class="string">"gelu"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               hidden_dropout_prob=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               attention_probs_dropout_prob=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               max_position_embeddings=<span class="number">512</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               type_vocab_size=<span class="number">16</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               initializer_range=<span class="number">0.02</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Constructs BertConfig.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      vocab_size: Vocabulary size of `inputs_ids` in `BertModel`.</span></span><br><span class="line"><span class="string">      hidden_size: Size of the encoder layers and the pooler layer.</span></span><br><span class="line"><span class="string">      num_hidden_layers: Number of hidden layers in the Transformer encoder.</span></span><br><span class="line"><span class="string">      num_attention_heads: Number of attention heads for each attention layer in</span></span><br><span class="line"><span class="string">        the Transformer encoder.</span></span><br><span class="line"><span class="string">      intermediate_size: The size of the "intermediate" (i.e., feed-forward)</span></span><br><span class="line"><span class="string">        layer in the Transformer encoder.</span></span><br><span class="line"><span class="string">      hidden_act: The non-linear activation function (function or string) in the</span></span><br><span class="line"><span class="string">        encoder and pooler.</span></span><br><span class="line"><span class="string">      hidden_dropout_prob: The dropout probability for all fully connected</span></span><br><span class="line"><span class="string">        layers in the embeddings, encoder, and pooler.</span></span><br><span class="line"><span class="string">      attention_probs_dropout_prob: The dropout ratio for the attention</span></span><br><span class="line"><span class="string">        probabilities.</span></span><br><span class="line"><span class="string">      max_position_embeddings: The maximum sequence length that this model might</span></span><br><span class="line"><span class="string">        ever be used with. Typically set this to something large just in case</span></span><br><span class="line"><span class="string">        (e.g., 512 or 1024 or 2048).</span></span><br><span class="line"><span class="string">      type_vocab_size: The vocabulary size of the `token_type_ids` passed into</span></span><br><span class="line"><span class="string">        `BertModel`.</span></span><br><span class="line"><span class="string">      initializer_range: The stdev of the truncated_normal_initializer for</span></span><br><span class="line"><span class="string">        initializing all weight matrices.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.vocab_size = vocab_size</span><br><span class="line">    self.hidden_size = hidden_size</span><br><span class="line">    self.num_hidden_layers = num_hidden_layers</span><br><span class="line">    self.num_attention_heads = num_attention_heads</span><br><span class="line">    self.hidden_act = hidden_act</span><br><span class="line">    self.intermediate_size = intermediate_size</span><br><span class="line">    self.hidden_dropout_prob = hidden_dropout_prob</span><br><span class="line">    self.attention_probs_dropout_prob = attention_probs_dropout_prob</span><br><span class="line">    self.max_position_embeddings = max_position_embeddings</span><br><span class="line">    self.type_vocab_size = type_vocab_size</span><br><span class="line">    self.initializer_range = initializer_range</span><br><span class="line"></span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">from_dict</span><span class="params">(cls, json_object)</span>:</span></span><br><span class="line">    <span class="string">"""Constructs a `BertConfig` from a Python dictionary of parameters."""</span></span><br><span class="line">    config = BertConfig(vocab_size=<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">for</span> (key, value) <span class="keyword">in</span> six.iteritems(json_object):</span><br><span class="line">      config.__dict__[key] = value</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line"></span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">from_json_file</span><span class="params">(cls, json_file)</span>:</span></span><br><span class="line">    <span class="string">"""Constructs a `BertConfig` from a json file of parameters."""</span></span><br><span class="line">    <span class="keyword">with</span> tf.gfile.GFile(json_file, <span class="string">"r"</span>) <span class="keyword">as</span> reader:</span><br><span class="line">      text = reader.read()</span><br><span class="line">    <span class="keyword">return</span> cls.from_dict(json.loads(text))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Serializes this instance to a Python dictionary."""</span></span><br><span class="line">    output = copy.deepcopy(self.__dict__)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_json_string</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Serializes this instance to a JSON string."""</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(self.to_dict(), indent=<span class="number">2</span>, sort_keys=<span class="literal">True</span>) + <span class="string">"\n"</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸»è¦æ˜¯BERTæ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼Œæ³¨é‡Šå…¶å®å¾ˆè¯¦ç»†äº†ï¼Œä½†æ˜¯éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯<code>type_vocab_size</code>ï¼Œè¿™ä¸ªè¡¨ç¤ºçš„æ˜¯segment idï¼Œé»˜è®¤æ˜¯2ï¼Œä»£ç é‡Œæ²¡æœ‰ä¿®æ”¹ï¼Œä½†æ˜¯åœ¨bert_config.jsonæ–‡ä»¶é‡Œæœ‰éå¸¸è¯¦ç»†çš„è§£é‡Šã€‚</p><p>çœ‹å®ŒBertConfigç±»ä¹‹åå°±æ˜¯BERTæ¨¡å‹äº†ï¼Œä½†æ˜¯ç”±äºBERTæ¨¡å‹æ•´ä½“éå¸¸å¤æ‚ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒçš„å…¶å®çš„componentã€‚é¦–å…ˆæ¥çœ‹token embeddingéƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># embedding_lookupç”¨æ¥è·å–token embedding</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">embedding_lookup</span><span class="params">(input_ids,</span></span></span><br><span class="line"><span class="function"><span class="params">                     vocab_size,</span></span></span><br><span class="line"><span class="function"><span class="params">                     embedding_size=<span class="number">128</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                     initializer_range=<span class="number">0.02</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                     word_embedding_name=<span class="string">"word_embeddings"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                     use_one_hot_embeddings=False)</span>:</span></span><br><span class="line">  <span class="string">"""Looks up words embeddings for id tensor.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    float Tensor of shape [batch_size, seq_length, embedding_size].</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  <span class="comment"># This function assumes that the input is of shape [batch_size, seq_length,</span></span><br><span class="line">  <span class="comment"># num_inputs].</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># If the input is a 2D tensor of shape [batch_size, seq_length], we</span></span><br><span class="line">  <span class="comment"># reshape to [batch_size, seq_length, 1].</span></span><br><span class="line">  <span class="keyword">if</span> input_ids.shape.ndims == <span class="number">2</span>:</span><br><span class="line">    input_ids = tf.expand_dims(input_ids, axis=[<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">#éšæœºåˆå§‹åŒ–embedding table</span></span><br><span class="line">  embedding_table = tf.get_variable(</span><br><span class="line">      name=word_embedding_name,</span><br><span class="line">      shape=[vocab_size, embedding_size],</span><br><span class="line">      initializer=create_initializer(initializer_range))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># flattenï¼Œç»´åº¦å˜ä¸ºï¼š[batch_size*seq_length*input_num]</span></span><br><span class="line">  flat_input_ids = tf.reshape(input_ids, [<span class="number">-1</span>])</span><br><span class="line">  <span class="keyword">if</span> use_one_hot_embeddings:</span><br><span class="line">    <span class="comment"># å˜ä¸ºone-hotå‘é‡ï¼Œç»´åº¦æ˜¯ï¼š[batch_size*seq_length*input_num,vocab_size]</span></span><br><span class="line">    one_hot_input_ids = tf.one_hot(flat_input_ids, depth=vocab_size)</span><br><span class="line">    <span class="comment"># ç»´åº¦ï¼š[batch_size*seq_length*input_num,embedding_size]</span></span><br><span class="line">    output = tf.matmul(one_hot_input_ids, embedding_table)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># ç»´åº¦ï¼š[batch_size*seq_length*input_num,embedding_size]</span></span><br><span class="line">    output = tf.gather(embedding_table, flat_input_ids)</span><br><span class="line"></span><br><span class="line">  input_shape = get_shape_list(input_ids)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç»´åº¦ï¼š[batch_size,seq_length,input_num*embedding_size]</span></span><br><span class="line">  output = tf.reshape(output,</span><br><span class="line">                      input_shape[<span class="number">0</span>:<span class="number">-1</span>] + [input_shape[<span class="number">-1</span>] * embedding_size])</span><br><span class="line">  <span class="keyword">return</span> (output, embedding_table)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¯ä¸ªtensorçš„ç»´åº¦æˆ‘éƒ½æ ‡æ³¨çš„éå¸¸æ¸…æ¥šäº†ï¼Œçœ‹æ‡‚ä»£ç åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚é€šè¿‡<code>embedding_lookup</code>å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†token embeddingä»¥åŠembedding_tableï¼Œå…¶ä¸­embedding_tableå°±æ˜¯è¯å‘é‡è¡¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨finetuneçš„æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è®­ç»ƒå¥½çš„embedding_tableç»™æŠ½å‡ºæ¥ï¼Œç„¶åé‡‡ç”¨feasture basedçš„æ–¹å¼æ¥è¿›è¡Œä¸‹æ¸¸ä»»åŠ¡çš„è®­ç»ƒã€‚</p><p>é™¤äº†token embeddingä¹‹åï¼ŒBERTä¸­è¿˜æœ‰segment embeddingä¸positional embeddingï¼Œæœ€ç»ˆçš„embeddingæ˜¯è¿™ä¸‰ä¸ªembeddingç›¸åŠ å¾—åˆ°çš„ç»“æœã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># embedding_postprocessorç”¨æ¥å°†token embeddingã€segment embeddingä»¥åŠpositional embeddingè¿›è¡Œç›¸åŠ ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¥å¾—åˆ°æœ€ç»ˆè¾“å…¥çš„embedding</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">embedding_postprocessor</span><span class="params">(input_tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                            use_token_type=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                            token_type_ids=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                            token_type_vocab_size=<span class="number">16</span>,<span class="comment"># ä¸€èˆ¬æ˜¯2</span></span></span></span><br><span class="line"><span class="function"><span class="params">                            token_type_embedding_name=<span class="string">"token_type_embeddings"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                            use_position_embeddings=True,</span></span></span><br><span class="line"><span class="function"><span class="params">                            position_embedding_name=<span class="string">"position_embeddings"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                            initializer_range=<span class="number">0.02</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                            max_position_embeddings=<span class="number">512</span>, <span class="comment"># å¿…é¡»å¤§äºç­‰äºseq_length</span></span></span></span><br><span class="line"><span class="function"><span class="params">                            dropout_prob=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">  <span class="string">"""Performs various post-processing on a word embedding tensor.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    input_tensor: float Tensor of shape [batch_size, seq_length,</span></span><br><span class="line"><span class="string">      embedding_size].</span></span><br><span class="line"><span class="string">    use_token_type: bool. Whether to add embeddings for `token_type_ids`.</span></span><br><span class="line"><span class="string">    token_type_ids: (optional) int32 Tensor of shape [batch_size, seq_length].</span></span><br><span class="line"><span class="string">      Must be specified if `use_token_type` is True.</span></span><br><span class="line"><span class="string">    token_type_vocab_size: int. The vocabulary size of `token_type_ids`.</span></span><br><span class="line"><span class="string">    token_type_embedding_name: string. The name of the embedding table variable</span></span><br><span class="line"><span class="string">      for token type ids.</span></span><br><span class="line"><span class="string">    use_position_embeddings: bool. Whether to add position embeddings for the</span></span><br><span class="line"><span class="string">      position of each token in the sequence.</span></span><br><span class="line"><span class="string">    position_embedding_name: string. The name of the embedding table variable</span></span><br><span class="line"><span class="string">      for positional embeddings.</span></span><br><span class="line"><span class="string">    initializer_range: float. Range of the weight initialization.</span></span><br><span class="line"><span class="string">    max_position_embeddings: int. Maximum sequence length that might ever be</span></span><br><span class="line"><span class="string">      used with this model. This can be longer than the sequence length of</span></span><br><span class="line"><span class="string">      input_tensor, but cannot be shorter.</span></span><br><span class="line"><span class="string">    dropout_prob: float. Dropout probability applied to the final output tensor.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    float tensor with same shape as `input_tensor`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Raises:</span></span><br><span class="line"><span class="string">    ValueError: One of the tensor shapes or input values is invalid.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  input_shape = get_shape_list(input_tensor, expected_rank=<span class="number">3</span>)</span><br><span class="line">  batch_size = input_shape[<span class="number">0</span>]</span><br><span class="line">  seq_length = input_shape[<span class="number">1</span>]</span><br><span class="line">  width = input_shape[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">  output = input_tensor</span><br><span class="line"></span><br><span class="line">  <span class="comment"># åŠ å…¥segment embedding</span></span><br><span class="line">  <span class="keyword">if</span> use_token_type:</span><br><span class="line">    <span class="keyword">if</span> token_type_ids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      <span class="keyword">raise</span> ValueError(<span class="string">"`token_type_ids` must be specified if"</span></span><br><span class="line">                       <span class="string">"`use_token_type` is True."</span>)</span><br><span class="line">    token_type_table = tf.get_variable(</span><br><span class="line">        name=token_type_embedding_name,</span><br><span class="line">        shape=[token_type_vocab_size, width],</span><br><span class="line">        initializer=create_initializer(initializer_range))</span><br><span class="line">    <span class="comment"># This vocab will be small so we always do one-hot here, since it is always</span></span><br><span class="line">    <span class="comment"># faster for a small vocabulary.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [batch_size*seq_length]</span></span><br><span class="line">    flat_token_type_ids = tf.reshape(token_type_ids, [<span class="number">-1</span>])</span><br><span class="line">    <span class="comment"># [batch_size*seq_length,token_type_vocab_size]</span></span><br><span class="line">    one_hot_ids = tf.one_hot(flat_token_type_ids, depth=token_type_vocab_size)</span><br><span class="line">    <span class="comment"># [batch_size*seq_length,width]</span></span><br><span class="line">    token_type_embeddings = tf.matmul(one_hot_ids, token_type_table)</span><br><span class="line">    <span class="comment"># [batch_size,seq_length,width]</span></span><br><span class="line">    token_type_embeddings = tf.reshape(token_type_embeddings,</span><br><span class="line">                                       [batch_size, seq_length, width])</span><br><span class="line">    output += token_type_embeddings</span><br><span class="line"></span><br><span class="line">  <span class="comment"># åŠ å…¥positional embedding</span></span><br><span class="line">  <span class="keyword">if</span> use_position_embeddings:</span><br><span class="line">    assert_op = tf.assert_less_equal(seq_length, max_position_embeddings)</span><br><span class="line">    <span class="keyword">with</span> tf.control_dependencies([assert_op]):</span><br><span class="line">      full_position_embeddings = tf.get_variable(</span><br><span class="line">          name=position_embedding_name,</span><br><span class="line">          shape=[max_position_embeddings, width],</span><br><span class="line">          initializer=create_initializer(initializer_range))</span><br><span class="line">      <span class="comment"># Since the position embedding table is a learned variable, we create it</span></span><br><span class="line">      <span class="comment"># using a (long) sequence length `max_position_embeddings`. The actual</span></span><br><span class="line">      <span class="comment"># sequence length might be shorter than this, for faster training of</span></span><br><span class="line">      <span class="comment"># tasks that do not have long sequences.</span></span><br><span class="line">      <span class="comment">#</span></span><br><span class="line">      <span class="comment"># So `full_position_embeddings` is effectively an embedding table</span></span><br><span class="line">      <span class="comment"># for position [0, 1, 2, ..., max_position_embeddings-1], and the current</span></span><br><span class="line">      <span class="comment"># sequence has positions [0, 1, 2, ... seq_length-1], so we can just</span></span><br><span class="line">      <span class="comment"># perform a slice.</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># [seq_length,width]</span></span><br><span class="line">      position_embeddings = tf.slice(full_position_embeddings, [<span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                                     [seq_length, <span class="number">-1</span>])</span><br><span class="line">      num_dims = len(output.shape.as_list())</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Only the last two dimensions are relevant (`seq_length` and `width`), so</span></span><br><span class="line">      <span class="comment"># we broadcast among the first dimensions, which is typically just</span></span><br><span class="line">      <span class="comment"># the batch size.</span></span><br><span class="line">      position_broadcast_shape = []</span><br><span class="line">      <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_dims - <span class="number">2</span>):</span><br><span class="line">        position_broadcast_shape.append(<span class="number">1</span>)</span><br><span class="line">      position_broadcast_shape.extend([seq_length, width])</span><br><span class="line"></span><br><span class="line">      <span class="comment"># [1,seq_length,width]</span></span><br><span class="line">      position_embeddings = tf.reshape(position_embeddings,</span><br><span class="line">                                       position_broadcast_shape)</span><br><span class="line">      <span class="comment"># [batch_size,seq_length,width]</span></span><br><span class="line">      output += position_embeddings</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç»è¿‡layer normä»¥åŠdropout</span></span><br><span class="line">  output = layer_norm_and_dropout(output, dropout_prob)</span><br><span class="line">  <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨BERTä¸­ï¼Œembedding_size=hidden_sizeã€‚</strong>å¾—åˆ°embeddingä¹‹åæˆ‘ä»¬å°±éœ€è¦å°†è¾“å…¥è¾“å…¥åˆ°transformerä¸­äº†ï¼Œåœ¨BERTå½“ä¸­ï¼Œtransformerç”±12ä¸ªself-attention layerå †å è€Œæˆã€‚æ‰€ä»¥ï¼Œé¦–å…ˆæ¥çœ‹çœ‹self-attention layerçš„å®ç°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attention_layer</span><span class="params">(from_tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                    to_tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                    attention_mask=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    num_attention_heads=<span class="number">1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    size_per_head=<span class="number">512</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    query_act=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    key_act=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    value_act=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    attention_probs_dropout_prob=<span class="number">0.0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    initializer_range=<span class="number">0.02</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    do_return_2d_tensor=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                    batch_size=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    from_seq_length=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    to_seq_length=None)</span>:</span></span><br><span class="line">  <span class="string">"""Performs multi-headed attention from `from_tensor` to `to_tensor`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    float Tensor of shape [batch_size, from_seq_length,</span></span><br><span class="line"><span class="string">      num_attention_heads * size_per_head]. (If `do_return_2d_tensor` is</span></span><br><span class="line"><span class="string">      true, this will be of shape [batch_size * from_seq_length,</span></span><br><span class="line"><span class="string">      num_attention_heads * size_per_head]).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Raises:</span></span><br><span class="line"><span class="string">    ValueError: Any of the arguments or tensor shapes are invalid.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">transpose_for_scores</span><span class="params">(input_tensor, batch_size, num_attention_heads,</span></span></span><br><span class="line"><span class="function"><span class="params">                           seq_length, width)</span>:</span></span><br><span class="line">    output_tensor = tf.reshape(</span><br><span class="line">        input_tensor, [batch_size, seq_length, num_attention_heads, width])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¹‹æ‰€ä»¥éœ€è¦ä½¿ç”¨transposeï¼Œä¸»è¦æ˜¯å› ä¸ºåé¢è¦åšQK.Tï¼Œå…¶å®æˆ‘è§‰å¾—ä½¿ç”¨tf.einsumå°±ä¸éœ€è¦è½¬ç½®äº†</span></span><br><span class="line">    output_tensor = tf.transpose(output_tensor, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> output_tensor</span><br><span class="line"></span><br><span class="line">  from_shape = get_shape_list(from_tensor, expected_rank=[<span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">  to_shape = get_shape_list(to_tensor, expected_rank=[<span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> len(from_shape) != len(to_shape):</span><br><span class="line">    <span class="keyword">raise</span> ValueError(</span><br><span class="line">        <span class="string">"The rank of `from_tensor` must match the rank of `to_tensor`."</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> len(from_shape) == <span class="number">3</span>:</span><br><span class="line">    batch_size = from_shape[<span class="number">0</span>]</span><br><span class="line">    from_seq_length = from_shape[<span class="number">1</span>]</span><br><span class="line">    to_seq_length = to_shape[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">elif</span> len(from_shape) == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">if</span> (batch_size <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> from_seq_length <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> to_seq_length <span class="keyword">is</span> <span class="literal">None</span>):</span><br><span class="line">      <span class="keyword">raise</span> ValueError(</span><br><span class="line">          <span class="string">"When passing in rank 2 tensors to attention_layer, the values "</span></span><br><span class="line">          <span class="string">"for `batch_size`, `from_seq_length`, and `to_seq_length` "</span></span><br><span class="line">          <span class="string">"must all be specified."</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Scalar dimensions referenced here:</span></span><br><span class="line">  <span class="comment">#   B = batch size (number of sequences)</span></span><br><span class="line">  <span class="comment">#   F = `from_tensor` sequence length</span></span><br><span class="line">  <span class="comment">#   T = `to_tensor` sequence length</span></span><br><span class="line">  <span class="comment">#   N = `num_attention_heads`</span></span><br><span class="line">  <span class="comment">#   H = `size_per_head`</span></span><br><span class="line"></span><br><span class="line">  <span class="string">'''</span></span><br><span class="line"><span class="string">  æˆ‘ä»¬æŠŠfrom_tensorçœ‹ä½œQï¼Œto_tensorçœ‹ä½œkï¼Œvï¼</span></span><br><span class="line"><span class="string">  '''</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [batch_size*from_seq_length,from_width]</span></span><br><span class="line">  from_tensor_2d = reshape_to_matrix(from_tensor)</span><br><span class="line">   <span class="comment"># [batch_size*to_seq_length,to_width]</span></span><br><span class="line">  to_tensor_2d = reshape_to_matrix(to_tensor)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `query_layer` = [B*F, N*H]</span></span><br><span class="line">  <span class="comment"># [batch_size*from_seq_length,num_attention_heads*size_per_head]ï¼Œå³è®ºæ–‡é‡Œæåˆ°çš„çº¿æ€§å˜æ¢</span></span><br><span class="line">  query_layer = tf.layers.dense(</span><br><span class="line">      from_tensor_2d,</span><br><span class="line">      num_attention_heads * size_per_head,</span><br><span class="line">      activation=query_act,</span><br><span class="line">      name=<span class="string">"query"</span>,</span><br><span class="line">      kernel_initializer=create_initializer(initializer_range))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `key_layer` = [B*T, N*H]</span></span><br><span class="line">  <span class="comment"># [batch_size*to_seq_length,num_attention_heads*size_per_head]ï¼Œå³è®ºæ–‡é‡Œæåˆ°çš„çº¿æ€§å˜æ¢</span></span><br><span class="line">  key_layer = tf.layers.dense(</span><br><span class="line">      to_tensor_2d,</span><br><span class="line">      num_attention_heads * size_per_head,</span><br><span class="line">      activation=key_act,</span><br><span class="line">      name=<span class="string">"key"</span>,</span><br><span class="line">      kernel_initializer=create_initializer(initializer_range))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `value_layer` = [B*T, N*H]</span></span><br><span class="line">  <span class="comment"># [batch_size*to_seq_length,num_attention_heads*size_per_head]ï¼Œå³è®ºæ–‡é‡Œæåˆ°çš„çº¿æ€§å˜æ¢</span></span><br><span class="line">  value_layer = tf.layers.dense(</span><br><span class="line">      to_tensor_2d,</span><br><span class="line">      num_attention_heads * size_per_head,</span><br><span class="line">      activation=value_act,</span><br><span class="line">      name=<span class="string">"value"</span>,</span><br><span class="line">      kernel_initializer=create_initializer(initializer_range))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `query_layer` = [B, N, F, H]</span></span><br><span class="line">  <span class="comment"># [batch_size,num_attention_heads,from_seq_length,size_per_head]</span></span><br><span class="line">  query_layer = transpose_for_scores(query_layer, batch_size,</span><br><span class="line">                                     num_attention_heads, from_seq_length,</span><br><span class="line">                                     size_per_head)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `key_layer` = [B, N, T, H]</span></span><br><span class="line">  <span class="comment"># [batch_size,num_attention_heads,to_seq_length,size_per_head]</span></span><br><span class="line">  key_layer = transpose_for_scores(key_layer, batch_size, num_attention_heads,</span><br><span class="line">                                   to_seq_length, size_per_head)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Take the dot product between "query" and "key" to get the raw</span></span><br><span class="line">  <span class="comment"># attention scores.</span></span><br><span class="line">  <span class="comment"># `attention_scores` = [B, N, F, T]</span></span><br><span class="line">  <span class="comment"># [batch_size,num_attention_heads,from_seq_length,to_seq_length]</span></span><br><span class="line">  attention_scores = tf.matmul(query_layer, key_layer, transpose_b=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment"># æ”¾ç¼©</span></span><br><span class="line">  attention_scores = tf.multiply(attention_scores,</span><br><span class="line">                                 <span class="number">1.0</span> / math.sqrt(float(size_per_head)))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># åœ¨softmaxä¹‹åï¼Œå¯¹logitsè¿›è¡Œmaskï¼Œé˜²æ­¢è¢«paddingçš„ä½ç½®çš„å€¼ä¹Ÿå‚ä¸è®¡ç®—ï¼</span></span><br><span class="line">  <span class="keyword">if</span> attention_mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># `attention_mask` = [B, 1, F, T]</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åœ¨attention_maskä¸­ï¼Œ1è¡¨ç¤ºçœŸå®çš„é•¿åº¦ï¼Œ0è¡¨ç¤ºæ˜¯paddingçš„</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    attention_mask = tf.expand_dims(attention_mask, axis=[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Since attention_mask is 1.0 for positions we want to attend and 0.0 for</span></span><br><span class="line">    <span class="comment"># masked positions, this operation will create a tensor which is 0.0 for</span></span><br><span class="line">    <span class="comment"># positions we want to attend and -10000.0 for masked positions.</span></span><br><span class="line">    adder = (<span class="number">1.0</span> - tf.cast(attention_mask, tf.float32)) * <span class="number">-10000.0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Since we are adding it to the raw scores before the softmax, this is</span></span><br><span class="line">    <span class="comment"># effectively the same as removing these entirely.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘ä»¬è®©paddingçš„ä½ç½®çš„å€¼ä¸ºæ— ç©·å°ï¼Œè¿™æ ·softmaxä¹‹åçš„å€¼å°±ä¼šæ¥è¿‘äº0ï¼</span></span><br><span class="line">    attention_scores += adder</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Normalize the attention scores to probabilities.</span></span><br><span class="line">  <span class="comment"># `attention_probs` = [B, N, F, T]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># # [batch_size,num_attention_heads,from_seq_length,to_seq_length]</span></span><br><span class="line">  attention_probs = tf.nn.softmax(attention_scores)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># This is actually dropping out entire tokens to attend to, which might</span></span><br><span class="line">  <span class="comment"># seem a bit unusual, but is taken from the original Transformer paper.</span></span><br><span class="line">  attention_probs = dropout(attention_probs, attention_probs_dropout_prob)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `value_layer` = [B, T, N, H]</span></span><br><span class="line">  <span class="comment"># [batch_size,to_seq_length,num_attention_heads,size_per_head]</span></span><br><span class="line">  value_layer = tf.reshape(</span><br><span class="line">      value_layer,</span><br><span class="line">      [batch_size, to_seq_length, num_attention_heads, size_per_head])</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `value_layer` = [B, N, T, H]</span></span><br><span class="line">  <span class="comment"># [batch_size,num_attention_heads,to_seq_length,size_per_head]</span></span><br><span class="line">  value_layer = tf.transpose(value_layer, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `context_layer` = [B, N, F, H]</span></span><br><span class="line">  <span class="comment"># [batch_size,num_attention_heads,from_seq_length,size_per_head]</span></span><br><span class="line">  context_layer = tf.matmul(attention_probs, value_layer)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># `context_layer` = [B, F, N, H]</span></span><br><span class="line">  <span class="comment"># [batch_size,from_seq_length,num_attention_heads,to_seq_length]</span></span><br><span class="line">  context_layer = tf.transpose(context_layer, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> do_return_2d_tensor:</span><br><span class="line">    <span class="comment"># `context_layer` = [B*F, N*H]</span></span><br><span class="line">    context_layer = tf.reshape(</span><br><span class="line">        context_layer,</span><br><span class="line">        [batch_size * from_seq_length, num_attention_heads * size_per_head])</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># `context_layer` = [B, F, N*H]</span></span><br><span class="line">    context_layer = tf.reshape(</span><br><span class="line">        context_layer,</span><br><span class="line">        [batch_size, from_seq_length, num_attention_heads * size_per_head])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context_layer</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ ‡å‡†çš„self-attentionå±‚çš„å®ç°ï¼Œæˆ‘è§‰å¾—æœ‰å¾ˆå¤šåœ°æ–¹å¯ä»¥å€Ÿé‰´ï¼Œè­¬å¦‚ï¼šè®©paddingçš„ä½ç½®ç»è¿‡softmaxçš„å€¼æ— é™æ¥è¿‘äº0ï¼Œä»¥åŠåœ¨åšQK.Tçš„è®¡ç®—çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±æŠŠè¾“å…¥ç»™å®ƒreshapeå±‚2ç»´çš„ï¼Œå³ï¼š<code>[batch_size,seq_length,width_size]</code>è½¬åŒ–åˆ°<code>[batch_size*seq_length,num_attention_heads*size_per_head]</code>ï¼Œä»è€ŒåŠ å¿«è®­ç»ƒï¼Œè¿™ä¸ªå…¶å®æˆ‘ä¹‹å‰éƒ½æ²¡æƒ³è¿‡ï¼Œåªæœ‰åœ¨çœ‹å¼€æºä»£ç çš„æ—¶å€™æ‰èƒ½çŸ¥é“ã€‚å®šä¹‰äº†sefl-attention layerä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹transfomerçš„å®ç°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transformer_model</span><span class="params">(input_tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                      attention_mask=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                      hidden_size=<span class="number">768</span>,<span class="comment"># æœ€ç»ˆè¾“å‡ºç»“æœçš„ç»´åº¦</span></span></span></span><br><span class="line"><span class="function"><span class="params">                      num_hidden_layers=<span class="number">12</span>,<span class="comment"># self-attention layerçš„æ•°ç›®</span></span></span></span><br><span class="line"><span class="function"><span class="params">                      num_attention_heads=<span class="number">12</span>, <span class="comment"># æ¯ä¸€ä¸ªself-attention layerä¸­headçš„æ•°ç›®</span></span></span></span><br><span class="line"><span class="function"><span class="params">                      intermediate_size=<span class="number">3072</span>, <span class="comment"># ä¸­é—´ç»´åº¦ï¼Œå³FFNçš„ç»´åº¦</span></span></span></span><br><span class="line"><span class="function"><span class="params">                      intermediate_act_fn=gelu,<span class="comment"># FFNçš„æ¿€æ´»å‡½æ•°</span></span></span></span><br><span class="line"><span class="function"><span class="params">                      hidden_dropout_prob=<span class="number">0.1</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">                      attention_probs_dropout_prob=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      initializer_range=<span class="number">0.02</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      do_return_all_layers=False)</span>:</span> <span class="comment"># æ˜¯å¦è¿”å›æ‰€æœ‰å±‚çš„è¾“å‡ºç»“æœ</span></span><br><span class="line">  <span class="string">"""Multi-headed, multi-layer Transformer from "Attention is All You Need".</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    float Tensor of shape [batch_size, seq_length, hidden_size], the final</span></span><br><span class="line"><span class="string">    hidden layer of the Transformer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Raises:</span></span><br><span class="line"><span class="string">    ValueError: A Tensor shape or parameter is invalid.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  <span class="keyword">if</span> hidden_size % num_attention_heads != <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(</span><br><span class="line">        <span class="string">"The hidden size (%d) is not a multiple of the number of attention "</span></span><br><span class="line">        <span class="string">"heads (%d)"</span> % (hidden_size, num_attention_heads))</span><br><span class="line"></span><br><span class="line">  attention_head_size = int(hidden_size / num_attention_heads)</span><br><span class="line">  input_shape = get_shape_list(input_tensor, expected_rank=<span class="number">3</span>)</span><br><span class="line">  batch_size = input_shape[<span class="number">0</span>]</span><br><span class="line">  seq_length = input_shape[<span class="number">1</span>]</span><br><span class="line">  input_width = input_shape[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The Transformer performs sum residuals on all layers so the input needs</span></span><br><span class="line">  <span class="comment"># to be the same as the hidden size.</span></span><br><span class="line">  <span class="keyword">if</span> input_width != hidden_size:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"The width of the input tensor (%d) != hidden size (%d)"</span> %</span><br><span class="line">                     (input_width, hidden_size))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># We keep the representation as a 2D tensor to avoid re-shaping it back and</span></span><br><span class="line">  <span class="comment"># forth from a 3D tensor to a 2D tensor. Re-shapes are normally free on</span></span><br><span class="line">  <span class="comment"># the GPU/CPU but may not be free on the TPU, so we want to minimize them to</span></span><br><span class="line">  <span class="comment"># help the optimizer.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [batch_size*seq_length,input_width]</span></span><br><span class="line">  <span class="comment"># input_width=hidden_size</span></span><br><span class="line">  prev_output = reshape_to_matrix(input_tensor)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># listï¼Œæ€»å…±æœ‰num_hidden_layersï¼Œæ¯ä¸€ä¸ªå…ƒç´ çš„ç»´åº¦æ˜¯ï¼š[batch_size*seq_length,hidden_size]</span></span><br><span class="line">  all_layer_outputs = []</span><br><span class="line">  <span class="keyword">for</span> layer_idx <span class="keyword">in</span> range(num_hidden_layers):</span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">"layer_%d"</span> % layer_idx):</span><br><span class="line">      layer_input = prev_output</span><br><span class="line"></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"attention"</span>):</span><br><span class="line">        attention_heads = []</span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">"self"</span>):</span><br><span class="line">          <span class="comment"># [batch_size*seq_length,num_attention_heads*size_per_head]</span></span><br><span class="line">          attention_head = attention_layer(</span><br><span class="line">              from_tensor=layer_input,</span><br><span class="line">              to_tensor=layer_input,</span><br><span class="line">              attention_mask=attention_mask,</span><br><span class="line">              num_attention_heads=num_attention_heads,</span><br><span class="line">              size_per_head=attention_head_size,</span><br><span class="line">              attention_probs_dropout_prob=attention_probs_dropout_prob,</span><br><span class="line">              initializer_range=initializer_range,</span><br><span class="line">              do_return_2d_tensor=<span class="literal">True</span>,</span><br><span class="line">              batch_size=batch_size,</span><br><span class="line">              from_seq_length=seq_length,</span><br><span class="line">              to_seq_length=seq_length)</span><br><span class="line">          attention_heads.append(attention_head)</span><br><span class="line"></span><br><span class="line">        attention_output = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> len(attention_heads) == <span class="number">1</span>:</span><br><span class="line">          attention_output = attention_heads[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">          <span class="comment"># In the case where we have other sequences, we just concatenate</span></span><br><span class="line">          <span class="comment"># them to the self-attention head before the projection.</span></span><br><span class="line">          attention_output = tf.concat(attention_heads, axis=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Run a linear projection of `hidden_size` then add a residual</span></span><br><span class="line">        <span class="comment"># with `layer_input`.</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">"output"</span>):</span><br><span class="line">          <span class="comment"># ç»´åº¦å˜æ¢ï¼Œå˜ä¸ºï¼š[batch_size*seq_length,hidden]</span></span><br><span class="line">          attention_output = tf.layers.dense(</span><br><span class="line">              attention_output,</span><br><span class="line">              hidden_size,</span><br><span class="line">              kernel_initializer=create_initializer(initializer_range))</span><br><span class="line">          <span class="comment"># dropout</span></span><br><span class="line">          attention_output = dropout(attention_output, hidden_dropout_prob)</span><br><span class="line">          <span class="comment"># æ®‹å·®è¿æ¥</span></span><br><span class="line">          attention_output = layer_norm(attention_output + layer_input)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># The activation is only applied to the "intermediate" hidden layer.</span></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"intermediate"</span>):</span><br><span class="line">        <span class="comment"># ä½¿ç”¨geluï¼Œå˜ä¸ºï¼š[batch_size*seq_length,intermediate_size]</span></span><br><span class="line">        intermediate_output = tf.layers.dense(</span><br><span class="line">            attention_output,</span><br><span class="line">            intermediate_size,</span><br><span class="line">            activation=intermediate_act_fn,</span><br><span class="line">            kernel_initializer=create_initializer(initializer_range))</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Down-project back to `hidden_size` then add the residual.</span></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"output"</span>):</span><br><span class="line">        <span class="comment"># æ— æ¿€æ´»å‡½æ•°ï¼Œçº¯çº¿æ€§å˜æ¢ï¼Œå˜ä¸ºï¼š[batch_size*seq_length,hidden_size]</span></span><br><span class="line">        layer_output = tf.layers.dense(</span><br><span class="line">            intermediate_output,</span><br><span class="line">            hidden_size,</span><br><span class="line">            kernel_initializer=create_initializer(initializer_range))</span><br><span class="line">        <span class="comment"># dropout</span></span><br><span class="line">        layer_output = dropout(layer_output, hidden_dropout_prob)</span><br><span class="line">        <span class="comment"># æ®‹å·®è¿æ¥</span></span><br><span class="line">        layer_output = layer_norm(layer_output + attention_output)</span><br><span class="line">        prev_output = layer_output</span><br><span class="line">        <span class="comment"># å­˜å‚¨è¿™ä¸€å±‚çš„ç»“æœ</span></span><br><span class="line">        all_layer_outputs.append(layer_output)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> do_return_all_layers:</span><br><span class="line">    final_outputs = []</span><br><span class="line">    <span class="keyword">for</span> layer_output <span class="keyword">in</span> all_layer_outputs:</span><br><span class="line">      final_output = reshape_from_matrix(layer_output, input_shape)</span><br><span class="line">      final_outputs.append(final_output)</span><br><span class="line">    <span class="keyword">return</span> final_outputs</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    final_output = reshape_from_matrix(prev_output, input_shape)</span><br><span class="line">    <span class="keyword">return</span> final_output</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†embeddingä»¥åŠtransfomerç»™ä¸²èµ·æ¥ï¼Œå¾—åˆ°å®Œæ•´çš„BERTæ¨¡å‹ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertModel</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""BERT model ("Bidirectional Encoder Representations from Transformers").</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Example usage:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  ```python</span></span><br><span class="line"><span class="string">  # Already been converted into WordPiece token ids</span></span><br><span class="line"><span class="string">  input_ids = tf.constant([[31, 51, 99], [15, 5, 0]])</span></span><br><span class="line"><span class="string">  input_mask = tf.constant([[1, 1, 1], [1, 1, 0]])</span></span><br><span class="line"><span class="string">  token_type_ids = tf.constant([[0, 0, 1], [0, 2, 0]])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  config = modeling.BertConfig(vocab_size=32000, hidden_size=512,</span></span><br><span class="line"><span class="string">    num_hidden_layers=8, num_attention_heads=6, intermediate_size=1024)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  model = modeling.BertModel(config=config, is_training=True,</span></span><br><span class="line"><span class="string">    input_ids=input_ids, input_mask=input_mask, token_type_ids=token_type_ids)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  label_embeddings = tf.get_variable(...)</span></span><br><span class="line"><span class="string">  pooled_output = model.get_pooled_output()</span></span><br><span class="line"><span class="string">  logits = tf.matmul(pooled_output, label_embeddings)</span></span><br><span class="line"><span class="string">  ...</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">               config,</span></span></span><br><span class="line"><span class="function"><span class="params">               is_training,</span></span></span><br><span class="line"><span class="function"><span class="params">               input_ids,</span></span></span><br><span class="line"><span class="function"><span class="params">               input_mask=None,</span></span></span><br><span class="line"><span class="function"><span class="params">               token_type_ids=None,</span></span></span><br><span class="line"><span class="function"><span class="params">               use_one_hot_embeddings=False,</span></span></span><br><span class="line"><span class="function"><span class="params">               scope=None)</span>:</span></span><br><span class="line">    <span class="string">"""Constructor for BertModel.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      config: `BertConfig` instance.</span></span><br><span class="line"><span class="string">      is_training: bool. true for training model, false for eval model. Controls</span></span><br><span class="line"><span class="string">        whether dropout will be applied.</span></span><br><span class="line"><span class="string">      input_ids: int32 Tensor of shape [batch_size, seq_length].</span></span><br><span class="line"><span class="string">      input_mask: (optional) int32 Tensor of shape [batch_size, seq_length].</span></span><br><span class="line"><span class="string">      token_type_ids: (optional) int32 Tensor of shape [batch_size, seq_length].</span></span><br><span class="line"><span class="string">      use_one_hot_embeddings: (optional) bool. Whether to use one-hot word</span></span><br><span class="line"><span class="string">        embeddings or tf.embedding_lookup() for the word embeddings.</span></span><br><span class="line"><span class="string">      scope: (optional) variable scope. Defaults to "bert".</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises:</span></span><br><span class="line"><span class="string">      ValueError: The config is invalid or one of the input tensor shapes</span></span><br><span class="line"><span class="string">        is invalid.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    config = copy.deepcopy(config)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_training:</span><br><span class="line">      <span class="comment"># å¦‚æœä¸æ˜¯è®­ç»ƒçš„è¯ï¼Œé‚£ä¹ˆä¸èƒ½ä½¿ç”¨dropoutï¼</span></span><br><span class="line">      config.hidden_dropout_prob = <span class="number">0.0</span></span><br><span class="line">      config.attention_probs_dropout_prob = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    input_shape = get_shape_list(input_ids, expected_rank=<span class="number">2</span>)</span><br><span class="line">    batch_size = input_shape[<span class="number">0</span>]</span><br><span class="line">    seq_length = input_shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> input_mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      input_mask = tf.ones(shape=[batch_size, seq_length], dtype=tf.int32)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> token_type_ids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      token_type_ids = tf.zeros(shape=[batch_size, seq_length], dtype=tf.int32)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(scope, default_name=<span class="string">"bert"</span>):</span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"embeddings"</span>):</span><br><span class="line">        <span class="comment"># Perform embedding lookup on the word ids.</span></span><br><span class="line">        <span class="comment"># è·å–token embeddingï¼Œä»¥åŠembedding table</span></span><br><span class="line">        (self.embedding_output, self.embedding_table) = embedding_lookup(</span><br><span class="line">            input_ids=input_ids,</span><br><span class="line">            vocab_size=config.vocab_size,</span><br><span class="line">            embedding_size=config.hidden_size,</span><br><span class="line">            initializer_range=config.initializer_range,</span><br><span class="line">            word_embedding_name=<span class="string">"word_embeddings"</span>,</span><br><span class="line">            use_one_hot_embeddings=use_one_hot_embeddings)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add positional embeddings and token type embeddings, then layer</span></span><br><span class="line">        <span class="comment"># normalize and perform dropout.</span></span><br><span class="line">        self.embedding_output = embedding_postprocessor(</span><br><span class="line">            input_tensor=self.embedding_output,</span><br><span class="line">            use_token_type=<span class="literal">True</span>,</span><br><span class="line">            token_type_ids=token_type_ids,</span><br><span class="line">            token_type_vocab_size=config.type_vocab_size,</span><br><span class="line">            token_type_embedding_name=<span class="string">"token_type_embeddings"</span>,</span><br><span class="line">            use_position_embeddings=<span class="literal">True</span>,</span><br><span class="line">            position_embedding_name=<span class="string">"position_embeddings"</span>,</span><br><span class="line">            initializer_range=config.initializer_range,</span><br><span class="line">            max_position_embeddings=config.max_position_embeddings,</span><br><span class="line">            dropout_prob=config.hidden_dropout_prob)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"encoder"</span>):</span><br><span class="line">        <span class="comment"># This converts a 2D mask of shape [batch_size, seq_length] to a 3D</span></span><br><span class="line">        <span class="comment"># mask of shape [batch_size, seq_length, seq_length] which is used</span></span><br><span class="line">        <span class="comment"># for the attention scores.</span></span><br><span class="line">        attention_mask = create_attention_mask_from_input_mask(</span><br><span class="line">            input_ids, input_mask)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Run the stacked transformer.</span></span><br><span class="line">        <span class="comment"># `sequence_output` shape = [batch_size, seq_length, hidden_size].</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœdo_return_all_layers=Trueï¼Œè¿”å›ä¸€ä¸ªlistï¼Œå…ƒç´ ä¸ªæ•°æ˜¯num_hidden_layers,</span></span><br><span class="line">        <span class="comment"># æ¯ä¸€ä¸ªå…ƒç´ ç»´åº¦ï¼š[batch_size,seq_length,hidden_size];</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœdo_return_all_layers=Falseï¼Œé‚£ä¹ˆå°±å€¼è¿”å›æœ€é¡¶å±‚çš„layerçš„è¾“å‡ºç»“æœï¼Œ</span></span><br><span class="line">        <span class="comment"># ç»´åº¦æ˜¯ï¼š[batch_size,seq_length,hidden_size]</span></span><br><span class="line">        self.all_encoder_layers = transformer_model(</span><br><span class="line">            input_tensor=self.embedding_output,</span><br><span class="line">            attention_mask=attention_mask,</span><br><span class="line">            hidden_size=config.hidden_size,</span><br><span class="line">            num_hidden_layers=config.num_hidden_layers,</span><br><span class="line">            num_attention_heads=config.num_attention_heads,</span><br><span class="line">            intermediate_size=config.intermediate_size,</span><br><span class="line">            intermediate_act_fn=get_activation(config.hidden_act),</span><br><span class="line">            hidden_dropout_prob=config.hidden_dropout_prob,</span><br><span class="line">            attention_probs_dropout_prob=config.attention_probs_dropout_prob,</span><br><span class="line">            initializer_range=config.initializer_range,</span><br><span class="line">            do_return_all_layers=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># å–åˆ°æœ€é¡¶å±‚çš„ç»“æœï¼Œç»´åº¦æ˜¯ï¼š[batch_size,seq_length,hidden_size]</span></span><br><span class="line">      self.sequence_output = self.all_encoder_layers[<span class="number">-1</span>]</span><br><span class="line">      <span class="comment"># The "pooler" converts the encoded sequence tensor of shape</span></span><br><span class="line">      <span class="comment"># [batch_size, seq_length, hidden_size] to a tensor of shape</span></span><br><span class="line">      <span class="comment"># [batch_size, hidden_size]. This is necessary for segment-level</span></span><br><span class="line">      <span class="comment"># (or segment-pair-level) classification tasks where we need a fixed</span></span><br><span class="line">      <span class="comment"># dimensional representation of the segment.</span></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"pooler"</span>):</span><br><span class="line">        <span class="comment"># We "pool" the model by simply taking the hidden state corresponding</span></span><br><span class="line">        <span class="comment"># to the first token. We assume that this has been pre-trained</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># [batch_size,hidden_size],ç›¸å½“äºæ˜¯poolingæ“ä½œï¼Œæˆ‘ä»¬åªå–ä¸ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸å…³çš„hidden stateï¼</span></span><br><span class="line">        <span class="comment"># ä¸ºä»€ä¹ˆè¦å–ä¸ç¬¬ä¸€ä¸ªtokenç›¸å…³çš„hidden stateï¼Ÿ</span></span><br><span class="line">        <span class="comment"># å› ä¸ºåœ¨BERTä¸­ï¼Œç¬¬ä¸€ä¸ªtokenæ˜¯[CLS]ï¼Œç”¨äºåˆ†ç±»çš„ï¼è¿™ä¸ªå¾ˆé‡è¦ï¼</span></span><br><span class="line"></span><br><span class="line">        first_token_tensor = tf.squeeze(self.sequence_output[:, <span class="number">0</span>:<span class="number">1</span>, :], axis=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># [batch_size,hidden_size]</span></span><br><span class="line">        self.pooled_output = tf.layers.dense(</span><br><span class="line">            first_token_tensor,</span><br><span class="line">            config.hidden_size,</span><br><span class="line">            activation=tf.tanh,</span><br><span class="line">            kernel_initializer=create_initializer(config.initializer_range))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_pooled_output</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.pooled_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_sequence_output</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Gets final hidden layer of encoder.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      float Tensor of shape [batch_size, seq_length, hidden_size] corresponding</span></span><br><span class="line"><span class="string">      to the final hidden of the transformer encoder.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> self.sequence_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_all_encoder_layers</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.all_encoder_layers</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_embedding_output</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Gets output of the embedding lookup (i.e., input to the transformer).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      float Tensor of shape [batch_size, seq_length, hidden_size] corresponding</span></span><br><span class="line"><span class="string">      to the output of the embedding layer, after summing the word</span></span><br><span class="line"><span class="string">      embeddings with the positional embeddings and the token type embeddings,</span></span><br><span class="line"><span class="string">      then performing layer normalization. This is the input to the transformer.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> self.embedding_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_embedding_table</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.embedding_table</span><br></pre></td></tr></table></figure><p>è·å–æœ€é¡¶å±‚çš„[CLS]tokençš„tensorç”¨äºè®­ç»ƒNSPä»»åŠ¡ï¼Œå¦‚æœä¸‹æ¸¸ä»»åŠ¡æ˜¯åˆ†ç±»ä»»åŠ¡çš„è¯ï¼Œæˆ‘ä»¬æœ€ç»ˆä¹Ÿæ˜¯åœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šï¼Œæ¥ä»‹å…¥softmaxæˆ–è€…å…¶ä»–çš„ç»“æ„æ¥åšï¼›æ­¤å¤–ï¼Œè·å–æœ€é¡¶å±‚self-ateention layerçš„è¾“å‡ºç»“æœï¼Œç”¨æ¥è®­ç»ƒMLMä»»åŠ¡ã€‚</p><h3 id="tokenization-py"><a href="#tokenization-py" class="headerlink" title="tokenization.py"></a>tokenization.py</h3><p>tokenizaton.pyæ–‡ä»¶ç”¨æ¥å¯¹åŸå§‹æ–‡æœ¬è¿›è¡Œåˆ†è¯ã€è¯å¹²åŒ–ã€å°å†™ã€å»é™¤ç©ºæ ¼ç­‰ç­‰æ“ä½œï¼Œå¹¶å°†åŸå§‹æ–‡æœ¬å‘é‡åŒ–ã€‚åœ¨è¿™é‡Œï¼Œéœ€è¦ç‰¹åˆ«æä¸€ä¸‹çš„è¯å°±æ˜¯åˆ†è¯è¿™å—ï¼ŒBERTä½¿ç”¨äº†ä¸¤ç§åˆ†è¯ï¼Œé¦–å…ˆå¯¹åŸå§‹æ–‡æœ¬è¿›è¡Œç²—ç²’åº¦çš„åˆ†è¯ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿›è¡Œwordpieceåˆ†è¯ï¼Œå¾—åˆ°æ›´åŠ ç»†ç²’åº¦çš„åˆ†è¯ç»“æœã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆæ˜¯ç²—ç²’åº¦çš„åˆ†è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTokenizer</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""Runs basic tokenization (punctuation splittingæ ‡ç‚¹ç¬¦å·æ‹†åˆ†, lower casing, etc.)."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, do_lower_case=True)</span>:</span></span><br><span class="line">    <span class="string">"""Constructs a BasicTokenizer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      do_lower_case: Whether to lower case the input.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.do_lower_case = do_lower_case</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tokenize</span><span class="params">(self, text)</span>:</span></span><br><span class="line">    <span class="string">"""Tokenizes a piece of text."""</span></span><br><span class="line">    text = convert_to_unicode(text)</span><br><span class="line">    text = self._clean_text(text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This was added on November 1st, 2018 for the multilingual and Chinese</span></span><br><span class="line">    <span class="comment"># models. This is also applied to the English models now, but it doesn't</span></span><br><span class="line">    <span class="comment"># matter since the English models were not trained on any Chinese data</span></span><br><span class="line">    <span class="comment"># and generally don't have any Chinese data in them (there are Chinese</span></span><br><span class="line">    <span class="comment"># characters in the vocabulary because Wikipedia does have some Chinese</span></span><br><span class="line">    <span class="comment"># words in the English Wikipedia.).</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¢åŠ ä¸­æ–‡æ”¯æŒ</span></span><br><span class="line">    text = self._tokenize_chinese_chars(text)</span><br><span class="line"></span><br><span class="line">    orig_tokens = whitespace_tokenize(text)</span><br><span class="line">    split_tokens = []</span><br><span class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> orig_tokens:</span><br><span class="line">      <span class="keyword">if</span> self.do_lower_case:</span><br><span class="line">        token = token.lower()</span><br><span class="line">        token = self._run_strip_accents(token)</span><br><span class="line">      split_tokens.extend(self._run_split_on_punc(token))</span><br><span class="line"></span><br><span class="line">    output_tokens = whitespace_tokenize(<span class="string">" "</span>.join(split_tokens))</span><br><span class="line">    <span class="comment">#è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> output_tokens</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯wordpieceåˆ†è¯ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">WordpieceTokenizeræ˜¯å°†BasicTokenizerçš„ç»“æœè¿›ä¸€æ­¥åšæ›´ç»†ç²’åº¦çš„åˆ‡åˆ†ã€‚</span></span><br><span class="line"><span class="string">åšè¿™ä¸€æ­¥çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†å»é™¤æœªç™»å½•è¯å¯¹æ¨¡å‹æ•ˆæœçš„å½±å“ã€‚</span></span><br><span class="line"><span class="string">è¿™ä¸€è¿‡ç¨‹å¯¹ä¸­æ–‡æ²¡æœ‰å½±å“ï¼Œ</span></span><br><span class="line"><span class="string">å› ä¸ºåœ¨å‰é¢BasicTokenizeré‡Œé¢å·²ç»åˆ‡åˆ†æˆä»¥å­—ä¸ºå•ä½çš„äº†ã€‚</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordpieceTokenizer</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""Runs WordPiece tokenziation."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, unk_token=<span class="string">"[UNK]"</span>, max_input_chars_per_word=<span class="number">200</span>)</span>:</span></span><br><span class="line">    self.vocab = vocab</span><br><span class="line">    self.unk_token = unk_token</span><br><span class="line">    self.max_input_chars_per_word = max_input_chars_per_word <span class="comment"># æ¯ä¸€ä¸ªtokençš„æœ€å¤§å­—ç¬¦æ•°ç›®</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tokenize</span><span class="params">(self, text)</span>:</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨è´ªå¿ƒçš„æœ€å¤§æ­£å‘åŒ¹é…ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ã€‚æ¯”å¦‚å‡è®¾è¾“å…¥æ˜¯â€unaffableâ€ã€‚</span></span><br><span class="line"><span class="string">    æˆ‘ä»¬è·³åˆ°whileå¾ªç¯éƒ¨åˆ†ï¼Œè¿™æ˜¯start=0ï¼Œend=len(chars)=9ï¼Œä¹Ÿå°±æ˜¯å…ˆçœ‹çœ‹unaffableåœ¨ä¸åœ¨è¯å…¸é‡Œï¼Œ</span></span><br><span class="line"><span class="string">    å¦‚æœåœ¨ï¼Œé‚£ä¹ˆç›´æ¥ä½œä¸ºä¸€ä¸ªWordPieceï¼Œ</span></span><br><span class="line"><span class="string">    å¦‚æœä¸å†ï¼Œé‚£ä¹ˆend-=1ï¼Œä¹Ÿå°±æ˜¯çœ‹unaffablåœ¨ä¸åœ¨è¯å…¸é‡Œï¼Œæœ€ç»ˆå‘ç°â€unâ€åœ¨è¯å…¸é‡Œï¼ŒæŠŠunåŠ åˆ°ç»“æœé‡Œã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    æ¥ç€start=2ï¼Œçœ‹affableåœ¨ä¸åœ¨ï¼Œä¸åœ¨å†çœ‹affablï¼Œâ€¦ï¼Œ</span></span><br><span class="line"><span class="string">    æœ€åå‘ç° ##aff åœ¨è¯å…¸é‡Œã€‚</span></span><br><span class="line"><span class="string">    æ³¨æ„ï¼š##è¡¨ç¤ºè¿™ä¸ªè¯æ˜¯æ¥ç€å‰é¢çš„ï¼Œè¿™æ ·ä½¿å¾—WordPieceåˆ‡åˆ†æ˜¯å¯é€†çš„â€”â€”æˆ‘ä»¬å¯ä»¥æ¢å¤å‡ºâ€œçœŸæ­£â€çš„è¯ã€‚</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="string">"""Tokenizes a piece of text into its word pieces.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This uses a greedy longest-match-first algorithm to perform tokenization</span></span><br><span class="line"><span class="string">    using the given vocabulary.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    For example:</span></span><br><span class="line"><span class="string">      input = "unaffable"</span></span><br><span class="line"><span class="string">      output = ["un", "##aff", "##able"]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      text: A single token or whitespace separated tokens. This should have</span></span><br><span class="line"><span class="string">        already been passed through `BasicTokenizer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      A list of wordpiece tokens.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    text = convert_to_unicode(text)</span><br><span class="line"></span><br><span class="line">    output_tokens = []</span><br><span class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> whitespace_tokenize(text):</span><br><span class="line">      chars = list(token)</span><br><span class="line">      <span class="comment"># å¦‚æœå¤§äºè®¾ç½®çš„æ¯ä¸€ä¸ªtokençš„æœ€å¤§å­—ç¬¦æ•°ç›®çš„è¯ï¼Œé‚£ä¹ˆå°±å½“ä½œUNK</span></span><br><span class="line">      <span class="keyword">if</span> len(chars) &gt; self.max_input_chars_per_word:</span><br><span class="line">        output_tokens.append(self.unk_token)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">      is_bad = <span class="literal">False</span></span><br><span class="line">      start = <span class="number">0</span></span><br><span class="line">      sub_tokens = []</span><br><span class="line">      <span class="keyword">while</span> start &lt; len(chars):</span><br><span class="line">        end = len(chars)</span><br><span class="line">        cur_substr = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> start &lt; end:</span><br><span class="line">          substr = <span class="string">""</span>.join(chars[start:end])</span><br><span class="line">          <span class="keyword">if</span> start &gt; <span class="number">0</span>:</span><br><span class="line">            substr = <span class="string">"##"</span> + substr</span><br><span class="line">          <span class="keyword">if</span> substr <span class="keyword">in</span> self.vocab:</span><br><span class="line">            cur_substr = substr</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">          end -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cur_substr <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">          is_bad = <span class="literal">True</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        sub_tokens.append(cur_substr)</span><br><span class="line">        start = end</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> is_bad:</span><br><span class="line">        output_tokens.append(self.unk_token)</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        output_tokens.extend(sub_tokens)</span><br><span class="line">    <span class="keyword">return</span> output_tokens</span><br></pre></td></tr></table></figure><p>å°†è¿™ä¸¤åˆ†è¯è¿›è¡Œç»“åˆï¼Œå¾—åˆ°ç»†ç²’åº¦çš„åˆ†è¯ç»“æœï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FullTokenizer</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""Runs end-to-end tokenziation."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_file, do_lower_case=True)</span>:</span></span><br><span class="line">    self.vocab = load_vocab(vocab_file)</span><br><span class="line">    <span class="comment"># vè¡¨ç¤ºindexï¼Œkè¡¨ç¤ºtokenæœ¬èº«</span></span><br><span class="line">    self.inv_vocab = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> self.vocab.items()&#125;</span><br><span class="line">    self.basic_tokenizer = BasicTokenizer(do_lower_case=do_lower_case)</span><br><span class="line">    self.wordpiece_tokenizer = WordpieceTokenizer(vocab=self.vocab)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tokenize</span><span class="params">(self, text)</span>:</span></span><br><span class="line">    split_tokens = []</span><br><span class="line">    <span class="comment"># è°ƒç”¨BasicTokenizerç²—ç²’åº¦åˆ†è¯</span></span><br><span class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> self.basic_tokenizer.tokenize(text):</span><br><span class="line">       <span class="comment"># è°ƒç”¨WordpieceTokenizerç»†ç²’åº¦åˆ†è¯</span></span><br><span class="line">      <span class="keyword">for</span> sub_token <span class="keyword">in</span> self.wordpiece_tokenizer.tokenize(token):</span><br><span class="line">        split_tokens.append(sub_token)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> split_tokens</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">convert_tokens_to_ids</span><span class="params">(self, tokens)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> convert_by_vocab(self.vocab, tokens)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">convert_ids_to_tokens</span><span class="params">(self, ids)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> convert_by_vocab(self.inv_vocab, ids)</span><br></pre></td></tr></table></figure><h3 id="create-pretraining-data-py"><a href="#create-pretraining-data-py" class="headerlink" title="create_pretraining_data.py"></a>create_pretraining_data.py</h3><p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯åœ¨tokenization.pyçš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºè®­ç»ƒå®ä¾‹ã€‚æˆ‘ä»¬æ¥çœ‹BERTä¸­æ˜¯æ€ä¹ˆå®ç°éšæœºMASKæ“ä½œçš„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_masked_lm_predictions</span><span class="params">(tokens, masked_lm_prob,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 max_predictions_per_seq, vocab_words, rng)</span>:</span></span><br><span class="line">  <span class="string">"""Creates the predictions for the masked LM objective."""</span></span><br><span class="line"></span><br><span class="line">  cand_indexes = []</span><br><span class="line">  <span class="keyword">for</span> (i, token) <span class="keyword">in</span> enumerate(tokens):</span><br><span class="line">    <span class="comment"># [CLS]å’Œ[SEP]ä¸èƒ½ç”¨äºMASK</span></span><br><span class="line">    <span class="keyword">if</span> token == <span class="string">"[CLS]"</span> <span class="keyword">or</span> token == <span class="string">"[SEP]"</span>:</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># Whole Word Masking means that if we mask all of the wordpieces</span></span><br><span class="line">    <span class="comment"># corresponding to an original word. When a word has been split into</span></span><br><span class="line">    <span class="comment"># WordPieces, the first token does not have any marker and any subsequence</span></span><br><span class="line">    <span class="comment"># tokens are prefixed with ##. So whenever we see the ## token, we</span></span><br><span class="line">    <span class="comment"># append it to the previous set of word indexes.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Note that Whole Word Masking does *not* change the training code</span></span><br><span class="line">    <span class="comment"># at all -- we still predict each WordPiece independently, softmaxed</span></span><br><span class="line">    <span class="comment"># over the entire vocabulary.</span></span><br><span class="line">  <span class="comment">#-----------------------------------------whole word masking code-------------------------------------#</span></span><br><span class="line">    <span class="keyword">if</span> (FLAGS.do_whole_word_mask <span class="keyword">and</span> len(cand_indexes) &gt;= <span class="number">1</span> <span class="keyword">and</span></span><br><span class="line">        token.startswith(<span class="string">"##"</span>)):</span><br><span class="line">      cand_indexes[<span class="number">-1</span>].append(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      cand_indexes.append([i])</span><br><span class="line">  <span class="comment">#-----------------------------------------whole word masking code-------------------------------------#</span></span><br><span class="line">  rng.shuffle(cand_indexes)</span><br><span class="line"></span><br><span class="line">  output_tokens = list(tokens)</span><br><span class="line"></span><br><span class="line">  num_to_predict = min(max_predictions_per_seq,</span><br><span class="line">                       max(<span class="number">1</span>, int(round(len(tokens) * masked_lm_prob))))</span><br><span class="line"></span><br><span class="line">  masked_lms = []</span><br><span class="line">  covered_indexes = set()</span><br><span class="line">  <span class="comment">#-----------------------------------------whole word masking code-------------------------------------#</span></span><br><span class="line">  <span class="keyword">for</span> index_set <span class="keyword">in</span> cand_indexes:</span><br><span class="line">    <span class="keyword">if</span> len(masked_lms) &gt;= num_to_predict:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># If adding a whole-word mask would exceed the maximum number of</span></span><br><span class="line">    <span class="comment"># predictions, then just skip this candidate.</span></span><br><span class="line">    <span class="keyword">if</span> len(masked_lms) + len(index_set) &gt; num_to_predict:</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">  <span class="comment">#-----------------------------------------whole word masking code-------------------------------------#</span></span><br><span class="line">    is_any_index_covered = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> index_set:</span><br><span class="line">      <span class="keyword">if</span> index <span class="keyword">in</span> covered_indexes:</span><br><span class="line">        is_any_index_covered = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> is_any_index_covered:</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> index_set:</span><br><span class="line">      covered_indexes.add(index)</span><br><span class="line"></span><br><span class="line">      masked_token = <span class="literal">None</span></span><br><span class="line">      <span class="comment"># 80% of the time, replace with [MASK]</span></span><br><span class="line">      <span class="keyword">if</span> rng.random() &lt; <span class="number">0.8</span>:</span><br><span class="line">        masked_token = <span class="string">"[MASK]"</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#æ³¨æ„ï¼Œè¿™æ˜¯20%çš„å‰50%,æ‰€ä»¥æ˜¯10%ï¼ï¼ï¼</span></span><br><span class="line">        <span class="comment"># 10% of the time, keep original</span></span><br><span class="line">        <span class="keyword">if</span> rng.random() &lt; <span class="number">0.5</span>:</span><br><span class="line">          masked_token = tokens[index]</span><br><span class="line">        <span class="comment"># 10% of the time, replace with random word</span></span><br><span class="line">        <span class="comment">#æ³¨æ„ï¼Œè¿™æ˜¯20%çš„å50%,æ‰€ä»¥æ˜¯10%ï¼ï¼ï¼</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">          masked_token = vocab_words[rng.randint(<span class="number">0</span>, len(vocab_words) - <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">      output_tokens[index] = masked_token</span><br><span class="line"></span><br><span class="line">      masked_lms.append(MaskedLmInstance(index=index, label=tokens[index]))</span><br><span class="line">  <span class="keyword">assert</span> len(masked_lms) &lt;= num_to_predict</span><br><span class="line">  masked_lms = sorted(masked_lms, key=<span class="keyword">lambda</span> x: x.index)</span><br><span class="line"></span><br><span class="line">  masked_lm_positions = []</span><br><span class="line">  masked_lm_labels = []</span><br><span class="line">  <span class="keyword">for</span> p <span class="keyword">in</span> masked_lms:</span><br><span class="line">    masked_lm_positions.append(p.index)</span><br><span class="line">    masked_lm_labels.append(p.label)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (output_tokens, masked_lm_positions, masked_lm_labels)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥è¾“å…¥å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python create_pretraining_data.py \</span><br><span class="line">  --input_file=/Users/codewithzichao/Desktop/programs/bert/sample_text.txt \</span><br><span class="line">  --output_file=/Users/codewithzichao/Desktop/programs/bert/tf_examples.tfrecord \</span><br><span class="line">  --vocab_file=/Users/codewithzichao/Downloads/uncased_L-24_H-1024_A-16/vocab.txt \</span><br><span class="line">  --do_lower_case=True \</span><br><span class="line">  --max_seq_length=128 \</span><br><span class="line">  --max_predictions_per_seq=20 \</span><br><span class="line">  --masked_lm_prob=0.15 \</span><br><span class="line">  --random_seed=12345 \</span><br><span class="line">  --dupe_factor=5</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">I0704 18:10:11.231426 4486237632 create_pretraining_data.py:160] *** Example ***</span><br><span class="line">INFO:tensorflow:tokens: [CLS] and there burst on phil <span class="comment">##am ##mon ' s astonished eyes a vast semi ##ci ##rcle of blue sea [MASK] ring ##ed with palaces and towers [MASK] [SEP] like most of [MASK] fellow gold - seekers , cass was super ##sti [MASK] . [SEP]</span></span><br><span class="line">I0704 18:10:11.231508 4486237632 create_pretraining_data.py:162] tokens: [CLS] and there burst on phil <span class="comment">##am ##mon ' s astonished eyes a vast semi ##ci ##rcle of blue sea [MASK] ring ##ed with palaces and towers [MASK] [SEP] like most of [MASK] fellow gold - seekers , cass was super ##sti [MASK] . [SEP]</span></span><br><span class="line">INFO:tensorflow:input_ids: 101 1998 2045 6532 2006 6316 3286 8202 1005 1055 22741 2159 1037 6565 4100 6895 21769 1997 2630 2712 103 3614 2098 2007 22763 1998 7626 103 102 2066 2087 1997 103 3507 2751 1011 24071 1010 16220 2001 3565 16643 103 1012 102 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">I0704 18:10:11.231609 4486237632 create_pretraining_data.py:172] input_ids: 101 1998 2045 6532 2006 6316 3286 8202 1005 1055 22741 2159 1037 6565 4100 6895 21769 1997 2630 2712 103 3614 2098 2007 22763 1998 7626 103 102 2066 2087 1997 103 3507 2751 1011 24071 1010 16220 2001 3565 16643 103 1012 102 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">INFO:tensorflow:input_mask: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">I0704 18:10:11.231703 4486237632 create_pretraining_data.py:172] input_mask: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">INFO:tensorflow:segment_ids: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">I0704 18:10:11.231793 4486237632 create_pretraining_data.py:172] segment_ids: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">INFO:tensorflow:masked_lm_positions: 10 20 23 27 32 39 42 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">I0704 18:10:11.231858 4486237632 create_pretraining_data.py:172] masked_lm_positions: 10 20 23 27 32 39 42 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">INFO:tensorflow:masked_lm_ids: 22741 1010 2007 1012 2010 2001 20771 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">I0704 18:10:11.231920 4486237632 create_pretraining_data.py:172] masked_lm_ids: 22741 1010 2007 1012 2010 2001 20771 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">INFO:tensorflow:masked_lm_weights: 1.0 1.0 1.0 1.0 1.0 1.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</span><br><span class="line">I0704 18:10:11.231988 4486237632 create_pretraining_data.py:172] masked_lm_weights: 1.0 1.0 1.0 1.0 1.0 1.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</span><br><span class="line">INFO:tensorflow:next_sentence_labels: 1</span><br><span class="line">I0704 18:10:11.232054 4486237632 create_pretraining_data.py:172] next_sentence_labels: 1</span><br><span class="line">INFO:tensorflow:Wrote 60 total instances</span><br><span class="line">I0704 18:10:11.242784 4486237632 create_pretraining_data.py:177] Wrote 60 total instances</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºç»“æœæœ‰ï¼š</p><ul><li>input_idsï¼špaddingä¹‹åçš„tokensï¼›</li><li>input_maskï¼šå¯¹input_idsè¿›è¡Œmaskå¾—åˆ°çš„ç»“æœï¼›</li><li>segment_idsï¼š0è¡¨ç¤ºçš„æ˜¯ç¬¬ä¸€ä¸ªå¥å­ï¼Œ1è¡¨ç¤ºç¬¬äºŒä¸ªå¥å­ï¼Œåé¢çš„0è¡¨ç¤ºpadding</li><li>masked_lm_positionsï¼šè¡¨ç¤ºè¢«éšæœºMASKæ‰çš„tokenåœ¨instanceä¸­çš„ä½ç½®ï¼›</li><li>masked_lm_idsï¼šè¡¨ç¤ºè¢«éšæœºMASKæ‰çš„tokenåœ¨è¯æ±‡è¡¨ä¸­çš„ç¼–ç ï¼›</li><li>masked_lm_weigthsï¼šè¡¨ç¤ºè¢«éšæœºMASKæ‰çš„tokençš„åºåˆ—ï¼Œå…¶ä¸­1è¡¨ç¤ºMASKæ‰çš„tokenæ˜¯åŸå§‹çš„æ–‡æœ¬tokenï¼Œ0è¡¨ç¤ºMASKçš„æ˜¯paddingä¹‹åçš„tokenã€‚</li></ul><p>å½“ç„¶äº†ï¼Œè¾“å…¥çš„æ–‡æœ¬ä¹Ÿæœ‰è¦æ±‚çš„ï¼šä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå¥å­ï¼Œä¸åŒæ–‡ç« ä¹‹é—´è¦éš”ä¸€ä¸ªç©ºè¡Œã€‚</p><h3 id="run-pretraining-py"><a href="#run-pretraining-py" class="headerlink" title="run_pretraining.py"></a>run_pretraining.py</h3><p>è¿™éƒ¨åˆ†æ˜¯å¯¹BERTæ¨¡å‹è¿›è¡Œé¢„è®­ç»ƒã€‚ä¸€èˆ¬æˆ‘ä»¬è¿™éƒ¨åˆ†éƒ½æ˜¯ä¸ç”¨ç®¡çš„ï¼Œç›´æ¥åŠ è½½å·²ç»è®­ç»ƒå¥½çš„BERTæ¨¡å‹æƒé‡å°±å¯ä»¥äº†(ç›´æ¥è®­ç»ƒä¸ªäººåŸºæœ¬ä¸Šä¸å¤ªå¯èƒ½ï¼Œå¤ªè€—é’±äº†ï¼ŒGoogleéƒ½æ˜¯ç”¨å¤šå—TPUè®­ç»ƒäº†å¥½å‡ å¤©ã€‚ã€‚ã€‚)å¤§è‡´çœ‹ä¸€ä¸‹å®ƒçš„ä»£ç ç»“æ„å§ï½</p><p>ç”±äºåœ¨é¢„è®­ç»ƒé˜¶æ®µï¼ŒBERTæ˜¯ä½¿ç”¨MLMä»»åŠ¡ä¸NSPä»»åŠ¡æ¥è¿›è¡Œé¢„è®­ç»ƒçš„ï¼Œæ‰€ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªä»»åŠ¡å§ï½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰MLMä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_masked_lm_output</span><span class="params">(bert_config, input_tensor, output_weights, positions,</span></span></span><br><span class="line"><span class="function"><span class="params">                         label_ids, label_weights)</span>:</span></span><br><span class="line">  <span class="string">"""Get loss and log probs for the masked LM."""</span></span><br><span class="line">  <span class="string">'''</span></span><br><span class="line"><span class="string">  input_tensor:[batch_size,seq_length,hidden_size]ï¼Œæ˜¯transformeræœ€åä¸€å±‚çš„è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="string">  output_weights:[vocab_size,embedding_size] è¯æ±‡è¡¨</span></span><br><span class="line"><span class="string">  '''</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è·å–maskè¯çš„encodeï¼ŒMLM lossåªè®¡ç®—è¢«maskæ‰çš„ä½ç½®çš„ lossï¼</span></span><br><span class="line">  input_tensor = gather_indexes(input_tensor, positions)</span><br><span class="line">  <span class="comment"># ç»´åº¦ï¼š[batch_size*max_pred_pre_seq,hidden_size]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">with</span> tf.variable_scope(<span class="string">"cls/predictions"</span>):</span><br><span class="line">    <span class="comment"># We apply one more non-linear transformation before the output layer.</span></span><br><span class="line">    <span class="comment"># This matrix is not used after pre-training.</span></span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">"transform"</span>):</span><br><span class="line">      <span class="comment"># çº¿æ€§å˜æ¢ï¼Œåœ¨è¾“å‡ºä¹‹å‰æ·»åŠ ä¸€ä¸ªéçº¿æ€§å˜æ¢ï¼Œåªåœ¨é¢„è®­ç»ƒé˜¶æ®µèµ·ä½œç”¨</span></span><br><span class="line">      input_tensor = tf.layers.dense(</span><br><span class="line">          input_tensor,</span><br><span class="line">          units=bert_config.hidden_size,</span><br><span class="line">          activation=modeling.get_activation(bert_config.hidden_act),</span><br><span class="line">          kernel_initializer=modeling.create_initializer(</span><br><span class="line">              bert_config.initializer_range))</span><br><span class="line">      input_tensor = modeling.layer_norm(input_tensor)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The output weights are the same as the input embeddings, but there is</span></span><br><span class="line">    <span class="comment"># an output-only bias for each token.</span></span><br><span class="line">    output_bias = tf.get_variable(</span><br><span class="line">        <span class="string">"output_bias"</span>,</span><br><span class="line">        shape=[bert_config.vocab_size],</span><br><span class="line">        initializer=tf.zeros_initializer())</span><br><span class="line">    <span class="comment"># å¾—åˆ°è¿™ä¸ªbatchä¸‹çš„ç»“æœ</span></span><br><span class="line">    logits = tf.matmul(input_tensor, output_weights, transpose_b=<span class="literal">True</span>)</span><br><span class="line">    logits = tf.nn.bias_add(logits, output_bias)</span><br><span class="line">    <span class="comment"># [batch_size*max_pred_pre_seq,vocab_size]</span></span><br><span class="line">    log_probs = tf.nn.log_softmax(logits, axis=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># label_idsè¡¨ç¤ºmaskæ‰çš„Tokençš„id</span></span><br><span class="line">    <span class="comment"># [batch_size*max_pred_pre_seq]</span></span><br><span class="line">    label_ids = tf.reshape(label_ids, [<span class="number">-1</span>])</span><br><span class="line">    label_weights = tf.reshape(label_weights, [<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># [batch_size*max_pred_pre_seq,vocab_size]</span></span><br><span class="line">    one_hot_labels = tf.one_hot(</span><br><span class="line">        label_ids, depth=bert_config.vocab_size, dtype=tf.float32)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The `positions` tensor might be zero-padded (if the sequence is too</span></span><br><span class="line">    <span class="comment"># short to have the maximum number of predictions). The `label_weights`</span></span><br><span class="line">    <span class="comment"># tensor has a value of 1.0 for every real prediction and 0.0 for the</span></span><br><span class="line">    <span class="comment"># padding predictions.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [batch_size*max_pred_pre_seq]ï¼Œè¿™ä¸ªç›¸å½“äºæŠŠmaskçš„éƒ¨åˆ†ç»™æŠ½å‡ºæ¥,minimize (-log MLE)</span></span><br><span class="line">    per_example_loss = -tf.reduce_sum(log_probs * one_hot_labels, axis=[<span class="number">-1</span>])</span><br><span class="line">    <span class="comment"># scalarï¼Œä¸€ä¸ªbatchçš„lossï¼Œè¿™ä¸ªç›¸å½“äºæŠŠpaddingçš„éƒ¨åˆ†ç»™å»é™¤äº†</span></span><br><span class="line">    numerator = tf.reduce_sum(label_weights * per_example_loss)</span><br><span class="line">    <span class="comment"># scalar</span></span><br><span class="line">    denominator = tf.reduce_sum(label_weights) + <span class="number">1e-5</span></span><br><span class="line">    loss = numerator / denominator <span class="comment"># å¹³å‡loss</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (loss, per_example_loss, log_probs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰NSPä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_sentence_output</span><span class="params">(bert_config, input_tensor, labels)</span>:</span></span><br><span class="line">  <span class="string">"""Get loss and log probs for the next sentence prediction."""</span></span><br><span class="line"></span><br><span class="line">  <span class="string">'''</span></span><br><span class="line"><span class="string">  input_tensor:[batch_size,hidden_size]</span></span><br><span class="line"><span class="string">  '''</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Simple binary classification. Note that 0 is "next sentence" and 1 is</span></span><br><span class="line">  <span class="comment"># "random sentence". This weight matrix is not used after pre-training.</span></span><br><span class="line">  <span class="keyword">with</span> tf.variable_scope(<span class="string">"cls/seq_relationship"</span>):</span><br><span class="line">    <span class="comment"># [2,hidden_size]</span></span><br><span class="line">    output_weights = tf.get_variable(</span><br><span class="line">        <span class="string">"output_weights"</span>,</span><br><span class="line">        shape=[<span class="number">2</span>, bert_config.hidden_size],</span><br><span class="line">        initializer=modeling.create_initializer(bert_config.initializer_range))</span><br><span class="line">    output_bias = tf.get_variable(</span><br><span class="line">        <span class="string">"output_bias"</span>, shape=[<span class="number">2</span>], initializer=tf.zeros_initializer())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># [batch_size,2]</span></span><br><span class="line">    logits = tf.matmul(input_tensor, output_weights, transpose_b=<span class="literal">True</span>)</span><br><span class="line">    logits = tf.nn.bias_add(logits, output_bias)</span><br><span class="line">    log_probs = tf.nn.log_softmax(logits, axis=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    labels = tf.reshape(labels, [<span class="number">-1</span>])</span><br><span class="line">    <span class="comment"># [batch_size,2]</span></span><br><span class="line">    one_hot_labels = tf.one_hot(labels, depth=<span class="number">2</span>, dtype=tf.float32)</span><br><span class="line">    <span class="comment"># minimize (-log MLE)</span></span><br><span class="line">    <span class="comment"># [batch_size]</span></span><br><span class="line">    per_example_loss = -tf.reduce_sum(one_hot_labels * log_probs, axis=<span class="number">-1</span>)</span><br><span class="line">    <span class="comment"># scalar</span></span><br><span class="line">    loss = tf.reduce_mean(per_example_loss)</span><br><span class="line">    <span class="keyword">return</span> (loss, per_example_loss, log_probs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gather_indexes</span><span class="params">(sequence_tensor, positions)</span>:</span></span><br><span class="line">  <span class="string">"""Gathers the vectors at the specific positions over a minibatch."""</span></span><br><span class="line">  sequence_shape = modeling.get_shape_list(sequence_tensor, expected_rank=<span class="number">3</span>)</span><br><span class="line">  batch_size = sequence_shape[<span class="number">0</span>]</span><br><span class="line">  seq_length = sequence_shape[<span class="number">1</span>]</span><br><span class="line">  width = sequence_shape[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">  flat_offsets = tf.reshape(</span><br><span class="line">      tf.range(<span class="number">0</span>, batch_size, dtype=tf.int32) * seq_length, [<span class="number">-1</span>, <span class="number">1</span>])</span><br><span class="line">  flat_positions = tf.reshape(positions + flat_offsets, [<span class="number">-1</span>])</span><br><span class="line">  flat_sequence_tensor = tf.reshape(sequence_tensor,</span><br><span class="line">                                    [batch_size * seq_length, width])</span><br><span class="line">  output_tensor = tf.gather(flat_sequence_tensor, flat_positions)</span><br><span class="line">  <span class="keyword">return</span> output_tensor</span><br></pre></td></tr></table></figure><p>å¯¹äºMLMä»»åŠ¡ï¼Œè¾“å…¥çš„æ˜¯æœ€é¡¶å±‚self-attentionå±‚çš„è¾“å‡ºç»“æœï¼Œç»´åº¦æ˜¯ï¼š<code>[batch_size,seq_length,hidden_size]</code>ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨MLMä¸­ï¼Œæˆ‘ä»¬å…¶å®åªè®¡ç®—è¢«éšæœºMASKæ‰çš„tokençš„lossï¼Œè¿™ä¹Ÿæ˜¯BERTéœ€è¦å¤§é‡çš„è®­ç»ƒæ•°æ®ä»¥åŠæ”¶æ•›æ…¢çš„åŸå› ï¼Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦è®¡ç®—çš„æ˜¯ï¼š<code>[batch_size*max_pred_pre_seq,hidden_size]</code>ï¼Œå…¶ä¸­<code>max_pred_pre_seq</code>è¡¨ç¤ºä¸€ä¸ªå¥å­æœ€å¤šè¢«MASKçš„æ•°ç›®ã€‚å¯¹äºMLM lossçš„è®¡ç®—ï¼Œæˆ‘ä»¬æ˜¯<font face="times new roman"><strong><em>minimize (-log MLE)</em></strong></font>ã€‚</p><p>å¯¹äºNSPä»»åŠ¡ï¼Œè¾“å…¥çš„æ˜¯æœ€é¡¶å±‚çš„[CLS]tokençš„tensorï¼Œç»´åº¦æ˜¯ï¼š<code>[batch_size,hidden_size]</code>ï¼Œç„¶åä½¿ç”¨softmaxè¿›è¡ŒäºŒåˆ†ç±»ã€‚å…³äºNSP lossï¼Œä»ç„¶ä¸MLM lossä¸€æ ·ï¼Œæ˜¯<font face="times new roman"><strong><em>minimize (-log MLE)</em></strong></font>ã€‚</p><p>å®šä¹‰å®Œä¸¤ä¸ªä»»åŠ¡ä¹‹åï¼Œæˆ‘ä»¬å°±éœ€è¦å®šä¹‰æ¨¡å‹ï¼Œæ¥å®Œæˆè®­ç»ƒè¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ¨¡å‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model_fn_builder</span><span class="params">(bert_config, init_checkpoint, learning_rate,</span></span></span><br><span class="line"><span class="function"><span class="params">                     num_train_steps, num_warmup_steps, use_tpu,</span></span></span><br><span class="line"><span class="function"><span class="params">                     use_one_hot_embeddings)</span>:</span></span><br><span class="line">  <span class="string">"""Returns `model_fn` closure for TPUEstimator."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">model_fn</span><span class="params">(features, labels, mode, params)</span>:</span>  <span class="comment"># pylint: disable=unused-argument</span></span><br><span class="line">    <span class="string">"""The `model_fn` for TPUEstimator."""</span></span><br><span class="line"></span><br><span class="line">    tf.logging.info(<span class="string">"*** Features ***"</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> sorted(features.keys()):</span><br><span class="line">      tf.logging.info(<span class="string">"  name = %s, shape = %s"</span> % (name, features[name].shape))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¾“å…¥éƒ¨åˆ†</span></span><br><span class="line">    input_ids = features[<span class="string">"input_ids"</span>] <span class="comment"># paddingåçš„tokens </span></span><br><span class="line">    input_mask = features[<span class="string">"input_mask"</span>] <span class="comment"># å¯¹paddingåçš„tokensè¿›è¡Œmask</span></span><br><span class="line">    segment_ids = features[<span class="string">"segment_ids"</span>] <span class="comment"># segment idï¼Œç”¨æ¥åŒºåˆ†ä¸¤ä¸ªå¥å­</span></span><br><span class="line">    masked_lm_positions = features[<span class="string">"masked_lm_positions"</span>] <span class="comment"># è¢«éšæœºMASKæ‰çš„tokenåœ¨å¥å­ä¸­çš„ä½ç½®</span></span><br><span class="line">    masked_lm_ids = features[<span class="string">"masked_lm_ids"</span>] <span class="comment"># è¢«éšæœºMASKæ‰çš„tokenåœ¨è¯æ±‡è¡¨ä¸­çš„ç¼–ç </span></span><br><span class="line">    masked_lm_weights = features[<span class="string">"masked_lm_weights"</span>] <span class="comment"># åœ¨è¢«éšæœºMASKæ‰çš„tokenä¸­ï¼Œå¦‚æœtokenæ˜¯åŸæœ¬çš„ï¼Œé‚£ä¹ˆä¸º1ï¼Œå¦‚æœMASKçš„æ˜¯paddingï¼Œé‚£ä¹ˆä¸º0</span></span><br><span class="line">    next_sentence_labels = features[<span class="string">"next_sentence_labels"</span>] <span class="comment"># æ˜¯å¦ä¸ºä¸‹ä¸€å¥ï¼Œæ˜¯ä¸º1ï¼Œå¦åˆ™ä¸º0</span></span><br><span class="line"></span><br><span class="line">    is_training = (mode == tf.estimator.ModeKeys.TRAIN)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®ä¾‹åŒ–BERTæ¨¡å‹</span></span><br><span class="line">    model = modeling.BertModel(</span><br><span class="line">        config=bert_config,</span><br><span class="line">        is_training=is_training,</span><br><span class="line">        input_ids=input_ids,</span><br><span class="line">        input_mask=input_mask,</span><br><span class="line">        token_type_ids=segment_ids,</span><br><span class="line">        use_one_hot_embeddings=use_one_hot_embeddings)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—MLMä»»åŠ¡çš„å¹³å‡æŸå¤±(scalar)ï¼ŒbatchæŸå¤±ï¼ˆ[batch_size]ï¼‰ä»¥åŠé¢„æµ‹æ¦‚ç‡çŸ©é˜µ([batch_size*max_pred_pre_seq,vocab_size])</span></span><br><span class="line">    (masked_lm_loss,</span><br><span class="line">     masked_lm_example_loss, masked_lm_log_probs) = get_masked_lm_output(</span><br><span class="line">         bert_config, model.get_sequence_output(), model.get_embedding_table(),</span><br><span class="line">         masked_lm_positions, masked_lm_ids, masked_lm_weights)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—NSPä»»åŠ¡çš„å¹³å‡æŸå¤±(scalar)ï¼ŒbatchæŸå¤±([batch_size])ä»¥åŠé¢„æµ‹æ¦‚ç‡çŸ©é˜µ([batch_size,2])</span></span><br><span class="line">    (next_sentence_loss, next_sentence_example_loss,</span><br><span class="line">     next_sentence_log_probs) = get_next_sentence_output(</span><br><span class="line">         bert_config, model.get_pooled_output(), next_sentence_labels)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ€»çš„æŸå¤±ä¸ºä¸¤è€…ç›¸åŠ </span></span><br><span class="line">    total_loss = masked_lm_loss + next_sentence_loss</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¨¡å‹æ€»çš„å¯è®­ç»ƒå‚æ•°</span></span><br><span class="line">    tvars = tf.trainable_variables()</span><br><span class="line"></span><br><span class="line">    initialized_variable_names = &#123;&#125;</span><br><span class="line">    scaffold_fn = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># å¦‚æœæœ‰ä¹‹å‰ä¿å­˜çš„æ¨¡å‹ï¼Œåˆ™è¿›è¡Œæ¢å¤</span></span><br><span class="line">    <span class="keyword">if</span> init_checkpoint:</span><br><span class="line">      (assignment_map, initialized_variable_names</span><br><span class="line">      ) = modeling.get_assignment_map_from_checkpoint(tvars, init_checkpoint)</span><br><span class="line">      <span class="keyword">if</span> use_tpu:</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">tpu_scaffold</span><span class="params">()</span>:</span></span><br><span class="line">          tf.train.init_from_checkpoint(init_checkpoint, assignment_map)</span><br><span class="line">          <span class="keyword">return</span> tf.train.Scaffold()</span><br><span class="line"></span><br><span class="line">        scaffold_fn = tpu_scaffold</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        tf.train.init_from_checkpoint(init_checkpoint, assignment_map)</span><br><span class="line"></span><br><span class="line">    tf.logging.info(<span class="string">"**** Trainable Variables ****"</span>)</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> tvars:</span><br><span class="line">      init_string = <span class="string">""</span></span><br><span class="line">      <span class="keyword">if</span> var.name <span class="keyword">in</span> initialized_variable_names:</span><br><span class="line">        init_string = <span class="string">", *INIT_FROM_CKPT*"</span></span><br><span class="line">      tf.logging.info(<span class="string">"  name = %s, shape = %s%s"</span>, var.name, var.shape,</span><br><span class="line">                      init_string)</span><br><span class="line"></span><br><span class="line">    output_spec = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> mode == tf.estimator.ModeKeys.TRAIN:</span><br><span class="line">      train_op = optimization.create_optimizer(</span><br><span class="line">          total_loss, learning_rate, num_train_steps, num_warmup_steps, use_tpu)</span><br><span class="line"></span><br><span class="line">      output_spec = tf.contrib.tpu.TPUEstimatorSpec(</span><br><span class="line">          mode=mode,</span><br><span class="line">          loss=total_loss,</span><br><span class="line">          train_op=train_op,</span><br><span class="line">          scaffold_fn=scaffold_fn)</span><br><span class="line">    <span class="keyword">elif</span> mode == tf.estimator.ModeKeys.EVAL:</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">metric_fn</span><span class="params">(masked_lm_example_loss, masked_lm_log_probs, masked_lm_ids,</span></span></span><br><span class="line"><span class="function"><span class="params">                    masked_lm_weights, next_sentence_example_loss,</span></span></span><br><span class="line"><span class="function"><span class="params">                    next_sentence_log_probs, next_sentence_labels)</span>:</span></span><br><span class="line">        <span class="string">"""Computes the loss and accuracy of the model."""</span></span><br><span class="line">        <span class="comment"># è®¡ç®—æŸå¤±ä¸å‡†ç¡®ç‡</span></span><br><span class="line">        masked_lm_log_probs = tf.reshape(masked_lm_log_probs,</span><br><span class="line">                                         [<span class="number">-1</span>, masked_lm_log_probs.shape[<span class="number">-1</span>]])</span><br><span class="line">        <span class="comment"># [batch_size,max_pred_pre_seq]</span></span><br><span class="line">        masked_lm_predictions = tf.argmax(</span><br><span class="line">            masked_lm_log_probs, axis=<span class="number">-1</span>, output_type=tf.int32)</span><br><span class="line">        masked_lm_example_loss = tf.reshape(masked_lm_example_loss, [<span class="number">-1</span>])</span><br><span class="line">        masked_lm_ids = tf.reshape(masked_lm_ids, [<span class="number">-1</span>])</span><br><span class="line">        masked_lm_weights = tf.reshape(masked_lm_weights, [<span class="number">-1</span>])</span><br><span class="line">        <span class="comment"># è®¡ç®—åœ¨æ¯ä¸€ä¸ªä½ç½®ä¸Šçš„å‡†ç¡®ç‡</span></span><br><span class="line">        masked_lm_accuracy = tf.metrics.accuracy(</span><br><span class="line">            labels=masked_lm_ids,</span><br><span class="line">            predictions=masked_lm_predictions,</span><br><span class="line">            weights=masked_lm_weights)</span><br><span class="line">        masked_lm_mean_loss = tf.metrics.mean(</span><br><span class="line">            values=masked_lm_example_loss, weights=masked_lm_weights)</span><br><span class="line"></span><br><span class="line">        next_sentence_log_probs = tf.reshape(</span><br><span class="line">            next_sentence_log_probs, [<span class="number">-1</span>, next_sentence_log_probs.shape[<span class="number">-1</span>]])</span><br><span class="line">        next_sentence_predictions = tf.argmax(</span><br><span class="line">            next_sentence_log_probs, axis=<span class="number">-1</span>, output_type=tf.int32)</span><br><span class="line">        next_sentence_labels = tf.reshape(next_sentence_labels, [<span class="number">-1</span>])</span><br><span class="line">        <span class="comment"># è®¡ç®—åœ¨NSPä»»åŠ¡ä¸Šçš„å‡†ç¡®ç‡</span></span><br><span class="line">        next_sentence_accuracy = tf.metrics.accuracy(</span><br><span class="line">            labels=next_sentence_labels, predictions=next_sentence_predictions)</span><br><span class="line">        next_sentence_mean_loss = tf.metrics.mean(</span><br><span class="line">            values=next_sentence_example_loss)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"masked_lm_accuracy"</span>: masked_lm_accuracy,</span><br><span class="line">            <span class="string">"masked_lm_loss"</span>: masked_lm_mean_loss,</span><br><span class="line">            <span class="string">"next_sentence_accuracy"</span>: next_sentence_accuracy,</span><br><span class="line">            <span class="string">"next_sentence_loss"</span>: next_sentence_mean_loss,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      eval_metrics = (metric_fn, [</span><br><span class="line">          masked_lm_example_loss, masked_lm_log_probs, masked_lm_ids,</span><br><span class="line">          masked_lm_weights, next_sentence_example_loss,</span><br><span class="line">          next_sentence_log_probs, next_sentence_labels</span><br><span class="line">      ])</span><br><span class="line">      output_spec = tf.contrib.tpu.TPUEstimatorSpec(</span><br><span class="line">          mode=mode,</span><br><span class="line">          loss=total_loss,</span><br><span class="line">          eval_metrics=eval_metrics,</span><br><span class="line">          scaffold_fn=scaffold_fn)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">raise</span> ValueError(<span class="string">"Only TRAIN and EVAL modes are supported: %s"</span> % (mode))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output_spec</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> model_fn</span><br></pre></td></tr></table></figure><h3 id="run-classifier-py"><a href="#run-classifier-py" class="headerlink" title="run_classifier.py"></a>run_classifier.py</h3><p>å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨BERTåœ¨è‡ªå·±çš„ä»»åŠ¡ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„å°±æ˜¯run_classifier.pyæ–‡ä»¶ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆæ˜¯å¯¹æ•°æ®å¤„ç†ï¼Œå¯¹äºBERTæ¥è¯´ï¼ŒGoogleå®˜æ–¹å®ç°çš„ä»£ç ä¸­ï¼Œè¾“å…¥æ˜¯from_tensor_slicesï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcessor</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""Base class for data converters for sequence classification data sets."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_train_examples</span><span class="params">(self, data_dir)</span>:</span></span><br><span class="line">    <span class="string">"""Gets a collection of `InputExample`s for the train set."""</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_dev_examples</span><span class="params">(self, data_dir)</span>:</span></span><br><span class="line">    <span class="string">"""Gets a collection of `InputExample`s for the dev set."""</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_test_examples</span><span class="params">(self, data_dir)</span>:</span></span><br><span class="line">    <span class="string">"""Gets a collection of `InputExample`s for prediction."""</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_labels</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Gets the list of labels for this data set."""</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œé‡å†™è¿™å‡ ä¸ªå‡½æ•°å³å¯ã€‚æ•°æ®å¤„ç†å®Œä¹‹åï¼Œæ¥çœ‹çœ‹æ€ä¹ˆæ¥å…¥ä¸‹æ¸¸ä»»åŠ¡ï¼Œä»¥åˆ†ç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_model</span><span class="params">(bert_config, is_training, input_ids, input_mask, segment_ids,</span></span></span><br><span class="line"><span class="function"><span class="params">                 labels, num_labels, use_one_hot_embeddings)</span>:</span></span><br><span class="line">  <span class="string">"""Creates a classification model."""</span></span><br><span class="line">  model = modeling.BertModel(</span><br><span class="line">      config=bert_config,</span><br><span class="line">      is_training=is_training,</span><br><span class="line">      input_ids=input_ids,</span><br><span class="line">      input_mask=input_mask,</span><br><span class="line">      token_type_ids=segment_ids,</span><br><span class="line">      use_one_hot_embeddings=use_one_hot_embeddings)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># In the demo, we are doing a simple classification task on the entire</span></span><br><span class="line">  <span class="comment"># segment.</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># If you want to use the token-level output, use model.get_sequence_output()</span></span><br><span class="line">  <span class="comment"># instead.</span></span><br><span class="line">  <span class="comment"># å¦‚æœæ˜¯ç”¨äºåˆ†ç±»çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä½¿ç”¨æœ€åä¸€å±‚çš„[CLS]çš„å‘é‡ï¼Œç»´åº¦æ˜¯ï¼š[batch_size,hidden_size]</span></span><br><span class="line">  output_layer = model.get_pooled_output()</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># è·å–hidden_size</span></span><br><span class="line">  hidden_size = output_layer.shape[<span class="number">-1</span>].value</span><br><span class="line"></span><br><span class="line">  output_weights = tf.get_variable(</span><br><span class="line">      <span class="string">"output_weights"</span>, [num_labels, hidden_size],</span><br><span class="line">      initializer=tf.truncated_normal_initializer(stddev=<span class="number">0.02</span>))</span><br><span class="line"></span><br><span class="line">  output_bias = tf.get_variable(</span><br><span class="line">      <span class="string">"output_bias"</span>, [num_labels], initializer=tf.zeros_initializer())</span><br><span class="line"></span><br><span class="line">  <span class="keyword">with</span> tf.variable_scope(<span class="string">"loss"</span>):</span><br><span class="line">    <span class="keyword">if</span> is_training:</span><br><span class="line">      <span class="comment"># å¦‚æœæ˜¯è®­ç»ƒçš„è¯ï¼Œé‚£å°±åŠ dropoutï¼</span></span><br><span class="line">      <span class="comment"># I.e., 0.1 dropout</span></span><br><span class="line">      output_layer = tf.nn.dropout(output_layer, keep_prob=<span class="number">0.9</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># çº¿æ€§å˜æ¢ï¼Œç»´åº¦ä¸ºï¼š[batch_size,num_labels]</span></span><br><span class="line">    logits = tf.matmul(output_layer, output_weights, transpose_b=<span class="literal">True</span>)</span><br><span class="line">    logits = tf.nn.bias_add(logits, output_bias)</span><br><span class="line">    <span class="comment"># softmax</span></span><br><span class="line">    probabilities = tf.nn.softmax(logits, axis=<span class="number">-1</span>)</span><br><span class="line">    <span class="comment"># log_softmax,[batch_size,num_labels]</span></span><br><span class="line">    log_probs = tf.nn.log_softmax(logits, axis=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># [batch_size,num_labels]</span></span><br><span class="line">    one_hot_labels = tf.one_hot(labels, depth=num_labels, dtype=tf.float32)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># minimize (-log MLE)</span></span><br><span class="line">    per_example_loss = -tf.reduce_sum(one_hot_labels * log_probs, axis=<span class="number">-1</span>)</span><br><span class="line">    loss = tf.reduce_mean(per_example_loss)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (loss, per_example_loss, logits, probabilities)</span><br></pre></td></tr></table></figure><p>æ¥å…¥ä¸‹æ¸¸ä»»åŠ¡ï¼Œå¾—åˆ°æ•´ä¸ªæ¨¡å‹çš„lossä¹‹åï¼Œç„¶åå°±å¼€å§‹finetuneï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model_fn_builder</span><span class="params">(bert_config, num_labels, init_checkpoint, learning_rate,</span></span></span><br><span class="line"><span class="function"><span class="params">                     num_train_steps, num_warmup_steps, use_tpu,</span></span></span><br><span class="line"><span class="function"><span class="params">                     use_one_hot_embeddings)</span>:</span></span><br><span class="line">  <span class="string">"""Returns `model_fn` closure for TPUEstimator."""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">model_fn</span><span class="params">(features, labels, mode, params)</span>:</span>  <span class="comment"># pylint: disable=unused-argument</span></span><br><span class="line">    <span class="string">"""The `model_fn` for TPUEstimator."""</span></span><br><span class="line"></span><br><span class="line">    tf.logging.info(<span class="string">"*** Features ***"</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> sorted(features.keys()):</span><br><span class="line">      tf.logging.info(<span class="string">"  name = %s, shape = %s"</span> % (name, features[name].shape))</span><br><span class="line"></span><br><span class="line">    input_ids = features[<span class="string">"input_ids"</span>]</span><br><span class="line">    input_mask = features[<span class="string">"input_mask"</span>]</span><br><span class="line">    segment_ids = features[<span class="string">"segment_ids"</span>]</span><br><span class="line">    label_ids = features[<span class="string">"label_ids"</span>]</span><br><span class="line">    is_real_example = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"is_real_example"</span> <span class="keyword">in</span> features:</span><br><span class="line">      is_real_example = tf.cast(features[<span class="string">"is_real_example"</span>], dtype=tf.float32)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      is_real_example = tf.ones(tf.shape(label_ids), dtype=tf.float32)</span><br><span class="line"></span><br><span class="line">    is_training = (mode == tf.estimator.ModeKeys.TRAIN)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºæ¨¡å‹ï¼Œå¾—åˆ°lossï¼Œbatch lossï¼Œlogitsä»¥åŠæ¦‚ç‡é¢„æµ‹çŸ©é˜µ</span></span><br><span class="line">    (total_loss, per_example_loss, logits, probabilities) = create_model(</span><br><span class="line">        bert_config, is_training, input_ids, input_mask, segment_ids, label_ids,</span><br><span class="line">        num_labels, use_one_hot_embeddings)</span><br><span class="line"></span><br><span class="line">    tvars = tf.trainable_variables()</span><br><span class="line">    initialized_variable_names = &#123;&#125;</span><br><span class="line">    scaffold_fn = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> init_checkpoint:</span><br><span class="line">      (assignment_map, initialized_variable_names</span><br><span class="line">      ) = modeling.get_assignment_map_from_checkpoint(tvars, init_checkpoint)</span><br><span class="line">      <span class="keyword">if</span> use_tpu:</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">tpu_scaffold</span><span class="params">()</span>:</span></span><br><span class="line">          tf.train.init_from_checkpoint(init_checkpoint, assignment_map)</span><br><span class="line">          <span class="keyword">return</span> tf.train.Scaffold()</span><br><span class="line"></span><br><span class="line">        scaffold_fn = tpu_scaffold</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        tf.train.init_from_checkpoint(init_checkpoint, assignment_map)</span><br><span class="line"></span><br><span class="line">    tf.logging.info(<span class="string">"**** Trainable Variables ****"</span>)</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> tvars:</span><br><span class="line">      init_string = <span class="string">""</span></span><br><span class="line">      <span class="keyword">if</span> var.name <span class="keyword">in</span> initialized_variable_names:</span><br><span class="line">        init_string = <span class="string">", *INIT_FROM_CKPT*"</span></span><br><span class="line">      tf.logging.info(<span class="string">"  name = %s, shape = %s%s"</span>, var.name, var.shape,</span><br><span class="line">                      init_string)</span><br><span class="line"></span><br><span class="line">    output_spec = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># è®­ç»ƒæ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> mode == tf.estimator.ModeKeys.TRAIN:</span><br><span class="line">      </span><br><span class="line">      train_op = optimization.create_optimizer(</span><br><span class="line">          total_loss, learning_rate, num_train_steps, num_warmup_steps, use_tpu)</span><br><span class="line"></span><br><span class="line">      output_spec = tf.contrib.tpu.TPUEstimatorSpec(</span><br><span class="line">          mode=mode,</span><br><span class="line">          loss=total_loss,</span><br><span class="line">          train_op=train_op,</span><br><span class="line">          scaffold_fn=scaffold_fn)</span><br><span class="line">    <span class="comment"># è¯„ä¼°æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">elif</span> mode == tf.estimator.ModeKeys.EVAL:</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">metric_fn</span><span class="params">(per_example_loss, label_ids, logits, is_real_example)</span>:</span></span><br><span class="line">        predictions = tf.argmax(logits, axis=<span class="number">-1</span>, output_type=tf.int32)</span><br><span class="line">        accuracy = tf.metrics.accuracy(</span><br><span class="line">            labels=label_ids, predictions=predictions, weights=is_real_example)</span><br><span class="line">        loss = tf.metrics.mean(values=per_example_loss, weights=is_real_example)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"eval_accuracy"</span>: accuracy,</span><br><span class="line">            <span class="string">"eval_loss"</span>: loss,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      eval_metrics = (metric_fn,</span><br><span class="line">                      [per_example_loss, label_ids, logits, is_real_example])</span><br><span class="line">      output_spec = tf.contrib.tpu.TPUEstimatorSpec(</span><br><span class="line">          mode=mode,</span><br><span class="line">          loss=total_loss,</span><br><span class="line">          eval_metrics=eval_metrics,</span><br><span class="line">          scaffold_fn=scaffold_fn)</span><br><span class="line">    <span class="comment"># æµ‹è¯•æ¨¡å¼ï¼Œé¢„æµ‹</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      output_spec = tf.contrib.tpu.TPUEstimatorSpec(</span><br><span class="line">          mode=mode,</span><br><span class="line">          predictions=&#123;<span class="string">"probabilities"</span>: probabilities&#125;,</span><br><span class="line">          scaffold_fn=scaffold_fn)</span><br><span class="line">    <span class="keyword">return</span> output_spec</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> model_fn</span><br></pre></td></tr></table></figure><p>ä¹‹åè¿è¡Œmainå‡½æ•°å°±å¯ä»¥å®Œæˆæ•´ä¸ªè®­ç»ƒäº†ã€‚</p><p>æ•´ä¸ªBERTæ¨¡å‹çš„ä»£ç å°±çœ‹å®Œå•¦ï¼Œè¯»ä¸‹æ¥çš„æ„Ÿå—å°±æ˜¯ï¼šéå¸¸çš„èˆ’çˆ½ï¼Œä¸å¾—ä¸è¯´ï¼ŒGoogleå†™çš„ä»£ç è´¨é‡è¿˜æ˜¯éå¸¸å¥½çš„ï¼Œè™½ç„¶æˆ‘æ“…é•¿çš„æ˜¯tensorflow2.xï¼Œä½†æ˜¯tensorflow1.xçš„ä»£ç è¯»èµ·æ¥è¿˜æ˜¯æ²¡æœ‰ä»€ä¹ˆéšœç¢çš„ã€‚ä¹‹åæœ€å¥½åœ¨è‡ªå·±çš„ä»»åŠ¡ä¸Šä½¿ç”¨BERTæ¥çœ‹çœ‹æ•ˆæœï½é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚éå¿…è¦ï¼Œä»¥åå…³äºå„ç§BERTçš„å˜ä½“æ¨¡å‹å°±ä¸ä¼šè§£è¯»å®ƒçš„æºä»£ç äº†ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç…§æ¬BERTçš„æºç å®ç°ï¼Œç„¶ååœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸Šæˆ–è€…BERTæ¨¡å‹ä¸»ä½“éƒ¨åˆ†çš„å®ç°ä¸Šè¿›è¡Œä¸€äº›æ”¹åŠ¨ï¼Œæ•´ä½“ä¸Šå¤§åŒå°å¼‚ï½</p><p>overï½â˜•ï¸</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> BERT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|è°ˆè°ˆé¢„è®­ç»ƒæ¨¡å‹ä¸­çš„Adapterç»“æ„</title>
      <link href="2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/"/>
      <url>2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åº”è¯¥ä¼šäº§å‡ºå¤§é‡çš„å…³äºé¢„è®­ç»ƒæ¨¡å‹çš„è§£è¯»çš„å†…å®¹ğŸ¤©ï¼Œä¸»è¦æ˜¯ç›®å‰é¢„è®­ç»ƒæ¨¡å‹ç¡®å®åœ¨å‡ ä¹å„ä¸ªä»»åŠ¡ä¸Šçš„è¡¨ç°éƒ½è¶…è¶Šäº†ä¼ ç»Ÿçš„æ¨¡å‹ã€‚å°†é¢„è®­ç»ƒæ¨¡å‹åº”ç”¨äºå„ä¸ªé¢†åŸŸï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¤§çš„è¶‹åŠ¿ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯é€šè¿‡AdapterBERTä¸K-Adapterä¸¤ç¯‡paperï¼Œæ¥è°ˆè°ˆé¢„è®­ç»ƒæ¨¡å‹ä¸­çš„Adapterç»“æ„ã€‚</p><a id="more"></a><h2 id="Adapter-BERT"><a href="#Adapter-BERT" class="headerlink" title="Adapter-BERT"></a>Adapter-BERT</h2><p>Adapter-Bertæ¥æºäºGoogleçš„ã€ŠParameter-Efï¬cient Transfer Learning for NLPã€‹è®ºæ–‡ï¼Œä¸»è¦ç›®çš„åœ¨ä¸é™ä½æ¨¡å‹æ•ˆæœçš„æƒ…å†µä¸‹ï¼Œå‡å°finetuneæ—¶å€™çš„å‚æ•°ã€‚æ„Ÿè§‰å¯¹äºæ— GPUå…šæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ç¦éŸ³ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>é¦–å…ˆè®²è®²ä¸ºä»€ä¹ˆè¦æœ‰Adapter-Bertã€‚åœ¨é¢„è®­ç»ƒæ¨¡å‹ä¸­ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šfeature-basedä»¥åŠfine-tuningã€‚feature-basedæŒ‡çš„æ˜¯é€šè¿‡é¢„è®­ç»ƒæå–å‡ºè¯å‘é‡ï¼Œç„¶åè¾“å…¥åˆ°ä¸‹æ¸¸ä»»åŠ¡å½“ä¸­ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œè¯å‘é‡å¯ä»¥éšä¹‹æ›´æ–°ï¼Œä¹Ÿå¯ä»¥ä¸æ›´æ–°ï¼Œä¾§é‡çš„æ˜¯offlineçš„è¯å‘é‡çš„ç”Ÿæˆï¼Œå…¸å‹ä»£è¡¨æ˜¯ELMï¼›fine-tuningæŒ‡çš„æ˜¯é¦–å…ˆé¢„è®­ç»ƒæ¨¡å‹ï¼Œç„¶åæ¥å…¥ä¸‹æ¸¸ä»»åŠ¡ï¼Œå°†é¢„è®­ç»ƒé˜¶æ®µçš„æƒé‡ä½œä¸ºfinetuningçš„åˆå§‹åŒ–æƒé‡ï¼Œä¹‹åå°†ä¸‹æ¸¸ä»»åŠ¡ä¸é¢„è®­ç»ƒéƒ¨åˆ†ä¸€èµ·è®­ç»ƒï¼Œä¾§é‡çš„æ˜¯co-trainingï¼Œå…¸å‹ä»£è¡¨æ˜¯BERTã€‚ä¸€èˆ¬æ¥è¯´ï¼Œfine-tuningçš„æ•ˆæœè¦æ¯”feature-basedè¦å¥½ä¸€äº›ï¼Œå½“ç„¶è®¡ç®—ä»£ä»·ä¹Ÿè¦æ›´é«˜ä¸€äº›ã€‚ä½†æ˜¯ï¼Œæ€»ä½“è€Œè¨€ï¼Œfinetuningçš„ä»£ä»·å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ¯ä¸€æ¬¡éƒ½è¦æ›´æ–°æ‰€æœ‰çš„å‚æ•°ï¼Œè¿™å¯¹å¾ˆå¤šåº”ç”¨å°¤å…¶æ˜¯ä½èµ„æºä»¥åŠmulti-maskçš„åº”ç”¨åœºæ™¯éå¸¸ä¸å‹å¥½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³è¦å°½å¯èƒ½åœ°å‡å°‘fine-tuningçš„æ‰€éœ€è¦æ›´æ–°çš„å‚æ•°æ•°ç›®ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯å°½å¯èƒ½åœ°é€¼è¿‘fine-tuningæ—¶çš„ç»“æœï¼Œäºæ˜¯ä¾¿æœ‰äº†Adapter-BERTã€‚</p><h3 id="Adapter-BERTæ¨¡å‹æ¶æ„"><a href="#Adapter-BERTæ¨¡å‹æ¶æ„" class="headerlink" title="Adapter-BERTæ¨¡å‹æ¶æ„"></a>Adapter-BERTæ¨¡å‹æ¶æ„</h3><p>Apdater-Bertçš„æƒ³æ³•æ˜¯å°†task-specific layeræ”¾åœ¨é¢„è®­ç»ƒæ¨¡å‹ä¸­é—´ï¼Œä¹Ÿå°±æ˜¯åŠ å…¥Adapterç»“æ„ï¼Œç„¶åå†»ç»“ä½é¢„è®­ç»ƒæ¨¡å‹å‚æ•°ï¼Œæœ€åæˆ‘ä»¬fientuningçš„æ—¶å€™ï¼Œåªæ›´æ–°Apdaterã€layerNormä»¥åŠä¸å…·ä½“ä»»åŠ¡ç›¸å…³çš„layerçš„å‚æ•°ã€‚å…·ä½“ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/Adapter-bert.jpg" alt></p><ul><li><strong>å·¦å›¾</strong>æ˜¯Adapter-BERTä¸­çš„transformer layerï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªtransformer layerå¢åŠ äº†ä¸¤ä¸ªAdapter layerï¼Œåˆ†åˆ«åŠ åœ¨LayerNormä¹‹å‰ï¼Œå½“ç„¶äº†ï¼Œåœ¨è¿›è¡ŒLayerNormä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè®²Apdater layerçš„è¾“å‡ºè¿›è¡Œæ®‹å·®è¿æ¥ã€‚</li><li><strong>å³å›¾</strong>æ˜¯Adapter layerçš„å…·ä½“ç»“æ„ç¤ºæ„ã€‚è¿™ä¸ªå…¶å®è®©æˆ‘æƒ³åˆ°äº†ALBERTä¸­çš„ä½ç§©å› å¼åˆ†è§£ã€‚å‡è®¾è¾“å…¥inputçš„ç»´åº¦æ˜¯$d$ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ä¸€ä¸ªFFNè®©å…¶ç»´åº¦å˜ä¸º$m$ï¼Œä¸”$m&lt;&lt;d$ï¼›ä¹‹åå†é€šè¿‡ä¸€ä¸ªFFNå¾—åˆ°è¾“å‡ºç»“æœouputï¼Œå…¶å…¶ç»´åº¦å˜ä¸º$d$ã€‚æœ€åï¼Œæˆ‘ä»¬è¿›è¡Œæ®‹å·®è¿æ¥ï¼Œå³input+outputä½œä¸ºAdapter layerçš„è¾“å‡ºç»“æœã€‚å¦å¤–ï¼Œåˆ†æä¸€ä¸‹Apdater layerçš„å‚æ•°ï¼Œå¯¹äºä¸€ä¸ªtransformer layeræ¥è¯´ï¼Œå¢åŠ çš„å‚æ•°æ˜¯2*(2dm+d+m+2d+2d)ï¼Œå…¶ä¸­2dè¡¨ç¤ºæ˜¯LNçš„å‚æ•°é‡ï¼Œå¢åŠ çš„å‚æ•°é‡å æ€»çš„å‚æ•°é‡çš„3%ã€‚</li></ul><blockquote><p>æ€è€ƒä¸€ä¸‹ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨æ®‹å·®è¿æ¥ï¼Ÿä¸»è¦æ˜¯å› ä¸ºå½“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæƒé‡éƒ½å¾ˆå°ï¼Œæ®‹å·®è¿æ¥å¯ä»¥ä¿è¯æ¨¡å‹è¾“å‡ºä¸é¢„è®­ç»ƒæ¨¡å‹ç›¸åŒã€‚</p></blockquote><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/ç»“æœ.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼Œè¿˜æ˜¯ä¸é”™çš„ï¼ŒåŸºæœ¬ä¸Šèƒ½æ¥è¿‘fine-tuningçš„ç»“æœã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹Ablationã€‚</p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/Ablation.jpg" alt></p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/LN.jpg" alt></p><p>ä»ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š</p><ul><li>å¯¹äºfine-tuneæ¥è¯´ï¼Œå‡å°è®­ç»ƒçš„å±‚æ•°ä¼šå¤§å¹…é™ä½å‡†ç¡®ç‡ï¼›è€Œå¯¹äºAdapter-basedæ¥è¯´ï¼Œå‡ ä¹æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼›</li><li>Fine-tune layerNormæ²¡æœ‰ä»€ä¹ˆç”¨ã€‚</li></ul><p>ä½œè€…å¦å¤–è¿˜åšäº†å¾ˆå¤šå®éªŒï¼Œä½†æ˜¯å‘ç°åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p><h3 id="ä»£ç éƒ¨åˆ†"><a href="#ä»£ç éƒ¨åˆ†" class="headerlink" title="ä»£ç éƒ¨åˆ†"></a>ä»£ç éƒ¨åˆ†</h3><p>çœ‹å®Œè®ºæ–‡éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»£ç å®ç°éƒ¨åˆ†ã€‚æ•´ä½“ä»£ç æ˜¯åœ¨Googleå®˜æ–¹å‘å¸ƒçš„BERTä»£ç ä¸Šæ”¹çš„ï¼Œå¹¶ä¸”åªä¿®æ”¹äº†æå°çš„ä¸€éƒ¨åˆ†ï¼Œé¦–å…ˆæ˜¯transformeréƒ¨åˆ†ï¼Œåœ¨æ¯ä¸€ä¸ªå­å±‚åŠ ä¸Šäº†Adapter layerã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transformer_model</span><span class="params">(input_tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                      attention_mask=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                      hidden_size=<span class="number">768</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      num_hidden_layers=<span class="number">12</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      num_attention_heads=<span class="number">12</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      intermediate_size=<span class="number">3072</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      intermediate_act_fn=gelu,</span></span></span><br><span class="line"><span class="function"><span class="params">                      hidden_dropout_prob=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      attention_probs_dropout_prob=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      initializer_range=<span class="number">0.02</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      do_return_all_layers=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                      adapter_fn=None)</span>:</span></span><br><span class="line">  <span class="string">"""Multi-headed, multi-layer Transformer from "Attention is All You Need".</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This is almost an exact implementation of the original Transformer encoder.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  See the original paper:</span></span><br><span class="line"><span class="string">  https://arxiv.org/abs/1706.03762</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Also see:</span></span><br><span class="line"><span class="string">  https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/models/transformer.py</span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    float Tensor of shape [batch_size, seq_length, hidden_size], the final</span></span><br><span class="line"><span class="string">    hidden layer of the Transformer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Raises:</span></span><br><span class="line"><span class="string">    ValueError: A Tensor shape or parameter is invalid.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  <span class="keyword">if</span> hidden_size % num_attention_heads != <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(</span><br><span class="line">        <span class="string">"The hidden size (%d) is not a multiple of the number of attention "</span></span><br><span class="line">        <span class="string">"heads (%d)"</span> % (hidden_size, num_attention_heads))</span><br><span class="line"></span><br><span class="line">  attention_head_size = int(hidden_size / num_attention_heads)</span><br><span class="line">  input_shape = get_shape_list(input_tensor, expected_rank=<span class="number">3</span>)</span><br><span class="line">  batch_size = input_shape[<span class="number">0</span>]</span><br><span class="line">  seq_length = input_shape[<span class="number">1</span>]</span><br><span class="line">  input_width = input_shape[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The Transformer performs sum residuals on all layers so the input needs</span></span><br><span class="line">  <span class="comment"># to be the same as the hidden size.</span></span><br><span class="line">  <span class="keyword">if</span> input_width != hidden_size:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"The width of the input tensor (%d) != hidden size (%d)"</span> %</span><br><span class="line">                     (input_width, hidden_size))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># We keep the representation as a 2D tensor to avoid re-shaping it back and</span></span><br><span class="line">  <span class="comment"># forth from a 3D tensor to a 2D tensor. Re-shapes are normally free on</span></span><br><span class="line">  <span class="comment"># the GPU/CPU but may not be free on the TPU, so we want to minimize them to</span></span><br><span class="line">  <span class="comment"># help the optimizer.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [batch_size*seq_length,num_attention_heads*attention_head_size]</span></span><br><span class="line">  prev_output = reshape_to_matrix(input_tensor)</span><br><span class="line"></span><br><span class="line">  all_layer_outputs = []</span><br><span class="line">  <span class="keyword">for</span> layer_idx <span class="keyword">in</span> range(num_hidden_layers):</span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">"layer_%d"</span> % layer_idx):</span><br><span class="line">      layer_input = prev_output</span><br><span class="line"></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"attention"</span>):</span><br><span class="line">        attention_heads = []</span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">"self"</span>):</span><br><span class="line">          attention_head = attention_layer(</span><br><span class="line">              from_tensor=layer_input,</span><br><span class="line">              to_tensor=layer_input,</span><br><span class="line">              attention_mask=attention_mask,</span><br><span class="line">              num_attention_heads=num_attention_heads,</span><br><span class="line">              size_per_head=attention_head_size,</span><br><span class="line">              attention_probs_dropout_prob=attention_probs_dropout_prob,</span><br><span class="line">              initializer_range=initializer_range,</span><br><span class="line">              do_return_2d_tensor=<span class="literal">True</span>,</span><br><span class="line">              batch_size=batch_size,</span><br><span class="line">              from_seq_length=seq_length,</span><br><span class="line">              to_seq_length=seq_length)</span><br><span class="line">          attention_heads.append(attention_head)</span><br><span class="line"></span><br><span class="line">        attention_output = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> len(attention_heads) == <span class="number">1</span>:</span><br><span class="line">          attention_output = attention_heads[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">          <span class="comment"># In the case where we have other sequences, we just concatenate</span></span><br><span class="line">          <span class="comment"># them to the self-attention head before the projection.</span></span><br><span class="line">          attention_output = tf.concat(attention_heads, axis=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Run a linear projection of `hidden_size` then add a residual</span></span><br><span class="line">        <span class="comment"># with `layer_input`.</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">"output"</span>):</span><br><span class="line">          <span class="comment"># [batch_size*seq_length,hidden_size]</span></span><br><span class="line">          attention_output = tf.layers.dense(</span><br><span class="line">              attention_output,</span><br><span class="line">              hidden_size,</span><br><span class="line">              kernel_initializer=create_initializer(initializer_range))</span><br><span class="line">          attention_output = dropout(attention_output, hidden_dropout_prob)</span><br><span class="line">          <span class="keyword">if</span> adapter_fn:</span><br><span class="line">            <span class="comment"># adapterç»“æ„</span></span><br><span class="line">            attention_output = adapter_fn(attention_output)</span><br><span class="line">          attention_output = layer_norm(attention_output + layer_input)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># The activation is only applied to the "intermediate" hidden layer.</span></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"intermediate"</span>):</span><br><span class="line">        intermediate_output = tf.layers.dense(</span><br><span class="line">            attention_output,</span><br><span class="line">            intermediate_size,</span><br><span class="line">            activation=intermediate_act_fn,</span><br><span class="line">            kernel_initializer=create_initializer(initializer_range))</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Down-project back to `hidden_size` then add the residual.</span></span><br><span class="line">      <span class="keyword">with</span> tf.variable_scope(<span class="string">"output"</span>):</span><br><span class="line">        layer_output = tf.layers.dense(</span><br><span class="line">            intermediate_output,</span><br><span class="line">            hidden_size,</span><br><span class="line">            kernel_initializer=create_initializer(initializer_range))</span><br><span class="line">        layer_output = dropout(layer_output, hidden_dropout_prob)</span><br><span class="line">        <span class="keyword">if</span> adapter_fn:</span><br><span class="line">          <span class="comment"># adapter ç»“æ„</span></span><br><span class="line">          layer_output = adapter_fn(layer_output)</span><br><span class="line">        layer_output = layer_norm(layer_output + attention_output)</span><br><span class="line">        prev_output = layer_output</span><br><span class="line">        all_layer_outputs.append(layer_output)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> do_return_all_layers:</span><br><span class="line">    final_outputs = []</span><br><span class="line">    <span class="keyword">for</span> layer_output <span class="keyword">in</span> all_layer_outputs:</span><br><span class="line">      final_output = reshape_from_matrix(layer_output, input_shape)</span><br><span class="line">      final_outputs.append(final_output)</span><br><span class="line">    <span class="keyword">return</span> final_outputs</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># [batch_size,seq_length,hidden_size]</span></span><br><span class="line">    final_output = reshape_from_matrix(prev_output, input_shape)</span><br><span class="line">    <span class="keyword">return</span> final_output</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„Apdater layerä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">feedforward_adapter</span><span class="params">(input_tensor, hidden_size=<span class="number">64</span>, init_scale=<span class="number">1e-3</span>)</span>:</span></span><br><span class="line">  <span class="string">"""A feedforward adapter layer with a bottleneck.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Implements a bottleneck layer with a user-specified nonlinearity and an</span></span><br><span class="line"><span class="string">  identity residual connection. All variables created are added to the</span></span><br><span class="line"><span class="string">  "adapters" collection.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    input_tensor: input Tensor of shape [batch size, hidden dimension]</span></span><br><span class="line"><span class="string">    hidden_size: dimension of the bottleneck layer.</span></span><br><span class="line"><span class="string">    init_scale: Scale of the initialization distribution used for weights.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    Tensor of the same shape as x.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  <span class="string">'''</span></span><br><span class="line"><span class="string">  input_tensor:[batch_size*seq_length,hidden_size]</span></span><br><span class="line"><span class="string">  '''</span></span><br><span class="line">  <span class="keyword">with</span> tf.variable_scope(<span class="string">"adapters"</span>):</span><br><span class="line">    <span class="comment"># in_sizeæ˜¯self-attention layerçš„hidden_sizeï¼Œä¸è¿™é‡Œçš„hidden_sizeä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼</span></span><br><span class="line">    in_size = input_tensor.get_shape().as_list()[<span class="number">1</span>]</span><br><span class="line">    w1 = tf.get_variable(</span><br><span class="line">        <span class="string">"weights1"</span>, [in_size, hidden_size],</span><br><span class="line">        initializer=tf.truncated_normal_initializer(stddev=init_scale),</span><br><span class="line">        collections=[<span class="string">"adapters"</span>, tf.GraphKeys.GLOBAL_VARIABLES])</span><br><span class="line">    b1 = tf.get_variable(</span><br><span class="line">        <span class="string">"biases1"</span>, [<span class="number">1</span>, hidden_size],</span><br><span class="line">        initializer=tf.zeros_initializer(),</span><br><span class="line">        collections=[<span class="string">"adapters"</span>, tf.GraphKeys.GLOBAL_VARIABLES])</span><br><span class="line">    <span class="comment"># [batch_size*seq_length,hidden_size]</span></span><br><span class="line">    net = tf.tensordot(input_tensor, w1, [[<span class="number">1</span>], [<span class="number">0</span>]]) + b1</span><br><span class="line"></span><br><span class="line">    net = gelu(net)</span><br><span class="line"></span><br><span class="line">    w2 = tf.get_variable(</span><br><span class="line">        <span class="string">"weights2"</span>, [hidden_size, in_size],</span><br><span class="line">        initializer=tf.truncated_normal_initializer(stddev=init_scale),</span><br><span class="line">        collections=[<span class="string">"adapters"</span>, tf.GraphKeys.GLOBAL_VARIABLES])</span><br><span class="line">    b2 = tf.get_variable(</span><br><span class="line">        <span class="string">"biases2"</span>, [<span class="number">1</span>, in_size],</span><br><span class="line">        initializer=tf.zeros_initializer(),</span><br><span class="line">        collections=[<span class="string">"adapters"</span>, tf.GraphKeys.GLOBAL_VARIABLES])</span><br><span class="line">    <span class="comment"># [batch_size*seq_length,in_size]</span></span><br><span class="line">    net = tf.tensordot(net, w2, [[<span class="number">1</span>], [<span class="number">0</span>]]) + b2</span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ®‹å·®è¿æ¥</span></span><br><span class="line">  <span class="keyword">return</span> net + input_tensor</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ¨¡å‹éƒ¨åˆ†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¿®æ”¹çš„éƒ¨åˆ†æ˜¯ï¼šæˆ‘ä»¬åœ¨fine-tuneçš„æ—¶å€™ï¼Œè¦å†»ç»“åŸæ¥çš„é¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°ï¼Œåªæ›´æ–°æ–°åŠ çš„éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†ä»£ç åœ¨optimization.pyæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_optimizer</span><span class="params">(loss, init_lr, num_train_steps, num_warmup_steps, use_tpu)</span>:</span></span><br><span class="line">  <span class="string">"""Creates an optimizer training op."""</span></span><br><span class="line">  global_step = tf.train.get_or_create_global_step()</span><br><span class="line"></span><br><span class="line">  learning_rate = tf.constant(value=init_lr, shape=[], dtype=tf.float32)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Implements linear decay of the learning rate.</span></span><br><span class="line">  learning_rate = tf.train.polynomial_decay(</span><br><span class="line">      learning_rate,</span><br><span class="line">      global_step,</span><br><span class="line">      num_train_steps,</span><br><span class="line">      end_learning_rate=<span class="number">0.0</span>,</span><br><span class="line">      power=<span class="number">1.0</span>,</span><br><span class="line">      cycle=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Implements linear warmup. I.e., if global_step &lt; num_warmup_steps, the</span></span><br><span class="line">  <span class="comment"># learning rate will be `global_step/num_warmup_steps * init_lr`.</span></span><br><span class="line">  <span class="keyword">if</span> num_warmup_steps:</span><br><span class="line">    global_steps_int = tf.cast(global_step, tf.int32)</span><br><span class="line">    warmup_steps_int = tf.constant(num_warmup_steps, dtype=tf.int32)</span><br><span class="line"></span><br><span class="line">    global_steps_float = tf.cast(global_steps_int, tf.float32)</span><br><span class="line">    warmup_steps_float = tf.cast(warmup_steps_int, tf.float32)</span><br><span class="line"></span><br><span class="line">    warmup_percent_done = global_steps_float / warmup_steps_float</span><br><span class="line">    warmup_learning_rate = init_lr * warmup_percent_done</span><br><span class="line"></span><br><span class="line">    is_warmup = tf.cast(global_steps_int &lt; warmup_steps_int, tf.float32)</span><br><span class="line">    learning_rate = (</span><br><span class="line">        (<span class="number">1.0</span> - is_warmup) * learning_rate + is_warmup * warmup_learning_rate)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># It is recommended that you use this optimizer for fine tuning, since this</span></span><br><span class="line">  <span class="comment"># is how the model was trained (note that the Adam m/v variables are NOT</span></span><br><span class="line">  <span class="comment"># loaded from init_checkpoint.)</span></span><br><span class="line">  optimizer = AdamWeightDecayOptimizer(</span><br><span class="line">      learning_rate=learning_rate,</span><br><span class="line">      weight_decay_rate=<span class="number">0.01</span>,</span><br><span class="line">      adapter_weight_decay_rate=<span class="number">0.01</span>,</span><br><span class="line">      beta_1=<span class="number">0.9</span>,</span><br><span class="line">      beta_2=<span class="number">0.999</span>,</span><br><span class="line">      epsilon=<span class="number">1e-6</span>,</span><br><span class="line">      exclude_from_weight_decay=[<span class="string">"LayerNorm"</span>, <span class="string">"layer_norm"</span>, <span class="string">"bias"</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> use_tpu:</span><br><span class="line">    optimizer = tf.contrib.tpu.CrossShardOptimizer(optimizer)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------åªæ›´æ–°åæ¥æ–°å¢çš„å‚æ•°-------------------------------#</span></span><br><span class="line"></span><br><span class="line">  tvars = []</span><br><span class="line">  <span class="keyword">for</span> collection <span class="keyword">in</span> [<span class="string">"adapters"</span>, <span class="string">"layer_norm"</span>, <span class="string">"head"</span>]:</span><br><span class="line">    tvars += tf.get_collection(collection)</span><br><span class="line">  grads = tf.gradients(loss, tvars)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># This is how the model was pre-trained.</span></span><br><span class="line">  (grads, _) = tf.clip_by_global_norm(grads, clip_norm=<span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">  train_op = optimizer.apply_gradients(</span><br><span class="line">      zip(grads, tvars), global_step=global_step)</span><br><span class="line">  </span><br><span class="line"><span class="comment">#--------------------åªæ›´æ–°åæ¥æ–°å¢çš„å‚æ•°-------------------------------#</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Normally the global step update is done inside of `apply_gradients`.</span></span><br><span class="line">  <span class="comment"># However, `AdamWeightDecayOptimizer` doesn't do this. But if you use</span></span><br><span class="line">  <span class="comment"># a different optimizer, you should probably take this line out.</span></span><br><span class="line">  new_global_step = global_step + <span class="number">1</span></span><br><span class="line">  train_op = tf.group(train_op, [global_step.assign(new_global_step)])</span><br><span class="line">  <span class="keyword">return</span> train_op</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼ŒAdapter-BERTçš„è®ºæ–‡é¢„ä»£ç éƒ¨åˆ†éƒ½è®²å®Œäº†â˜•ï¸ï½</p><h2 id="K-Adapter"><a href="#K-Adapter" class="headerlink" title="K-Adapter"></a>K-Adapter</h2><p>K-Adapteræ¨¡å‹æ¥æºäºMSRAçš„ã€ŠK-A DAPTER: Infusing Knowledge into Pre-Trained Models with Adaptersã€‹è®ºæ–‡ã€‚å®ƒæ‰€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼šåœ¨é¢„è®­ç»ƒæ¨¡å‹ä¸­åµŒå…¥çŸ¥è¯†æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå½“å‰çš„é¢„è®­ç»ƒæ¨¡å‹æ— æ³•å­¦ä¹ åˆ°éå¸¸çš„çŸ¥è¯†ä¿¡æ¯ï¼›æ­¤å¤–ï¼Œåœ¨è®­ç»ƒmulti-taskæ—¶ï¼Œä¼šå‡ºç°ç¾éš¾æ€§é—å¿˜é—®é¢˜ï¼Œæ‰€è°“çš„ç¾éš¾æ€§é—å¿˜é—®é¢˜æŒ‡çš„æ˜¯ï¼šåŒä¸€ä¸ªæ¨¡å‹ï¼Œåœ¨å­¦ä¹ å®Œä¸€ä¸ªtaskä¹‹åï¼Œå¦‚æœå†å­¦ä¹ æ–°çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆåœ¨åŸå…ˆçš„taskä¸Šå­¦ä¹ åˆ°çš„æƒé‡ä¼šè¢«å®Œå…¨ç ´åæ‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è§£å†³ç¾éš¾æ€§é—å¿˜çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°æŒç»­å­¦ä¹ ã€‚åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼ŒK-Adapteré¢„è®­ç»ƒæ¨¡å‹è¢«æå‡ºæ¥äº†ã€‚</p><h3 id="K-Adapteræ¨¡å‹æ¶æ„"><a href="#K-Adapteræ¨¡å‹æ¶æ„" class="headerlink" title="K-Adapteræ¨¡å‹æ¶æ„"></a>K-Adapteræ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆæ”¾ä¸€ä¸‹K-Adapteré¢„è®­ç»ƒæ¨¡å‹çš„æ¶æ„å›¾å§ï½</p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/K-Adapter total.jpg" alt></p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/adapter.jpg" alt></p><p>ç¬¬ä¸€å¼ å›¾ä¸­çš„aéƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯ä¼ ç»Ÿçš„multi-task learningï¼Œbéƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯ä½¿ç”¨äº†K-Adapterç»“æ„ä¹‹åçš„æ•´ä½“æ¨¡å‹ï¼›ç¬¬äºŒå¼ å›¾è¡¨ç¤ºçš„æ˜¯Adapter layerã€‚ä¸‹é¢ç€é‡è®²è®²Adapter layerçš„æ„æˆä»¥åŠæ¨¡å‹æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ç”±äºè¿™ç¯‡paperæ²¡æœ‰æ”¾å‡ºæºä»£ç (éƒ½0202å¹´ï¼Œå±…ç„¶è¿˜æœ‰paperä¸æ”¾æºä»£ç ğŸ¤·â€â™‚ï¸)ï¼Œæ‰€ä»¥æ•´ä½“å†…å®¹çš„ç†è§£åªèƒ½ä»è®ºæ–‡æ¥è·å¾—ã€‚</p><ul><li><p>æ•´ç¯‡paperæ˜¯ä»¥RoBERTaé¢„è®­ç»ƒæ¨¡å‹ä½œä¸ºåŸºå‡†ï¼Œæ¥è¿›è¡Œè®¾è®¡çš„ï¼›</p></li><li><p>ä»æ•´ä½“æ¥çœ‹ï¼Œåœ¨ä½¿ç”¨äº†K-Adapterç»“æ„çš„æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬æ˜¯å°†Adapterç»“æ„ç‹¬ç«‹å‡ºæ¥ï¼Œä¸pre-train modelå¹³è¡Œæ“ä½œï¼›æ­¤å¤–ï¼Œä¹Ÿä¸æ˜¯æ¯ä¸€ä¸ªtransformer layeréƒ½é…æœ‰Adapterï¼Œåœ¨è¿™ç¯‡paperé‡Œé¢ï¼Œ æ˜¯åœ¨RoBERTa Large çš„ç¬¬ 0, 11, 23 å±‚ä¹‹åå¢åŠ æœ‰ Adapter å±‚ï¼›</p></li><li>å¯¹äºæ¯ä¸€ç§çŸ¥è¯†ï¼Œæˆ‘ä»¬éƒ½å»è®¾è®¡ä¸€ä¸ªå¯¹åº”çš„Adapterï¼Œå³æ‰€æœ‰çš„Apdateréƒ½æ˜¯knowledge-specificçš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸€ç§knowledgeäº§ç”Ÿçš„representationéƒ½ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œä»è€Œè§£å†³äº†å¤šä»»åŠ¡å­¦ä¹ ä¸­çš„ç¾éš¾æ€§é—å¿˜çš„é—®é¢˜ï¼›</li><li>å½“æˆ‘ä»¬åªåµŒå…¥ä¸€ç§çŸ¥è¯†çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¾“å‡ºåˆ°task-specific layerçš„æ˜¯knowledge-specific adapteræœ€åä¸€å±‚çš„è¾“å‡º(æœ€åä¸€å±‚çš„è¾“å‡ºæ˜¯pre-train modelçš„è¾“å‡ºä¸adapterçš„è¾“å‡ºçš„concatenation)ï¼›å½“æˆ‘ä»¬åµŒå…¥å¤šä¸ªçŸ¥è¯†çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¾“å‡ºåˆ°task-specific layerçš„æ˜¯æ‰€æœ‰knowledge-specific adaptersæœ€åä¸€å±‚çš„è¾“å‡ºçš„concatenationï¼›</li><li>å¯¹äºå•ä¸ª adapter layerï¼Œå®ƒçš„è¾“å…¥æ˜¯ï¼špre-train modelä¸­å½“å‰transformerå±‚çš„è¾“å‡ºç»“æœä¸ä¸Šä¸€ä¸ªadapter layerè¾“å‡ºç»“æœçš„concatenationï¼›ç„¶åè¾“å…¥åˆ°ä¸€ä¸ªæŠ•å½±å±‚ï¼Œå³çº¿æ€§å˜æ¢ï¼Œç„¶åå†ç»è¿‡è‹¥å¹²ä¸ªtransformer layer(è®ºæ–‡æ˜¯2ä¸ª)ï¼Œç„¶åä½¿ç”¨æ®‹å·®è¿æ¥ï¼Œå°†æœ€åˆçš„è¾“å…¥ä¸ç»è¿‡å¤šä¸ªtransformer layerè¾“å‡ºç»“æœè¿›è¡Œconcatenationï¼Œä½œä¸ºè¿™ä¸ªadapter layerçš„è¾“å‡ºç»“æœï¼›</li><li>è¿™ç¯‡paperä½¿ç”¨äº†ä¸¤ç§Adapterï¼šfactual Adapterä¸linguistic Adapterã€‚factual Adapter è®­ç»ƒä¸€ä¸ªå…³ç³»åˆ†ç±»(relation classification)ä»»åŠ¡ã€‚é€šè¿‡åˆ¤æ–­ä¸‰å…ƒç»„ä¸­ entity æ˜¯å¦å­˜åœ¨ç›¸åº”å…³ç³»æ¥å­¦ä¹ å…³ç³»çš„çŸ¥è¯†ã€‚æ•°æ®é›†æ˜¯è¿‡æ»¤ entity å‡ºç°å°äº 50 æ¬¡çš„ T-RE-rc. å› ä¸º Entity é•¿åº¦ä¸ä¸€ï¼Œåˆ©ç”¨ Pooling æ¥å¯¹é½. è¯¥ä»»åŠ¡è®­ç»ƒ 5epochs, Batch size ä¸º 128ï¼›linguistic Adapter åˆ™æ˜¯å®Œæˆé¢„æµ‹ä¾å­˜å…³ç³»ä¸­çˆ¶èŠ‚ç‚¹ index è¿™ä¸ªä»»åŠ¡ã€‚æ•°æ®é›†æ˜¯åˆ©ç”¨ Stanford Parser æ ‡æ³¨çš„ Book Corpusã€‚å› ä¸ºæ˜¯ token-level çš„ä»»åŠ¡ï¼Œæœ€åè¿‡ä¸€ä¸ªçº¿æ€§å±‚è¾“å‡ºåˆ°ç›¸åº”çš„åˆ†ç±»ã€‚è¯¥ä»»åŠ¡è®­ç»ƒ 10epochs, Batch size ä¸º 256ï¼›</li><li>åœ¨é¢„è®­ç»ƒçš„æ—¶å€™ï¼Œpre-trained modelæ˜¯frozençš„ï¼Œåªè®­ç»ƒAdapterç»“æ„ï¼›ä½†æ˜¯åœ¨fine-tuneçš„æ—¶å€™ï¼Œè¿˜æ˜¯å’ŒBERTä¸€æ ·ï¼Œpre-trained modelã€æ‰€æœ‰çš„Adapterç»“æ„ä»¥åŠtask-specific layerä¸€èµ·è¿›è¡Œå‚æ•°çš„æ›´æ–°ï¼›</li><li>ä¸Adapter-BERTç›¸æ¯”ï¼ŒK-Adapteræ›´åŠ ä¾§é‡äºå¯¹äºå¤šknowlwdgeçš„å¤„ç†ä»¥åŠç¾éš¾æ€§é—å¿˜çš„é—®é¢˜ï¼Œè€ŒAdapter-BERTæ›´åŠ ä¾§é‡äºfine-tuneé˜¶æ®µå‚æ•°çš„å‡å°‘ã€‚</li></ul><h3 id="å®éªŒç»“æœ-1"><a href="#å®éªŒç»“æœ-1" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p>é¦–å…ˆå®ƒå¯¹æ¯”äº†å¤šä¸ªçŸ¥è¯†åµŒå…¥çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘è§‰å¾—è¿˜æŒºå¥½çš„ï¼Œå¦‚æœä¹‹ååœ¨çŸ¥è¯†åµŒå…¥åšæ–‡ç« çš„è¯ï¼Œè¿™é‡Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå°ç»“ï½</p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/some embedding models.jpg" alt></p><p>ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®éªŒç»“æœï½</p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/K-adapter-result.jpg" alt></p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/K-adapter-result2.jpg" alt></p><p><img src="/2020/07/02/NLP-%E8%B0%88%E8%B0%88BERT%E4%B8%AD%E7%9A%84Adapter%E7%BB%93%E6%9E%84/K-adapter-result3.jpg" alt></p><p>ä¸Šé¢ä¸‰å¼ å›¾åˆ†åˆ«æ˜¯åœ¨ï¼šç»†ç²’åº¦å®ä½“ç±»å‹é¢„æµ‹ä»»åŠ¡ã€å¸¸è¯†QAä¸å¼€æ”¾åŸŸQAä»»åŠ¡ã€å…³ç³»åˆ†ç±»ä»»åŠ¡ä¸Šçš„ç»“æœï¼Œæ€»çš„æ¥è¯´ï¼Œé‡‡ç”¨Adapterç»“æ„çš„é¢„è®­ç»ƒæ¨¡å‹çš„æ•ˆæœç¡®å®æœ‰æ‰€æå‡ï½</p><p>ä»¥ä¸Šå°±æ˜¯é¢„è®­ç»ƒAdapterç»“æ„çš„å†…å®¹å•¦ï¼Œä¹‹åå¯èƒ½ä¼šå†å…³æ³¨ä¸€ä¸‹çŸ¥è¯†åµŒå…¥çš„é¢„è®­ç»ƒæ¨¡å‹å§ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§çš„æ–¹å‘ï¼Œæ„Ÿè§‰ç›®å‰è¿˜æ˜¯æœ‰æå¤´çš„ï¼Œoverâ˜•ï¸ï½</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> AdapterBERT </tag>
            
            <tag> K-Adapter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|ELECTRAé¢„è®­ç»ƒæ¨¡å‹</title>
      <link href="2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹GANç›¸å…³çš„å†…å®¹çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¸€ç¯‡å…³äºé¢„è®­ç»ƒæ¨¡å‹çš„æ–°ä½œï¼šELECTRAï¼Œæ ¸å¿ƒæ˜¯å°†GANçš„æ€æƒ³å¼•å…¥åˆ°NLPä¸­ï¼Œéå¸¸åœ°æ–°é¢–ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« å°†å…·ä½“åœ°è®²è§£ä¸€ä¸‹å…³äºELECTRAçš„å†…å®¹ï¼Œæˆ‘ä¸ªäººæ˜¯å¾ˆå–œæ¬¢è¿™æ ·ç²¾å·§ä¸”ä¼˜é›…çš„æ–‡ç« çš„ï½ğŸ¤©</p><a id="more"></a><p>ELECTRAæ¨¡å‹æ˜¯ä»Šå¹´googleåœ¨ICLRä¸Šæ”¾å‡ºçš„ä¸€ç¯‡è®ºæ–‡ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†GANå¼•å…¥åˆ°NLPä¸­ï¼Œä½†æ˜¯å®ƒæ‰€ä½¿ç”¨çš„Generatorä¸Discriminatorä¸GANä¸­çš„ä¼šç¨å¾®ä¸åŒï¼Œé€šè¿‡è®¾è®¡æ–°çš„é¢„è®­ç»ƒä»»åŠ¡ï¼Œä»è€Œå¤§å¹…æå‡BERTçš„è®­ç»ƒæ•ˆç‡ï¼ŒèŠ‚çœç®—åŠ›ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï½</p><h2 id="ELECTRAè¦è§£å†³çš„é—®é¢˜"><a href="#ELECTRAè¦è§£å†³çš„é—®é¢˜" class="headerlink" title="ELECTRAè¦è§£å†³çš„é—®é¢˜"></a>ELECTRAè¦è§£å†³çš„é—®é¢˜</h2><p>BERTå·²ç»è¢«è¯æ˜æ•ˆæœåœ¨å¤šä¸ªè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­è¡¨ç°è‰¯å¥½ï¼Œä½†æ˜¯BERTä¹Ÿå­˜åœ¨éå¸¸å¤§çš„é—®é¢˜ï¼šéœ€è¦å¤§é‡çš„è®­ç»ƒæ•°æ®ä¸ç®—åŠ›ã€‚å¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› åœ¨äºï¼šMLMä»»åŠ¡ã€‚åœ¨MLMä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æ˜¯å»MASKæ‰15%çš„tokensï¼Œå†åˆ©ç”¨ä¸Šä¸‹æ–‡æ¥é¢„æµ‹è¢«MASKæ‰çš„tokensï¼Œè¿™æ ·çš„è¯ï¼Œåªæœ‰15%çš„tokensè¢«ç”¨æ¥è®­ç»ƒï¼Œå¯¼è‡´äº†BERTçš„è®­ç»ƒéå¸¸çš„æ…¢ï¼Œå¹¶ä¸”ä¹Ÿéœ€è¦å¤§é‡çš„è®­ç»ƒæ•°æ®æ‰èƒ½å°†BERTè®­ç»ƒçš„éå¸¸å¥½ã€‚æ­¤å¤–ï¼ŒMASKæ ‡ç­¾ï¼Œä¹Ÿä¼šä½¿å¾—ä¹Ÿæ­£æ˜¯è¿™ä¸ªåŸå› ï¼Œä»BERTåˆ°T5ï¼Œå†åˆ°GPT3ï¼Œéšç€é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœè¶Šæ¥è¶Šå¥½çš„åŒæ—¶ï¼Œæ¨¡å‹ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚è€Œä½œè€…å¸Œæœ›èƒ½å¤Ÿåœ¨ä¸é™ä½æ¨¡å‹æ•ˆæœçš„æƒ…å†µä¸‹ï¼Œå»å‡å°æ¨¡å‹çš„å¤§å°ä»¥åŠæ‰€éœ€çš„ç®—åŠ›ã€‚äºæ˜¯ï¼Œä¾¿æå‡ºæ¥äº†ELECTRAæ¨¡å‹ã€‚</p><h2 id="ELECTRAæ¨¡å‹æ¶æ„"><a href="#ELECTRAæ¨¡å‹æ¶æ„" class="headerlink" title="ELECTRAæ¨¡å‹æ¶æ„"></a>ELECTRAæ¨¡å‹æ¶æ„</h2><p>åœ¨ELECTRAæ¨¡å‹ä¸­ï¼Œé’ˆå¯¹ä¸Šè¿°é—®é¢˜çš„è§£å†³åŠæ³•æ˜¯ï¼šä½¿ç”¨<strong><em>replaced token detection(RTD)é¢„è®­ç»ƒä»»åŠ¡</em></strong>ã€‚å…·ä½“æ¥è¯´ï¼ŒRTDé¢„è®­ç»ƒä»»åŠ¡æ˜¯å»è®­ç»ƒä¸€ä¸ªç”¨æ¥åˆ¤åˆ«è¾“å…¥çš„tokenæ˜¯åŸå§‹æ–‡æœ¬çš„tokenè¿˜æ˜¯è¢«æ›¿æ¢çš„tokençš„Discriminatorã€‚ä¸åŒäºMLMä»»åŠ¡ï¼ŒRTDä¸ä½¿ç”¨MASKINGï¼Œè€Œæ˜¯ç”¨ä»ä¸€ä¸ªç»™å®šçš„distributionä¸­é‡‡æ ·å¾—åˆ°çš„ä¸€äº›tokensæ¥æ›¿æ¢æ‰åŸå§‹çš„ä¸€äº›tokensï¼Œè¿™ä¸ªç»™å®šçš„distributioné€šå¸¸æ˜¯ä¸€ä¸ªå°çš„MLMæ¨¡å‹çš„è¾“å‡º(å¯ä»¥çœ‹ä½œæ˜¯Generatorçš„è¾“å‡º)ã€‚è¿™æ ·çš„è¯ï¼ŒMLMåªä½¿ç”¨äº†è¢«MASKæ‰tokensï¼Œè€ŒRTDåˆ™ä½¿ç”¨å…¨éƒ¨çš„tokensï¼Œåšä¸€ä¸ªåºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼Œæ‰€ä»¥RTDä»»åŠ¡éœ€è¦çš„ç®—åŠ›å°±ä¼šå°å¾ˆå¤šã€‚æœ€ç»ˆæˆ‘ä»¬é¢„è®­ç»ƒå¥½ä¹‹åï¼ŒæŠ›å¼ƒGeneratorï¼Œåªä½¿ç”¨Discriminatoræ¥è¿›è¡Œfine-tuneã€‚RTDçš„æ¶æ„å¦‚ä¸‹ï¼š</p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/RTD.jpg" alt></p><p>ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒRTDçš„æ•´ä¸ªæ¶æ„ä¸GANéå¸¸çš„ç±»ä¼¼ï¼Œä½†æ˜¯åˆå­˜åœ¨ä¸åŒçš„åœ°æ–¹ã€‚å…·ä½“ç»†èŠ‚å¦‚ä¸‹ï¼š</p><ul><li><strong>For Generatorï¼š</strong>åœ¨ELECTRAä¸­ï¼ŒGeneratorä¸€èˆ¬æ˜¯ä¸€ä¸ªå°å‹çš„MLMæ¨¡å‹ï¼Œå…¶è¾“å…¥æ˜¯tokensï¼Œå…¶è¾“å‡ºæ˜¯æ›¿æ¢è¿‡ä¸€äº›tokenä¹‹åçš„tokenã€‚å¦‚æœå¯¹GANç†Ÿæ‚‰çš„è¯ï¼Œæˆ‘ä»¬å°±çŸ¥é“ï¼Œinputæ˜¯æ»¡è¶³æŸç§çš„distributionçš„æ ·æœ¬ï¼Œé€šè¿‡generatorä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°æ˜¯å¦ä¸€ç§distributionçš„sampleï¼Œå°½ç®¡è¿™ç§distributionæˆ‘ä»¬ä¸çŸ¥é“å®ƒçš„formulationï¼Œä½†æ˜¯è¾“å‡ºçš„tokensä¸€å®šæ˜¯æ»¡è¶³è¿™ç§distributionçš„ã€‚å¾—åˆ°è¾“å‡ºä¹‹åï¼Œæˆ‘ä»¬å¹¶ä¸å°†è¾“å‡ºé€šè¿‡è¾“å…¥åˆ°DIscriminatorä¸­ï¼Œæ¥è®­ç»ƒGeneratorã€‚ç”±äºæ–‡æœ¬æ˜¯ç¦»æ•£çš„ï¼ŒGANå¯¹äºç¦»æ•£çš„æ•°æ®æ˜¯ä¸å¥½è®­ç»ƒçš„ï¼Œå› ä¸ºDiscriminatorçš„æ¢¯åº¦æ— æ³•åå‘ä¼ æ’­åˆ°Generatorä¸­(å…¶å®ä¹Ÿæ˜¯æœ‰åŠæ³•çš„ï¼Œå°±æ˜¯ä½¿ç”¨RLä¸­çš„policy gradientæ¥åšï¼Œä½†æ˜¯éå¸¸éº»çƒ¦ï¼Œå¹¶ä¸”åé¢çš„å®éªŒä¹Ÿè¡¨æ˜ï¼Œå…¶ç»“æœå¹¶ä¸å¦‚MLE)ã€‚é‚£æ€ä¹ˆè®­ç»ƒGeneratorå‘¢ï¼Ÿåœ¨ELECTRAä¸­ï¼Œä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Œæ¥å¾—åˆ°è¢«MASKæ‰çš„tokençš„æ¦‚ç‡ï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</li></ul><p>å¯¹äºè¾“å…¥åºåˆ—ï¼š$x=[x_1,x_2,â€¦,x_n]$ï¼Œé€šè¿‡Generatorä¹‹åï¼Œå¾—åˆ°$h_G(x)=[h_1,h_2,â€¦,h_n]$ï¼Œå¯¹äºè¢«MASKçš„ä½ç½®$t$ï¼ŒGeneratoræœ€åé€šè¿‡softmaxæ¥äº§ç”Ÿä¸€ä¸ª$x_t$çš„æ¦‚ç‡æ˜¯ï¼š<br><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/MLM.jpg" alt></p><p>å…¶ä¸­ï¼Œ$e(x_t)$è¡¨ç¤ºtoken embeddingã€‚</p><ul><li><strong>For Discriminatorï¼š</strong>åœ¨ELECTRAä¸­ï¼Œå¯¹äºä½ç½®$t$ï¼ŒDiscriminatoræ¥åˆ¤åˆ«tokenæ˜¯åŸå§‹çš„tokenè¿˜æ˜¯æ¥è‡ªäºGeneratoräº§ç”Ÿçš„distributionçš„tokenã€‚formulationå¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/RTD formulation.jpg" alt></p><p>æœ€ç»ˆæ•´ä¸ªGeneratorä¸Discriminatorç”¨å…¬å¼æ¥è¡¨è¾¾å…¶è¾“å…¥ä¸lossçš„è¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/loss.jpg" alt></p><p>loss functionåº”è¯¥ä¸éš¾ç†è§£ï¼Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦minimizeå¦‚ä¸‹formulationï¼š</p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/final loss.jpg" alt></p><p>è®­ç»ƒå¥½ä¹‹åï¼ŒæŠ›å¼ƒGeneratorï¼Œä½¿ç”¨Discriminatoræ¥è¿›è¡Œä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒå³å¯ã€‚</p><h2 id="ELECTRAæ¨¡å‹ä¼˜åŒ–ä¸æ”¹è¿›"><a href="#ELECTRAæ¨¡å‹ä¼˜åŒ–ä¸æ”¹è¿›" class="headerlink" title="ELECTRAæ¨¡å‹ä¼˜åŒ–ä¸æ”¹è¿›"></a>ELECTRAæ¨¡å‹ä¼˜åŒ–ä¸æ”¹è¿›</h2><h3 id="weight-sharing"><a href="#weight-sharing" class="headerlink" title="weight sharing"></a>weight sharing</h3><p>ä½œè€…æƒ³çŸ¥é“å°†Generatorä¸Discriminatorçš„å‚æ•°å…±äº«æ˜¯å¦ä¼šæå‡æ•ˆæœã€‚ä½œè€…è®¾ç½®äº†ç›¸åŒå¤§å°çš„Generatorä¸Discriminatorï¼Œåœ¨å¸ƒå®«å–œé‚£ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼ŒGLUEç»“æœä¸º83.6ï¼Œåªå…±äº«token embeddingçš„ç»“æœä¸º84.3ï¼Œå…±äº«æ‰€æœ‰å‚æ•°çš„ç»“æœæ˜¯84.4ã€‚å¯ä»¥çœ‹åˆ°å…±äº«token embeddingçš„æ•ˆæœå¾ˆæ˜æ˜¾ã€‚è¿™ä¹Ÿè¯´æ˜Generatorå¯¹äºembeddingæœ‰æ›´å¥½çš„å­¦ä¹ èƒ½åŠ›ã€‚å› ä¸ºåœ¨MLMä¸­ï¼Œæœ€åé€šè¿‡softmaxï¼Œä¼šå»æ›´æ–°æ‰€æœ‰çš„vocab çš„embeddingï¼›è€Œåœ¨Discriminatorä¸­ï¼Œåªä¼šæ›´æ–°è¾“å…¥çš„tokençš„embeddingã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆä½œè€…é€‰æ‹©äº†å…±äº«token embeddingã€‚</p><h3 id="smaller-Generator"><a href="#smaller-Generator" class="headerlink" title="smaller Generator"></a>smaller Generator</h3><p>ä½œè€…æ¢ç´¢äº†Generatorçš„å¤§å°æ˜¯å¦ä¼šå¯¹ç»“æœæœ‰æå‡ã€‚ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/generator size.jpg" alt></p><p>ä»ç»“æœä¸Šå¯ä»¥çœ‹åˆ°ï¼ŒGeneratorçš„å¤§å°åœ¨Discriminatorå¤§å°çš„1/4-1/2ä¹‹é—´æ•ˆæœæ¯”è¾ƒå¥½ã€‚åŸå› åœ¨äºï¼šGeneratorå¦‚æœå¤ªå¼ºäº†ï¼Œä¼šå¯¼è‡´Discriminatorçš„æ•ˆæœä¸‹é™ã€‚</p><h2 id="training-algorithms"><a href="#training-algorithms" class="headerlink" title="training algorithms"></a>training algorithms</h2><p>é™¤äº†ä¸Šè¿°æåŠçš„è®­ç»ƒç­–ç•¥ï¼Œä½œè€…è¿˜è¯•äº†å…¶ä»–ä¸¤ç§ç­–ç•¥ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>Adversarial Contrastive Estimationï¼šè¿™å®é™…ä¸Šå°±æ˜¯æŒ‰ç…§GANçš„æ€è·¯æ¥åšï¼Œå³ï¼šå°†Generatorçš„lossä»MLM lossæ”¹ä¸ºæœ€å¤§åŒ–è¢«æ›¿æ¢çš„tokenåœ¨Discriminatorä¸Šçš„RTD lossï¼Œå’ŒGANæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜æ˜¯ï¼šDiscriminatorçš„æ¢¯åº¦æ— æ³•åå‘ä¼ æ’­åˆ°Generatorä¸­ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Ÿä½œè€…ä½¿ç”¨äº†RLä¸­çš„policy gradientï¼Œä½¿å¾—æ¢¯åº¦å¯ä»¥è¿›è¡Œä¼ å¯¼ã€‚æœ€åçš„æ•ˆæœåªæœ‰54%çš„å‡†ç¡®ç‡ï¼Œè€ŒMLEçš„è®­ç»ƒç­–ç•¥ä¸‹ï¼Œå¯ä»¥è¾¾åˆ°65%çš„å‡†ç¡®ç‡ã€‚</li><li>Two-stage trainingï¼šä¹Ÿå°±æ˜¯æˆ‘ä»¬å…ˆåªå»è®­ç»ƒGeneratorï¼Œç„¶åfreezeæ‰Generatorï¼Œå°†Discriminatorçš„å‚æ•°ä½¿ç”¨Generatorçš„å‚æ•°æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹‹åå¯¹Discriminatorè®­ç»ƒä¸GeneratoråŒæ ·çš„æ­¥æ•°ã€‚</li></ul><p>ä¸‰ç§é¢„è®­ç»ƒç­–ç•¥ç»“æœå¯¹æ¯”å¦‚ä¸‹ï¼š</p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/triple strategies.jpg" alt></p><p>ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒMLEçš„æ–¹å¼ç»“æœæœ€å¥½ã€‚</p><h2 id="ELECTRAæ¨¡å‹ç»“æœ"><a href="#ELECTRAæ¨¡å‹ç»“æœ" class="headerlink" title="ELECTRAæ¨¡å‹ç»“æœ"></a>ELECTRAæ¨¡å‹ç»“æœ</h2><p>åœ¨è¿™é‡Œï¼Œä½œè€…ç–¯ç‹‚åœ°å°†ELECTRAä¸å„ç§é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¯¹æ¯”ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/small result.jpg" alt></p><p><img src="/2020/07/02/NLP-ELECTRA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/large result.jpg" alt></p><p>å¯ä»¥çœ‹åˆ°æ•ˆæœå¯ä»¥è¯´æ˜¯éå¸¸ä¼˜ç§€äº†ï½</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€ŠELECTRA: P RE - TRAINING T EXT E NCODERS AS D ISCRIMINATORS R ATHER T HAN G ENERATORSã€‹</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> ELECTRA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºåŒ–å­¦ä¹ |GAN models</title>
      <link href="2020/06/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-GAN-models/"/>
      <url>2020/06/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-GAN-models/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºéœ€è¦ï¼Œæœ€è¿‘å¼€å§‹çœ‹å¼ºåŒ–å­¦ä¹ çš„ä¸œè¥¿å•¦ï¼Œå¤§æ¦‚ä¸€å‘¨æ—¶é—´æå®ŒDRLåŸºç¡€ï¼Œç„¶åå¼€å§‹æ¢ç´¢DRLåœ¨NLPä¸­çš„åº”ç”¨ã€‚ğŸ¤©è¿™ç¯‡åšå®¢ä¸»è¦æ˜¯è®°å½•å…³äºGANçš„åŸç†ã€å…¶èƒŒåçš„çš„ç†è®ºä»¥åŠå…¶å„ç§å˜ä½“æ¨¡å‹(especially for NLP)çš„å†…å®¹ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚</p><a id="more"></a><h1 id="ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰"><a href="#ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰" class="headerlink" title="ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰"></a>ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰</h1><p>ç›®å‰æ¥çœ‹ï¼ŒGANæ¨¡å‹ä¸æ˜¯ä¸€ä¸ªæ–°é²œçš„æŠ€æœ¯äº†ï¼Œå®ƒåœ¨ç¥ç»é£æ ¼è¿ç§»ï¼Œäººè„¸å˜æ¢ç­‰ç­‰æ–¹é¢éƒ½æœ‰å¾ˆå¤§çš„åº”ç”¨ã€‚å…ˆæ¥è®²è§£ä»€ä¹ˆæ˜¯GANã€‚</p><blockquote><p>æœ¬ç¯‡åšå®¢çš„å¤§éƒ¨åˆ†å†…å®¹æ¥æºäºæå®æ¯…æ•™æˆçš„GANsè¯¾ç¨‹ã€‚</p></blockquote><p>åœ¨GANä¸­ï¼Œæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šGeneratorä¸Discriminatorã€‚åŸè®ºæ–‡ä½¿ç”¨çš„æ˜¯é“¶è¡Œä¸å°é’å›¢ä¼™çš„ä¾‹å­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ç”¨ä¸€ä¸ªæ¯”è¾ƒpeaceçš„æ¯”å–»å°±æ˜¯ï¼šGeneratorå¥½æ¯”äºå­¦ç”Ÿï¼Œå®ƒè¾“å‡ºçš„æ˜¯å­¦ç”Ÿè‡ªå·±å®Œæˆçš„ä½œä¸šï¼ŒDIscriminatorå¥½æ¯”äºè€å¸ˆï¼Œæ¥åˆ¤æ–­å­¦ç”Ÿçš„ä½œä¸šæ˜¯å¦è¾¾åˆ°æ ‡å‡†è¦æ±‚ã€‚å°†æ ‡å‡†çš„ä½œä¸šä¸å­¦ç”Ÿçš„ä½œä¸šéƒ½åšä¸ºDiscriminatorçš„è¾“å…¥ï¼Œè€å¸ˆå¸Œæœ›è‡ªå·±åˆ¤åˆ«æ ‡å‡†ä½œä¸šä»¥åŠå­¦ç”Ÿçš„ä½œä¸šçš„èƒ½åŠ›è¶Šæ¥è¶Šå¼ºï¼Œè€Œå­¦ç”Ÿåˆ™å¸Œæœ›è‡ªå·±å®Œæˆçš„ä½œä¸šè¶Šæ¥è¶Šé è¿‘æ ‡å‡†çš„ä½œä¸šï¼Œä»¥æ­¤æ¥é€šè¿‡è€å¸ˆçš„åˆ¤å®šã€‚æœ€ç»ˆï¼Œå½“è€å¸ˆæ— æ³•åˆ¤å®šæ ‡å‡†ä½œä¸šä»¥åŠå­¦ç”Ÿçš„ä½œä¸šä¹‹é—´çš„åŒºåˆ«çš„æ—¶å€™ï¼Œå°±è¯´æ˜å­¦ç”Ÿè‡ªå·±çš„ä½œä¸šå°±è¾¾åˆ°äº†æ ‡å‡†ä½œä¸šçš„è¦æ±‚ï¼Œé€šè¿‡äº†è€å¸ˆçš„åˆ¤å®šã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒGeneratorç”¨æ¥ç”Ÿæˆâ€å‡æ ·æœ¬â€œï¼Œå°†â€œå‡æ ·æœ¬â€ä¸çœŸå®æ ·æœ¬åŒæ—¶è¾“å…¥Discriminatorä¸­ï¼ŒDiscriminatoréœ€è¦åˆ¤æ–­å“ªäº›æ˜¯çœŸå®æ ·æœ¬ï¼Œå“ªäº›æ˜¯â€œå‡æ ·æœ¬â€œã€‚å¦‚æœæ˜¯çœŸå®æ ·æœ¬ï¼Œæˆ‘ä»¬ç»™å®ƒè®°ä¸º1ï¼Œå¦‚æœæ˜¯â€å‡æ ·æœ¬â€œï¼Œæˆ‘ä»¬è®°ä¸º0ã€‚è¿™æ ·ä¸æ–­å¾ªç¯ï¼ŒGeneratorä¸æ–­ç”Ÿæˆæ›´åŠ èƒ½å¤Ÿâ€œéª—è¿‡â€Discriminatorçš„â€œå‡æ ·æœ¬â€ï¼Œè€ŒDiscriminatoråˆ™ä¸æ–­æé«˜è‡ªå·±è¯†åˆ«çœŸå®æ ·æœ¬ä¸â€å‡æ ·æœ¬â€œçš„èƒ½åŠ›ï¼Œæœ€ç»ˆï¼ŒçŸ¥é“Discriminatoræ— æ³•è¾¨åˆ«çœŸå®æ ·æœ¬ä¸â€å‡æ ·æœ¬â€œçš„æ—¶å€™ï¼Œå°±ç»“æŸã€‚æˆ‘ä»¬æœ€ç»ˆä½¿ç”¨çš„æ˜¯Generatorã€‚ä¸‹é¢ç»™å‡ºå…¬å¼åŒ–çš„è¡¨è¾¾ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/06/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-GAN-models/GAN.jpg" alt></p><h2 id="GANçš„åŸç†"><a href="#GANçš„åŸç†" class="headerlink" title="GANçš„åŸç†"></a>GANçš„åŸç†</h2><p>æ”¾å›¾ï½</p><p><img src="/2020/06/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-GAN-models/ganyuanli.jpg" alt></p><p>åŸå§‹çš„GANå®é™…ä¸Šå°±æ˜¯åœ¨minimizeGeneratorç”Ÿæˆçš„dataçš„åˆ†å¸ƒ$P_G$ä¸çœŸå®çš„dataåˆ†å¸ƒ$P_{data}$çš„JS divergenceã€‚ä¸‹é¢å…·ä½“åˆ†æä¸€ä¸‹ï½</p><ul><li>for Discriminatorï¼šå®ƒçš„ä½œç”¨æ˜¯è¡¡é‡å¾—åˆ°$P_G$ä¸$P_{data}$çš„JS divergenceã€‚å®ƒä¼˜åŒ–çš„ç›®æ ‡æ˜¯è¦maximizeçœŸå®dataçš„æ¦‚ç‡ï¼ŒåŒæ—¶minimize Genneratorç”Ÿæˆçš„dataçš„æ¦‚ç‡ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯å’ŒLRæ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥å°†çœŸå®dataçœ‹åˆ°positive sampleï¼ŒGeneratorç”Ÿæˆçš„dataçœ‹ä½œnegative sampleï¼Œå¯ä»¥çœ‹åˆ°ä¸LRæ˜¯ç­‰ä»·çš„ã€‚æ‰€ä»¥ï¼ŒDiscriminatorçš„losså°±ç­‰ä»·äº minimize CEã€‚ç”¨å…¬å¼æ¥è¡¨ç¤ºçš„è¯ï¼Œå°±æ˜¯ï¼š</li></ul><script type="math/tex; mode=display">D^*=argmaxV(G,D)</script><ul><li>For Generatorï¼šå®ƒçš„ä½œç”¨æ˜¯minimize å¾—åˆ°çš„JS divergenceã€‚ç”¨å…¬å¼æ¥è¡¨ç¤ºå°±æ˜¯ï¼š</li></ul><script type="math/tex; mode=display">G^*=arg min \ Div(P_g,P_{data})=argmin \ max \ V(G,D)</script><p>å¦å¤–ï¼Œæˆ‘ä»¬åœ¨æ›´æ–°Generatorçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨$V=\frac 1m\sum_{i=1}^{m}-log(D(G(z_i)))$ï¼Œå› ä¸ºç›¸æ¯”äº$log(1-D(G(z_i)))$ï¼Œåœ¨è®­ç»ƒçš„å¼€å§‹ï¼Œæ¢¯åº¦ä¸‹é™çš„æ¯”è¾ƒå¿«ã€‚</p><h2 id="fGANâ€”â€”ä»»æ„çš„Divergence"><a href="#fGANâ€”â€”ä»»æ„çš„Divergence" class="headerlink" title="fGANâ€”â€”ä»»æ„çš„Divergence"></a>fGANâ€”â€”ä»»æ„çš„Divergence</h2><p>åœ¨åŸå§‹çš„GANä¸­ï¼Œæˆ‘ä»¬æ˜¯å»è¡¡é‡å¹¶minimize Generatorç”Ÿæˆçš„dataçš„åˆ†å¸ƒä¸çœŸå®dataçš„åˆ†å¸ƒçš„JS divergenceï¼Œé‚£æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>GANä¸­æ˜¯å¦å¯ä»¥æ¢æˆçš„å…¶ä»–çš„divergenceå‘¢ï¼Ÿ</li><li>æ¢æˆçš„å…¶ä»–çš„divergenceï¼Œæ˜¯å¦ä¼šæœ‰æé«˜å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´JS divergenceæ˜¯å¦æ˜¯æœ€ä¼˜çš„divergenceå‘¢ï¼Ÿ</li></ol><p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼ç»“æœå°±æ˜¯è¿™ä¸€å°èŠ‚è®²çš„f-divergenceï¼›å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ï¼šä¸çŸ¥é“ï¼Œå› ä¸ºæ¢ç”¨å…¶ä»–çš„divergenceï¼Œæ•ˆæœä¼¼ä¹æ²¡æœ‰æ›´å¥½ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰æ›´å·®ï¼Œå¾ˆå¤šGANçš„å˜ä½“ä¸­ç”¨åˆ°äº†å…¶ä»–çš„divergenceï¼Œä¹‹åä¼šè®¨è®ºã€‚</p><h1 id="WGAN"><a href="#WGAN" class="headerlink" title="WGAN"></a>WGAN</h1><h1 id="VAE-GAN"><a href="#VAE-GAN" class="headerlink" title="VAE-GAN"></a>VAE-GAN</h1><h1 id="BIGAN"><a href="#BIGAN" class="headerlink" title="BIGAN"></a>BIGAN</h1><h1 id="GANçš„å®ç°"><a href="#GANçš„å®ç°" class="headerlink" title="GANçš„å®ç°"></a>GANçš„å®ç°</h1><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><p>åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡ç”¨tensorflow2æ¥å®ç°DCGANæ¨¡å‹ã€‚éœ€è¦æ³¨æ„ï¼šåœ¨Generatoréƒ¨åˆ†ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦ä»ä½ç»´è½¬åˆ°é«˜ç»´ï¼Œæ‰€ä»¥ä½¿ç”¨åå·ç§¯æ“ä½œï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½¿ç”¨åå·ç§¯ï¼ŒåŠ¿å¿…è¦ä½¿ç”¨å¡«å……ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬è¦ç”Ÿæˆæ»¡æ„çš„å›¾ç‰‡çš„è¯ï¼Œå¿…é¡»è¦ä¿ç•™ä½ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥ï¼Œåœ¨å®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æŠ›å¼ƒä¼šæŸå¤±ä½ç½®ä¿¡æ¯çš„æ± åŒ–å±‚ä»¥åŠæœ€åçš„å…¨è¿æ¥å±‚ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨å¤šä¸ªåå·ç§¯ï¼Œä»è€Œä½¿å¾—å®½åº¦ä¸é«˜åº¦ä¸æ–­å˜å¤§ï¼Œæ·±åº¦ä¸æ–­å˜å°ï¼Œä»è€Œè¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„ç»´åº¦ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œç”±äºå åŠ å¤šå±‚åå·ç§¯å±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ BatchNormï¼Œæ¥æ”¹å–„æ¨¡å‹çš„è®­ç»ƒæ•ˆæœï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦æ˜¯ç”¨leakyReluï¼Œæ¥ä½¿å¾—æ¢¯åº¦ä¿æŒç¨³å®šã€‚å¯¹äºDisciriminatorï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šä¸ªå·ç§¯å±‚ï¼Œå…¶ä»–çš„ä¸Generatorä¸€æ ·ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬æœ€åæˆ‘ä»¬ä»ç„¶ä¸ä½¿ç”¨å…¨è¿æ¥å±‚ï¼Œè€Œæ˜¯æ‰å¹³åŒ–åç›´æ¥é€å…¥sigmoidå±‚ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆæ˜¯æ¨¡å‹å®šä¹‰éƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generator</span><span class="params">(Model)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    generatoréƒ¨åˆ†</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Generator, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.fc=layers.Dense(<span class="number">3</span>*<span class="number">3</span>*<span class="number">512</span>,use_bias=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        self.transpose_conv2d1=layers.Conv2DTranspose(filters=<span class="number">256</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),strides=(<span class="number">3</span>,<span class="number">3</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line">        self.bn1=layers.BatchNormalization()</span><br><span class="line"></span><br><span class="line">        self.transpose_conv2d2=layers.Conv2DTranspose(filters=<span class="number">128</span>,kernel_size=(<span class="number">5</span>,<span class="number">5</span>),strides=(<span class="number">2</span>,<span class="number">2</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line">        self.bn2=layers.BatchNormalization()</span><br><span class="line"></span><br><span class="line">        self.transpose_conv2d3=layers.Conv2DTranspose(filters=<span class="number">3</span>,kernel_size=(<span class="number">4</span>,<span class="number">4</span>),strides=(<span class="number">3</span>,<span class="number">3</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line"></span><br><span class="line">        self.conv2d=layers.Conv2D(filters=<span class="number">1</span>,kernel_size=(<span class="number">9</span>,<span class="number">9</span>),strides=(<span class="number">2</span>,<span class="number">2</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, inputs, training=None, mask=None)</span>:</span></span><br><span class="line">        x=self.fc(inputs)</span><br><span class="line">        x=tf.reshape(x,shape=[<span class="number">-1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">512</span>])</span><br><span class="line">        x=tf.nn.leaky_relu(x)</span><br><span class="line"></span><br><span class="line">        x=self.transpose_conv2d1(x)</span><br><span class="line">        x=self.bn1(x,training=training)</span><br><span class="line">        x=tf.nn.leaky_relu(x)</span><br><span class="line"></span><br><span class="line">        x=self.transpose_conv2d2(x)</span><br><span class="line">        x=self.bn2(x,training=training)</span><br><span class="line">        x=tf.nn.leaky_relu(x)</span><br><span class="line"></span><br><span class="line">        x=self.transpose_conv2d3(x)</span><br><span class="line">        x=self.conv2d(x)</span><br><span class="line">        x=tf.nn.tanh(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Discriminator</span><span class="params">(Model)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    discriminatoréƒ¨åˆ†</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Discriminator, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.conv2d1=layers.Conv2D(filters=<span class="number">64</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),strides=(<span class="number">2</span>,<span class="number">2</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line">        self.bn1=layers.BatchNormalization()</span><br><span class="line">        self.conv2d2=layers.Conv2D(filters=<span class="number">128</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),strides=(<span class="number">2</span>,<span class="number">2</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line">        self.bn2=layers.BatchNormalization()</span><br><span class="line">        self.conv2d3=layers.Conv2D(filters=<span class="number">256</span>,kernel_size=(<span class="number">2</span>,<span class="number">2</span>),strides=(<span class="number">2</span>,<span class="number">2</span>),padding=<span class="string">"valid"</span>)</span><br><span class="line">        self.bn3=layers.BatchNormalization()</span><br><span class="line"></span><br><span class="line">        self.flatten=layers.Flatten()</span><br><span class="line"></span><br><span class="line">        self.fc=layers.Dense(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, inputs, training=None, mask=None)</span>:</span></span><br><span class="line">        x=self.conv2d1(inputs)</span><br><span class="line">        x=self.bn1(x,training=training)</span><br><span class="line"></span><br><span class="line">        x=self.conv2d2(x)</span><br><span class="line">        x=self.bn2(x,training=training)</span><br><span class="line"></span><br><span class="line">        x=self.conv2d3(x)</span><br><span class="line">        x=self.bn3(x,training=training)</span><br><span class="line"></span><br><span class="line">        x=self.flatten(x)</span><br><span class="line">        logits=self.fc(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> logits</span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯è®­ç»ƒè¿‡ç¨‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line"><span class="keyword">from</span> GAN <span class="keyword">import</span> Discriminator, Generator</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰å‚æ•°</span></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">epochs = <span class="number">5</span></span><br><span class="line">buffer_size = <span class="number">256</span></span><br><span class="line">noise_dim=<span class="number">100</span></span><br><span class="line">num_sample=<span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># äº§ç”Ÿæ•°æ®</span></span><br><span class="line">(x_train, y_train), (x_test, y_test) = mnist.load_data()</span><br><span class="line">x_train=x_train[:num_sample,...]</span><br><span class="line">print(x_train.shape)</span><br><span class="line">x_train = tf.reshape(tf.cast((x_train - <span class="number">127.5</span>) / <span class="number">127.5</span>, dtype=tf.float32), shape=[<span class="number">-1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>])</span><br><span class="line">data = tf.data.Dataset.from_tensor_slices(x_train).shuffle(buffer_size).batch(batch_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">discriminator_loss</span><span class="params">(real_output, generator_output)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    discriminatorçš„æŸå¤±è®¡ç®—</span></span><br><span class="line"><span class="string">    :param real_output: çœŸå®objectè¾“å…¥åˆ°discriminatorä¹‹åäº§ç”Ÿçš„ç»“æœ</span></span><br><span class="line"><span class="string">    :param generator_output: generatoräº§ç”Ÿçš„ç»“æœè¾“å…¥åˆ°discriminatorä¹‹åäº§ç”Ÿçš„ç»“æœ</span></span><br><span class="line"><span class="string">    :return:discriminatorçš„æŸå¤±</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    loss_fn = tf.keras.losses.BinaryCrossentropy(from_logits=<span class="literal">True</span>)</span><br><span class="line">    discriminator_real_loss = loss_fn(tf.ones_like(real_output), real_output)</span><br><span class="line">    discriminator_fake_loss = loss_fn(tf.zeros_like(generator_output), generator_output)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> discriminator_real_loss + discriminator_fake_loss</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_loss</span><span class="params">(generator_output)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    generatorçš„æŸå¤±è®¡ç®—</span></span><br><span class="line"><span class="string">    :param generator_output: generatorè¾“å‡ºçš„ç»“æœ</span></span><br><span class="line"><span class="string">    :return: generatorçš„æŸå¤±</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    loss_fn = tf.keras.losses.BinaryCrossentropy(from_logits=<span class="literal">True</span>)</span><br><span class="line">    generator_loss = loss_fn(tf.ones_like(generator_output), generator_output)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> generator_loss</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–æ¨¡å‹</span></span><br><span class="line">discriminator=Discriminator()</span><br><span class="line">generator=Generator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¼˜åŒ–å™¨</span></span><br><span class="line">d_optimizer=tf.keras.optimizers.Adam()</span><br><span class="line">g_optimizer=tf.keras.optimizers.Adam()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å•ä¸ªçš„train step</span></span><br><span class="line"><span class="meta">@tf.function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_step</span><span class="params">(batch_data)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    train step</span></span><br><span class="line"><span class="string">    :param batch_data: batch data</span></span><br><span class="line"><span class="string">    :return: æ— </span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    noise=tf.random.normal(shape=[batch_size,noise_dim])</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> discriminator_tape:</span><br><span class="line"></span><br><span class="line">        real_output=discriminator(batch_data,training=<span class="literal">True</span>)</span><br><span class="line">        generator_data=generator(noise,training=<span class="literal">True</span>)</span><br><span class="line">        generator_output=discriminator(generator_data,training=<span class="literal">True</span>)</span><br><span class="line">        d_loss=discriminator_loss(real_output,generator_output)</span><br><span class="line"></span><br><span class="line">    discriminator_gradient=discriminator_tape.gradient(d_loss,discriminator.trainable_variables)</span><br><span class="line">    d_optimizer.apply_gradients(zip(discriminator_gradient, discriminator.trainable_variables))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> generator_tape:</span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ³¨æ„ï¼Œä½¿ç”¨ with as ç»“æ„ä¸€å®šè¦æ³¨æ„ï¼Œå½“è·³å‡ºè¿™ä¸ªç»“æ„åï¼Œé‡Œé¢çš„ä¸œè¥¿ä¼šå¤±æ•ˆï¼Œç›¸å½“äºå…³é—­äº†ï¼Œæ‰€ä»¥æœ€å¥½é‡æ–°å†™ä¸€éï¼</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        generator_data = generator(noise, training=<span class="literal">True</span>)</span><br><span class="line">        generator_output = discriminator(generator_data, training=<span class="literal">True</span>)</span><br><span class="line">        g_loss=generator_loss(generator_output)</span><br><span class="line"></span><br><span class="line">    generator_gradient=generator_tape.gradient(g_loss,generator.trainable_variables)</span><br><span class="line">    g_optimizer.apply_gradients(zip(generator_gradient, generator.trainable_variables))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d_loss,g_loss</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_plot_image</span><span class="params">(gen_model,test_noise,epoch)</span>:</span></span><br><span class="line">    pre_images = gen_model(test_noise,training=<span class="literal">False</span>)</span><br><span class="line">    fig = plt.figure(figsize=(<span class="number">4</span>,<span class="number">4</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(pre_images.shape[<span class="number">0</span>]):</span><br><span class="line">        plt.subplot(<span class="number">4</span>,<span class="number">4</span>,i+<span class="number">1</span>)</span><br><span class="line">        plt.imshow((pre_images[i,:,:,<span class="number">0</span>] + <span class="number">1</span> )/<span class="number">2</span>,cmap=<span class="string">'gray'</span>)</span><br><span class="line">        plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.savefig(<span class="string">'image_at_epoch_&#123;:04d&#125;.png'</span>.format(epoch))</span><br><span class="line">    plt.close()</span><br><span class="line"></span><br><span class="line">num_exp_to_generate = <span class="number">16</span></span><br><span class="line">seed = tf.random.normal([num_exp_to_generate,noise_dim])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(data,epochs)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    è®­ç»ƒ</span></span><br><span class="line"><span class="string">    :param data: æ•°æ®</span></span><br><span class="line"><span class="string">    :param epochs: epochçš„æ•°æ®</span></span><br><span class="line"><span class="string">    :return: æ— </span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> range(epochs):</span><br><span class="line">        <span class="keyword">for</span> index,batch_data <span class="keyword">in</span> enumerate(data):</span><br><span class="line">            d_loss,g_loss=train_step(batch_data)</span><br><span class="line">            print(<span class="string">f"epoch:<span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>,batch step:<span class="subst">&#123;index+<span class="number">1</span>&#125;</span>,d_loss:<span class="subst">&#123;d_loss&#125;</span>,g_loss:<span class="subst">&#123;g_loss&#125;</span>.\n"</span>)</span><br><span class="line">        generate_plot_image(generator, seed, epoch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    train(data,epochs)</span><br></pre></td></tr></table></figure><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>è¿™æ˜¯ç¬¬ä¸€æ¬¡epochè®­ç»ƒç»“æŸåï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®å¾—åˆ°çš„ç»“æœï¼š</p><p><img src="/2020/06/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-GAN-models/image_at_epoch_0000.png" alt></p><p>è¿™æ˜¯ç¬¬äº”æ¬¡epochè®­ç»ƒç»“æŸåï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®å¾—åˆ°çš„ç»“æœï¼š</p><p><img src="/2020/06/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0-GAN-models/image_at_epoch_0004.png" alt></p><p>å¯ä»¥çœ‹åˆ°ç»“æœæœ‰å¾ˆå¤§çš„æå‡ï¼Œå½“ç„¶äº†ï¼Œæˆ‘è¿™é‡Œåªè®­ç»ƒäº†5ä¸ªepochsï¼Œæ‰€ä»¥æœ€åçš„ç»“æœä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œå¯ä»¥è¯•ç€è®­ç»ƒå‡ åƒè½®ï¼Œåº”è¯¥æ•ˆæœä¼šå¥½å¾ˆå¤šã€‚åˆ°æ­¤ä¸ºæ­¢ï¼ŒåŸºç¡€çš„GANçš„çŸ¥è¯†å°±è®²åˆ°è¿™ã€‚å…¶å®GANå®ç°èµ·æ¥ç®€å•ï¼Œä½†æ˜¯GANå­˜åœ¨çš„å¾ˆå¤šçš„é—®é¢˜ï¼Œéœ€è¦å…³æ³¨ï¼Œå…³äºGANèƒŒåçš„ç†è®ºçŸ¥è¯†è¿˜æ˜¯éœ€è¦å¤šå»äº†è§£ä¸€ç‚¹ï¼Œæ‰èƒ½å¤ŸçœŸæ­£çš„ç”¨åˆ°å…¶ä»–çš„é¢†åŸŸï¼Œè­¬å¦‚ï¼šDiscriminatorçš„æœ¬è´¨æ˜¯å¾—åˆ°generator distributionä¸real distributionä¹‹é—´çš„æŸç§divergence(åŸå§‹çš„GANæ˜¯å¾—åˆ°JS divergence)ï¼Œè€ŒGeneratorçš„æœ¬è´¨æ˜¯å»minimize å¾—åˆ°çš„divergenceçš„å€¼ç­‰ç­‰ï¼Œè¿™äº›ç†è®ºéƒ½æ˜¯éœ€è¦å»äº†è§£çš„ï¼ŒåŒ…æ‹¬GANéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œè­¬å¦‚ï¼šä¼˜åŒ–é¥±å’Œï¼Œmode collapseï¼Œmodel droppingé—®é¢˜ã€‚ä¹‹åæœ‰æ—¶é—´å†æ›´æ–°å…³äºGANçš„éƒ¨åˆ†å§ï½</p>]]></content>
      
      
      <categories>
          
          <category> å¼ºåŒ–å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tensorflow2 </tag>
            
            <tag> å¼ºåŒ–å­¦ä¹  </tag>
            
            <tag> GAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tmuxçš„ä½¿ç”¨</title>
      <link href="2020/06/08/tmux%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/06/08/tmux%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä»¥å‰ä¸€ç›´ä¸çŸ¥é“ä¸ºä½•å¤§å®¶æ¨å´‡tmuxï¼Œæœ€è¿‘ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´çš„tmuxåï¼ŒåŒæ—¶é…åˆç€iterm2ï¼Œå‘è§‰çœŸé¦™ï¼ğŸ¤©ç½‘ä¸Šçš„æ•™ç¨‹å¾ˆå¤šï¼Œä½†æ˜¯å¾ˆå¤šç»†èŠ‚æ²¡æœ‰è¯´åˆ°ï¼Œå¯¼è‡´æˆ‘æœ€å¼€å§‹æ¥è§¦tmuxçš„æ—¶å€™ï¼Œè´¹äº†ä¸€ä¸¤ä¸ªå°æ—¶æ‰ç®—å…¥æ‰‹ï¼Œæ‰€ä»¥å°±æ‰“ç®—å†™å†™tmuxçš„ä½¿ç”¨ã€‚</p><a id="more"></a><h2 id="tmuxç®€ä»‹"><a href="#tmuxç®€ä»‹" class="headerlink" title="tmuxç®€ä»‹"></a>tmuxç®€ä»‹</h2><p>è¯¦ç»†çš„å°±ä¸ä»‹ç»äº†ï¼Œå®ƒæœ€å¤§çš„ä½œç”¨å°±åœ¨äºï¼šå¯ä»¥è®©ä½ åŒæ—¶ä½¿ç”¨å¤šä¸ªç»ˆç«¯ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä¿å­˜ä¸‹æ¥ï¼Œå¿…è¦çš„æ—¶å€™ï¼Œç„¶åå†æ¬¡åŠ è½½å›æ¥ï¼Œéå¸¸æ–¹ä¾¿ã€‚tmuxä¸­æœ‰ä¸‰ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼š<strong>ä¼šè¯(session)ã€çª—å£(window)ã€çª—æ ¼(pane)</strong>ï¼Œä»–ä»¬çš„å…³ç³»æ˜¯ï¼š<strong>ä¸€ä¸ªä¼šè¯å¯ä»¥æœ‰å¤šä¸ªçª—å£ï¼Œä¸€ä¸ªçª—å£å¯ä»¥æœ‰å¤šä¸ªçª—æ ¼ã€‚</strong>ä¸‹é¢è®²è®²tmuxçš„å¸¸ç”¨å‘½ä»¤ã€‚</p><blockquote><p>æ³¨æ„ï¼šä»¥ä¸‹æ“ä½œå»ºç«‹åœ¨å·²ç»å®‰è£…å¥½tmuxä»¥åŠoh my tmuxçš„åŸºç¡€ä¸Šï¼</p></blockquote><h2 id="tmuxå¸¸ç”¨å‘½ä»¤"><a href="#tmuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="tmuxå¸¸ç”¨å‘½ä»¤"></a>tmuxå¸¸ç”¨å‘½ä»¤</h2><ul><li>è¦åˆ›å»ºä¼šè¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>tmux new -s ä¼šè¯åç§°</code>ï¼›</li><li>è¦åˆ›å»ºæ–°çš„çª—å£ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A</code>ï¼Œç„¶åå†æŒ‰<code>C</code>é”®ï¼Œæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œä¸æ˜¯ä¸€èµ·æŒ‰</li><li>è¦æ˜¾ç¤ºè¯¥ä¼šè¯ä¸‹çš„æ‰€æœ‰çª—å£ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A</code>ï¼Œç„¶åå†æŒ‰<code>W</code>é”®ï¼Œæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œä¸æ˜¯ä¸€èµ·æŒ‰</li><li>è¦åˆ‡æ¢çª—å£ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A+l</code></li><li>è¦å…³é—­çª—å£ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A</code>ï¼Œç„¶åä½¿ç”¨<code>shift+&amp;</code>ï¼Œæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œä¸æ˜¯ä¸€èµ·æŒ‰</li><li>åˆ†å‰²çª—æ ¼ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A</code>ï¼Œç„¶åä½¿ç”¨<code>shift+%</code>ï¼ˆçºµå‘åˆ†å‰²ï¼‰æˆ–è€…<code>shift+&quot;</code>ï¼ˆæ¨ªå‘åˆ†å‰²ï¼‰</li><li>è¦å…³é—­å½“å‰çª—æ ¼ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A</code>ï¼Œç„¶åå†æŒ‰<code>x</code>é”®ï¼Œæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œä¸æ˜¯ä¸€èµ·æŒ‰</li><li>è¦é€‰æ‹©åŒä¸€çª—å£çš„ä¸åŒçª—æ ¼ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+A</code>ï¼Œç„¶åå†æŒ‰<code>ä¸Šä¸‹å·¦å³</code>é”®ï¼Œæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œä¸æ˜¯ä¸€èµ·æŒ‰</li><li>è¦æ€æ­»æ‰€æœ‰ä¼šè¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>tmux kill-server</code></li><li>è¦æ€æ­»æŒ‡å®šçš„ä¼šè¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>tmux kill-session -t ä¼šè¯åç§°</code></li><li>è¦è¿›å…¥æŒ‡å®šçš„ä¼šè¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>tmux a -t ä¼šè¯åç§°</code></li><li>è¦æŸ¥çœ‹ç›®å‰æ‰€æœ‰çš„ä¼šè¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>tmux ls</code></li><li>ä¿å­˜å½“å‰ä¼šè¯ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ctrl+b</code>ï¼Œç„¶åå†æŒ‰<code>d</code>é”®ï¼Œæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯åˆ†å¼€çš„ï¼Œä¸æ˜¯ä¸€èµ·æŒ‰</li></ul><p>ä»¥ä¸Šå°±æ˜¯tmuxçš„åŸºæœ¬æ“ä½œï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ»¡è¶³æ—¥å¸¸çš„åº”ç”¨åœºæ™¯ï¼Œæœ€å¥½ä¸€ç›´éƒ½ç”¨tmuxï¼Œä¸è¦ä¸€è¾¹ç”¨ç€tmuxï¼Œä¸€è¾¹åˆç”¨ç€termialã€‚å¦å¤–ï¼Œå¦‚æœè¦ä½¿ç”¨çš„æ¯”è¾ƒçˆ½çš„è¯ï¼Œå°±è¦é…åˆç€bashå‘½ä»¤ä¸vimçš„ä½¿ç”¨äº†ï¼Œè¿™ä¸ªå¤§å®¶å¯ä»¥è‡ªå·±æ‘¸ç´¢ï¼Œä¹‹åå¦‚æœæœ‰æœºä¼šçš„è¯ï¼Œæˆ‘ä¹Ÿä¼šæ›´æ–°å¸¸ç”¨çš„bashå‘½ä»¤ä¸vimçš„ä½¿ç”¨æ–¹æ³•ï½ğŸ¤©</p>]]></content>
      
      
      
        <tags>
            
            <tag> tmux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|chatbotç³»åˆ—-MRFN</title>
      <link href="2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/"/>
      <url>2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å…¥å¯¹è¯çš„å‘å•¦ğŸ¤£å¯¹è¯æ˜¯ç›®å‰NLPæŠ€æœ¯é‡è¦çš„è½åœ°åœºæ™¯ä¹‹ä¸€ï¼Œä½†æ˜¯ç›¸æ¯”äºå…¶ä»–çš„æ–¹å‘ï¼Œå¯¹è¯ç›®å‰çš„åº”ç”¨è¿˜ä¸ç®—æˆç†Ÿï¼Œä¹Ÿè¿œè¿œæ²¡æœ‰äº§ç”Ÿå®ƒåº”æœ‰çš„å·¨å¤§å•†ä¸šä»·å€¼ï¼Œä½†æ˜¯éšç€ç‰©è”ç½‘ä¸5Gç­‰çš„å‘å±•ï¼Œå¯¹è¯çš„åº”ç”¨å‰æ™¯æ˜¯éå¸¸å…‰æ˜çš„ã€‚æ­¤å¤–ï¼Œæ—¢ç„¶å¯¹è¯çš„å‘è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€»éœ€è¦äººå»å¡«æ»¡è¿™äº›å‘ï¼Œå¯¹NLPeræ¥è¯´ï¼Œæ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºä¼šã€‚å…¶ä»–çš„ä¸å¤šè¯´ï¼Œæœ¬ç¯‡ç€é‡è®²è®²æ£€ç´¢å¼å¯¹è¯çš„ç»å…¸æ¨¡å‹MRFNã€‚</p><a id="more"></a><h2 id="MRFNæ¨¡å‹ä»‹ç»"><a href="#MRFNæ¨¡å‹ä»‹ç»" class="headerlink" title="MRFNæ¨¡å‹ä»‹ç»"></a>MRFNæ¨¡å‹ä»‹ç»</h2><p>MRFNæ¨¡å‹æ˜¯2019å¹´PKUä¸MSRAåœ¨WSDMé¡¶ä¼šä¸Šæ‰€å‘è¡¨çš„å…³äºæ£€ç´¢å¼å¯¹è¯çš„è®ºæ–‡ã€‚ä¸ªäººè®¤ä¸ºè¿™æ˜¯ä¸€ç¯‡ä¸å¯å¤šå¾—çš„å¥½è®ºæ–‡ï¼Œå®éªŒåšçš„å¾ˆè¯¦ç»†ï¼Œè€Œä¸”åœ¨representationæˆ–è€…è¯´æ˜¯granularitiesä¸Šåšåˆ°äº†æè‡´ï¼Œç»¼åˆäº†ç›®å‰å‡ ä¹æ‰€æœ‰çš„è¡¨ç¤ºæ–¹æ³•ã€‚MRFNæ¨¡å‹è§£å†³çš„æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼š<strong>1.æ€ä¹ˆå¯¹å¤šä¸ªrepresentationè¿›è¡Œèåˆï¼Ÿ2.ä¸åŒçš„representationå¯¹æœ€ç»ˆmatching performanceçš„è´¡çŒ®æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</strong>ä¸‹é¢å°±æ¥ä¸€ä¸€ä»‹ç»ï½</p><h3 id="MRFNæ¨¡å‹æ¶æ„"><a href="#MRFNæ¨¡å‹æ¶æ„" class="headerlink" title="MRFNæ¨¡å‹æ¶æ„"></a>MRFNæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆç»™å‡ºä¸€äº›å®šä¹‰ï¼šç»™å®šæ•°æ®é›†ï¼š$\cal D=\{c_i,r_i,y\}_{i=1}^{N}$ï¼Œå…¶ä¸­ï¼Œ$c_i=\{u_{i,1},u_{i,2},..,u_{i,m_i}\}$ï¼Œ$u_{i,j}$è¡¨ç¤ºç¬¬iä¸ªæ ·æœ¬çš„ç¬¬jä¸ªutterance in contextï¼Œ$y_i\in\{0,1\}$ï¼Œç›®æ ‡æ˜¯ï¼šè¡¡é‡$c_i$ä¸$r_i$ä¹‹é—´çš„åŒ¹é…åº¦ã€‚ä¸‹é¢ç›´æ¥æ¨¡å‹ç»“æ„å›¾ï½</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/MRFN.jpg" alt></p><p>MRFNæ¨¡å‹ä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š<strong>Representationsä¸Fusion strategiesã€‚</strong>ä¸‹é¢ä¾æ¬¡ä»‹ç»ï½</p><h4 id="Representations"><a href="#Representations" class="headerlink" title="Representations"></a>Representations</h4><p>åœ¨MRFNæ¨¡å‹ä¸­ï¼Œæœ‰ä¸‰ç§ç±»å‹çš„representationï¼š<strong>word representations, contextual representations, and attention-based representationsã€‚</strong></p><ul><li>word representationåˆ†ä¸ºä¸¤ç§ï¼š<strong>Character-based Word Embeddingä¸Word2Vecã€‚</strong>å‰è€…èƒ½å¤Ÿå°†subwordçš„ä¿¡æ¯è€ƒè™‘è¿›å»ï¼Œåè€…èƒ½å¤Ÿè€ƒè™‘corpusä¸­çš„å…±ç°ä¿¡æ¯ï¼Œä¸ºå…¶ä»–çš„è¡¨ç¤ºæ‰“ä¸‹åŸºç¡€ã€‚<ul><li>Character-based Word EmbeddingæŒ‡çš„æ˜¯å°†æ–‡æœ¬æŒ‰ç…§characteræ¥åˆ’åˆ†ï¼Œå¾—åˆ°çš„æ˜¯4ç»´å‘é‡ï¼Œå°†è¿™å››ç»´å‘é‡è¿›è¡Œreshapeï¼Œè¾“å…¥åˆ°æ¿€æ´»å‡½æ•°ä¸ºtanhçš„ä¸€ç»´å·ç§¯ä¸­ï¼Œå†ç»è¿‡å…¨å±€æ± åŒ–ï¼Œå¾—åˆ°äºŒç»´å‘é‡ï¼Œå†ç»è¿‡reshapeå¾—åˆ°æœ€ç»ˆçš„ä¸‰ç»´å‘é‡ï¼›</li><li>Word2VecæŒ‡çš„æ˜¯ä½¿ç”¨word2vecè®­ç»ƒå¾—åˆ°çš„è¯å‘é‡ä½œä¸ºåˆå§‹åŒ–ï¼Œå¹¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¿›è¡Œå¾®è°ƒã€‚</li></ul></li><li><p>contextual representationåˆ†ä¸ºä¸¤ç§ï¼š<strong>Sequential Representationä¸Local Representationã€‚</strong>å‰è€…ç¼–ç çš„æ˜¯å­åºåˆ—çš„è¯­ä¹‰ä¿¡æ¯ï¼Œåè€…ç¼–ç çš„æ˜¯n-gramçš„è¯­ä¹‰ä¿¡æ¯ï¼Œä¸¤ç§éƒ½æ˜¯æ—¨åœ¨æ•è·å•è¯ä¹‹é—´çš„çŸ­æœŸä¾èµ–å…³ç³»ã€‚</p><ul><li>Sequential RepresentationæŒ‡çš„æ˜¯å°†è¾“å…¥çš„ä¸‰ç»´å‘é‡(æ˜¯ä½¿ç”¨word2vecåˆå§‹åŒ–çš„)ç»è¿‡GRUç¼–ç ï¼Œ<strong>return_sequence=True</strong>ï¼›</li><li>Local RepresentationæŒ‡çš„æ˜¯ä½¿ç”¨4ç§ä¸åŒå·ç§¯æ ¸å°ºå¯¸çš„[1,2,3,4]å·ç§¯å±‚å¯¹è¾“å…¥çš„ä¸‰ç»´å‘é‡(æ˜¯ä½¿ç”¨word2vecåˆå§‹åŒ–çš„)è¿›è¡Œ<strong>sameå·ç§¯</strong>ï¼Œå„ä¸ªå·ç§¯æ ¸çš„æ•°ç›®å‡ä¸€è‡´ï¼Œä¸º:$n_c$ï¼Œè®ºæ–‡é‡Œä½¿ç”¨çš„æ˜¯50ï¼Œæœ€ç»ˆå¯¹4ä¸ªç»“æœè¿›è¡Œconcatï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</li></ul></li><li><p>Attention-based Representationsåˆ†ä¸ºä¸¤ç§ï¼š<strong>self attentionä¸cross attentionã€‚</strong>è¿™ç§representationèƒ½å¤Ÿå¯¹å•è¯ä¹‹é—´çš„é•¿æœŸä»¥æ¥è¿›è¡Œå»ºæ¨¡ï¼Œä»¥åŠå¯¹å•è¯ä¹‹é—´çš„é‡è¦æ€§è¿›è¡Œå»ºæ¨¡ã€‚</p><ul><li>self attentionæŒ‡çš„å°±æ˜¯transformerä¸­çš„attentionæœºåˆ¶ï¼Œç”¨å…¬å¼æ¥è¡¨è¾¾utterance $u$ ç»è¿‡attentionä¹‹åï¼Œå¾—åˆ°çš„è¡¨ç¤ºå¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">\cal O=MultiHeadAttention(U,U,U)</script></li></ul><ul><li><p>self attentionä¸self attentioå°±åœ¨è¾“å…¥ä¸ä¸€æ ·ï¼Œç”¨å…¬å¼æ¥è¡¨è¾¾utterance $u_i$ç»è¿‡attentionä¹‹åï¼Œå¾—åˆ°çš„è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\cal O=MultiHeadAttention(U_i,R,R) \\\cal O=MultiHeadAttention(R,U_i,U_i)</script></li></ul><blockquote><p>æ³¨æ„ï¼šattentionçš„è¾“å‡ºæ˜¯word2vecåˆå§‹åŒ–çš„ä¸‰ç»´å‘é‡ï¼</p></blockquote><h4 id="Fusion-Strategies"><a href="#Fusion-Strategies" class="headerlink" title="Fusion Strategies"></a>Fusion Strategies</h4><p>é¦–å…ˆæ˜ç¡®ä¸€ä¸‹ï¼Œç»è¿‡ä¸Šä¸€æ­¥ï¼Œæˆ‘ä»¬ç°åœ¨å¾—åˆ°çš„æ˜¯ï¼šå¯¹äºutterance $u_i$ in contextï¼Œè¡¨ç¤ºä¸ºï¼š$\{U_i^k\}_{k=1}^K,K=6$ï¼›å¯¹äºreponse rï¼Œè¡¨ç¤ºä¸ºï¼š$\{R^k\}_{k=1}^K,K=6$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨å¯¹äºç½‘ç»œçš„è¾“å…¥æ˜¯ï¼šcontextï¼š$\{U_i^k\}_{k=1}^K,1&lt;=i&lt;=m$ï¼Œresponseï¼š$\{R^k\}_{k=1}^K$ã€‚OKï¼Œæ¥ç€å¾€ä¸‹èµ°ï½</p><p>æˆ‘ä»¬å¾—åˆ°äº†è¿™ä¹ˆå¤šçš„è¡¨ç¤ºåï¼Œè¦å¾—åˆ°æœ€ç»ˆçš„matching scoreï¼Œå°±å¿…é¡»è¦å¯¹è¿™äº›è¡¨ç¤ºè¿›è¡Œèåˆï¼Œé‚£ä¹ˆæ€ä¹ˆèåˆå‘¢ï¼Ÿè®ºæ–‡é‡Œè€ƒè™‘äº†ä¸‰ç§èåˆç­–ç•¥ï¼š<strong>FES(Fusing at an early stage)ã€FIS(Fusion at an intermediate stage)ã€FLS(Fusion at the last stage)</strong>ã€‚ä¸‹é¢ä¾æ¬¡æ¥çœ‹ï½</p><h5 id="FES"><a href="#FES" class="headerlink" title="FES"></a>FES</h5><p>æ‰€è°“çš„FESæŒ‡çš„æ˜¯ï¼Œåœ¨utteranceä¸responseè¿›è¡Œäº¤äº’ä¹‹å‰ï¼Œå°±å°†å„ç§è¡¨ç¤ºè¿›è¡Œèåˆã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºutterance $u_i$æ¥è¯´ï¼Œå®ƒçš„6ç§è¡¨ç¤ºå¯ä»¥è¡¨è¿°ä¸ºï¼š$\{U_i^k\}_{k=1}^K,K=6$ï¼Œç”±äºè¿™6ç§è¡¨ç¤ºéƒ½æ˜¯ä¸‰ç»´çš„ï¼Œä¸”batch_sizeç»´åº¦ä¸seq_lengtç»´åº¦ç›¸åŒï¼Œæ‰€ä»¥ä¸€ä¸ªåšæ³•å°±æ˜¯å°†è¿™6ç§è¡¨ç¤ºåœ¨æœ€åä¸€ä¸ªç»´åº¦ä¸Šè¿›è¡Œconcatï¼Œæœ€åå¾—åˆ°çš„å‘é‡ä¸ºï¼šU_i*ï¼Œå…¶ç»´åº¦æ˜¯ï¼š(batch_size,seq_length_u_i,hidden_units)ï¼›åŒæ ·çš„ï¼Œå¾—åˆ°çš„reponseçš„å‘é‡ä¸ºï¼šR*ï¼Œå…¶ç»´åº¦æ˜¯ï¼š(batch_size,seq_length_r,hidden_units)ã€‚</p><p>å¾—åˆ°æ¯ä¸€ä¸ªutteranceä¸responseçš„è¡¨ç¤ºä¹‹åï¼Œå°±éœ€è¦å¯¹utterance in contextä¸responseè¿›è¡Œäº¤äº’ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/FES.jpg" style="zoom:50%;"></p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/Xnip2020-06-08_16-04-22.jpg" style="zoom:50%;"></p><p>ç„¶åå°† U_i*  ä¸   $\overline e_{i,j}$ ä¸€èµ·é€å…¥CompAggæ¨¡å‹ä¸­æå‡ºçš„SUBMULT+NNæ–¹æ³•ä¸­ï¼Œä»è€Œå¾—åˆ° $T_i^*\in R^{n_i\times d}$ã€‚å…·ä½“ $t_{i,j}$ çš„è®¡ç®—å¦‚ä¸‹ï¼š</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/Xnip2020-06-08_16-08-07.jpg" style="zoom:50%;"></p><p>ç„¶ååœ¨æ­¤åŸºç¡€ä¸Šï¼Œä½¿ç”¨GRU+MLPï¼Œå¾—åˆ°æœ€ç»ˆçš„matching scoreã€‚</p><h5 id="FIS"><a href="#FIS" class="headerlink" title="FIS"></a>FIS</h5><p>åœ¨FISä¸­ï¼Œå¯¹æ¯ç§è¡¨ç¤ºå½¢å¼éƒ½æ‰§è¡Œutteranceä¸responseäº¤äº’ã€‚ç„¶åå¯¹ç»“æœè¿›è¡Œfusionï¼Œåœ¨ç»è¿‡GRU+MLPï¼Œå¾—åˆ°matching scoreã€‚</p><h5 id="FLS"><a href="#FLS" class="headerlink" title="FLS"></a>FLS</h5><p>åœ¨FLSä¸­ï¼Œå¯¹æ¯ç§è¡¨ç¤ºå½¢å¼éƒ½æ‰§è¡Œutteranceä¸responseäº¤äº’ï¼Œç»è¿‡GRUï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œfusionï¼Œåœ¨ç»è¿‡GRU+MLPï¼Œå¾—åˆ°matching scoreã€‚</p><p>ç»“æœè¯æ˜ï¼ŒFLSæ•ˆæœæœ€å¥½ã€‚</p><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><ul><li>æ•°æ®é›†ï¼šUDCã€douban</li><li>è¯„ä»·æŒ‡æ ‡ï¼šMAPã€MRRã€$P@1$ã€$R_n@k$</li><li>sequential representationä½¿ç”¨çš„GRUçš„ç»´åº¦ä¸º200ï¼Œå…¶ä»–éƒ¨åˆ†ä½¿ç”¨çš„GRUçš„æœ€ä½³ç»´åº¦æ˜¯1000</li><li>batch sizeä¸º100ï¼Œå­¦ä¹ ç‡ä¸º0.001ï¼Œé‡‡ç”¨earlystoping</li></ul><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-MRFN/Xnip2020-06-08_16-30-41.jpg" alt></p><p>ç»“æœä¸é”™ï½</p><p>æœ€åè¯´ä¸€ç‚¹ç‚¹å­ï¼Œå…³äºæ£€ç´¢å¼å¯¹è¯è¿‘æœŸå¯èƒ½ä¸ä¼šå†çœ‹äº†ã€‚çœ‹äº†è¿™ä¹ˆå¤šç¯‡paperï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯representation-matching-aggregationè¿™æ ·ä¸€ä¸ªæ¡†æ¶ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½èƒ½å¤Ÿå»åšä¿®æ”¹å’Œæ¢ç´¢ã€‚ä¹‹åå¯èƒ½ä¼šå»çœ‹çœ‹ç”Ÿæˆå¼å¯¹è¯çš„ä¸œè¥¿ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæ€»æ˜¯å¯¹ç”Ÿæˆå¼ä»»åŠ¡æœ‰ç€è°œä¸€èˆ¬çš„æ‰§å¿µğŸ¤£ï¼‰ï¼Œç„¶åå¯èƒ½å†å»çœ‹çœ‹å¼ºåŒ–å­¦ä¹ çš„ä¸œè¥¿å§ï¼Œæ¯•ç«Ÿå¯¹è¯è¦ç¦»å¼€DRLçš„ä¸œè¥¿å¾ˆéš¾ã€‚å…¶å®æˆ‘è¿˜æ˜¯è›®æƒ³åšpretrainingçš„ä¸œè¥¿ï¼Œæˆ–è€…MRC/VQAä¹Ÿè¡Œå•Š(å¦‚æœæœ‰äººå¸¦æˆ‘çš„è¯)ï¼Œä½†æ˜¯æ‘¸å¾—GPUå•Šï¼Œè¦æ˜¯internèƒ½åšpreretrainingè¿™å—çš„è¯ï¼Œå°±ç°å¸¸å¥½äº†(æ´—æ´—ç¡å§)ã€‚ç„¶åä¸»è¦å°±æ˜¯å»åšå®ç°è¿™å—å§ï¼Œæ„Ÿè§‰ä»£ç èƒ½åŠ›è¿˜æ˜¯è›®é‡è¦çš„ã€‚å°±æ˜¯è¿™æ ·äº†ï¼Œkeep learningï¼ŒåŠ æ²¹ï½</p><h2 id="MRFNæ¨¡å‹å®ç°"><a href="#MRFNæ¨¡å‹å®ç°" class="headerlink" title="MRFNæ¨¡å‹å®ç°"></a>MRFNæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Multi-Representation Fusion Network for Multi-turn Response Selection in Retrieval-based Chatbots</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> chatbot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> MRFN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|chatbotç³»åˆ—-IMN</title>
      <link href="2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/"/>
      <url>2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å…¥å¯¹è¯çš„å‘å•¦ğŸ¤£å¯¹è¯æ˜¯ç›®å‰NLPæŠ€æœ¯é‡è¦çš„è½åœ°åœºæ™¯ä¹‹ä¸€ï¼Œä½†æ˜¯ç›¸æ¯”äºå…¶ä»–çš„æ–¹å‘ï¼Œå¯¹è¯ç›®å‰çš„åº”ç”¨è¿˜ä¸ç®—æˆç†Ÿï¼Œä¹Ÿè¿œè¿œæ²¡æœ‰äº§ç”Ÿå®ƒåº”æœ‰çš„å·¨å¤§å•†ä¸šä»·å€¼ï¼Œä½†æ˜¯éšç€ç‰©è”ç½‘ä¸5Gç­‰çš„å‘å±•ï¼Œå¯¹è¯çš„åº”ç”¨å‰æ™¯æ˜¯éå¸¸å…‰æ˜çš„ã€‚æ­¤å¤–ï¼Œæ—¢ç„¶å¯¹è¯çš„å‘è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€»éœ€è¦äººå»å¡«æ»¡è¿™äº›å‘ï¼Œå¯¹NLPeræ¥è¯´ï¼Œæ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºä¼šã€‚å…¶ä»–çš„ä¸å¤šè¯´ï¼Œæœ¬ç¯‡ç€é‡è®²è®²æ£€ç´¢å¼å¯¹è¯çš„ç»å…¸æ¨¡å‹IMNã€‚</p><a id="more"></a><h2 id="IMNæ¨¡å‹ä»‹ç»"><a href="#IMNæ¨¡å‹ä»‹ç»" class="headerlink" title="IMNæ¨¡å‹ä»‹ç»"></a>IMNæ¨¡å‹ä»‹ç»</h2><p>IMNæ˜¯2019å¹´ä¸­ç§‘å¤§å‘è¡¨åœ¨CIKMä¸Šçš„ä¸€ç¯‡è®ºæ–‡ï¼Œæ•´ä¸ªæ¨¡å‹ä¸SMNæ¯”è¾ƒåƒï¼Œä½†æ˜¯åšäº†å¾ˆå¤šçš„æ”¹è¿›ï¼Œå®éªŒä¹Ÿåšçš„æ¯”è¾ƒæ‰å®ã€‚æ€»çš„æ¥çœ‹ï¼šIMNæ¨¡å‹çš„ä¼˜åŠ¿åœ¨äºï¼š1.ä½¿ç”¨char embeddingæ¥è§£å†³OOVé—®é¢˜ï¼ŒåŒæ—¶ä¹ŸåŠ å¼ºäº†wordçš„è¡¨ç¤ºï¼›2.ä½¿ç”¨äº†ç±»ä¼¼äºELMoçš„ç»“æ„æ¥åšsentence encoderï¼Œä»è€Œå¢å¼ºsentenceçš„è¡¨ç¤ºï¼›3.ä½¿ç”¨å…¨å±€çš„æ–¹å¼æ¥è®©contextä¸responseè¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯ä»¥å¾€çš„é‚£ç§æ¯ä¸€ä¸ªutterance in contextåˆ†åˆ«ä¸responseè¿›è¡Œäº¤äº’ï¼Œä»è€Œèƒ½å¤ŸæŒ‘é€‰å‡ºcontextä¸­ä¸responseæœ€ç›¸å…³çš„éƒ¨åˆ†(æœ‰ç‚¹poolingçš„å‘³é“ï¼ŸğŸ§)ã€‚ä¸‹é¢ç›´æ¥ä»‹ç»å§ï½</p><h3 id="IMNæ¨¡å‹æ¶æ„"><a href="#IMNæ¨¡å‹æ¶æ„" class="headerlink" title="IMNæ¨¡å‹æ¶æ„"></a>IMNæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆç»™å‡ºå®šä¹‰ï¼šç»™å‡ºæ•°æ®é›†ï¼š$\cal D=\{c,r,y\}_1^N$ï¼Œå…¶ä¸­$c=\{u_1,u_2,â€¦,u_n\}$ï¼Œè¡¨ç¤ºcontextï¼›rè¡¨ç¤ºresponseï¼Œ$y=\{0,1\}$ï¼Œè¡¨ç¤ºæ ‡ç­¾ï¼Œç›®æ ‡æ˜¯ï¼šå¾—åˆ°contextä¸responseçš„åŒ¹é…åº¦ã€‚ä¸‹é¢ç»™å‡ºæ¶æ„å›¾ï½</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/IMN.jpg" alt></p><p>IMNæ¨¡å‹æ€»å…±åˆ†ä¸º5éƒ¨åˆ†ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»ï½</p><h4 id="word-representation-layer"><a href="#word-representation-layer" class="headerlink" title="word representation layer"></a>word representation layer</h4><p>è¿™ä¸€éƒ¨åˆ†æ˜¯æ¨¡å‹æœ€åˆçš„è¾“å…¥ï¼Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼špre-train word embeddingã€training set word embeddingã€character embeddingï¼Œåˆ†åˆ«å¯¹åº”äºï¼šæ–¯å¦ç¦å‘å¸ƒçš„GloVe/Googleçš„word2vecè¯å‘é‡ã€åœ¨è®­ç»ƒé›†ä¸Šä½¿ç”¨word2vecå¾—åˆ°çš„è¯å‘é‡ã€å­—å‘é‡(éšæœºåˆå§‹åŒ–)ã€‚æœ€ç»ˆçš„è¾“å‡ºæ˜¯è¿™ä¸‰ä¸ªembeddingçš„concatï¼Œè¡¨ç¤ºä¸ºï¼š$U_{k}^{0}=\{u_{k,i}^{0}\}_{i=1}^{l_{u_k}}$ã€$R^0=\{r_{j}^{0}\}_{j=1}^{l_r}$ï¼Œ$u_{k,i}^{0}\in R^dã€r_{j}^{0}\in R^d$ã€‚</p><blockquote><p>æ³¨æ„ï¼šå½“ä¸€ä¸ªæ¨¡å‹çš„è¾“å…¥æ—¢æœ‰word embeddingåˆæœ‰char embeddingçš„æ—¶å€™ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªsentenceæ¥è¯´ï¼Œword embeddingä¸€å®šæ˜¯3ç»´çš„ï¼Œchar embeddingä¸€å®šæ˜¯4ç»´çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ˜¯æ— æ³•ç›´æ¥å°†word embeddingä¸char embeddingè¿›è¡Œconcatæˆ–è€…æ˜¯ä½œä¸ºä¸¤ä¸ªchannelï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿä»æˆ‘ç›®å‰çœ‹åˆ°çš„æ¨¡å‹ä¸­ï¼ŒåŸºæœ¬ä¸Šæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</p><p>1.å¯¹char embeddingè¿›è¡Œreshapeï¼Œå˜æˆ3ç»´çš„ï¼Œç„¶åè¾“å…¥ä¸€ä¸ªlstmä¸­ï¼Œç„¶åå°†lstmçš„è¾“å‡ºå†æ¬¡è¿›è¡Œreshapeï¼Œå°†ç»“æœä¸word embeddingè¿›è¡Œconcat/channelï¼›</p><p>2.å¯¹char embeddingè¿›è¡Œreshapeï¼Œå˜æˆ3ç»´çš„ï¼Œç„¶åè¾“å…¥åˆ°ä¸€ä¸ªcnnä¸­ï¼Œç„¶åå°†ç»“æœä½¿ç”¨reduce_mean,reduce_sumç­‰ç­‰æ“ä½œ(æˆ–è€…ä½¿ç”¨å…¨å±€æ± åŒ–)ï¼Œä½¿å¾—ç»“æœå˜æˆ2ç»´çš„ï¼Œç„¶åå†æ¬¡è¿›è¡Œreshapeï¼Œå°†ç»“æœä¸word embeddingè¿›è¡Œconcat/channelã€‚</p><p>åœ¨IMNæ¨¡å‹ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ³•ï¼Œè®ºæ–‡ä¸­æ²¡æœ‰å…·ä½“è¯´ï¼Œä½†æ˜¯å¦‚æœå»çœ‹å®ƒçš„å¼€æºä»£ç çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°å°±æ˜¯è¿™æ ·å®ç°çš„ã€‚å¦å¤–ï¼Œç¬¬ä¸€ç§æ–¹æ³•åœ¨BIMPMæ¨¡å‹ä¸­æœ‰ç”¨åˆ°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»ç¿»ç¿»æˆ‘ä¹‹å‰å…³äºBIMPMæ¨¡å‹çš„è§£è¯»ï½</p></blockquote><h4 id="sentence-encoding-layer"><a href="#sentence-encoding-layer" class="headerlink" title="sentence encoding layer"></a>sentence encoding layer</h4><p>è¿™ä¸€å±‚ä¸»è¦æ˜¯æå‡ºäº†ä¸€ä¸ªsentence encoderï¼Œä»è€Œæ¥å¾—åˆ°ä¸€ä¸ªå¥½çš„sentence embeddingã€‚é‚£å…·ä½“æ€ä¹ˆåšçš„å‘¢ï¼Ÿåœ¨IMNæ¨¡å‹ä¸­ï¼Œå®ƒå€Ÿé‰´äº†ELMoæ¨¡å‹ä¸­çš„ç»“æ„ã€‚ä¸ä»¥å¾€çš„æ¨¡å‹ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯å †å å¤šå±‚çš„BILSTMï¼ˆè®ºæ–‡é‡Œæ˜¯ä¸‰å±‚ï¼‰ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œä»¥å¾€çš„å¾ˆå¤šæ¨¡å‹åªä½¿ç”¨æœ€é¡¶å±‚çš„BILSTMçš„è¾“å‡ºï¼Œè€Œå¿½ç•¥äº†ä¸­é—´å±‚çš„è¾“å‡ºç»“æœã€‚å®é™…ä¸Šï¼Œä¸­é—´å±‚çš„è¾“å‡ºç»“æœåŒæ ·ä¹Ÿè¡¨ç¤ºäº†å¾ˆå¤šçš„ä¿¡æ¯ï¼Œåªæ˜¯ç›¸å¯¹äºé«˜å±‚çš„è¾“å‡ºè€Œè¨€ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯è¾ƒä¸ºä½å±‚çš„è¯­ä¹‰ç‰¹å¾ã€‚æ‰€ä»¥ï¼Œä¸ºäº†å¾—åˆ°æ›´å¥½çš„sentence embeddingï¼ŒIMNæ¨¡å‹ä¸­å°†æ‰€æœ‰å±‚çš„è¾“å‡ºéƒ½ä¿ç•™ä¸‹æ¥ï¼Œå¹¶ä¸”è¿˜è®­ç»ƒäº†softmaxï¼Œå¾—åˆ°äº†æ‰€æœ‰å±‚çš„æƒé‡ï¼Œæœ€ç»ˆçš„è¾“å‡ºæ˜¯æ‰€æœ‰å±‚çš„åŠ æƒæ±‚å’Œï¼Œå®ƒæŠŠè¿™ç§ç»“æ„å«åšï¼š<strong>attentive hierarchical recurrent encoder (AHRE)</strong>ã€‚ä¸‹é¢ç”¨å…¬å¼æ¥è¡¨è¾¾ï¼š</p><p>æœ‰Mä¸ªå±‚ï¼Œå¯¹äºç¬¬kä¸ªutteranceï¼Œè¡¨ç¤ºä¸ºï¼š$\{U_k^1,U_k^2,â€¦,U_k^M\}$ï¼Œresponseè¡¨ç¤ºä¸ºï¼š$\{R^1,R^2,â€¦,R^M\}$ï¼›æœ€ç»ˆcontextçš„è¾“å‡ºè¡¨ç¤ºä¸ºï¼š$U_K^{enc}=\{u_{k,i}^{enc}\}_{i=1}^{l_{u_k}}$ï¼Œresponseçš„è¾“å‡ºä¸ºï¼š$R^{enc}=\{r_{j}^{enc}\}_{j=1}^{l_r}$ï¼Œå…¶ä¸­ï¼š</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/ahe.jpg" style="zoom:50%;"></p><h4 id="matching-layer"><a href="#matching-layer" class="headerlink" title="matching layer"></a>matching layer</h4><p>åœ¨è¿™å—ï¼ŒIMNæ¨¡å‹ä¸­é‡‡ç”¨çš„æ˜¯å°†æ•´ä¸ªcontextä¸responseè¿›è¡Œmatchï¼Œè€Œä¸æ˜¯æ¯ä¸€ä¸ªutteranceåˆ†åˆ«ä¸responseè¿›è¡Œmatchã€‚é‚£ä¹ˆï¼Œcontextè¡¨ç¤ºä¸ºï¼š$C^{enc}=\{c_i^{enc}\}_{i=1}^{l_c} \ where \ \ l_c=\sum_{k=1}^{n}l_{u_k}$ã€‚ç„¶åå°†contextä¸responseè¿›è¡Œdot preductï¼Œå³ï¼š$e_{ij}=(c_i^{enc})^T r_j^{enc}$ã€‚ç„¶ååœ¨æ­¤åŸºç¡€ä¸Šï¼Œè®¡ç®—context-to-response representation $\overline R^{enc}=\{\overline r_j^{enc}\}_{j=1}^{l_r}$ä¸response-to-context representation $\overline C^{enc}=\{\overline c_i^{enc}\}_{i=1}^{l_c}$ï¼Œä¾æ¬¡å¦‚ä¸‹ï¼š</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/rc.jpg" style="zoom:50%;"></p><p>$\overline c_i^{enc}$çš„è®¡ç®—æ–¹æ³•ä¸$\overline r_j^{enc}$ä¸€æ ·ã€‚ç„¶ååœ¨æ­¤åŸºç¡€ä¸Šï¼Œå½¢æˆä¸¤ä¸ªçŸ©é˜µï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/matrix.jpg" style="zoom:50%;"></p><p>å¦å¤–ï¼Œå¾—åˆ°$C^{mat}$ä¹‹åï¼Œéœ€è¦è¿›è¡Œseperateï¼Œå› ä¸ºä¸€å¼€å§‹æ˜¯è¿›è¡Œäº†flattenï¼Œå¾—åˆ°$\{U_k^{mat}\}_{k=1}^{n}$ã€‚</p><h4 id="aggregation-layer"><a href="#aggregation-layer" class="headerlink" title="aggregation layer"></a>aggregation layer</h4><p>è¿™ä¸€å±‚å°±æ˜¯å°†ä¸Šä¸€å±‚çš„è¾“å‡ºï¼š$\{U_k^{mat}\}_{k=1}^{n}$ä»¥åŠ$R^{mat}$ä½œä¸ºè¾“å…¥ï¼Œç„¶åç»è¿‡BILSTMï¼Œå¾—åˆ°ï¼š$U^{agr}=\{u_k^{agr}\}_{k=1}^{n}$ä¸$r^{agr}$ã€‚ç”±äºå¾—åˆ°çš„$U^{agr}=\{u_k^{agr}\}_{k=1}^{n}$æ˜¯ä¸€ä¸ªä¸‰ç»´çš„å‘é‡ï¼Œæ‰€ä»¥å†ç»è¿‡ä¸€å±‚BILSTMï¼Œå¾—åˆ°$c^{agr}$ã€‚æœ€ç»ˆçš„è¾“å‡ºæ˜¯ï¼š$m=[c^{agr};r^{agr}]$ã€‚</p><h4 id="prediction-layer"><a href="#prediction-layer" class="headerlink" title="prediction layer"></a>prediction layer</h4><p>è¿™ä¸€å±‚æ˜¯å°†$m$è¾“å…¥åˆ°ä¸€ä¸ªMLPä¸­ï¼Œæ¿€æ´»å‡½æ•°ä¸ºreluï¼Œç„¶åå†ç»è¿‡çº¿æ€§å±‚ï¼Œä½¿ç”¨sigmoidï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºç»“æœã€‚æœ€ç»ˆçš„æŸå¤±å‡½æ•°ä¸ºcross entropyã€‚</p><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><ul><li>æ•°æ®é›†ï¼šUDC V1ï¼ŒUDC V2ï¼Œdoubanï¼Œe-commerce dialogue corpus</li><li>è¯„ä»·æŒ‡æ ‡ï¼š$R_n@k$ã€MAPã€MRRã€$P@1$</li><li>ä¼˜åŒ–å™¨ï¼šadam</li><li>å¯¹äºä¸­æ–‡æ•°æ®é›†ï¼Œbatch sizeä¸º128ï¼Œè‹±æ–‡æ•°æ®é›†ä¸º96</li><li>åˆå§‹å­¦ä¹ ç‡ä¸º0.001ï¼Œæ¯5000stepæŒ‡æ•°è¡°å‡0.96</li><li>dropoutåº”ç”¨ä¸word embeddingä¸æ‰€æœ‰çš„éšè—å±‚ï¼Œdropoutä¸º0.2</li><li>ä½¿ç”¨300ç»´çš„GloVeè¯å‘é‡ï¼Œ100ç»´çš„ä½¿ç”¨word2vecè®­ç»ƒè®­ç»ƒé›†å¾—åˆ°çš„è¯å‘é‡ï¼Œä½¿ç”¨150ç»´çš„char embedding(ä½¿ç”¨äº†3ä¸ªå·ç§¯å±‚[3,4,5]ï¼Œæ¯ä¸€æ¬¡å·ç§¯æœ‰50ä¸ªfilters)</li></ul><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/06/04/NLP-chatbot%E7%B3%BB%E5%88%97-IMN/ç»“æœ.jpg" alt></p><p>ä»ç»“æœä¸Šçœ‹ï¼ŒIMNè¡¨ç°è¿˜æ˜¯ä¸é”™çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç–‘é—®ï¼ŒCompAggä»¥åŠBIMPMä¹Ÿå¯ä»¥ç”¨äºå¤šè½®å¯¹è¯å—ï¼ŸğŸ§</p><h2 id="IMNæ¨¡å‹å®ç°"><a href="#IMNæ¨¡å‹å®ç°" class="headerlink" title="IMNæ¨¡å‹å®ç°"></a>IMNæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Interactive Matching Network for Multi-Turn Response Selection in Retrieval-Based Chatbots</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> chatbot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> IMN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|chatbotç³»åˆ—-DAM</title>
      <link href="2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/"/>
      <url>2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å…¥å¯¹è¯çš„å‘å•¦ğŸ¤£å¯¹è¯æ˜¯ç›®å‰NLPæŠ€æœ¯é‡è¦çš„è½åœ°åœºæ™¯ä¹‹ä¸€ï¼Œä½†æ˜¯ç›¸æ¯”äºå…¶ä»–çš„æ–¹å‘ï¼Œå¯¹è¯ç›®å‰çš„åº”ç”¨è¿˜ä¸ç®—æˆç†Ÿï¼Œä¹Ÿè¿œè¿œæ²¡æœ‰äº§ç”Ÿå®ƒåº”æœ‰çš„å·¨å¤§å•†ä¸šä»·å€¼ï¼Œä½†æ˜¯éšç€ç‰©è”ç½‘ä¸5Gç­‰çš„å‘å±•ï¼Œå¯¹è¯çš„åº”ç”¨å‰æ™¯æ˜¯éå¸¸å…‰æ˜çš„ã€‚æ­¤å¤–ï¼Œæ—¢ç„¶å¯¹è¯çš„å‘è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€»éœ€è¦äººå»å¡«æ»¡è¿™äº›å‘ï¼Œå¯¹NLPeræ¥è¯´ï¼Œæ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºä¼šã€‚å…¶ä»–çš„ä¸å¤šè¯´ï¼Œæœ¬ç¯‡ç€é‡è®²è®²æ£€ç´¢å¼å¯¹è¯çš„ç»å…¸æ¨¡å‹DAMã€‚</p><a id="more"></a><h2 id="DAMæ¨¡å‹ä»‹ç»"><a href="#DAMæ¨¡å‹ä»‹ç»" class="headerlink" title="DAMæ¨¡å‹ä»‹ç»"></a>DAMæ¨¡å‹ä»‹ç»</h2><p>DAMæ¨¡å‹æ˜¯2018å¹´ç™¾åº¦å‘è¡¨çš„è®ºæ–‡ï¼Œæ€è·¯éå¸¸æ¸…æ™°ã€‚ç”±äºä¼ ç»Ÿçš„RNNå¹¶è¡Œæ•ˆç‡ä½ï¼Œæ‰€ä»¥DAMæ¨¡å‹ä¸­å…¨éƒ¨ä½¿ç”¨äº†self-attentionæœºåˆ¶ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨å¤šä¸ªç²’åº¦ä¸Šå»åŒ¹é…æ–‡æœ¬ï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´åŠ é«˜å±‚çš„è¯­ä¹‰ç‰¹å¾ï¼Œå¯¹ç»“æœæœ‰å¥½å¤„ï¼Œè¿™ä¸ªåœ¨SSEæ¨¡å‹ä¸Šè¯æ˜äº†è¿™ä¸€ç‚¹ã€‚ä¸‹é¢å°±å…·ä½“åœ°æ¥è®²è§£è¿™äº›DAMæ¨¡å‹ç»†èŠ‚ï½(psï¼šè¿™ç¯‡è®ºæ–‡è¿˜æ€»ç»“äº†æ£€ç´¢å¼å¯¹è¯ä¸ç”Ÿæˆå¼å¯¹è¯çš„åŒºåˆ«ï¼Œéå¸¸å€¼å¾—ä¸€è¯»)</p><h3 id="DAMæ¨¡å‹æ¶æ„"><a href="#DAMæ¨¡å‹æ¶æ„" class="headerlink" title="DAMæ¨¡å‹æ¶æ„"></a>DAMæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆç»™å‡ºä¸€äº›å®šä¹‰ï¼šç»™å®šè®­ç»ƒé›†ï¼š$\cal D=\{c,r,y\}_{z=1}^{N}$ï¼Œå…¶ä¸­ï¼Œ$c=\{u_0,u_1,â€¦,u_{n-1}\}$ï¼Œ$y=\{0,1\}$ï¼Œcè¡¨ç¤ºcontextï¼Œrè¡¨ç¤ºresponseï¼Œyè¡¨ç¤ºæ ‡ç­¾ï¼Œç›®æ ‡æ˜¯ï¼šè¡¡é‡ä¸cä¸rä¹‹é—´çš„åŒ¹é…åº¦ã€‚ä¸‹é¢ç›´æ¥ç»™å‡ºæ¨¡å‹å›¾å§ï½</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/DAM.jpg" alt></p><p>DAMæ¨¡å‹å¤§è‡´éµå¾ªï¼šrepresentation-matching-aggregationæ¡†æ¶ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»ï½</p><h4 id="Input-layer"><a href="#Input-layer" class="headerlink" title="Input layer"></a>Input layer</h4><p>cä¸rå…±äº«word embeddingï¼Œå¯¹äºç¬¬iä¸ªutterance in contextï¼Œå®ƒçš„è¡¨ç¤ºä¸ºï¼š$U_{i}^{0}=\{e_{u_i,0}^{0},e_{u_i,1}^{0}â€¦,e_{u_i,n_{u_i}-1}^{0}\}$ï¼Œå¯¹äºresponseï¼Œè¡¨ç¤ºä¸ºï¼š$R^0=\{e_{r,0}^{0},e_{r,1}^{0},â€¦,e_{r,n_r-1}^{0}\}$ã€‚</p><h4 id="representation-layer-and-matching-layer"><a href="#representation-layer-and-matching-layer" class="headerlink" title="representation layer and matching layer"></a>representation layer and matching layer</h4><p>è¿™ä¸€å±‚ä¸»è¦æ˜¯å åŠ å¤šä¸ªself attentionï¼Œä»è€Œæå–å‡ºå¤šä¸ªç²’åº¦çš„è¯­ä¹‰è¡¨ç¤ºã€‚å‡è®¾æœ‰Lå±‚ï¼Œé‚£ä¹ˆæ¯ä¸€å±‚çš„ç»“æœéƒ½è¢«ä¿å­˜ä¸‹æ¥ï¼Œå³ï¼š$\{U_{i}^{0},U_{i}^{1},â€¦,U_{i}^{L}\}_{i=0}^{n-1}$ï¼Œ$\{R^{0},R^{1},â€¦,R^{L}\}$ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">U_{i}^{l+1}=attentiveModule(U_{i}^{l},U_{i}^{l},U_{i}^{l}) \\R^{l+1}=attentiveModule(R^{l},R^{l},R^{l})</script><p>ç„¶åï¼Œæ ¹æ®è¿™äº›ç»“æœï¼Œæ¥æ„å»ºself attention match matrix $M_{self}^{u_i,r,l}$ä¸cross attention match matrix $M_{cross}^{u_i,r,l}$ã€‚é‚£ä¹ˆï¼Œå…·ä½“æ€ä¹ˆæ¥æ„å»ºå‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/self attention.jpg" style="zoom:50%;"></p><p>è¦è®¡ç®—$M_{cross}^{u_i,r,l}$ï¼Œéœ€è¦è®¡ç®—cross attentionçš„å€¼ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">U_{i}^{l}=attentiveModule(U_{i}^{l},R^{l},R^{l}) \\R^{l}=attentiveModule(R^{l},U_{i}^{l},U_{i}^{l})</script><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/cross attention.jpg" style="zoom:50%;"></p><p>ä»å…¬å¼å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç§matrixçš„æ„å»ºå®é™…ä¸Šå°±æ˜¯dot productã€‚<strong>æœ€ç»ˆï¼Œå¯¹äºæ¯ä¸€ä¸ªutterance in contextçš„æ¯ä¸€å±‚æ¥è¯´ï¼Œæ¯ä¸€ä¸ªçŸ©é˜µçš„ç»´åº¦æ˜¯ï¼š(batch_size,max_length_utterance,max_length_response)ã€‚</strong></p><h4 id="aggregation-layer"><a href="#aggregation-layer" class="headerlink" title="aggregation layer"></a>aggregation layer</h4><p>aggregation layerçš„è¾“å…¥ç»´åº¦æ˜¯ï¼š(batch_size,num_utterance,max_length_utterance,max_length_response,2(L+1))ï¼Œè¿™æ˜¯ä¸€ä¸ªäº”ç»´å‘é‡ã€‚æˆ‘ä»¬è®°åšï¼š$Q=\{\cal Q_{i,k,t}\}_{n\times n_{u_i},r}$ã€‚å®ƒæ˜¯self attentionä¸cross attentionçŸ©é˜µconcatä¹‹åçš„ç»“æœã€‚ç„¶åå¯¹å…¶ä½¿ç”¨ä¸¤å±‚çš„ä¸‰ç»´å·ç§¯ï¼ˆæ¯ä¸€å±‚éƒ½æ¥ä¸Šæœ€å¤§æ± åŒ–ï¼‰ï¼Œç¬¬äºŒä¸ªæœ€å¤§æ± åŒ–æ˜¯å…¨å±€æœ€å¤§æ± åŒ–ï¼Œå¾—åˆ°çš„è¾“å‡ºç»´åº¦æ˜¯ï¼š(batch_size,filters)ï¼Œæœ€ç»ˆå°†è¾“å‡ºé€å…¥ä¸€å±‚preceptronä¸­ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/preceptron.jpg" style="zoom:50%;"></p><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><ul><li><p>æ•°æ®é›†ï¼šUbuntu Corpusã€Douban Conversation Corpus</p></li><li><p>è¯„ä»·æŒ‡æ ‡ï¼š$R_n@k$ï¼ŒMRRï¼ŒMAP</p></li><li>loss functionï¼š</li></ul><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/loss function.jpg" style="zoom:50%;"></p><ul><li>æ¯ä¸€ä¸ªcontextæœ€å¤šæœ‰9ä¸ªutteranceï¼Œæ¯ä¸€ä¸ªutterance(reponse)æœ€å¤šæœ‰50ä¸ªword</li><li>word embeddingä½¿ç”¨word2vecå¾—åˆ°çš„è¯å‘é‡ï¼Œç»´åº¦æ˜¯200</li><li>FFNçš„ç»´åº¦ä¸º200ï¼Œself attentionå±‚æœ€å¤§æ˜¯7å±‚ï¼Œæœ€åæ˜¯5å±‚æœ€å¥½</li><li>ç¬¬ä¸€ä¸ªå·ç§¯å±‚æœ‰32ä¸ª[3,3,3]çš„filtersï¼Œstrideä¸º[1,1,1]ï¼Œæœ€å¤§æ± åŒ–å¤§å°ä¸º[3,3,3]ï¼Œstrideä¸º[3,3,3]ï¼›ç¬¬äºŒä¸ªå·ç§¯å±‚æœ‰16ä¸ª[3,3,3]filtersï¼Œstrideä¸º[1,1,1]ï¼Œæœ€å¤§æ± åŒ–å¤§å°ä¸º[3,3,3]ï¼Œstrideä¸º[3,3,3]</li><li>batch szie ä¸º256</li></ul><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DAM/ç»“æœ.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼ŒDAMæ¨¡å‹æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï½</p><h2 id="DAMæ¨¡å‹å®ç°"><a href="#DAMæ¨¡å‹å®ç°" class="headerlink" title="DAMæ¨¡å‹å®ç°"></a>DAMæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Multi-Turn Response Selection for Chatbots with Deep Attention Matching Network</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> chatbot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> DAM </tag>
            
            <tag> tensorflow2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|chatbotç³»åˆ—-DUA</title>
      <link href="2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/"/>
      <url>2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å…¥å¯¹è¯çš„å‘å•¦ğŸ¤£å¯¹è¯æ˜¯ç›®å‰NLPæŠ€æœ¯é‡è¦çš„è½åœ°åœºæ™¯ä¹‹ä¸€ï¼Œä½†æ˜¯ç›¸æ¯”äºå…¶ä»–çš„æ–¹å‘ï¼Œå¯¹è¯ç›®å‰çš„åº”ç”¨è¿˜ä¸ç®—æˆç†Ÿï¼Œä¹Ÿè¿œè¿œæ²¡æœ‰äº§ç”Ÿå®ƒåº”æœ‰çš„å·¨å¤§å•†ä¸šä»·å€¼ï¼Œä½†æ˜¯éšç€ç‰©è”ç½‘ä¸5Gç­‰çš„å‘å±•ï¼Œå¯¹è¯çš„åº”ç”¨å‰æ™¯æ˜¯éå¸¸å…‰æ˜çš„ã€‚æ­¤å¤–ï¼Œæ—¢ç„¶å¯¹è¯çš„å‘è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€»éœ€è¦äººå»å¡«æ»¡è¿™äº›å‘ï¼Œå¯¹NLPeræ¥è¯´ï¼Œæ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºä¼šã€‚å…¶ä»–çš„ä¸å¤šè¯´ï¼Œæœ¬ç¯‡ç€é‡è®²è®²æ£€ç´¢å¼å¯¹è¯çš„ç»å…¸æ¨¡å‹DUAã€‚</p><a id="more"></a><h2 id="DUAæ¨¡å‹ä»‹ç»"><a href="#DUAæ¨¡å‹ä»‹ç»" class="headerlink" title="DUAæ¨¡å‹ä»‹ç»"></a>DUAæ¨¡å‹ä»‹ç»</h2><p>DUAæ¨¡å‹æ˜¯2018å¹´SJTUæ‰€å‘è¡¨çš„ä¸€ç¯‡è®ºæ–‡ï¼Œåœ¨æ£€ç´¢å¼å¯¹è¯å½“ä¸­ä¹Ÿæ˜¯éå¸¸æœ‰å½±å“åŠ›çš„ä¸€ç‰‡è®ºæ–‡ã€‚ä¸ç®¡æ˜¯Multi-viewè¿˜æ˜¯SMNæ¨¡å‹ï¼Œå…¶å®å¹¶æ²¡æœ‰å¯¹utterancesä¹‹é—´çš„å…³ç³»è¿›è¡Œå¾ˆå¥½çš„å»ºæ¨¡(å³ä½¿æ˜¯åœ¨SMNä¸­ï¼Œä¹Ÿåªæ˜¯å¯¹utterancesä½¿ç”¨ç®€å•çš„GRUå°±å®Œäº‹äº†)ï¼Œè€Œä¸”æ¯ä¸€ä¸ªutteranceå¯¹äºå¾—åˆ°åˆç†responseçš„ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸åº”è¯¥äº«æœ‰åŒæ ·çš„æƒé‡(attention)ï¼Œæ‰€ä»¥ï¼ŒDUAæ¨¡å‹é’ˆå¯¹äºè¿™ä¸€ç‚¹åšå‡ºäº†æ”¹è¿›ï¼Œå¯¹utteranceä¹Ÿè¿›è¡Œäº†æ·±åº¦çš„encodingã€‚ä¸‹é¢å°†ä»‹ç»DUAæ¨¡å‹çš„è¯¦ç»†ç»†èŠ‚ï¼Œ<strong>æ³¨æ„ï¼ŒDUAæ¨¡å‹ç›¸å¯¹æ¥è¯´ï¼Œä¸ªäººè®¤ä¸ºæœ‰äº›ç»†èŠ‚è¿˜æ˜¯æŒºéš¾ç†è§£de1ï¼Œç¬¦å·å®šä¹‰å¾—ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œè€Œä¸”è¯¥è®²æ¸…æ¥šçš„æ²¡è®²æ¸…æ¥šï¼Œæ‰€ä»¥ä¸€å®šè¦ä»”ç»†åœ°ä¸‹é¢çš„è®²è§£(æˆ–è€…åŸå§‹è®ºæ–‡)ï½</strong></p><blockquote><p>å›è¿‡å¤´æ¥çœ‹ï¼Œæˆ‘è¿˜æ˜¯è¦åæ§½ä¸€ä¸‹ï¼Œç¬¦å·å®šä¹‰çš„çœŸçš„ä¹±ä¸ƒå…«ç³Ÿï¼Œè¿™æ˜¯æˆ‘è¯»è¿‡çš„ç¬¦å·ä½¿ç”¨æœ€æ··ä¹±çš„paperã€‚ã€‚ã€‚</p></blockquote><h3 id="DUAæ¨¡å‹æ¶æ„"><a href="#DUAæ¨¡å‹æ¶æ„" class="headerlink" title="DUAæ¨¡å‹æ¶æ„"></a>DUAæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆç»™å‡ºä¸€äº›å®šä¹‰ï¼šè®­ç»ƒé›†çš„ä¸€ä¸ªsampleè¡¨ç¤ºä¸ºï¼š[C,R,Y]ï¼Œå…¶ä¸­$ C=\{U_1,U_2,â€¦,U_t\}$ï¼Œ å¦å¤–$U_k$è¡¨ç¤ºç¬¬kä¸ªutteranceï¼ŒRè¡¨ç¤ºä¸€ä¸ªresponseï¼ŒYè¡¨ç¤ºlabel(åˆç†å›å¤/ä¸åˆç†å›å¤)ã€‚ç›®æ ‡æ˜¯ï¼šè¡¡é‡contextäºresponseçš„åŒ¹é…åº¦ã€‚å…ˆç»™å‡ºæ¨¡å‹å›¾å§ï½</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/DUAæ¨¡å‹æ¶æ„.jpg" alt></p><p>æ¨¡å‹æ¶æ„å’ŒSMNæŒºåƒçš„ï¼Œä½†æ˜¯æ›´å¤æ‚äº†ï¼Œæœ‰äº›ç»†èŠ‚è¿˜æ˜¯æŒºéš¾æ‡‚çš„ï¼Œä¸‹é¢ä¾æ¬¡è®²è§£ï½</p><h4 id="utterance-representation"><a href="#utterance-representation" class="headerlink" title="utterance representation"></a>utterance representation</h4><ul><li>è¿™ä¸€å±‚é¦–å…ˆæ˜¯å°†æ¯ä¸€ä¸ªutterance in contextä»¥åŠresponseè¿›è¡Œencodingï¼Œå¾—åˆ°ç›¸åº”çš„utterance embeddingæˆ–response embeddingã€‚è¾“å…¥æ˜¯ï¼š$C=\{U_1,U_2,â€¦,U_t\}ã€R=[r_1,r_2,â€¦,r_{n_r}]$ï¼Œ$U_k$è¡¨ç¤ºç¬¬kä¸ªutteranceï¼Œä¸”ï¼š$U_k=[u_1,u_2,â€¦,u_{n_u}]$ï¼Œå…¶ä¸­$u_i,r_i$åˆ†åˆ«è¡¨ç¤ºutterance in contextäºresponseçš„ç¬¬iä¸ªwordçš„å‘é‡è¡¨ç¤ºã€‚</li><li>ç„¶åå°†æ¯ä¸ªutterance embeddingä¸response embeddingè¾“å…¥åˆ°GRUä¸­ï¼Œå¾—åˆ°ç¼–ç åçš„utteranceä¸responseå‘é‡ï¼Œè¡¨ç¤ºä¸ºï¼š$S=[S_1,S_2,â€¦,S_t]$ä¸$S_r$ï¼Œåˆ†åˆ«è¡¨ç¤ºutterance in context ä¸responseï¼Œ$S_i\in R^n$ã€‚</li></ul><h4 id="turns-aware-aggregation"><a href="#turns-aware-aggregation" class="headerlink" title="turns-aware aggregation"></a>turns-aware aggregation</h4><p><strong>è¿™æ˜¯DUAæ¨¡å‹ä¸­æœ€é‡è¦çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯åˆ›æ–°çš„åœ°æ–¹ã€‚</strong>å¦‚æœä»…ä»…åªæœ‰ä¸Šé¢é‚£ä¸€æ­¥å¯¹utteranceçš„å¤„ç†çš„è¯ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼šä¹Ÿå°±æ˜¯æ‰€æœ‰çš„utteranceéƒ½è¢«ä¸€æ ·çš„å¤„ç†äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è®¤ä¸ºæ‰€æœ‰çš„utteranceå¯¹å¾—åˆ°åˆç†çš„responseéƒ½æœ‰åŒæ ·çš„ä½œç”¨ï¼Œä½†è¿™æ˜¯ä¸å¯¹çš„ã€‚ç”±äºæœ€åä¸€ä¸ªutteranceå¯¹äºå¾—åˆ°åˆç†responseæ¥è¯´ï¼Œæ˜¯æœ€é‡è¦çš„ï¼Œæ‰€ä»¥åœ¨DUAä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸€ä¸ªutterance in contextä¸å…¶ä»–çš„utterance(åŒ…æ‹¬ response)è¿›è¡Œèåˆï¼Œä»è€ŒæŒ–æ˜æœ€åä¸€ä¸ªutteranceä¸å…¶ä»–utterance(åŒ…æ‹¬response)ä¹‹é—´çš„å…³ç³»ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p>è¾“å…¥æ˜¯ä¸Šä¸€å±‚çš„è¾“å‡ºï¼š$S=[S_1,S_2,â€¦,S_t]$ä¸$S_r$ï¼Œè¾“å‡ºè¡¨ç¤ºä¸ºï¼š$F=[F_1,F_2,â€¦,F_t,F_r]$ã€‚å…¶ä¸­ï¼Œ$F_j=S_j\Diamond S_t$ï¼Œ$j\in \{1,â€¦,t,r\}$ã€‚$\Diamond$è¿ç®—ç¬¦è¡¨ç¤ºaggregationè¿ç®—ï¼Œ<strong>åœ¨è®ºæ–‡ä¸­ï¼Œé‡‡å–äº†concatenationçš„æ–¹å¼ã€‚</strong></p><h4 id="matching-attention-flow"><a href="#matching-attention-flow" class="headerlink" title="matching attention flow"></a>matching attention flow</h4><p><strong>è¿™æ˜¯DUAæ¨¡å‹ä¸­æœ€é‡è¦çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯åˆ›æ–°çš„åœ°æ–¹ã€‚</strong>é€šè¿‡turns-aware aggregationï¼Œæ‰€æœ‰çš„utteranceå¾—åˆ°äº†å†ä¸€æ¬¡çš„encodingã€‚ä½†æ˜¯æ­¤æ—¶çš„utteranceè¿‡äºå†—é•¿ï¼Œä¸”å¹¶ä¸æ˜¯æ‰€æœ‰çš„wordéƒ½å‘æŒ¥äº†ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»ä¸­æå–å‡ºæœ‰ç”¨ä¸”é‡è¦çš„ä¿¡æ¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>DUAæ¨¡å‹é‡‡ç”¨äº†R-netä¸­çš„self-matching attentionæœºåˆ¶</strong>(æ‰€ä»¥MRCä¸­çš„æ¨¡å‹æœ€å¥½å»çœ‹çœ‹ï¼ŒVQAæœ€å¥½ä¹Ÿçœ‹çœ‹(co-attention)ï¼Œè¿™äº›éƒ½æ˜¯ä¸åˆ†å®¶çš„ï¼Œè«å¾—åŠæ³•ï¼Œkeep learningğŸ¤·â€â™‚ï¸)ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p>è¾“å…¥æ˜¯ä¸Šä¸€å±‚çš„è¾“å‡ºï¼š$F=[F_1,F_2,â€¦,F_t,F_r]$ï¼›å¯¹äºä»»æ„çš„$\hat F=[f_1,f_2,â€¦,f_n]\in F$ï¼Œè¾“å‡ºè¡¨ç¤ºä¸ºï¼š$P=[p_1,p_2,â€¦,p_n]$ã€‚(è¿™é‡Œæˆ‘è®¤ä¸ºè®ºæ–‡ä¸­å†™é”™äº†ï¼Œå¹¶ä¸æ˜¯åªæœ‰responseè¿™æ ·å¤„ç†ï¼Œåº”è¯¥æ˜¯æ‰€æœ‰çš„utterances(åŒ…æ‹¬response)éƒ½è¿™æ ·å¤„ç†æ‰å¯¹ã€‚)æ³¨æ„ï¼šè¿™é‡Œçš„$n$ä¸utterance representationä¸­çš„næ˜¯ä¸€æ ·çš„ã€‚å…¶ä¸­ï¼Œ$p_t$çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">p_t=GRU(p_{t-1},[f_t,c_t])</script><p>å…¶ä¸­ï¼Œ$c_t$æ˜¯self matching attentionæœºåˆ¶å¾—åˆ°çš„ç»“æœï¼Œå…·ä½“è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">c_t=attn(\hat F,f_t) \\s_{j}^{t}=v^Ttanh(W_vf_j+W_{\hat v}f_t+b_r) \\a_{i}^{t}=\frac {exp(s_{i}^{t})}{\sum _{j=1}^{n}exp(s_{j}^{t})} \\c_t=\sum_{i=1}^{n}a_{i}^{t}f_i</script><p><strong>è¿™ä¸€å±‚çš„è¾“å‡ºæ˜¯ï¼š$P=[P_1,P_2,â€¦,P_t,P_r]ï¼Œwhere \ P_i=[p_1,p_2,â€¦,p_n]$ã€‚</strong></p><blockquote><p>æ³¨æ„ï¼šè¿™ä¸€å±‚ä¹‹æ‰€ä»¥è¦åœ¨self matching attentionä¹‹ååŠ GRUï¼Œæ˜¯å› ä¸ºself matching attentionä¼šä¸¢å¤±utteranceå†…çš„é¡ºåºä¿¡æ¯ï¼Œæ‰€ä»¥å°†attentionåçš„å‘é‡ä¸ä¹‹å‰çš„å‘é‡è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åè¾“å…¥åˆ°GRUä¸­ï¼Œä¸€æ–¹é¢å¯ä»¥è¿›è¡Œå†ä¸€æ¬¡çš„encodingï¼Œå¦ä¸€æ–¹é¢ï¼Œä¹Ÿå¯ä»¥æŠŠutteranceä¸­çš„æ— ç”¨ä¿¡æ¯ç»™è¿‡æ»¤æ‰ã€‚</p></blockquote><h4 id="response-matching"><a href="#response-matching" class="headerlink" title="response matching"></a>response matching</h4><p>ç»è¿‡matching attention flowä¹‹åï¼Œæˆ‘ä»¬å°±å·²ç»å¯¹utteranceè¿›è¡Œäº†å¾ˆå¥½çš„encodingã€‚è¿™ä¸€å±‚çš„å¤„ç†å’ŒSMNå°±å¾ˆåƒäº†ï¼Œæˆ‘ä»¬åˆ©ç”¨word levelä¸utterance level çš„utteranceçš„è¡¨ç¤ºï¼Œæ¥æ„å»ºword-word similarity matrix($M_1$)ä¸sequence-sequence similarity matrix($M_2$)ã€‚</p><script type="math/tex; mode=display">e_{1,i,j}=u_i^Tr_j \\e_{2,i,j}=P_{u_i}^TAP_{r_j}</script><p>å…¶ä¸­ï¼Œ$P_{u_i},P_{r_j}$æ˜¯matching attention flowçš„å…³äºutteranceä¸responseçš„è¾“å‡ºï¼Œå¹¶ä¸”ï¼Œ$P_{u_i},P_{r_j}\in R^c$ã€‚å¯¹äº$M_1$ä¸$M_2$ï¼Œåˆ†åˆ«è¾“å…¥åˆ°å·ç§¯å±‚ä¸­ï¼ŒåšäºŒç»´å·ç§¯(æ˜¯ä¸æ˜¯äºŒç»´å·ç§¯è¿˜å€¼å¾—å•†æ¦·)å¾—åˆ°$M_{1c}$ä¸$M_{2c}$ã€‚å…·ä½“è®¡ç®—å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/å·ç§¯.jpg" style="zoom:50%;"></p><p>ç´§æ¥ç€ï¼Œæ¥ä¸Šä¸€ä¸ªæ± åŒ–ï¼Œå¹¶å¯¹å…¶è¿›è¡Œflattenä¸concatã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/flatten.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$m_p$è¡¨ç¤ºç¬¬pä¸ªutteranceçš„è¡¨ç¤ºã€‚</p><h4 id="attentive-turns-aggregation"><a href="#attentive-turns-aggregation" class="headerlink" title="attentive turns aggregation"></a>attentive turns aggregation</h4><p>è¿™ä¸€å±‚å¯¹æ‰€æœ‰çš„ä¿¡æ¯è¿›è¡Œèšåˆï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚ä¸Šä¸€å±‚çš„è¾“å‡ºè¡¨ç¤ºä¸ºï¼š$M=[m_1,m_2,â€¦,m_t]$(è¿™é‡Œæˆ‘è®¤ä¸ºåŸå§‹è®ºæ–‡å†™é”™äº†ï¼Œé€šè¿‡CNNä¹‹åï¼Œå¾—åˆ°çš„$m_p$è¡¨ç¤ºçš„æ˜¯ç¬¬pä¸ªutterance in contextçš„å‘é‡åŒ–è¡¨ç¤ºï¼Œæ‰€ä»¥tä¸ªutteranceï¼Œ$M$ä¸­åº”è¯¥æœ‰tä¸ªå…ƒç´ )ï¼Œå°†å…¶è¾“å…¥åˆ°GRUä¸­ï¼Œå¾—åˆ°$H_m=[h_{m_1},h_{m_2},â€¦,h_{m_t}]$ï¼Œç„¶åé‡‡ç”¨attentionæœºåˆ¶ï¼Œå¾—åˆ°attentionå€¼ï¼š$v_f=L(H_m)$ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/attention.jpg" style="zoom:50%;"></p><blockquote><p>ç¨ç¨åæ§½ä¸€ä¸‹ï¼Œè¿™é‡Œç¬¦å·å®šä¹‰å¾—çœŸæ˜¯ä¹±ä¸ƒå…«ç³Ÿï¼Œå’Œå…¶ä»–å°èŠ‚çš„ç¬¦å·å†²çªäº†ï¼Œä¹Ÿä¸è¯´æ˜ï¼Œå…³é”®æ˜¯æ ¹æœ¬ä¸å¯¹ğŸ¤·â€â™‚ï¸æœ‰ç‚¹å¤±æœ›ã€‚è€Œä¸”æ¯ä¸€æ­¥è¾“å‡ºçš„ç»´åº¦ä¹Ÿä¸è®²æ¸…æ¥šï¼Œè™½ç„¶ä¸ç”¨æ¯ä¸€æ­¥éƒ½å†™ï¼Œä½†æ˜¯è‡³å°‘å…³é”®çš„åœ°æ–¹ï¼Œå‘é‡çš„ç»´åº¦è¦è®²æ¸…æ¥šï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿è¯»è€…é˜…è¯»å•Šã€‚æˆ‘ä»¥åå†™è®ºæ–‡ï¼Œä¸€å®šè¦æŠŠå‘é‡çš„ç»´åº¦è¯´æ¸…æ¥šã€‚ğŸ§</p></blockquote><p>æœ€åå°†ç»“æœé€šè¿‡ä¸€ä¸ªsoftmaxï¼Œå¾—åˆ°æœ€ç»ˆçš„scoreã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">{\cal F}(U,R)=softmax(W_sv_f)</script><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><ul><li>æ•°æ®é›†ï¼šUDCã€doubanã€E-commerce dialogue corpus(æœ¬æ–‡è‡ªå·±æ‰€releaseçš„corpusï¼ŒECD)</li><li><p>loss functionï¼šCE</p></li><li><p>è¯„ä»·æŒ‡æ ‡ï¼šMAPã€MRRã€Rn@kã€P@1</p></li><li>ä¼˜åŒ–å™¨ï¼šAdam</li><li>utteranceçš„æœ€å¤§æ•°é‡ä¸º10ï¼Œæ¯ä¸€ä¸ªutteranceçš„æœ€å¤§å•è¯æ•°ç›®ä¸º50</li><li>batch sizeä¸º200ï¼Œåˆå§‹å­¦ä¹ ç‡ä¸º0.001</li><li>å·ç§¯ä¸æ± åŒ–çš„window sizeä¸ºï¼ˆ3ï¼Œ3ï¼‰</li><li>GRUçš„ç»´åº¦ä¸º200</li><li>è¯å‘é‡ä½¿ç”¨word2vecåœ¨è®­ç»ƒé›†è®­ç»ƒå¾—åˆ°çš„è¯å‘é‡ï¼Œç»´åº¦ä¸º200</li><li>è®­ç»ƒ5ä¸ªepcohæ”¶æ•›</li></ul><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/ç»“æœ1.jpg" alt></p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-DUA/ç»“æœäºŒ.jpg" alt></p><blockquote><p>ç¬¬äºŒå¼ å›¾ç‰‡æ˜¯åœ¨ECDæ•°æ®é›†ä¸Šçš„ç»“æœã€‚</p></blockquote><p>ä»ç»“æœæ¥çœ‹ï¼ŒDUAçš„æ•ˆæœç¡®å®ä¸é”™ï½</p><h2 id="DUAæ¨¡å‹å®ç°"><a href="#DUAæ¨¡å‹å®ç°" class="headerlink" title="DUAæ¨¡å‹å®ç°"></a>DUAæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Modeling Multi-turn Conversation with Deep Utterance Aggregation</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> chatbot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> DUA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|chatbotç³»åˆ—-SMN</title>
      <link href="2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/"/>
      <url>2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å…¥å¯¹è¯çš„å‘å•¦ğŸ¤£å¯¹è¯æ˜¯ç›®å‰NLPæŠ€æœ¯é‡è¦çš„è½åœ°åœºæ™¯ä¹‹ä¸€ï¼Œä½†æ˜¯ç›¸æ¯”äºå…¶ä»–çš„æ–¹å‘ï¼Œå¯¹è¯ç›®å‰çš„åº”ç”¨è¿˜ä¸ç®—æˆç†Ÿï¼Œä¹Ÿè¿œè¿œæ²¡æœ‰äº§ç”Ÿå®ƒåº”æœ‰çš„å·¨å¤§å•†ä¸šä»·å€¼ï¼Œä½†æ˜¯éšç€ç‰©è”ç½‘ä¸5Gç­‰çš„å‘å±•ï¼Œå¯¹è¯çš„åº”ç”¨å‰æ™¯æ˜¯éå¸¸å…‰æ˜çš„ã€‚æ­¤å¤–ï¼Œæ—¢ç„¶å¯¹è¯çš„å‘è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€»éœ€è¦äººå»å¡«æ»¡è¿™äº›å‘ï¼Œå¯¹NLPeræ¥è¯´ï¼Œæ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºä¼šã€‚å…¶ä»–çš„ä¸å¤šè¯´ï¼Œæœ¬ç¯‡ç€é‡è®²è®²æ£€ç´¢å¼å¯¹è¯çš„ç»å…¸æ¨¡å‹SMNã€‚</p><a id="more"></a><h2 id="SMNæ¨¡å‹ä»‹ç»"><a href="#SMNæ¨¡å‹ä»‹ç»" class="headerlink" title="SMNæ¨¡å‹ä»‹ç»"></a>SMNæ¨¡å‹ä»‹ç»</h2><p>SMNæ¨¡å‹æ˜¯æ£€ç´¢å¼å¯¹è¯ä¸­ä¸€ç¯‡éå¸¸æœ‰å½±å“åŠ›çš„å·¥ä½œã€‚ç”±äºattentionæœºåˆ¶åœ¨2016å¹´åå¤§å¹…å…´èµ·ï¼Œæ‰€ä»¥SMNæ¨¡å‹çš„æ€è·¯ä¹Ÿæ˜¯åŸºäºäº¤äº’çš„æ–¹å¼ï¼Œæ¥åšcontextä¸responseçš„matchã€‚é¦–å…ˆè®²è®²SMNæ‰€è¦è§£å†³çš„é—®é¢˜ï¼š<strong>1.æ€ä¹ˆåœ¨contextä¸­è¾¨åˆ«å‡ºå¯¹é€‰å‡ºåˆç†responseçš„æœ‰ç”¨çš„é‡è¦ä¿¡æ¯ï¼Ÿ2.æ€ä¹ˆå¯¹contextä¸­çš„utterancesä¹‹é—´çš„å…³ç³»è¿›è¡Œå»ºæ¨¡ï¼Ÿ</strong>é’ˆå¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒSMNæ¨¡å‹ä½¿ç”¨åŸºäºäº¤äº’çš„æ–¹å¼ï¼Œä»ä¸€å¼€å§‹å°±è®©contextä¸­æ¯ä¸€ä¸ªutteranceä¸responsè¿›è¡Œä¸åŒç²’åº¦çš„matchingï¼Œå¹¶ä¸”ä½¿ç”¨å·ç§¯å’Œæ± åŒ–æ¥æå–å‡ºé‡è¦çš„ä¿¡æ¯ï¼›é’ˆå¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¯¹å¾—åˆ°utterance embeddingï¼Œä½¿ç”¨GRUæ¥è¿›è¡Œencoderï¼Œæœ€ç»ˆé€šè¿‡accumulationå¾—åˆ°context embeddingã€‚æ˜ç¡®äº†SMNæ‰€è¦è§£å†³çš„é—®é¢˜åï¼Œä¸‹é¢å°±å…·ä½“è®²è®²å…·ä½“çš„SMNæ¨¡å‹æ¶æ„ä¸ç»†èŠ‚ï½</p><h3 id="SMNæ¨¡å‹æ¶æ„"><a href="#SMNæ¨¡å‹æ¶æ„" class="headerlink" title="SMNæ¨¡å‹æ¶æ„"></a>SMNæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆå®šä¹‰ä¸€äº›ç¬¦å·ï¼šæ•°æ®é›†ï¼š$\{(y_i,s_i,r_i)\}_{i=1}^{N}ï¼Œs_i=\{u_{i,1},u_{i,2},u_{i,3},â€¦,u_{i,n_i}\}ï¼Œy_i\in \{0,1\}$ï¼Œå…¶ä¸­ï¼Œ$y_i$è¡¨ç¤ºç¬¬iä¸ªæ ·æœ¬çš„labelï¼Œ$s_i$è¡¨ç¤ºç¬¬iä¸ªæ ·æœ¬ä¸­çš„context(åŒ…æ‹¬å¤šä¸ªutterances)ï¼Œ$r_i$è¡¨ç¤ºç¬¬iä¸ªæ ·æœ¬çš„ä¸€ä¸ªå€™é€‰å›å¤(åˆç†å›å¤/ä¸åˆç†å›å¤)ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šå¯¹äºä¸€å¯¹$(s,r)$ï¼Œå¾—å‡ºå…¶åŒ¹é…åº¦ï¼Œå¯¹äºchatbotæ¥è¯´ï¼Œæˆ‘ä»¬è¦ä»candidate responsesä¸­é€‰å‡ºåŒ¹é…åº¦æœ€é«˜çš„å›å¤ã€‚SMNæ¶æ„è¿˜æ˜¯æŒºå¥½æ‡‚çš„ï¼Œç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/SMNæ¶æ„.jpg" alt></p><p>SMNæ¨¡å‹åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šutterance-response matching layerã€matching accumulation layerã€matching prediction layerã€‚ä¸‹é¢ä¾æ¬¡ä»‹ç»ï½</p><h4 id="utterance-response-matching-layer"><a href="#utterance-response-matching-layer" class="headerlink" title="utterance-response matching layer"></a>utterance-response matching layer</h4><p>è¿™ä¸€å±‚æ˜¯è®©contextä¸­çš„æ¯ä¸€ä¸ªutteranceä¸responseè¿›è¡Œmatchingï¼Œè¾“å‡ºæ˜¯word-word similarity matrixä¸sequence-sequence similarity matrixã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„utteranceï¼š$U=[e_{u,1},â€¦,e_{u,n_u}]$ä¸ä¸€ä¸ªresponse:$R=[e_{r,1},â€¦,e_{r,n_r}]ï¼ŒU\in R^{d\times n_u}ï¼ŒR\in R^{d\times n_r}$ã€‚æˆ‘ä»¬ä½¿ç”¨$U$ä¸$R$æ¥æ„å»ºword-word similarity matrix($M_1$)ä¸sequence-sequence similarity matrix($M_2$)ã€‚</p><ul><li>$M_1$çš„æ„å»ºç›¸å¯¹ç®€å•ï¼Œç›´æ¥ä½¿ç”¨utteranceä¸responseçš„word embedding sequenceæ¥è¿›è¡Œdotå³å¯ï¼Œå¾—åˆ°çš„ç»“æœçš„ç»´åº¦ï¼š$M_1\in R^{n_u\times n_r}$ã€‚</li><li>$M_2$çš„æ„å»ºç›¸å¯¹å¤æ‚ä¸€ç‚¹ã€‚æˆ‘ä»¬éœ€è¦å°†utteranceä¸responseçš„word embedding sequenceè¾“å…¥åˆ°GRUå±‚ä¸­ï¼Œå¾—åˆ°ç¼–ç è¿‡ä¹‹åçš„word embedding sequenceï¼š$H_u=[h_{u,1},h_{u,2},â€¦,h_{u,n_u}]$ã€$H_r=[h_{r,1},h_{r,2},â€¦,h_{r,n_r}]$ï¼Œç„¶ååœ¨å°†$H_u$ä¸$H_r$è¿›è¡Œdotï¼Œå³ï¼š$e_{2,i,j}=h_{u,i}^{T}Ah_{r,j}$ã€‚å…¶ä¸­ï¼Œ$A\in R^{m\times m}$ã€‚å¾—åˆ°çš„ç»“æœçš„ç»´åº¦æ˜¯ï¼š$M_2\in R^{n_u\times n_r}$ã€‚</li></ul><p>å¾—åˆ°$M_1$ä¸$M_2$ä¹‹åï¼Œå°†å…¶ä½œä¸ºCNNçš„ä¸¤ä¸ªchannelï¼Œè¾“å…¥åˆ°CNNå½“ä¸­ï¼ŒåšäºŒç»´å·ç§¯ï¼Œç„¶åå†ä½¿ç”¨å…¨å±€äºŒç»´æ± åŒ–ã€‚æ³¨æ„ï¼šCNNçš„è¾“å…¥ç»´åº¦æ˜¯ï¼š$(seqLengthUtterance,seqLengthResponse,2)$ï¼Œæœ€ç»ˆé€šè¿‡å…¨å±€æ± åŒ–çš„è¾“å‡ºçš„ç»´åº¦æ˜¯ï¼š$(numFilters,)$ã€‚æ³¨æ„ï¼Œå¯¹äºä¸€ä¸ªutteranceä¸responseï¼Œç»è¿‡å…¨å±€æ± åŒ–çš„è¾“å‡ºçš„ç»´åº¦æ˜¯ï¼š$(numFilters,)$ï¼Œç”±äºæœ‰nä¸ªutteranceï¼Œæ‰€ä»¥æœ‰nä¸ª$(numFilters,)$ï¼Œç»´åº¦æ˜¯ï¼š$(n,numFilters)$ã€‚</p><blockquote><p>Noteï¼šè¿™é‡Œæ²¡æœ‰ç®—ä¸Šbatch_sizeç»´åº¦ï¼Œä¹Ÿæ²¡æœ‰ç®—ä¸Šnum_utteranceè¿™ä¸ªç»´åº¦ï¼Œé’ˆå¯¹çš„å°±æ˜¯ä¸€ä¸ªutteranceçš„è®¡ç®—ï¼å…·ä½“å¤ç°è®ºæ–‡çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹tensorçš„ç»´åº¦ã€‚</p></blockquote><h4 id="matching-accumulation-layer"><a href="#matching-accumulation-layer" class="headerlink" title="matching accumulation layer"></a>matching accumulation layer</h4><p>ç»è¿‡utterance-response matching layerï¼Œæ¯ä¸€ä¸ªå‘é‡éƒ½è¡¨ç¤ºä¸€ä¸ªutterance embeddingï¼Œç„¶åå°†å…¶è¾“å…¥åˆ°GRUä¸­ï¼Œè¿›è¡Œç¼–ç ã€‚å¾—åˆ°$[h_1^{ â€˜},h_2^{ â€˜}â€¦,h_n^{ â€˜}]$ã€‚ç„¶åä½¿ç”¨$L$å‡½æ•°ï¼Œå¾—åˆ°æœ€ç»ˆçš„context embeddingã€‚</p><h4 id="matching-prediction-layer"><a href="#matching-prediction-layer" class="headerlink" title="matching prediction layer"></a>matching prediction layer</h4><p>é€šè¿‡matching accumulation layerï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°$[h_1^{ â€˜},h_2^{ â€˜}â€¦,h_n^{ â€˜}]$ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œä½¿ç”¨$L$å‡½æ•°ï¼Œå¾—åˆ°æœ€ç»ˆçš„context embeddingã€‚åœ¨è®ºæ–‡ä¸­ï¼Œ$L$æœ‰ä¸‰ç§æ–¹å¼ã€‚</p><ul><li>$SMN_{last}$ï¼š$L([h_1^{ â€˜},h_2^{ â€˜}â€¦,h_n^{ â€˜}])=h_n^{ â€˜}$ï¼›</li><li>$SMN_{static}$ï¼š$L([h_1^{ â€˜},h_2^{ â€˜}â€¦,h_n^{ â€˜}])=\sum_{i=1}^{n}w_ih_i^{ â€˜}$ï¼›</li><li>$SMN_{dynamic}$ï¼šä½¿ç”¨ä¸HANæ¨¡å‹ç±»ä¼¼çš„attentionæœºåˆ¶ï¼Œå¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/attention.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$h_{u_i,n_u}$æ˜¯ç¬¬iä¸ªutteranceé€šè¿‡GRUä¹‹åçš„æœ€åä¸€ä¸ªä½ç½®çš„å‘é‡ã€‚</p><p>å¾—åˆ°æœ€ç»ˆçš„context embeddingä¹‹åï¼Œç„¶åé€å…¥softmaxä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/softmax.jpg" style="zoom:50%;"></p><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><ul><li>æŸå¤±å‡½æ•°ï¼šcross entropyã€‚å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/CE.jpg" style="zoom:50%;"></p><ul><li>æ•°æ®é›†ï¼šDouban conversation corpus</li><li>è¯„ä»·æŒ‡æ ‡ï¼š$R_n@k$ï¼ŒMAPï¼ŒMRR</li><li>word embeddingï¼šä½¿ç”¨word2vecé¢„è®­ç»ƒå¾—åˆ°çš„200ç»´å‘é‡</li><li>GRUç»´åº¦ï¼š200</li><li>å·ç§¯å’Œæ± åŒ–çš„windowå¤§å°ï¼šï¼ˆ3ï¼Œ3ï¼‰</li><li>ç¬¬äºŒå±‚çš„GRUç»´åº¦ï¼š50</li><li>batch_sizeï¼š200</li><li>æ¯ä¸€ä¸ªutteranceçš„æœ€å¤§é•¿åº¦ä¸º50ï¼Œæ¯ä¸€ä¸ªcontextçš„æœ€å¤§çš„utteranceçš„æ•°ç›®ä¸º10ã€‚å¦‚æœcontextä¸­utteranceçš„æ•°ç›®å¤§äº10ï¼Œé‚£ä¹ˆå–æœ€è¿‘çš„å‰10ä¸ªï¼Œå¦åˆ™ï¼Œpadding</li><li>åˆå§‹å­¦ä¹ ç‡ï¼š0.001ï¼Œåº”ç”¨earlystopping</li></ul><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/05/19/NLP-chatbot%E7%B3%BB%E5%88%97-SMN/ç»“æœ.jpg" alt></p><p>ä»ç»“æœæ¥çœ‹ï¼ŒSMNæ¨¡å‹è¦å¥½äºMulti-viewæ¨¡å‹ï¼Œè¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚ä»è¿™ä¹Ÿè¯´æ˜ï¼ŒåŸºäºäº¤äº’çš„åŒ¹é…æ–¹å¼è¦æ¯”åŸºäºè¡¨ç¤ºçš„å¥½å¾ˆå¤šï¼Œå¹¶ä¸”å¤šç²’åº¦è¡¨ç¤ºå¯¹äºæ€§èƒ½çš„æå‡ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„~</p><h2 id="SMNæ¨¡å‹å®ç°"><a href="#SMNæ¨¡å‹å®ç°" class="headerlink" title="SMNæ¨¡å‹å®ç°"></a>SMNæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Sequential Matching Network: A New Architecture for Multi-turn Response Selection in Retrieval-Based Chatbots</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> chatbot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> SMN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|chatbotç³»åˆ—-Multi-view</title>
      <link href="2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/"/>
      <url>2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å…¥å¯¹è¯çš„å‘å•¦ğŸ¤£å¯¹è¯æ˜¯ç›®å‰NLPæŠ€æœ¯é‡è¦çš„è½åœ°åœºæ™¯ä¹‹ä¸€ï¼Œä½†æ˜¯ç›¸æ¯”äºå…¶ä»–çš„æ–¹å‘ï¼Œå¯¹è¯ç›®å‰çš„åº”ç”¨è¿˜ä¸ç®—æˆç†Ÿï¼Œä¹Ÿè¿œè¿œæ²¡æœ‰äº§ç”Ÿå®ƒåº”æœ‰çš„å·¨å¤§å•†ä¸šä»·å€¼ï¼Œä½†æ˜¯éšç€ç‰©è”ç½‘ä¸5Gç­‰çš„å‘å±•ï¼Œå¯¹è¯çš„åº”ç”¨å‰æ™¯æ˜¯éå¸¸å…‰æ˜çš„ã€‚æ­¤å¤–ï¼Œæ—¢ç„¶å¯¹è¯çš„å‘è¿˜æœ‰å¾ˆå¤šï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€»éœ€è¦äººå»å¡«æ»¡è¿™äº›å‘ï¼Œå¯¹NLPeræ¥è¯´ï¼Œæ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºä¼šã€‚å…¶ä»–çš„ä¸å¤šè¯´ï¼Œæœ¬ç¯‡ç€é‡è®²è®²æ£€ç´¢å¼å¯¹è¯çš„ç»å…¸æ¨¡å‹Multi-viewã€‚</p><a id="more"></a><h2 id="Multi-viewæ¨¡å‹ä»‹ç»"><a href="#Multi-viewæ¨¡å‹ä»‹ç»" class="headerlink" title="Multi-viewæ¨¡å‹ä»‹ç»"></a>Multi-viewæ¨¡å‹ä»‹ç»</h2><p>é¦–å…ˆä¸å¾—ä¸è¯´ï¼Œè¿™æ˜¯ä¸€ç‰‡éå¸¸å¥½çš„æ–‡ç« ï¼Œéå¸¸é€‚åˆç”¨æ¥åšå¯¹è¯å…¥é—¨ğŸ¤©é¦–å…ˆæ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦æœ‰Multi-viewæ¨¡å‹ã€‚æœ€å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯äº2016å¹´å‘è¡¨çš„ï¼Œè¿™æ—¶å€™åŒ¹é…æ˜¯ä»¥åŸºäºè¡¨ç¤ºçš„æ¨¡å‹ä¸ºä¸»ï¼Œè€ŒåŸºäºäº¤äº’çš„æ¨¡å‹è¿˜ä¸ºå…´èµ·ã€‚æ‰€ä»¥ï¼Œåœ¨response selectionä»»åŠ¡ä¸­ï¼Œå¤§éƒ¨åˆ†æ¨¡å‹éƒ½æ˜¯å°†contextä¸responseè§†ä¸ºwordçš„é›†åˆï¼Œç„¶åå¯¹å…¶è¿›è¡Œembeddingï¼Œè®ºæ–‡ä¸­ç§°å…¶ä¸ºword sequence modelã€‚è¿™æ ·çš„æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºï¼š<strong>å…¶å¿½ç•¥äº†utterancesä¹‹é—´çš„å…³ç³»ã€‚</strong>è­¬å¦‚è¯´ï¼šä¸€ä¸ªutteranceå¯ä»¥æ˜¯å¯¹ä¸Šä¸€ä¸ªutteranceçš„è‚¯å®šã€å¦å®šï¼Œæˆ–è€…æ˜¯å¼€å¯ä¸€ä¸ªæ–°çš„topicï¼Œä½†æ˜¯word sequence modelæ— æ³•æ•æ‰åˆ°è¿™æ ·çš„ä¿¡æ¯ã€‚å†è¯´æ˜ç™½ç‚¹ï¼Œword sequence modelæ— æ³•å¾ˆå¥½åœ°å¤„ç†å¤šè½®å¯¹è¯ã€‚<strong>æ‰€ä»¥ï¼ŒMulti-viewæ¨¡å‹é€šè¿‡åœ¨utterance levelè¿›è¡Œå»ºæ¨¡ï¼Œå¹¶ä¸word levelè¿›è¡Œcombineï¼Œä»è€Œå¤§å¹…æå‡åœ¨respone selectionä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚</strong></p><h3 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h3><p>é¦–å…ˆä»‹ç»ä¼ ç»Ÿçš„word sequence modelå¤„ç†å¤šè½®å¯¹è¯çš„æ€è·¯ï¼šå°†å¤šè½®å¯¹è¯é¦–å°¾è¿æ¥æˆä¸€æ¡é•¿é•¿çš„æ–‡æœ¬ï¼Œä»è€Œè¾“é€åˆ°ç½‘ç»œä¸­ã€‚å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><p><img src="/2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/word sequence modle.jpg" style="zoom: 67%;"></p><p>å…¶ä¸­ï¼Œ<code>_sos_</code>æ˜¯ä¸¤ä¸ªutteranceä¹‹é—´çš„è¿æ¥ç¬¦ã€‚å†å°†å¥å­ä½¿ç”¨GRUè¿›è¡Œencoderä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨GRUçš„æœ€åä¸€ä¸ªhidden stateæ¥è®¡ç®—confidenceï¼Œå³åŒ¹é…åº¦ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">p(y=1|c,r)=\sigma (cWr+b)</script><p>å…¶ä¸­ï¼Œ$cï¼Œr$è¡¨ç¤ºcontext1ä¸responseï¼Œ$\sigma$æ˜¯sigmoidå‡½æ•°ã€‚ä½†æ˜¯ä»…ä»…åœ¨word levelè¿›è¡Œå»ºæ¨¡æ˜¯ä¸å¤Ÿçš„ï¼ŒMulti-viewæ¨¡å‹æ›´æ˜¯åœ¨utterance levelè¿›è¿›è¡Œå»ºæ¨¡ï¼Œä»è€ŒæœŸæœ›å¾—åˆ°æ›´é«˜å±‚æ¬¡çš„è¯­ä¹‰è¡¨ç¤ºã€‚å¦‚ä¸‹</p><p><img src="/2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/multi-view.jpg" style="zoom:67%;"></p><p>æˆ‘åœ¨å›¾ä¸Šæ ‡è®°äº†ä¸€ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªå›¾è¦åˆ†æˆä¸¤éƒ¨åˆ†æ¥çœ‹(ä¸€å¼€å§‹æˆ‘çœ‹çš„æ—¶å€™ï¼Œæœ‰ç‚¹æ¨¡ç³ŠğŸ˜·)ã€‚ä¸‹é¢ä¾æ¬¡è§£æï½</p><ul><li>çº¢æ¡†éƒ¨åˆ†æ˜¯word sequence modelï¼Œè¿™ä¸ªæ²¡æœ‰å¯è¯´çš„ï¼Œä¸ä¸Šé¢è¯´çš„ä¸€æ ·ï¼›çº¢æ¡†ä¸‹é¢çš„æ˜¯utterance sequence modeléƒ¨åˆ†ã€‚</li><li>ç»¿è‰²éƒ¨åˆ†æ˜¯word embeddingéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨word2vecã€Gloveæˆ–è€…æ˜¯éšæœºåˆå§‹åŒ–ã€‚æ³¨æ„ï¼šword levelä¸utterance levelæ˜¯å…±ç”¨word embeddingçš„ã€‚</li><li>é»„è‰²éƒ¨åˆ†æ˜¯ä¸€ç»´å·ç§¯å±‚ï¼Œä¸textCNNä¸­çš„å·ç§¯ä¸€æ ·ã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ç­‰é•¿å·ç§¯ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªutteranceäº§ç”Ÿä¸€ä¸ªè¾“å‡ºï¼Œä½†æ˜¯kerneléƒ¨åˆ†æ˜¯å…±äº«çš„ã€‚</li><li>çº¢è‰²éƒ¨åˆ†æ˜¯å…¨å±€æ± åŒ–å±‚ï¼Œæå–å‡ºcontextä¸responseä¸­çš„æ ¸å¿ƒæ„æ€ï¼Œè¿™æ ·å°±æŠŠå¯¹è½®å¯¹è¯å˜æˆutterance embedding sequenceäº†ã€‚</li><li>è“è‰²éƒ¨åˆ†æ˜¯GRUå±‚ï¼Œå¹¶åˆ©ç”¨æœ€åä¸€ä¸ªhidden stateæ¥è®¡ç®—ç½®ä¿¡åº¦ã€‚</li></ul><blockquote><p>æ³¨æ„ï¼šword levelçš„GRUæ˜¯contextä¸reponseå…±äº«çš„ï¼›utterance levelçš„GRUæ˜¯contextä¸responseå…±äº«çš„ï¼Œä½†æ˜¯ä¸¤ä¸ªlevelä¹‹é—´çš„GRUä¸å…±äº«å‚æ•°ã€‚</p></blockquote><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>Multi-viewçš„æŸå¤±å‡½æ•°æ˜¯ï¼šlikehood lossã€disagreement lossä¸ regularization lossã€‚</p><p><img src="/2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/loss.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$p_w(l_i)ã€p_u(l_i)$åˆ†åˆ«è¡¨ç¤ºword levelä¸utterance levelçš„æ˜¯ç¬¬$i$ä¸ªlabelçš„æ¦‚ç‡ï¼Œlabelå–$\{0,1\}$ï¼Œ$\hat p_w(l_i)=1-p_w(l_i)ã€\hat p_u(l_i)=1-p_u(l_i)$ï¼Œ$\cal L_Dã€\cal L_L$åˆ†åˆ«è¡¨ç¤ºdisagreement lossä¸likehood lossã€‚likehood losså¾ˆå¥½ç†è§£ï¼Œä¸è¿‡å…³äºdisagreement lossï¼Œå°±ä¸æ˜¯å¾ˆç†è§£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå®šä¹‰äº†ï¼Œå¯èƒ½éœ€è¦å†çœ‹çœ‹å…¶ä»–è®ºæ–‡ã€‚</p><p>åœ¨é¢„æµ‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªresponseçš„ç½®ä¿¡åº¦çš„å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/é¢„æµ‹.jpg" style="zoom:50%;"></p><p>æœ€åï¼Œæˆ‘ä»¬ä»candidateä¸­é€‰å‡ºç½®ä¿¡åº¦æœ€å¤§çš„responseï¼Œå³å¯ã€‚</p><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><ul><li><p>æ•°æ®é›†ï¼šUDC(ubuntu corpus)</p></li><li><p>è¯„ä»·æŒ‡æ ‡ï¼š1 in m Recall@kï¼Œåœ¨mä¸ªå€™é€‰å›å¤ä¸­ï¼Œåˆç†å›å¤å‡ºç°åœ¨å‰kä¸ªå°±ç®—æˆåŠŸã€‚1 in 2 Recall@1ï¼Œå°±æ˜¯äºŒåˆ†ç±»ä¸­çš„recallã€‚</p></li><li>training detailsï¼šé‡‡ç”¨Gloveè¯å‘é‡ï¼ŒGRUçš„hidden unitsä¸º200ï¼Œkernelæ•°ç›®ä¸º200ï¼Œåˆå§‹å­¦ä¹ ç‡ä¸º0.01ï¼Œbatch sizeä¸º32ï¼Œ4-5ä¸ªepochså°±æ”¶æ•›äº†ã€‚</li></ul><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="/2020/05/15/NLP-chatbot%E7%B3%BB%E5%88%97-Multi-view/ç»“æœ1.jpg" style="zoom:50%;"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç»“æœç¡®å®éå¸¸å¥½ï½è®ºæ–‡ä¸­è¿˜å»æ¢ç´¢äº†<code>_sos_</code>tagçš„ä½œç”¨ï¼Œä¹Ÿæ¢ç´¢äº†ä¸åŒæ•°ç›®çš„utteranceå¯¹ç»“æœçš„å½±å“ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥çœ‹åŸå§‹è®ºæ–‡ï¼Œä¸ªäººè®¤ä¸ºè¿™ç¯‡è®ºæ–‡å†™çš„éå¸¸å¥½ï¼Œéå¸¸å€¼å¾—ä¸€è¯»ï½</p><h2 id="Multi-viewæ¨¡å‹å®ç°"><a href="#Multi-viewæ¨¡å‹å®ç°" class="headerlink" title="Multi-viewæ¨¡å‹å®ç°"></a>Multi-viewæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Multi-view Response Selection for Human-Computer Conversation</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> chatbot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> Multi-view </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-BIMPM</title>
      <link href="2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/"/>
      <url>2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„BIMPMæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="BIMPMæ¨¡å‹çš„ä»‹ç»"><a href="#BIMPMæ¨¡å‹çš„ä»‹ç»" class="headerlink" title="BIMPMæ¨¡å‹çš„ä»‹ç»"></a>BIMPMæ¨¡å‹çš„ä»‹ç»</h2><p>BIMPMæ¨¡å‹æ¥æºäº2017å¹´çš„ã€ŠBilateral Multi-Perspective Matching for Natural Language Sentencesã€‹è®ºæ–‡ã€‚è¿™ç¯‡æ–‡ç« æ€»ç»“äº†Siameseæ¶æ„ä¸matching-aggregateæ¶æ„çš„ä¼˜ç¼ºç‚¹ï¼Œéå¸¸å€¼å¾—ä¸€è¯»ï¼Œæœ‰æ—¶é—´çš„ç«¥é‹ä¸€å®šè¦å»è¯»è¯»åŸå§‹è®ºæ–‡ğŸ¤©</p><h3 id="BIMPMæ¨¡å‹æå‡ºçš„åŸå› "><a href="#BIMPMæ¨¡å‹æå‡ºçš„åŸå› " class="headerlink" title="BIMPMæ¨¡å‹æå‡ºçš„åŸå› "></a>BIMPMæ¨¡å‹æå‡ºçš„åŸå› </h3><p>åœ¨æ–‡æœ¬åŒ¹é…æ¨¡å‹ä¸­ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåŸºäºè¡¨ç¤ºçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹ï¼Œå³Siameseæ¶æ„ï¼Œä»¥åŠåŸºäºäº¤äº’çš„æ–‡æœ¬åŒ¹é…æ¨¡å‹ï¼Œå³matching-aggregateæ¶æ„(æœ‰æ—¶å€™ä¹Ÿç§°ä½œcompare-aggregateæ¶æ„)ã€‚ä¸¤ç§ç»“æ„çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li>Siameseæ¶æ„çš„ä¼˜ç‚¹åœ¨äºä¸¤ä¸ªå¥å­å¯ä»¥å…±äº«å‚æ•°ï¼Œæ‰€ä»¥æ¨¡å‹å®¹é‡æ¯”è¾ƒå°ï¼Œä¹Ÿå®¹æ˜“è®­ç»ƒï¼›ä½†æ˜¯å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œç”±äºåœ¨encoderéƒ¨åˆ†æ²¡æœ‰æ˜æ˜¾çš„äº¤äº’ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å¤±å»æŸäº›é‡è¦çš„ä¿¡æ¯ï¼Œå³æ²¡æ³•æ•è·åˆ°æ›´åŠ ä¸°å¯Œçš„è¯­ä¹‰ç‰¹å¾ã€‚</li><li>matching-aggregateæ¶æ„çš„ä¼˜ç‚¹å¯ä»¥åŠæ—©åœ°æ•è·æ›´ä¸ºä¸°å¯Œçš„äº¤äº’ç‰¹å¾ï¼Œå› æ­¤æ•ˆæœé€šå¸¸æ¥è¯´ä¼šæ›´å¥½ä¸€äº›ã€‚ä½†æ˜¯å…¶ç¼ºç‚¹åœ¨äºï¼šä¸€æ–¹é¢ï¼Œå¾ˆå¤šæ¨¡å‹åªè€ƒè™‘äº†å•ä¸ªç»†ç²’åº¦çš„åŒ¹é…ï¼Œæ¯”å¦‚word by wordï¼Œè€Œæ²¡æœ‰è€ƒè™‘å…¶ä»–ç»†ç²’åº¦çš„åŒ¹é…ï¼›å¦ä¸€æ–¹é¢ï¼ŒåŒ¹é…å¾€å¾€æ˜¯å•å‘çš„ï¼Œå³åªæœ‰På¯¹Qçš„åŒ¹é…ï¼Œæˆ–è€…æ˜¯Qå¯¹Pçš„åŒ¹é…ã€‚</li></ul><p>çŸ¥é“äº†ä¸¤ç§æ¶æ„çš„ä¼˜ç¼ºç‚¹åï¼Œä½œè€…æå‡ºäº†BIMPMæ¨¡å‹ã€‚è¯¥æ¨¡å‹æœ¬è´¨ä¸Šè¿˜æ˜¯å±äºmatching-aggregateæ¶æ„ï¼Œä½†æ˜¯ä¸å…¶ä»–æ¨¡å‹ä¸åŒçš„åœ°æ–¹åœ¨äºï¼šå…¶è€ƒè™‘äº†ä¸¤ä¸ªæ–¹å‘çš„åŒ¹é…ï¼Œå³På¯¹Qä¸Qå¯¹Pã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å¾—åˆ°æ›´ä¸ºä¸°å¯Œçš„è¯­ä¹‰ç‰¹å¾ã€‚äº‹å®è¯æ˜ï¼Œå…¶ç¡®å®å–å¾—äº†æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚</p><h3 id="BIMPMæ¨¡å‹çš„æ¶æ„"><a href="#BIMPMæ¨¡å‹çš„æ¶æ„" class="headerlink" title="BIMPMæ¨¡å‹çš„æ¶æ„"></a>BIMPMæ¨¡å‹çš„æ¶æ„</h3><p>é¦–å…ˆç»™å‡ºç›¸å…³å®šä¹‰ã€‚å‡è®¾sampleçš„å½¢å¼ä¸ºä¸‰å…ƒç»„ï¼š$(P,Q,y)$ï¼Œå…¶ä¸­$P=\{p_1,p_2,p_3,â€¦,p_M\}ï¼ŒQ=\{q_1,q_2,q_3,â€¦,q_N\}$ã€‚å…¶ä¸­ï¼Œæ¯ä¸€ä¸ªtokençš„ç»´åº¦å‡æ˜¯dç»´çš„ï¼›$y$æ˜¯labelã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒBIMPMæ¨¡å‹å±äºpointwiseçš„å­¦ä¹ æ–¹å¼ã€‚</p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/BIMPM.jpg" style="zoom: 67%;"></p><p>ä¸Šå›¾å°±æ˜¯BIMPMæ¨¡å‹çš„æ•´ä½“æ¶æ„ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒBIMPMæ¨¡å‹åˆ†ä¸ºäº”å±‚ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»ã€‚</p><h4 id="word-representation-layer"><a href="#word-representation-layer" class="headerlink" title="word representation layer"></a>word representation layer</h4><p>è¿™ä¸€å±‚åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†æ˜¯å›ºå®šçš„è¯å‘é‡ï¼Œæ¯”å¦‚ä½¿ç”¨Googleçš„300ç»´çš„word2vecè¯å‘é‡æˆ–è€…Gloveè¯å‘é‡ï¼›å¦ä¸€éƒ¨åˆ†æ˜¯å°†æ¯ä¸€ä¸ªå•è¯çš„æ¯ä¸€ä¸ªè¾“å…¥åˆ°LSTMç½‘ç»œä¸­ï¼Œå¾—åˆ°çš„è¯å‘é‡ï¼Œè¿™ä¸€å±‚æœ€ç»ˆçš„è¾“å‡ºæ˜¯å°†è¿™ä¸¤éƒ¨åˆ†çš„è¯å‘é‡è¿›è¡Œconcatä¹‹åçš„ç»“æœã€‚</p><h4 id="context-representation-layer"><a href="#context-representation-layer" class="headerlink" title="context representation layer"></a>context representation layer</h4><p>è¿™ä¸€å±‚æ˜¯å¯¹På’ŒQè¿›è¡Œè¿›ä¸€æ­¥çš„encodingï¼Œå°†ä¸Šä¸‹æ–‡ä¿¡æ¯èå…¥åˆ°æ¯ä¸€ä¸ªtime stepã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯ä½¿ç”¨ä¸€å±‚BILSTMã€‚æ³¨æ„ï¼šPä¸Qä½¿ç”¨åŒæ ·çš„BILSTMï¼Œå³å…±äº«å‚æ•°ã€‚</p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/BILSTM1.jpg" style="zoom:50%;"></p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/BILSTM2.jpg" style="zoom:50%;"></p><h4 id="matching-layer"><a href="#matching-layer" class="headerlink" title="matching layer"></a>matching layer</h4><p>è¿™ä¸€éƒ¨åˆ†æ˜¯BIMPMæ¨¡å‹çœŸæ­£åˆ›æ–°çš„åœ°æ–¹ã€‚å®ƒé‡‡ç”¨äº†åŒå‘çš„matchingæ–¹æ³•ï¼Œå³ï¼šæ¯”è¾ƒPçš„æ¯ä¸€ä¸ªtimestepçš„å‘é‡ä¸Qçš„æ‰€æœ‰timestepå‘é‡ï¼Œæ¯”è¾ƒQçš„æ¯ä¸€ä¸ªtimestepçš„å‘é‡ä¸Pçš„æ‰€æœ‰timestepå‘é‡ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œä½œè€…è®¾è®¡äº†ä¸€ç§multi-perspectiveçš„æ–¹æ³•ã€‚æ•´ä¸ªmulti-perspectiveæ–¹æ³•åŒ…å«ä¸¤æ­¥ï¼šç¬¬ä¸€æ­¥ï¼šç»™å‡ºcosine matching functionçš„å®šä¹‰ï¼›ç¬¬äºŒæ­¥ï¼Œåœ¨ç»™å‡ºçš„å‡½æ•°çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨å››ç§åŒ¹é…ç­–ç•¥ï¼ˆfull-matchingã€Maxpooling-matchingã€attentive-matchingã€max-attentive-matchingï¼‰ï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚</p><p><strong>step1ï¼š</strong>é¦–å…ˆè¦æ˜ç™½ç»™å‡ºçš„cosine matching functionçš„å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/cosine.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$v_1,v_2$æ˜¯ä¸¤ä¸ªå‘é‡ï¼Œå‡è®¾å…¶ç»´åº¦æ˜¯$d$ç»´ï¼›$W$æ˜¯å‚æ•°ï¼Œå…¶ç»´åº¦æ˜¯$R^{l\times d}$ï¼Œ$l$æ˜¯perspectiveçš„æ•°é‡ï¼›å¾—åˆ°çš„è¾“å‡º$m=\{m_1,m_2,m_3,â€¦,m_l\},m\in R^l$ã€‚å…·ä½“æ¥è¯´ï¼Œ$ m_k=cosine(W_k<em>v_1,W_k</em>v_2) $ã€‚</p><p><strong>step2ï¼š</strong>åœ¨ç¬¬ä¸€æ­¥çš„åŸºç¡€ä¸Šï¼Œç»™å‡ºäº†å››ç§åŒ¹é…ç­–ç•¥ã€‚ä¸‹é¢æ¼”ç¤ºçš„æ˜¯På¯¹Qçš„matchingï¼Œå³Pçš„æ¯ä¸€ä¸ªtimestepå¯¹Qè¿›è¡Œmatchingã€‚</p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/matching strategiesjpg.jpg" style="zoom:50%;"></p><ul><li><strong>full matchingï¼š</strong>å¯¹äºPçš„ä¸€ä¸ªtimestepçš„å‘é‡ï¼Œåªä¸Qçš„æœ€åä¸€ä¸ªçŠ¶æ€ç›¸æ¯”è¾ƒ(å‰å‘çš„æˆ–è€…åå‘çš„)ã€‚å¯¹åº”ä¸Šå›¾çš„aï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/full-matching.jpg" style="zoom:50%;"></p><ul><li><strong>maxpooling matchingï¼š</strong>å¯¹äºPçš„ä¸€ä¸ªtimestepçš„å‘é‡ï¼Œåˆ†åˆ«ä¸Qçš„æ¯ä¸€ä¸ªtimestepçš„å‘é‡è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åé€‰æ‹©ç»“æœæœ€å¤§çš„è¾“å‡ºã€‚å¯¹åº”äºä¸Šå›¾çš„bï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/Maxpooling-matching.jpg" style="zoom:50%;"></p><ul><li><strong>attentive matchingï¼š</strong>å¯¹äºPçš„æ¯ä¸€ä¸ªtimestepçš„å‘é‡ï¼Œåˆ†åˆ«ä¸Qçš„æ¯ä¸€ä¸ªtimestepè¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦çš„è®¡ç®—ï¼Œæœ€åå¾—åˆ°åŠ æƒåçš„å‘é‡ã€‚å¯¹åº”äºä¸Šå›¾çš„cï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/attentive-matching1.jpg" style="zoom:50%;"></p><p>å¾—åˆ°ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œç„¶åå¾—åˆ°è¿›è¡ŒåŠ æƒï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/attentive-matching2.jpg" style="zoom:50%;"></p><p><img src="/2020/05/15/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-BIMPM/attentive-matching3.jpg" style="zoom:50%;"></p><ul><li><strong>max-attentive matchingï¼š</strong>ä¸attentive matchingä¸åŒÂ·çš„åœ°æ–¹åœ¨äºï¼Œæ³¨æ„åŠ›å‘é‡å¹¶ä¸æ˜¯åŠ æƒå¾—åˆ°çš„ï¼Œè€Œæ˜¯ä»ä¸­é€‰å–æœ€å¤§çš„ä½œä¸ºæ³¨æ„åŠ›å‘é‡ï¼Œå¯å®‡çš„ä¸attentive matchingä¸€æ ·ã€‚</li></ul><p>æœ€åï¼Œè¿™ä¸€å±‚çš„è¾“å‡ºæ˜¯ä¸Šé¢å››ç§ç­–ç•¥çš„concatä¹‹åçš„ç»“æœã€‚<strong>æ³¨æ„ï¼Œå› ä¸ºæ˜¯åŒå‘çš„BLSTMï¼Œæ‰€ä»¥ä¸€ä¸ªå¥å­æœ€åèšåˆçš„æ˜¯8ä¸ªå‘é‡ï¼ï¼ï¼</strong></p><h4 id="aggregate-layer"><a href="#aggregate-layer" class="headerlink" title="aggregate layer"></a>aggregate layer</h4><p>è¿™ä¸€å±‚ä¸»è¦æ˜¯å»èšåˆä¸¤ä¸ªå¥å­ã€‚å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªBILSTMï¼Œæˆ‘ä»¬å–å‰å‘çš„LSTMä¸åå‘çš„LSTMçš„æœ€åä¸€ä¸ªçŠ¶æ€ï¼Œç”±äºæ˜¯ä¸¤ä¸ªå¥å­ï¼Œæ‰€ä»¥æœ€åæ˜¯concat4ä¸ªå‘é‡ã€‚</p><h4 id="prediction-layer"><a href="#prediction-layer" class="headerlink" title="prediction layer"></a>prediction layer</h4><p>è¿™ä¸€å±‚å°±æ˜¯è¦å¾—åˆ°æœ€åçš„åˆ†ç±»ç»“æœå•¦ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨ä¸¤å±‚çš„MLPï¼Œæœ€åä½¿ç”¨softmaxï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚</p><p>ä¸Šè¿°å°±æ˜¯BIMPMæ¨¡å‹çš„å…¨éƒ¨å†…å®¹å•¦ğŸ‰</p><blockquote><p>ç¨å¾®å•°å—¦ä¸€ä¸‹å§ï¼Œç›®å‰åŸºæœ¬çš„æ–‡æœ¬åŒ¹é…æ¨¡å‹å°±çœ‹å®Œäº†ï¼Œæ€»çš„æ¥è¯´ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå®ç°èµ·æ¥ä¹Ÿä¸éš¾ã€‚è¦è¯´éš¾çš„åœ°æ–¹ï¼Œå°±æ˜¯pairwiseçš„è®­ç»ƒæ–¹å¼ä¸listwiseçš„è®­ç»ƒæ–¹å¼äº†å§ï¼Œè¿™ä¸ªå¯¹äºæ•°æ®çš„å¤„ç†æ˜¯éœ€è¦ä¸‹ä¸€ç‚¹åŠŸå¤«çš„ï¼Œæœ€å¥½å»å€Ÿé‰´ä¸€ä¸‹åˆ«äººçš„ä»£ç æ˜¯æ€ä¹ˆå†™çš„ã€‚pointwiseæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™ä¸ªä¸ç”¨è¯´ä»€ä¹ˆã€‚æ¥ä¸‹æ¥çš„è¯ï¼Œå¦‚æœè¿˜éœ€è¦æ¥è§¦æ–‡æœ¬åŒ¹é…çš„æ¨¡å‹çš„è¯ï¼Œé‚£å°±æ˜¯MRCäº†å§ã€‚è¯´å®è¯ï¼Œè¿™ä¸ªå•ç‹¬æçœŸä¸å¥½æï¼Œä½†æ˜¯MRCæ¯•ç«Ÿæ˜¯ç›®å‰ç ”ç©¶çš„çƒ­ç‚¹æ–¹å‘ï¼Œç»å…¸çš„BIDAFã€R-netç­‰æ¨¡å‹è¿˜æ˜¯éœ€è¦å»çœ‹çš„ï¼ŒVQAä¹Ÿéœ€è¦å»æ¥è§¦ä¸€ä¸‹ã€‚ä¸è¿‡ï¼Œä¸»çº¿è¿˜æ˜¯è¦æ”¾åœ¨æ£€ç´¢å¼å¯¹è¯è¿™å—ï¼Œå…ˆæŠŠæ£€ç´¢å¼å¯¹è¯çœ‹å®Œï¼Œç„¶åå†å»ç†Ÿæ‚‰ç”Ÿæˆå¼å¯¹è¯ã€‚æ¯•ç«Ÿç”Ÿæˆå¼ä»»åŠ¡çœŸçš„ä¸å¥½å¼„ï¼Œè€Œä¸”è¿˜æ˜¯å¯¹è¯è¿™å—ï¼Œè¿˜æ˜¯éœ€è¦æœ‰äººå¸¦ã€‚</p></blockquote><h2 id="BIMPMæ¨¡å‹çš„å®ç°"><a href="#BIMPMæ¨¡å‹çš„å®ç°" class="headerlink" title="BIMPMæ¨¡å‹çš„å®ç°"></a>BIMPMæ¨¡å‹çš„å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Bilateral Multi-Perspective Matching for Natural Language Sentences</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> BIMPM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|åˆ†ç±»ä¸åŒ¹é…çš„å„ç±»è¯„ä»·æŒ‡æ ‡</title>
      <link href="2020/05/12/NLP-%E5%88%86%E7%B1%BB%E4%B8%8E%E5%8C%B9%E9%85%8D%E7%9A%84%E5%90%84%E7%B1%BB%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87/"/>
      <url>2020/05/12/NLP-%E5%88%86%E7%B1%BB%E4%B8%8E%E5%8C%B9%E9%85%8D%E7%9A%84%E5%90%84%E7%B1%BB%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87/</url>
      
        <content type="html"><![CDATA[<p>æ–‡æœ¬å’ŒåŒ¹é…åŸºæœ¬ä¸Šéƒ½çœ‹çš„å·®ä¸å¤šäº†ï¼Œè¯¥å®ç°çš„ä¹Ÿéƒ½å®ç°äº†ã€‚ä¸è¿‡ç”±äºæ–‡æœ¬ä¸åŒ¹é…çš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œå¹¶ä¸”æ¯ä¸ªåœºæ™¯æ‰€é‡‡ç”¨çš„è¯„ä»·æŒ‡æ ‡éƒ½ä¸å¤ªä¸€æ ·ï¼Œæœ‰ç‚¹æ··ä¹±ï¼Œæ‰€ä»¥åœ¨æ­¤æ€»ç»“ä¸€ä¸‹ã€‚</p><a id="more"></a><h2 id="å„ç±»æŒ‡æ ‡"><a href="#å„ç±»æŒ‡æ ‡" class="headerlink" title="å„ç±»æŒ‡æ ‡"></a>å„ç±»æŒ‡æ ‡</h2><p>é¦–å…ˆè®°å½•ä¸€ä¸‹ç¬¦å·ï¼šTP(true positive)ã€FP(false positive)ã€FN(false nergative)ã€TN(true negative)ã€‚è¡¨æ ¼å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">pred\real</th><th style="text-align:center">True</th><th style="text-align:center">False</th></tr></thead><tbody><tr><td style="text-align:center">True</td><td style="text-align:center">TP</td><td style="text-align:center">FP</td></tr><tr><td style="text-align:center">False</td><td style="text-align:center">FN</td><td style="text-align:center">TN</td></tr></tbody></table></div><h3 id="accuracyä¸error-rate"><a href="#accuracyä¸error-rate" class="headerlink" title="accuracyä¸error rate"></a>accuracyä¸error rate</h3><script type="math/tex; mode=display">accuracy=\frac {TP+TN}{N} \\error \ rate=\frac {FP+FN}{N}</script><h3 id="precision-recall-F1-score"><a href="#precision-recall-F1-score" class="headerlink" title="precision/recall/F1 score"></a>precision/recall/F1 score</h3><p>precisionè¡¨ç¤ºåœ¨é¢„æµ‹ä¸ºæ­£çš„æ ·æœ¬ä¸­ï¼ŒçœŸçš„ä¸ºæ­£çš„æ ·æœ¬çš„æ¯”ä¾‹ï¼›</p><p>recallè¡¨ç¤ºåœ¨åŸæœ¬çœŸçš„ä¸ºæ­£çš„æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ä¸ºæ­£çš„æ ·æœ¬çš„æ¯”ä¾‹ã€‚</p><p>F1-scoreæ˜¯ç²¾ç¡®ç‡ä¸å¬å›ç‡çš„æƒè¡¡ã€‚</p><script type="math/tex; mode=display">precision=\frac {TP}{TP+FP} \\recall=\frac {TP}{TP+FN} \\F1-score=\frac {2}{\frac{1}{P}+\frac {1}{R}}</script><blockquote><p>æ³¨æ„ï¼šprecisonã€recallã€F1scoreä»…ä½¿ç”¨äºäºŒåˆ†ç±»é—®é¢˜ã€‚å¯¹äºå¤šåˆ†ç±»é—®é¢˜ï¼Œä½¿ç”¨çš„æ˜¯micro-Pã€micro-Rã€micro-F1ä»¥åŠmacro-Pã€macro-Rã€macro-F1ã€‚</p><p>microï¼š â€œMicroâ€æ˜¯é€šè¿‡å…ˆè®¡ç®—æ€»ä½“çš„TP, FPå’ŒFNçš„æ•°é‡ï¼Œç„¶åè®¡ç®—PRFã€‚</p><p>macroï¼šâ€œMacroâ€æ˜¯åˆ†åˆ«è®¡ç®—æ¯ä¸ªç±»åˆ«çš„PRFï¼Œç„¶ååˆ†åˆ«æ±‚å¹³å‡å¾—åˆ°PRFã€‚</p><p>é“¾æ¥ï¼š<a href="https://www.cnblogs.com/nana-zhang/p/11496496.html" target="_blank" rel="noopener">microä¸macro</a></p><p><img src="/2020/05/12/NLP-%E5%88%86%E7%B1%BB%E4%B8%8E%E5%8C%B9%E9%85%8D%E7%9A%84%E5%90%84%E7%B1%BB%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87/å®å¹³å‡ä¸å¾®å¹³å‡å¯¹æ¯”.jpg" alt><br>å¦‚ä½•æ¯ä¸ªclassçš„æ ·æœ¬æ•°é‡ç›¸å·®ä¸å¤§ï¼Œé‚£ä¹ˆå®å¹³å‡å’Œå¾®å¹³å‡å·®å¼‚ä¹Ÿä¸å¤§<br>å¦‚æœæ¯ä¸ªclassçš„ç›¸å·®è¾ƒå¤§å¹¶ä¸”ä½ æƒ³ï¼š<br>æ›´æ³¨é‡æ ·æœ¬é‡å¤šçš„classï¼šä½¿ç”¨å¾®å¹³å‡<br>æ›´æ³¨é‡æ ·æœ¬é‡å°‘çš„classï¼šä½¿ç”¨å®å¹³å‡<br>å¦‚æœå¾®å¹³å‡è¿œä½äºå®å¹³å‡ï¼Œåˆ™åº”è¯¥å»æ£€æŸ¥æ ·æœ¬é‡å¤šçš„class<br>å¦‚æœå®å¹³å‡è¿œä½äºå¾®å¹³å‡ï¼Œåˆ™åº”è¯¥å»æ£€æŸ¥æ ·æœ¬é‡å°‘çš„class</p></blockquote><h3 id="EM"><a href="#EM" class="headerlink" title="EM"></a>EM</h3><p>EMï¼Œå…¨ç§°exact matchã€‚EMåº¦é‡æ˜¯åœ¨é—®ç­”ç³»ç»Ÿä¸­å¹¿æ³›è¿ç”¨çš„æŒ‡æ ‡ã€‚å®ƒè¡¡é‡çš„æ˜¯ä¸ä»»ä½•ä¸€ä¸ªçœŸå®ç­”æ¡ˆå®Œå…¨åŒ¹é…çš„é¢„æµ‹çš„æ¯”ä¾‹ã€‚æ˜¯SQuADçš„ä¸»è¦è¡¡é‡æŒ‡æ ‡ã€‚</p><h3 id="MRR"><a href="#MRR" class="headerlink" title="MRR"></a>MRR</h3><p>MRRï¼Œå…¨ç§°mean reciprocal rankï¼Œå¹¿æ³›ç”¨äºè¯„ä¼°NLPä¸­éœ€è¦æ’åºçš„æ¨¡å‹ä¸ç®—æ³•ä¸­ï¼Œå¸¸è§äºä¿¡æ¯æ£€ç´¢ä¸é—®ç­”ä»»åŠ¡ä¸­ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">MRR=\frac {1}{Q} \sum_{i=1}^{Q}\frac {1}{rank_i}</script><p>å…¶ä¸­ï¼Œ$Q$è¡¨ç¤ºqueryçš„ä¸ªæ•°ï¼Œ$rank_i$è¡¨ç¤ºç¬¬iä¸ªqueryåœ¨çœŸå®ç­”æ¡ˆé›†ä¸­å‡ºç°çš„ä½ç½®ã€‚ä¸¾ä¸ªğŸŒ°ï¼ˆæ¥æºäºçŸ¥ä¹ï¼‰ï¼š</p><p><img src="/2020/05/12/NLP-%E5%88%86%E7%B1%BB%E4%B8%8E%E5%8C%B9%E9%85%8D%E7%9A%84%E5%90%84%E7%B1%BB%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87/MRR.jpg" alt></p><p>å¯è®¡ç®—è¿™ä¸ªç³»ç»Ÿçš„MRRå€¼ä¸ºï¼š(1/3 + 1/2 + 1)/3 = 11/18=0.61ã€‚</p><h3 id="MAP"><a href="#MAP" class="headerlink" title="MAP"></a>MAP</h3><p>mAPï¼Œé¡¾åæ€ä¹‰ï¼Œå³APçš„å¹³å‡å€¼ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆè®¡ç®—APï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œå¹³å‡ã€‚</p><p>åœ¨ä¿¡æ¯æ£€ç´¢ä¸­ï¼ŒAPæŒ‡çš„æ˜¯ä¸åŒå¬å›ç‡ä¸Šçš„æ­£ç¡®ç‡çš„å¹³å‡å€¼ï¼Œè€Œç°åœ¨çš„æœ‰äº›æ£€ç´¢ç³»ç»Ÿä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿè¿”å›ç»“æœï¼Œåœ¨è®¡ç®—APæ—¶å°±ä¸å†è€ƒè™‘å¬å›ç‡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ•°æ®åº“ä¸­å’ŒæŸ¥è¯¢ä¿¡æ¯ç›¸å…³çš„5æ¡ä¿¡æ¯ï¼Œåˆ†åˆ«å‡ºç°åœ¨æŸ¥è¯¢ç»“æœä¸­çš„ç¬¬1ã€3ã€6ã€9ã€10ä½ï¼Œé‚£ä¹ˆè¿™æ¬¡æŸ¥è¯¢çš„APå°±æ˜¯ï¼š <img src="https://www.zhihu.com/equation?tex=AP+%3D+%EF%BC%881%2F1%2B2%2F3%2B3%2F6%2B4%2F9%2B5%2F10%EF%BC%89%2F5%3D0.62" alt="[å…¬å¼]"></p><p>å¾—åˆ°å¤šæ¡æŸ¥è¯¢çš„APå€¼ï¼Œå¯¹å…¶è¿›è¡Œå¹³å‡ï¼Œå°±å¾—åˆ°äº†mAPã€‚<a href="https://zhuanlan.zhihu.com/p/35983818" target="_blank" rel="noopener">æ¥æº</a></p><p><img src="/2020/05/12/NLP-%E5%88%86%E7%B1%BB%E4%B8%8E%E5%8C%B9%E9%85%8D%E7%9A%84%E5%90%84%E7%B1%BB%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87/MAP.jpg" alt></p><h3 id="NDCG"><a href="#NDCG" class="headerlink" title="NDCG"></a>NDCG</h3><p><a href="https://zhuanlan.zhihu.com/p/38850753" target="_blank" rel="noopener">é“¾æ¥</a></p><h2 id="æŒ‡æ ‡åœ¨æ–‡æœ¬åŒ¹é…ä¸­çš„åº”ç”¨"><a href="#æŒ‡æ ‡åœ¨æ–‡æœ¬åŒ¹é…ä¸­çš„åº”ç”¨" class="headerlink" title="æŒ‡æ ‡åœ¨æ–‡æœ¬åŒ¹é…ä¸­çš„åº”ç”¨"></a>æŒ‡æ ‡åœ¨æ–‡æœ¬åŒ¹é…ä¸­çš„åº”ç”¨</h2><p><strong>ç›¸ä¼¼åº¦è®¡ç®—ä¸å¤è¿°è¯†åˆ«</strong></p><p>è¿™ä¸ªä»»åŠ¡æ˜¯ç»™å‡ºä¸¤å¥è¯ï¼Œåˆ¤æ–­ä¸¤è€…æ˜¯ä¸æ˜¯è¡¨è¾¾äº†åŒæ ·çš„å«ä¹‰ï¼Œæˆ–è€…ä¸¤å¥è¯çš„ç›¸ä¼¼åº¦æœ‰å¤šé«˜ï¼Œä¸€èˆ¬éƒ½æ˜¯å½“æˆåˆ†ç±»é—®é¢˜æ¥å¯¹å¾…ã€‚å¸¸ç”¨çš„å…¬å¼€æ•°æ®é›†æœ‰ï¼šSTSã€QQPã€MSRPï¼Œå½“ç„¶å•¦ï¼Œè¿˜æœ‰PPDBï¼Œä½†æ˜¯æ•°é‡å¤ªå¤§ï¼Œæˆ‘æ²¡æœ‰è·‘è¿‡è¿™ä¸ªæ•°æ®é›†ï¼Œå‰é¢ä¸‰ä¸ªæ•°æ®é›†å°±å·²ç»å¾ˆå¥½å•¦ã€‚ç”±äºæ˜¯åˆ†ç±»é—®é¢˜(pointwise)ï¼Œæ‰€ä»¥è¯„ä»·æŒ‡æ ‡ä¸€èˆ¬ä½¿ç”¨Accuracyæˆ–è€…F1 scoreã€‚</p><p><strong>é—®ç­”åŒ¹é…(answer selection)</strong></p><p>è¿™ä¸ªä»»åŠ¡æŒ‡çš„æ˜¯ï¼šç»™å®šé—®é¢˜ä¸é—®é¢˜çš„å€™é€‰ç­”æ¡ˆæ± ï¼Œä»ä¸­é€‰æ‹©å‡ºæœ€å¥½çš„ç­”æ¡ˆï¼Œå¦‚æœè¯´é€‰æ‹©çš„ç­”æ¡ˆåœ¨çœŸå®ç­”æ¡ˆé›†ä¸­ï¼Œè¯´æ˜é—®é¢˜è¢«å¾ˆå¥½çš„å›ç­”äº†ï¼Œå¦åˆ™çš„è¯ï¼Œé—®é¢˜å°±æ²¡æœ‰è¢«å¾ˆå¥½çš„å›ç­”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé—®ç­”åŒ¹é…ä¼šé‡‡ç”¨pairwiseçš„å­¦ä¹ æ–¹å¼ï¼Œå³åŒquestionçš„ä¸€å¯¹æ­£è´Ÿæ ·æœ¬ä½œä¸ºä¸€ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œå½“ç„¶ä¹Ÿä¼šä½¿ç”¨listwiseã€‚å¸¸ç”¨çš„æ•°æ®é›†æœ‰ï¼šTrecQAã€insuranceQAã€WikiQAï¼Œè¿˜æœ‰QNLIï¼Œæˆ‘ä¸€èˆ¬ä¼šä½¿ç”¨å‰ä¸‰ä¸ªï¼ŒQNLIæ˜¯å¾ˆå¤§çš„æ•°æ®é›†ï¼Œè¿˜æ²¡å°è¯•è¿‡(å…³é”®æ˜¯ä¹ˆå¾—ç®—åŠ›ğŸ˜«)ã€‚è¯„ä»·æŒ‡æ ‡ä½¿ç”¨mAPä¸MRRç­‰æŒ‡æ ‡ã€‚</p><p><strong>å¯¹è¯åŒ¹é…(response selection)</strong></p><p>å¯¹è¯åŒ¹é…ä»»åŠ¡è¿˜æ²¡æœ‰è¯•è¿‡ï¼Œç›¸æ¯”é—®ç­”åŒ¹é…æ¥è¯´ï¼Œå¯¹è¯ä¼šæ›´åŠ éš¾ä¸€äº›ï¼Œå› ä¸ºå®ƒçš„å›å¤ç©ºé—´éå¸¸å¤§ã€‚å¸¸è§çš„æ•°æ®é›†ï¼šUDCã€Douban conversation Corpusã€‚è¯„ä»·æŒ‡æ ‡ä½¿ç”¨Recall_n@kï¼Œä¹Ÿå°±æ˜¯nä¸ªå€™é€‰å›å¤ä¸­ï¼Œåˆç†å›å¤å‡ºç°åœ¨å‰kä¸ªä½ç½®å°±ç®—æˆåŠŸã€‚å½“ç„¶ä¹Ÿä¼šä½¿ç”¨mAPä¸MRRã€‚</p><p><strong>è‡ªç„¶è¯­è¨€æ¨ç†/æ–‡æœ¬è•´å«è¯†åˆ«</strong></p><p>NLI/RTEä»»åŠ¡æŒ‡çš„æ˜¯ï¼šç»™å®šå¥å­A(premise)çš„å‰æä¸‹ï¼Œå¦‚æœå¥å­B(hypothesis)ä¸ºçœŸï¼Œé‚£ä¹ˆå°±æ˜¯Aè•´å«äº†Bï¼›å¦‚æœBä¸ºå‡ï¼Œé‚£ä¹ˆAä¸Bäº’ç›¸çŸ›ç›¾ï¼›å¦åˆ™Aä¸Bç›¸äº’ç‹¬ç«‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒNLI/RTEè¢«è§†ä¸ºä¸‰åˆ†ç±»é—®é¢˜(pointwise)ã€‚å¸¸è§çš„æ•°æ®é›†â€œSNLIã€XNLIã€MNLIã€‚è¯„ä»·æŒ‡æ ‡ä½¿ç”¨micro-PRFä¸macro-PRFã€‚</p><p><strong>ä¿¡æ¯æ£€ç´¢(Information Retrieval)</strong></p><p>ä¿¡æ¯æ£€ç´¢ï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆè¿›è¡Œç›¸å…³é¡¹çš„æ‰¾å›ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œrankã€‚è¯„ä»·æŒ‡æ ‡ä¼šä½¿ç”¨mAPä¸MRRã€‚</p><p><strong>æœºå™¨é˜…è¯»ç†è§£(Machine Reading Comprehension)</strong></p><p>MRCä»»åŠ¡å°±æ˜¯åœ¨æ–‡æœ¬æ®µä¸­æ‰¾å¯»ç­”æ¡ˆçš„è¿‡ç¨‹ã€‚å¸¸ç”¨æ•°æ®é›†æœ‰ï¼šSQuADã€MS MARCOã€CoQAç­‰ç­‰ã€‚è¯„ä»·æŒ‡æ ‡ä¸»è¦æ˜¯EMã€‚MRCä»»åŠ¡æ¯”è¾ƒéš¾ï¼Œè€Œä¸”éœ€è¦å¤§é‡çš„ç®—åŠ›ï¼Œæ‰€ä»¥ä¸å»ºè®®ç®—åŠ›ä¸å……è¶³çš„ç«¥é‹è‡ªå·±æï¼Œå®¹æ˜“èµ°å¾ˆå¤šå¼¯è·¯ã€‚</p><p>å¤§è‡´å°±æ˜¯è¿™æ ·å•¦ï¼Œæ¢³ç†å®Œè¿™äº›è¯„ä»·æŒ‡æ ‡åï¼Œèˆ’æœå•¦ğŸ¤©</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|gensim boyçš„ä¿®ç‚¼ä¹‹è·¯</title>
      <link href="2020/05/02/NLP-gensim-boy%E7%9A%84%E4%BF%AE%E7%82%BC%E4%B9%8B%E8%B7%AF/"/>
      <url>2020/05/02/NLP-gensim-boy%E7%9A%84%E4%BF%AE%E7%82%BC%E4%B9%8B%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘æœ€è¿‘åœ¨å¤ç°ä¸€äº›æ¨¡å‹çš„æ—¶å€™ï¼Œå‘ç°è¿™äº›æ¨¡å‹åŸºæœ¬ä¸Šéƒ½ä½¿ç”¨äº†word2vecæˆ–è€…æ˜¯Gloveç­‰word embeddingæ¨¡å‹çš„pre-trainçš„è¯å‘é‡æ¥åˆå§‹åŒ–ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œfine tuneã€‚è¿™äº›word embeddingæ¨¡å‹å®ç°èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯æˆ‘çš„ä¸»è¦ç›®çš„åˆä¸æ˜¯å»å®è·µè¿™äº›æ¨¡å‹ğŸ¥ºï¼Œå…³é”®æ˜¯è‡ªå·±å®ç°çš„è¿˜ä¸å¦‚å¼€æºçš„æ•ˆæœå¥½ï¼Œæ¯•ç«Ÿåˆ«äººçš„ä»£ç åšäº†å¾ˆå¤šå¾ˆå¤šçš„ä¼˜åŒ–å•¦ã€‚æ‰€ä»¥ï¼Œæƒ³è¦å¥½çš„æ•ˆæœå¹¶ä¸”åˆä¸æƒ³èŠ±è´¹å¤ªå¤šæ—¶é—´åœ¨pre-trainè¯å‘é‡ä¸Šé¢çš„è¯ï¼Œå­¦ä¹ gensimå°±æ˜¾å¾—éå¸¸é‡è¦äº†ã€‚æ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•gensimçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿçš„æ„å»ºvocabï¼Œå¾—åˆ°pre-trainçš„è¯å‘é‡ã€‚</p><a id="more"></a><h2 id="gensimè¦æ±‚çš„æ•°æ®æ ¼å¼"><a href="#gensimè¦æ±‚çš„æ•°æ®æ ¼å¼" class="headerlink" title="gensimè¦æ±‚çš„æ•°æ®æ ¼å¼"></a>gensimè¦æ±‚çš„æ•°æ®æ ¼å¼</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">texts = [[<span class="string">'human'</span>, <span class="string">'interface'</span>, <span class="string">'computer'</span>],</span><br><span class="line">[<span class="string">'survey'</span>, <span class="string">'user'</span>, <span class="string">'computer'</span>, <span class="string">'system'</span>, <span class="string">'response'</span>, <span class="string">'time'</span>],</span><br><span class="line">[<span class="string">'eps'</span>, <span class="string">'user'</span>, <span class="string">'interface'</span>, <span class="string">'system'</span>],</span><br><span class="line">[<span class="string">'system'</span>, <span class="string">'human'</span>, <span class="string">'system'</span>, <span class="string">'eps'</span>],</span><br><span class="line">[<span class="string">'user'</span>, <span class="string">'response'</span>, <span class="string">'time'</span>],</span><br><span class="line">[<span class="string">'trees'</span>],</span><br><span class="line">[<span class="string">'graph'</span>, <span class="string">'trees'</span>],</span><br><span class="line">[<span class="string">'graph'</span>, <span class="string">'minors'</span>, <span class="string">'trees'</span>],</span><br><span class="line">[<span class="string">'graph'</span>, <span class="string">'minors'</span>, <span class="string">'survey'</span>]]</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨å°†æ•°æ®è¾“å…¥åˆ°gensimçš„æ¨¡å‹è¿›è¡Œè®­ç»ƒä¹‹å‰ï¼Œè¦å¯¹corpusè¿›è¡Œåˆ†è¯ã€å»é™¤åœç”¨è¯ç­‰æ“ä½œï¼Œæ€»ä¹‹è¦å˜æˆä¸Šè¿°çš„æ ¼å¼ã€‚å½“ç„¶å•¦ã€‚å¦‚æœè¦å¤„ç†è¶…å¤§çš„æ–‡ä»¶çš„è¯ï¼Œæ˜¯æ— æ³•ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½è¿›å…¥å†…å­˜çš„ï¼Œæ‰€ä»¥gensimä¹Ÿæ”¯æŒæµå¼å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´å°†å…¶å˜æˆä¸€ä¸ªpythonç”Ÿæˆå™¨å°±å¯ä»¥ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> Word2Vec</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySentence</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,file)</span>:</span></span><br><span class="line">self.file=file</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(file,<span class="string">"r"</span>,encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">      <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines();</span><br><span class="line">      <span class="comment">#æ·¡å½“ç„¶ä¸­é—´å¯ä»¥æ‰§è¡Œå¾ˆå¤šæ“ä½œï¼Œå¦‚åˆ†è¯ã€å»é™¤åœç”¨è¯ç­‰ç­‰</span></span><br><span class="line">      yiled list(jieba.cut(line.strip()))</span><br><span class="line"></span><br><span class="line">my_sentence=MySentence(file)</span><br><span class="line">w2v_model=Word2Vec(my_sentence)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¿é—®tokençš„è¯å‘é‡</span></span><br><span class="line">w2v_model[<span class="string">"a"</span>]</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨LineSentenceï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gensim,models.word2vec <span class="keyword">import</span> LineSentence</span><br><span class="line"><span class="comment">#æ³¨æ„ï¼ša.txtå¿…é¡»æ˜¯å·²ç»åˆ†å¥½è¯çš„æ–‡ä»¶ï¼</span></span><br><span class="line">sentences=LineSentence(<span class="string">"a.txt"</span>)</span><br></pre></td></tr></table></figure><h2 id="Word2Vecæ¨¡å‹å‚æ•°"><a href="#Word2Vecæ¨¡å‹å‚æ•°" class="headerlink" title="Word2Vecæ¨¡å‹å‚æ•°"></a>Word2Vecæ¨¡å‹å‚æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> Word2Vec</span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤æ„å»ºå‡ºæ¥çš„è¯æ±‡è¡¨ï¼Œæ˜¯æŒ‰ç…§é¢‘ç‡é™åºæ’åˆ—ã€‚</span></span><br><span class="line">model=Word2Vec(sentences=sentence,\<span class="comment">#è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">              min_count=<span class="number">5</span>,\<span class="comment">#ä½äºmin_countçš„é¢‘ç‡çš„tokenå°†è¢«æŠ›å¼ƒ</span></span><br><span class="line">              size=<span class="number">100</span>,\<span class="comment">#embeddingçš„ç»´åº¦</span></span><br><span class="line">              workers=<span class="number">4</span>,\<span class="comment">#ç”¨äºè®­ç»ƒçš„çº¿ç¨‹æ•°ç›®</span></span><br><span class="line">              sg=<span class="number">0</span>,\<span class="comment">#ä¸º0è¡¨ç¤ºä½¿ç”¨CBOWï¼Œä¸º1è¡¨ç¤ºä½¿ç”¨skip-gram</span></span><br><span class="line">              )</span><br></pre></td></tr></table></figure><h2 id="è¯æ±‡è¡¨ä¿å­˜ä¸åŠ è½½"><a href="#è¯æ±‡è¡¨ä¿å­˜ä¸åŠ è½½" class="headerlink" title="è¯æ±‡è¡¨ä¿å­˜ä¸åŠ è½½"></a>è¯æ±‡è¡¨ä¿å­˜ä¸åŠ è½½</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿™ç§æ–¹å¼å¯ä»¥åŠ è½½åå¢åŠ è®­ç»ƒ</span></span><br><span class="line">model.save(<span class="string">"vocab.w2v"</span>)</span><br><span class="line">model=Word2Vec.load(<span class="string">"vocab.w2v"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ç§æ–¹å¼æ— æ³•å¢åŠ è®­ç»ƒ</span></span><br><span class="line">model.wv.save_word2vec_format(<span class="string">"wde.txt"</span>,binary=<span class="literal">False</span>)</span><br><span class="line">model.wv.save_word2vec_format(<span class="string">"wd.bin"</span>,binary=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> KeyedVectors</span><br><span class="line">model=KeyedVectors.load_word2vec_format(<span class="string">"ds.txt"</span>,binary=<span class="literal">False</span>)</span><br><span class="line">model=KeyedVectors.load_word2vec_format(<span class="string">"ds.bin"</span>,binary=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ç›®å‰å¤§è‡´èƒ½ç”¨åˆ°çš„å°±æ˜¯è¿™æ ·ï¼Œå…¶ä»–çš„ç­‰ä»¥åç”¨åˆ°çš„è¯ï¼Œå†æ›´æ–°å§ï½ğŸ¥°</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="https://radimrehurek.com/gensim/models/word2vec.html#gensim.models.word2vec.Word2Vec" target="_blank" rel="noopener">https://radimrehurek.com/gensim/models/word2vec.html#gensim.models.word2vec.Word2Vec</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> gensim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-HCAN</title>
      <link href="2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/"/>
      <url>2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„HCANæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="HCANæ¨¡å‹ä»‹ç»"><a href="#HCANæ¨¡å‹ä»‹ç»" class="headerlink" title="HCANæ¨¡å‹ä»‹ç»"></a>HCANæ¨¡å‹ä»‹ç»</h2><p>HCANæ¨¡å‹æ¥æºäº2019å¹´çš„ã€ŠBridging the Gap Between Relevance Matching and Semantic Matching for Short Text Similarity Modelingã€‹è®ºæ–‡ã€‚æ•´ä½“æ¥è¯´ä¸ç®—å¤ªéš¾ã€‚</p><h3 id="HCANæ¨¡å‹æå‡ºçš„åŸå› "><a href="#HCANæ¨¡å‹æå‡ºçš„åŸå› " class="headerlink" title="HCANæ¨¡å‹æå‡ºçš„åŸå› "></a>HCANæ¨¡å‹æå‡ºçš„åŸå› </h3><p>åœ¨NLPä¸­ï¼Œå­˜åœ¨ç€ä¸¤å¤§ä»»åŠ¡ï¼šrelevance matching(RM)ä¸semantic matching(SM)ã€‚æ‰€è°“çš„RMå¸¸è§äºä¿¡æ¯æ£€ç´¢ä¸­ï¼Œå…¶ç›®çš„åœ¨äºæ ¹æ®queryä¸documentsçš„relevanceï¼Œå¯¹documentsè¿›è¡Œæ’åºï¼Œå…¶æ ¸å¿ƒæ˜¯å…³é”®å­—åŒ¹é…ï¼›è€ŒSMï¼Œå…¶ç›®çš„åœ¨äºè®¡ç®—ä¸¤ä¸ªå¥å­çš„ç›¸ä¼¼åº¦æˆ–è€…åŒ¹é…åº¦ï¼Œå…¶æ ¸å¿ƒæ˜¯å¥å­è¯­ä¹‰ä¸Šçš„åŒ¹é…ã€‚ä»è¿™ä¸ªå®šä¹‰ä¸­ï¼Œå¯ä»¥çœ‹å‡ºRMæœ¬è´¨ä¸Šä¹Ÿæ˜¯è¯­ä¹‰åŒ¹é…ï¼Œæ‰€ä»¥RMä¸SMæœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š<strong>èƒ½ä¸èƒ½æå‡ºä¸€ç§æ¨¡å‹ï¼Œåœ¨RMä¸SMä¸Šéƒ½èƒ½å–å¾—éå¸¸å¥½çš„æ•ˆæœå‘¢ï¼Ÿ</strong>è¿™å°±æ˜¯HCANæ¨¡å‹æå‡ºçš„åŸå› ã€‚</p><h3 id="HCANæ¨¡å‹æ¶æ„"><a href="#HCANæ¨¡å‹æ¶æ„" class="headerlink" title="HCANæ¨¡å‹æ¶æ„"></a>HCANæ¨¡å‹æ¶æ„</h3><p>æ•´ä¸ªæ¶æ„æ¯”è¾ƒç®€å•ï¼šword embeddingå±‚ã€hybrid encoderå±‚ã€relevance matchingä¸semantic matchingå±‚ã€æœ€åçš„åˆ†ç±»å±‚ã€‚ç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/HCANæ¨¡å‹æ¶æ„.jpg" style="zoom:50%;"></p><h4 id="Embedding-layer"><a href="#Embedding-layer" class="headerlink" title="Embedding layer"></a>Embedding layer</h4><p>è¾“å…¥å¥å­å¯¹ï¼Œè®°ä½œ$(q,c)$ï¼Œåœ¨QAä»»åŠ¡ä¸­ï¼Œå…¶è¡¨ç¤ºquestionä¸answerï¼Œåœ¨ä¿¡æ¯æ£€ç´¢ä¸­ï¼Œå…¶è¡¨ç¤ºqueryä¸documentã€‚å…¶ä¸­ï¼Œ$qã€c$å‡è¡¨ç¤ºå¥å­çš„tokençš„é›†åˆï¼Œå®ƒä»¬çš„embeddingè®°ä½œï¼š$\{w_1^q,w_2^q,w_3^q,â€¦,w_n^q\}$ä¸$\{w_1^c,w_2^c,w_3^c,â€¦,w_m^c\}$ï¼Œembedddingçš„ç»´åº¦ä¸º$L$ï¼Œ$nã€m$æ˜¯å¥å­çš„é•¿åº¦ï¼Œæ‰€ä»¥ï¼Œ$q\in R^{n\times L}ã€c\in R^{m\times L}$ã€‚</p><h4 id="Hybrid-Encoders"><a href="#Hybrid-Encoders" class="headerlink" title="Hybrid Encoders"></a>Hybrid Encoders</h4><p>åœ¨å¾—åˆ°å¥å­çš„embeddingåï¼Œä¸ºäº†è¿›ä¸€æ­¥å¾—åˆ°æ›´åŠ ä¸°å¯Œçš„è¡¨ç¤ºï¼Œåœ¨HCANä¸­ï¼Œä½¿ç”¨äº†ä¸‰ç§ä¸åŒç±»å‹çš„encodersï¼š<strong>deepã€wideã€contextualã€‚</strong></p><p><strong>Deep Encoderï¼š</strong>æ‰€è°“çš„Deep encoderï¼Œå°±æ˜¯å åŠ å¤šä¸ªå·ç§¯å±‚ï¼Œä»è€Œå¾—åˆ°æ›´åŠ ä¸°å¯Œçš„è¯­ä¹‰è¡¨ç¤ºï¼Œåœ¨è®ºæ–‡ä¸­ï¼Œç§°ä½œphrase-level representationï¼Œç¬¬$h$ä¸ªå·ç§¯å±‚çš„è¾“å‡ºè®°ä½œï¼š$U^h$ã€‚è¿™ä¸ªå’ŒDPCNNä¸­çš„region embeddingæœ‰ç‚¹ç›¸ä¼¼ï¼Œä¸ç†Ÿæ‚‰DPCNNçš„ï¼Œå¯ä»¥ç§»æ­¥æˆ‘çš„æ–‡ç« ï¼š<a href="https://codewithzichao.github.io/2020/04/25/NLP-æ–‡æœ¬åˆ†ç±»æ¨¡å‹-DPCNN/#more">DPCNN</a></p><blockquote><p>æ³¨æ„ï¼Œqä¸cæ˜¯å…±äº«è¿™äº›å‚æ•°çš„ï¼</p></blockquote><p><strong>Wide encoderï¼š</strong>wide encoderåˆ™æ˜¯æ¢äº†ä¸€ç§æ€è·¯ï¼Œå¹¶è”å¤šä¸ªå·ç§¯å±‚ï¼Œä¹Ÿå°±æ˜¯â€œå˜å®½â€ã€‚ç»™å®š$N$ä¸ªå·ç§¯å±‚ï¼Œå‡è®¾ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„çª—å£å¤§å°ä¸ºkï¼Œé‚£ä¹ˆNä¸ªå·ç§¯å±‚çš„çª—å£å¤§å°ä¾æ¬¡æ˜¯ï¼š$[k,k+1,k+2,k+3,..,k+N-1]$.</p><p><strong>Contextual encoder</strong>ï¼šcontextual encoderä¸ä½¿ç”¨å·ç§¯å±‚ï¼Œè½¬è€Œä½¿ç”¨BILSTMæ¥æå–æ›´ä¸ºä¸°å¯Œçš„è¯­ä¹‰ç‰¹å¾ã€‚ç»™å®š$N$ä¸ªBILSTMå±‚ï¼Œç¬¬$h$ä¸ªBILSTMå±‚çš„è¾“å‡ºæ˜¯ï¼š$U^h$ã€‚</p><p><strong>ä¸‰ç§encoderçš„æ¯”è¾ƒ</strong></p><blockquote><ol><li>deepä¸wideç”±äºä½¿ç”¨CNNï¼Œæ‰€ä»¥å¹¶è¡Œè®¡ç®—æ•ˆç‡æ¯”contextualè¦é«˜ï¼Œè®­ç»ƒè¦å¿«ï¼›æ­¤å¤–ï¼Œä½¿ç”¨CNNçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶çª—å£å¤§å°ï¼Œèƒ½å¤Ÿå¾—åˆ°ä¸åŒphrase levelçš„è¯­ä¹‰è¡¨ç¤ºã€‚åŒæ—¶ï¼Œè¿™æ ·å¯¹äºrelevance matchingä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</li><li>deepçš„å‚æ•°æ•°é‡æ›´å°‘ï¼Œå› ä¸ºdeepä¸­æ‰€æœ‰å±‚çš„filteræ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å‚æ•°å…±äº«ã€‚</li></ol></blockquote><h4 id="Relevance-Matching"><a href="#Relevance-Matching" class="headerlink" title="Relevance Matching"></a>Relevance Matching</h4><blockquote><p>æ³¨æ„ï¼šä¸‹é¢æ‰€ç¤ºçš„ç»´åº¦å‡æ²¡æœ‰å¸¦ä¸Šbatch_sizeï¼</p></blockquote><p>é€šè¿‡hybrid encodersä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°qä¸cçš„æ·±å±‚æ¬¡çš„å‘é‡åŒ–è¡¨ç¤ºï¼š$ U_q\in R^{n\times F}ã€U_c\in R^{m\times F}$ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬é¦–å…ˆè¦å»å¾—åˆ°relevance matchingã€‚é‡‡ç”¨çš„æ–¹å¼å°±æ˜¯dotã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">S=U_qU_c^T, \ \ \ \ \ \ \ \ \ \ S\in R^{n\times m}</script><p>ç„¶åï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåœ¨contextåˆ—ä¸Šä½¿ç”¨softmaxï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\tilde S=softmax(S)</script><p>è¿™ä¸€æ­¥çš„æ„ä¹‰åœ¨äºè®©å¾—åˆ°çš„similarity scoreçš„èŒƒå›´å¤„äº[0,1]ï¼Œæ­¤å¤–ï¼Œsoftmaxä¹Ÿèƒ½å¤Ÿè®©scoreä¹‹é—´çš„åŒºåˆ†åº¦å˜å¤§ã€‚</p><p>ç„¶åå†å¯¹å…¶ä½¿ç”¨æœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–ï¼ˆæ³¨æ„ï¼Œæ˜¯å…¨å±€æ± åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ± åŒ–åï¼Œä¼šå‡å°‘ä¸€ä¸ªç»´åº¦ï¼‰ï¼Œè®ºæ–‡ä¸­æŒ‡å‡ºï¼Œå¹³å‡æ± åŒ–è¦å¥½ä¸€ç‚¹ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/RM.jpg" style="zoom:50%;"></p><p>æ¥ä¸‹æ¥ï¼Œä½œè€…è¿˜å¼•å…¥äº†IDFæ¥ä½œä¸ºä¸åŒçš„query termä¸phraseçš„æƒé‡ï¼Œè¡¡é‡å…¶é‡è¦æ€§ç¨‹åº¦ã€‚</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/IDF.jpg" style="zoom:50%;"></p><p>è¿™æ ·åŠ æƒçš„æ–¹æ³•ä¹Ÿå¯ä»¥å‡å°å¾—åˆ†æ¯”è¾ƒå¤§çš„token(è­¬å¦‚åœç”¨è¯)çš„å½±å“ã€‚</p><h4 id="Semantic-Matching"><a href="#Semantic-Matching" class="headerlink" title="Semantic Matching"></a>Semantic Matching</h4><p>Semantic Matchingçš„è¾“å‡ºä»ç„¶é‡‡ç”¨hybird encodersçš„è¾“å‡ºï¼Œå³qä¸cçš„æ·±å±‚æ¬¡çš„å‘é‡åŒ–è¡¨ç¤ºï¼š$U_q\in R^{n\times F}ã€U_c\in R^{m\times F}$ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä½¿ç”¨co-attentionæœºåˆ¶ï¼Œä¸ç†Ÿæ‚‰co-attentionæœºåˆ¶çš„ç«¥é‹ï¼Œå¯ä»¥å‚çœ‹è®ºæ–‡ã€ŠBIDIRECTIONAL ATTENTION F LOW FOR MACHINE COMPREHENSIONã€‹ï¼Œè¿™æ˜¯åœ¨MRCä»»åŠ¡ä¸­å¤§åé¼é¼çš„BIDAFæ¨¡å‹ï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ğŸ¤©ã€‚ä½¿ç”¨co-attentionæœºåˆ¶çš„å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/co-attention.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼ŒREPè¡¨ç¤ºå°†inputè½¬åŒ–ä¸ºnâœ–ï¸mçš„çŸ©é˜µï¼Œ$W_q,W_c\in R^{F}ï¼ŒW_b\in R^{F\times F}$ã€‚</p><p>åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä½¿ç”¨co-attentionæœºåˆ¶ï¼šquery-to-contextå’Œcontext-to-queryã€‚</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/co-ten.jpg" style="zoom:50%;"></p><p>ç„¶åå¯¹å¾—åˆ°çš„å‘é‡è¿›è¡Œconcatï¼Œå†ä½¿ç”¨BILSTMæ¥è¿›è¡Œç¼–ç ï¼Œå¾—åˆ°è¾“å‡ºã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/bilstm.jpg" style="zoom:50%;"></p><p>æ³¨æ„ï¼Œæˆ‘ä»¬åªä½¿ç”¨BILSTMçš„æœ€åä¸€ä¸ªè¾“å‡ºã€‚</p><h4 id="Final-classification"><a href="#Final-classification" class="headerlink" title="Final classification"></a>Final classification</h4><p>å¯¹relevance matchingä¸semantic matchingå¾—åˆ°çš„è¾“å‡ºè¿›è¡Œconcatï¼Œç„¶åä½¿ç”¨ä¸¤å±‚çš„MLPï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/final.jpg" style="zoom:50%;"></p><p>HCANåœ¨answer selection(ä½¿ç”¨TrecQAæ•°æ®é›†ã€è¯„ä»·æŒ‡æ ‡MAPä¸MRR)ã€paraphrase identification(ä½¿ç”¨TwitterURLæ•°æ®é›†ã€è¯„ä»·æŒ‡æ ‡macro-F1)ã€semantic textual similarity(ä½¿ç”¨Quoraæ•°æ®é›†ï¼Œè¯„ä»·æŒ‡æ ‡å‡†ç¡®ç‡)ã€Tweet Search(TREC Microblogæ•°æ®é›†ã€è¯„ä»·æŒ‡æ ‡P@30)ã€‚ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/ç»“æœ1.jpg" style="zoom:50%;"></p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-HCAN/jieguo2.jpg" style="zoom:50%;"></p><p>ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒHCANæ¨¡å‹åŠæ‰“äº†DecAttã€ESIMã€InferSentç­‰ä¸€ä¼—æ¨¡å‹ï¼Œä½†æ˜¯ä»ç„¶æ‰“ä¸è¿‡BERTã€‚æ‰€ä»¥ï¼Œè¦åœ¨æ–‡æœ¬åŒ¹é…ä»»åŠ¡é‡å–å¾—æ›´å¥½çš„ç»“æœï¼Œç›®å‰è¿˜æ˜¯ç¦»ä¸å¼€é¢„è®­ç»ƒæ¨¡å‹ã€‚</p><h2 id="HCANæ¨¡å‹å®ç°"><a href="#HCANæ¨¡å‹å®ç°" class="headerlink" title="HCANæ¨¡å‹å®ç°"></a>HCANæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Bridging the Gap Between Relevance Matching and Semantic Matching for Short Text Similarity Modeling</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> HCAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-DSSM/CDSSM</title>
      <link href="2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DSSM-CDSSM/"/>
      <url>2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DSSM-CDSSM/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„DSSM/CDSSMæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="DSSMæ¨¡å‹ä»‹ç»"><a href="#DSSMæ¨¡å‹ä»‹ç»" class="headerlink" title="DSSMæ¨¡å‹ä»‹ç»"></a>DSSMæ¨¡å‹ä»‹ç»</h2><p>DSSMæ¨¡å‹æ¥æºäº2013å¹´ã€ŠLearning Deep Structured Semantic Models for Web Search using Clickthrough Dataã€‹è®ºæ–‡ã€‚ç”±äºæ˜¯13å¹´çš„è®ºæ–‡ï¼Œæ‰€ä»¥å…¶å®æ•´ä½“æ€æƒ³è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DSSM-CDSSM/DSSM.jpg" alt></p><p>$x$è¡¨ç¤ºterm vectorï¼Œ è¡¨ç¤ºè¾“å‡ºå‘é‡ï¼Œ$l_i,i=1,â€¦,N$ è¡¨ç¤ºéšè—å±‚ï¼Œ $W_i$ è¡¨ç¤ºç¬¬$i$å±‚çš„å‚æ•°çŸ©é˜µï¼Œ$b_i$è¡¨ç¤º ç¬¬$i$ä¸ªåç½®é¡¹ã€‚</p><p><img src="https://www.zhihu.com/equation?tex=l_%7B1%7D%3DW_%7B1%7Dx+%5C%5C+l_%7Bi%7D%3Df%28W_%7Bi%7Dl_%7Bi-1%7D%2Bb_%7Bi%7D%29%2Ci%3D2%2C...%2CN-1+%5C%5C+y+%3D+f%28W_%7BN%7Dl_%7BN-1%7D%2Bb_%7BN%7D%29+%5C%5C+" alt="[å…¬å¼]"></p><p>å…¶ä¸­ï¼Œä½¿ç”¨ $tanh$ ä½œä¸ºè¾“å‡ºå±‚å’Œéšè—å±‚çš„æ¿€æ´»å‡½æ•°ã€‚åœ¨æ£€ç´¢ä¸­ï¼Œä½¿ç”¨$Q$è¡¨ç¤ºqueryï¼Œ$D$è¡¨ç¤ºdocï¼Œï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„ç›¸å…³åº¦å¯ä»¥ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æ¥è¡¡é‡ã€‚</p><p><img src="https://www.zhihu.com/equation?tex=R%28Q%2CD%29%3Dcosine%28y_%7BQ%7D%2Cy_%7BD%7D%29%3D%5Cfrac%7By_%7BQ%7D%5E%7BT%7Dy_%7BD%7D%7D%7B%5Cleft+%5C%7C+y_%7BQ%7D%5Cright%5C%7C+%5Cleft+%5C%7C+y_%7BD%7D%5Cright%5C%7C%7D+%5C%5C" alt="[å…¬å¼]"></p><p>åœ¨Â·word2vecè¿˜æ²¡æœ‰å…´èµ·ä¹‹å‰ï¼Œä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨BOWæ„å»ºè¯æ±‡è¡¨ï¼Œç„¶åä½¿ç”¨one-hotè¿›è¡Œç¼–ç ï¼Œä½†æ˜¯æ—¶é—´ä¸Šï¼Œè¯æ±‡è¡¨ä¼šéå¸¸å¤§ï¼Œåœ¨DSSMä¸­ï¼Œä½¿ç”¨word hashingçš„æ–¹æ³•ï¼Œä½œä¸ºæ¨¡å‹çš„ç¬¬ä¸€å±‚ã€‚å’Œword2vecæ¯”è¾ƒåƒï¼Œéƒ½æ˜¯å°†é«˜ç»´ç¨€ç–å‘é‡è½¬æ¢ä¸ºä½ç»´ç¨ å¯†å‘é‡ã€‚</p><p><code>Word Hashing</code>æ˜¯paperéå¸¸é‡è¦çš„ä¸€ä¸ª <code>trick</code>ï¼Œä»¥è‹±æ–‡å•è¯æ¥è¯´ï¼Œæ¯”å¦‚ <code>good</code>ï¼Œä»–å¯ä»¥å†™æˆ <code>#good#</code>ï¼Œç„¶åæŒ‰tri-gramsæ¥è¿›è¡Œåˆ†è§£ä¸º <code>#go goo ood od#</code>ï¼Œå†å°†è¿™ä¸ªtri-gramsçŒå…¥åˆ° <code>bag-of-word</code>ä¸­ï¼Œè¿™ç§æ–¹å¼å¯ä»¥éå¸¸æœ‰æ•ˆçš„è§£å†³ <code>vocabulary</code>å¤ªå¤§çš„é—®é¢˜(å› ä¸ºåœ¨çœŸå®çš„web searchä¸­vocabularyå°±æ˜¯å¼‚å¸¸çš„å¤§)ï¼Œå¦å¤–ä¹Ÿä¸ä¼šå‡ºç° <code>oov</code>é—®é¢˜ï¼Œå› æ­¤è‹±æ–‡å•è¯æ‰26ä¸ªï¼Œ3ä¸ªå­—æ¯çš„ç»„åˆéƒ½æ˜¯æœ‰é™çš„ï¼Œå¾ˆå®¹æ˜“æšä¸¾å…‰ã€‚ </p><p>åœ¨å¾—åˆ°ä½™å¼¦ç›¸ä¼¼åº¦ä¹‹åï¼Œå†ä½¿ç”¨softmaxï¼Œé€šè¿‡softmax å‡½æ•°å¯ä»¥æŠŠquery ä¸æ ·æœ¬ doc çš„è¯­ä¹‰ç›¸ä¼¼æ€§è½¬åŒ–ä¸ºä¸€ä¸ªåéªŒæ¦‚ç‡ï¼š</p><p><img src="https://www.zhihu.com/equation?tex=P%28D%7CQ%29%3D%5Cfrac%7Bexp%28%5Cgamma+R%28Q%2CD%29%29%7D%7B%5Csum_%7BD%5E%5Cprime%5Cin+%5Cbold+D%7D%7Bexp%28%5Cgamma+R%28Q%2C+D%5E%5Cprime%29%29%7D%7D+%5C%5C" alt="[å…¬å¼]"></p><p>å…¶ä¸­$\gamma$æ˜¯ä¸€ä¸ªsoftmaxå‡½æ•°çš„å¹³æ»‘å› å­ï¼Œ <img src="https://www.zhihu.com/equation?tex=%5Cbold+D" alt="[å…¬å¼]"> è¡¨ç¤ºè¢«æ’åºçš„å€™é€‰æ–‡æ¡£é›†åˆï¼Œåœ¨å®é™…ä¸­ï¼Œå¯¹äºæ­£æ ·æœ¬ï¼Œæ¯ä¸€ä¸ªï¼ˆqueryï¼Œ ç‚¹å‡»docï¼‰å¯¹ï¼Œä½¿ç”¨ $(Q,D^+)$è¡¨ç¤ºï¼›å¯¹äºè´Ÿæ ·æœ¬ï¼Œéšæœºé€‰æ‹©4ä¸ªæ›å…‰ä½†æœªç‚¹å‡»çš„docï¼Œç”¨ <img src="https://www.zhihu.com/equation?tex=%5Cleft%5C%7BD_%7Bj%7D%5E%7B-%7D%3B+j%3D1%2C...%2C4%5Cright%5C%7D" alt="[å…¬å¼]"> æ¥è¡¨ç¤ºã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼Œé€šè¿‡æå¤§ä¼¼ç„¶ä¼°è®¡æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ï¼š</p><p><img src="https://www.zhihu.com/equation?tex=L%28%5CLambda%29+%3D+-log%5Cprod_%7B%28Q%2CD%5E%7B%2B%7D%29%7D%5E%7B%7D+P%28D%5E%7B%2B%7D%7CQ%29+%5C%5C" alt="[å…¬å¼]"></p><p>å…¶ä¸­$\Lambda$è¡¨ç¤ºç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚æ¨¡å‹é€šè¿‡éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰æ¥è¿›è¡Œä¼˜åŒ–ï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°å„ç½‘ç»œå±‚çš„å‚æ•° $W_i,b_i$ã€‚</p><p>DSSMæ¨¡å‹çš„ç¼ºç‚¹åœ¨äºï¼šä½¿ç”¨word hashingä¼šé€ æˆå†²çªï¼Œå› ä¸ºä¸åŒçš„å•è¯æœ‰å¯èƒ½äº§ç”ŸåŒæ ·çš„n-gramï¼›é‡‡ç”¨è¯è¢‹æ¨¡å‹ï¼ŒæŸå¤±äº†ä¸Šä¸‹æ–‡ç»“æ„ä¿¡æ¯ã€‚</p><h2 id="CDSSMæ¨¡å‹ä»‹ç»"><a href="#CDSSMæ¨¡å‹ä»‹ç»" class="headerlink" title="CDSSMæ¨¡å‹ä»‹ç»"></a>CDSSMæ¨¡å‹ä»‹ç»</h2><p>CDSSMæ˜¯DSSMçš„æ”¹è¿›ï¼Œåœ¨DSSMä¸­ï¼Œç”±äºé‡‡ç”¨è¯è¢‹æ¨¡å‹æ¥è¡¨ç¤ºè¾“å…¥çš„queryä¸documentï¼Œå®Œå…¨ä¸§å¤±äº†å¥å­æœ¬èº«åº”æœ‰çš„ä¸Šä¸‹æ–‡ç»“æ„ä¿¡æ¯ï¼Œè€ŒCDSSMé‡‡ç”¨è¯n-gramä¸å·ç§¯æ± åŒ–æ“ä½œï¼Œæ•è·ä¸Šä¸‹æ–‡å…³ç³»ã€‚æ¨¡å‹å›¾å¦‚ä¸‹ï¼šğŸ‘‡</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DSSM-CDSSM/CDSSM.jpg" style="zoom: 45%;"></p><p><strong>Query/documentï¼š</strong>è¾“å…¥çš„queryä¸docå¥å­ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>&lt;s&gt;</code>è¿›è¡Œå¡«å……ï¼Œä¿è¯è¿›è¡Œå·ç§¯çš„æ—¶å€™ï¼Œå‰åéƒ½æœ‰è¯ã€‚</p><p><strong>Sliding window</strong> æ˜¯å®šä¹‰æ»‘åŠ¨çª—å£å¯¹è¾“å…¥çš„å¥å­åšn-gram,æ¥è·å–word-n-gramï¼Œæ–‡ç« ç”¨çš„tri-gramã€‚</p><p><strong>word-n-gram layer</strong> æ˜¯ç»è¿‡æ»‘çª—å¤„ç†åçš„word-n-gram æ•°æ®ã€‚</p><p><strong>Letter-trigram layer</strong> æ˜¯å¯¹word-n-gram æŒ‰åŸå§‹dssmè¯´çš„é‚£ä¸ªæŠŠå•è¯ç”¨n-gramè¿›è¡Œåˆ‡å‰²çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä¸è¿‡åœ¨è¿›è¡Œè¯è¢‹æ¨¡å‹ç»Ÿè®¡çš„æ—¶å€™ç»Ÿè®¡çš„æ˜¯word-n-gramäº†ï¼Œä¸å†æ˜¯æ•´ä¸ªå¥å­ã€‚</p><p><strong>å·ç§¯å±‚ï¼š</strong>ä¸€ç»´å·ç§¯ã€‚</p><p><strong>max-pooling ï¼š</strong>æ± åŒ–å±‚ä¹Ÿæ˜¯ç»å¸¸å’Œå·ç§¯ä¸€èµ·é…åˆä½¿ç”¨çš„æ“ä½œäº†ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥é€‰æ‹©max-poolingæ˜¯å› ä¸ºï¼Œè¯­ä¹‰åŒ¹é…çš„ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°queryå’Œdocä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œé‚£ä¹ˆå°±éœ€è¦å»æ‰¾åˆ°ä¸¤è€…ç›¸ä¼¼çš„ç‚¹ï¼Œmax-poolingåˆ™å¯ä»¥æ‰¾åˆ°æ•´ä¸ªç‰¹å¾å›¾ä¸­æœ€é‡è¦çš„ç‚¹ï¼Œè€Œavg-poolingåˆ™å®¹æ˜“æŠŠé‡è¦çš„ä¿¡æ¯å¹³å‡æ‰ã€‚<br>ä¹‹ååŠ ä¸€å±‚å…¨è¿æ¥ï¼ŒæŸå¤±å‡½æ•°ä»€ä¹ˆçš„éƒ½ä¸DSSMä¸€æ ·ã€‚</p><h2 id="CDSSMæ¨¡å‹å®ç°"><a href="#CDSSMæ¨¡å‹å®ç°" class="headerlink" title="CDSSMæ¨¡å‹å®ç°"></a>CDSSMæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Learning Deep Structured Semantic Models for Web Search using Clickthrough Data</p><p>A Latent Semantic Model with Convolutional-Pooling Structure for Information Retrieval</p><p><a href="https://zhuanlan.zhihu.com/p/53326791" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/53326791</a></p><p><a href="https://www.cnblogs.com/wmx24/p/10157154.html" target="_blank" rel="noopener">https://www.cnblogs.com/wmx24/p/10157154.html</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> DSSM </tag>
            
            <tag> CDSSM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-InferSent</title>
      <link href="2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-InferSent/"/>
      <url>2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-InferSent/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„InferSentæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="InferSentæ¨¡å‹ä»‹ç»"><a href="#InferSentæ¨¡å‹ä»‹ç»" class="headerlink" title="InferSentæ¨¡å‹ä»‹ç»"></a>InferSentæ¨¡å‹ä»‹ç»</h2><p>InferSentæ¨¡å‹æ¥æºäº2018å¹´Facebookå‘è¡¨çš„ã€ŠSupervised Learning of Universal Sentence Representations from Natural Language Inference Dataã€‹è®ºæ–‡ã€‚è¿™æ˜¯ä¸€ç¯‡éå¸¸æœ‰å½±å“åŠ›çš„å·¥ä½œã€‚é¦–å…ˆè°ˆè°ˆInferSentæå‡ºçš„åŸå› å§ï¼š<strong>ç›®å‰word embeddingå·²ç»è¢«å¹¿æ³›åº”ç”¨äº†ï¼Œä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„æ˜¯sentence embeddingï¼Œå³å¥å­çš„å‘é‡åŒ–è¡¨ç¤º(ç”šè‡³æ˜¯æ®µè½ã€æ–‡ç« çš„å‘é‡åŒ–è¡¨ç¤º)ï¼Œåªæ˜¯å•çº¯å¯¹æ‰€æœ‰word embeddingç›¸åŠ å–å¹³å‡ï¼Œæ— æ³•æå–åˆ°æœ‰æ„ä¹‰å¹¶ä¸”ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ï¼Œæ‰€ä»¥æ€ä¹ˆæ‰èƒ½æå–å‡ºæœ‰æ„ä¹‰å¹¶ä¸”ä¸°å¯Œçš„sentence embeddingï¼Œå¹¶ä¸”æå–çš„æ–¹æ³•è¦éå¸¸çš„generalizeï¼Œèƒ½åœ¨å„ç§taskä¸­å¾—åˆ°sentence embeddingï¼Œæˆä¸ºäº†ä¸€ä¸ªäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚</strong>ä»ç»“æ„ä¸Šæ¥è®²ï¼ŒInferSentæ˜¯ä¸€ä¸ªåŸºäºè¡¨ç¤ºçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹ï¼Œä½†æ˜¯å®ƒçš„çœŸæ­£ç›®çš„æ˜¯æå‡ºä¸€ç§æœ‰ç›‘ç£çš„sentence embeddingçš„å­¦ä¹ æ–¹æ³•ï¼Œä»è€Œå®Œæˆè¿ç§»å­¦ä¹ ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾å§ï½</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-InferSent/InferSentæ¶æ„.jpg" style="zoom:50%;"></p><p>ç”±äºInferSentä»ç„¶æ˜¯ä¸€ç§åŸºäºè¡¨ç¤ºçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹ï¼Œæ‰€ä»¥æ•´ä¸ªæ¨¡å‹æ¶æ„åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»ï½</p><h3 id="sentence-encoder"><a href="#sentence-encoder" class="headerlink" title="sentence encoder"></a>sentence encoder</h3><p>è¿™ä¸€æ­¥å°±æ˜¯å¯¹premiseä¸hypothesisä¸¤ä¸ªå¥å­è¿›è¡Œencoderã€‚ä½œè€…å°è¯•å¾ˆå¤šçš„æ–¹æ³•ï¼Œæœ€åå‘ç°ä½¿ç”¨BILSTM+maxpoolingçš„æ–¹å¼æ•ˆæœæœ€å¥½ã€‚</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-InferSent/architetute.jpg" style="zoom:50%;"></p><p>å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/05/01/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-InferSent/biLstm+max.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$w_i$è¡¨ç¤ºpremiseæˆ–è€…æ˜¯hypothesisçš„ç¬¬$i$ä¸ªä½ç½®çš„word embeddingã€‚ç„¶åå†å¯¹$h$è¿›è¡Œmax-poolingï¼Œå¾—åˆ°premiseä¸hypothesisçš„sentence embeddingï¼š$u,v$ï¼Œå…¶ä¸­$u,v\in R^{2d_m}$ï¼Œ$d_m$æ˜¯å‰å‘LSTMæˆ–è€…åå‘LSTMè¾“å‡ºçš„ç»´åº¦ã€‚å…·ä½“å¯ä»¥å‚è§æˆ‘çš„å…³äºSSEçš„æ–‡ç« <a href="https://codewithzichao.github.io/2020/04/29/NLP-æ–‡æœ¬åŒ¹é…æ¨¡å‹-SSE/#more">SSEæ¨¡å‹</a></p><h3 id="classifier"><a href="#classifier" class="headerlink" title="classifier"></a>classifier</h3><p>è¿™ä¸€æ­¥å°±æ˜¯å°†å¾—åˆ°çš„$u,v$ä»¥åŠå®ƒä»¬ä¹‹é—´element-wiseçš„differenceä¸productè¿›è¡Œconcatï¼Œå¾—åˆ°å‘é‡$m$ã€‚å³ï¼š</p><script type="math/tex; mode=display">m=[u,v,|u-v|,u\bigotimes v]</script><p>ç„¶åå°†$m$è¾“å…¥åˆ°denseå±‚ï¼Œæ¿€æ´»å‡½æ•°ä¸ºreluï¼Œæœ€åé€å…¥softmaxå±‚ä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</p><p>training detailsï¼šBILSTMçš„è¾“å‡ºç»´åº¦ä¸º4096ï¼Œä½¿ç”¨Adamã€‚</p><p><strong>Nooooooooteï¼šåƒword embeddingï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨ä¸‹æ¥ï¼Œç­‰åˆ°è¦ç”¨çš„æ—¶å€™ï¼Œç›´æ¥æŸ¥è¯¢embedding lookup tableå³å¯ï¼Œä½†æ˜¯sentence embeddingä¸è¡Œï¼Œé‚£ä¹ˆsentence embeddingçš„æœ¬è´¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®æ²¡æœ‰æ‰€è°“çš„sentence embeddingç®—æ³•ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç”¨æ¥è¯„ä»·å¾—åˆ°çš„sentence embeddingçš„æ–¹æ³•ï¼Œæˆ‘ä»¬åªæœ‰å°†sentence embeddingåµŒå…¥åˆ°ä¸‹æ¸¸ä»»åŠ¡ä¸­ï¼Œé€šè¿‡ä¸‹æ¸¸ä»»åŠ¡çš„å¥½åï¼Œæ¥è¯„ä»·å¾—åˆ°çš„sentence embeddingçš„è´¨é‡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿½æ±‚çš„é€šç”¨çš„sentence embeddingï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯è¦å¾—åˆ°ä¸€ä¸ªç½‘ç»œæ¶æ„ï¼Œæˆ–è€…ç§°ä½œencoderï¼Œåœ¨InferSentä¸­ï¼ŒæŒ‡çš„å°±æ˜¯sentence encoderæ¨¡å—ã€‚æˆ‘ä»¬è¾“å…¥æ–‡æœ¬åºåˆ—ï¼Œèƒ½å¤Ÿé€šè¿‡encoderï¼Œå¾—åˆ°æ–‡æœ¬åºåˆ—çš„å‘é‡åŒ–è¡¨ç¤ºã€‚è¿™æ‰æ˜¯sentence embeddingçš„æœ¬è´¨ï¼Œæˆ–è€…è¯´å…¶ä¸word embeddingçš„ä¸åŒä¹‹å¤„<a href="https://www.zhihu.com/question/299549788" target="_blank" rel="noopener">é“¾æ¥</a>ã€‚ğŸ¥°</strong></p><h3 id="ç®€å•å” å¨ä¸€ä¸‹sentence-embeddingçš„å‘å±•"><a href="#ç®€å•å” å¨ä¸€ä¸‹sentence-embeddingçš„å‘å±•" class="headerlink" title="ç®€å•å” å¨ä¸€ä¸‹sentence embeddingçš„å‘å±•"></a>ç®€å•å” å¨ä¸€ä¸‹sentence embeddingçš„å‘å±•</h3><p>ç›®å‰æ¥è¯´ï¼Œå¾—åˆ°sentence embeddingçš„æ–¹æ³•åˆ†ä¸ºç›‘ç£å­¦ä¹ ä¸æ— ç›‘ç£å­¦ä¹ ä¸¤å¤§ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨æ— ç›‘ç£å­¦ä¹ å°±å¯ä»¥å¾—åˆ°æ¯”è¾ƒå¥½çš„sentence embeddingï¼Œä»£è¡¨æ€§æ¨¡å‹æœ‰SkipThoughtä»¥åŠFastSentã€‚ç›‘ç£å­¦ä¹ çš„ä»£è¡¨æ€§æ¨¡å‹å°±æ˜¯InferSentï¼Œæ‰€ä»¥InferSentçœŸçš„æ˜¯ä¸€é¡¹éå¸¸æœ‰å½±å“åŠ›çš„å·¥ä½œã€‚è€Œç›®å‰ï¼Œsentence embeddingçš„çƒ­ç‚¹æ˜¯å¤šä»»åŠ¡å­¦ä¹ ï¼Œå³åœ¨ä¸€æ¬¡è®­ç»ƒä¸­ï¼Œç»„åˆä¸åŒçš„è®­ç»ƒç›®æ ‡ã€‚ä»£è¡¨æ€§æ¨¡å‹æœ‰ï¼šUniversal Sentence Encoder(Google)ã€‚å¤§è‡´å°±æ˜¯è¿™æ ·ï¼Œä¹‹åæœ‰ç©ºå†æ›´æ–°ä¸€ç¯‡å…³äºsentence embeddingçš„æ–‡ç« å§ğŸ¥°ï½</p><h2 id="InferSentæ¨¡å‹å®ç°"><a href="#InferSentæ¨¡å‹å®ç°" class="headerlink" title="InferSentæ¨¡å‹å®ç°"></a>InferSentæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Supervised Learning of Universal Sentence Representations from Natural Language Inference Data</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> InferSent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-SSE</title>
      <link href="2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/"/>
      <url>2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„SSEæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="SSEæ¨¡å‹ä»‹ç»"><a href="#SSEæ¨¡å‹ä»‹ç»" class="headerlink" title="SSEæ¨¡å‹ä»‹ç»"></a>SSEæ¨¡å‹ä»‹ç»</h2><p>SSEæ¨¡å‹æ¥æºäº2017å¹´ã€ŠShortcut-Stacked Sentence Encoders for Multi-Domain Inferenceã€‹è®ºæ–‡ï¼Œç”¨äºè§£å†³NLIé—®é¢˜ã€‚SSEæ¨¡å‹ä¸»è¦æ˜¯åŸºäºInferSentæ¨¡å‹ï¼Œç„¶åå€Ÿé‰´äº†resNetçš„æ®‹å·®è¿æ¥çš„æ€æƒ³ï¼Œä»è€Œåœ¨SNLIä¸Šå–å¾—äº†SOTAã€‚ç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/SSEæ¨¡å‹æ¶æ„.jpg" style="zoom:50%;"></p><p>SSEæ¨¡å‹æ˜¯åŸºäºè¡¨ç¤ºçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹ï¼Œæ‰€ä»¥å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤æ­¥ï¼š<strong>sentence encoderã€entailment classifierã€‚</strong>ä¸‹é¢ä¸€ä¸€ä»‹ç»ï½</p><h3 id="sentence-encoder"><a href="#sentence-encoder" class="headerlink" title="sentence encoder"></a>sentence encoder</h3><p>è¿™ä¸€æ­¥ï¼ŒSSEæ¨¡å‹ä¸»è¦æ˜¯é€šè¿‡stackå¤šå±‚çš„biLSTMï¼Œä»è€Œå¾—åˆ°æ›´åŠ æ·±å±‚è¯­ä¹‰ä¿¡æ¯ã€‚è¿™å…¶å®æ²¡æœ‰ä»€ä¹ˆæ–°å¥‡çš„ï¼Œåœ¨SiamLSTMã€ESIMã€InferSentä¸Šéƒ½ç”¨åˆ°äº†ï¼Œä½†æ˜¯ä¸åŒçš„åœ¨äºï¼š<strong>ç¬¬ $i$ ä¸ªblLSTMå±‚çš„è¾“å…¥æ˜¯ï¼šå‰ $i-1$ ä¸ªbiLSTMå±‚çš„è¾“å‡ºä¸æœ€åˆçš„word embeddingçš„concatã€‚è¿™ä¹Ÿæ˜¯SSEæ¨¡å‹çš„æ”¹è¿›çš„åœ°æ–¹ã€‚</strong>å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/bilstm.jpg" style="zoom:50%;"></p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/bilstm2.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$h_t^i$ è¡¨ç¤ºç¬¬$i$ä¸ªbiLSTMå±‚çš„ç¬¬$t$ä¸ªä½ç½®çš„è¾“å‡ºï¼›$x_t^i$è¡¨ç¤ºç¬¬$i$ä¸ªbiLSTMå±‚çš„ç¬¬$t$æ—¶åˆ»çš„è¾“å…¥ï¼›$w_t$æ˜¯æœ€åˆtokençš„word embeddingã€‚å‡è®¾æœ‰må±‚ï¼Œé‚£ä¹ˆæœ€åä¸€å±‚çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/finalbiLSTM.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$H^m$è¡¨ç¤ºç¬¬må±‚çš„è¾“å‡ºï¼Œé•¿åº¦ä¸åŸè¯­å¥é•¿åº¦ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œstackè¿™ä¹ˆå¤šå±‚çš„biLSTMï¼Œå°±æ˜¯ä¸ºäº†èƒ½å¤Ÿæå–å‡ºæ›´åŠ æ·±å±‚çš„è¯­ä¹‰ä¿¡æ¯ï¼›$v$è¡¨ç¤ºå¯¹$H^m$è¿›è¡Œmaxpoolingä¹‹åå¾—åˆ°çš„ç»“æœã€‚<strong>åœ¨è¿™é‡Œéœ€è¦ç†æ¸…ä¸€ä¸‹å„ä¸ªå‘é‡ä¹‹é—´çš„ç»´åº¦å…³ç³»ï¼š$h_i^m\in R^{2d_m}ï¼ŒH^m\in R^{2d_m\times n}ï¼Œv\in R^{2d_m}$ã€‚</strong></p><p><strong>Nooooooteï¼špremise $p$ ä¸hypothesis $h$ éƒ½æ˜¯ç»è¿‡ä¸Šè¿°çš„ç½‘ç»œç»“æ„ï¼Œå¾—åˆ°ç»“æœå‘é‡ $v_p$ä¸$v_h$ï¼Œä¹Ÿå°±æ˜¯è¯´å…±äº«å‚æ•°ï¼è¿™ä¸ªåœ¨ã€ŠAPPLYING DEEP LEARNING TO ANSWER SELECTION: A STUDY AND AN OPEN TASKã€‹è®ºæ–‡é‡Œæœ‰è®¨è®ºè¿‡ï¼</strong></p><h3 id="entailment-classifier"><a href="#entailment-classifier" class="headerlink" title="entailment classifier"></a>entailment classifier</h3><p>é€šè¿‡sentence encoderï¼Œæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªå¥å­çš„å‘é‡åŒ–è¡¨ç¤º$v_p$ä¸$v_h$ï¼Œé¦–å…ˆè¦å¯¹å…¶è¿›è¡Œconcatï¼Œå¾—åˆ°matching vector $m$ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">m=[v_p,v_h,|v_p-v_h|,v_p\bigotimes v_h]</script><p>ç„¶åå°†concatä¹‹å$m$è¾“å…¥ä¸€ä¸ªdenseå±‚ï¼Œä½¿ç”¨reluè¿›è¡Œæ¿€æ´»ï¼Œç„¶åè¾“å…¥åˆ°softmaxï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</p><p><strong>training detailsï¼š</strong>æ•°æ®é›†ä½¿ç”¨Multi-SNLIï¼›ä¼˜åŒ–å™¨ä¸ºAdamï¼›batch sizeä¸º32ï¼›åˆå§‹å­¦ä¹ ç‡ä¸º0.0002ï¼Œæ¯ä¸¤ä¸ªepochè¡°å‡ä¸€åŠï¼›denseå±‚çš„è¾“å‡ºç»´åº¦ä¸º1600ï¼Œå¯¹denseå±‚è¾“å‡ºçš„ç»“æœä½¿ç”¨dropoutï¼Œrateä¸º0.1ï¼›ä½¿ç”¨Gloveè¯å‘é‡ï¼Œå¹¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¾®è°ƒï¼›<strong>å®éªŒè¯æ˜ï¼Œä½¿ç”¨3å±‚çš„biLSTMçš„æ•ˆæœæœ€å¥½ï¼Œæ¯ä¸€å±‚çš„è¾“å‡ºç»´åº¦ä¾æ¬¡æ˜¯ï¼š512ï¼Œ1024ï¼Œ2048ã€‚</strong>ä¸‹é¢æ˜¯å®éªŒç»“æœã€‚</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/Xnip2020-05-02_16-00-48.jpg" style="zoom:50%;"></p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/Xnip2020-05-02_16-01-39.jpg" style="zoom:50%;"></p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/Xnip2020-05-02_16-01-47.jpg" style="zoom:50%;"></p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SSE/Xnip2020-05-02_16-01-53.jpg" style="zoom:50%;"></p><p>ä»¥ä¸Šå°±æ˜¯SSEæ¨¡å‹çš„å…¨éƒ¨å†…å®¹å•¦ï¼æ•ˆæœæ˜¯æ¯”InferSentå¥½ï¼Œä½†æ˜¯ä¼°è®¡è®­ç»ƒæ—¶é—´è¦å¤šå¾—å¤šã€‚ğŸ¥°</p><h2 id="SSEæ¨¡å‹å®ç°"><a href="#SSEæ¨¡å‹å®ç°" class="headerlink" title="SSEæ¨¡å‹å®ç°"></a>SSEæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Shortcut-Stacked Sentence Encoders for Multi-Domain Inference</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> SSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-ESIM</title>
      <link href="2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/"/>
      <url>2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„ESIMæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="ESIMæ¨¡å‹ä»‹ç»"><a href="#ESIMæ¨¡å‹ä»‹ç»" class="headerlink" title="ESIMæ¨¡å‹ä»‹ç»"></a>ESIMæ¨¡å‹ä»‹ç»</h2><p>ESIMæ¨¡å‹æ¥æºäº2017å¹´çš„è®ºæ–‡ã€ŠEnhanced LSTM for Natural Language Inferenceã€‹ã€‚ESIMæ¨¡å‹æ˜¯æ–‡æœ¬åŒ¹é…é¢†åŸŸéå¸¸æœ‰å½±å“åŠ›çš„å·¥ä½œï¼Œä¸»è¦ç”¨æ¥è§£å†³NLI/RTEé—®é¢˜ã€‚ç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/ESIMæ¨¡å‹æ¶æ„.jpg" style="zoom: 50%;"></p><p>ESIMæ¨¡å‹æ¶æ„æ€»å…±åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š<strong>input encodingã€local inferenceã€inference compositionã€‚</strong>ä¸‹é¢ä¸€ä¸€ä»‹ç»ï½ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œç»™å®šä¸€äº›ç¬¦å·ï¼šä¸¤ä¸ªå¥å­$a=(a_1,a_2,a_3,â€¦,a_{l_a})ã€b=(b_1,b_2,b_3,â€¦,b_{l_b})$ã€‚å…¶ä¸­ï¼Œ$a_i\in R^lã€b_j\in R^l$ã€‚</p><h3 id="input-Encoding"><a href="#input-Encoding" class="headerlink" title="input Encoding"></a>input Encoding</h3><p>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯é€šè¿‡word embeddingï¼Œå¾—åˆ°æ•´ä¸ªå¥å­çš„å‘é‡åŒ–è¡¨ç¤ºï¼Œç„¶åè¾“å…¥åˆ°BILSTMä¸­(å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨tree LSTM)ï¼Œå¾—åˆ°encodeä¹‹åçš„å‘é‡ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/input encoding.jpg" style="zoom:50%;"></p><p>å¦å¤–ï¼Œåœ¨è¿™é‡Œï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ç”¨æ›´åŠ ç®€å•æ–¹ä¾¿çš„BIGRUï¼Œæ˜¯å› ä¸ºä½œè€…å‘ç°ç»“æœä¸å¦‚BILSTMæ¥çš„æ›´å¥½ã€‚</p><h3 id="local-inference"><a href="#local-inference" class="headerlink" title="local inference"></a>local inference</h3><p>åœ¨å¾—åˆ°encodeä¹‹åçš„æ–°å‘é‡ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸¤ä¸ªå¥å­è¿›è¡Œå±€éƒ¨æ¨ç†å»ºæ¨¡ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨attentionè®©ä¸¤ä¸ªå¥å­å‘ç”Ÿäº¤äº’ã€‚å…·ä½“è®¡ç®—æ–¹æ³•DecAttæ¨¡å‹ä¸€æ¨¡ä¸€æ ·ï¼Œåªä¸è¿‡å»æ‰äº†FFNï¼Œç›´æ¥è®¡ç®—Attention weightsã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/local inference 0.jpg" style="zoom:50%;"></p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/local inference.jpg" style="zoom:50%;"></p><p>æ³¨æ„ï¼šåŠ æƒå¾—åˆ°æ–°çš„å‘é‡çš„é•¿åº¦æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä»ç„¶æ˜¯$l_aã€l_b$ã€‚åœ¨å¾—åˆ°æ–°å‘é‡ä¹‹åï¼Œå†åšäº†local inference informationçš„enhancementï¼Œè¿™é‡Œçš„enhancementæŒ‡çš„æ˜¯ï¼šåŸæ¥çš„å‘é‡ä¸åŠ æƒä¹‹åçš„å‘é‡çš„å·®ä¸ç‚¹ç§¯ã€‚ç„¶åå°†è¿™äº›å‘é‡éƒ½è¿›è¡Œconcatã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/enhancement.jpg" style="zoom:50%;"></p><p>è¿™æ ·åšçš„ç›®çš„ï¼Œå®é™…ä¸Šå°±æ˜¯å¸Œæœ›èƒ½å¤Ÿæ•æ‰åˆ°æ›´å¤šçš„high levelçš„äº¤äº’ä¿¡æ¯ã€‚</p><h3 id="inference-composition"><a href="#inference-composition" class="headerlink" title="inference composition"></a>inference composition</h3><p>æœ€åä¸€æ­¥å°±æ˜¯inference compositionã€‚ä»ç„¶æ˜¯å°†local inferenceå¾—åˆ°çš„ç»“æœè¾“å…¥åˆ°BILSTMä¸­ï¼Œæå–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç„¶ååŒæ—¶ä½¿ç”¨averagepoolingä¸maxpoolingè¿›è¡Œæ± åŒ–ï¼Œæœ€åä½¿ç”¨tanhè¿›è¡Œæ¿€æ´»ï¼Œæœ€ååŠ ä¸Šsoftmaxå±‚ï¼Œå¾—åˆ°æœ€ç»ˆçš„åˆ†ç±»ç»“æœã€‚</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-ESIM/inference composition.jpg" style="zoom:50%;"></p><p>æ³¨æ„ï¼Œè¿™é‡Œï¼Œ$v_{a,i}ã€v_{b,j}$æ˜¯ç»è¿‡BILSTMä¹‹åå¾—åˆ°çš„è¾“å‡ºã€‚</p><p>training detailsï¼šä½¿ç”¨Adamï¼Œä¸¤ä¸ªå‚æ•°ä¸º0.9ï¼Œ0.999ï¼›åˆå§‹å­¦ä¹ ç‡ä¸º0.0004ï¼›batch sizeä¸º32ï¼›word embeddingä¸º300ï¼Œä½¿ç”¨Gloveè¯å‘é‡ï¼Œå¹¶ä¸”åœ¨è®­ç»ƒçš„æ—¶å€™å¾®è°ƒword embeddingï¼›å¯¹äºæ‰€æœ‰FFNï¼Œä½¿ç”¨dropout ï¼Œrateä¸º0.5ã€‚ä»¥ä¸Šå°±æ˜¯ESIMæ¨¡å‹çš„å…¨éƒ¨å†…å®¹å•¦ï¼ä¸è¿‡è¯´å®è¯ï¼ŒESIMæ¨¡å‹æ¶æ„ä¸Šæ²¡æœ‰å•¥å¤ªæ–°é¢–çš„åœ°æ–¹ï¼Œä½†æ˜¯æ•ˆæœæ˜¯çœŸçš„å¥½ï¼ğŸ¥°</p><h2 id="ESIMæ¨¡å‹å®ç°"><a href="#ESIMæ¨¡å‹å®ç°" class="headerlink" title="ESIMæ¨¡å‹å®ç°"></a>ESIMæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Enhanced LSTM for Natural Language Inference</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> ESIM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-CompAgg</title>
      <link href="2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/"/>
      <url>2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„CompAggæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="CompAggæ¨¡å‹ä»‹ç»"><a href="#CompAggæ¨¡å‹ä»‹ç»" class="headerlink" title="CompAggæ¨¡å‹ä»‹ç»"></a>CompAggæ¨¡å‹ä»‹ç»</h2><p>CompAggæ¨¡å‹æ¥æºäºã€ŠA COMPARE-AGGREGATE MODEL FOR  MATCHING TEXT SEQUENCESã€‹è®ºæ–‡ï¼Œäº2016å¹´æå‡ºã€‚CompAggæ¨¡å‹å¹¶ä¸æ˜¯éå¸¸æ–°çš„æ¨¡å‹ï¼Œå®ƒæ˜¯å¯¹ä¹‹å‰çš„æ¨¡å‹è¿›è¡Œäº†ä¸€ä¸ªæ€»ç»“ï¼Œæå‡ºäº†Compare-Aggregateæ¨¡å‹æ¡†æ¶ï¼Œå¹¶å¯¹compare functionè¿›è¡Œäº†æ¢ç´¢ã€‚ä¸DecAttæ¨¡å‹ç±»ä¼¼ã€‚æ€»è€Œè¨€ä¹‹ï¼ŒCompAggæ¨¡å‹æå‡ºçš„åŸå› åœ¨äºï¼š<strong>1.ä¹‹å‰çš„æ¨¡å‹åªåœ¨ä¸€ä¸¤ä¸ªtaskä¸Šæµ‹è¯•ï¼Œæ³›åŒ–æ€§ä¸å¼ºã€‚(æ¢ä¸ªæ•°æ®é›†å¯èƒ½è¡¨ç°å°±æ¯”è¾ƒå·®) 2.æ²¡æœ‰å…³æ³¨äºcomparison functionã€‚</strong></p><p>é¦–å…ˆç›´æ¥ä¸Šæ¨¡å‹æ¶æ„å›¾å§ï½</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/CompAggæ¨¡å‹æ¶æ„.jpg" style="zoom: 50%;"></p><h3 id="CompAggæ¨¡å‹æ¶æ„"><a href="#CompAggæ¨¡å‹æ¶æ„" class="headerlink" title="CompAggæ¨¡å‹æ¶æ„"></a>CompAggæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸‹è®­ç»ƒé›†$\{Q,A,y\}_{1}^{N}$ï¼Œï¼ˆpointwiseï¼‰å…¶ä¸­ï¼Œ$Qã€A$åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªå¥å­çš„å‘é‡åŒ–è¡¨ç¤ºï¼Œå¹¶ä¸”ï¼š$Q\in R^{d\times Q},A\in R^{d\times A}$ï¼Œå…¶ä¸­ï¼Œ$d$è¡¨ç¤ºæ¯ä¸€ä¸ªtokençš„ç»´åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸€ä¸ªtokençš„embeddingã€‚CompAggæ¨¡å‹å…±åˆ†ä¸ºï¼š<strong>Preprocessingã€Attentionã€Comparisonã€Aggregation</strong>è¿™å››ä¸ªéƒ¨åˆ†ï¼Œä¸‹é¢è¯¦ç»†çš„è®²ä¸€ä¸‹ã€‚</p><h4 id="Preprocessing"><a href="#Preprocessing" class="headerlink" title="Preprocessing"></a>Preprocessing</h4><p>è¿™ä¸€æ­¥æ˜¯å¯¹åŸå§‹çš„$Q$ä¸$A$è¿›è¡Œä¸€äº›å¤„ç†ï¼Œä»è€Œä½¿å¾—æ¯ä¸€ä¸ªè¯èƒ½å¤Ÿè·å–ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼Œä»è€Œè®©æ¯ä¸€ä¸ªtokençš„embeddingèƒ½å¤Ÿè¡¨ç¤ºæ›´åŠ ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ã€‚(ç›´æ¥æ”¾å›¾ç‰‡å§ï¼Œå…¬å¼å¤ªéš¾æ•²äº†ğŸ˜©)</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/preprocessing.jpg" style="zoom: 67%;"></p><p>æ³¨æ„ï¼Œå¾—åˆ°çš„$\hat Q$ä¸$\hat A$çš„ç»´åº¦åˆ†åˆ«æ˜¯ï¼š$R^{l\times Q}ã€R^{l\times A}$ã€‚</p><h4 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h4><p>è¿™é‡Œå°±æ˜¯ä¼ ç»Ÿçš„Attentionæœºåˆ¶ã€‚ç”¨Qå¯¹Aè¿›è¡Œattentionï¼Œç„¶åå¾—åˆ°åŠ æƒåçš„Qï¼Œå³Hã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/attention.jpg" style="zoom:67%;"></p><p>æ³¨æ„ï¼ŒGä¸Hçš„ç»´åº¦åˆ†åˆ«æ˜¯ï¼š$R^{Q\times A}ã€R^{l\times A}$ã€‚</p><h4 id="Comparison"><a href="#Comparison" class="headerlink" title="Comparison"></a>Comparison</h4><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯matcä¸Šä¸€æ­¥å¾—åˆ°çš„$\hat A$ä¸$H$ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä½œè€…å®éªŒäº†6ä¸­compare functionï¼šNNã€NTNã€EucCosã€SUBã€MULTã€SUBMULT+NNã€‚</p><ul><li>NNï¼šå®é™…ä¸Šå°±æ˜¯å°†ä¸¤ä¸ªå‘é‡concatï¼Œç„¶åç»è¿‡ä¸€å±‚ç¥ç»ç½‘ç»œã€‚</li></ul><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/NN.jpg" style="zoom:50%;"></p><ul><li>NTNï¼šå®é™…ä¸Šå°±æ˜¯ä½¿ç”¨NTNæ¥concatä¸¤ä¸ªå‘é‡ï¼Œç„¶åç»è¿‡ä¸€å±‚ç¥ç»ç½‘ç»œã€‚</li></ul><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/NTN.jpg" style="zoom:50%;"></p><ul><li>EucCosï¼šå®é™…ä¸Šå°±æ˜¯è®¡ç®—ä¸¤ä¸ªå‘é‡çš„æ¬§å¼è·ç¦»å’Œä½™å¼¦ç›¸ä¼¼åº¦ï¼Œç„¶åå°†ç»“æœconcatã€‚</li></ul><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/EUcCos.jpg" style="zoom:50%;"></p><ul><li>SUBä¸MULTï¼šå®é™…ä¸Šå°±æ˜¯ä¸¤ç§åŸºäºelement-wiseçš„æ–¹å¼æ¥å¯¹å‘é‡è¿›è¡Œæ¯”è¾ƒã€‚</li></ul><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/SUB+MULT.jpg" style="zoom:50%;"></p><ul><li>SUBMULT+NNï¼šå®é™…ä¸Šå°±æ˜¯å°†ä¸Šé¢çš„ç»“æœconcatï¼Œç„¶åç»è¿‡ä¸€å±‚ç¥ç»ç½‘ç»œã€‚</li></ul><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/SUBMULT+NN.jpg" style="zoom:50%;"></p><p>æ³¨æ„ï¼Œä¸Šé¢çš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸¤ä¸ªå¥å­å¯¹åº”ä½ç½®å•è¯ä¹‹é—´çš„compareï¼Œæ‰€ä»¥compareä¹‹åï¼Œå¾—åˆ°çš„å‘é‡çš„é•¿åº¦é£Ÿæ¬²Aä¸€æ ·çš„ã€‚</p><h4 id="Aggregation"><a href="#Aggregation" class="headerlink" title="Aggregation"></a>Aggregation</h4><p>è¿™ä¸€æ­¥å°±æ˜¯å°†comparisonå¾—åˆ°çš„ç»“æœï¼Œç»è¿‡ä¸€å±‚CNNï¼Œå¾—åˆ°æœ€åçš„ç»“æœã€‚</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/CNN.jpg" style="zoom:50%;"></p><p>å…¶ä¸­ï¼Œ$r$çš„ç»´åº¦æ˜¯ï¼š$R^{nl}$ï¼Œ$n$è¡¨ç¤ºfilterçš„æ•°é‡ã€‚æ³¨æ„ï¼š$[t_1,t_2,t_3,â€¦,t_A]$çš„ç»´åº¦æ˜¯ï¼š$R^{l\times A}$ã€‚</p><h4 id="final-classification"><a href="#final-classification" class="headerlink" title="final classification"></a>final classification</h4><p>å¯¹äºNLIé—®é¢˜ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä¸‰åˆ†ç±»é—®é¢˜ï¼Œæ¥ä¸€ä¸ªsoftmaxå±‚å°±å¯ä»¥å•¦ï¼å¯¹äºé—®ç­”åŒ¹é…é—®é¢˜æ¥è¯´ï¼Œå‡è®¾æœ‰Kä¸ªcandidate answerï¼Œæˆ‘ä»¬è¦ä»ä¸­é€‰æ‹©å‡ºä¸€ä¸ªanswerï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®¡ç®—å‡º$[r_1,r_2,r_3,â€¦,r_k]$,ç„¶åä½¿ç”¨ä¸‹å±å…¬å¼æ¥é¢„æµ‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-CompAgg/as.jpg" style="zoom:50%;"></p><p>ä»¥ä¸Šå°±æ˜¯CompAggæ¨¡å‹çš„å†…å®¹ï¼Œè¿˜æ˜¯è›®å¥½ç†è§£çš„ã€‚æœ€åä½œè€…è¿›è¡Œäº†å®éªŒï¼Œå‘ç°ç»“æœæ¯”Siamese NNè¦å¥½ä¸€äº›ï¼Œè¯´æ˜åŸºäºäº¤äº’çš„SiameseNNåœ¨åˆ†åˆ«encodeä¸¤ä¸ªå¥å­çš„è¿‡ç¨‹ä¸­ï¼Œä¸¢å¤±äº†ä¸€äº›ä¿¡æ¯ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨ï¼Œæ•´ä¸ªè®ºæ–‡è¿˜æ˜¯å€¼å¾—ä¸€è¯»çš„ï¼</p><h2 id="CompAggæ¨¡å‹å®ç°"><a href="#CompAggæ¨¡å‹å®ç°" class="headerlink" title="CompAggæ¨¡å‹å®ç°"></a>CompAggæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>A COMPARE-AGGREGATE MODEL FOR  MATCHING TEXT SEQUENCES</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> CompAgg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-DecAtt</title>
      <link href="2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DecAtt/"/>
      <url>2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DecAtt/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„DecAttæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="DecAttæ¨¡å‹ä»‹ç»"><a href="#DecAttæ¨¡å‹ä»‹ç»" class="headerlink" title="DecAttæ¨¡å‹ä»‹ç»"></a>DecAttæ¨¡å‹ä»‹ç»</h2><p>DecAttæ¨¡å‹æ¥æºäºã€ŠA Decomposable Attention Model for Natural Language Inferenceã€‹è®ºæ–‡ï¼Œäº2016å¹´ç”±googleæå‡ºã€‚ä¸»è¦æ˜¯ç”¨äºè§£å†³NLIï¼ˆè‡ªç„¶è¯­è¨€æ¨ç†/æ–‡æœ¬è•´å«ï¼‰é—®é¢˜ä¸­ã€‚é¦–å…ˆä»‹ç»ä¸€ä¸‹ä»€ä¹ˆå«NLIé—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p><p><strong>ç»™å®šä¸€ä¸ªpremise Aä¸ä¸€ä¸ªhypothesis Bï¼Œå¦‚æœç»™å®šAçš„å‰æä¸‹ï¼ŒBä¸ºçœŸï¼Œæˆ‘ä»¬å°±è¯´Aè•´å«(entailment)äº†Bï¼Œæˆ–è€…è¯´èƒ½ä»Aæ¨ç†å‡ºBï¼›å¦‚æœBä¸ºå‡ï¼Œé‚£ä¹ˆå°±è¯´Aä¸Bäº’ç›¸çŸ›ç›¾(contradiction)ï¼›å¦‚æœæ— æ³•æ ¹æ®Aå¾—å‡ºBæ˜¯å¦ä¸ºçœŸè¿˜æ˜¯å‡ï¼Œå°±è¯´Aä¸Bæ˜¯äº’ç›¸ç‹¬ç«‹çš„(neutral)ã€‚</strong>ä»è¿™ä¸ªå®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“NLI/TEæ˜¯ä¸€ä¸ªä¸‰åˆ†ç±»çš„é—®é¢˜ã€‚</p><h3 id="DecAttæ¨¡å‹æ¶æ„"><a href="#DecAttæ¨¡å‹æ¶æ„" class="headerlink" title="DecAttæ¨¡å‹æ¶æ„"></a>DecAttæ¨¡å‹æ¶æ„</h3><p>é¦–å…ˆï¼Œå®šä¹‰è®­ç»ƒé›†$\{a^{(n)},b^{(n)},y^{(n)}\}_{n=1}^{N}$ï¼Œå…¶ä¸­$a^{(n)}$è¡¨ç¤ºç¬¬nä¸ªæ ·æœ¬çš„premiseï¼Œå³ï¼š$a^{(n)}=(a_3^{(n)},a_1^{(n)},a_3^{(n)},â€¦,a_{l_a}^{(n)})$ï¼Œ$l_a$è¡¨ç¤ºæ˜¯Aå¥å­çš„é•¿åº¦ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªtokençš„ç»´åº¦ä¸º$d$ï¼›$b^{(n)}$è¡¨ç¤ºç¬¬nä¸ªæ ·æœ¬çš„hypothesisï¼Œå³$b^{(n)}=(b_1^{(n)},b_2^{(n)},b_3^{(n)},â€¦,b_{l_b}^{(n)})$ï¼Œ$l_b$è¡¨ç¤ºæ˜¯Bå¥å­çš„é•¿åº¦ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªtokençš„ç»´åº¦ä¸º$d$ï¼›$y^{(n)}$è¡¨ç¤ºç¬¬nä¸ªæ ·æœ¬çš„æ ‡ç­¾å‘é‡ï¼Œå³$y^{(n)}=(y_1^{(n)},y_2^{(n)},y_3^{(n)}â€¦,y_C^{(n)})$ï¼Œæ‰€ä»¥$y^{(n)}$æ˜¯ä¸€ä¸ªCç»´çš„one-hotå‘é‡ã€‚</p><p>DecAttæ¨¡å‹æ€»å…±åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>Attendã€Compareã€Aggregate</strong>ã€‚æ¨¡å‹ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-DecAtt/decAttæ¨¡å‹æ¶æ„.jpg" style="zoom: 67%;"></p><h4 id="Attend"><a href="#Attend" class="headerlink" title="Attend"></a>Attend</h4><p>å¯¹Aä¸Bå¥å­çš„tokenï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„attention weightsã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">e_{ij}=F^Â·(\hat a_i,\hat b_j)=F(\hat a_i)^TF(\hat b_j)</script><p>å¾—åˆ°attention weightsä¹‹åï¼Œæˆ‘ä»¬åœ¨åŠ æƒï¼Œå¾—åˆ°æ–°çš„å‘é‡ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\beta_i=\sum_{j=1}^{l_b} \frac {e_{ij}}{\sum_{k=1}^{l_b}e_{ik}}\hat b_j \\\alpha_j=\sum_{i=1}^{l_a} \frac {e_{ij}}{\sum_{k=1}^{l_b}e_{kj}}\hat a_i</script><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>$\beta$ä¸$\hat a$å¯¹é½ï¼Œ$\alpha$ä¸$\hat b$å¯¹é½ï¼›</strong>å¦å¤–ï¼Œå…¶ä¸­$F$è¡¨ç¤ºReluå‡½æ•°ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºå¦‚æœç›´æ¥ä½¿ç”¨$F^Â·$çš„è¯ï¼Œç”±äº$\hat a_i,\hat b_j$å‡æ˜¯dç»´çš„å‘é‡ï¼Œå¹¶ä¸”å¥å­é•¿åº¦åˆ†åˆ«æ˜¯$l_a,l_b$ï¼Œé‚£ä¹ˆï¼Œè¦ç®—å‡ºå…¨éƒ¨çš„attention weigthtsçš„è¯ï¼Œè¦è®¡ç®—$l_a\times l_b$æ¬¡çš„$F^Â·$è®¡ç®—ï¼›å¦‚æœå…ˆä½¿ç”¨reluå‡½æ•°å…ˆè®¡ç®—çš„è¯ï¼Œé‚£ä¹ˆå°±åªéœ€è¦$l_a+l_b$æ¬¡çš„reluè®¡ç®—ï¼Œå¤§å¤§é™ä½äº†è®¡ç®—å¤æ‚åº¦ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¢«ç§°ä½œ<strong>Decomposable Attention</strong>çš„åŸå› ã€‚</p><h4 id="Compare"><a href="#Compare" class="headerlink" title="Compare"></a>Compare</h4><p>å¯¹åŠ æƒåçš„ä¸€ä¸ªå¥å­ä¸å¦ä¸€ä¸ªåŸå§‹å¥å­ç›¸æ¯”è¾ƒã€‚</p><script type="math/tex; mode=display">v_{1,i}=G([\hat a_i,\beta_i]) \\v_{2,j}=G([\hat b_j,\alpha_j])</script><h4 id="Aggregate"><a href="#Aggregate" class="headerlink" title="Aggregate"></a>Aggregate</h4><p>é€šè¿‡Compareï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªå‘é‡ï¼š$\{v_{1,i}\}_{i=1}^{l_a}ã€\{v_{2,j}\}_{j=1}^{l_b}$ï¼Œå®ƒä»¬çš„ç»´åº¦åˆ†åˆ«æ˜¯$l_a\times dã€l_b\times d$ã€‚é¦–å…ˆå¯¹ä¸¤ä¸ªå‘é‡é›†åˆè¿›è¡Œæ±‚å’Œã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">v_1=\sum_{i=1}^{l_a}v_{1,i}\\v_2=\sum_{j=1}^{l_b}v_{2,j}</script><p>ç„¶åè¿›è¡Œconcatenateï¼Œè¾“å…¥åˆ°softmaxä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</p><script type="math/tex; mode=display">\hat y=H([v_1,v_2])</script><p>loss functioné‡‡ç”¨crossentropyã€‚</p><h4 id="intra-sentence-attention-optional"><a href="#intra-sentence-attention-optional" class="headerlink" title="intra-sentence attention(optional)"></a>intra-sentence attention(optional)</h4><p>Attendã€Compareã€Aggregateä¸‰æ­¥æ˜¯å¿…ä¸å¯å°‘çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘å¥å­å†…tokenä¹‹é—´çš„ç›¸å…³æ€§ï¼Œä»è€Œå¢å¼ºå¥å­è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°ä½œintra-sentence attentionã€‚</p><script type="math/tex; mode=display">f_{ij}=F_{intra}(a_i)^TF_{intra}(b_j) \\a_{i}^{'}=\sum_{j=1}^{l_a}\frac {exp(f_{ij}+d_{i-j})}{\sum_{k=1}^{l_a}exp(f_{ik}+d_{i-k})}a_j \\\hat a=[a_i,a_{i}^{ '}]</script><p>æ¨¡å‹è®­ç»ƒçš„ç»†èŠ‚ï¼šå‚æ•°åˆå§‹åŒ–ä½¿ç”¨é«˜æ–¯åˆ†å¸ƒã€ä½¿ç”¨é¢„è®­ç»ƒçš„word embedding(Glove)ã€å¯¹äºæ‰€æœ‰çš„reluå±‚å‡é€‚ç”¨droput(ratio=0.2)ã€FFNå±‚çš„ç»´åº¦ä¸º200ã€‚</p><h2 id="DecAttæ¨¡å‹å®ç°"><a href="#DecAttæ¨¡å‹å®ç°" class="headerlink" title="DecAttæ¨¡å‹å®ç°"></a>DecAttæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>A Decomposable Attention Model for Natural Language Inference</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> DecAtt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-MatchPyramid</title>
      <link href="2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-MatchPyramid/"/>
      <url>2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-MatchPyramid/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„MatchPyramidæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="MatchPyramidæ¨¡å‹ä»‹ç»"><a href="#MatchPyramidæ¨¡å‹ä»‹ç»" class="headerlink" title="MatchPyramidæ¨¡å‹ä»‹ç»"></a>MatchPyramidæ¨¡å‹ä»‹ç»</h2><p>MatchPyramidæ¨¡å‹æ¥æºäº2016å¹´çš„ã€ŠText Matching as Image Recognitionã€‹è®ºæ–‡ï¼Œç”¨æ¥è§£å†³æ–‡æœ¬åŒ¹é…é—®é¢˜ï¼Œå³è®¡ç®—å¥å­çš„ç›¸ä¼¼åº¦ã€‚è®ºæ–‡çš„æ€æƒ³æ¯”è¾ƒæœ‰æ„æ€ï¼Œå®ƒå€Ÿé‰´äº†å›¾åƒè¯†åˆ«çš„æ€æƒ³ã€‚åœ¨å›¾åƒè¯†åˆ«ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡CNNï¼Œå…ˆå¾—åˆ°æœ€ä¸ºåŸºæœ¬çš„ç‰¹å¾ï¼Œè­¬å¦‚ï¼šçº¿ã€è§’ã€ç‚¹ç­‰ç­‰ï¼Œç„¶ååœ¨è¿™äº›low levelçš„ç‰¹å¾ä¸Šï¼Œæ„å»ºå‡ºæ›´åŠ é«˜çº§çš„ç‰¹å¾ï¼Œè­¬å¦‚ï¼šçœ¼ç›ã€é¼»å­ã€å˜´å·´ç­‰ç­‰ï¼Œä¹‹åå†æ„å»ºå‡ºæ•´ä¸ªå›¾åƒã€‚é‚£ä¹ˆåœ¨æ–‡æœ¬ä¸­ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è¿™æ ·æ¥åšå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼æˆ‘ä»¬å¯ä»¥è®¡ç®—word levelçš„matching signalsï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—phrase levelçš„matching signalsï¼Œæœ€åå¾—åˆ°sentence levelçš„matching signalsã€‚ä½†æ˜¯ï¼Œå›¾åƒä¸€èˆ¬æ˜¯2Dçš„ï¼Œè€Œæ–‡æœ¬æ˜¯1Dçš„ï¼Œè¿™ä¸ªæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ<strong>åœ¨MatchPyramidæ¨¡å‹ä¸­ï¼Œä½¿ç”¨tokenä¸tokenä¹‹é—´çš„ç›¸ä¼¼åº¦å½“ä½œå›¾åƒä¸­çš„åƒç´ ï¼Œä»è€Œæ„å»ºå‡ºä¸€ä¸ªmatching matrix $M$ï¼Œ</strong>ä¹‹åä½¿ç”¨å·ç§¯å±‚æ¥æå–å‡ºæ›´åŠ ä¸°å¯Œçš„matching patternï¼Œæœ€åå¾—åˆ°å¥å­ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå°±è§£å†³å•¦ï¼æ€æƒ³æ˜¯ä¸æ˜¯niceï½ç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-MatchPyramid/MatchPyramidæ¨¡å‹.jpg" style="zoom: 50%;"></p><h3 id="Matching-Matrix"><a href="#Matching-Matrix" class="headerlink" title="Matching Matrix"></a>Matching Matrix</h3><p>ä»ä¸Šå›¾ä¸­å¯ä»¥å¾—çŸ¥ï¼Œmatching matrixçš„æ„å»ºå¯¹äºMPæ¨¡å‹æ¥è¯´è‡³å…³é‡è¦ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œæåˆ°äº†ä¸‰ç§æ„å»ºmatching matrixçš„æ–¹æ³•ï¼š<strong>indicator functionã€cosineã€dot productã€‚</strong>å¦‚ä¸‹ï¼š</p><ul><li><strong>indicator functionï¼š</strong>$M_{ij}=\left\{ \begin{matrix} 1ï¼Œw_i=v_j \\ 0ï¼Œ otherwise \end{matrix} \right.$ã€‚å…¶ä¸­ï¼Œ$w_iã€v_j$ åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªå¥å­çš„ç¬¬ $i$ ä¸ªä½ç½®ä¸ç¬¬  $j$ ä¸ªä½ç½®çš„tokenã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºï¼šæ— æ³•æ•æ‰åˆ°æ›´åŠ ä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ã€‚</li><li><strong>Cosineï¼š</strong> $M_{ij}=\frac {\alpha_i\beta_j}{||\alpha_i||Â·||\beta_j||}$ï¼Œå…¶ä¸­ï¼Œ$\alpha_iã€\beta_j$ åˆ†åˆ«æ˜¯ä¸¤ä¸ªå¥å­ç¬¬ $i$ ä¸ªä½ç½®ä¸ç¬¬ $j$ ä¸ªä½ç½®çš„tokençš„word embedding(å¯ä»¥ç”±word2vecã€gloveç­‰å¾—åˆ°)ã€‚</li><li><strong>dot productï¼š</strong> $M_{ij}=\alpha_i^{T}\beta_j$ï¼Œè¿™ä¸ªæ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ï¼Œå°±æ˜¯å‘é‡ç›¸ä¹˜ã€‚</li></ul><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-MatchPyramid/matching matrix.jpg" style="zoom:50%;"></p><h3 id="Hierarchical-Convolution"><a href="#Hierarchical-Convolution" class="headerlink" title="Hierarchical Convolution"></a>Hierarchical Convolution</h3><p>åœ¨å¾—åˆ°matching matrixä¹‹åï¼Œæˆ‘ä»¬åªæ˜¯å¾—åˆ°çš„word levelçš„matching patternï¼Œè¿™è¿œè¿œä¸å¤Ÿã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æäº‹æƒ…å•¦ï¼ç”±äºå·ç§¯å±‚æå–ç‰¹å¾çš„èƒ½åŠ›è¿œè¿œè¶…è¿‡åˆ†ç±»å±‚ï¼Œæ‰€ä»¥ä½¿ç”¨å·ç§¯å±‚èƒ½å¤Ÿæå–åˆ°æ›´ä¸ºä¸°å¯Œçš„matching patternã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>åœ¨æ¨¡å‹çš„ç¬¬ä¸€å±‚ï¼Œ<strong>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª2ç»´å·ç§¯ï¼Œ</strong>æ³¨æ„ï¼š<strong>è¿™ä¸ª2ç»´å·ç§¯å±‚é‡‡ç”¨çš„æ˜¯æ–¹æ ¸ï¼Œå¹¶ä¸”æ¿€æ´»å‡½æ•°ä½¿ç”¨reluã€‚</strong></li><li>åœ¨æ¨¡å‹çš„ç¬¬äºŒå±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨åŠ¨æ€çš„poolingã€‚pooling kernelçš„ç»´åº¦æ ¹æ®æ–‡æœ¬é•¿åº¦ä¼šå‘ç”Ÿå˜åŒ–ã€‚</li><li>å½“ç„¶å•¦ï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨ä¸Šè¿°ä¸¤ä¸ªblockï¼Œä»è€Œå¾—åˆ°æ›´åŠ é«˜å±‚æ¬¡è¯­ä¹‰ç‰¹å¾ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬åŠ ä¸€ä¸ªMLPå±‚ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ¯ä¸€ä¸ªclass(0,1)çš„matching scoreã€‚å¯¹äºå¾—åˆ°çš„matching scoreï¼Œæˆ‘ä»¬ä½¿ç”¨softmaxä½œä¸ºåˆ†ç±»å™¨ï¼Œcross entropyä½œä¸ºloss functionã€‚ è®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨SGDï¼Œä¼˜åŒ–å™¨ä½¿ç”¨AdaDeltaã€‚</li></ul><p>ä½œè€…åœ¨Paraphrase Identiï¬cationï¼ˆMSRP datasetsï¼‰ä¸Paper Citation Matchingä¸¤ä¸ªtaskä¸Šè¿›è¡Œäº†å®éªŒï¼Œéƒ½å–å¾—äº†éå¸¸çš„æ•ˆæœã€‚<strong>å‘ç°ä½¿ç”¨dot productæ„å»ºçš„Matching matrixå¾—åˆ°çš„ç»“æœæœ€å¥½ã€‚</strong>å¦‚ä¸‹ï¼š</p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-MatchPyramid/ç»“æœ.jpg" style="zoom:50%;"></p><p><img src="/2020/04/29/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-MatchPyramid/ç»“æœ1.jpg" style="zoom:50%;"></p><p><strong>å¦å¤–æä¸€å¥ï¼ŒMatchPyramidä¹Ÿæœ‰å±€é™æ€§ï¼Œåœ¨äºï¼šMPæ¨¡å‹åªé€‚åˆäºç›¸ä¼¼åº¦ä¸»è¦åœ¨ç»“æ„ä¸Šï¼Œå¹¶ä¸”æ•°æ®é‡è¾ƒå°‘çš„æƒ…å†µï¼Œåƒè¿™ä¸ªcaseï¼šæˆ‘å†™ä¿¡å†™äº†ä¸€ä¸ªæ™šä¸Š/è¿™å°ä¿¡å†™äº†æˆ‘ä¸€ä¸ªæ™šä¸Šï¼Œæ˜¯ä¸é€‚åˆMPæ¨¡å‹çš„ã€‚</strong></p><p>ä»¥ä¸Šå°±æ˜¯MatchPyramidæ¨¡å‹çš„å…¨éƒ¨å†…å®¹å•¦ï½</p><h2 id="MatchPyramidæ¨¡å‹å®ç°"><a href="#MatchPyramidæ¨¡å‹å®ç°" class="headerlink" title="MatchPyramidæ¨¡å‹å®ç°"></a>MatchPyramidæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Deep Pyramid Convolutional Neural Networks for Text Categorization</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> MatchPyramid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-SiamLSTM</title>
      <link href="2020/04/28/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamLSTM/"/>
      <url>2020/04/28/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamLSTM/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„SiamLSTMæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="SiamLSTMæ¨¡å‹ä»‹ç»"><a href="#SiamLSTMæ¨¡å‹ä»‹ç»" class="headerlink" title="SiamLSTMæ¨¡å‹ä»‹ç»"></a>SiamLSTMæ¨¡å‹ä»‹ç»</h2><p>SiamLSTMæ¨¡å‹æ¥æºäºã€ŠSiamese Recurrent Architectures for Learning Sentence Similarityã€‹è®ºæ–‡ï¼Œæ˜¯åœ¨2016å¹´æå‡ºçš„ã€‚SiamLSTMæ¨¡å‹æ‰€è¦è§£å†³çš„æ˜¯<strong>é¢„æµ‹å¥å­ä¹‹é—´çš„ç›¸ä¼¼åº¦</strong>ã€‚SiamLSTMæ¨¡å‹çš„æ¶æ„å’ŒSiamCNNéå¸¸åœ°ç±»ä¼¼ï¼Œæ¯•ç«Ÿéƒ½æ˜¯Siameseç¥ç»ç½‘ç»œå˜›ğŸ¥°ã€‚ç›´æ¥æ”¾å›¾å§ï½</p><p><img src="/2020/04/28/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamLSTM/Siam.jpg" style="zoom: 67%;"></p><p>æ¨¡å‹æœ¬èº«å¹¶ä¸æ˜¯å¾ˆéš¾ï¼Œä¸è¿‡æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼šç¬¬ä¸€ä¸ªæ˜¯ï¼Œä¸¤ä¸ªå¥å­æœ€åä½¿ç”¨çš„æ˜¯åªæœ‰æœ€åä¸€ä¸ªstepçš„hidden stateï¼›ç¬¬äºŒä¸ªæ˜¯ï¼ŒSiamLSTMæ‰€ä½¿ç”¨çš„ç›¸ä¼¼åº¦çš„è®¡ç®—æ–¹æ³•ï¼ˆ1èŒƒæ•°ï¼‰ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">g(h_{T_a}^{(a)},h_{T_b}^{(b)})=exp(-||h_{T_a}^{(a)},h_{T_b}^{(b)}||_1)\in[0,1]</script><p>æœ€åï¼ŒSiamLSTMæ¨¡å‹ä½¿ç”¨çš„æ˜¯SemEval 2014æ•°æ®é›†ã€‚è®­ç»ƒé›†ï¼šSemEval 2014 train dataï¼Œå…±5000æ¡<br>æµ‹è¯•é›†ï¼šSemEval 2014 test dataï¼Œ å…±4927æ¡ã€‚æ¯æ¡æ•°æ®çš„å½¢å¼æ˜¯ï¼š<code>[â€œI like playing basketball.â€,â€My favourite sports is basketball.â€, 3.4]</code>ã€‚ç”±äºSiamLSTMä½¿ç”¨çš„ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•ï¼Œå¯¼è‡´ç»“æœæ˜¯åœ¨$[0,1]$åŒºé—´çš„ï¼Œæ‰€ä»¥æœ€åéœ€è¦å¯¹ç»“æœè¿›è¡Œç¼©æ”¾ï¼Œä»è€Œåœ¨$[1,5]$ä¹‹é—´ã€‚SiamLSTMæ¨¡å‹ä½¿ç”¨çš„æŸå¤±å‡½æ•°æ˜¯MSEã€‚</p><p>è®ºæ–‡æåˆ°çš„è®­ç»ƒçš„ä¸€äº›detailsï¼š<strong>ä½¿ç”¨AdaDeltaï¼Œä½¿ç”¨æ¢¯åº¦è£å‰ªï¼Œä½¿ç”¨SGDï¼ŒLSTMçš„è¾“å‡ºç»´åº¦æ˜¯50ã€‚</strong></p><p>ä»¥ä¸Šå°±æ˜¯SiamLSTMæ¨¡å‹æ¨¡å‹çš„å…¨éƒ¨å†…å®¹å•¦ğŸ¥°ï¼ˆè¯´å®è¯ï¼Œæœ€è¿‘çœ‹æ–‡æœ¬åŒ¹é…çš„è®ºæ–‡ï¼ŒçœŸçš„æ„Ÿè§‰ä¸éš¾ï¼Œæ¯”èµ·ä¹‹å‰çœ‹reformerã€BERTç­‰çš„æ–‡ç« ï¼ŒçœŸçš„æ˜¯å¤ªè½»æ¾å•¦ï¼Œå¸Œæœ›ä¹‹åä¸è¦æ‰“è„¸ğŸ¥°ï¼‰</p><h2 id="SiamLSTMæ¨¡å‹å®ç°"><a href="#SiamLSTMæ¨¡å‹å®ç°" class="headerlink" title="SiamLSTMæ¨¡å‹å®ç°"></a>SiamLSTMæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Siamese Recurrent Architectures for Learning Sentence Similarity</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> SiamLSTM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åŒ¹é…æ¨¡å‹-SiamCNN</title>
      <link href="2020/04/27/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamCNN/"/>
      <url>2020/04/27/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamCNN/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¼å¼€å§‹çœ‹æ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿å•¦ï¼æ–‡æœ¬åŒ¹é…å¯¹NLPeræ¥è¯´æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯æœ€åæ˜¯åšå¯¹è¯ã€æ¨èã€æœç´¢ï¼Œæ–‡æœ¬åŒ¹é…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ç„¶å•¦ï¼ŒBERTç³»åˆ—çš„æ¨¡å‹å‡ºæ¥ä¹‹åï¼Œå…¶å®ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ•ˆæœæ˜¯è¿œè¿œæ¯”ä¸ä¸Šçš„ã€‚ä¸è¿‡è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æ•ˆæœå¥½æ˜¯å¥½ï¼Œä½†æ˜¯è®­ç»ƒä»£ä»·æ˜‚è´µï¼Œå½“ç„¶å•¦ï¼Œæœ‰äººä¼šè¯´ï¼Œç°åœ¨å·²ç»æœ‰å‰ªæã€é‡åŒ–ã€è’¸é¦è¿™æ ·çš„æ–¹æ³•æ¥å‡å°é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°ï¼Œä»è€Œé™ä½è®­ç»ƒæ‰€éœ€çš„ä»£ä»·(æ‰€ä»¥è¯´æ¨¡å‹å‹ç¼©ã€åŠ é€Ÿè¿™ä¸ªæ–¹å‘è¿˜æ˜¯å¾ˆæœ‰å‰æ™¯çš„ğŸ¤©å’¦ï¼Œå¥½åƒè·‘åäº†ï¼Œanyway)ï¼Œä½†æ˜¯è¿™ä»ç„¶è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥ç†Ÿæ‚‰ä¼ ç»Ÿçš„æ–‡æœ¬åŒ¹é…æ¨¡å‹æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬ç¯‡åšå®¢è®²è§£ç»å…¸çš„SiamCNNæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2å®ç°ã€‚</p><a id="more"></a><h2 id="SiamCNNæ¨¡å‹ä»‹ç»"><a href="#SiamCNNæ¨¡å‹ä»‹ç»" class="headerlink" title="SiamCNNæ¨¡å‹ä»‹ç»"></a>SiamCNNæ¨¡å‹ä»‹ç»</h2><p>SiamCNNæ¨¡å‹æ¥æºäºã€ŠAPPLYING DEEP LEARNING TO ANSWER SELECTION: A STUDY AND AN OPEN TASKã€‹(åæ¥æŸ¥äº†ä¸€ä¸‹ï¼ŒSiameseCNNæœ€åˆç”¨æ¥è§£å†³å›¾åƒé—®é¢˜ï¼Œanywayï¼Œéƒ½æ˜¯ç›¸é€šçš„ğŸ¤©)ã€‚è¿™ä¸ªæ¨¡å‹è¦è§£å†³çš„å°±æ˜¯<strong>answer selction(é—®ç­”åŒ¹é…)é—®é¢˜</strong>ã€‚ä»€ä¹ˆæ˜¯é—®é¢˜åŒ¹é…é—®é¢˜å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><p>ç»™å®šä¸€ä¸ªé—®é¢˜ $q$ ä»¥åŠé—®é¢˜ $q$ çš„ç­”æ¡ˆå€™é€‰æ± $\{a_1,a_2,â€¦,a_s\}$ï¼Œé€šè¿‡æ¨¡å‹ï¼Œä»ä¸­é€‰å‡ºæœ€å¥½çš„ç­”æ¡ˆ$a_k$ï¼Œå¦‚æœè¯´é€‰å‡ºçš„ç­”æ¡ˆ $a_k$ åœ¨é—®é¢˜ $q$ çš„truth seté‡Œé¢çš„çš„è¯ï¼Œé‚£ä¹ˆï¼Œå°±è¯´é—®é¢˜$q$è¢«æ­£ç¡®çš„å›ç­”äº†ï¼Œå¦åˆ™å°±è¯´æ˜é—®é¢˜ $q$ æ²¡æœ‰è¢«å¾ˆå¥½åœ°å›ç­”ã€‚è¿™å°±æ˜¯é—®ç­”åŒ¹é…é—®é¢˜ã€‚</p><p>å®šä¹‰é—®é¢˜ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»™å‡ºæ¨¡å‹æ¶æ„ã€‚SiamCNNæ¨¡å‹çš„æ¶æ„æ¯”è¾ƒç®€å•ï¼š<strong>é¦–å…ˆå­¦ä¹ å¾—åˆ°ç»™å®šçš„é—®é¢˜åŠå…¶å€™é€‰ç­”æ¡ˆæ± çš„å‘é‡åŒ–è¡¨ç¤ºï¼Œç„¶åä½¿ç”¨ç›¸ä¼¼æ€§åº¦é‡æ–¹æ³•æ¥è¡¡é‡åŒ¹é…åº¦ã€‚</strong>æ¨¡å‹çš„è®­ç»ƒå®ä¾‹çš„æ„é€ æ–¹å¼æˆ–è€…è¯´æ˜¯å­¦ä¹ ç­–ç•¥ï¼Œæ˜¯<strong>pairwise</strong>ã€‚å³ï¼šæˆ‘ä»¬æ„å»ºçš„è®­ç»ƒå®ä¾‹æ˜¯ï¼š$(q_i,c_i^+,c_i^-)$ï¼Œå…¶ä¸­ $q_i$ è¡¨ç¤ºé—®é¢˜ï¼Œ$c_i^+$ è¡¨ç¤ºç»™å®šé—®é¢˜çš„ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆï¼Œ$c_i^-$ è¡¨ç¤ºç»™å®šé—®é¢˜çš„ä¸€ä¸ªé”™è¯¯ç­”æ¡ˆã€‚æŸå¤±å‡½æ•°ä¸ºhinge lossï¼Œå…¬å¼æ˜¯ï¼š$L=max\{0,m-h_\theta(q_i,c_i^+)+h_\theta(q_i,c_i^-)\}$ï¼Œå…¶ä¸­ï¼Œ$m$è¡¨ç¤ºè¾¹ç•Œé˜ˆå€¼ï¼Œå¦‚æœè¯´$L$å¤§äº0ï¼Œé‚£ä¹ˆè¯´æ˜æ¨¡å‹æŠŠé”™è¯¯ç­”æ¡ˆæ’åœ¨æ­£ç¡®ç­”æ¡ˆä¹‹å‰ï¼›å¦‚æœè¯´$L$ç­‰äº0ï¼Œé‚£ä¹ˆè¯´æ˜æ¨¡å‹æŠŠæ­£ç¡®ç­”æ¡ˆæ’åœ¨é”™è¯¯ç­”æ¡ˆä¹‹å‰ã€‚æ‰€ä»¥hingle lossçš„ç›®çš„å°±æ˜¯è¦ä¿ƒä½¿æ­£ç¡®ç­”æ¡ˆçš„å¾—åˆ†æ¯”é”™è¯¯ç­”æ¡ˆçš„å¾—åˆ†é«˜mã€‚åœ¨é¢„æµ‹é˜¶æ®µï¼Œå¾—åˆ†æœ€é«˜çš„å€™é€‰ç­”æ¡ˆè¢«å½“ä½œæ­£ç¡®ç­”æ¡ˆã€‚</p><p><img src="/2020/04/27/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamCNN/simaCNNæ¨¡å‹.jpg" alt></p><p>ä¸Šé¢è¿™å¼ å›¾å°±æ˜¯ä½œè€…ç»™å‡ºçš„SiamCNNæ¨¡å‹çš„ç»“æ„ã€‚ä½œè€…åšäº†å¾ˆå¤šå®éªŒï¼Œå¯¹æ¶æ„åšäº†å¾ˆå¤šæ”¹è¿›ã€‚æœ€åå‘ç°ç¬¬äºŒä¸­æ¶æ„æ˜¯æœ€å¥½çš„ï¼Œå³ï¼š<strong>é¦–å…ˆæ˜¯tanhå±‚ï¼Œä¹Ÿå°±æ˜¯å¯¹Qã€Açš„å‘é‡åŒ–è¡¨ç¤ºè¿›è¡Œæ¿€æ´»ï¼Œä½†æ˜¯ä¸¤è€…å…±äº«æƒé‡å‚æ•°ï¼›ç¬¬äºŒå±‚æ˜¯å·ç§¯å±‚ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…±äº«æƒé‡å‚æ•°ï¼›ç¬¬ä¸‰å±‚æ˜¯max ppolingå±‚ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨1 max poolingï¼Œé€‰å‡ºä¸inputæœ€ç›¸å…³çš„ç‰¹å¾ï¼›ç¬¬å››å±‚æ˜¯tanhå±‚ï¼›æœ€åæ ¹æ®ç›¸ä¼¼åº¦è¡¡é‡æ–¹æ³•æ¥å¾—åˆ°ç»“æœã€‚</strong></p><p><img src="/2020/04/27/NLP-%E6%96%87%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-SiamCNN/å®éªŒç»“æœ.jpg" alt></p><p>è¿™æ˜¯ä½œè€…çš„å®ç°ç»“æœï¼Œç¬¬10è¡Œå°±æ˜¯ç¬¬äºŒä¸ªæ¶æ„çš„ç»“æœã€‚ç»è¿‡å®éªŒä¹‹åï¼Œä½œè€…ç»™å‡ºäº†å‡ ä¸ªæœ‰æ„æ€çš„ç»“è®ºï¼š</p><ul><li>å‚æ•°å…±äº«å±‚çš„ä½¿ç”¨æ¯”å‚æ•°åˆ†å¼€çš„æƒ…å†µï¼Œæ•ˆæœè¦å¥½å¾—å¤šï¼›</li><li>ä¸éœ€è¦åœ¨å·ç§¯å±‚ä¹‹åï¼Œå†æ·»åŠ hidden layerï¼Œå› ä¸ºå·ç§¯å±‚å·²ç»èƒ½å¤Ÿå¾ˆå¥½çš„æå–å‡ºæœ‰ç”¨çš„ç‰¹å¾ï¼Œè€ŒåŠ å…¥hidden layeråè€Œä¼šé™ä½æ•ˆæœï¼›</li><li>æé«˜filterçš„æ•°é‡ä¼šæé«˜æ•ˆæœï¼›</li><li>å¤šå±‚çš„å·ç§¯å±‚èƒ½å¤Ÿæå–æ›´åŠ é«˜å±‚æ¬¡çš„è¯­ä¹‰ç‰¹å¾ï¼Œä¹Ÿå¯ä»¥æé«˜æ•ˆæœï¼›</li><li>ä¸åŒçš„ç›¸ä¼¼åº¦è¡¡é‡æ–¹æ³•ä¼šå¯¹ç»“æœäº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼Œæ‰€ä»¥è¦æ…é‡é€‰å–ç›¸ä¼¼åº¦è¡¡é‡æ–¹æ³•ã€‚</li></ul><p>ä»¥ä¸Šå°±æ˜¯SiamCNNæ¨¡å‹çš„å†…å®¹ï¼Œæˆ‘ä¸ªäººè§‰å¾—è¿™æ˜¯ä¸€ç¯‡éå¸¸å¥½çš„æ–‡ç« ï¼Œè™½ç„¶å†…å®¹è¾ƒä¸ºç®€å•ï¼Œä½†æ˜¯ç»™äº†æˆ‘ä»¬å¾ˆå¤šå¯å‘ï¼Œä¹‹åï¼Œæˆ‘ä»¬åœ¨åšæ–‡æœ¬åŒ¹é…çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å‚è€ƒã€‚å½“ç„¶å•¦ï¼Œåœ¨BERTé¢å‰ï¼Œè¿™äº›æ¨¡å‹éƒ½æ˜¾å¾—é€Šè‰²è®¸å¤šï¼Œä¸è¿‡ä»ç„¶éå¸¸å…·æœ‰å¯å‘æ€§ã€‚ğŸ¤©</p><h2 id="SiamCNNæ¨¡å‹å®ç°"><a href="#SiamCNNæ¨¡å‹å®ç°" class="headerlink" title="SiamCNNæ¨¡å‹å®ç°"></a>SiamCNNæ¨¡å‹å®ç°</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>APPLYING DEEP LEARNING TO ANSWER SELECTION: A STUDY AND AN OPEN TASK</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åŒ¹é…æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> SiamCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åˆ†ç±»æ¨¡å‹-HAN</title>
      <link href="2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-HAN/"/>
      <url>2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-HAN/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹æ–‡æœ¬åˆ†ç±»ç³»åˆ—æ¨¡å‹ï¼Œåº”è¯¥ä¼šé™†ç»­æ›´æ–°å‡ ç¯‡æœ‰å…³æ–‡æœ¬åˆ†ç±»æ¨¡å‹çš„åšå®¢ï¼Œå¤§æ¦‚ä¸€å‘¨å†…æ›´æ–°å®Œæˆï¼Œä¹‹åå¼€å§‹åšæ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿ã€‚è™½ç„¶è¿™äº›æ¨¡å‹ç½‘ä¸Šæœ‰å¾ˆå¤šè§£è¯»äº†ï¼Œä½†æ˜¯åªæœ‰è‡ªå·±å†™å‡ºæ¥äº†ï¼Œæ‰ç®—æ˜¯è‡ªå·±çš„å‘€ã€‚æœ¬ç¯‡åšå®¢è®²è§£æœ€ä¸ºç»å…¸çš„HANæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2æ¥è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="HANæ¨¡å‹ç®€ä»‹"><a href="#HANæ¨¡å‹ç®€ä»‹" class="headerlink" title="HANæ¨¡å‹ç®€ä»‹"></a>HANæ¨¡å‹ç®€ä»‹</h2><p>HANæ¨¡å‹å¤§ä½“çš„æ€æƒ³æ˜¯ï¼šå°†word embeddingé€šè¿‡attentionæœºåˆ¶å¾—åˆ°sentence embeddingï¼Œå†é€šè¿‡sentence embedding å¾—åˆ°document embeddingï¼Œæœ€ååŠ ä¸Šä¸€ä¸ªåˆ†ç±»å±‚ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ–‡æœ¬åˆ†ç±»ç»“æœã€‚æ¨¡å‹æ¶æ„å¦‚ä¸‹ï¼šğŸ‘‡</p><p><img src="/2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-HAN/HANæ¨¡å‹æ¶æ„jpg.jpg" style="zoom: 67%;"></p><p>æ•´ä½“æ¶æ„æ¯”è¾ƒç®€å•ï¼Œåœ¨è¿™é‡Œï¼Œè¯´å‡ ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ul><li><p>æ¨¡å‹çš„è¾“å…¥æ˜¯ï¼š(batch_size,max_sentence,max_word)ï¼Œè¿™ç‚¹éå¸¸é‡è¦ã€‚</p></li><li><script type="math/tex; mode=display">word \ encoder+word \ attentionéƒ¨åˆ†ï¼š\\u_w=tanh(Wh_{i,j}+b_w) \\\alpha_{it}=softmax(u_{it}^Tu_{w})\\s_i=\sum_{t=1}^{T}\alpha_{it}h_{it}\\\\\\sentence \ encoder+sentence \ attentionéƒ¨åˆ†ï¼š\\u_s=tanh(W_sh_{i}+b_s)\\\alpha_i=softmax(u_i^Tu_s)\\v=\sum_{l=1}^{L}\alpha_ih_i</script></li></ul><h2 id="HANæ¨¡å‹å®ç°"><a href="#HANæ¨¡å‹å®ç°" class="headerlink" title="HANæ¨¡å‹å®ç°"></a>HANæ¨¡å‹å®ç°</h2><p>æš‚æ— ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Hierarchical Attention Networks for Document Classiï¬cation</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åˆ†ç±»æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> HAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tensorflow2çš„é›¶ç¢ç¬”è®°</title>
      <link href="2020/04/25/Tensorflow2%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/25/Tensorflow2%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä½¿ç”¨tensorflow2çš„ä¸€äº›ç¬”è®°å§ï¼Œå› ä¸ºæœ‰æ—¶å€™æ˜¯çœŸçš„å®¹æ˜“å¿˜ã€‚</p><a id="more"></a><p><strong>tf.keras.Embedding(input_dim=vocab_size,ouput_dim=embedding_size,input_length=input_length)</strong></p><blockquote><p>è¿™æ˜¯åµŒå…¥å±‚ï¼Œåªèƒ½ä½œä¸ºç¬¬ä¸€å±‚ã€‚å¹¶ä¸”è¾“å…¥çš„å½¢çŠ¶åªèƒ½æ˜¯(batch_size,seq_length).</p></blockquote><p><strong>tf.keras.prerocessing.sequence.pad_sequences(x_train,maxlen=maxlen)</strong></p><blockquote><p>x_trainåªèƒ½æ˜¯ä¸€ä¸ªäºŒç»´tensorï¼Œmaxlenè¡¨ç¤ºæœ€ç»ˆè¦å¾—åˆ°çš„æ¡”å¥å­é•¿åº¦ã€‚</p></blockquote><p><strong>tf.keras.layers.Bidirectional(layer,merge_mode=â€concat,None,mul,sumâ€)</strong></p><blockquote><p>æ¯”å¦‚ä¼ å…¥LSTMçš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°biLSTMã€‚å¦‚æœæ˜¯Noneçš„è¯ï¼Œé‚£ä¹ˆå°±è¿”å›ä¸¤ä¸ªå€¼ã€‚</p></blockquote><p><strong>t f.keras.layers.LSTM(units,acitavtion,return_sequences,return_state,go_barckwards)</strong><a href="https://huhuhang.com/post/machine-learning/lstm-return-sequences-state" target="_blank" rel="noopener">é“¾æ¥</a></p><blockquote><p>unitsè¡¨ç¤ºLSTMè¾“å‡ºçš„ç»´åº¦ï¼›acitvationè¡¨ç¤ºæ¿€æ´»å‡½æ•°ï¼Œé»˜è®¤æ˜¯tanhï¼›return_sequencesè¡¨ç¤ºæ˜¯å¦è¿”å›æ•´ä¸ªè¾“å‡ºåºåˆ—ï¼Œé»˜è®¤ä¸ºfalseï¼›return_stateè¡¨ç¤ºé™¤äº†è¾“å‡ºå¤–ï¼Œæ˜¯å¦è¾“å‡ºæœ€åä¸€ä¸ªçŠ¶æ€ï¼Œé»˜è®¤falseã€‚å¦‚æœreturn_sequencesä¸return_stateå‡æ˜¯Trueçš„è¯ï¼Œé‚£ä¹ˆè¿”å›å€¼æœ‰ä¸‰ä¸ªï¼šæ•´ä¸ªè¾“å‡ºåºåˆ—ï¼Œæœ€åè¾“å‡ºã€æœ€åä¸€ä¸ªçŠ¶æ€ã€‚go_backwardsä¸ºTrueï¼Œè¡¨ç¤ºå°†è¾“å…¥ç»™LSTMçš„è¾“å…¥åå‘ã€‚<a href="https://stackoverflow.com/questions/49946942/keras-lstm-go-backwards-usage" target="_blank" rel="noopener">è§stackoverflowçš„è§£ç­”</a></p><p>ä¸¾ä¸ªğŸŒ°ï¼šğŸ‘‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">inputs = np.random.random([<span class="number">32</span>, <span class="number">10</span>, <span class="number">8</span>]).astype(np.float32)</span><br><span class="line">lstm = tf.keras.layers.LSTM(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">output = lstm(inputs)  <span class="comment"># The output has shape `[32, 4]`.</span></span><br><span class="line"></span><br><span class="line">lstm = tf.keras.layers.LSTM(<span class="number">4</span>, return_sequences=<span class="literal">True</span>, return_state=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># whole_sequence_output has shape `[32, 10, 4]`.</span></span><br><span class="line"><span class="comment"># final_memory_state and final_carry_state both have shape `[32, 4]`.</span></span><br><span class="line">whole_sequence_output, final_memory_state, final_carry_state = lstm(inputs)</span><br></pre></td></tr></table></figure></blockquote><p><strong>tf.keras.layers.MaxPool2D(pool_size=(),strides=(),padding=â€validâ€)</strong></p><blockquote><p>è¾“å…¥çš„ç»´åº¦æ˜¯4ç»´çš„(batch_size,rows,cols,channels)ï¼Œå¹¶ä¸”pool_sizeä¸strideséƒ½æ˜¯tupleï¼Œè¿™ä¸€ç‚¹è¦è®°ä½ï¼Œæœ€åè¾“å‡ºçš„ç»´åº¦æ˜¯(batch_size,new_rows,new_cols,channels)ã€‚</p></blockquote><p><strong>callbacksçš„å†™æ³•</strong></p><ul><li><strong>tf.keras.callbacks.EarlyStopping(monitor=â€™val_lossâ€™,min_delta=0,patience=3)</strong></li></ul><blockquote><p>å…¶ä¸­ï¼Œmonitorè¡¨ç¤ºè¦æ£€æµ‹çš„æŒ‡æ ‡ï¼Œmin_deltaè¡¨ç¤ºåœ¨è¢«ç›‘æµ‹çš„æ•°æ®ä¸­è¢«è®¤ä¸ºæ˜¯æå‡çš„æœ€å°å˜åŒ–ï¼Œå³ç»å¯¹å˜åŒ–å°äºmin_deltaï¼Œå°†è¢«è§†ä¸ºæ²¡æœ‰æå‡ï¼›patienceè¡¨ç¤ºæ²¡æœ‰è¿›æ­¥çš„è®­ç»ƒè½®æ•°ï¼Œåœ¨è¿™ä¹‹åè®­ç»ƒå°±ä¼šè¢«åœæ­¢ã€‚</p></blockquote><p><strong>tf.keras.layers.Conv1D(filters=250,kernel_size=3,padding=â€™sameâ€™,strides=1)</strong></p><blockquote><p>ä¸€ç»´å·ç§¯ï¼Œè¾“å…¥çš„ç»´åº¦ä¸ºï¼ˆbatch_size, steps, input_dimï¼‰ï¼Œè¾“å‡ºç»´åº¦ä¸ºï¼ˆbatch_size, new_steps, filtersï¼‰ã€‚</p></blockquote><p><strong>tf.keras.layers.MaxPool1D(pool_size=2,strides=1,padding=â€™validâ€™)</strong></p><blockquote><p>è¾“å…¥ç»´åº¦ä¸º(batch_size, steps, features)ï¼Œè¾“å‡ºç»´åº¦ä¸º(batch_size, downsampled_steps, features)ã€‚</p></blockquote><p><strong>argparseçš„ä½¿ç”¨</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser=argparse.ArgumentParser(description=<span class="string">""</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--name"</span>,type=int/str,help=<span class="string">"name"</span>,default=xxx,required=<span class="literal">True</span>/<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">args=parser.parse_args()</span><br><span class="line">print(args.name)</span><br></pre></td></tr></table></figure><p><strong>èŒƒæ•°çš„æ¦‚å¿µ</strong></p><p>0èŒƒæ•°ï¼Œå‘é‡ä¸­éé›¶å…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>1èŒƒæ•°ï¼Œä¸ºç»å¯¹å€¼ä¹‹å’Œã€‚</p><p>2èŒƒæ•°ï¼Œå°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„æ¨¡ã€‚ </p><p>æ— ç©·èŒƒæ•°ï¼Œå°±æ˜¯å–å‘é‡çš„æœ€å¤§å€¼</p><p><img src="/2020/04/25/Tensorflow2%E7%9A%84%E9%9B%B6%E7%A2%8E%E7%AC%94%E8%AE%B0/èŒƒæ•°ã€‚png.png" style="zoom:80%;"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¡ç®—1èŒƒæ•°</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">a=tf.norm(x,ord=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><strong>np.argsortçš„ä½¿ç”¨</strong></p><p>y=np.argsort(X)çš„ä½œç”¨æ˜¯ï¼š<strong>å°†Xä¸­çš„å…ƒç´ ä»å°åˆ°å¤§æ’åºåï¼Œæå–å¯¹åº”çš„ç´¢å¼•indexï¼Œç„¶åè¾“å‡ºåˆ°yã€‚</strong></p><p>[::-1]æ˜¯ä»æœ€åä¸€ä¸ªå…ƒç´ åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ å¤åˆ¶ä¸€éï¼Œå³å€’åºã€‚</p><p><strong>jsonçš„ä½¿ç”¨</strong><a href="https://www.cnblogs.com/linwow/p/10693781.html" target="_blank" rel="noopener">é“¾æ¥</a></p><blockquote><p>æ¨èä½¿ç”¨jsonï¼Œè€Œä¸æ˜¯pickleï¼Œå› ä¸ºjsonå¾—åˆ°çš„æ–‡ä»¶æ‰€æœ‰é€šç”¨ï¼Œè€Œpickleå¾—åˆ°çš„æ–‡ä»¶åªèƒ½æ˜¯pythonä½¿ç”¨ï¼</p></blockquote><p><strong>json.dumps(obj)</strong>:åºåˆ—åŒ–æˆå­—ç¬¦ä¸²</p><p><strong>json.dump(obj):</strong>åºåˆ—åŒ–å­—ç¬¦ä¸²åˆ°æ–‡ä»¶ä¸­</p><p><strong>json.loads(json_str):</strong>å°†json_strååºåˆ—åŒ–æˆåŸæœ¬çš„å¯¹è±¡</p><p><strong>json.load(file):</strong>è¯»å–jsonæ–‡ä»¶ï¼Œå¹¶ååºåˆ—åŒ–æˆåŸæœ¬çš„å¯¹è±¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">a=&#123;<span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"c"</span>: <span class="number">0</span>, <span class="string">"b"</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="comment">#å°†aåºåˆ—åŒ–æˆå­—ç¬¦ä¸²</span></span><br><span class="line">json_str=json.dumps(a)</span><br><span class="line"><span class="comment">#åºåˆ—åŒ–æˆå­—ç¬¦ä¸²åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"a.json"</span>.<span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">  json.dump(a,f)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¯»å–jsonæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"a.json"</span>,<span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">  a=json.load(f)</span><br></pre></td></tr></table></figure><p>pickleçš„ä½¿ç”¨æ–¹æ³•ä¸jsonä¸€è‡´ï¼ä½†æ˜¯å†™æ–‡ä»¶çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨â€wbâ€ï¼Œè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨â€œrbâ€ã€‚</p><p><strong>å¯¼å…¥ä¸Šçº§æ¨¡å—</strong><a href="https://www.cnblogs.com/ipersevere/p/10916803.html" target="_blank" rel="noopener">é“¾æ¥</a>ã€<a href="https://zhuanlan.zhihu.com/p/64893308" target="_blank" rel="noopener">é“¾æ¥2</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¬¬ä¸€æ­¥ï¼šåœ¨è¦è®¿é—®çš„æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹ï¼Œå»ºç«‹ç©ºçš„__init__.pyæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬äºŒæ­¥ï¼šåœ¨è¦å†™çš„æ–‡ä»¶ä¸­å†™å…¥ä¸‹åˆ—ä»£ç ï¼š</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">".."</span>)<span class="comment">#è¿”å›åˆ°ä¸Šçº§ç›®å½•</span></span><br><span class="line"><span class="keyword">from</span> a.ss <span class="keyword">import</span> dasj</span><br></pre></td></tr></table></figure><p><strong>è·å–æ–‡ä»¶ç›®å½•ç»“æ„ï¼štree</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ .DS_Store</span><br><span class="line">â”œâ”€â”€ CDSSM</span><br><span class="line">â”‚Â Â  â””â”€â”€ CDSSM.py</span><br><span class="line">â”œâ”€â”€ CompAgg</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 1.py</span><br><span class="line">â”‚Â Â  â””â”€â”€ CompAgg.py</span><br><span class="line">â”œâ”€â”€ DSSM</span><br><span class="line">â”‚Â Â  â””â”€â”€ DSSM.py</span><br><span class="line">â”œâ”€â”€ DecAtt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ DecAtt.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __pycache__</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ DecAtt.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ ESIM</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ .DS_Store</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 1.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ESIM.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __pycache__</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ ESIM.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ HCAN</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 1.py</span><br><span class="line">â”‚Â Â  â””â”€â”€ HCAN.py</span><br><span class="line">â”œâ”€â”€ InferSent</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ InferSent.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __pycache__</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ InferSent.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ MatchPyramid</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ DynamicMaxPool2D.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ MatchPyramid.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ MatchingLayer.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __pycache__</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ DynamicMaxPool2D.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MatchPyramid.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ MatchingLayer.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ SIamLSTM</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ SiamLSTM.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __pycache__</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ SiamLSTM.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ SSE</span><br><span class="line">â”‚Â Â  â””â”€â”€ SSE.py</span><br><span class="line">â”œâ”€â”€ SiamBILSTM</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ SiamBILSTM.py</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ SiamCNN</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ SiamCNN.py</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ __pycache__</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ SiamCNN.cpython-37.pyc</span><br><span class="line">â”‚Â Â  â””â”€â”€ train.py</span><br><span class="line">â”œâ”€â”€ __init__.py</span><br><span class="line">â””â”€â”€ __pycache__</span><br><span class="line">    â””â”€â”€ __init__.cpython-37.pyc</span><br></pre></td></tr></table></figure><p><strong>tf.norm</strong></p><p>æœ€è¿‘é¢‘ç¹æ¶‰åŠåˆ°ä»€ä¹ˆä½™å¼¦ç›¸ä¼¼åº¦çš„è®¡ç®—ä¹‹ç±»çš„ï¼Œæ‰€ä»¥è®¡ç®—tensorçš„æ¨¡æ˜¯å¿…é¡»çš„ï¼Œè¿™é‡Œå°å°çš„æ€»ç»“ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a=np.ones((<span class="number">100</span>,<span class="number">60</span>,<span class="number">30</span>))</span><br><span class="line"><span class="comment">#ä¸‹é¢ä¸¤ç§è®¡ç®—æ–¹æ³•éƒ½æ˜¯å¯ä»¥çš„ï¼Œç»“æœä¸€æ ·ã€‚</span></span><br><span class="line">b=tf.norm(a,ord=<span class="number">2</span>,axis<span class="number">-1</span>,keepdims=<span class="literal">True</span>)</span><br><span class="line">c=tf.math.sqrt(tf.math.reduce_sum(tf.math.square(a),axis=<span class="number">-1</span>,keepdims=<span class="literal">True</span>))</span><br><span class="line">print(b==c)</span><br></pre></td></tr></table></figure><p>tf.normæ˜¯ç”¨æ¥è®¡ç®—tensorçš„æ¨¡çš„ï¼Œå…·ä½“æ¥è¯´æ˜¯ï¼štf.norm(tensor,ord=2,axis=-1,keepdims=True).å…¶ä¸­ï¼Œord=1è¡¨ç¤ºè®¡ç®—å…¶l1èŒƒæ•°ï¼Œç­‰äº2è¡¨ç¤ºè®¡ç®—l2èŒƒæ•°ï¼›axis=-1è¡¨ç¤ºä»æœ€åä¸€ç»´è®¡ç®—ï¼›keepdims=Trueè¡¨ç¤ºè®¡ç®—ä¹‹åçš„tensorçš„ç»´åº¦çš„ä¸ªæ•°ä¸å˜ã€‚</p><p><strong>å…³äºpaddingä¸mask</strong></p><p>çœ‹åˆ°ä¸€ç¯‡å…³äºmaskçš„åº”ç”¨åœºæ™¯ä¸æ–¹æ¡ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œè®°å½•ä¸€ä¸‹ğŸ¤©é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/7b408a60ac35" target="_blank" rel="noopener">paddingä¸mask</a></p><p><strong>å…³äºencodeä¸decode</strong></p><p><a href="https://blog.csdn.net/wz947324/article/details/80625533" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a></p><p>æ€»çš„æ¥è¯´ï¼Œå¦‚æœstræ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬è¦ç›´æ¥å¯¹å®ƒè¿›è¡Œæ“ä½œçš„è¯ï¼Œå°±ä¸éœ€è¦encodeæˆ–è€…decodeï¼Œé™¤éæˆ‘ä»¬è¦å°†strä¿å­˜åˆ°æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¯¹å…¶è¿›è¡Œencodeï¼Œåœ¨pythonä»£ç é‡Œï¼Œå…·ä½“æ˜¯:<code>with codecs.open(foel_patj,&quot;w&quot;,encoding=&quot;utf-8&quot;) as f:</code>ã€‚</p><p>å¦‚æœæˆ‘ä»¬stræ˜¯bytesï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ´—é‚£ä¸ªå¯¹å…¶è¿›è¡Œæ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¯¹å…¶è¿›è¡Œdecodeï¼Œä»è€Œå¾—åˆ°å­—ç¬¦ä¸²ï¼Œå…·ä½“å°±æ˜¯ï¼š<code>u1=str.decode(&quot;utf-8&quot;)</code>ã€‚</p><p>æˆ‘ä»¬å…·ä½“åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼šï¼ˆtextæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> six.PY3:<span class="comment"># å¦‚æœæ˜¯python3çš„è¯ </span></span><br><span class="line">  <span class="keyword">if</span> isinstance(text, str):<span class="comment"># å¦‚æœæ˜¯strçš„è¯ï¼Œæˆ‘ä»¬å°±ç›´æ¥è¿”å›ä½¿ç”¨å³å¯</span></span><br><span class="line">      <span class="keyword">return</span> text</span><br><span class="line">    <span class="keyword">elif</span> isinstance(text, bytes): <span class="comment"># å¦‚æœæ˜¯bytesï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯éœ€è¦è¿›è¡Œdecodeï¼Œå¾—åˆ°å­—ç¬¦ä¸²æ¥ä½¿ç”¨ã€‚</span></span><br><span class="line">      <span class="keyword">return</span> text.decode(<span class="string">"utf-8"</span>, <span class="string">"ignore"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">raise</span> ValueError(<span class="string">"Unsupported string type: %s"</span> % (type(text)))</span><br><span class="line"><span class="keyword">elif</span> six.PY2: <span class="comment"># å¦‚æœæ˜¯python2çš„è¯</span></span><br><span class="line">  <span class="keyword">if</span> isinstance(text, str):</span><br><span class="line">    <span class="keyword">return</span> text.decode(<span class="string">"utf-8"</span>, <span class="string">"ignore"</span>)</span><br><span class="line">  <span class="keyword">elif</span> isinstance(text, unicode):</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line">  <span class="keyword">else</span>:</span><br></pre></td></tr></table></figure><p><strong>å…³äºTFRrecordçš„ä½¿ç”¨</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_tfrecord</span><span class="params">(file_path, word_dict_path, max_utterance_num=<span class="number">10</span>, max_utterance_len=<span class="number">50</span>)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å»ºç«‹TFRecordæ–‡ä»¶ï¼Œæ–¹ä¾¿è¯»å–</span></span><br><span class="line"><span class="string">    :param file_path: æ•°æ®é›†çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">    :param word_dict_path: word dictçš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">    :param max_utterance_num: contextä¸­utteranceçš„æœ€å¤§æ•°ç›®</span></span><br><span class="line"><span class="string">    :param max_utterance_len: å¥å­çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :return:æ— </span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    data = load_data(file_path)</span><br><span class="line">    word_dict = load_dictionary(word_dict_path)</span><br><span class="line">    print(<span class="string">"start bulid TFRecord!"</span>)</span><br><span class="line"></span><br><span class="line">    base_path = os.path.dirname(file_path)</span><br><span class="line">    base_name = os.path.basename(file_path)</span><br><span class="line">    target_path = base_path + <span class="string">"/%s.tfrecord"</span> % base_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºtfrecordçš„æ–‡ä»¶ï¼Œåå­—ä¸ºtarget_path</span></span><br><span class="line">    writer = tf.io.TFRecordWriter(target_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">        context_indexes_new, context_len_new = context_to_index(item[<span class="string">"context"</span>], word_dict, max_utterance_num,max_utterance_len)</span><br><span class="line">        response_indexes_new, response_len_new = response_to_index(item[<span class="string">"response"</span>], word_dict, max_utterance_len)</span><br><span class="line">        label = int(item[<span class="string">"label"</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ•°æ®æ±‡æ€»ï¼Œæ„å»ºç‰¹å¾</span></span><br><span class="line">        features = &#123;</span><br><span class="line">            <span class="string">"context"</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[context_indexes_new.tostring()])),</span><br><span class="line">            <span class="string">"context_len"</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[context_len_new.tostring()])),</span><br><span class="line">            <span class="string">"response"</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[response_indexes_new.tostring()])),</span><br><span class="line">            <span class="string">"resonse_len"</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[response_len_new])),</span><br><span class="line">            <span class="string">"label"</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[label]))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tf_features = tf.train.Features(feature=features)</span><br><span class="line">        <span class="comment"># æŠŠæ•°æ®å†™å…¥example</span></span><br><span class="line">        tf_example = tf.train.Example(features=tf_features)</span><br><span class="line">        <span class="comment"># exampleåºåˆ—åŒ–</span></span><br><span class="line">        tf_serialized = tf_example.SerializeToString()</span><br><span class="line">        writer.write(tf_serialized)</span><br><span class="line"></span><br><span class="line">    writer.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tfrecord_parser</span><span class="params">(max_utterance_num,max_utterance_len)</span>:</span></span><br><span class="line">   <span class="string">'''</span></span><br><span class="line"><span class="string">    è§£ætfrecordæ–‡ä»¶</span></span><br><span class="line"><span class="string">    :param max_utterance_num:  contextä¸­utteranceçš„æœ€å¤§æ•°ç›®</span></span><br><span class="line"><span class="string">    :param max_utterance_len: å¥å­çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :return: parser</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_parser</span><span class="params">(example_proto)</span>:</span></span><br><span class="line">        feature=&#123;</span><br><span class="line">            <span class="string">"context"</span>:tf.io.FixedLenFeature(shape=[],dtype=tf.string)</span><br><span class="line">            <span class="string">"context_len"</span>:tf.io.FixedLenFeature(shape=[],dtype=tf.string)</span><br><span class="line">            <span class="string">"response"</span>:tf.io.FixedLenFeature(shape=[],dtype=tf.string)</span><br><span class="line">            <span class="string">"reponse_len"</span>:tf.io.FixedLenFeature(shape=[],dtype=tf.int64)</span><br><span class="line">            <span class="string">"label"</span>:tf.io.FixedLenFeature(shape=[],dtype=tf.int64)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        parsed_example=tf.io.parse_single_example(serialized=example_proto,features=feature)</span><br><span class="line">        context=tf.reshape(tf.io.decode_raw(parsed_example[<span class="string">"context"</span>],tf.int32),shape=[max_utterance_num,max_utterance_len])</span><br><span class="line">        context_len=tf.reshape(tf.io.decode_raw(parsed_example[<span class="string">"context_len"</span>],tf.int32),shape=[max_utterance_num])</span><br><span class="line">        response=tf.reshape(tf.io.decode_raw(parsed_example[<span class="string">"response"</span>],tf.int32),shape=[max_utterance_len])</span><br><span class="line">        response_len=parsed_example[<span class="string">"response_len"</span>]</span><br><span class="line">        label=parsed_example[<span class="string">"label"</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> context,context_len,response,response_len</span><br><span class="line">    <span class="keyword">return</span> _parser</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_batch_dataset</span><span class="params">(tfrecord_file,parser,batch_size,is_test=False)</span>:</span></span><br><span class="line">     <span class="string">'''</span></span><br><span class="line"><span class="string">    å»ºç«‹batchçš„æ•°æ®</span></span><br><span class="line"><span class="string">    :param tfrecord_file: tfrecordæ–‡ä»¶</span></span><br><span class="line"><span class="string">    :param parser: parser</span></span><br><span class="line"><span class="string">    :param batch_size: batch sizeçš„å¤§å°</span></span><br><span class="line"><span class="string">    :return: batch dataset</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> is_test:</span><br><span class="line">        dataset=tf.data.TFRecordDataset(tfrecord_file).map(parser).batch(batch_size)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dataset=tf.data.TFRecordDataset(tfrecord_file).map(parser).batch(batch_size)</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br></pre></td></tr></table></figure><p><strong>np.random.choice</strong></p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/ImwaterP/article/details/96282230" target="_blank" rel="noopener">é“¾æ¥</a></p><p><strong>fzfçš„ä½¿ç”¨</strong></p><ul><li>ctrl+rï¼šæ˜¾ç¤ºæ‰€ç”¨å†å²å‘½ä»¤</li><li>ttï¼šå¿«é€Ÿæµè§ˆå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œ(å…·ä½“å¯ä»¥è‡ªå·±è®¾ç½®)</li><li>ctrl+tï¼šå¿«é€Ÿé€‰æ‹©å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶</li><li>cd ** ï¼šæ¨¡ç³ŠæŸ¥æ‰¾æ–‡ä»¶</li></ul><p><strong>tensorflowä¸­è·å–shapeçš„æ–¹æ³•</strong></p><p>åœ¨tensorflow2ä¸­ï¼Œè·å–tensorçš„shapeçš„å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼šé™æ€æ–¹æ³•ä¸åŠ¨æ€æ–¹æ³•</p><p>æ‰€è°“çš„é™æ€æ–¹æ³•æ˜¯ï¼ša.shape.as_list()ï¼Œa.get_shape;</p><p>æ‰€è°“çš„åŠ¨æ€æ–¹æ³•æ˜¯ï¼štf.shape(a).numpy()</p><p>æ¨èä½¿ç”¨tf.shapeæ¥è·å–tensorçš„ç»´åº¦ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨é™æ€æ–¹æ³•æ¥åšçš„è¯ï¼Œå¦‚æœä¹‹åè¦ä½¿ç”¨tf.reshapeè¿™æ ·çš„opï¼Œé‚£ä¹ˆä¼šæŠ¥é”™ã€‚</p><p><strong>tf.slice(a,begin=[],size=[])</strong></p><p>beginçš„ä¸ªæ•°ä¸açš„ç»´åº¦çš„ä¸ªæ•°ç›¸åŒï¼Œè¡¨ç¤ºä»è¿™ä¸ªç»´åº¦ç¬¬å‡ ä¸ªå¼€å§‹ï¼Œsizeè¡¨ç¤ºåœ¨æ¯ä¸€ä¸ªç»´åº¦å–å¾—çš„æ•°ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">data=tf.reshape(tf.range(<span class="number">0</span>,<span class="number">9</span>),shape=[<span class="number">3</span>,<span class="number">3</span>])<span class="comment">#[3,3]</span></span><br><span class="line"><span class="comment"># begin=[1,1]è¡¨ç¤ºç¬¬0ç»´ä»ä¸‹æ ‡ä¸º1çš„å¼€å§‹ç®—èµ·ï¼Œç¬¬1ç»´ä»ä¸‹æ ‡ä¸º1çš„å¼€å§‹ç®—èµ·ï¼›size=[1,2]è¡¨ç¤ºç¬¬0ç»´å–1ä¸ªï¼Œç¬¬1ç»´å–2ä¸ª</span></span><br><span class="line">sliced_data=tf.slice(data,begin=[<span class="number">1</span>,<span class="number">1</span>],size=[<span class="number">1</span>,<span class="number">2</span>]) </span><br><span class="line">print(sliced_data)</span><br><span class="line"><span class="comment"># ç»“æœå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># tf.Tensor([[4 5]], shape=(1, 2), dtype=int32)</span></span><br></pre></td></tr></table></figure><p><strong>tf.gather(tensor,[1,2,3])</strong></p><p>è¡¨ç¤ºä»tensoré‡Œé¢å–å‡ºç´¢å¼•ä¸º[1,2,3]çš„tensorï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">data=tf.reshape(tf.range(<span class="number">0</span>,<span class="number">9</span>),shape=[<span class="number">3</span>,<span class="number">3</span>])</span><br><span class="line">print(data)</span><br><span class="line">e=tf.gather(data,[<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">print(e)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">tf.Tensor(</span></span><br><span class="line"><span class="string">[[0 1 2]</span></span><br><span class="line"><span class="string"> [3 4 5]</span></span><br><span class="line"><span class="string"> [6 7 8]], shape=(3, 3), dtype=int32)</span></span><br><span class="line"><span class="string">tf.Tensor(</span></span><br><span class="line"><span class="string">[[0 1 2]</span></span><br><span class="line"><span class="string"> [3 4 5]], shape=(2, 3), dtype=int32)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> tensorflow2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åˆ†ç±»æ¨¡å‹-DPCNN</title>
      <link href="2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-DPCNN/"/>
      <url>2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-DPCNN/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹æ–‡æœ¬åˆ†ç±»ç³»åˆ—æ¨¡å‹ï¼Œåº”è¯¥ä¼šé™†ç»­æ›´æ–°å‡ ç¯‡æœ‰å…³æ–‡æœ¬åˆ†ç±»æ¨¡å‹çš„åšå®¢ï¼Œå¤§æ¦‚ä¸€å‘¨å†…æ›´æ–°å®Œæˆï¼Œä¹‹åå¼€å§‹åšæ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿ã€‚è™½ç„¶è¿™äº›æ¨¡å‹ç½‘ä¸Šæœ‰å¾ˆå¤šè§£è¯»äº†ï¼Œä½†æ˜¯åªæœ‰è‡ªå·±å†™å‡ºæ¥äº†ï¼Œæ‰ç®—æ˜¯è‡ªå·±çš„å‘€ã€‚æœ¬ç¯‡åšå®¢è®²è§£æœ€ä¸ºç»å…¸çš„DPCNNæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2æ¥è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="DPCNNæ¨¡å‹ç®€ä»‹"><a href="#DPCNNæ¨¡å‹ç®€ä»‹" class="headerlink" title="DPCNNæ¨¡å‹ç®€ä»‹"></a>DPCNNæ¨¡å‹ç®€ä»‹</h2><p>DPCNNæ¨¡å‹æ˜¯å¼ æ½¼åšå£«åœ¨2017å¹´æå‡ºçš„æ¨¡å‹ã€‚è¿™ä¸ªæ¨¡å‹å¯ä»¥è¯´æ˜¯éå¸¸çš„å‡ºè‰²ï¼Œæ˜¯ç¬¬ä¸€ä¸ªword levelçš„æ·±å±‚æ–‡æœ¬åˆ†ç±»å·ç§¯ç¥ç»ç½‘ç»œï¼Œä¼˜ç‚¹åœ¨äºï¼šèƒ½å¤Ÿéå¸¸é•¿çš„æ–‡æœ¬ä¾èµ–çš„åŒæ—¶ï¼Œæ—¶é—´å¤æ‚åº¦åˆç›¸å¯¹è¾ƒä½ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾ã€‚ğŸ‘‡</p><p><img src="/2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-DPCNN/DPCNNæ¨¡å‹.jpg" alt></p><p>DPCNN(æ·±åº¦é‡‘å­—å¡”å·ç§¯ç¥ç»ç½‘ç»œ)ä¹‹æ‰€ä»¥è¢«æå‡ºï¼Œä¸»è¦æœ‰è¿™ä¹ˆå‡ ç‚¹ï¼š1.CNNæ¯”RNNæ›´æœ‰ä¼˜åŠ¿ï¼Œè¿™åœ¨äºCNNè‰¯å¥½çš„å¹¶è¡Œè®¡ç®—æ•ˆç‡ï¼›2.ä½œè€…å‘ç°word levelçš„CNNæ¯”æ·±å±‚çš„character level CNNæ•ˆæœè¦æ›´å¥½ï¼Œæ‰€ä»¥word levelçš„CNNæœ‰è¿›ä¸€æ­¥çš„æŒ–æ˜çš„æ½œåŠ›ï¼›3.ä½†æ˜¯å¦‚æœåªæ˜¯å•çº¯çš„åŠ æ·±ç½‘ç»œï¼Œå¾—åˆ°çš„æ•ˆæœåè€Œä¸å¥½ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè®¾è®¡ï¼Œå°±æå‡ºäº†DPCNNã€‚</p><p>æ•´ä¸ªç½‘ç»œæ¶æ„è¿˜æ˜¯æŒºå¥½æ‡‚çš„ï¼Œä¸‹é¢ä¸»è¦ä»‹ç»ä¸€ä¸‹DPCNNæ¨¡å‹å‡ ä¸ªé‡è¦çš„éƒ¨åˆ†ã€‚</p><p><strong>text region embedding</strong></p><p>æ­£å¦‚å­—é¢æ„æ€ï¼Œtext region embeddingæ˜¯é’ˆå¯¹ä¸€ä¸ªæ–‡æœ¬åŒºåŸŸè¿›è¡Œå·ç§¯æ“ä½œï¼Œå¾—åˆ°çš„embeddingã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ç­‰é•¿å·ç§¯ã€‚ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç­‰é•¿å·ç§¯å‘¢ï¼ŸåŸå› åœ¨äºï¼š<strong>é€šè¿‡ç­‰é•¿å·ç§¯ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå…‹æœtextCNNæ¨¡å‹ä¸­ç¼ºç‚¹ï¼Œä»è€Œèƒ½å¤Ÿæ•è·é•¿è·ç¦»ä¿¡æ¯ï¼Œä»è€Œæé«˜embeddingçš„è¡¨ç¤ºçš„ä¸°å¯Œæ€§ã€‚</strong></p><p><strong>å›ºå®šfeature mapçš„æ•°é‡</strong></p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼ŸåŸå› åœ¨äºï¼šé€šè¿‡å›ºå®šfeature mapçš„æ•°é‡ï¼Œå®é™…ä¸Šå°±å¯ä»¥å¾—åˆ°æ›´é«˜å±‚æ¬¡çš„è¯­ä¹‰ä¿¡æ¯ã€‚</p><p><strong>1/2æ± åŒ–å±‚</strong></p><p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ± åŒ–å±‚ï¼Œå°±å¯ä»¥å°†æ¨¡å‹æ„Ÿå—æ–‡æœ¬çš„èŒƒå›´æ‰©å¤§ä¸€å€ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œä½¿ç”¨çš„æ˜¯stride=2ï¼Œsize=3çš„æ± åŒ–å±‚ã€‚</p><p><strong>æ®‹å·®è¿æ¥</strong></p><p>å½“ç„¶äº†ï¼Œéå¸¸æ·±çš„ç½‘ç»œï¼Œéå¸¸å®¹æ˜“å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚åœ¨DPCNNä¸­ï¼Œå€Ÿé‰´äº†ResNetçš„æ€æƒ³ï¼Œä½¿ç”¨æ®‹å·®è¿æ¥ã€‚</p><h2 id="DPCNNæ¨¡å‹å®ç°"><a href="#DPCNNæ¨¡å‹å®ç°" class="headerlink" title="DPCNNæ¨¡å‹å®ç°"></a>DPCNNæ¨¡å‹å®ç°</h2><p>æš‚æ— ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li>Deep Pyramid Convolutional Neural Networks for Text Categorization</li><li><a href="https://zhuanlan.zhihu.com/p/35457093" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/35457093</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åˆ†ç±»æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> DPCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åˆ†ç±»æ¨¡å‹-RCNN</title>
      <link href="2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-RCNN/"/>
      <url>2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-RCNN/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹æ–‡æœ¬åˆ†ç±»ç³»åˆ—æ¨¡å‹ï¼Œåº”è¯¥ä¼šé™†ç»­æ›´æ–°å‡ ç¯‡æœ‰å…³æ–‡æœ¬åˆ†ç±»æ¨¡å‹çš„åšå®¢ï¼Œå¤§æ¦‚ä¸€å‘¨å†…æ›´æ–°å®Œæˆï¼Œä¹‹åå¼€å§‹åšæ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿ï¼Œè™½ç„¶è¿™äº›æ¨¡å‹ç½‘ä¸Šæœ‰å¾ˆå¤šè§£è¯»äº†ï¼Œä½†æ˜¯åªæœ‰è‡ªå·±å†™å‡ºæ¥äº†ï¼Œæ‰ç®—æ˜¯è‡ªå·±çš„å‘€ã€‚æœ¬ç¯‡åšå®¢è®²è§£æœ€ä¸ºç»å…¸çš„RCNNæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2æ¥è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="RCNNæ¨¡å‹ç®€ä»‹"><a href="#RCNNæ¨¡å‹ç®€ä»‹" class="headerlink" title="RCNNæ¨¡å‹ç®€ä»‹"></a>RCNNæ¨¡å‹ç®€ä»‹</h2><p>RCNNæ˜¯2015å¹´ç”±ä¸­ç§‘é™¢æ‰€æå‡ºçš„ç”¨äºæ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹ã€‚ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šRCNNçš„ä¼˜ç‚¹åœ¨äºï¼šèƒ½å¤Ÿå°½å¯èƒ½çš„é€šè¿‡æ•æ‰ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥è¡¨ç¤ºå•è¯ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿä»¥è¾ƒä½çš„æ—¶é—´å¤æ‚åº¦å®Œæˆè®­ç»ƒã€‚æ¨¡å‹æ•´ä½“æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä¸Šå›¾å§ã€‚ğŸ‘‡</p><p><img src="/2020/04/25/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-RCNN/RCNNæ¨¡å‹.jpg" alt></p><ul><li>æ¨¡å‹çš„ç¬¬ä¸€å±‚æ˜¯ä¸€ä¸ªbiRNNæ¶æ„ï¼Œå…¶ä¸­$c_l(w_3)$è¡¨ç¤ºå•è¯$w_3$çš„å·¦ä¾§æ‰€æœ‰çš„ä¸Šä¸‹æ–‡çš„å‘é‡åŒ–è¡¨ç¤ºï¼›$c_r(w_3)$è¡¨ç¤ºå•è¯$w_3$çš„å³ä¾§æ‰€æœ‰çš„ä¸Šä¸‹æ–‡çš„å‘é‡åŒ–è¡¨ç¤ºã€‚$e(w_3)$è¡¨ç¤ºå•è¯$w_3$çš„è¯å‘é‡ã€‚é‚£ä¹ˆï¼Œç¬¬3ä¸ªä½ç½®çš„å‘é‡è¯è¡¨ç¤ºæ˜¯ä¸‰è€…çš„concatenateï¼Œå³ï¼š$x_3=[c_l(w_3),e(w_3),c_r(w_3)]$ã€‚è¿™æ ·ï¼Œèƒ½å¤Ÿå……åˆ†åœ°åˆ©ç”¨å•è¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°è¡¨è¾¾å•è¯çš„åœ¨ä¸Šä¸‹æ–‡çš„å«ä¹‰ã€‚</li><li>æ¨¡å‹çš„ç¬¬äºŒå±‚ä½¿ç”¨æ¿€æ´»å‡½æ•°tanhï¼Œæ¥å¯¹å¾—åˆ°çš„$x_i$ï¼Œè¿›è¡Œè½¬æ¢ã€‚é‚£ä¹ˆï¼Œç¬¬äºŒå±‚çš„è¾“å‡ºæ˜¯ï¼š$y^{(2)}_i=tanh(W^{(2)}x_i+b^{(2)})$ã€‚</li><li>æ¨¡å‹çš„ç¬¬ä¸‰å±‚æ˜¯æœ€å¤§æ± åŒ–å±‚ã€‚ç”¨å…¬å¼æ¥è¡¨ç¤ºå°±æ˜¯ï¼š$y^{(3)}=max_{i=1}^{n}y_{i}^{(2)}$ã€‚</li><li>æ¨¡å‹çš„æœ€åä¸€å±‚å°±æ˜¯softmaxå±‚ã€‚è¿™ä¸ªæ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚</li></ul><p>è®ºæ–‡æåˆ°çš„æ¨¡å‹è®­ç»ƒçš„trickï¼šä½¿ç”¨SGDã€ä½¿ç”¨word2vecå¾—åˆ°çš„è¯å‘é‡æ¥åˆå§‹åŒ–ã€å‡åŒ€åˆ†å¸ƒåˆå§‹åŒ–æ‰€æœ‰å‚æ•°ã€‚</p><p>æ•´ä¸ªæ¨¡å‹å°±æ˜¯è¿™æ ·ï¼ŒæŒºç®€å•çš„ï¼Œä»ç°åœ¨çš„è§’åº¦çœ‹ï¼Œåˆ›æ–°æ€§çœŸçš„ä¸å¤§ï¼Œä¸è¿‡åœ¨å½“æ—¶åº”è¯¥æœ‰åˆ›æ–°æ€§çš„å§ã€‚</p><h2 id="RCNNæ¨¡å‹å®ç°"><a href="#RCNNæ¨¡å‹å®ç°" class="headerlink" title="RCNNæ¨¡å‹å®ç°"></a>RCNNæ¨¡å‹å®ç°</h2><p>æš‚æ— ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Recurrent Convolutional Neural Networks for Text Classiï¬cation</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åˆ†ç±»æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> RCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ–‡æœ¬åˆ†ç±»æ¨¡å‹-textCNN</title>
      <link href="2020/04/24/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-textCNN/"/>
      <url>2020/04/24/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-textCNN/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹æ–‡æœ¬åˆ†ç±»ç³»åˆ—æ¨¡å‹ï¼Œåº”è¯¥ä¼šé™†ç»­æ›´æ–°å‡ ç¯‡æœ‰å…³æ–‡æœ¬åˆ†ç±»æ¨¡å‹çš„åšå®¢ï¼Œå¤§æ¦‚ä¸€å‘¨å†…æ›´æ–°å®Œæˆï¼Œä¹‹åå¼€å§‹åšæ–‡æœ¬åŒ¹é…çš„ä¸œè¥¿ï¼Œè™½ç„¶è¿™äº›æ¨¡å‹ç½‘ä¸Šæœ‰å¾ˆå¤šè§£è¯»äº†ï¼Œä½†æ˜¯åªæœ‰è‡ªå·±å†™å‡ºæ¥äº†ï¼Œæ‰ç®—æ˜¯è‡ªå·±çš„å‘€ã€‚æœ¬ç¯‡åšå®¢è®²è§£æœ€ä¸ºç»å…¸çš„textCNNæ¨¡å‹ï¼Œå¹¶é‡‡ç”¨tensorflow2æ¥è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="textCNNæ¨¡å‹ç®€ä»‹"><a href="#textCNNæ¨¡å‹ç®€ä»‹" class="headerlink" title="textCNNæ¨¡å‹ç®€ä»‹"></a>textCNNæ¨¡å‹ç®€ä»‹</h2><p>textCNNæ˜¯2014å¹´æ‰€æå‡ºçš„ä¸€ä¸ªæ¨¡å‹ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸æ—©äº†ã€‚å®ƒçš„æ¨¡å‹ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥æ”¾å›¾ğŸ‘‡ã€‚</p><p><img src="/2020/04/24/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-textCNN/textCNNæ¨¡å‹ç»“æ„.jpg" alt></p><ul><li>é¦–å…ˆæ˜¯è¾“å…¥å±‚ï¼Œæ˜¯å•è¯çš„embeddingå¾—åˆ°çš„çŸ©é˜µï¼Œç»´åº¦æ˜¯(batch_size,seq_length,embedding_size)ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œä½œè€…å®éªŒäº†å¥½å‡ ç§ç­–ç•¥ï¼š1.<strong>CNN-rand</strong>ï¼šå¯¹å•è¯çš„è¯å‘é‡éšæœºåˆå§‹åŒ–ï¼›2.<strong>CNN-static</strong>ï¼šä½¿ç”¨word2vecå¾—åˆ°çš„word embeddingï¼Œå¹¶ä¸”åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸æ›´æ–°embeddingï¼›3.<strong>CNN-non-static</strong>ï¼šä½¿ç”¨word2vecå¾—åˆ°çš„word embeddingï¼Œä½†æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ›´æ–°word embeddingï¼›4.<strong>CNN-multichannels</strong>ï¼šä½¿ç”¨ä¸¤ä¸ªchannelï¼Œä¸¤ä¸ªchanneléƒ½æ˜¯ä½¿ç”¨word2vecä½¿ç”¨çš„word embeddingï¼Œä½†æ˜¯ä¸€ä¸ªä¸éšç€è®­ç»ƒè¿‡ç¨‹æ›´æ–°ï¼Œä¸€ä¸ªéšç€è®­ç»ƒè®­ç»ƒè¿‡ç¨‹æ›´æ–°ã€‚(è¿™æ ·åšçš„ç›®çš„ä¸»è¦æ˜¯é˜²æ­¢è¿‡æ‹Ÿåˆ)ç»“æœè¯æ˜ï¼Œç¬¬ä¸‰ç§æ•ˆæœæœ€å¥½ã€‚</li><li>ç„¶åæ˜¯å·ç§¯å±‚ï¼Œç±»ä¼¼äºn-gramï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸ï¼Œåœ¨è®ºæ–‡ä¸­ï¼Œä½¿ç”¨(3,4,5)ä¸‰ç§å·ç§¯æ ¸ï¼Œæ¿€æ´»å‡½æ•°ä¸ºreluï¼Œæ¯ä¸€ç§å·ç§¯æ ¸éƒ½æœ‰100ä¸ªï¼Œå³æ¯ä¸€ç§å·ç§¯æ ¸å¾—åˆ°çš„feature mapéƒ½æœ‰100ä¸ªã€‚</li><li>ä¹‹åæ˜¯å…¨å±€æœ€å¤§æ± åŒ–å±‚(max-over-time pooling layer)ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ¯ä¸€ä¸ªfeature mapï¼Œæˆ‘ä»¬ä»ä¸­å¾—åˆ°ä¸€ä¸ªæ•°å€¼æœ€å¤§çš„featureã€‚è­¬å¦‚ï¼š3ç§å·ç§¯æ ¸ï¼Œæ¯ç§100ä¸ªï¼Œé‚£ä¹ˆå¾—åˆ°300ä¸ªfeature map(3*100)ï¼Œç»è¿‡max-over-time poolingä¹‹åï¼Œå¾—åˆ°çš„ç»“æœæ˜¯300ç»´çš„å‘é‡ã€‚</li><li>æœ€åæ˜¯ä¸€ä¸ªsoftmaxå±‚ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œå¯¹ç»è¿‡å…¨å±€æœ€å¤§æ± åŒ–å±‚ä¹‹åçš„è¾“å‡ºï¼Œè¿›è¡Œäº†dropoutæ“ä½œï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</li></ul><p>è¿™å°±æ˜¯æ•´ä¸ªtextCNNæ¨¡å‹ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸ç®€å•çš„æ€è·¯äº†ï½</p><p>ï¼ˆæ”¾ä¸€å¼ å·ç§¯æ“ä½œçš„è¿‡ç¨‹å›¾ï½<a href="https://blog.csdn.net/The_lastest/article/details/81460424" target="_blank" rel="noopener">å›¾ç‰‡æ¥æº</a>ï¼‰</p><p><img src="/2020/04/24/NLP-%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B-textCNN/å·ç§¯è®¡ç®—è¿‡ç¨‹.jpg" style="zoom: 50%;"></p><h2 id="textCNNæ¨¡å‹å®ç°"><a href="#textCNNæ¨¡å‹å®ç°" class="headerlink" title="textCNNæ¨¡å‹å®ç°"></a>textCNNæ¨¡å‹å®ç°</h2><p>æš‚æ— ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>Convolutional Neural Networks for Sentence Classiï¬cation</p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> æ–‡æœ¬åˆ†ç±»æ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> tensorflow2 </tag>
            
            <tag> textCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++|åå¤§æ’åºç®—æ³•C++å®ç°</title>
      <link href="2020/03/10/C-%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95C-%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/03/10/C-%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95C-%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>åå¤§æ’åºç®—æ³•å®åœ¨æ˜¯å¤ªè¿‡äºç»å…¸äº†ï¼Œå› æ­¤ï¼Œè¿™ç¯‡åšå®¢å°†å¯¹åå¤§æ’åºç®—æ³•è¿›è¡Œæ€»ç»“ï¼Œä»¥C++å®ç°ä¸ºä¸»ã€‚</p><a id="more"></a><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(nlogn)ï¼›ç©ºé—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚</strong>ä¸ç¨³å®šæ’åºã€‚nå¤§çš„æ—¶å€™ï¼Œæ€§èƒ½æ›´åŠ ä¼˜è¶Šã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ’åˆ†çš„è¿‡ç¨‹ï¼Œå› ä¸ºå¿«æ’æ˜¯åˆ†æ²»æ€æƒ³çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ’åˆ†ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; vec,<span class="keyword">int</span> start,<span class="keyword">int</span> <span class="built_in">end</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">point</span>=vec[start];</span><br><span class="line"><span class="keyword">int</span> i=start;</span><br><span class="line"><span class="keyword">int</span> j=<span class="built_in">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line"><span class="keyword">while</span>(i&lt;j &amp;&amp; vec[j]&gt;=<span class="built_in">point</span>) j--;</span><br><span class="line">vec[i]=vec[j];</span><br><span class="line"><span class="keyword">while</span>(i&lt;j &amp;&amp; vec[i]&lt;<span class="built_in">point</span>) i++;</span><br><span class="line">vec[j]=vec[i];</span><br><span class="line">&#125;</span><br><span class="line">vec[i]=<span class="built_in">point</span>;</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¿«æ’çš„ç»“æ„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quick_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;vec,<span class="keyword">int</span> start,<span class="keyword">int</span> <span class="built_in">end</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(start&gt;<span class="built_in">end</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">int</span> j=partition(vec,start,<span class="built_in">end</span>);</span><br><span class="line">quick_sort(vec,start,j<span class="number">-1</span>);</span><br><span class="line">quick_sort(vec,j+<span class="number">1</span>,<span class="built_in">end</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">quick_sort(vec,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n\^2)ï¼›ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚</strong>ç¨³å®šæ’åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubble_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;  &amp;vec)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">size</span>=vec.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">size</span><span class="number">-1</span>;i++)&#123;<span class="comment">//è¿™ä¸€è½®å¾ªç¯æ˜¯è¦æ¯”è¾ƒçš„å…ƒç´ ï¼Œä¹Ÿå°±ç¡è¿˜æ²¡æœ‰æ’å¥½åºçš„å…ƒç´ ï¼Œæœ€åˆæœ‰nä¸ªï¼Œä½†æ˜¯å…¶å®åªè¦æ¯”è¾ƒn-1ä¸ªå…ƒç´ å°±å¯ä»¥ï¼Œå› ä¸ºæœ€åä¸€ä¸ªå…ƒç´ ä¸ç”¨æ¯”è¾ƒã€‚</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="built_in">size</span>-i<span class="number">-1</span>;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vec[j]&gt;vec[j+<span class="number">1</span>]) swap(vec[j],vec[j+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bubble_sort(vec);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;vec[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(nlogn)ï¼›ç©ºé—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚</strong>ç¨³å®šæ’åºã€‚nå¤§çš„æ—¶å€™ï¼Œæ€§èƒ½æ›´åŠ ä¼˜è¶Šã€‚</p>  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; vec,<span class="keyword">int</span> low,<span class="keyword">int</span> mid,<span class="keyword">int</span> high)</span></span>&#123;</span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">temp</span><span class="params">(high-low+<span class="number">1</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="keyword">int</span> left_low=low;</span><br><span class="line"><span class="keyword">int</span> left_high=mid;</span><br><span class="line"><span class="keyword">int</span> right_low=mid+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> right_high=high;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;left_low&lt;=left_high &amp;&amp; right_low&lt;=right_high;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vec[left_low]&lt;=vec[right_low])&#123;</span><br><span class="line">temp[i]=vec[left_low];</span><br><span class="line">left_low++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">temp[i]=vec[right_low];</span><br><span class="line">right_low++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(left_low&lt;=left_high)&#123;</span><br><span class="line"><span class="keyword">while</span>(left_low&lt;=left_high)&#123;</span><br><span class="line">temp[i]=vec[left_low];</span><br><span class="line">i++;</span><br><span class="line">left_low++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(right_low&lt;=right_high)&#123;</span><br><span class="line"><span class="keyword">while</span>(right_low&lt;=right_high)&#123;</span><br><span class="line">temp[i]=vec[right_low];</span><br><span class="line">i++;</span><br><span class="line">right_low++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;(high-low+<span class="number">1</span>);j++)&#123;</span><br><span class="line">vec[low+j]=temp[j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;vec,<span class="keyword">int</span> start,<span class="keyword">int</span> <span class="built_in">end</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(start&gt;=<span class="built_in">end</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">int</span> mid=start+(<span class="built_in">end</span>-start)/<span class="number">2</span>;</span><br><span class="line">merge_sort(vec,start,mid);</span><br><span class="line">merge_sort(vec,mid+<span class="number">1</span>,<span class="built_in">end</span>);</span><br><span class="line">merge(vec,start,mid,<span class="built_in">end</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">merge_sort(vec,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span>  <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¦å»ºæˆæœ€å°å †ï¼Œé¦–å…ˆæ˜¯è¦å»ºæˆæœ€å¤§å †ï¼Œç„¶åè°ƒæ•´ä¸ºæœ€å°å †ï¼</span></span><br><span class="line"><span class="comment">//è°ƒæ•´æˆæœ€å¤§å †</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">adjust_heap</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;vec,<span class="keyword">int</span> <span class="built_in">size</span>,<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> left=<span class="number">2</span>*index+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> right=<span class="number">2</span>*index+<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max_index=index;</span><br><span class="line"><span class="keyword">if</span>(left&lt;<span class="built_in">size</span> &amp;&amp; vec[left]&gt;vec[max_index]) max_index=left;</span><br><span class="line"><span class="keyword">if</span>(right&lt;<span class="built_in">size</span> &amp;&amp; vec[right]&gt;vec[max_index]) max_index=right;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(max_index!=index)&#123;</span><br><span class="line">swap(vec[max_index],vec[index]);</span><br><span class="line">adjust_heap(vec,<span class="built_in">size</span>,max_index);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heap_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;vec,<span class="keyword">int</span> <span class="built_in">size</span>)</span></span>&#123;</span><br><span class="line">  <span class="comment">//å»ºç«‹å †</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="built_in">size</span>/<span class="number">2</span><span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">adjust_heap(vec,<span class="built_in">size</span>,i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è°ƒæ•´ä¸ºæœ€å°å †</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="built_in">size</span><span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">swap(vec[<span class="number">0</span>],vec[i]);</span><br><span class="line">adjust_heap(vec,i,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">heap_sort(vec,vec.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h2><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n+k)ï¼›ç©ºé—´å¤æ‚åº¦ä¸ºO(n+k)ã€‚</strong>ç¨³å®šæ’åºï¼Œå…¶ä¸­ï¼Œkè¡¨ç¤ºåºåˆ—ä¸­æœ€å¤§å€¼ã€‚æ‰€ä»¥ï¼Œè®¡æ•°æ’åºä½¿ç”¨ä¸æœ€å¤§å€¼ä¸æ˜¯å¾ˆå¤§çš„åºåˆ—ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">count_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; vec)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(vec.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> maxvalue=<span class="number">0</span>,minvalue=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vec.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">maxvalue=<span class="built_in">max</span>(maxvalue,vec[i]);</span><br><span class="line">minvalue=<span class="built_in">min</span>(minvalue,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> range=maxvalue-minvalue+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">temp</span><span class="params">(range,<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vec.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">temp[vec[i]-minvalue]+=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;range;i++)&#123;</span><br><span class="line"><span class="keyword">while</span>(temp[i]!=<span class="number">0</span>)&#123;</span><br><span class="line">vec[j]=i+minvalue;</span><br><span class="line">temp[i]--;</span><br><span class="line">j++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">count_sort(vec);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n^2)ï¼›ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚</strong>ä¸ç¨³å®šæ’åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ’åºä¸å†’æ³¡æ’åºéå¸¸çš„ç±»ä¼¼ï¼Œé€‰æ‹©æ’åºæ˜¯é€‰æ‹©ä¸€ä¸ªæœ€å°çš„æ”¾åœ¨åºåˆ—å‰é¢ï¼Œè€Œå†’æ³¡æ’åºæ˜¯é€‰æ‹©ä¸€ä¸ªæœ€å¤§çš„å…ƒç´ æ”¾åœ¨åºåˆ—åé¢ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">select_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;vec)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;vec.<span class="built_in">size</span>()<span class="number">-1</span>;i++)&#123;<span class="comment">//åŒæ ·ï¼Œåªç”¨æ¯”è¾ƒn-1ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;vec.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vec[j]&lt;vec[i]) swap(vec[j],vec[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">select_sort(vec);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h2><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n\^2)ï¼›ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚</strong>ç¨³å®šæ’åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert_sort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;vec)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(vec.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;vec.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line"><span class="keyword">int</span> temp=vec[i];</span><br><span class="line"><span class="keyword">int</span> j=i;</span><br><span class="line"><span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; temp&lt;vec[j<span class="number">-1</span>])&#123;</span><br><span class="line">vec[j]=vec[j<span class="number">-1</span>];</span><br><span class="line">j--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vec[j]=temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt; vec;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">vec.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">insert_sort(vec);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,vec[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å„å¤§ç®—æ³•æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦å¯¹æ¯”"><a href="#å„å¤§ç®—æ³•æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦å¯¹æ¯”" class="headerlink" title="å„å¤§ç®—æ³•æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦å¯¹æ¯”"></a>å„å¤§ç®—æ³•æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦å¯¹æ¯”</h2><p><img src="/2020/03/10/C-%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95C-%E5%AE%9E%E7%8E%B0/0.jpg" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summarization of Interview Problems and Solutions</title>
      <link href="2020/03/07/Summarization-of-Interview-Problems-Solutions/"/>
      <url>2020/03/07/Summarization-of-Interview-Problems-Solutions/</url>
      
        <content type="html"><![CDATA[<p>This blog is aimed at collecting interview problems and solutions through nowcoder,books and so on.   So, I will update this article usually.  Best luck for me and everyone to find a satisfactory intern!ğŸ¤©</p><a id="more"></a><h2 id="Machine-Learning"><a href="#Machine-Learning" class="headerlink" title="Machine Learning"></a>Machine Learning</h2><p><strong>ByteDance AI LAB</strong></p><ul><li>CRFè®²ä¸€ä¸‹ï¼Ÿ(åŸç†ä¸æ¨å¯¼)</li></ul><p>ç­”ï¼šçœ‹è‡ªå·±å†™çš„å…³äºCRFçš„é‚£ç¯‡åšæ–‡ã€‚ä»HMM-&gt;MEMM-&gt;CRFã€‚</p><ul><li>ROCæ›²çº¿ï¼ŸAUCçš„è®¡ç®—ï¼Ÿ</li></ul><p>ç­”ï¼š</p><ul><li>bagging vs boosting?</li></ul><p>ç­”ï¼š1. baggingå«åšé‡é‡‡æ ·ï¼Œè­¬å¦‚è¯´ï¼Œç»™å®šä¸€ä¸ªå«æœ‰mä¸ªæ ·æœ¬çš„è®­ç»ƒé›†ï¼Œæˆ‘ä»¬ä»ä¸­éšæœºæŠ½å–ä¸€ä¸ªæ ·æœ¬ï¼Œç„¶åå†æ”¾å›ï¼Œä¾æ¬¡å¾ªç¯ï¼Œç›´åˆ°å¾—åˆ°Tä¸ªå«æœ‰mä¸ªå…ƒç´ çš„è®­ç»ƒé›†ï¼Œç„¶åï¼Œæˆ‘ä»¬å°±åœ¨è¿™Tä¸ªè®­ç»ƒé›†ä¸­è®­ç»ƒTä¸ªæ¨¡å‹ï¼Œæœ€ååœ¨ç•¸å½¢æ¨¡å‹èåˆã€‚baggingé™ä½çš„æ˜¯æ–¹å·®ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨RFä¸­ï¼Œæˆ‘ä»¬ç§å­è¿›è¡Œå†³ç­–æ ‘åˆ†è£‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æ˜¯ä»æ‰€æœ‰å±æ€§ä¸­é€‰å–æœ€ä¼˜å±æ€§ï¼Œè€Œæ˜¯ä»ä¸€ä¸ªå±æ€§å­é›†ä¸­é€‰å–æœ€ä¼˜å±æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†é™ä½å„ä¸ªå¼±åˆ†ç±»å™¨ä¹‹é—´çš„ç›¸å…³æ€§ã€‚é‡é‡‡æ ·ä¹Ÿæ˜¯ä¸ºäº†é™ä½å„ä¸ªå¼±åˆ†ç±»å™¨ä¹‹é—´çš„ç›¸å…³æ€§ã€‚</p><p>â€‹        2. boostingæ˜¯æå‡æ–¹æ³•ã€‚å®ƒçš„æ€è·¯æ˜¯æ¯æ¬¡ä¸Šä¸€æ¬¡çš„æ®‹å·®ä½œä¸ºä¸‹ä¸€æ¬¡çš„è¾“å…¥ã€‚å®ƒå…³æ³¨çš„æ˜¯é™ä½åå·®ã€‚å› ä¸ºï¼Œå„ä¸ªå¼±åˆ†ç±»å™¨ä¹‹é—´å…·æœ‰å¼ºç›¸å…³æ€§ã€‚</p><ul><li>HMMè®²ä¸€ä¸‹ï¼ŸåŸç†ä¸æ¨å¯¼</li><li>GBDT VS XGBoost</li></ul><ol><li><p>GBDTçš„ä¸€ç§ç®—æ³•ï¼Œè€ŒXGBOOstæ˜¯å¯¹GBDTçš„ä¸€ç§å¾ˆå¥½çš„å·¥ç¨‹åŒ–çš„å®ç°ã€‚</p></li><li><p>åœ¨ä»¥CARTä¸ºåŸºæœ¬åˆ†ç±»å™¨çš„æ—¶å€™ï¼ŒXGBoostä¸­åŠ å…¥äº†æ­£åˆ™åŒ–é¡¹ï¼Œæ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ï¼Œé˜²æ­¢æ¨¡å‹å‡ºç°è¿‡æ‹Ÿåˆï¼Œè€ŒGBDTåˆ™æ²¡æœ‰ã€‚</p></li><li><p>XGboostä¸­å¯¹cost functionä½¿ç”¨äºŒé˜¶çš„æ³°å‹’å±•å¼€ï¼Œèƒ½å¤ŸåŒæ—¶ä½¿ç”¨ä¸€é˜¶ä¸äºŒé˜¶ä¿¡æ¯ï¼Œè€ŒGBDTå€¼ä½¿ç”¨ä¸€é˜¶ä¿¡æ¯ã€‚</p></li><li><p>XGBoostä¸­ï¼Œå¢åŠ äº†å¯¹ç¼ºå¤±å€¼çš„å¤„ç†ï¼ŒGBDTä¸­æ²¡æœ‰ã€‚</p></li><li><p>XGBoostä¸­æ”¯æŒå¤šç§åŸºåˆ†ç±»å™¨ï¼Œè­¬å¦‚ï¼šgbtreeã€dartã€linearï¼Œè€ŒGBDTåªé‡‡ç”¨CARTã€‚</p></li></ol><p>è§£ç­”ï¼š<a href="https://blog.csdn.net/qq_28031525/article/details/70207918" target="_blank" rel="noopener">https://blog.csdn.net/qq_28031525/article/details/70207918</a></p><h2 id="Natural-Language-Processing"><a href="#Natural-Language-Processing" class="headerlink" title="Natural Language Processing"></a>Natural Language Processing</h2><p><strong>ByteDance AI LAB</strong></p><ul><li>å•å‘åŒå‘ BERT ä¸BiLSTM æœ‰ä»€ä¹ˆä¸åŒï¼Ÿå…¶å®é—®çš„å°±æ˜¯ELMoä¸BERTçš„åŒºåˆ«ã€‚</li><li>å¦‚ä½•è§£å†³æ¢¯åº¦æ¶ˆå¤±å¼¥æ•£ ï¼Ÿ</li></ul><p>ç­”ï¼šåœ¨ä¸€èˆ¬çš„NNä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯åœ¨éšæœºåˆå§‹åŒ–å‚æ•°çš„æ—¶å€™ï¼Œéœ€è¦ç•™æ„ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w=np.random.randn(shape)*np.sqrt(<span class="number">1</span>/n)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå«åšXavieråˆå§‹åŒ–ã€‚å…¶ä¸­ï¼Œnè¡¨ç¤ºå‰ä¸€å±‚çš„ç¥ç»å…ƒçš„æ•°ç›®ã€‚å½“ç„¶è¿˜å¯ä»¥æ›¿æ¢æ¿€æ´»å‡½æ•°ï¼Œè­¬å¦‚ä½¿ç”¨reluã€‚è¿˜æœ‰BNï¼Œæ­£åˆ™åŒ–ç­‰ç­‰ã€‚</p><p>åœ¨RNNä¸­ï¼Œä½¿ç”¨LSTMæˆ–è€…GRUå•å…ƒæ¥ä»£æ›¿æ™®é€šçš„RNNå•å…ƒï¼Œè§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚å¯¹äºæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¢¯åº¦è£å‰ªæ¥è§£å†³ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å½“æ¢¯åº¦è¶…è¿‡æŸä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹é½è¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œä½¿å…¶æ´»åœ¨æŸä¸ªåŒºé—´èŒƒå›´å†…ã€‚åœ¨tfä¸­ï¼Œä½¿ç”¨tf.clip_by_norm().</p><ul><li>(é‡è¦)wordembeddingæœ‰å“ªäº›ï¼Ÿï¼ˆå‘å±•å²ä»¥åŠword2vecçš„ä¸¤ç§è®­ç»ƒæ–¹æ³•ä¸ä¸¤ç§åŠ é€Ÿæ–¹æ³•ï¼‰</li><li>transformerè®²ä¸€ä¸‹ï¼Ÿï¼ˆKQV positionï¼‰</li><li>äº¤å‰ç†µlosså…¬å¼ï¼Ÿ</li><li>pytorchçš„ä»£ç æµç¨‹ï¼ˆæˆ‘æ˜¯è¿™æ ·å›ç­”çš„ï¼šé¢„å¤„ç†æ•°æ®/è¯è¡¨-å†™å¥½æ¨¡å‹-å®šä¹‰æŸå¤±å’Œä¼˜åŒ–å™¨-è®­ç»ƒ-æµ‹è¯•ï¼‰</li><li>Dropoutçš„åŸç†ï¼Ÿ</li><li>sgdä¸adamçš„åŒºåˆ«ï¼Ÿ</li><li>L1L2æ­£åˆ™åŒ–ï¼Ÿ</li></ul><p>ç­”ï¼šL0æ­£åˆ™ï¼Œè¡¨ç¤ºæ˜¯ä¸æ˜¯0çš„å‚æ•°çš„ä¸ªæ•°ï¼Œå…¬å¼ï¼š$\sum_{j=1,w_j\not=0}^{m}w_j^0$ï¼›L1æ­£åˆ™ï¼Œè¡¨ç¤ºæ‰€æœ‰å‚æ•°çš„ä¸€èŒƒæ•°çš„å’Œï¼Œå…¬å¼ï¼š$\sum_{j=1}^{m}|w_j|$ï¼›L2å¼ æ­£åˆ™ï¼Œè¡¨ç¤ºæ‰€æœ‰å‚æ•°çš„äºŒèŒƒæ•°çš„å¹³æ–¹ï¼Œå…¬å¼ï¼š$\sum_{j=1}^{m}|m_j|^2$ã€‚è¿™äº›æ­£åˆ™é¡¹å®é™…ä¸Šéƒ½æ˜¯åˆ°åŸç‚¹çš„é©¬å¼è·ç¦»($L(x_i,x_j)=\sum_{k=1}^{m}{(\sqrt {(x_i^{(k)}-x_j^{(k)})^2})}^p$)ã€‚<a href="https://zhuanlan.zhihu.com/p/22505062" target="_blank" rel="noopener">æ­£åˆ™é¡¹</a></p><p>L1ä¸ºä»€ä¹ˆæ¯”L2æ›´å®¹æ˜“è·å¾—ç¨€ç–è§£ï¼Ÿï¼ˆå¯ä»¥ä»æ¢¯åº¦çš„è§’åº¦æ¥çœ‹ï¼‰<a href="https://www.zhihu.com/question/37096933?sort=created" target="_blank" rel="noopener">l1æ­£åˆ™åŒ–</a></p><p><img src="/2020/03/07/Summarization-of-Interview-Problems-Solutions/l1l2.jpg" alt></p><ul><li>è®²ä¸€ä¸‹BERTï¼Ÿ</li><li>SoftMax + CrossEntropyçš„åå‘æ¢¯åº¦æ±‚å¯¼</li><li>sentence embedding vs docment embedding?</li><li>Tf-idf?</li><li>LRä¸­ä¸ºä»€ä¹ˆä½¿ç”¨CEï¼Œè€Œä¸æ˜¯MSEï¼Ÿ</li></ul><p>ç­”ï¼šå¦‚æœä½¿ç”¨MSEçš„è¯ï¼Œå¾ˆå®¹æ˜“å‡ºç°æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚<a href="https://www.jianshu.com/p/5d13bcd9d990" target="_blank" rel="noopener">LRä¸­çš„MSEä¸CEé€‰æ‹©é—®é¢˜</a></p><ul><li>Sigmoidï¼ŒTanhï¼ŒReluç­‰æ¿€æ´»å‡½æ•°çš„ä¼˜ç¼ºç‚¹</li></ul><p>ç­”ï¼š<strong>sigmoidå‡½æ•°çš„ä¼˜ç‚¹ï¼š</strong>1.å°†æ•°æ®å‹ç¼©åˆ°ï¼ˆ0ï¼Œ1ï¼‰èŒƒå›´å†…ï¼›2.sigmoidå‡½æ•°æ˜¯å…‰æ»‘çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒå¤„å¤„å¯å¯¼ï¼›3. sigmoidå‡½æ•°çš„å€¼åŸŸä¸ºï¼ˆ0ï¼Œ1ï¼‰,é‚£ä¹ˆå¯ä»¥è¢«ä½œä¸ºæ¦‚ç‡ï¼Œå¾ˆå¥½çš„è§£é‡Šæ¨¡å‹ï¼›<strong>sigmoidå‡½æ•°çš„ç¼ºç‚¹ï¼š</strong>1.å®¹æ˜“å‘ç”Ÿæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼›2.ä¸æ˜¯å…³äºåŸç‚¹ä¸­å¿ƒå¯¹ç§°ï¼Œæ‰€ä»¥æ¨¡å‹æ”¶æ•›é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚<a href="https://liam.page/2018/04/17/zero-centered-active-function/" target="_blank" rel="noopener">ä¸­å¿ƒå¯¹ç§°</a>ï¼›3. è®¡ç®—é‡å¤§ã€‚</p><p><strong>tanhå‡½æ•°çš„ä¼˜ç‚¹ï¼š</strong>è§£å†³äº†sigmoidå‡½æ•°ä¸æ˜¯ä¸­å¿ƒå¯¹ç§°çš„é—®é¢˜ï¼›<strong>ç¼ºç‚¹ï¼š</strong>ä»ç„¶å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚</p><p><strong>reluå‡½æ•°çš„ä¼˜ç‚¹ï¼š</strong>å¯¼æ•°ç¨³å®šï¼Œè®¡ç®—é‡å°ï¼›<strong>reluå‡½æ•°çš„ç¼ºç‚¹ï¼š</strong>å®¹æ˜“å‘ç”Ÿdead reluçš„æƒ…å†µã€‚ä¹Ÿå°±æ˜¯å½“è¾“å…¥å°äº0çš„æ—¶å€™ï¼Œç»è¿‡reluä¹‹åï¼Œè¾“å‡ºä¸º0ï¼Œè¿™æ ·çš„å€’æ•°ä¹Ÿä¼šä¸º0ï¼Œæ¢¯åº¦å¾ˆéš¾ä¼ é€’ã€‚</p><p><strong>leaky reluï¼š</strong>è§£å†³äº†dead relué—®é¢˜ã€‚ä½†æ˜¯å‚æ•°æ˜¯äººä¸ºæŒ‡å®šçš„ã€‚</p><p><strong>pRELUï¼š</strong>è®©å‚æ•°ä¹Ÿè·Ÿç€ç½‘ç»œä¸€å—è®­ç»ƒï¼Œå¾—åˆ°çš„å‚æ•°æ›´åŠ åˆç†ã€‚</p><p><a href="https://blog.csdn.net/qq_18310041/article/details/91042085" target="_blank" rel="noopener">æ¿€æ´»å‡½æ•°çš„æ¯”è¾ƒ</a></p><ul><li>è®²è®²subwordç®—æ³•ï¼Ÿ</li></ul><p>ç­”ï¼šBPEã€wordpieceã€‚</p><ul><li>label smoothingï¼Ÿ</li></ul><p>ç­”ï¼šLSRé€šå¸¸ç”¨äºsoftmaxä¸­ã€‚åœ¨æ™®é€šçš„softmaxä¸­ï¼Œåªä¼šå…³æ³¨æ­£ç¡®æ ‡ç­¾ä½ç½®çš„æŸå¤±ï¼Œè€Œä¸å»è€ƒè™‘å…¶ä»–ä½ç½®çš„æŸå¤±ï¼Œè¿™å°±å°±ä¼šå¯¼è‡´æ¨¡å‹è¿‡äºå…³æ³¨å¢å¤§æ­£ç¡®æ ‡ç­¾ä½ç½®çš„æ¦‚ç‡ï¼Œè€Œä¸å»å…³äºå‡å°é¢„æµ‹é”™è¯¯æ ‡ç­¾çš„æ¦‚ç‡ï¼Œè¿™æ ·çš„ç»“æœï¼Œå°±æ˜¯æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šæ‹Ÿåˆçš„å¾ˆå¥½ï¼Œè€Œåœ¨æµ‹è¯•é›†ä¸Šè¡¨ç°çš„ä¸å¥½ï¼Œä¹Ÿå°±æ˜¯ä¼šå¯¼è‡´è¿‡æ‹Ÿåˆã€‚</p><p>è€Œåœ¨LSRä¸­ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªå¹³æ»‘å› å­ $\epsilon$ï¼Œé‚£ä¹ˆ <script type="math/tex">\hat y=(1-\epsilon)*y+\epsilon*u</script>ï¼Œå…¶ä¸­ $u$ è¡¨ç¤ºä¸€ä¸ªå‡åŒ€åˆ†å¸ƒã€‚å®é™…ä¸ŠLSRå°±æ˜¯å¼•å…¥å™ªå£°ã€‚ä»è€Œï¼Œè®©æ¨¡å‹ä¸ä»…è€ƒè™‘åœ¨æ ‡ç­¾æ­£ç¡®ä½ç½®çš„æŸå¤±ï¼Œä¹Ÿè€ƒè™‘åœ¨æ ‡ç­¾é”™è¯¯ä½ç½®çš„æŸå¤±ï¼Œè®©å¯¼è‡´æ¨¡å‹çš„æŸå¤±å¢å¤§ï¼Œä»è€Œå¯¼è‡´æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›æé«˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦é™ä½æŸå¤±ï¼Œå°±å¿…é¡»å­¦ä¹ çš„æ›´å¥½ï¼Œä¹Ÿå°±æ˜¯è¿«ä½¿æ¨¡å‹å‘å¢å¤§æ­£ç¡®åˆ†ç±»çš„æ¦‚ç‡ä»¥åŠå‡å°é”™è¯¯åˆ†ç±»çš„æ¦‚ç‡çš„æ–¹å‘å‰è¿›ã€‚<strong>LSRåœ¨transformerä¸­æœ‰ä½¿ç”¨ã€‚</strong><a href="https://blog.csdn.net/sinat_36618660/article/details/100166957?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">LSRçš„ä»‹ç»</a></p><ul><li>Xavieråˆå§‹åŒ–å’ŒHeåˆå§‹åŒ–</li></ul><p>ç­”ï¼š<a href="https://blog.csdn.net/xxy0118/article/details/84333635" target="_blank" rel="noopener">Xavieråˆå§‹åŒ–å’ŒHeåˆå§‹åŒ–</a></p><ul><li>L1ä¼˜åŒ–æ–¹æ³•ï¼Ÿï¼ˆåæ ‡ä¸‹é™æ³•ã€LARSè§’å›å½’ï¼‰</li></ul><p>ç­”ï¼š<a href="https://blog.csdn.net/u013802188/article/details/40476989?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">åæ ‡è½´ä¸‹é™æ³•</a></p><ul><li>SVMç®—æ³•æ ¸å‡½æ•°çš„é€‰æ‹©</li></ul><p>ç­”ï¼š1.å½“æ²¡æœ‰ä»»ä½•å…ˆéªŒçŸ¥è¯†çš„æ—¶å€™ï¼Œé€‰æ‹©RBFæ ¸å‡½æ•°ï¼›2.å½“ç‰¹å¾æ•°è¿œè¿œå¤§äºæ ·æœ¬æ•°çš„æ—¶å€™ï¼Œé€‰æ‹©çº¿æ€§æ ¸ï¼Œå› ä¸ºæ­¤æ—¶ï¼Œå¦‚æœé€‰æ‹©é«˜æ–¯æ ¸çš„è¯ï¼Œæˆ‘ä»¬ä¼šå°†ç‰¹å¾æ˜ å°„åˆ°æ›´åŠ å¤æ‚çš„ç©ºé—´ä¸­ï¼Œä¼šå¯¼è‡´æ¨¡å‹å®¹æ˜“è¿‡æ‹Ÿåˆï¼›3.å½“æ ·æœ¬æ•°è¿œè¿œå¤§äºç‰¹å¾æ•°çš„æ—¶å€™ï¼Œé€‰æ‹©çº¿æ€§æ ¸ï¼›å½“æ ·æœ¬æ•°ä¸€èˆ¬å¤§å°ï¼Œç‰¹å¾æ•°è¾ƒå°çš„æ—¶å€™ï¼Œé€‰æ‹©é«˜æ–¯æ ¸ã€‚</p><ul><li>å¦‚ä½•Â·å¤„ç†ä¸å¹³è¡¡é—®é¢˜ï¼Ÿ</li></ul><p>ç­”ï¼š1ã€‚ä¸Šé‡‡æ ·ä¸ä¸‹é‡‡æ ·ã€‚<strong>ä¸Šé‡‡æ ·ï¼š</strong>å¯¹å°‘æ ·æœ¬çš„ç±»åˆ«è¿›è¡Œé‡‡æ ·ï¼Œå°†é‡‡æ ·åçš„æ ·æœ¬åŠ å…¥æ•°æ®é›†ã€‚é‡å¤å¤šæ¬¡ï¼Œä»è€Œå¾—åˆ°æ•°æ®åˆ†å¸ƒæ›´åŠ å¹³è¡¡çš„æ•°æ®é›†ã€‚<strong>ä¸‹é‡‡æ ·ï¼š</strong>å¯¹å¤šæ ·æœ¬çš„ç±»åˆ«è¿›è¡Œé‡‡æ ·ï¼Œå°†é‡‡æ ·åçš„æ ·æœ¬ç§»å‡ºæ•°æ®é›†ï¼Œé‡å¤å¤šæ¬¡ï¼Œä»è€Œå¾—åˆ°æ•°æ®åˆ†å¸ƒæ›´åŠ å‡åŒ€çš„æ•°æ®é›†ã€‚</p><p>2.ä¿®æ”¹æƒé‡ 3ã€‚baggingï¼›4. å¤šä»»åŠ¡è”åˆå­¦ä¹ ã€‚5.å¯¹äºäºŒåˆ†ç±»é—®é¢˜æ¥è¯´ï¼Œæ¿€æƒ…é—®é¢˜è½¬åŒ–ä¸ºå¼‚å¸¸æ£€æµ‹ã€‚<a href="https://blog.csdn.net/weixin_37801695/article/details/86243998" target="_blank" rel="noopener">ç­”æ¡ˆ</a></p><p>Skip-gramçš„lossï¼Ÿ</p><p><img src="/2020/03/07/Summarization-of-Interview-Problems-Solutions/skip-gram-loss.jpg" style="zoom:50%;"></p><h2 id="Mathematics"><a href="#Mathematics" class="headerlink" title="Mathematics"></a>Mathematics</h2><p><strong>ByteDance AI LAB</strong></p><ul><li>x, yæ˜¯ç‹¬ç«‹çš„éšæœºå˜é‡ï¼Œæ–¹å·®æœŸæœ›å·²çŸ¥ï¼Œé‚£ä¹ˆå¦‚ä½•æ±‚ xy çš„æ–¹å·®ï¼Ÿ</li></ul><p>$D(XY)=E[(XY)^2]-[E(XY)]^2=E(X^2)E(Y^2)-[E(X)E(Y)]^2$</p><p>å¸¸è§çš„å…¬å¼ï¼š</p><ol><li>$D(X)=E(X^2)-[E(X)]^2$</li><li>$å¦‚æœXä¸Yç‹¬ç«‹ï¼Œé‚£ä¹ˆ D(X+Y)=D(X)+D(Y)$</li><li>$å¦‚æœXä¸Yç‹¬ç«‹ï¼Œé‚£ä¹ˆ E(XY)=E(X)E(Y)$</li><li>$æ–¹å·®çš„å®šä¹‰ï¼šD(X)=E[[X-E(X)]^2]$</li><li>$è®¾Xä¸Yæ˜¯ä¸¤ä¸ªéšæœºå˜é‡ï¼Œé‚£ä¹ˆD(X+Y)=D(X)+D(Y)+2cov(X,Y)$</li><li>$åæ–¹å·®ï¼šCov(X,Y)=E\{[X-E(X)][Y-E(Y)]\}=E(XY)-E(X)E(Y)$</li></ol><p><a href="https://www.cnblogs.com/jfdwd/p/11274056.html" target="_blank" rel="noopener">æœŸæœ›ï¼Œæ–¹å·®ï¼Œåæ–¹å·®</a></p><h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p><strong>ByteDance AI LAB</strong></p><ul><li>topké—®é¢˜</li></ul><p>topké—®é¢˜ä¸€å¾‹ä½¿ç”¨æœ€å°å †è§£å†³ã€‚</p><p>è§£ç­”ï¼š<a href="https://blog.csdn.net/zyq522376829/article/details/47686867?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">https://blog.csdn.net/zyq522376829/article/details/47686867?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></p><ul><li>ä¸€é“ç¼–ç¨‹é¢˜ï¼š<br>ç»™ä¸€ä¸ªæ•°ç»„Aï¼Œå¦‚ä½•å˜æˆæ•°ç»„Bï¼ŒBè¦æ»¡è¶³è¿™ä¸ªå½¢å¼ B0 &gt;= B1&lt;= B2 &gt;= B3 &lt;= B4â€¦.ã€leetcode324ã€‘<br>ï¼ˆä¸éœ€è¦å¯¹æ•°ç»„æ’åºï¼Œåªéœ€è¦å°†æ•°ç»„AæŒ‰ç…§ä¸­ä½æ•°åˆ†æˆä¸¤é›†åˆï¼Œå¤§é›†åˆå†…çš„æ•°æ”¾å¥‡æ•°ä½ï¼Œå°é›†åˆå†…çš„æ•°æ”¾å¶æ•°ä½ã€‚åˆ†æˆä¸¤é›†åˆçš„æ–¹æ³•ï¼šå…ˆå¾—åˆ°æ•°ç»„é•¿åº¦lenï¼Œç„¶åä½¿ç”¨å¿«æ’å‰ªææˆ–è€…ä½¿ç”¨å †æ¥é€‰å‡ºä¸¤ä¸ªå¤§å°ä¸ºlen/2çš„é›†åˆï¼Œå¯çœ‹ä½œtopké—®é¢˜ï¼‰</li><li>æœ€å¿«é€Ÿåº¦æœ€å°ç©ºé—´æ±‚ä¸€ä¸ªæ•°ç»„çš„ç¬¬kå°</li><li>å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæ— åºæ•°ç»„çš„ä¸­ä½æ•°</li></ul><p>è§£ç­”ï¼š1.ä½¿ç”¨æ’åºç®—æ³•ï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„æƒ³æ³•ï¼›2.å»ºç«‹æœ€å°å †ã€‚è¿™é‡Œè¦åˆ†æƒ…å†µè®¨è®ºï¼šå½“æ•°ç»„å…ƒç´ æ•°ç›®nä¸ºå¥‡æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å–(n+1)/2ä¸ªå…ƒç´ æ¥å»ºç«‹æœ€å°å †ï¼›ä¹‹åï¼Œéå†å‰©ä½™çš„å…ƒç´ ï¼Œæ¯”å †é¡¶å…ƒç´ å¤§ï¼Œå°±æ›¿æ¢å †é¡¶å…ƒç´ ï¼Œæœ€åï¼Œå †é¡¶å…ƒç´ å°±æ˜¯ä¸­ä½æ•°ã€‚</p><ul><li>å·²çŸ¥æ•°ç»„aå’Œæ­£æ•´æ•°mï¼Œä»æ•°ç»„aä¸­æ‰¾åˆ°ä¸€ä¸ªè¿ç»­å­åºåˆ—ï¼Œä½¿å¾—è¿ç»­å­åºåˆ—çš„å’Œ&gt;=mï¼Œæ±‚æ»¡è¶³æ¡ä»¶çš„æœ€çŸ­çš„è¿ç»­å­åºåˆ—çš„é•¿åº¦ã€‚</li><li>æµ·é‡æ•°æ®å¤„ç†é¢˜ç›®</li></ul><p>è§£ç­”ï¼š<a href="https://blog.csdn.net/v_july_v/article/details/6279498/" target="_blank" rel="noopener">https://blog.csdn.net/v_july_v/article/details/6279498/</a></p><ul><li>æœ€é•¿å…¬å…±å­åºåˆ—.</li></ul><p>è§£ç­”ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestCommonSubsequence</span><span class="params">(<span class="built_in">string</span> text1, <span class="built_in">string</span> text2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(text1.<span class="built_in">size</span>()==<span class="number">0</span> || text2.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; <span class="title">dp</span><span class="params">(text1.<span class="built_in">size</span>()+<span class="number">1</span>,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(text2.<span class="built_in">size</span>()+<span class="number">1</span>,<span class="number">0</span>))</span></span></span><br><span class="line"><span class="function">      </span></span><br><span class="line"><span class="function">       <span class="title">for</span><span class="params">(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=text1.<span class="built_in">size</span>();i++)</span></span>&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=text2.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">               <span class="keyword">if</span>(text1[i<span class="number">-1</span>]==text2[j<span class="number">-1</span>])&#123;</span><br><span class="line">                   dp[i][j]=dp[i<span class="number">-1</span>][j<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">else</span>&#123;</span><br><span class="line">                   dp[i][j]=<span class="built_in">max</span>(dp[i<span class="number">-1</span>][j],dp[i][j<span class="number">-1</span>]);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[text1.<span class="built_in">size</span>()][text2.<span class="built_in">size</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>10äº¿intï¼Œ4GBå†…å­˜ï¼Œæ‰¾å‡ºæ‰€æœ‰ä¸é‡å¤æ•°å­—ï¼Ÿ</p><p><a href="https://blog.csdn.net/jacke121/article/details/78336275/" target="_blank" rel="noopener">ç­”æ¡ˆ</a></p></li></ul><p>ç»Ÿè®¡è¯é¢‘</p><p>bashå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat words.txt | tr -s <span class="string">' '</span> <span class="string">'\n'</span> | sort | uniq -c | sort -r | awk <span class="string">'&#123;print $2" "$1&#125;'</span></span><br></pre></td></tr></table></figure><h2 id="IQ-Tests"><a href="#IQ-Tests" class="headerlink" title="IQ Tests"></a>IQ Tests</h2><p>ç°åœ¨æœ‰ä¸‰æšç¡¬å¸ï¼Œä¸€ä¸ªæ˜¯ä¸€æ­£ä¸€åï¼Œä¸€ä¸ªæ˜¯ä¸¤é¢éƒ½æ˜¯æ­£ï¼Œä¸€ä¸ªæ˜¯ä¸¤é¢éƒ½æ˜¯åï¼Œç°åœ¨éšæœºæŠ›å‡ºä¸€æšç¡¬å¸æ˜¯æ­£é¢ï¼Œé‚£ä¹ˆè¿™æšç¡¬å¸çš„åé¢ä¹Ÿæ˜¯æ­£é¢çš„æ¦‚ç‡ï¼›ï¼ˆ2/3ï¼‰</p><p>è§£ç­”ï¼š$\frac {1/3}{1/3*1/2+1/3}=2/3$</p><h2 id="Python-C"><a href="#Python-C" class="headerlink" title="Python/C++"></a>Python/C++</h2><ul><li>pythonçš„å¤šçº¿ç¨‹ï¼Ÿ(å‡çš„å¤šçº¿ç¨‹)</li><li><p>pythonçš„æµ…æ‹·è´ä¸æ·±æ‹·è´ã€‚</p></li><li><p>yieldï¼Ÿ<a href="https://blog.csdn.net/mieleizhi0522/article/details/82142856/" target="_blank" rel="noopener">yieldçš„ä½¿ç”¨</a></p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yieldçš„ä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_number</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        print(<span class="string">f"<span class="subst">&#123;i&#125;</span>"</span>)</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„a=[i for i in range(n)]ï¼Œå½“æ”¹æˆï¼ša=(i for i in range(n)),å°±å˜æˆä¸€ä¸ªgeneratoräº†ï¼</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">f"starting......."</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        res=<span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">        print(<span class="string">f"res: <span class="subst">&#123;res&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    a=print_number(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> a: <span class="keyword">continue</span></span><br><span class="line">    </span><br><span class="line">    print(<span class="string">'*'</span>*<span class="number">20</span>)</span><br><span class="line">    g=foo()</span><br><span class="line">    print(next(g))</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">'*'</span>*<span class="number">20</span>)</span><br><span class="line">    print(next(g))</span><br></pre></td></tr></table></figure><ul><li>pythonä¸­çš„genertorï¼Ÿ<a href="https://www.cnblogs.com/zywscq/p/5774567.html" target="_blank" rel="noopener">generatoræ€»ç»“</a></li><li>rand7ç”Ÿæˆrand10ï¼Ÿ</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rand7</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//https://www.cnblogs.com/xiaokang01/p/9786751.html</span></span><br><span class="line"><span class="comment">//srandä¿è¯æ¯æ¬¡äº§ç”Ÿçš„éšæœºæ•°æ˜¯ä¸ä¸€æ ·çš„</span></span><br><span class="line">srand((<span class="keyword">int</span>)time(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rand()%<span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rand10</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    i=(rand7()<span class="number">-1</span>)*<span class="number">7</span>+rand7();</span><br><span class="line">  &#125;<span class="keyword">while</span>(i&gt;<span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> i%<span class="number">10</span>+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;   </span><br><span class="line">  <span class="keyword">int</span> x=rand10();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>AUCè®¡ç®—</strong></p><p><a href="https://www.bioinfo-scrounger.com/archives/767/" target="_blank" rel="noopener">https://www.bioinfo-scrounger.com/archives/767/</a></p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>1 <a href="https://blog.csdn.net/qq_28031525/article/details/80028055?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">https://blog.csdn.net/qq_28031525/article/details/80028055?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢è¯•é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ |LightGBMä¸catBoostæ¨¡å‹åŸç†è¯¦è§£</title>
      <link href="2020/03/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-LightGBM%E4%B8%8EcatBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/03/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-LightGBM%E4%B8%8EcatBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>XGBoostã€LightGBMã€catBoostæ˜¯GBDTæ¨¡å‹çš„ä¸‰å¤§å·¥ç¨‹åŒ–çš„å®ç°ã€‚å‰é¢å·²ç»å¯¹XGBoostæ¨¡å‹è¿›è¡Œäº†è®²è§£ï¼Œè¿™ç¯‡åšå®¢å°†å¯¹LightGBMä¸catBoostæ¨¡å‹è¿›è¡Œè®²è§£ã€‚ç”±äºä¸‰å¤§æ¨¡å‹æœ‰å¾ˆå¤šéœ€è¦ç›¸ä¼¼çš„åœ°æ–¹ï¼Œå¤§éƒ¨åˆ†åŸºç¡€éƒ¨åˆ†åœ¨XGBoosté‚£ç‰‡å·²ç»è®²è§£è¿‡äº†ï¼Œæ‰€ä»¥è¿™ç¯‡åšå®¢å°†ç€é‡è®²è§£æ¨¡å‹è‡ªèº«åˆ›æ–°çš„åœ°æ–¹ã€‚</p><a id="more"></a><h2 id="LightGBMæ¨¡å‹ä»‹ç»"><a href="#LightGBMæ¨¡å‹ä»‹ç»" class="headerlink" title="LightGBMæ¨¡å‹ä»‹ç»"></a>LightGBMæ¨¡å‹ä»‹ç»</h2><p>åœ¨GBDTæ¨¡å‹ä¸­ï¼Œæ ¸å¿ƒåœ¨äºåŸºæœ¬åˆ†ç±»å™¨(å›å½’æ ‘)çš„ç”Ÿæˆï¼ŒXGBoostæ¨¡å‹ä¹Ÿä¸ä¾‹å¤–ã€‚åœ¨XGBoostä¸­ï¼Œåœ¨æ‰¾æœ€ä½³åˆ†è£‚ç‚¹çš„æ—¶å€™ï¼Œæ‰€ä½¿ç”¨çš„æ–¹æ³•æ˜¯ï¼š<strong>é’ˆå¯¹æ¯ä¸€ä¸ªç‰¹å¾ï¼Œå»éå†æ‰€æœ‰è®­ç»ƒå®ä¾‹ï¼Œè®¡ç®—ä¿¡æ¯å¢ç›Šï¼Œä»è€Œå¾—åˆ°æœ€ä½³åˆ†è£‚ç‚¹ã€‚</strong>ä½†æ˜¯ï¼Œå½“å®ä¾‹çš„ç‰¹å¾ç»´åº¦éå¸¸å¤§ï¼Œæ•°æ®é‡ä¹Ÿéå¸¸å¤§çš„æ—¶å€™ï¼Œè®¡ç®—æ•ˆç‡ä¼šå¤§å¹…é™ä½ï¼ŒåŒæ—¶ä¹Ÿéå¸¸åœ°å ç”¨å†…å­˜ã€‚è€Œ<strong>LightGBMæ¨¡å‹æ­£æ˜¯ä»å‡å°æ•°æ®é‡ä»¥åŠç‰¹å¾ç»´åº¦è¿™ä¸¤æ–¹é¢ï¼Œå¯¹XGBoostæ¨¡å‹è¿›è¡Œæ€§èƒ½ä¼˜åŒ–çš„GBDTæ¨¡å‹ã€‚</strong>ä¸ºäº†å‡å°æ•°æ®é‡ï¼ŒLightGBMä¸­æ‰€ä½¿ç”¨çš„æŠ€æœ¯å«åšï¼š<strong>Gradient based One side sampling(GOSS)</strong>ï¼›ä¸ºäº†å‡å°ç‰¹å¾æ•°é‡ï¼ŒLgithGBMä¸­æ‰€ä½¿ç”¨çš„æŠ€æœ¯å«åšï¼š<strong>Exclusive Feature Bundling(EFB)</strong>ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä»è¿™ä¸¤æ–¹é¢ï¼Œæ¥ä»‹ç»LightGBMæ¨¡å‹ã€‚</p><h3 id="Gradient-based-One-side-sampling-GOSS"><a href="#Gradient-based-One-side-sampling-GOSS" class="headerlink" title="Gradient based One side sampling(GOSS)"></a>Gradient based One side sampling(GOSS)</h3><p>GOSSï¼Œä¸­æ–‡å«åšï¼šåŸºäºæ¢¯åº¦çš„å•è¾¹é‡‡æ ·ã€‚å®ƒçš„ç›®æ ‡æ˜¯ï¼š<strong>å‡å°æ•°æ®é‡</strong>ã€‚é‚£ä¹ˆæ€ä¹ˆåšå‘¢ï¼Ÿä½œè€…å‘ç°ï¼š<strong>è®­ç»ƒé›†ä¸­å…·æœ‰ä¸åŒæ¢¯åº¦çš„å®ä¾‹å¯¹äºè®¡ç®—ä¿¡æ¯å¢ç›Šçš„ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ã€‚é‚£ä¹ˆå…·æœ‰è¾ƒå°æ¢¯åº¦çš„å®ä¾‹ï¼Œè¯´æ˜å…¶å·²ç»è¢«è®­ç»ƒçš„å·®ä¸å¤šäº†ï¼Œå…¶å¯¹äºä¿¡æ¯å¢ç›Šçš„å¤§å°å½±å“è¾ƒå°ï¼›è€Œé‚£äº›å…·æœ‰è¾ƒå¤§æ¢¯åº¦çš„å®ä¾‹å¯¹ä¿¡æ¯å¢ç›Šçš„å½±å“è¾ƒå¤§ã€‚</strong>æ‰€ä»¥ä¸€ä¸ªå¾ˆè‡ªç„¶åœ°æƒ³æ³•æ˜¯ï¼šæŠ›å¼ƒé‚£äº›æ¢¯åº¦è¾ƒå°çš„å®ä¾‹ï¼Œåªä¿å­˜æ¢¯åº¦è¾ƒå¤§çš„å®ä¾‹ï¼Œè¿™æ ·çš„è¯ï¼Œå°±è¾¾åˆ°äº†å‡å°æ•°æ®é‡çš„ç›®æ ‡ï¼ŒåŒæ—¶è¿˜ä¸å¤Ÿé™ä½å‡†ç¡®ç‡ã€‚ä½†æ˜¯è¿™æ ·åšä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼š<strong>æŠ›å¼ƒå®ä¾‹ä¼šå¯¼è‡´è®­ç»ƒé›†çš„æ•°æ®åˆ†å¸ƒå‘ç”Ÿæ”¹å˜</strong>ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGOSSç®—æ³•è¢«æå‡ºæ¥äº†ã€‚</p><p>GOSSçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ä¿å­˜æ‰€æœ‰çš„æ¢¯åº¦è¾ƒå¤§çš„å®ä¾‹ï¼ŒåŒæ—¶å¯¹æ¢¯åº¦è¾ƒå°çš„å®ä¾‹è¿›è¡Œä¸€å®šæ¯”ä¾‹çš„éšæœºæŠ½æ ·ã€‚</strong>å…·ä½“åšæ³•æ˜¯ï¼š</p><ul><li>é¦–å…ˆï¼Œå¯¹è®­ç»ƒå®ä¾‹æŒ‰ç…§æ¢¯åº¦ä»å¤§åˆ°å°è¿›è¡Œæ’åºï¼›</li><li>æ¥ç€ï¼Œé€‰å–å¹¶ä¿å­˜å‰$a\%$çš„æ¢¯åº¦å¤§çš„å®ä¾‹ã€‚å³ï¼š$a\% *# samples$</li><li>æ¥ç€ï¼Œåœ¨é€‰å–$b\%$çš„æ¢¯åº¦å°çš„å®ä¾‹ã€‚å³ï¼š$b\% *# samples$</li><li>åˆå¹¶é€‰å–çš„æ¢¯åº¦å¤§çš„ä¸å°çš„å®ä¾‹ï¼Œä½œä¸ºæ–°çš„è®­ç»ƒé›†ï¼›</li><li>æ¯ä¸€ä¸ªæ¢¯åº¦å°å®ä¾‹ä¹˜ä»¥ä¸€ä¸ªç³»æ•°ï¼š$\frac {1-a}{b}$ï¼Œè¿™æ ·åšçš„ä½œç”¨åœ¨äºï¼šå°½é‡ä¿è¯æ•°æ®åˆ†å¸ƒä¸å‘ç”Ÿå˜åŒ–ã€‚</li><li>ä½¿ç”¨ä¸Šè¿°çš„æ ·æœ¬è®­ç»ƒä¸€ä¸ªå¼±åˆ†ç±»å™¨ã€‚</li></ul><p><strong>å½“$a$ä¸º0çš„æ—¶å€™ï¼Œå°±æ˜¯éšæœºæŠ½æ ·ç®—æ³•ï¼›å½“$a$ä¸º1çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰æŠ½æ ·ï¼Œä½¿ç”¨å…¨éƒ¨è®­ç»ƒå®ä¾‹ã€‚</strong></p><p><img src="/2020/03/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-LightGBM%E4%B8%8EcatBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/0.jpg" style="zoom:67%;"></p><h3 id="Exclusive-Feature-Bundling-EFB"><a href="#Exclusive-Feature-Bundling-EFB" class="headerlink" title="Exclusive Feature Bundling(EFB)"></a>Exclusive Feature Bundling(EFB)</h3><p>EFBï¼Œä¸­æ–‡å«åšï¼šç‹¬ç«‹ç‰¹å¾åˆå¹¶ã€‚å®ƒçš„ç›®æ ‡æ˜¯ï¼š<strong>å‡å°ç‰¹å¾æ•°é‡</strong>ã€‚<strong>è¿™ä¸ªç®—æ³•çš„æƒ³æ³•æ¥æºæ˜¯ï¼š</strong>åœ¨å®ä¾‹çš„ç‰¹å¾ä¸­ï¼Œå¤§éƒ¨åˆ†çš„ç‰¹å¾éƒ½æ˜¯ç¨€ç–çš„ï¼Œå³ç‰¹å¾å‘é‡å¤§éƒ¨åˆ†éƒ½æ˜¯0ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå°†ç‰¹å¾è¿›è¡Œåˆå¹¶Â·ï¼Œå°±å¯ä»¥å‡å°ä½¿ç”¨çš„ç‰¹å¾çš„æ•°é‡ï¼Œè¿˜èƒ½å¾—åˆ°ç¨ å¯†çš„ç‰¹å¾å‘é‡ï¼Œæ˜“äºè®­ç»ƒã€‚<strong>EFBç®—æ³•çš„æƒ³æ³•æ˜¯ï¼š</strong>æˆ‘ä»¬å°†ä¸¤ä¸ªå®Œå…¨äº’æ–¥çš„ç‰¹å¾è¿›è¡Œåˆå¹¶ï¼Œè¿™ä¸ªæ ·æ‰ä¸ä¼šä¸¢å¤±ä¿¡æ¯ï¼›å¦‚æœè¯´ä¸¤ä¸ªç‰¹å¾ä¹‹é—´å¹¶ä¸æ˜¯å®Œå…¨äº’æ–¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†²çªæ¯”ç‡æ¥å¯¹ç‰¹å¾ä¹‹é—´çš„ä¸äº’æ–¥çš„ç¨‹åº¦è¿›è¡Œè¡¡é‡ï¼Œå¦‚æœè¯´è¿™ä¸ªå€¼æ¯”è¾ƒå°ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å°†è¿™ä¸¤ä¸ªç‰¹å¾è¿›è¡Œåˆå¹¶ï¼Œè€Œä¸ä¼šå½±å“åˆ°æœ€åçš„æ€§èƒ½ã€‚<strong>è¿™æ ·è®²è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</strong>ç‰¹å¾açš„æ•°æ®ä¸º$[1, 0, 0, 0, 2, 0]$ï¼Œç‰¹å¾bçš„æ•°æ®ä¸º$[0, 0, 3, 0, 0, 2]$ï¼Œå¯è§ä»–ä»¬çš„éé›¶éƒ¨åˆ†çš„ä½ç½®éƒ½æ˜¯æ²¡æœ‰å†²çªçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶åˆå¹¶åœ¨ä¸€èµ·$[1,0,3,0,2,4]$ã€‚è¿™é‡Œbç‰¹å¾çš„æ•°å€¼2æ”¹æˆ4ï¼Œæ˜¯å› ä¸ºaç‰¹å¾å·²ç»å­˜åœ¨æ•°å€¼2ï¼é‚£ä¹ˆæˆ‘ä»¬å°±å°†å®ƒæ”¹æˆå…¶ä»–æ•°å€¼é¿å…æ•°å€¼ä¸Šçš„å†²çªã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><ul><li><strong>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•ç¡®å®šå“ªäº›ç‰¹å¾ç”¨æ¥åˆå¹¶æ•ˆæœä¼šæ¯”è¾ƒå¥½ï¼Ÿ</strong></li><li><strong>ç¬¬äºŒä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•å°†ç¡®å®šå¥½çš„ç‰¹å¾è¿›è¡Œåˆå¹¶ï¼Ÿ</strong></li></ul><h4 id="ç¬¬ä¸€ä¸ªé—®é¢˜"><a href="#ç¬¬ä¸€ä¸ªé—®é¢˜" class="headerlink" title="ç¬¬ä¸€ä¸ªé—®é¢˜"></a>ç¬¬ä¸€ä¸ªé—®é¢˜</h4><p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯ä¸€ä¸ªNP-hardé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å°†ç‰¹å¾çœ‹ä½œç‚¹ï¼Œç‰¹å¾ä¹‹é—´çš„å†²çªå€¼çœ‹ä½œè¾¹çš„æƒé‡ï¼Œ(è¿™é‡Œçš„å†²çªå€¼è¯´çš„æ˜¯ç‰¹å¾çš„ä¹‹é—´çš„coså€¼ã€‚)<strong>æˆ‘ä»¬è¦åšçš„æ˜¯åˆå¹¶ç‰¹å¾ï¼Œå¹¶ä½¿å¾—åˆå¹¶ç‰¹å¾çš„æ•°ç›®æœ€å°ï¼Œ</strong>è¿™å…¶å®æ˜¯ä¸€ä¸ªå›¾ç€è‰²é—®é¢˜ã€‚åœ¨EFBä¸­ï¼Œä½¿ç”¨è¿‘ä¼¼è´ªå¿ƒç®—æ³•æ¥è§£å†³ã€‚<strong>å…ˆæŒ‰ç…§åº¦æ¥å¯¹æ¯ä¸ªç‰¹å¾åšé™åºæ’åºï¼ˆåº¦æ•°è¶Šå¤§ä¸å…¶ä»–ç‚¹çš„å†²çªè¶Šå¤§ï¼‰ï¼Œç„¶åå°†ç‰¹å¾åˆå¹¶åˆ°å†²çªæ•°å°äºKçš„bundleæˆ–è€…æ–°å»ºå¦å¤–ä¸€ä¸ªbundleã€‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(#feature^2)ã€‚</strong></p><p><img src="/2020/03/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-LightGBM%E4%B8%8EcatBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/1.jpg" style="zoom:67%;"></p><h4 id="ç¬¬äºŒä¸ªé—®é¢˜"><a href="#ç¬¬äºŒä¸ªé—®é¢˜" class="headerlink" title="ç¬¬äºŒä¸ªé—®é¢˜"></a>ç¬¬äºŒä¸ªé—®é¢˜</h4><p>ç¬¬äºŒä¸ªæ˜¯æ€ä¹ˆåˆå¹¶è¿™äº›bundlesã€‚ç”±äºæ¯ä¸€ä¸ªbundleå½“ä¸­ï¼Œfeaturesçš„rangeéƒ½æ˜¯ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°æ„å»ºåˆå¹¶åbundle featureçš„rangeã€‚åœ¨ç¬¬ä¸€ä¸ªforå¾ªç¯å½“ä¸­ï¼Œæˆ‘ä»¬è®°å½•æ¯ä¸ªfeatureä¸ä¹‹å‰featuresç´¯ç§¯totalRangeã€‚åœ¨ç¬¬äºŒä¸ªforå¾ªç¯å½“ä¸­ï¼Œæ ¹æ®ä¹‹å‰çš„binRangesé‡æ–°è®¡ç®—å‡ºæ–°çš„bin valueï¼š$ï¼ˆF[j]bin[i] + binRanges[j]ï¼‰$ï¼Œä¿è¯featureä¹‹é—´çš„å€¼ä¸ä¼šå†²çªã€‚è¿™æ˜¯é’ˆå¯¹äºç¨€ç–çŸ©é˜µè¿›è¡Œä¼˜åŒ–ã€‚ç”±äºä¹‹å‰Greedy Bundlingç®—æ³•å¯¹featuresè¿›è¡Œå†²çªæ£€æŸ¥ç¡®ä¿bundleå†…ç‰¹å¾å†²çªå°½å¯èƒ½å°‘ï¼Œæ‰€ä»¥ç‰¹å¾ä¹‹é—´çš„éé›¶å…ƒç´ ä¸ä¼šæœ‰å¤ªå¤šçš„å†²çªã€‚æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‰¹å¾ï¼Œç‰¹å¾Açš„å–å€¼èŒƒå›´æ˜¯[0,10)ï¼Œè€Œç‰¹å¾Bçš„å–å€¼èŒƒå›´æ˜¯[0,20)ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç‰¹å¾Bå¢åŠ åç§»é‡10ï¼Œä½¿å¾—ç‰¹å¾Bçš„å–å€¼èŒƒå›´ä¸º[10, 30)ï¼Œæœ€ååˆå¹¶ç‰¹å¾Aå’ŒBï¼Œå½¢æˆæ–°çš„ç‰¹å¾ï¼Œå–å€¼èŒƒå›´ä¸º[0,30)æ¥å–ä»£ç‰¹å¾Aå’Œç‰¹å¾Bã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæ•°æ®çš„shapeå°±å˜æˆäº†$#samples * #bundles$ï¼Œä¸”$#bundles &lt;&lt; #features$ã€‚EFBé™ä½äº†æ•°æ®ç‰¹å¾è§„æ¨¡æé«˜äº†æ¨¡å‹çš„è®­ç»ƒé€Ÿåº¦ã€‚</p><p><img src="/2020/03/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-LightGBM%E4%B8%8EcatBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/2.jpg" style="zoom:67%;"></p><h3 id="æ ‘çš„ç”Ÿé•¿æ–¹å¼"><a href="#æ ‘çš„ç”Ÿé•¿æ–¹å¼" class="headerlink" title="æ ‘çš„ç”Ÿé•¿æ–¹å¼"></a>æ ‘çš„ç”Ÿé•¿æ–¹å¼</h3><p>æ ‘çš„ç”Ÿé•¿æ–¹å¼æœ‰ä¸¤ç§ï¼šleaf-wiseä¸level-wiseã€‚level-wiseæ–¹å¼æ˜¯ï¼šä¸€æ¬¡åˆ†è£‚æ˜¯åˆ†è£‚åŒä¸€å±‚çš„æ‰€æœ‰çš„å¶å­ç»“ç‚¹ï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä½†æ˜¯ç¼ºç‚¹åœ¨äºä¼šäº§ç”Ÿä¸å¿…è¦çš„å¼€é”€ï¼Œå› ä¸ºå…¶å®åŒä¸€å±‚çš„å¶å­ç»“ç‚¹ï¼Œæ²¡å¿…è¦å»è®¡ç®—å®ƒä»¬æ‰€æœ‰çš„ä¿¡æ¯å¢ç›Šã€‚left-wiseçš„æ–¹å¼æ˜¯ï¼šä»ä¸€å±‚çš„å¶å­ç»“ç‚¹ä¸­æ‰¾åˆ°ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å¶å­ç»“ç‚¹ï¼Œè¿›è¡Œåˆ†è£‚ï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºä¸éœ€è¦å¯¹ä¸€å±‚çš„å¶å­ç»“ç‚¹éƒ½è¿›è¡Œåˆ†è£‚ï¼Œå°±å‡å°äº†è®¡ç®—é‡ï¼›åå¤„åœ¨äºå®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆã€‚åœ¨LightGBMæ¨¡å‹ä¸­ï¼Œé‡‡ç”¨äº†leaf-wiseæ–¹å¼ï¼Œå¹¶ä½¿ç”¨$max \ depth$æ¥é™åˆ¶æ ‘çš„æ·±åº¦ï¼Œä»è€Œæ¥é¿å…è¿‡æ‹Ÿåˆã€‚</p><h2 id="catBoostæ¨¡å‹ä»‹ç»"><a href="#catBoostæ¨¡å‹ä»‹ç»" class="headerlink" title="catBoostæ¨¡å‹ä»‹ç»"></a>catBoostæ¨¡å‹ä»‹ç»</h2><p> catBoostæ¨¡å‹ä¸»è¦æ˜¯ä¸ºäº†å¤„ç†ç±»åˆ«ç‰¹å¾é—®é¢˜è€Œè®¾è®¡çš„ã€‚å¯¹äºç±»åˆ«ç‰¹å¾ï¼Œä¸€èˆ¬çš„å¤„ç†æ–¹å¼æ˜¯ï¼šå½“å®ƒçš„å–å€¼ä¸ªæ•°æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶è½¬æ¢ä¸ºone-hotç¼–ç ï¼›ä½†æ˜¯å½“å…¶ä¸ªæ•°éå¸¸å¤šçš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¸èƒ½ä½¿ç”¨one-hotç¼–ç æ¥ã€‚å› ä¸ºè¿™æ ·çš„è¯ï¼Œä¼šå¯¼è‡´å†³ç­–æ ‘æ— æ³•å­¦ä¹ ï¼Œå³åˆ†åˆ°è¿™ä¸ªå¶å­ç»“ç‚¹çš„æ ·æœ¬æ•°ç›®å¤ªå°‘ã€‚æ‰€ä»¥ï¼ŒcatBoostå°±æå‡ºäº†å‡ ç§å…³äºå¤„ç†ç±»åˆ«ç‰¹å¾çš„ç®—æ³•ï¼Œå…·ä½“çš„ä»¥åæœ‰æ—¶é—´å†å†™å§ğŸ¥±ã€‚å‚çœ‹é“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/102540344" target="_blank" rel="noopener">catBoost</a></p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>1 ã€ŠLightGBM: A Highly Efï¬cient Gradient Boosting Decision Treeã€‹</p><p>2 ã€ŠCatBoost: gradient boosting with categorical features supportã€‹</p><p>3 <a href="https://zhuanlan.zhihu.com/p/38516467" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38516467</a></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> LightGBM </tag>
            
            <tag> catBoost </tag>
            
            <tag> é›†æˆå­¦ä¹  </tag>
            
            <tag> XGBoost </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|é¢„è®­ç»ƒæ¨¡å‹ä¸“é¢˜â€”ELMo/GPT/BERT/XLNet/ERNIE/ALBERTæ¨¡å‹åŸç†è¯¦è§£</title>
      <link href="2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¦‚ä»Šçš„NLPé¢†åŸŸä¸­ï¼Œé¢„è®­ç»ƒæ¨¡å‹å æ®ç€æ„ˆå‘é‡è¦çš„åœ°ä½ã€‚è€ŒBERTçš„å‡ºä¸–ï¼Œæ›´æ˜¯å‡ ä¹æ¨ªæ‰«äº†NLPä¸­æ‰€æœ‰çš„ä»»åŠ¡è®°å½•ã€‚æœ¬ç¯‡åšå®¢å°†è¯¦è§£å‡ å¤§é¢„è®­ç»ƒæ¨¡å‹ï¼šELMoã€GPTã€BERTã€XLNetã€ERNIEã€ALBERTã€‚(ä¸‹å›¾æ˜¯å¯çˆ±çš„bertğŸ˜‹æ³¨æ„ï¼Œè¿™çœŸä¸æ˜¯èŠéº»è¡—å•Šå–‚ï¼)</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/0.bert.jpg" alt></p><a id="more"></a><blockquote><p>æœ¬ç¯‡æ–‡ç« è‡´åŠ›äºè®²è§£æ¸…æ¥šå„ä¸ªé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„åŸç†ï¼Œä½†æ˜¯ç»†èŠ‚éƒ¨åˆ†ä¸ä¼šå±•å¼€è®¨è®ºï¼Œè­¬å¦‚transformeræ¶æ„çš„åŸç†ã€self-attentionçš„åŸç†ã€highway networkçš„åŸç†ç­‰ç­‰ï¼Œè¿™äº›åŸºç¡€çš„ä¸œè¥¿è¯·è‡ªè¡ŒæŸ¥æ‰¾èµ„æ–™è¿›è¡Œè¡¥å……ï½</p></blockquote><h2 id="ELMoæ¨¡å‹ä»‹ç»"><a href="#ELMoæ¨¡å‹ä»‹ç»" class="headerlink" title="ELMoæ¨¡å‹ä»‹ç»"></a>ELMoæ¨¡å‹ä»‹ç»</h2><p>ELMoæ¨¡å‹ï¼Œå…¨ç§°ï¼šEmbedding from Language Modelsã€‚è¿™ä¸ªæ¨¡å‹æ‰€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼š<strong>1.è¯å‘é‡è¦æ›´å¥½åœ°è¡¨è¾¾è¯­æ³•ä¸è¯­ä¹‰ç­‰ä¿¡æ¯ï¼›2.å•è¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¼šæœ‰ä¸åŒçš„æ„æ€ï¼Œè€Œä¼ ç»Ÿçš„word2vecç­‰word embeddingæ¨¡å‹ï¼Œæ¯ä¸€ä¸ªå•è¯çš„è¯å‘é‡éƒ½æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³ï¼Œè¿™å¯¹äºå¤„ç†å•è¯çš„å¤šä¹‰æ€§éå¸¸åœ°ä¸å‹å¥½ã€‚</strong>æ‰€ä»¥ï¼ŒELMoæ¨¡å‹å°±æ˜¯åˆ©ç”¨æ·±åº¦çš„åŒå‘LSTMæ¨¡å‹æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p><h3 id="ELMoæ¨¡å‹çš„å¤§ä½“ç»“ç»“æ„"><a href="#ELMoæ¨¡å‹çš„å¤§ä½“ç»“ç»“æ„" class="headerlink" title="ELMoæ¨¡å‹çš„å¤§ä½“ç»“ç»“æ„"></a>ELMoæ¨¡å‹çš„å¤§ä½“ç»“ç»“æ„</h3><p>ELMoæ¨¡å‹çš„å¤§ä½“ç»“æ„æ˜¯ï¼šå¤šå±‚çš„biLSTMè¯­è¨€æ¨¡å‹ã€‚ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/0.png" style="zoom: 67%;"></p><ul><li>é¦–å…ˆæ˜¯è¾“å…¥<code>Input Sentence</code>ã€‚å®ƒçš„shapeæ˜¯<code>(B,W,C)</code>ã€‚å…¶ä¸­ï¼Œ<code>B</code>è¡¨ç¤ºbatch_sizeï¼Œ<code>W</code>è¡¨ç¤ºä¸€ä¸ªå¥å­çš„tokençš„æ•°ç›®ï¼Œ <code>C</code>è¡¨ç¤ºä¸€ä¸ªtokençš„æœ€å¤§å­—ç¬¦æ•°ï¼Œåœ¨è®ºæ–‡é‡Œæ˜¯å›ºå®šçš„æ•°ç›®ï¼š50ã€‚åœ¨è¿™é‡Œï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼š<strong>ELMoæ¨¡å‹æ˜¯ä»¥å­—ç¬¦ä¸ºå•ä½è¿›è¡Œç¼–ç çš„ã€‚</strong></li><li>æ¥ç€ï¼Œè¿›å…¥ char encoder layerã€‚åœ¨ELMoæ¨¡å‹ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç ï¼Œä¹Ÿå°±æ˜¯ç»™æ¯ä¸ªå­—ç¬¦è¿›è¡Œembeddingã€‚ç„¶åï¼Œç»è¿‡ä¸€äº›ä¸€ç»´å·ç§¯æ“ä½œï¼Œä»¥åŠhighwayæ“ä½œï¼Œæœ€åçš„è¾“å‡ºç»´åº¦ä¸ºï¼š<code>(B,W,D)</code>ã€‚</li><li>å°†char encoder layerçš„è¾“å‡ºä½œä¸ºbiLSTM layerçš„è¾“å…¥ï¼Œå‡è®¾ biLSTM layeræœ‰Lå±‚ï¼Œæœ€ç»ˆè¾“å‡ºçš„ç»´åº¦ä¸ºï¼š<code>(L+1,B,W,2*D)</code>ã€‚åœ¨è¿™é‡Œï¼Œä¹‹æ‰€ä»¥+1ï¼Œæ˜¯å› ä¸ºæŠŠ char encoder layerçš„è¾“å‡ºä¹Ÿç®—è¿›å»äº†ã€‚</li><li>æœ€åï¼Œå°†<code>(L+1,B,W,2*D)</code>çš„è¾“å‡ºä½œä¸º scalar Mixerçš„è¾“å…¥ï¼Œå…¶å®å°±æ˜¯å°†è¿™L+1ä¸ªè¾“å‡º<strong>è¿›è¡ŒåŠ æƒå¹³å‡å¹¶ä¸”æ”¾ç¼©</strong>ï¼Œæœ€ç»ˆçš„è¾“å‡ºçš„ç»´åº¦æ˜¯ï¼š<code>(B,W,2*D)</code>ã€‚è¿™å°±æ˜¯æœ€ç»ˆç”Ÿæˆçš„ELMoè¯å‘é‡ã€‚</li></ul><p>ä¸‹é¢æ¥å…·ä½“ä»‹ç»ä¸€ä¸‹æ¯ä¸€å±‚çš„ç»“æ„ã€‚</p><h3 id="Char-Encoder-Layer"><a href="#Char-Encoder-Layer" class="headerlink" title="Char Encoder Layer"></a>Char Encoder Layer</h3><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/1.png" style="zoom:80%;"></p><ul><li>char encoder layerçš„è¾“å…¥ç»´åº¦æ˜¯<code>(B,W,C)</code>ï¼Œç„¶åéœ€è¦è¢«reshapeä¸º<code>(B*W,C)</code>ã€‚ä¹‹åé’ˆå¯¹æ¯ä¸€ä¸ªtokençš„æ¯ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç ã€‚å­—ç¬¦è¡¨æ€»å…±æœ‰262ä¸ªï¼Œå…¶ä¸­ï¼Œ0-255æ˜¯unicodeç¼–ç ï¼Œå…¶ä½™çš„æ˜¯ï¼š<code>&lt;bos&gt;,&lt;eos&gt;,&lt;bow&gt;,&lt;eow&gt;,&lt;pow&gt;,&lt;pos&gt;</code>ã€‚å…¶ä¸­æ¯ä¸€ä¸ªå­—ç¬¦çš„embeddngçš„ç»´åº¦æ˜¯dã€‚æ‰€ä»¥ï¼Œæ•´ä¸ªè¯è¡¨çš„ç»´åº¦æ˜¯ï¼š<code>262*d</code>ã€‚ç»è¿‡char embeddingä¹‹åï¼Œè¾“å‡ºä¸ºï¼š<code>(B*W,C,d)</code>ã€‚</li><li>ç´§æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç»´å·ç§¯ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>å¹¶ä¸æ˜¯åœ¨çºµå‘ä¸Šå åŠ å¾ˆå¤šå·ç§¯å±‚ï¼Œè€Œæ˜¯åœ¨æ¨ªå‘ä¸Šä½¿ç”¨è‹¥å¹²ä¸ªä¸€ç»´å·ç§¯å±‚</strong>ã€‚åœ¨ELMoä¸­ï¼Œä½¿ç”¨äº†mä¸ªä¸€ç»´å·ç§¯ã€‚ä»¥ç¬¬ä¸€ä¸ªä¸ºä¾‹ï¼šå·ç§¯æ ¸ä¸ºk1ï¼Œä¸ªæ•°ä¸ºd1ï¼Œé‚£ä¹ˆä¸€ç»´å·ç§¯åå¾—åˆ°çš„ç»´åº¦æ˜¯ï¼š<code>(B*W,C1,d1)</code>ï¼›æ¥ç€ï¼Œå†ä½¿ç”¨maxpooling(ä¹‹æ‰€ä»¥è¦ä½¿ç”¨maxpoolingï¼Œæ˜¯å› ä¸ºç»è¿‡å·ç§¯ä¹‹åï¼Œå„ä¸ªå‘é‡ç»´åº¦å¯èƒ½ä¸ä¸€è‡´ï¼Œæ— æ³•åˆå¹¶ï¼Œæ‰€ä»¥æ‰éœ€è¦è¿›è¡Œpoolingæ“ä½œ)ï¼Œä»ä¸­é€‰æ‹©å‡ºæœ€å¤§çš„å•è¯ï¼Œå…¶ç»´åº¦å˜ä¸ºï¼š<code>(B*W,d1)</code>ï¼Œæœ€åå†ç»è¿‡æ¿€æ´»å‡½æ•°ï¼Œå°±å®Œæˆäº†ä¸€ä¸ªæ“ä½œã€‚</li><li>åœ¨å®Œæˆmä¸ªå·ç§¯æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å°†å¾—åˆ°çš„mä¸ªå‘é‡åœ¨dç»´è¿›è¡Œconcatï¼Œå¹¶ä¸”éœ€è¦reshapeï¼Œå³å¾—åˆ°çš„ç»´åº¦ä¸ºï¼š<code>(B,W,(d1+d2+d3+...+dm))</code>ã€‚</li><li>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ç»è¿‡è‹¥å¹²ä¸ªhighwayå±‚ã€‚æ‰€è°“çš„highwayå±‚çš„ä½œç”¨ä¸æ®‹å·®è¿æ¥æ˜¯ä¸€æ ·çš„ï¼Œèƒ½å¤Ÿè®©ç½‘ç»œè®­ç»ƒçš„æ•ˆç‡éšç€æ·±åº¦çš„å¢åŠ ä¸é™ä½ã€‚å…·ä½“çš„å…¬å¼è¯·å‚çœ‹highwayçš„åŸå§‹è®ºæ–‡ã€‚</li><li>æœ€åï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œå°†ç»´åº¦ä»<code>(B*W,(d1+d2+d3+...+dm))</code>å˜ä¸º<code>(B,W,D)</code>ã€‚è¿™é‡Œçš„<code>D</code>æ˜¯æœ€åæˆ‘ä»¬å¾—åˆ°çš„ELMoè¯å‘é‡ç»´åº¦çš„ä¸€åŠã€‚</li></ul><h3 id="biLSTM-layers"><a href="#biLSTM-layers" class="headerlink" title="biLSTM layers"></a>biLSTM layers</h3><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/2.png" style="zoom:80%;"></p><ul><li>biLSTM layersæ˜¯æ¥åœ¨ char encoder layerä¹‹åçš„ï¼Œå®ƒçš„è¾“å…¥ç»´åº¦æ˜¯ï¼š<code>(B,W,D)</code>ã€‚biLSTMç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œåœ¨è¿™é‡Œï¼Œå‡è®¾LSTMçš„ hidden stateçš„ç»´åº¦æ˜¯hï¼Œé‚£ä¹ˆLSTMçš„è¾“å‡ºæ˜¯<code>(B,W,h)</code>ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œå°†ç»´åº¦ä»<code>(B,W,h)</code>å˜æˆ<code>(B,W,D)</code>ã€‚ç”±äºæ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬concatä¹‹åï¼Œå¾—åˆ°çš„ä¸€å±‚çš„è¾“å‡ºæ˜¯ï¼š<code>(B,W,2D)</code>ã€‚</li><li><strong>æ³¨æ„ï¼Œåœ¨biLSTMå±‚ï¼Œæ¯ä¸€å±‚çš„LSTMçš„è¾“å‡ºä½œä¸ºä¸‹ä¸€å±‚LSTMçš„è¾“å…¥ã€‚å‡è®¾æœ‰Lå±‚biLSTMï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æœ€åå¾—åˆ°çš„è¾“å‡ºå‘é‡ä¸ªæ•°ä¸ºL+1ä¸ªï¼Œå› ä¸ºæœ€åˆçš„char encoder layerçš„è¾“å‡ºä¹Ÿè¦ç®—è¿›å»ã€‚</strong>æ‰€ä»¥biLSTM layersæœ€ç»ˆçš„è¾“å‡ºç»´åº¦æ˜¯ï¼š<code>(L+1,B,W,2D)</code>ã€‚</li></ul><p><strong>è¿™é‡Œéœ€è¦ç€é‡è®²ä¸€ä¸‹ELMoä¸­biLSTMçš„ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯å…¶ä¸BERTæœ€å¤§çš„ä¸åŒã€‚</strong></p><p>åœ¨ELMoä¸­ï¼Œå…¶å®æ˜¯è®­ç»ƒäº†ä¸¤ä¸ªæ­£åå‘çš„è¯­è¨€æ¨¡å‹ã€‚å‰å‘çš„è¯­è¨€æ¨¡å‹çš„æ¦‚ç‡å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(t_1,t_2,...,t_N)=\prod_{k=1}^{N}P(t_k|t_1,t_2,..,t_{k-1})</script><p>åå‘çš„è¯­è¨€æ¨¡å‹çš„æ¦‚ç‡å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(t_1,t_2,...,t_N)=\prod_{k=1}^{N}P(t_k|t_{k+1},t_{k+2},..,t_{N})</script><p>ELMoæ¨¡å‹çš„ç›®æ ‡å‡½æ•°æ˜¯ï¼š</p><script type="math/tex; mode=display">maximize \ \sum_{k=1}^{N}(logP(t_k|t_1,t_2,...,t_{k-1},\theta_x,\overrightarrow{\theta_{LSTM}},\theta_s)+logP(t_k|t_{k+1},t_{k+2},...,t_{N},\theta_x,\overleftarrow{\theta_{LSTM}},\theta_s))</script><p>å…¶ä¸­$\theta_x$è¡¨ç¤ºè¯åµŒå…¥çš„å‚æ•°ï¼›$\theta_s$è¡¨ç¤ºsoftmaxä¹‹å‰çš„å‚æ•°ï¼Œå³è¾“å‡ºå±‚çš„å‚æ•°ï¼›$\overrightarrow{\theta_{LSTM}},,\overleftarrow{\theta_{LSTM}}$è¡¨ç¤ºbiLSTMå±‚çš„å‚æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<strong>ELMoæ¨¡å‹æ˜¯åˆ†åˆ«è®­ç»ƒä¸¤ä¸ªLMï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„åŒå‘è¯­è¨€æ¨¡å‹ï¼Œè¿™å°±æ˜¯ELMoæ¨¡å‹ä¸BERTæœ€å¤§çš„åŒºåˆ«ã€‚</strong></p><h3 id="Scalar-Mixer"><a href="#Scalar-Mixer" class="headerlink" title="Scalar Mixer"></a>Scalar Mixer</h3><p>åœ¨biLSTM layersä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥åˆ°scalar mixerï¼Œå³åšä¸€ä¸ªå˜æ¢ï¼Œå¾—åˆ°æœ€ç»ˆçš„ELMoè¯å‘é‡ã€‚æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ¯ä¸€ä¸ªä½ç½®kï¼Œæ¯ä¸€å±‚éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå…³äºè¯å‘é‡çš„è¡¨ç¤º$\overrightarrow {h_{k,j}^{LM}}$ã€‚å…¶ä¸­ï¼Œjè¡¨ç¤ºç¬¬jå±‚ã€‚ä¸€ä¸ªLå±‚çš„biLSTMï¼Œä¼šç”Ÿæˆ2L+1ä¸ªè¯æ±‡è¡¨å¾ã€‚</p><script type="math/tex; mode=display">R_k=\{h_{k,j}^{LM}|j=0,...,L\},\\h_{k,j}^{LM}=[\overrightarrow {h_{k,j}^{LM}},\overleftarrow {h_{k,j}^{LM}}]</script><p>ç¬¬kä¸ªä½ç½®çš„æœ€ç»ˆçš„è¯å‘é‡å¦‚ä¸‹å…¬å¼ï¼š</p><script type="math/tex; mode=display">ELMo_k=\gamma\sum_{j=0}^{L}s_jh_{k,j}^{LM}</script><p>å…¶ä¸­ï¼Œ$s_j$è¡¨ç¤ºç»è¿‡softmaxä¹‹åçš„æ¦‚ç‡å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºå„ä¸ªå±‚çš„è¾“å‡ºçš„æƒé‡ï¼›å¸¸æ•°å‚æ•°$\gamma$æ˜¯ç¼©æ”¾å‚æ•°ï¼Œç”¨æ¥å¯¹æ•´ä¸ªELMoè¯å‘é‡è¿›è¡Œç¼©æ”¾ã€‚è¿™ä¸¤ä¸ªå‚æ•°æ˜¯éœ€è¦å­¦ä¹ çš„è¶…å‚æ•°ã€‚æ­¤å¤–ï¼Œ<strong>æ¯ä¸€å±‚çš„è¾“å‡ºçš„åˆ†å¸ƒä¼šæœ‰æ¯”è¾ƒå¤§çš„å·®åˆ«ï¼Œæœ‰æ—¶å€™ä½¿ç”¨layer normalizationã€‚</strong>ç»è¿‡ scalar mixerä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°çš„æœ€ç»ˆçš„ELMoè¯å‘é‡çš„çš„ç»´åº¦æ˜¯ï¼š<code>(B,W,2*D)</code>ã€‚</p><p>ä¹‹åå¦‚æœä»‹å…¥NLPä¸‹æ¸¸ä»»åŠ¡ï¼Œé‚£ä¹ˆå¯ä»¥å›ºå®šELMoæ¨¡å‹ï¼Œä¸è®©å…¶å‚ä¸è®­ç»ƒï¼Œä¹Ÿå¯ä»¥è®©ELMoæ¨¡å‹å‚ä¸è®­ç»ƒï¼Œå¯¹è¯å‘é‡æ¨¡å‹è¿›è¡Œfine-tuneã€‚</p><p><strong>æ€»ç»“ï¼ŒELMoçš„ä¼˜åŠ¿åœ¨äºï¼š</strong></p><ul><li>å¾—åˆ°çš„è¯å‘é‡æ›´å¥½ï¼Œè¯å‘é‡ä¸å…¶ä¸Šä¸‹æ–‡å†…å®¹æœ‰å…³ï¼Œèƒ½å¤Ÿè§£å†³å•è¯çš„å¤šä¹‰æ€§é—®é¢˜ï¼›</li><li>ä½¿ç”¨äº†æ·±å±‚ç½‘ç»œçš„æ‰€æœ‰çš„è¾“å‡ºï¼Œæ¯”åªæ˜¯ç”¨é¡¶å±‚çš„LSTM layeræ›´å¥½ï¼›å…·ä½“æ¥è¯´ï¼Œä½å±‚çš„LSTM layerèƒ½å¤Ÿè¡¨ç¤ºå•è¯çš„è¯­æ³•ä¿¡æ¯ï¼›é«˜å±‚çš„LSTM layerèƒ½å¤Ÿè¡¨ç¤ºå•è¯çš„è¯­ä¹‰ä¿¡æ¯ï¼›</li><li>åŸºäºå­—ç¬¦è¿›è¡Œembeddingï¼Œè§£å†³äº†OOVé—®é¢˜ã€‚<strong>ä½†æ˜¯æ³¨æ„ï¼Œæˆ‘ä»¬æœ€åå¾—åˆ°çš„æ˜¯è¯å‘é‡ï¼</strong></li></ul><h2 id="GPTæ¨¡å‹ä»‹ç»"><a href="#GPTæ¨¡å‹ä»‹ç»" class="headerlink" title="GPTæ¨¡å‹ä»‹ç»"></a>GPTæ¨¡å‹ä»‹ç»</h2><p>GPTæ¨¡å‹ï¼Œå…¨ç§°ï¼šGenerative Pre-Trainingã€‚å®ƒçš„æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<strong>1.æ— ç›‘ç£çš„é¢„è®­ç»ƒï¼›2.æœ‰ç›‘ç£çš„å¾®è°ƒã€‚</strong>ä¸‹é¢ä¾æ¬¡ä»‹ç»è¿™ä¸¤ä¸ªé˜¶æ®µã€‚</p><h3 id="pre-training"><a href="#pre-training" class="headerlink" title="pre-training"></a>pre-training</h3><p>GPTæ¨¡å‹ï¼Œé‡‡ç”¨çš„æ˜¯Transformerçš„ decoderéƒ¨åˆ†ä½œä¸ºlanguage modelï¼Œä½†æ˜¯ç¨å¾®æœ‰ç‚¹ä¸åŒï¼šå…¶å»æ‰äº†encoder-decoder attention layerã€‚å®ƒçš„ç›®æ ‡å‡½æ•°æ˜¯ï¼š</p><script type="math/tex; mode=display">maximize \ L_1= \sum_{i}logP(u_i|u_{i-k},u_{i-k+1},...,u_{i-1};\theta)</script><p>è¿™å°±æ˜¯ä¸€èˆ¬çš„LMçš„ç›®æ ‡å‡½æ•°ã€‚å…¶ä¸­ï¼Œ$k$è¡¨ç¤ºçš„æ˜¯context windowã€‚(ä½¿ç”¨äº†markovå‡è®¾ï¼Ÿ) $\theta$è¡¨ç¤ºç½‘ç»œçš„å‚æ•°ï¼›æˆ‘ä»¬ä½¿ç”¨SGDæ¥è¿›è¡Œè®­ç»ƒã€‚</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/3.jpg" alt></p><p>ä¸Šå›¾å°±æ˜¯GPTçš„æ¨¡å‹ã€‚å·¦è¾¹å°±æ˜¯ä½¿ç”¨transformerçš„å»æ‰äº†encoder-decoder attention layerçš„decoderã€‚æ³¨æ„ï¼Œ<strong>æ—¢ç„¶ä½¿ç”¨äº†decoderéƒ¨åˆ†ï¼Œé‚£ä¹ˆç½‘ç»œåœ¨é¢„æµ‹å½“å‰è¯çš„æ—¶å€™ï¼Œå°±ä¸èƒ½çœ‹åˆ°æœªæ¥çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•å¹¶è¡ŒåŒ–æ“ä½œã€‚</strong>å¦‚æœä½¿ç”¨å…¬å¼æ¥è¡¨ç¤ºçš„è¯ï¼Œåˆ™æœ‰ï¼š</p><script type="math/tex; mode=display">h_0=UW_e+W_p \\h_l=transformer_block(h_{l-1}),l\in[1,L]       \\P(u)=softmax(h_LW)</script><h3 id="fine-tune"><a href="#fine-tune" class="headerlink" title="fine-tune"></a>fine-tune</h3><p>ä»¥åˆ†ç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨LMå¾—åˆ°æœ€åä¸€æ­¥çš„è¾“å‡ºä¹‹åï¼Œæˆ‘ä»¬å†æ¥ä¸Šä¸€ä¸ªçº¿æ€§å±‚ã€‚è­¬å¦‚ç°åœ¨æœ‰ä¸€ä¸ªå¥å­ï¼Œè¡¨ç¤ºä¸ºï¼š$(x_1,x_2,â€¦,x_m)$ï¼Œå…¶æ ‡ç­¾ä¸º$y$ã€‚æˆ‘ä»¬ä½¿ç”¨LMå¾—åˆ°æœ€åä¸€ä¸ªè¾“å‡ºæ˜¯$h_l^m$ï¼Œåœ¨å°†å…¶å–‚å…¥ä¸€ä¸ªçº¿æ€§å±‚ï¼Œä»è€Œå¾—åˆ°ç»“æœï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(y|x_1,x_2,...,x_m)=softmax(h_l^mW_y)</script><p>ç›®æ ‡å‡½æ•°å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">maximize \ L_2=\sum_{x,y}logP(y|x_1,x_2,...,x_m)</script><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°†LMä½œä¸ºä¸€ä¸ªè¾…åŠ©çš„ç›®æ ‡å‡½æ•°ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰ä¸¤ä¸ªï¼š1. æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼›2. åŠ é€Ÿæ”¶æ•›ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">maximize \ L_3=L_2+\lambda L_1</script><p>æ¨¡å‹çš„ä¸€äº›ä¿®æ­£ç»†èŠ‚ï¼š</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/4.jpg" alt></p><p><strong>æ€»ç»“ï¼ŒGPTæ¨¡å‹çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š</strong></p><ul><li>ä½¿ç”¨äº†transformerè€Œä¸æ˜¯biLSTMï¼Œè¿™æ ·å¤§å¤§å¢å¼ºäº†æ¨¡å‹çš„æ•æ‰ä¾èµ–å…³ç³»çš„èƒ½åŠ›ï¼›</li><li>GPTæ˜¯æŠŠæ¨¡å‹æ¥å…¥åˆ°ä¸‹æ¸¸ä»»åŠ¡è¿›è¡Œè®­ç»ƒï¼Œå¯ä»¥åŠ ä¸ŠåŸæ¥çš„LMä½œä¸ºè¾…åŠ©ç›®æ ‡å‡½æ•°ã€‚ä¸ä¾§é‡ç”Ÿæˆofflineçš„è¯å‘é‡ã€‚</li></ul><h2 id="BERTæ¨¡å‹ä»‹ç»"><a href="#BERTæ¨¡å‹ä»‹ç»" class="headerlink" title="BERTæ¨¡å‹ä»‹ç»"></a>BERTæ¨¡å‹ä»‹ç»</h2><p>ç»ˆäºå†™åˆ°BERTå•¦ï¼Œå“ˆå“ˆå“ˆã€‚BERTå¯ä»¥è¯´æ˜¯å¸¦ç«äº†é¢„è®­ç»ƒæ¨¡å‹ï¼ŒBERTç³»ç°åœ¨å¤§æœ‰ç»Ÿä¸€NLPä¹‹åŠ¿å•Šã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ï¼ğŸ¤©</p><p>BERTæ¨¡å‹ï¼Œå…¨ç§°å«åšï¼šBidirectional Encoder Representations from Transformersã€‚ä»åå­—çœ‹å°±å¾ˆç›´è§‚ï¼ŒBERTæ˜¯åŒå‘transformerçš„encoderéƒ¨åˆ†ã€‚å®ƒæ‰€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼šä¸ç®¡ELMoè¿˜æ˜¯GPTï¼Œè¯­è¨€æ¨¡å‹éƒ½æ˜¯å•å‘çš„ï¼Œè€ŒBERTçš„ä½œè€…å‘ç°ï¼Œå•å‘è¯­è¨€æ¨¡å‹é™åˆ¶äº†fine-tuningçš„è¡¨è¾¾èƒ½åŠ›ã€‚æ‰€ä»¥ï¼Œ<strong>BERTæ‰€é‡‡å–çš„æ–¹å¼æ˜¯ï¼šä½¿ç”¨åŒå‘çš„Transformerçš„encoderéƒ¨åˆ†è¿›è¡Œé¢„è®­ç»ƒï¼Œå¹¶é‡‡ç”¨MLMä¸NSPä¸¤ç§ä»»åŠ¡å¯¹BERTè¿›è¡Œpre-trainingï¼Œä¹‹ååœ¨å¯¹æ¥ä¸‹æ¸¸ä»»åŠ¡çš„æ—¶å€™ï¼Œfine-tuningã€‚</strong></p><h3 id="è¾“å…¥æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è¾“å…¥æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¾“å…¥æ˜¯ä»€ä¹ˆï¼Ÿ"></a>è¾“å…¥æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>BERTçš„è¾“å…¥ï¼Œå¯ä»¥æ˜¯å•ä¸ªå¥å­ï¼Œä¹Ÿå¯ä»¥æ˜¯å¥å­å¯¹ã€‚<strong>ä½†æ˜¯åœ¨é¢„è®­ç»ƒçš„æ—¶å€™ï¼Œå®é™…ä¸Šéƒ½æ˜¯è¾“å…¥çš„å¥å­å¯¹ã€‚</strong>åœ¨BERTä¸­ï¼Œä½¿ç”¨çš„æ˜¯BPE vocabularyï¼Œsizeä¸º30000ï¼Œæœ€é•¿çš„è¾“å…¥é•¿åº¦ä¸º512ã€‚ä¹‹æ‰€ä»¥æ˜¯512ï¼Œæ˜¯ä¸ºäº†å‡å°‘paddingçš„è®¡ç®—æµªè´¹ã€‚è¿™ä¸ªåœ¨æºç ä¸­å¯ä»¥çœ‹åˆ°ã€‚</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/5.jpg" alt></p><p>è¿™æ˜¯BERTçš„è¾“å…¥ï¼Œæœ‰ä¸‰éƒ¨åˆ†ï¼š<strong>token embedding</strong>ï¼Œå°±æ˜¯æ¯ä¸€ä¸ªtokençš„embeddingï¼Œè¿™ä¸ªå¯ä»¥ä½¿ç”¨ word2vecçš„ç»“æœï¼Œä¹Ÿå¯ä»¥éšæœºåˆå§‹åŒ–ï¼›<strong>segment embedding</strong>ï¼Œå°±æ˜¯å°±æ¥åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼›<strong>position embedding</strong>ï¼Œå°±æ˜¯ç”¨æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªtokençš„ä½ç½®ä¿¡æ¯ï¼Œå’Œtransformerä¸€æ ·ã€‚<strong>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¥å­çš„ç¬¬ä¸€ä¸ªtokenä¸€å®šæ˜¯CLSï¼Œè¿™æ˜¯ä¸ºäº†ç»™åé¢åšåˆ†ç±»å‡†å¤‡çš„ï¼Œå®é™…ä¸Šæ˜¯NSPä»»åŠ¡æ¥è®­ç»ƒCLS tokençš„ã€‚</strong></p><p>BERTä¸­ç»™çš„ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">This text is included to make sure Unicode is handled properly: åŠ›åŠ å‹åŒ—åŒºá´µá´ºáµ€áµƒà¦›à¦œà¦Ÿà¦¡à¦£à¦¤</span><br><span class="line">Text should be one-sentence-per-line, with empty lines between documents.</span><br><span class="line">This sample text is public domain and was randomly selected from Project Guttenberg.</span><br><span class="line"></span><br><span class="line">The rain had only ceased with the gray streaks of morning at Blazing Star, and the settlement awoke to a moral sense of cleanliness, and the finding of forgotten knives, tin cups, and smaller camp utensils, where the heavy showers had washed away the debris and dust heaps before the cabin doors.</span><br><span class="line">Indeed, it was recorded in Blazing Star that a fortunate early riser had once picked up on the highway a solid chunk of gold quartz which the rain had freed from its incumbering soil, and washed into immediate and glittering popularity.</span><br><span class="line">Possibly this may have been the reason why early risers in that locality, during the rainy season, adopted a thoughtful habit of body, and seldom lifted their eyes to the rifted or india-ink washed skies above them.</span><br><span class="line">&quot;Cass&quot; Beard had risen early that morning, but not with a view to discovery.</span><br><span class="line">A leak in his cabin roof,--quite consistent with his careless, improvident habits,--had roused him at 4 A. M., with a flooded &quot;bunk&quot; and wet blankets.</span><br><span class="line">The chips from his wood pile refused to kindle a fire to dry his bed-clothes, and he had recourse to a more provident neighbor&#39;s to supply the deficiency.</span><br><span class="line">This was nearly opposite.</span><br><span class="line">Mr. Cassius crossed the highway, and stopped suddenly.</span><br><span class="line">Something glittered in the nearest red pool before him.</span><br><span class="line">Gold, surely!</span><br><span class="line">But, wonderful to relate, not an irregular, shapeless fragment of crude ore, fresh from Nature&#39;s crucible, but a bit of jeweler&#39;s handicraft in the form of a plain gold ring.</span><br><span class="line">Looking at it more attentively, he saw that it bore the inscription, &quot;May to Cass.&quot;</span><br><span class="line">Like most of his fellow gold-seekers, Cass was superstitious.</span><br><span class="line"></span><br><span class="line">The fountain of classic wisdom, Hypatia herself.</span><br><span class="line">As the ancient sage--the name is unimportant to a monk--pumped water nightly that he might study by day, so I, the guardian of cloaks and parasols, at the sacred doors of her lecture-room, imbibe celestial knowledge.</span><br><span class="line">From my youth I felt in me a soul above the matter-entangled herd.</span><br><span class="line">She revealed to me the glorious fact, that I am a spark of Divinity itself.</span><br><span class="line">A fallen star, I am, sir!&#39; continued he, pensively, stroking his lean stomach--&#39;a fallen star!--fallen, if the dignity of philosophy will allow of the simile, among the hogs of the lower world--indeed, even into the hog-bucket itself. Well, after all, I will show you the way to the Archbishop&#39;s.</span><br><span class="line">There is a philosophic pleasure in opening one&#39;s treasures to the modest young.</span><br><span class="line">Perhaps you will assist me by carrying this basket of fruit?&#39; And the little man jumped up, put his basket on Philammon&#39;s head, and trotted off up a neighbouring street.</span><br><span class="line">Philammon followed, half contemptuous, half wondering at what this philosophy might be, which could feed the self-conceit of anything so abject as his ragged little apish guide;</span><br><span class="line">but the novel roar and whirl of the street, the perpetual stream of busy faces, the line of curricles, palanquins, laden asses, camels, elephants, which met and passed him, and squeezed him up steps and into doorways, as they threaded their way through the great Moon-gate into the ample street beyond, drove everything from his mind but wondering curiosity, and a vague, helpless dread of that great living wilderness, more terrible than any dead wilderness of sand which he had left behind.</span><br><span class="line">Already he longed for the repose, the silence of the Laura--for faces which knew him and smiled upon him; but it was too late to turn back now.</span><br><span class="line">His guide held on for more than a mile up the great main street, crossed in the centre of the city, at right angles, by one equally magnificent, at each end of which, miles away, appeared, dim and distant over the heads of the living stream of passengers, the yellow sand-hills of the desert;</span><br><span class="line">while at the end of the vista in front of them gleamed the blue harbour, through a network of countless masts.</span><br><span class="line">At last they reached the quay at the opposite end of the street;</span><br><span class="line">and there burst on Philammon&#39;s astonished eyes a vast semicircle of blue sea, ringed with palaces and towers.</span><br><span class="line">He stopped involuntarily; and his little guide stopped also, and looked askance at the young monk, to watch the effect which that grand panorama should produce on him.</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯BERTç»™çš„ä¾‹å­çš„è¾“å…¥ã€‚BERTå¯¹ä¸è¾“å…¥çš„æ–‡æœ¬çš„è¦æ±‚æ˜¯ï¼š<strong>1. ä¸€ä¸ªå¥å­ä¸€è¡Œï¼›2. ä¸åŒæ–‡ç« ä¹‹é—´ç©ºä¸€è¡Œï¼Œé˜²æ­¢è·¨æ–‡ç« è¯»å–ã€‚</strong>é‚£ä¹ˆï¼Œå¤„ç†åŸå§‹æ–‡æœ¬ä¹‹åï¼Œå¾—åˆ°çš„è¾“å‡ºæœ‰ï¼š</p><ul><li>tokensï¼šåŒ…æ‹¬äº†æ™®é€šçš„tokenï¼Œä»¥åŠCLSã€SEPã€MASKã€‚</li><li>segment_idï¼š0è¡¨ç¤ºæ˜¯ç¬¬ä¸€å¥è¯ï¼Œ1è¡¨ç¤ºç¬¬äºŒå¥è¯</li><li>is_random_nextï¼šæ˜¯å¦ä¸ºä¸‹ä¸€å¥ï¼ŒNSPäººç‰©çš„label</li><li>masked_lm_positionsï¼šè¢«MASKçš„tokençš„ä½ç½®</li><li>masked_lm_labelsï¼šè¢«MASKçš„tokençš„åŸæœ¬çš„å€¼</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tokens: [CLS] for more than a [MASK] up [MASK] great main street , [MASK] [MASK] [MASK] centre of the city , at right angles , [MASK] one equally magnificent , at each end ##ãƒŸ which , miles away , appeared , dim and distant over the heads of the living stream of passengers , the yellow [MASK] - hills of [MASK] [MASK] ; while at the end of the vista in front [MASK] them gleamed the blue harbour , through a network [SEP] possibly this may have been the reason why early rise ##rs in [MASK] locality , during the rainy season , adopted [MASK] [MASK] [MASK] of body , and seldom lifted [MASK] eyes [MASK] the rift [MASK] or india - ink washed skies above them . [SEP]</span><br><span class="line">segment_ids: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span><br><span class="line">is_random_next: True</span><br><span class="line">masked_lm_positions: 5 7 12 13 14 24 32 55 59 60 71 94 103 104 105 109 112 114 117</span><br><span class="line">masked_lm_labels: mile the crossed in the by of sand the desert of that a thoughtful habit and their to ##ed</span><br></pre></td></tr></table></figure><h3 id="pre-training-1"><a href="#pre-training-1" class="headerlink" title="pre-training"></a>pre-training</h3><p><strong>Masked Language Model</strong></p><p>æ ‡å‡†çš„è¯­è¨€æ¨¡å‹ï¼Œæ˜¯å•å‘çš„ï¼Œåªèƒ½æ ¹æ®ä¹‹å‰çš„æ‰€æœ‰è¯æ¥é¢„æµ‹å½“å‰è¯ã€‚åœ¨BERTä¸­ï¼Œä½¿ç”¨çš„æ˜¯åŒå‘çš„transformerçš„encoderï¼Œè¿™æ ·ä¸å°±è®©å•è¯èƒ½å¤Ÿçœ‹åˆ°æœªæ¥çš„å†…å®¹äº†å—ï¼ŸBERTçš„å¤„ç†æ–¹å¼å°±æ˜¯ä½¿ç”¨MLMã€‚MLMçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>éšæœºmaskæ‰å¥å­çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œç„¶åä½¿ç”¨ä¸Šä¸‹æ–‡æ¥é¢„æµ‹è¢«maskçš„è¯ã€‚</strong>åœ¨è®ºæ–‡ä¸­ï¼Œå…·ä½“çš„æ˜¯maskæ‰å¥å­çš„15%çš„tokenã€‚ä½†æ˜¯è¿™æ ·åšå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨fine-tuneä¸­ï¼Œæ¨¡å‹å¯èƒ½ä¼šä»æ¥æ²¡è§è¿‡maskæ‰çš„è¯ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¸fine-tuneçš„è¾“å…¥åˆ†å¸ƒä¸ä¸€æ ·ï¼Œä¸ºäº†å‡å°è¿™ä¸ªé—®é¢˜ã€‚è®ºæ–‡ä¸­æå‡ºï¼Œåœ¨æ¯æ¬¡é€‰å®šä¸€ä¸ªå•è¯è¿›è¡Œmaskçš„æ—¶å€™ï¼š</p><ul><li>æœ‰80%çš„æ¦‚ç‡ï¼Œä½¿ç”¨MASKæ›¿æ¢ï¼›</li><li>æœ‰10%çš„æ¦‚ç‡ï¼Œéšæœºé€‰å®šä¸€ä¸ªtokenè¿›è¡Œæ›¿æ¢ï¼›(åŠ å…¥å™ªå£°ï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ å…·æœ‰é²æ£’æ€§)</li><li>æœ‰10%çš„æ¦‚ç‡ï¼Œä¿æŒåŸæ ·ã€‚(ä¸ºäº†èƒ½å¤Ÿé è¿‘fine-tuneçš„è¾“å…¥åˆ†å¸ƒ)</li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡å‹æ¯æ¬¡åªé¢„æµ‹15%çš„tokenï¼Œæ‰€ä»¥æ”¶æ•›çš„é€Ÿåº¦ä¼šéå¸¸æ…¢ï¼Œè¿™ä¹Ÿæ˜¯BERTçš„ç¼ºé™·ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯åæ¥XLNetæå‡ºçš„åŸå› ä¹‹ä¸€ã€‚</p><p><strong>Next Sentence Prediction</strong></p><p>ä¹‹æ‰€ä»¥è®¾è®¡è¿™ä¸ªä»»åŠ¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³éœ€è¦ç¡®å®šå¥å­å¯¹ä¹‹é—´çš„å…³ç³»çš„ä»»åŠ¡è€Œè®¾è®¡çš„ï¼Œè­¬å¦‚QAã€æ–‡æœ¬è•´å«ã€NLIç­‰ç­‰ã€‚å› ä¸ºä½œè€…è®¤ä¸ºLMé‡Œé¢å­¦ä¸åˆ°è¿™æ ·çš„çŸ¥è¯†ã€‚è¿™ä¸ªä»»åŠ¡è¦åšçš„æ˜¯ï¼šé¢„æµ‹åé¢ä¸€ä¸ªå¥å­æ˜¯ä¸æ˜¯å‰é¢ä¸€ä¸ªå¥å­çš„ä¸‹ä¸€å¥ã€‚å…·ä½“çš„åšæ³•æ˜¯ï¼š<strong>ä»¥50%çš„æ¦‚ç‡é€‰æ‹©ä¸€ä¸ªå¥å­æ˜¯å‰é¢ä¸€ä¸ªå¥å­çš„ä¸‹ä¸€å¥ï¼Œlabelæ˜¯ï¼šisNextï¼›ä»¥50%çš„æ¦‚ç‡é€‰æ‹©ä¸æ˜¯å‰é¢ä¸€ä¸ªå¥å­çš„ä¸‹ä¸€å¥çš„å¥å­ï¼Œlabelæ˜¯ï¼šNotNextã€‚</strong>(ç„¶è€Œï¼Œå®éªŒè¯æ˜ï¼ŒNSPä»»åŠ¡å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæ‰€ä»¥ï¼Œåæ¥ALBERTæ”¹è¿›äº†NSPä»»åŠ¡ï¼Œäº§ç”Ÿäº†å¾ˆå¥½çš„æ•ˆæœã€‚)</p><h3 id="fine-tuning"><a href="#fine-tuning" class="headerlink" title="fine-tuning"></a>fine-tuning</h3><p>fine-tuningä¸GPTæ²¡ä»€ä¹ˆå¤§çš„ä¸ç—›ï¼Œéƒ½æ˜¯æ ¹æ®ä¸‹æ¸¸ä»»åŠ¡æ›´æ”¹å¾ˆå°‘çš„é¡¶å±‚å‚æ•°ã€‚å¯¹äºåˆ†ç±»ä»»åŠ¡ï¼ŒåªåŠ äº†ä¸€å±‚åˆ†ç±»å±‚ã€‚</p><p><strong>æ€»ç»“ï¼ŒBERTæ¨¡å‹çš„ä¼˜åŠ¿ï¼š</strong></p><ul><li>ä½¿ç”¨äº†transformerçš„encoderéƒ¨åˆ†ï¼Œç‰¹å¾æŠ½å–èƒ½åŠ›æ¯”lstmè¦å¼ºï¼›</li><li>ä½¿ç”¨äº†MLMï¼Œæ˜¯çœŸæ­£çš„åŒå‘è¯­è¨€æ¨¡å‹ï¼Œèƒ½å¤Ÿä½¿ç”¨ä¸Šä¸‹æ–‡çš„ä¿¡æ¯æ¥é¢„æµ‹è¢«MASKæ‰çš„å•è¯ã€‚</li></ul><h2 id="XLNetæ¨¡å‹ä»‹ç»"><a href="#XLNetæ¨¡å‹ä»‹ç»" class="headerlink" title="XLNetæ¨¡å‹ä»‹ç»"></a>XLNetæ¨¡å‹ä»‹ç»</h2><p>XLNetæ¨¡å‹æ˜¯å¯¹BERTæ¨¡å‹æ”¶æ•›å¤ªæ…¢çš„æ”¹è¿›ï¼Œå½“ç„¶ï¼ŒXLNetæ¨¡å‹å¹¶ä¸åªæ˜¯è¿™äº›ã€‚åœ¨äº†è§£XLNetæ¨¡å‹ä¹‹å‰ï¼Œéœ€è¦å»äº†è§£transformer-xlè¿™ä¸ªæ¨¡å‹ï¼Œå› ä¸ºï¼ŒXLNetæ¨¡å‹å°±æ˜¯åŸºäºtransformer-xlè€Œå¾—æ¥çš„ã€‚è¿™é‡Œï¼Œæˆ‘å°±ä¸å…·ä½“è®²transformer-xlï¼Œç®€å•æä¸€ä¸‹transformer-xlç›¸è¾ƒäºtransformerçš„æ”¹è¿›çš„åœ°æ–¹å§ï¼Œæœ‰å…´è¶£çš„ç­’å­ä»¬å¯ä»¥è‡ªå·±å»çœ‹transformer-xlçš„åŸå§‹è®ºæ–‡ï½ï¼ˆ<strong>æ³¨æ„ï¼Œç›®å‰åŸºæœ¬æ²¡æœ‰å»¶ç»­XLNetçš„ç ”ç©¶ï¼Œæ‰€ä»¥è¿™å—å¤§å®¶å¦‚æœä¸æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ä¸å»ç»†çœ‹ï¼›å½“ç„¶ä¹Ÿå¯ä»¥ä»”ç»†ç ”ç©¶ï¼Œè¯´ä¸å®šåœ¨è¿™ä¸Šé¢å°±èƒ½æå‡ºæ–°ç‚¹å­ä¹Ÿè¯´ä¸å®šå“ˆå“ˆï½</strong>ï¼‰</p><ul><li>transformer-xlæ˜¯åŸºäºvanilla transformerçš„å¾—æ¥çš„ã€‚vanilla transformerçš„è®­ç»ƒæ–¹å¼æ˜¯ï¼šå°†è®­ç»ƒæ–‡æœ¬è¿›è¡Œåˆ†æ®µï¼Œåœ¨æ¯ä¸€æ®µä¸­åˆ†åˆ«å»è®­ç»ƒLMã€‚åœ¨é¢„æµ‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨limited contextæ¥é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ï¼Œæ²¡é¢„æµ‹å®Œä¸€ä¸ªå•è¯ï¼Œå°±è®²windowå‘å³ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ã€‚è¿™æ ·åšçš„ç¼ºç‚¹åœ¨äºï¼š<strong>1.å•è¯çš„ä¸Šä¸‹æ–‡çš„é•¿åº¦å—é™ï¼Œåœ¨åŸå§‹è®ºæ–‡ä¸­ï¼Œåªèƒ½å¤„ç†512é•¿åº¦çš„è¾“å…¥æ–‡æœ¬ï¼›2. æ¨ç†é€Ÿåº¦éå¸¸æ…¢ï¼Œæ¯æ¬¡é¢„æµ‹ä¸€ä¸ªå•è¯ï¼Œéƒ½è¦é‡æ–°è®¡ç®—ï¼›3.æ®µä¸æ®µä¹‹é—´æ²¡æœ‰ä¸Šä¸‹æ–‡ä¾èµ–æ€§ï¼Œå½±å“æ¨¡å‹æ€§èƒ½ã€‚</strong>transformer-xlåœ¨æ­¤åŸºç¡€ä¸Šå¼•å…¥äº†ä¸¤ä¸ªä¸¤ä¸ªæœºåˆ¶ï¼š<strong>å¾ªç¯æœºåˆ¶ä¸ç›¸å¯¹ä½ç½®ç¼–ç ã€‚</strong></li><li><strong>å¾ªç¯æœºåˆ¶ã€‚</strong>å¾ªç¯æœºåˆ¶çš„å¼•å…¥æ˜¯ä¸ºäº†è§£å†³æ®µä¸æ®µä¹‹é—´æ²¡æœ‰ä¸Šä¸‹æ–‡ä¾èµ–æ€§ã€‚å®ƒèƒ½å¤Ÿè®©å½“å‰æ®µåœ¨è¿›è¡ŒLMå»ºæ¨¡çš„æ—¶å€™ï¼Œèƒ½å¤Ÿåˆ©ç”¨ä¹‹å‰æ®µçš„ä¿¡æ¯ï¼Œä»è€Œå®ç°é•¿æœŸä¾èµ–æ€§ã€‚åœ¨é¢„æµ‹çš„æ—¶å€™ï¼Œå°±å¯ä»¥å‰è¿›ä¸€æ•´æ®µï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨ä¹‹å‰æ®µçš„ä¿¡æ¯æ¥é¢„æµ‹å½“å‰çš„è¾“å‡ºã€‚</li><li><strong>ç›¸å¯¹ä½ç½®ç¼–ç ã€‚</strong>åœ¨æ™®é€šçš„transformerä¸­ï¼Œä½¿ç”¨å›ºå®šçš„position embeddingæ¥è¡¨ç¤ºtokenä¹‹é—´çš„é¡ºåºå…³ç³»ï¼Œä½†æ˜¯å¦‚æœåˆ†æ®µå¤„ç†çš„è¯ï¼Œé‚£ä¹ˆï¼Œä¸åŒåˆ†æ®µçš„åŒä¸€ä½ç½®ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªposition embeddingï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚æ‰€ä»¥ï¼Œåœ¨transformer-xlä¸­ï¼Œæå‡ºæ–°çš„ä½ç½®ç¼–ç æ–¹å¼ï¼š<strong>ç›¸å¯¹ä½ç½®ç¼–ç ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ ¹æ®å•è¯çš„ç›¸å¯¹ä½ç½®è¿›è¡Œç¼–ç ï¼Œè€Œä¸æ˜¯åƒtransformerçš„é‚£æ ·ï¼ŒæŒ‰ç…§ç»å¯¹ä½ç½®è¿›è¡Œç¼–ç ã€‚æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç»“è®ºæ˜¯ï¼š<strong>transformer-xlçš„é•¿æœŸä¾èµ–æ€§æ¯”LSTMé«˜å‡º80%(LSTMå¹³å‡ä¸Šä¸‹æ–‡é•¿åº¦200ä¸ªå·¦å³)ï¼Œæ¯”transformeré«˜å‡º450%ï¼ï¼ˆtransformerå¹³å‡ä¸Šä¸‹æ–‡é•¿åº¦ä½äº50ï¼‰æ˜¯ä¸æ˜¯éå¸¸ç‰›é€¼ï¼</strong></li></ul><p>ä»¥ä¸Šå°±æ˜¯transformer-xlçš„å¤§è‡´å†…å®¹ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œæƒ³è¦äº†è§£å…¨éƒ¨å†…å®¹ï¼Œè¯·è¯»transformer-xlçš„åŸå§‹è®ºæ–‡ï¼Œå…¶å®åªè¦çœ‹æ‡‚äº†transformerçš„è¯ï¼Œtransformer-xlå†³å®šå°èœä¸€ç¢ŸğŸ¤©ï½æ¥ä¸‹æ¥æ­£å¼è®²XLNetæ¨¡å‹çš„å†…å®¹ï½</p><p><strong>è¯­è¨€æ¨¡å‹ç›®æ ‡ï¼šæ’åˆ—è¯­è¨€å»ºæ¨¡</strong></p><p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ä»…å¯ä»¥ä¿ç•™ARæ¨¡å‹çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æ¨¡å‹æ•è·åŒå‘ä¿¡æ¯ã€‚ä»æ‰€æœ‰çš„æ’åˆ—ä¸­é‡‡æ ·ä¸€ç§ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ’åˆ—æ¥åˆ†è§£è”åˆæ¦‚ç‡æˆæ¡ä»¶æ¦‚ç‡çš„ä¹˜ç§¯ï¼Œç„¶ååŠ èµ·æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åˆ†è§£çš„é¡ºåºä¸ä¸€æ ·ï¼Œæˆ‘ä»¬è®¡ç®—çš„é¡ºåºä¹Ÿå°±ä¸ä¸€æ ·ã€‚</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/20.jpg" style="zoom:67%;"></p><p><strong>æ¨¡å‹æ¶æ„ï¼šåŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›</strong></p><p>è¿™ä¸ªè¿˜æ²¡å…·ä½“ç»†çœ‹ï¼Œå¤§è‡´æ„æ€æ˜¯ï¼šåœ¨teansformeré‡Œé¢ï¼Œä½¿ç”¨äº†token embedding+position embeddingã€‚ä½†æ˜¯å¦‚æœæˆ‘è¦é¢„æµ‹ç¬¬3ä¸ªä½ç½®çš„å•è¯çš„å†…å®¹ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä¸èƒ½æå‰è·å–åˆ°ç¬¬3ä¸ªä½ç½®çš„å†…å®¹å‘é‡(token embedding)ï¼Œåªèƒ½åªå…¶ä½ç½®å‘é‡(position embedding)ï¼Œä½†æ˜¯è¿™åœ¨è¾“å…¥çš„æ—¶å€™ï¼Œä¸¤ä¸ªå‘é‡å°±å·²ç»æ··åœ¨ä¸€èµ·äº†ã€‚æ‰€ä»¥åœ¨XLNetä¸­ï¼Œå°±è®¡ç®—äº†ä¸¤å¥—æ³¨æ„åŠ›ï¼Œä¸€ä¸ªåªåŒ…å«å®ƒçš„ä½ç½®ä¿¡æ¯ï¼Œä¸€ä¸ªè¦åŒ…å«å®ƒçš„ä½ç½®ä¿¡æ¯ä¸å†…å®¹ä¿¡æ¯ï¼Œä»¥ä¾¿ä½¿ç”¨ã€‚å…·ä½“çš„ï¼Œç­‰æˆ‘é‚£å¤©æœ‰æ—¶é—´äº†åœ¨å…·ä½“å†™å§ã€‚ã€‚ã€‚</p><h2 id="ERNIEæ¨¡å‹ä»‹ç»"><a href="#ERNIEæ¨¡å‹ä»‹ç»" class="headerlink" title="ERNIEæ¨¡å‹ä»‹ç»"></a>ERNIEæ¨¡å‹ä»‹ç»</h2><p>ERNIEæ˜¯THUä¸åä¸ºè¯ºäºšä¸€èµ·æå‡ºæ¥çš„é’ˆå¯¹äºä¸­æ–‡çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚(è¿™é‡Œä¸å¾—ä¸ä½©æœä¸€æ³¢éš”å£ï¼ŒNLPåšçš„æ˜¯çœŸä¸é”™ï¼Œå°åŒ—è¦è·Ÿä¸Šå•Šï¼ğŸ§)ï¼ˆå‘ç°ç™¾åº¦ä¹Ÿæå‡ºäº†ERNIEï¼Œé‡åäº†ï¼Œè€Œä¸”ä¼¼ä¹æ˜¯ç™¾åº¦å…ˆæå‡ºæ¥çš„ï¼Œå¥½å§ï¼Œé‚£å°±å†çœ‹ä¸€ç¯‡å§ğŸ˜­ï¼Œä¼¼ä¹ç™¾åº¦è¿™ç¯‡è¯»çš„æ¯”è¾ƒé¡ºç•…ï¼ï¼‰</p><p>ERNIEæ¨¡å‹æå‡ºçš„åŸå› ï¼š<strong>BERTç­‰æ¨¡å‹åªæ˜¯é’ˆå¯¹å­—æˆ–è€…wordç²’åº¦æ¥å­¦ä¹ ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨æ–‡æœ¬ä¸­çš„è¯æ³•ç»“æ„ã€è¯­æ³•ç»“æ„ä»¥åŠè¯­ä¹‰ä¿¡æ¯å»å»ºæ¨¡ã€‚</strong>è­¬å¦‚ï¼š<code>æˆ‘è¦ä¹°è‹¹æœæ‰‹æœº</code>è¿™å¥è¯ï¼Œæˆ‘ä»¬MASKä¸€ä¸ªè¯ï¼Œå˜æˆï¼š<code>æˆ‘è¦ä¹°[MASK]æœæ‰‹æœº</code>ï¼Œå¦‚æœä½¿ç”¨BERTæ¨¡å‹ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é¢„æµ‹MASKæ‰çš„å­—æ˜¯<code>è‹¹</code>ã€‚ä½†æ˜¯BERTæ¨¡å‹æ²¡æœ‰å­¦åˆ°<code>è‹¹æœæ‰‹æœº</code>æ˜¯ä¸€ä¸ªåè¯è¿™ä¸€ä¿¡æ¯ï¼Œé‚£ä¹ˆï¼Œå¦‚æœåœ¨æœªçŸ¥çš„æ–‡æœ¬ä¸­ï¼Œå‡ºç°äº†<code>é¦™è•‰æ‰‹æœº</code>è¿™æ ·çš„è¯è¯­ï¼Œé‚£ä¹ˆï¼ŒBERTç­‰æ¨¡å‹æ˜¯æ— æ³•å¯¹å…¶è¿›è¡Œå¾ˆå¥½çš„å‘é‡è¡¨ç¤ºçš„ã€‚æ‰€ä»¥ERNIEæ¨¡å‹å°±è¯ç”Ÿäº†ã€‚ERNIEæ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°†å¤–éƒ¨çŸ¥è¯†æ•´åˆåˆ°é¢„è®­ç»ƒæ¨¡å‹ä¸­ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°è¯æ³•ã€è¯­æ³•ä¸è¯­ä¹‰ä¿¡æ¯ã€‚</strong></p><p>åœ¨ERNIE1.0ä¸­ï¼Œé™¤äº†BERTä¸­çš„åŸºç¡€çš„maskingç­–ç•¥ï¼Œè¿˜æå‡ºäº†åŸºäºphraseçš„maskingç­–ç•¥ä¸åŸºäºentityçš„maskingç­–ç•¥ã€‚åœ¨ERNIEä¸­ï¼Œå°†å¤šä¸ªå­—ç»„æˆçš„phraseä¸entityå½“ä¸€ä¸ªå•å…ƒï¼Œç»Ÿä¸€è¢«maskã€‚è¿™æ ·çš„è¯ï¼Œæ¨¡å‹å°±èƒ½å¤Ÿæ½œåœ¨çš„å­¦ä¼šçŸ¥è¯†çš„ä¾èµ–ä¸è¯­ä¹‰ä¾èµ–ã€‚</p><p>åœ¨ERNIE2.0ä¸­ï¼Œæå‡ºä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼šè¿ç»­å­¦ä¹ ã€‚ä¹Ÿå°±æ˜¯ï¼Œæ¨¡å‹é¡ºåºè®­ç»ƒå¤šä¸ªä»»åŠ¡ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸ªä»»åŠ¡ä¸­è®°ä½å‰ä¸€ä¸ªä»»åŠ¡å¾—åˆ°çš„ç»“æœï¼Œä»è€Œå¯ä»¥ä¸æ–­çš„ç§¯ç´¯æ–°çŸ¥è¯†ã€‚å…·ä½“çš„å¯ä»¥å‚çœ‹è®ºæ–‡ï¼Œè¿™æ˜¯å¤§è‡´çš„æ€æƒ³ã€‚</p><h2 id="ALBERTæ¨¡å‹ä»‹ç»"><a href="#ALBERTæ¨¡å‹ä»‹ç»" class="headerlink" title="ALBERTæ¨¡å‹ä»‹ç»"></a>ALBERTæ¨¡å‹ä»‹ç»</h2><p>ALBERTæ¨¡å‹æ˜¯å¯¹BERTæ¨¡å‹çš„æ”¹è¿›ã€‚æ€ä¹ˆè¯´å‘¢ï¼Œæ„Ÿè§‰ALBERTæ˜¯ä¸€ä¸ªè°ƒå‚è°ƒå‡ºæ¥çš„æ¨¡å‹ğŸ¤ªã€‚å®ƒçš„ç›®æ ‡æ˜¯ï¼š<strong>åœ¨ä¸æŸå®³æ¨¡å‹æ€§èƒ½çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘BERTæ¨¡å‹çš„å‚æ•°ã€‚</strong>åœ¨ALBERTä¸­ï¼Œé¦–å…ˆåˆ†æäº†BERTä¸­æ¨¡å‹çš„å‚æ•°æ¥æºã€‚åœ¨BERTä¸­ï¼Œå‚æ•°ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>token embeddingçš„å‚æ•°ä¸attentionã€FFNå±‚çš„å‚æ•°</strong>ã€‚ï¼ˆä»¥ä¸‹æ‰€ç”¨åˆ°çš„å›¾ç‰‡æ¥æºäºALBERTç¬¬ä¸€ä½œè€…lanzhenzhongåšå£«çš„è®²è§£ã€‚ï¼‰</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/6.jpg" alt></p><h3 id="Method1-factorized-embedding-parametrization"><a href="#Method1-factorized-embedding-parametrization" class="headerlink" title="Method1:factorized embedding parametrization"></a>Method1:factorized embedding parametrization</h3><p>token embeddingå å‚æ•°çš„20%ï¼ŒattentionäºFFNå±‚çš„å‚æ•°å 80%ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸¤æ–¹é¢å…¥æ‰‹ã€‚å¯¹äºtoken embeddingæ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†å…¶æ˜ å°„åˆ°ä¸€ä¸ªåœ°ä½iç©ºé—´ï¼Œå†æ˜ å°„ä¸ºé«˜ç»´ç©ºé—´ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆåšå‘¢ï¼Ÿæœ‰ä¸¤ç‚¹ï¼š<strong>1. token embeddingä¸€èˆ¬éƒ½æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„ï¼Œè€Œattentionå±‚çš„è¾“å‡ºä¸€åŠéƒ½æ˜¯ä¸ä¸Šä¸‹æ–‡æœ‰å…³ç³»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¾“å‡ºå±‚åº”è¯¥åŒ…å«äº†æ›´å¤šçš„ä¿¡æ¯ï¼Œæ‰€ä»¥ï¼Œè¾“å‡ºå±‚çš„ç»´åº¦åº”è¯¥æ¯”token embeddingçš„ç»´åº¦è¦é«˜æ‰æ¯”è¾ƒåˆç†ï¼›2. å¦‚æœè®©Eä¸Hç›¸ç­‰çš„è¯ï¼Œé‚£ä¹ˆï¼Œæ•´ä¸ªè¯è¡¨çš„ç»´åº¦æ˜¯V*Hï¼Œé‚£ä¹ˆè¿™ä¸ªè¯è¡¨æ˜¯ç›¸å½“å¤§çš„ï¼Œæ¢¯åº¦æ›´æ–°çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ¯”è¾ƒç¨€ç–ã€‚</strong></p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/7æ–¹æ³•ä¸€.jpg" alt></p><p>å½“ç„¶ï¼Œè¿™æ ·åšä¼šæŸå¤±ä¿¡æ¯ï¼Œä½†æ˜¯ç»“æœè¡¨æ˜ï¼ŒæŸå¤±çš„æ€§èƒ½å¹¶ä¸å¤šï¼Œè€Œå‡å°‘çš„å‚æ•°å´é«˜è¾¾80%ä»¥ä¸Šã€‚</p><h3 id="Method2-cross-layer-parameter-sharing"><a href="#Method2-cross-layer-parameter-sharing" class="headerlink" title="Method2: cross-layer parameter sharing"></a>Method2: cross-layer parameter sharing</h3><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/10.jpg" alt></p><p>è·¨å±‚çš„å‚æ•°æ­å–œé‚£ä¸ªæœ‰ä¸¤ç§æ–¹æ¡ˆï¼šattentionæ¨¡å—çš„å‚æ•°å…±äº«ä»¥åŠFFNå±‚çš„å‚æ•°å…±äº«ã€‚åœ¨å®éªŒä¸­ï¼Œä½œè€…å‘ç°å…±äº«FFNçš„å‚æ•°æ˜¯å¯¼è‡´å‚æ•°ä¸‹é™çš„æœ€ä¸»è¦çš„åŸå› ã€‚</p><h3 id="SOPâ€”Sentence-Order-Prediction"><a href="#SOPâ€”Sentence-Order-Prediction" class="headerlink" title="SOPâ€”Sentence Order Prediction"></a>SOPâ€”Sentence Order Prediction</h3><p>åœ¨BERTä¸­ï¼Œé™¤äº†MLMä¹‹å¤–ï¼Œè¿˜ä½¿ç”¨äº†å¦ä¸€ç§ä»»åŠ¡â€”â€”NSPæ¥å­¦ä¹ å¥å­ä¹‹é—´çš„å…³ç³»ï¼Œä½†æ˜¯å®ç°è¯æ˜ï¼šNSPä»»åŠ¡å¯¹äºç»“æœçš„å½±å“å¹¶ä¸å¤§ï¼ŒåŸå› åœ¨äºï¼š<strong>NSPä»»åŠ¡å®é™…ä¸Šæ˜¯é¢„æµ‹ä¸¤å¥è¯æ˜¯é‡‡æ ·äºåŒä¸€ä¸ªæ–‡æ¡£ä¸­çš„ä¸¤ä¸ªè¿ç»­çš„å¥å­ï¼ˆæ­£æ ·æœ¬ï¼‰ï¼Œè¿˜æ˜¯é‡‡æ ·äºä¸¤ä¸ªä¸åŒçš„æ–‡æ¡£ä¸­çš„å¥å­ï¼ˆè´Ÿæ ·æœ¬ï¼‰ã€‚</strong>æ‰€ä»¥åœ¨ALBERTä¸­ï¼Œå¯¹NSPä»»åŠ¡è¿›è¡Œäº†æ”¹é€ ï¼Œå«åšSOPä»»åŠ¡ã€‚å®ƒçš„æ€æƒ³æ˜¯ï¼š<strong>æ­£æ ·æœ¬çš„æ„å»ºä¸BERTä¸€æ ·ï¼Œè´Ÿæ ·æœ¬çš„æ„å»ºåˆ™æ˜¯å°†è¯æ ·æœ¬çš„å¥å­é¡ºåºè°ƒæ¢ä¸€ä¸‹ã€‚</strong>è¿™æ ·çš„è¯ï¼Œå°±èƒ½å¤Ÿä¸“å¿ƒå­¦ä¹ åˆ°å¥å­ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸ä¼šå»å­¦ä¹ topicã€‚</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/12.jpg" alt></p><p>ç»“æœè¯æ˜ï¼ŒSOPä»»åŠ¡æ¯”NSPä»»åŠ¡è¡¨ç°æ›´åŠ è‰¯å¥½ã€‚</p><p><img src="/2020/03/02/NLP-%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98%E2%80%94ELMo-GPT-BERT-XLNet-ALBERT%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/13.jpg" alt></p><h3 id="å»æ‰Dropout"><a href="#å»æ‰Dropout" class="headerlink" title="å»æ‰Dropout"></a>å»æ‰Dropout</h3><p>dropoutåœ¨é˜²æ­¢è¿‡æ‹Ÿåˆä¸Šæœ‰æ˜¾è‘—æ•ˆæœï¼Œä½†æ˜¯å®é™…ä¸ŠMLMå¾ˆéš¾è¿‡æ‹Ÿåˆï¼Œå»æ‰dropoutï¼Œç”±äºå¯ä»¥è…¾å‡ºå¾ˆå¤šä¸´æ—¶å˜é‡å ç”¨çš„å†…å­˜è€Œä½¿å¾—å†…å­˜ä¸Šæœ‰æ‰€æå‡ã€‚</p><p><strong>æ€»ç»“ï¼ŒALBERTæ¨¡å‹çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š</strong></p><ul><li>ALBERTæ¨¡å‹é€šè¿‡ä¸¤ç§æŠ€æœ¯ï¼Œé™ä½äº†å‚æ•°çš„æ•°é‡ï¼›</li><li>é€šè¿‡é‡æ–°è®¾è®¡NSPä»»åŠ¡ï¼Œå¾—åˆ°äº†SOPä»»åŠ¡ï¼Œæœ€ç»ˆæ”¹å–„äº†æ¨¡å‹æ€§èƒ½ï¼›</li><li>å‡å°‘å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿå°±æé«˜äº†æ¨¡å‹çš„capacityï¼Œå³å¯ä»¥é€šè¿‡å°†ç½‘ç»œå˜æ·±å˜å®½ï¼Œæå‡æ¨¡å‹ã€‚</li></ul><h2 id="é¢„è®­ç»ƒæ¨¡å‹æ€»ç»“"><a href="#é¢„è®­ç»ƒæ¨¡å‹æ€»ç»“" class="headerlink" title="é¢„è®­ç»ƒæ¨¡å‹æ€»ç»“"></a>é¢„è®­ç»ƒæ¨¡å‹æ€»ç»“</h2><ul><li><p>æ•´ä¸ªé¢„è®­ç»ƒæ¨¡å‹å¯åˆ†ä¸ºä¸¤ç±»ï¼šfeature based approachä¸fine-tuning approachã€‚å‰è€…çš„ä»£è¡¨æ€§æ¨¡å‹å°±æ˜¯ELMoï¼Œåè€…çš„ä»£è¡¨æ€§æ¨¡å‹å°±æ˜¯GPTä¸BERTã€‚</p></li><li><p>æ•´ä¸ªè¯­è¨€æ¨¡å‹æœ‰ä¸¤ç§ï¼šARä¸AEã€‚ARè¯­è¨€æ¨¡å‹æŒ‡çš„æ˜¯ä½¿ç”¨ä¸Šä¸‹æ–‡å•è¯æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯çš„æ¨¡å‹ã€‚ä¸Šä¸‹æ–‡å•è¯è¢«é™åˆ¶äº†æ–¹å‘ï¼šå‰å‘æˆ–è€…åå‘ã€‚ä»£è¡¨æ€§æ¨¡å‹æœ‰ï¼šELMoã€GPTã€GPT2ã€XLNetã€‚AEæ¨¡å‹å°±æ˜¯ä»æŸåçš„æ•°æ®ä¸­é‡å»ºåŸå§‹æ•°æ®ã€‚ä¹Ÿå°±æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨MASKæ ‡è®°æ¥æ›¿æ¢åŸå•è¯ï¼Œç„¶åä½¿ç”¨ä¸Šä¸‹æ–‡æ¥é¢„æµ‹MASKæ‰çš„å•è¯ã€‚ä»£è¡¨æ€§æ¨¡å‹æœ‰ï¼šBERTã€ALBERTã€‚</p></li><li>å¦å¤–ï¼Œè¯´è¯´æˆ‘çš„çœ‹æ³•å§ï¼Œfeature-basedçš„é¢„è®­ç»ƒæ¨¡å‹åŸºæœ¬ä¸Šå¤§åŠ¿å·²å»ï¼Œä»word2vecã€fasttextã€ELMoç­‰ç­‰ï¼›ç°åœ¨ï¼Œpre-train+fine-tuneä¸¤æ®µå¼çš„é¢„è®­ç»ƒæ¨¡å‹è¶Šæ¥è¶Šå—åˆ°æ¬¢è¿ï¼Œä»GPTã€BERTã€XLNetã€ALBERTã€T5ç­‰ç­‰ã€‚æœªæ¥NLPçœŸæœ‰å¯èƒ½åƒcvé‚£æ ·ï¼Œä¸€ä¸ªæ¨¡å‹ç»Ÿä¸€å¤©ä¸‹ã€‚æˆ‘ä»¬åªéœ€è¦å»æ”¹è¿›æ¨¡å‹æ‰€ä½¿ç”¨çš„ç‰¹å¾æŠ½å–å™¨å°±å¯ä»¥äº†ã€‚ä»RNNã€CNNåˆ°transformerï¼Œç‰¹å¾æŠ½å–çš„èƒ½åŠ›è¶Šæ¥è¶Šå¼ºï¼Œæœªæ¥ï¼Œæˆ‘ä»¬åªè¦ä¸æ–­æ”¹è¿›transformeræˆ–è€…æå‡ºæ¯”transformeræ›´å¥½çš„æ¨¡å‹ï¼Œå°±èƒ½å¤Ÿå¤§å¤§æå‡æ¨¡å‹åœ¨å„é¡¹NLPä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚å¯¹äºæˆ‘ä»¬NLPeræ¥è¯´ï¼Œæ˜¯ä¸€ä»¶å¥½äº‹å§ï¼Œå› ä¸ºä¸éœ€è¦å†å»å­¦å¾ˆå¤šåƒå¥‡ç™¾æ€ªçš„trickï¼Œåªè¦å»æå‡åŸºç¡€æ¨¡å‹çš„èƒ½åŠ›ï¼Œå°±å¯ä»¥å¾—åˆ°å¾ˆå¤§çš„æé«˜ã€‚</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li>ã€ŠDeep contextualized word representationsã€‹(ELMo)</li><li><a href="https://blog.csdn.net/Magical_Bubble/article/details/89160032" target="_blank" rel="noopener">https://blog.csdn.net/Magical_Bubble/article/details/89160032</a> (ELMo)</li><li>ã€ŠImproving Language Understanding by Generative Pre-Trainingã€‹(GPT)</li><li><a href="https://blog.csdn.net/Magical_Bubble/article/details/89497002" target="_blank" rel="noopener">https://blog.csdn.net/Magical_Bubble/article/details/89497002</a> (GPT)</li><li>ã€ŠBERT: Pre-training of Deep Bidirectional Transformers for Language Understandingã€‹</li><li><a href="https://blog.csdn.net/Magical_Bubble/article/details/89514057" target="_blank" rel="noopener">https://blog.csdn.net/Magical_Bubble/article/details/89514057</a>. (BERT)</li><li>ã€ŠXLNet: Generalized Autoregressive Pretraining for Language Understandingã€‹</li><li><a href="https://blog.csdn.net/weixin_37947156/article/details/93035607" target="_blank" rel="noopener">https://blog.csdn.net/weixin_37947156/article/details/93035607</a> (XLNet)</li><li><a href="https://blog.csdn.net/u012526436/article/details/93196139" target="_blank" rel="noopener">https://blog.csdn.net/u012526436/article/details/93196139</a> (XLNet)</li><li>ã€ŠALBERT: A LITE BERT FOR SELFâ€”SUPERVISED LEARNING OF LANGUAGE REPRESENTATIONSã€‹</li><li>ã€ŠERNIE: Enhanced Representation through Knowledge Integrationã€‹</li><li><a href="https://blog.csdn.net/PaddlePaddle/article/details/102713947" target="_blank" rel="noopener">https://blog.csdn.net/PaddlePaddle/article/details/102713947</a> (ERNIE)</li></ol>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
          <category> é¢„è®­ç»ƒæ¨¡å‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> python </tag>
            
            <tag> self-attention </tag>
            
            <tag> BERT </tag>
            
            <tag> ELMo </tag>
            
            <tag> GPT </tag>
            
            <tag> ALBERT </tag>
            
            <tag> XLNET </tag>
            
            <tag> ERNIE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|word2vec/GloVe/fastTextæ¨¡å‹åŸç†è¯¦è§£ä¸å®æˆ˜</title>
      <link href="2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>è¯å‘é‡æ˜¯NLPä¸­æœ€ä¸ºé‡è¦çš„æ¦‚å¿µã€‚è¯å‘é‡çš„å¥½åç›´æ¥å½±å“åˆ°ä¸‹æ¸¸ä»»åŠ¡çš„æ•ˆæœã€‚ç„¶è€Œï¼Œå³ä¾¿åœ¨ELMoã€BERTã€ALBERTç­‰é¢„è®­ç»ƒæ¨¡å‹å¤§è¡Œå…¶é“çš„å½“ä»Šï¼Œword2vecã€GloVeã€fastTextä»ç„¶æ˜¯ç›®å‰æœ€ä¸ºæµè¡Œçš„è¯å‘é‡è®­ç»ƒæ–¹å¼ã€‚å› æ­¤ï¼Œæœ¬ç¯‡åšå®¢å°†å…·ä½“è®²è§£è¿™ä¸‰ç§è¯å‘é‡è®­ç»ƒçš„åŸç†ï¼Œå¹¶ä½¿ç”¨gensimæ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº›è¯å‘é‡æ¨¡å‹ï¼Œä»¥ä¾¿å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„è¯å‘é‡ã€‚</p><a id="more"></a><blockquote><p>æ³¨æ„ï¼šæœ¬ç¯‡åšå®¢å°½å¯èƒ½è®²è§£æ¸…æ¥šä¸‰ç§è¯å‘é‡è®­ç»ƒæ¨¡å‹çš„åŸç†ï¼Œä½†æ˜¯å¾ˆå¤šç»†èŠ‚çš„éƒ¨åˆ†ï¼Œéœ€è¦å¤§å®¶è‡ªè¡Œå»äº†è§£ï¼Œæ¯”å¦‚huffmanæ ‘çš„åŸç†ã€softmaxçš„åŸç†ç­‰ç­‰ã€‚å¦‚è‹¥ä¸å°½æ„ï¼Œå¯å‚è€ƒæˆ‘åœ¨å‚è€ƒæ–‡çŒ®ä¸­ä¾‹ä¸¾çš„åŸå§‹è®ºæ–‡ï½</p></blockquote><h2 id="word2vecæ¨¡å‹ä»‹ç»"><a href="#word2vecæ¨¡å‹ä»‹ç»" class="headerlink" title="word2vecæ¨¡å‹ä»‹ç»"></a>word2vecæ¨¡å‹ä»‹ç»</h2><p>word2vecæ¨¡å‹å…¶ä¸­æœ‰ä¸¤ç§è®­ç»ƒæ–¹å¼ï¼šskip-gramä¸CBOWï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰ä¸¤ç§åŠ é€Ÿè®­ç»ƒçš„trickï¼šhierarchical sofmtmaxä¸negative samplingã€‚æ‰€ä»¥ï¼Œword2vecå…¶å®æœ‰4ç§æ–¹æ³•ã€‚ç»†èŠ‚è§<a href="https://zhuanlan.zhihu.com/p/42080556" target="_blank" rel="noopener">ç»†èŠ‚</a>ã€<a href="https://zhuanlan.zhihu.com/p/27234078" target="_blank" rel="noopener">skip-gramè¯¦ç»†ä»‹ç»</a></p><h3 id="skip-gramæ¨¡å‹"><a href="#skip-gramæ¨¡å‹" class="headerlink" title="skip-gramæ¨¡å‹"></a>skip-gramæ¨¡å‹</h3><p>skip-gramæ¨¡å‹æ˜¯ç»™å®šç›®æ ‡è¯ï¼Œæ¥é¢„æµ‹å…¶ä¸Šä¸‹æ–‡ã€‚ç”±äºskip-gramæ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚æˆ‘ä»¬çŸ¥é“ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è®­ç»ƒçš„è¿‡ç¨‹åˆ†ä¸ºï¼š</p><ul><li>ç¡®å®šè®­ç»ƒæ•°æ®$(X,Y)$</li><li>ç¡®å®šç½‘ç»œæ¶æ„</li><li>ç¡®å®šæŸå¤±å‡½æ•°</li><li>ç¡®å®šä¼˜åŒ–å™¨ã€è¿­ä»£æ¬¡æ•°</li><li>å­˜å‚¨ç½‘ç»œ</li></ul><p><strong>ç¡®å®šè®­ç»ƒæ•°æ®</strong></p><p>å‡è®¾è¯­æ–™åº“åªæœ‰ä¸€å¥è¯ï¼š<font face="Times New Roman"><em>The quick brown fox jumps over the lazy dog</em></font>ã€‚æ‰€ä»¥æ€»å…±åªæœ‰8ä¸ªè¯ã€‚åœ¨skip-gramä¸­ï¼Œè®­ç»ƒæ•°æ®çš„å½¢å¼å…¶å®éå¸¸ç®€å•ï¼Œå…¶å®å°±æ˜¯<strong>ä½¿ç”¨n-gramçš„æ–¹æ³•ç”Ÿæˆè¯å¯¹ã€‚</strong>è­¬å¦‚</p><p><img src="/2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/0.png" style="zoom:80%;"></p><p>ä¸Šå›¾çš„çª—å£å¤§å°æ˜¯2ï¼Œå·¦å³å„å–2ä¸ªè¯ã€‚å®é™…ä¸Šçª—å£å¤§å°ä¸º5æ—¶æ¯”è¾ƒå¥½çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºã€‚åœ¨å¾—åˆ°è®­ç»ƒæ•°æ®åï¼Œæˆ‘ä»¬å°†å…¶ç”¨one-hotç¼–ç åï¼Œå°±å¯ä»¥è¾“å…¥ç½‘ç»œäº†ã€‚è­¬å¦‚ï¼š(the, quick)å•è¯å¯¹å°±è¡¨ç¤º$[(1,0,0,0,0,0,0,0),(0,1,0,0,0,0,0,0)]$ï¼Œè¾“å…¥ç½‘ç»œã€‚å½“ç„¶ï¼Œ<strong>å¯¹targetå•è¯ä¹Ÿæ˜¯éœ€è¦è¿›è¡ŒæŠ½æ ·çš„ã€‚</strong>é“¾æ¥ï¼š<a href="https://www.yuque.com/liwenju/kadtqt/gqkk0e" target="_blank" rel="noopener">å¯¹targetæŠ½æ ·</a></p><p><strong>ç¡®å®šç½‘ç»œæ¶æ„</strong></p><p><img src="/2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/1.jpg" style="zoom: 67%;"></p><p>ä¸Šé¢å°±æ˜¯skip-gramæ¨¡å‹çš„æ¶æ„ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªå•è¯çš„vectorï¼Œè¾“å‡ºæ˜¯softmaxåçš„æ¦‚ç‡åˆ†å¸ƒï¼Œ<strong>æ¯ä¸€ä¸ªæ¦‚ç‡å€¼å¯¹åº”è¯æ±‡è¡¨ä¸­çš„ä¸€ä¸ªå•è¯ï¼Œè¡¨ç¤ºè¯æ±‡è¡¨ä¸­çš„å•è¯å‡ºç°åœ¨è¾“å…¥å•è¯çš„ä¸Šä¸‹æ–‡çš„æ¦‚ç‡ã€‚</strong>ä¸­é—´åªæœ‰ä¸€ä¸ªçº¿æ€§çš„hidden layerã€‚è¿˜æ˜¯ç´§æ¥ç€æˆ‘ä»¬çš„ä¾‹å­ï¼Œè¯æ±‡è¡¨æœ‰8ä¸ªå•è¯ï¼Œæ‰€ä»¥ï¼Œè¾“å…¥æ—¶8ç»´çš„vectorï¼Œè¾“å‡ºä¹Ÿåº”è¯¥æ˜¯ä¸€ä¸ª8ç»´çš„vectorã€‚è€Œhidden layerçš„ç»´åº¦åˆ™æ˜¯æˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„è¯å‘é‡çš„ç»´åº¦ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ä½¿ç”¨3ä¸ªhidden unitsï¼Œé‚£ä¹ˆï¼Œæƒé‡çŸ©é˜µå°±æ˜¯8*3ç»´çš„çŸ©é˜µã€‚(å®é™…ä¸Šgoogleæ¨èä½¿ç”¨300ç»´ã€‚)æ³¨æ„ï¼š<strong>åœ¨ç½‘ç»œä¸­ï¼Œå…¶å®æœ‰ä¸¤ä¸ªæƒé‡çŸ©é˜µï¼Œæˆ‘ä»¬åªéœ€è¦é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œå› ä¸ºå®ƒä»¬äº’ä¸ºè½¬ç½®ã€‚</strong>æˆ‘ä»¬æœ€åéœ€è¦çš„é¢å°±æ˜¯æƒé‡çŸ©é˜µï¼Œå¹¶ä¸éœ€è¦è¾“å‡ºå±‚çš„ç»“æœã€‚</p><p><strong>ç¡®å®šæŸå¤±å‡½æ•°</strong></p><p>ç”±äºåœ¨è¾“å‡ºå±‚ä½¿ç”¨softmaxå‡½æ•°ï¼Œé‚£ä¹ˆå¾ˆè‡ªç„¶åœ°ï¼ŒæŸå¤±å‡½æ•°å°±æ˜¯äº¤å‰ç†µå‡½æ•°ã€‚å³ï¼š</p><script type="math/tex; mode=display">L=\sum_{i=1}^{V}y_ilog(\hat y_i),\\\hat y_i=\frac {e^{(w^Th_i)}}{\sum_{i=1}^{V}e^{(w^Th_i)}},\\å…¶ä¸­ï¼ŒVè¡¨ç¤ºè¯æ±‡è¡¨çš„æ•°ç›®</script><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä½¿ç”¨sotfmaxï¼Œéœ€è¦è®¡ç®—è¯æ±‡è¡¨ä¸­æ‰€æœ‰è¯æ±‡çš„å’Œï¼Œè€Œä¸€èˆ¬çš„è¯æ±‡è¡¨æ•°ç›®åœ¨å‡ åä¸‡åˆ°å‡ ç™¾ä¸‡ä¸æ­¢ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªè®¡ç®—ä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›æŠ€å·§æ¥åŠ é€Ÿè®­ç»ƒã€‚</p><h3 id="Negative-sampling"><a href="#Negative-sampling" class="headerlink" title="Negative sampling"></a>Negative sampling</h3><p>Negative samplingä¸»è¦å°±æ˜¯è§£å†³ç½‘ç»œéš¾ä»¥è®­ç»ƒçš„é—®é¢˜ã€‚åœ¨skip-gramæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨SGDæ¥è®­ç»ƒç½‘ç»œï¼Œè¿™éœ€è¦è®¡ç®—è¯æ±‡è¡¨ä¸­æ‰€æœ‰å•è¯çš„å’Œï¼Œå½“è¯æ±‡è¡¨å¾ˆå¤§çš„æ—¶å€™ï¼Œè¿™æ˜¯éå¸¸éš¾çš„ã€‚é‚£ä¹ˆnegative samplingï¼Œå°±æ˜¯åœ¨åœ¨è¾“å‡ºå±‚ä¸­ï¼Œæˆ‘ä»¬æŠ½å–å‡ ä¸ªåº”è¯¥ä¸º0çš„ç»´åº¦ï¼Œå†åŠ ä¸Šä¸º1çš„ç»´åº¦ï¼Œæ¥è¿›è¡Œè®­ç»ƒã€‚è¿™æ ·å°±èƒ½å¤§å¤§åŠ å¿«è®­ç»ƒé€Ÿåº¦ã€‚</p><p>è­¬å¦‚è¯´ï¼Œæˆ‘ä»¬çš„è¯æ±‡è¡¨ä¸º10000ï¼Œhidden layerçš„ç»´åº¦300ï¼Œæˆ‘ä»¬nagative samplingçš„ç»´åº¦ä¸ªæ•°ä¸º5ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ›´æ–°çš„ç»´åº¦å°±æ˜¯6ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´æ–°çš„æƒé‡ç³»æ•°ä¸º300*6=1800ï¼Œè¿™æ˜¯è¾“å‡ºå±‚ç³»æ•°çš„0.06%ã€‚æ³¨æ„ï¼š<strong>åœ¨éšè—å±‚çš„æƒé‡10000*300=3000000æ˜¯å¿…é¡»éœ€è¦è®­ç»ƒçš„ã€‚</strong>è¿™æ ·ä¸€æ¥ï¼Œ<strong>æˆ‘ä»¬å°±å°†softmaxé—®é¢˜è½¬æ¢ä¸ºVä¸ªlogisticäºŒåˆ†ç±»é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘ä»¬æ¯æ¬¡åªæ›´æ–°å…¶ä¸­Kä¸ªè´Ÿæ ·æœ¬ä¸ä¸€ä¸ªæ­£æ ·æœ¬çš„å‚æ•°ï¼Œä»è€Œå¤§å¤§é™ä½äº†è®¡ç®—æˆæœ¬ã€‚</strong></p><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼š<strong>æˆ‘ä»¬åº”è¯¥æ€ä¹ˆæŠ½å–è¿™5ä¸ªåº”è¯¥ä¸º0çš„ç»´åº¦å‘¢ï¼Ÿ</strong>å…·ä½“åšæ³•æ˜¯ï¼šæ ¹æ®å•è¯åœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„æ¬¡æ•°æ¥å†³å®šã€‚å‡ºç°æ¬¡æ•°è¶Šå¤šï¼Œé‚£ä¹ˆçº¦æœ‰å¯èƒ½è¢«æŠ½ä¸­ã€‚å…¬å¸å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(w_i)=\frac{f(w_i)^{\frac 34}}{\sum_{i=0}^{V}f(w_i)^{\frac34}}</script><p>å…¶ä¸­ï¼Œ$P(w_i)$è¡¨ç¤ºå•è¯$w_i$è¢«æŠ½ä¸­çš„æ¦‚ç‡ï¼›$f(w_i)$è¡¨ç¤ºå•è¯$w_i$åœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</p><h3 id="hierarchical-softmax"><a href="#hierarchical-softmax" class="headerlink" title="hierarchical softmax"></a>hierarchical softmax</h3><p>æ‰€è°“çš„hierarchical softmaxï¼Œå®é™…ä¸Šå°±æ˜¯é‡‡ç”¨Huffmanæ ‘ã€‚huffmanæ ‘çš„å¶å­ç»“ç‚¹å°±æ˜¯è¯æ±‡è¡¨ä¸­çš„å•è¯ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯å¾„å°±è¡¨ç¤ºå•è¯çš„æ¦‚ç‡ã€‚è¿™æ ·ä¸€æ ·ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å¯¹æ‰€æœ‰å•è¯çš„å¾—åˆ†è¿›è¡Œæ±‚å’Œï¼Œå°±å¤§å¤§é™ä½äº†è®¡ç®—æˆæœ¬ã€‚æ³¨æ„ï¼š<strong>åœ¨æ„é€ huffmanæ ‘çš„æ—¶å€™ï¼Œå¸¸ç”¨çš„è¯çš„æ·±åº¦ä¼šæ›´å°ä¸€äº›ï¼Œå³æ›´é è¿‘æ ¹èŠ‚ç‚¹ï¼›è€Œä¸å¸¸ç”¨çš„è¯ä¼šæ›´æ·±ä¸€ç‚¹ã€‚</strong></p><h2 id="CBOWæ¨¡å‹"><a href="#CBOWæ¨¡å‹" class="headerlink" title="CBOWæ¨¡å‹"></a>CBOWæ¨¡å‹</h2><p>CBOWæ¨¡å‹ä¸skip-gramçš„è®­ç»ƒæ–¹å¼ç›¸åã€‚å®ƒæ˜¯ç»™å®šç›®æ ‡è¯ä¸Šä¸‹æ–‡ï¼Œç„¶åæ¥é¢„æµ‹ç›®æ ‡è¯ã€‚</p><p><img src="/2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/2.jpg" style="zoom: 67%;"></p><p>å…¶ä¸­ç½‘ç»œæ¶æ„ä¸skip-gramæ¨¡å‹éå¸¸çš„ç±»ä¼¼ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„è¾“å…¥ã€‚CBOWæ¨¡å‹çš„è¾“å…¥æ˜¯å¤šä¸ªå•è¯çš„one-hot vectorçš„å’Œï¼Œè€Œéšè—å±‚éœ€è¦å¯¹å…¶æ±‚å¹³å‡ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">h=\frac 1CW^T(x_1+x_2+...+x_C)</script><p>å…¶ä¸­ï¼Œ$x_1,x_2,..,x_C$æ˜¯è¾“å…¥çš„vectorï¼Œ$h$æ˜¯éšè—å±‚çš„è¾“å‡ºï¼Œ$C$æ˜¯è¾“å…¥çš„å•è¯çš„æ•°ç›®ã€‚</p><p>å…¶ä½™ä¸skip-gramæ¨¡å‹ä¸€æ ·ï¼Œè¾“å‡ºå±‚ä¹Ÿæ˜¯ä½¿ç”¨äº†softmaxã€‚æ­¤å¤–ï¼Œnegative samplingä¸hierarchical softmaxè¿™ä¸¤ç§trickä¹Ÿéƒ½å¯ä»¥ç”¨åœ¨CBOWæ¨¡å‹ä¸­ã€‚</p><h2 id="GloVeæ¨¡å‹"><a href="#GloVeæ¨¡å‹" class="headerlink" title="GloVeæ¨¡å‹"></a>GloVeæ¨¡å‹</h2><p>GloVeæ¨¡å‹å‡ºè‡ªäºå¦ä¸€ç¯‡è®ºæ–‡ã€ŠGlobal Vectors for Word Representationã€‹ã€‚<strong>å¼ºåŠ›æ¨èå¤§å®¶å»è¯»ä¸€è¯»ï¼Œè¿™æ˜¯ä¸€ç¯‡éå¸¸å¥½æ‡‚çš„è®ºæ–‡ï¼ğŸ¤©</strong></p><p>GloVeæ¨¡å‹çš„ç›®æ ‡æ˜¯ï¼š<strong>å¾—åˆ°å•è¯çš„è¯å‘é‡ï¼Œè®©å…¶å°½å¯èƒ½çš„åŒ…å«è¯­ä¹‰ä¸è¯­æ³•ä¿¡æ¯</strong>ã€‚è¾“å…¥æ˜¯è¯­æ–™åº“(æ²¡é”™ï¼Œä¸éœ€è¦å»æ„å»ºè®­ç»ƒé›†)ï¼Œè¾“å‡ºæ˜¯è¯å‘é‡ã€‚GloVeæ¨¡å‹çš„æ€è·¯æ˜¯ï¼š<strong>ä»è¯­æ–™åº“ä¸­ç»Ÿè®¡å…±ç°çŸ©é˜µï¼Œç„¶åæ ¹æ®å…±ç°çŸ©é˜µä¸GloVeæ¨¡å‹æ¥å­¦ä¹ è¯å‘é‡ã€‚</strong></p><p><strong>ç»Ÿè®¡å…±ç°çŸ©é˜µ</strong></p><p>æˆ‘ä»¬è®°å…±ç°çŸ©é˜µä¸ºï¼š$X=[X_{ij}]_{N\times N}$ã€‚å…¶ä¸­ï¼Œ$X_{ij}$è¡¨ç¤ºå•è¯$j$åœ¨å•è¯$i$çš„ä¸Šä¸‹æ–‡ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œ$N$è¡¨ç¤ºè¯æ±‡è¡¨ä¸­çš„å•è¯æ•°ç›®ã€‚è‡³äºå¦‚ä½•æ„å»ºçš„ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ç»Ÿè®¡çª—å£ï¼Œéå†æ•´ä¸ªè¯­æ–™åº“ï¼Œæ¥è¿›è¡Œç»Ÿè®¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å¼•å…¥ä¸€äº›ç¬¦å·ï¼š</p><script type="math/tex; mode=display">X_i=\sum_{j=1}^{N}X_{ij},\\P_{ij}=\frac {X_{ij}}{X_i},\\ratio_{i,j,k}=\frac{P_{ik}}{P_{jk}}</script><p>å…¶ä¸­ï¼Œ$P_{ij}$è¡¨ç¤ºå•è¯$j$åœ¨å•è¯$i$çš„ä¸Šä¸‹æ–‡å‡ºç°çš„æ¦‚ç‡ï¼Œ$ratio_{i,j,k}$è¡¨ç¤ºå•è¯$i$ä¸å•è¯$k$çš„ç›¸å…³åº¦ï¼Œä»¥åŠå•è¯$j$ä¸å•è¯$k$çš„ç›¸å…³åº¦çš„æ¯”å€¼ã€‚ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªä¸œè¥¿ï¼Ÿå› ä¸ºï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥çœ‹$P_{ij}$æ¥è¡¨ç¤ºå•è¯$i$ä¸å•è¯$j$çš„ä¹‹é—´çš„ç›¸å…³åº¦çš„è¯ï¼Œå…¶å®æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè¿™å¾ˆæœ‰å¯èƒ½å—è¯­æ–™åº“çš„å½±å“ã€‚æ‰€ä»¥ï¼Œéœ€è¦éœ€è¦å®ƒä»¬ä¹‹é—´çš„æ¯”å€¼ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°$ratio_{i,j,k}$æœ‰å¦‚ä¸‹æ€§è´¨ï¼š</p><ul><li>å½“$i$ä¸$k$ç›¸å…³ï¼Œ$j$ä¸$k$ä¸ç›¸å…³çš„æ—¶å€™ï¼Œé‚£ä¹ˆ$ratio_{i,j,k}$çš„å€¼ä¼šéå¸¸çš„å¤§ï¼›</li><li>å½“$i$ä¸$k$ç›¸å…³ï¼Œ$j$ä¸$k$ç›¸å…³çš„æ—¶å€™ï¼Œé‚£ä¹ˆ$ratio_{i,j,k}$çš„å€¼ä¼šè¶‹äº1ï¼›</li><li>å½“$i$ä¸$k$ä¸ç›¸å…³ï¼Œ$j$ä¸$k$ç›¸å…³çš„æ—¶å€™ï¼Œé‚£ä¹ˆ$ratio_{i,j,k}$çš„å€¼ä¼šéå¸¸çš„å°ï¼›</li><li>å½“$i$ä¸$k$ä¸ç›¸å…³ï¼Œ$j$ä¸$k$ä¸ç›¸å…³çš„æ—¶å€™ï¼Œé‚£ä¹ˆ$ratio_{i.j.k}$çš„å€¼ä¼šè¶‹äº1ã€‚</li></ul><p>é‚£ä¹ˆï¼ŒGloVeæ¨¡å‹çš„æƒ³æ³•æ˜¯ï¼šå‡è®¾æˆ‘ä»¬ç°åœ¨ä»¥åŠå¾—åˆ°äº†å•è¯çš„è¯å‘é‡$v_i,v_j,v_k$ï¼Œé‚£ä¹ˆï¼Œå¦‚æœè¯´æˆ‘ä»¬é€šè¿‡æŸä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿæ±‚å¾—$ratio_{i,j,k}$çš„è¯ï¼Œé‚£ä¹ˆå°±è¯´æˆ‘ä»¬çš„è¯å‘é‡ä¸å…±ç°çŸ©é˜µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„çš„è¯å‘é‡åŒ…å«äº†å…±ç°çŸ©é˜µä¸­çš„ä¿¡æ¯ã€‚</p><p><strong>å­¦ä¹ è¯å‘é‡</strong></p><p>å‡è®¾æˆ‘ä»¬çš„å‡½æ•°ä¸ºï¼š$g(v_i,v_j,v_k)$ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ï¼š$g(v_i,v_j,v_k)=\frac {P_{ik}}{P_{jk}}$ã€‚æ‰€ä»¥ï¼Œå¾ˆè‡ªç„¶åœ°ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼š</p><script type="math/tex; mode=display">min\sum_{i,j,k}(g(v_i,v_j,v_k)-\frac {P_{ik}}{P_{jk}})^2</script><p>åªè¦è®©è¿™ä¸ªå¼å­æœ€å°ï¼Œæˆ‘ä»¬å°±èƒ½æ±‚å‡ºæ‰€æœ‰çš„è¯å‘é‡ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå¼å­å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šé‚£å°±æ˜¯è¿™ä¸ªè®¡ç®—å¤æ‚åº¦å¤ªé«˜äº†ï¼Œä¸ºï¼š$O(N\times N\times N)$ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•å‡å°å¤æ‚åº¦ã€‚</p><p>ç”±äºæˆ‘ä»¬æƒ³è¡¡é‡$v_i$ä¸$v_j$çš„ç›¸ä¼¼åº¦ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¼•è¿›$v_i-v_j$è¿™ä¸ªæ˜¯å¾ˆè‡ªç„¶çš„ï¼›æ­¤å¤–ï¼Œç”±äº$ratio_{i,j,k}$æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼•å…¥å†…ç§¯ä¹Ÿæ˜¯å¾ˆè‡ªç„¶çš„ï¼Œ$(v_i-v_j)^Tv_k$ï¼Œæœ€åæˆ‘ä»¬åœ¨å¤–é¢åŠ ä¸€å±‚$exp$ï¼Œä»è€Œèƒ½å¤Ÿç®€åŒ–è¿ç®—ã€‚æ‰€ä»¥æˆ‘ä»¬çš„å‡½æ•°å¯ä»¥å˜ä¸ºå¦‚ä¸‹å¼å­ï¼š</p><script type="math/tex; mode=display">g(v_i,v_j,v_k)=exp((v_i-v_j)^Tv_k)</script><p>ç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š$g(v_i,v_j,v_k)=\frac {P_{ik}}{P_{jk}}$ï¼Œå°†gå‡½æ•°å¸¦å…¥ï¼Œå¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\frac {P_{ik}}{P_{jk}}=\frac{exp(v_i^Tv_k)}{exp(v_j^Tv_k)}</script><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦ä»¤ï¼š$P_{ik}=exp(v_i^Tv_k)ï¼ŒP_{jk}=exp(v_j^Tv_k)$ï¼Œå³å¯ã€‚æˆ‘ä»¬å†å°†è¿™ä¸¤ä¸ªå¼å­ç»Ÿä¸€ä¸€ä¸‹ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P_{ij}=exp(v_i^Tv_j),\\åŒ–ç®€ï¼Œ\frac {X_{ij}}{X_i}=exp(v_i^Tv_j),\\å†åŒ–ç®€ï¼ŒlogX_{ij}-logX_i=v_i^Tv_j</script><p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹æœ€åçš„åŒ–ç®€çš„å¼å­ï¼Œå³è¾¹æ˜¯å¯¹ç§°çš„ï¼š$v_i^Tv_j=v_j^Tv_i$ï¼›è€Œå·¦è¾¹æ˜¯ä¸å¯¹ç§°çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å†åŒ–ç®€ä¸€ä¸‹ï¼š</p><script type="math/tex; mode=display">logX_{ij}=v_i^Tv_j+b_i+b_j</script><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„æœ€ä¼˜åŒ–å¼å­å¯ä»¥åŒ–ç®€å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">min\sum_{i,j}(v_i^Tv_j+b_i+b_j-logX_{ij})^2</script><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æƒ³è®©å‡ºç°é¢‘ç‡é«˜çš„è¯å¯¹æœ‰æ›´é«˜çš„æƒé‡ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å†åŠ ä¸€ä¸ªæƒé‡é¡¹ï¼Œæœ€ç»ˆå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">min\sum_{i,j}f(X_{ij})(v_i^Tv_j+b_i+b_j-logX_{ij})^2</script><p>å…¶ä¸­ï¼Œæƒé‡é¡¹å‡½æ•°ä¸ºï¼š</p><script type="math/tex; mode=display">f(x)=\begin{cases}(\frac{x}{x_{max}})^{0.75}& x<x_{max}\\1& x>=x_{max}\end{cases}</script><p>ä»¥ä¸Šå°±æ˜¯GloVeæ¨¡å‹çš„å…¨éƒ¨å†…å®¹ï½</p><p><strong>GloVeæ¨¡å‹ä¸word2vecçš„å¯¹æ¯”ï¼š</strong></p><ul><li>GloVeæ¨¡å‹æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åˆ©ç”¨äº†å…¨å±€çš„ä¿¡æ¯ï¼Œè€Œword2vecä¸­ï¼Œå°¤å…¶æ˜¯skip-gramï¼Œåªåˆ©ç”¨äº†ç›®æ ‡è¯å‘¨è¾¹çš„ä¸€å°éƒ¨åˆ†ä¸Šä¸‹æ–‡ã€‚å°¤å…¶å½“å¼•å…¥negative samplingè®­ç»ƒçš„æ—¶å€™ï¼Œä¸§å¤±äº†è¯ä¸è¯ä¹‹é—´çš„å…³ç³»ä¿¡æ¯ã€‚</li><li>GloVeæ¨¡å‹èƒ½å¤ŸåŠ å¿«æ¨¡å‹è®­ç»ƒé€Ÿåº¦ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ§åˆ¶è¯çš„ç›¸å¯¹æƒé‡ã€‚</li></ul><h2 id="fastTextæ¨¡å‹"><a href="#fastTextæ¨¡å‹" class="headerlink" title="fastTextæ¨¡å‹"></a>fastTextæ¨¡å‹</h2><p>fastTextæ˜¯Facebookåœ¨2016å¹´æ‰€æå‡ºçš„æ–¹æ³•ã€‚å…¶å®ï¼Œæ•´ä¸ªæ¨¡å‹æ¶æ„å¹¶æ²¡æœ‰ç‰¹åˆ«åˆ›æ–°çš„åœ°æ–¹ï¼Œå’ŒCBOWæ¨¡å‹éå¸¸åœ°åƒã€‚å…¶åˆ›æ–°çš„åœ°æ–¹åœ¨äºï¼š<strong>å­è¯åµŒå…¥çš„å¼•å…¥ã€‚</strong>ï¼ˆè®ºæ–‡å†™çš„å¤ªç®€æ´äº†ï¼Œå¯¼è‡´çœ‹äº†å¾ˆä¹…ğŸ˜«ï¼‰</p><p><strong>æ¨¡å‹æ¶æ„</strong></p><p><img src="/2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/3.jpg" style="zoom: 67%;"></p><p>æ•´ä¸ªæ¨¡å‹æ¶æ„ä¸CBOWæ¨¡å‹éå¸¸çš„ç±»ä¼¼ã€‚è¾“å…¥æ˜¯ä¸€æ®µåºåˆ—ï¼Œè¾“å‡ºæ˜¯è¿™æ®µåºåˆ—çš„æ ‡ç­¾ç±»åˆ«ã€‚ä¸­é—´å±‚ä»ç„¶æ˜¯çº¿æ€§çš„ã€‚è¾“å‡ºå±‚ä»ç„¶æ˜¯softmaxã€‚å¹¶ä¸”åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œä½¿ç”¨hierarchical softmaxæ¥åŠ é€Ÿè®­ç»ƒã€‚</p><p><strong>å­è¯åµŒå…¥</strong></p><p>è¿™ä¸ªæ‰æ˜¯fasttextæ¨¡å‹çœŸæ­£åˆ›æ–°çš„åœ°æ–¹ã€‚åœ¨word2vecæˆ–è€…å…¶ä»–çš„æ¨¡å‹ä¸­ï¼Œç›¸ä¼¼å½¢æ€çš„å•è¯ç”±ä¸åŒçš„å‘é‡æ¥è¡¨ç¤ºã€‚è­¬å¦‚ï¼Œ<code>è€å¸ˆä»¬ï¼Œè€å¸ˆ</code>ã€‚ä½†æ˜¯ï¼Œ<code>è€å¸ˆä»¬ã€è€å¸ˆ</code>è¿™ä¸¤ä¸ªå•è¯ï¼Œæ„æ€å…¶å®éå¸¸çš„ç›¸è¿‘ï¼Œä¸åº”è¯¥è¢«ç¼–ç æˆä¸åŒçš„å‘é‡ã€‚æ‰€ä»¥ï¼Œåœ¨fasttextä¸­ï¼Œå¼•å…¥äº†<strong>å­è¯åµŒå…¥</strong>ã€‚å…·ä½“åšæ³•æ˜¯ï¼šæˆ‘ä»¬å°†Applesï¼Œä½¿ç”¨trigramï¼Œå¾—åˆ°ï¼š<code>&lt;ap,app,ppl,ple,les,es&gt;</code>ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªn-graméƒ½ä¼šç”±ä¸€ä¸ªå‘é‡æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™6ä¸ªtrigramçš„å åŠ æ¥è¡¨ç¤º<code>Apples</code>è¿™ä¸ªå•è¯ã€‚<strong>åºåˆ—ä¸­æ‰€æœ‰å•è¯çš„å‘é‡ä»¥åŠn-gramå‘é‡åŒæ—¶ç›¸åŠ å¹³å‡ï¼Œä½œä¸ºè®­ç»ƒçš„è¾“å…¥ã€‚</strong>è­¬å¦‚ï¼šä¸€æ®µåºåˆ—ä¸­3ä¸ªè¯ï¼Œ$w_1,w_2,w_3$è¡¨ç¤º3ä¸ªè¯çš„å‘é‡ï¼Œ$w_{12},w_{23}$è¡¨ç¤ºbigramç‰¹å¾çš„å‘é‡ã€‚é‚£ä¹ˆhidden layerçš„è¾“å‡ºæ˜¯ï¼š$h=\frac 15W^T(w_1+w_2+w_3+w_{12}+w_{23})$ã€‚</p><p><img src="/2020/02/29/NLP-word2vec-GloVe-fastText%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/4.jpg" alt></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼š<strong>åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šä½¿ç”¨å¤šç§n-gramï¼Œæ‰€ä»¥å¾—åˆ°çš„n-gramç»“æœæ¯”å•è¯æ•°ç›®å¤šå¾—å¤šã€‚</strong>æ‰€ä»¥æ¥å­˜å‚¨è¿™ä¹ˆå¤šçš„n-gramæ˜¯ä¸å¤ªç°å®çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯ï¼šå°†æ‰€æœ‰çš„n-gramæ˜ å°„åˆ°ä¸€å¼ hashæ¡¶ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œå°±èƒ½å¤Ÿå®ç°n-gramçš„vectorå…±äº«ã€‚</p><p><strong>å­è¯åµŒå…¥çš„å¥½å¤„ï¼šå¯¹ä½é¢‘è¯æ±‡çš„è¯å‘é‡è®­ç»ƒæ•ˆæœä¼šæ›´å¥½ï¼Œå› ä¸ºå®ƒå¯ä»¥å’Œå…¶ä»–è¯å…±äº«n-gramï¼›æ­¤å¤–ï¼Œå¯¹äºUNKï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æ„å»ºå®ƒä»¬çš„å­—ç¬¦çº§n-gramå‘é‡ã€‚</strong></p><p>ç†è®ºéƒ¨åˆ†å°±åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ï¼šfastTextåˆ°åº•å¿«åœ¨å“ªé‡Œï¼Ÿ</p><ul><li>ä½¿ç”¨äº†hierarchical softmaxï¼Œè¿™æœ¬æ¥å°±æ˜¯å¯¹æ™®é€šçš„softmaxå¾ˆå¤§çš„åŠ é€Ÿäº†ï¼›</li><li>åœ¨hierarchical softmaxä¸­ï¼Œä½¿ç”¨Huffmanæ ‘æ¥æ„å»ºï¼Œå¯¹äºæ–‡æœ¬åˆ†ç±»è€Œè¨€ï¼Œå…¶åˆ†ç±»æ ‘è¿œè¿œå°äºskip-gramæ¨¡å‹ä¸­çš„è¯è¡¨æ•°ç›®ï¼Œæ‰€ä»¥ï¼Œç›¸æ¯”äºskip-gramæ¨¡å‹ï¼Œæ›´åŠ å¿«é€Ÿï¼›</li><li>ä¸€äº›trickï¼Œè­¬å¦‚ä½¿ç”¨æå‰ç®—å¥½expçš„å€¼ã€‚ï¼ˆåœ¨ä½¿ç”¨logisiticè¿›è¡ŒäºŒåˆ†ç±»çš„æ—¶å€™ä½¿ç”¨ã€‚ï¼‰</li></ul><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>åœ¨å®æˆ˜éƒ¨åˆ†ï¼Œæˆ‘ä¸»è¦æ˜¯ä½¿ç”¨gensimã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰å…´è¶£çš„å°ä¼™ä¼´ä»¬ï¼Œå¯ä»¥å»çœ‹å®ƒä»¬çš„æºç ï¼Œè¿™ä¸ªåœ¨githubä¸Šéƒ½èƒ½å¤Ÿæœçš„åˆ°ã€‚</p><p><strong>fasttext</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> FastText</span><br><span class="line">sentences=[[<span class="string">"ä½ "</span>, <span class="string">"æ˜¯"</span>, <span class="string">"è°"</span>], [<span class="string">"æˆ‘"</span>, <span class="string">"æ˜¯"</span>, <span class="string">"ä¸­å›½äºº"</span>]]</span><br><span class="line"><span class="comment">#è®­ç»ƒä¸»å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#sentencesè¡¨ç¤ºstrç±»å‹çš„listçš„é›†åˆ</span></span><br><span class="line"><span class="comment">#sizeè¡¨ç¤ºè¯å‘é‡çš„ç»´åº¦</span></span><br><span class="line"><span class="comment">#windowè¡¨ç¤ºå½“å‰è¯ä¸é¢„æµ‹è¯ä¹‹é—´çš„è·ç¦»</span></span><br><span class="line"><span class="comment">#min_countè¡¨ç¤ºä½äºè¿™ä¸ªæ•°å­—çš„å•è¯çš„é¢‘æ•°ï¼Œé‚£ä¹ˆå°†è¢«åˆ é™¤æ‰</span></span><br><span class="line"><span class="comment">#iterè¡¨ç¤ºepoch</span></span><br><span class="line"><span class="comment">#min_nè¡¨ç¤ºå­—ç¬¦çº§çš„n-gramçš„æœ€å°çš„n</span></span><br><span class="line"><span class="comment">#max_nè¡¨ç¤ºå­—ç¬¦çº§çš„n-gramçš„æœ€å¤§çš„n</span></span><br><span class="line"><span class="comment">#word_gramï¼šå½“ä¸º1çš„æ—¶å€™ï¼Œä¼šç”¨åˆ°å­—ç¬¦çº§çš„n-gramï¼›ä¸º0ï¼Œåˆ™ä¸ä¼šç”¨åˆ°å­—ç¬¦çº§çš„n-gramï¼Œç­‰åŒäºword2vecã€‚</span></span><br><span class="line">model = FastText(sentences,  size=<span class="number">4</span>, window=<span class="number">3</span>, min_count=<span class="number">1</span>, </span><br><span class="line">                 iter=<span class="number">10</span>,min_n = <span class="number">3</span> , max_n = <span class="number">6</span>,word_ngrams =<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å¾—è¯å‘é‡</span></span><br><span class="line">model.wv[<span class="string">"ä½ "</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½</span></span><br><span class="line">model.save(<span class="string">"fname"</span>)</span><br><span class="line">model=FastText.load(<span class="string">"fname"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œè¿™ä¸ªåªèƒ½å•å‘ä¿å­˜ä¸ºword2vecï¼Œæ— æ³•é€šè¿‡loadåŠ è½½</span></span><br><span class="line">model.wv.save_word2vec_format(<span class="string">'test_fasttext.txt'</span>, binary=<span class="literal">False</span>)</span><br><span class="line">model.wv.save_word2vec_format(<span class="string">'test_fasttext.bin'</span>, binary=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨çº¿æ›´æ–°è¯­æ–™åº“</span></span><br><span class="line"><span class="comment"># åœ¨çº¿æ›´æ–°è®­ç»ƒ fasttext</span></span><br><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> FastText</span><br><span class="line">sentences_1 = [[<span class="string">"cat"</span>, <span class="string">"say"</span>, <span class="string">"meow"</span>], [<span class="string">"dog"</span>, <span class="string">"say"</span>, <span class="string">"woof"</span>],[<span class="string">"dude"</span>, <span class="string">"say"</span>, <span class="string">"wazzup!"</span>]]</span><br><span class="line">sentences_2 = []</span><br><span class="line"></span><br><span class="line">model = FastText(min_count=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#build.vocabè¡¨ç¤ºå»ºç«‹å­—å…¸ï¼Œå…¶ä¸­éœ€è¦corpusä½œä¸ºå‚æ•°,å½“updateå‚æ•°ä¸ºtrueçš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±æ›´æ–°å­—å…¸</span></span><br><span class="line">model.build_vocab(sentences_1)</span><br><span class="line"><span class="comment">#trainè¡¨ç¤ºè®­ç»ƒfasttextæ¨¡å‹</span></span><br><span class="line"><span class="comment">#å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">#total_examplesè¡¨ç¤ºå­—å…¸ä¸­çš„ä½¿ç”¨çš„corpusä¸­çš„å¥å­æ•°ç›®ä¸€è‡´</span></span><br><span class="line"><span class="comment">#epochsè¡¨ç¤ºè¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">#total_examples=model.corpus_count, epochs=model.epochsæ˜¯æ ‡å‡†å†™æ³•</span></span><br><span class="line">model.train(sentences_1, total_examples=model.corpus_count, epochs=model.epochs)</span><br><span class="line"></span><br><span class="line"><span class="comment">#model.build_vocab(sentences_2,update=True)</span></span><br><span class="line"><span class="comment">#model.train(sentences_2, total_examples=model.corpus_count, epochs=model.iter)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–è¯å‘é‡å­—å…¸ï¼Œä¸¤ç§æ–¹å¼</span></span><br><span class="line">model.wv.vocab</span><br><span class="line">model.wv.index2word</span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–ä¸ç›®æ ‡è¯ç›¸ä¼¼çš„è¯</span></span><br><span class="line">model.wv.most_similar(positive=[<span class="string">'ä½ '</span>, <span class="string">'æ˜¯'</span>], negative=[<span class="string">'ä¸­å›½äºº'</span>])</span><br><span class="line"><span class="comment">#model.wv.most_similar_cosmul(positive=['ä½ ', 'æ˜¯'], negative=['ä¸­å›½äºº'])</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>1 ã€Šword2vec Parameter Learning Explainedã€‹ï¼ŒXin Rongï¼ˆå¼ºæ¨ï¼Œ æ¯”åŸå§‹è®ºæ–‡è¯¦ç»†çš„å¤šï¼ï¼‰</p><p>2 ã€ŠGloVe: Global Vectors for Word Representationã€‹</p><p>3 ã€ŠBag of Tricks for Efï¬cient Text Classiï¬cationã€‹</p><p>4 <a href="https://www.yuque.com/liwenju/kadtqt/ensofi" target="_blank" rel="noopener">https://www.yuque.com/liwenju/kadtqt/ensofi</a></p><p>5 <a href="http://albertxiebnu.github.io/fasttext/" target="_blank" rel="noopener">http://albertxiebnu.github.io/fasttext/</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> word2vec </tag>
            
            <tag> skip-gram </tag>
            
            <tag> CBOW </tag>
            
            <tag> GloVe </tag>
            
            <tag> fastText </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ |FM/FFMæ¨¡å‹è¯¦è§£</title>
      <link href="2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>FM(Factorization Machines)æ¨¡å‹ä¸FFM(Field-aware Factorization Machines)æ¨¡å‹ï¼Œæ˜¯åœ¨æ¨èç³»ç»Ÿä¸­å¸¸ç”¨çš„ä¸¤ä¸ªæ¨¡å‹ã€‚å…¶å®æˆ‘æœ¬ä¸æƒ³å»å†™è¿™ä¸¤ä¸ªæ¨¡å‹çš„ï¼Œæ¯•ç«Ÿæˆ‘å¹¶ä¸æ˜¯ææ¨èç³»ç»Ÿçš„ï¼Œè€Œä¸”NLPæ–¹é¢æˆ‘è¿˜æ²¡çœ‹çš„è®ºæ–‡å¤ªå¤šäº†ğŸ˜­ï¼Œä½†æ˜¯æœ€è¿‘çªç„¶å‘ç°åœ¨çœ‹æœ‰å…³LRæ¨¡å‹çš„é¢˜çš„æ—¶å€™ï¼Œè®²åˆ°äº†è¿™ä¸¤ä¸ªæ¨¡å‹ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚</p><a id="more"></a><h2 id="FMæ¨¡å‹ä»‹ç»"><a href="#FMæ¨¡å‹ä»‹ç»" class="headerlink" title="FMæ¨¡å‹ä»‹ç»"></a>FMæ¨¡å‹ä»‹ç»</h2><p>FMæ¨¡å‹è¦è§£å†³çš„æ˜¯ï¼š<strong>ç¨€ç–æ•°æ®çš„ç‰¹å¾ç»„åˆé—®é¢˜ã€‚</strong>åœ¨è®­ç»ƒæ ·æœ¬ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šç¢°åˆ°æ ·æœ¬çš„ç‰¹å¾ä¸­ä¼šæœ‰å¾ˆå¤šçš„categorical featureã€‚è­¬å¦‚ï¼šå›½å®¶ï¼Œæ€§åˆ«ï¼Œåå­—ç­‰ç­‰ã€‚è¿™äº›æ•°æ®å¾€å¾€ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ•°å€¼å‹æ•°æ®æ‰èƒ½ä½¿ç”¨ã€‚å¤„ç†categorical featureçš„ä¸€èˆ¬æ–¹æ³•æ˜¯ï¼š<strong>one-hotç¼–ç </strong>(å½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ–¹å¼ï¼Œæ¯”å¦‚è¯´åœ¨catBoostä¸­ä»‹ç»äº†å¥½å‡ ç§æ–¹æ³•)ã€‚å…·ä½“æ¥è¯´å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/0.png" alt></p><p>ä¸Šå›¾ä¸­ï¼Œ<code>Clicked?</code>æ˜¯labelï¼Œ<code>Countryã€Dayã€Ad_type</code>è¿™ä¸‰ä¸ªéƒ½æ˜¯featureï¼Œå¹¶ä¸”è¿™ä¸‰ä¸ªfeatureéƒ½æ˜¯categorical featureã€‚æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œone-hotç¼–ç ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/1.png" alt></p><p>è½¬æ¢åï¼Œç‰¹å¾å°±èƒ½ä½¿ç”¨äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°ï¼šä½¿ç”¨one-hotç¼–ç åï¼Œç‰¹å¾æ•°é‡å¢å¤šäº†ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†çš„ç‰¹å¾å€¼éƒ½æ˜¯0ï¼Œè¿™å°±æ˜¯æ•°æ®ç¨€ç–é—®é¢˜ã€‚æ•°æ®ç¨€ç–æ˜¯ä¸å¥½çš„ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´æ¨¡å‹éš¾ä»¥è®­ç»ƒï¼Œæ¢¯åº¦ä¸‹é™çš„ç‰¹åˆ«æ…¢ã€‚</p><p>æ­¤å¤–ï¼Œå¯¹äºçº¿æ€§æ¨¡å‹æˆ–è€…åœ¨LRæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å…¶å®éƒ½æ˜¯å‡è®¾ç‰¹å¾ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä½†è¿™æ˜¯ä¸å¯¹çš„ã€‚å› ä¸ºåœ¨å…·ä½“çš„æƒ…å†µä¸­ï¼Œç‰¹å¾ä¹‹é—´åº”è¯¥æ˜¯æœ‰å…³ç³»ã€‚è­¬å¦‚:<code>&lt;å¨æˆ¿ï¼Œç±³é¥­&gt;</code>è¿™æ ·ä¸¤ä¸ªç‰¹å¾ä¹‹é—´åº”è¯¥ä¼šæœ‰ä¸€å®šçš„ç›¸å…³æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬å¯¹ç‰¹å¾ä¹‹é—´è¿›è¡Œç»„åˆï¼Œå¯¹äºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›æ¥è¯´ï¼Œæ˜¯æœ‰å¥½å¤„çš„ã€‚</p><p><strong>é‚£ä¹ˆï¼Œå¦‚ä½•å¯¹ç‰¹å¾è¿›è¡Œç»„åˆï¼Ÿ</strong></p><p>å¤šé¡¹å¼æ¨¡å‹æ˜¯åŒ…å«ç‰¹å¾ç»„åˆæœ€ä¸ºç›´è§‚çš„æ¨¡å‹ã€‚æˆ‘ä»¬æ˜¯ç”¨$x_ix_j$æ¥è¡¨ç¤ºç‰¹å¾$x_i$ä¸ç‰¹å¾$x_j$çš„ç»„åˆï¼Œåªæœ‰å½“$x_ix_j$ä¸ç­‰äº0çš„æ—¶å€™ï¼Œç»„åˆç‰¹å¾æ‰æœ‰æ„ä¹‰ã€‚åœ¨FMæ¨¡å‹ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨äºŒé˜¶çš„å¤šé¡¹å¼æ¨¡å‹ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">y(X)=w_0+\sum_{i=1}^{n}w_ix_i+\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}w_{ij}x_ix_j</script><p>å…¶ä¸­ï¼Œ$n$è¡¨ç¤ºç‰¹å¾çš„æ•°é‡ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¬å¼çš„å‰åŠéƒ¨åˆ†å°±æ˜¯LRæ¨¡å‹çš„çº¿æ€§ç»„åˆï¼ŒååŠéƒ¨åˆ†å°±æ˜¯ç»„åˆç‰¹å¾ï¼Œä¹Ÿå«åšäº¤å‰é¡¹ã€‚æ‰€ä»¥ï¼Œ<strong>FMæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›æ¯”LRæ¨¡å‹æ˜¯è¦å¼ºçš„ï¼Œå¹¶ä¸”å½“$w_{ij}$ä¸º0çš„æ—¶å€™ï¼ŒFMæ¨¡å‹å°±é€€åŒ–æˆLRæ¨¡å‹äº†ã€‚(å½“ç„¶ï¼Œå¦‚æœè¦ç”¨äºäºŒåˆ†ç±»çš„è¯ï¼Œéœ€è¦åœ¨å¤šé¡¹å¼æ¨¡å‹ä¹‹ä¸Šç”¨ä¸Šsigmoidå‡½æ•°)ã€‚</strong>æˆ‘ä»¬éœ€è¦è®­ç»ƒçš„å‚æ•°æ˜¯ï¼š$w_0ï¼Œw_iï¼Œw_{ij}$ã€‚</p><p>ä½†æ˜¯å¦‚æœç›´æ¥è®­ç»ƒçš„è¯ï¼Œå‚æ•°$w_{ij}$æ˜¯å¾ˆéš¾è®­ç»ƒçš„ã€‚å› ä¸ºå…¶å‚æ•°è§„æ¨¡ä¸ºï¼š$O(n^2)$ï¼Œå½“$n$å¾ˆå¤§çš„æ—¶å€™ï¼Œé‚£ä¹ˆè®¡ç®—å¤æ‚åº¦éå¸¸çš„å¤§ã€‚è€Œä¸”ï¼Œè®­ç»ƒ$w_{ij}$éœ€è¦å¤§é‡çš„æ»¡è¶³$x_ix_j$éé›¶çš„æ ·æœ¬ï¼Œè€Œç°å®ç”Ÿæ´»ä¸­æ ·æœ¬å¾€å¾€éƒ½æ˜¯ç¨€ç–çš„ï¼Œæ‰€ä»¥æ»¡è¶³è¦æ±‚çš„æ ·æœ¬å°±å¾ˆå°‘ï¼Œæ‰€ä»¥è®­ç»ƒ$w_{ij}$æ˜¯å¾ˆéš¾çš„ã€‚</p><p><strong>é‚£ä¹ˆï¼Œå¦‚ä½•è®­ç»ƒå‚æ•°$w_{ij}$å‘¢ï¼Ÿ</strong></p><p>åœ¨FMæ¨¡å‹ä¸­ï¼Œå®ƒçš„è§£å†³åŠæ³•æ˜¯ï¼š<strong>ä¸ºæ¯ä¸€ä¸ªç‰¹å¾å¼•å…¥ä¸€ä¸ªéšå‘é‡$v_i=(v_{i1},v_{i2},v_{i3},â€¦,v_{ik})^T$ã€‚ </strong>å…¶ä¸­ï¼Œ$k$æ˜¯éšå‘é‡çš„ç»´åº¦ï¼Œä¹Ÿæ˜¯è¶…å‚æ•°ï¼Œéœ€è¦æˆ‘ä»¬å»è°ƒæ•´ã€‚</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/2.jpg" style="zoom: 67%;"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åŒ–ç®€ä¹‹åå‘ç°ï¼Œæˆ‘ä»¬å¯¹äºå‚æ•°$w_{ij}$çš„è®­ç»ƒï¼Œåªéœ€è¦çŸ¥é“æ ·æœ¬é‚£äº›ä¸ä¸º0çš„ç‰¹å¾å°±å¯ä»¥äº†ï¼Œè®¡ç®—å¤æ‚åº¦ä¸ºï¼š$O(kn)$ã€‚æ‰€ä»¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å®ŒæˆFMæ¨¡å‹ã€‚æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼šFMæ¨¡å‹çš„ä¼˜åŠ¿æœ‰ä¸¤ç‚¹ï¼š<strong>1.èƒ½å¤Ÿç”¨æ¥è§£å†³æ•°æ®ç¨€ç–çš„é—®é¢˜ï¼›2.å…·æœ‰çº¿æ€§çš„è®¡ç®—å¤æ‚åº¦ã€‚</strong></p><h2 id="FFMæ¨¡å‹ä»‹ç»"><a href="#FFMæ¨¡å‹ä»‹ç»" class="headerlink" title="FFMæ¨¡å‹ä»‹ç»"></a>FFMæ¨¡å‹ä»‹ç»</h2><p>FFMæ¨¡å‹æ˜¯FMæ¨¡å‹çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå®ƒå¼•å…¥äº†filedè¿™ä¸ªæ¦‚å¿µã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/3.png" alt></p><p>ä¸Šé¢æœ‰4ä¸ªç‰¹å¾ï¼Œå…¶ä¸­$Userã€Movieã€Genre$è¿™ä¸‰ä¸ªç‰¹å¾æ˜¯categorical featureã€‚æˆ‘ä»¬å°†å…¶ä½¿ç”¨one-hotç¼–ç ä¹‹åï¼Œå¯ä»¥å¾—åˆ°5ä¸ªç‰¹å¾ï¼Œ4ä¸ª fieldã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/4.png" alt></p><p>æ‰€ä»¥ä½¿ç”¨FFMæ¨¡å‹ä¹‹åï¼Œå…¶ç»„åˆç‰¹å¾å°±æœ‰10ä¸ªã€‚ä¸‹é¢å…·ä½“ç»™å‡ºæ¨¡å‹ï¼š</p><script type="math/tex; mode=display">y=w_0+\sum_{i=1}^{n}w_ix_i+\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}<v_{i,f_j},v_{j,f_i}>x_ix_j</script><p>å…¶ä¸­ï¼Œ$f_j$è¡¨ç¤ºç¬¬jä¸ªç‰¹å¾å±äºçš„filedã€‚è¿™ä¸ªæ¨¡å‹çš„äºŒæ¬¡é¡¹å‚æ•°æ˜¯$nkf$ã€‚é¢„æµ‹å¤æ‚åº¦ä¸º$O(nk^2)$ã€‚</p><p>åœ¨FFMæ¨¡å‹ä¸­ï¼Œå°†é—®é¢˜å®šä¹‰ä¸ºåˆ†ç±»é—®é¢˜çš„æ—¶å€™ï¼Œå…¶æŸå¤±å‡½æ•°æ˜¯logsitic lossï¼Œä½†æ˜¯ä¸å¹³å¸¸çš„logistic lossæœ‰æ‰€ä¸åŒï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">min \ OBJ=\mathop{min}\limits_{w,b}\sum_{i=1}^{N}log(exp(-y_i(w^Tx_i+b))+\frac {\lambda}{2}w^Tw</script><p>è¿™æ ·çœ‹æ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ªï¼Ÿå’Œå’±ä»¬å¹³æ—¶çœ‹åˆ°çš„LRæ¨¡å‹çš„lossä¸å¤ªä¸€æ ·ï¼Ÿå…¶å®è¿™é‡Œæˆ‘ä»¬éƒ½å¿½ç•¥äº†ä¸€ä¸ªæ¡ä»¶ï¼šå¹³æ—¶æˆ‘ä»¬å­™æ¨å¯¼çš„LR lossçš„æ ‡ç­¾æ˜¯0ä¸1ï¼Œè€Œè¿™é‡Œçš„lossæ˜¯-1ä¸1ã€‚å…¶å®å’Œå¹³æ—¶æˆ‘ä»¬æ¨å¯¼çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-FM-FFM%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/5.jpg" alt></p><p>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨SGDæ¥è¿›è¡Œä¼˜åŒ–ï¼Œè¿™å°±ä¸ä»‹ç»äº†ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚</p><h2 id="FMæ¨¡å‹ã€LRæ¨¡å‹ã€SVMæ¨¡å‹çš„è”ç³»"><a href="#FMæ¨¡å‹ã€LRæ¨¡å‹ã€SVMæ¨¡å‹çš„è”ç³»" class="headerlink" title="FMæ¨¡å‹ã€LRæ¨¡å‹ã€SVMæ¨¡å‹çš„è”ç³»"></a>FMæ¨¡å‹ã€LRæ¨¡å‹ã€SVMæ¨¡å‹çš„è”ç³»</h2><ul><li>FMæ¨¡å‹æ˜¯LRæ¨¡å‹çš„æ‰©å±•ï¼Œåœ¨LRæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†äº¤å‰é¡¹ï¼Œè¿™å°±è®©FMæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›è‡³å°‘è¦è¶…è¿‡LRæ¨¡å‹ï¼Œä¹Ÿå³æ˜¯å®ƒèƒ½å¤„ç†æ›´åŠ å¤æ‚çš„é—®é¢˜ï¼›åŒæ—¶å®ƒæ¥èƒ½ä»¥ä¸LRæ¨¡å‹åŒæ ·çš„æ—¶é—´å¤æ‚åº¦æ¥è®­ç»ƒæ¨¡å‹ï¼Œè¿™ä½¿çš„FMæ¨¡å‹è¦æ¯”LRæ¨¡å‹è¦æ›´åŠ ä¼˜è¶Šã€‚</li><li>FMæ¨¡å‹é€‚åˆå¤„ç†æ•°æ®ç¨€ç–é—®é¢˜ï¼Œè¿™æ¯”ä½¿ç”¨å¤šé¡¹å¼æ ¸çš„SVMè¦æ›´åŠ å¥½ï¼Œå› ä¸ºFMæ¨¡å‹å¯ä»¥åœ¨åŸå§‹å½¢å¼ä¸‹è¿›è¡Œè®­ç»ƒï¼Œè€ŒSVMæ¨¡å‹éœ€è¦è½¬æ¢æˆå¯¹å¶å½¢å¼æ‰èƒ½è®­ç»ƒï¼›æ­¤å¤–ï¼ŒFMæ¨¡å‹çš„é¢„æµ‹æ˜¯ä¸è®­ç»ƒæ ·æœ¬ç‹¬ç«‹çš„ï¼Œè€ŒSVMåˆ™ä¸è®­ç»ƒæ ·æœ¬æœ‰å…³(æ”¯æŒå‘é‡)ã€‚</li><li>LRæ¨¡å‹ä¸SVMæ¨¡å‹çš„å¾ˆé‡è¦çš„åŒºåˆ«åœ¨äºï¼šå…¶ä½¿ç”¨çš„æŸå¤±å‡½æ•°ã€‚LRæ¨¡å‹ä½¿ç”¨çš„æ˜¯äº¤å‰ç†µ cross entropyï¼Œè€ŒSVMæ¨¡å‹ä½¿ç”¨çš„åˆé¡µæŸå¤±hinge lossã€‚</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>1 <a href="https://zhuanlan.zhihu.com/p/37963267" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37963267</a></p><p>2 <a href="https://blog.csdn.net/hiwallace/article/details/81333604" target="_blank" rel="noopener">https://blog.csdn.net/hiwallace/article/details/81333604</a></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> python </tag>
            
            <tag> FMæ¨¡å‹ </tag>
            
            <tag> FFMæ¨¡å‹ </tag>
            
            <tag> Logistic Regression </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ |softmaxæ¨¡å‹è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-softmax%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-softmax%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>softmaxæ˜¯éå¸¸ç®€å•çš„å¤šåˆ†ç±»æ¨¡å‹ï¼Œå¸¸è§äºç¥ç»ç½‘ç»œä¸­çš„è¾“å‡ºå±‚ã€‚é‚£ä¸ºä»€ä¹ˆè¿™ä¹ˆç®€å•çš„æ¨¡å‹è¿˜è¦èŠ±æ—¶é—´å†™ç¯‡æ–‡ç« æ¥è®²å‘¢ï¼Ÿ<strong>åŸå› åœ¨äºï¼šLRæ¨¡å‹å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè€Œsoftmaxæ¨¡å‹å¤§å®¶éƒ½ä¸æ˜¯å¾ˆå…³æ³¨ï¼Œå› ä¸ºå¯èƒ½è§‰å¾—softmaxæ˜¯LRçš„æ¨å¹¿ï¼Œæ‰€ä»¥å°±æ²¡æœ‰è¯¦ç»†å»æ¨å¯¼è¿‡softmaxæ¨¡å‹ä»¥åŠå®ƒçš„åå‘ä¼ æ’­ã€‚</strong>æ‰€ä»¥ï¼Œè¿™ç¯‡åšå®¢ï¼Œå°†ç€é‡è®²è§£ä¸€ä¸‹å…³äºsoftmaxæ¨¡å‹å¯¼æ•°çš„æ¨å¯¼ä¸åå‘ä¼ æ’­çš„æ¨å¯¼ï¼Œå¹¶é‡‡ç”¨pythonè¿›è¡Œå®ç°ã€‚</p><a id="more"></a><blockquote><p>è¿™ç¯‡åšå®¢ä¾§é‡äºsoftmaxå‡½æ•°å¯¼æ•°çš„æ¨å¯¼ï¼Œä»¥åŠsoftmaxçš„loss functionçš„å¯¼æ•°æ¨å¯¼ã€‚</p></blockquote><h2 id="softmaxå‡½æ•°ä»‹ç»"><a href="#softmaxå‡½æ•°ä»‹ç»" class="headerlink" title="softmaxå‡½æ•°ä»‹ç»"></a>softmaxå‡½æ•°ä»‹ç»</h2><p>softmaxå‡½æ•°å¸¸è§äºç¥ç»ç½‘ç»œçš„è¾“å‡ºå±‚ï¼Œç”¨æ¥åšå½’ä¸€åŒ–åˆ†å¸ƒã€‚å®ƒçš„å½¢å¼å¦‚ä¸‹ï¼š </p><script type="math/tex; mode=display">\hat y_i=\frac {e^{a_i}}{\sum_{k=1}^{T}e^{a_k}}</script><p>å…¶ä¸­ï¼Œ$T$è¡¨ç¤ºè¾“å‡ºçš„æ€»ç±»åˆ«æ•°ç›®ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬è®°é‚£ä¸ªæ¨å¯¼ä¸€ä¸‹å…³äºsoftmaxå‡½æ•°çš„å¯¼æ•°å½¢å¼ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-softmax%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" style="zoom:67%;"></p><h2 id="softmaxçš„loss-functionçš„æ±‚å¯¼"><a href="#softmaxçš„loss-functionçš„æ±‚å¯¼" class="headerlink" title="softmaxçš„loss functionçš„æ±‚å¯¼"></a>softmaxçš„loss functionçš„æ±‚å¯¼</h2><p>åœ¨softmaxä¸­ï¼ŒæŸå¤±å‡½æ•°é€šå¸¸ä½¿ç”¨äº¤å‰ç†µã€‚å…¶å¯¹äºå‚æ•°$w,b$çš„æ±‚å¯¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-softmax%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom:67%;"></p><p>è®²è§£å®Œæ¯•ğŸ‰</p><h2 id="softmaxçš„å®ç°"><a href="#softmaxçš„å®ç°" class="headerlink" title="softmaxçš„å®ç°"></a>softmaxçš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†pythonä¸scikit-learnåº“æ¥å®ç°softmaxæ¨¡å‹ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2020-1-2</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.1532.</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š16.96704387664795.</span></span><br><span class="line"><span class="string">--------------</span></span><br><span class="line"><span class="string">tips:å®ç°çš„éå¸¸ç®€å•ï¼Œç›´æ¥å°†è¾“å…¥æ•°æ®è¾“å…¥åˆ°ä¸€ä¸ªçº¿æ€§å±‚ï¼Œç„¶åè¾“å‡º10ä¸ª0-1ä¹‹é—´çš„æ•°ï¼Œä¸­é—´æ²¡æœ‰ç”¨ä»»ä½•çš„éšè—å±‚ï¼Œ</span></span><br><span class="line"><span class="string">ç”±äºæ˜¯çº¿æ€§å˜æ¢ï¼Œæ‰€ä»¥æ•ˆæœæ¯”è¾ƒå·®å§ï¼Œå¦‚æœåŠ å‡ ä¸ªéšè—å±‚ï¼Œæ•ˆæœä¼šå¥½å¾—å¤šï¼</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName:æ•°æ®è·¯å¾„å</span></span><br><span class="line"><span class="string">    :return: ç‰¹å¾å‘é‡çŸ©é˜µã€è¿˜æœ‰æ ‡ç­¾çŸ©é˜µ</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list = [];</span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            label_list.append(int(curline[<span class="number">0</span>]))</span><br><span class="line">            data_list.append([int(feature) / <span class="number">255</span> <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list).reshape(<span class="number">1</span>, <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Softmax</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, train_data, train_label, iter, learning_rate)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="string">        :param train_data: è®­ç»ƒæ•°æ®</span></span><br><span class="line"><span class="string">        :param train_label: è®­ç»ƒæ•°æ®çš„æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">        :param iter: epochçš„æ•°ç›®</span></span><br><span class="line"><span class="string">        :param learning_rate: å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.train_data = train_data</span><br><span class="line">        self.train_label = train_label</span><br><span class="line">        self.iter = iter</span><br><span class="line">        self.learning_rate = learning_rate</span><br><span class="line">        self.feature_num = self.train_data.shape[<span class="number">1</span>]</span><br><span class="line">        self.input_num = self.train_data.shape[<span class="number">0</span>]</span><br><span class="line">        self.w, self.b = self.initialize_params(self.feature_num)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">softmax</span><span class="params">(self, X)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        softmaxå‡½æ•°</span></span><br><span class="line"><span class="string">        :param X: è¾“å…¥æ•°æ®</span></span><br><span class="line"><span class="string">        :return: è¿”å›å«æœ‰10ä¸ªå…ƒç´ çš„np.array</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> np.exp(X) / np.sum(np.exp(X))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initialize_params</span><span class="params">(self, feature_dim)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åˆå§‹åŒ–å‚æ•°w,b</span></span><br><span class="line"><span class="string">        :param feature_dim:å®ä¾‹ç‰¹å¾æ•°ç›®</span></span><br><span class="line"><span class="string">        :return: å‚æ•°w,b</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        w = np.random.uniform(<span class="number">0</span>, <span class="number">1</span>, (feature_dim, <span class="number">10</span>))</span><br><span class="line">        b = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> w, b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®­ç»ƒ</span></span><br><span class="line"><span class="string">        :return:è¿”å›å‚æ•°w,b</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">for</span> iter <span class="keyword">in</span> range(self.iter):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.input_num):</span><br><span class="line">                x = train_data[i].reshape(<span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line">                y = np.zeros((<span class="number">10</span>, <span class="number">1</span>))</span><br><span class="line">                y[train_label[<span class="number">0</span>][i]] = <span class="number">1</span></span><br><span class="line">                y_ = self.softmax(np.dot(self.w.T, x) + self.b)</span><br><span class="line">                self.w -= self.learning_rate * (np.dot((y_ - y), x.T))</span><br><span class="line">                self.b -= self.learning_rate * (y_ - y)</span><br><span class="line">        <span class="keyword">return</span> self.w, self.b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, digit)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        é¢„æµ‹å•ä¸ªæ ·æœ¬çš„å€¼</span></span><br><span class="line"><span class="string">        :param digit: ä¸¥æ ¼æ ·æœ¬çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :return: è¿”å›é¢„æµ‹çš„æ ·æœ¬ç±»åˆ«</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿”å›softmaxä¸­æ¦‚ç‡æœ€å¤§çš„å€¼</span></span><br><span class="line">        <span class="keyword">return</span> np.argmax(np.dot(self.w.T, digit) + self.b)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, test_data, test_label)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æµ‹è¯•</span></span><br><span class="line"><span class="string">        :param test_data: æµ‹è¯•é›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param test_label: æµ‹è¯•é›†çš„æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">        :return: å‡†ç¡®ç‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        error = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(test_data.shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">if</span> (self.predict(test_data[i]) != test_label[<span class="number">0</span>][i]):</span><br><span class="line">                error += <span class="number">1</span></span><br><span class="line">                print(<span class="string">f"the prediction is <span class="subst">&#123;self.predict(test_data[i])&#125;</span>,the true is <span class="subst">&#123;test_label[<span class="number">0</span>][i]&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">        accuracy = (test_data.shape[<span class="number">0</span>] - error) / test_data.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> accuracy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start load data."</span>)</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    a = Softmax(train_data, train_label, <span class="number">50</span>, <span class="number">0.005</span>)</span><br><span class="line">    accuracy = a.test(test_data, test_label)</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> python </tag>
            
            <tag> Logistic Regression </tag>
            
            <tag> softmax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ |XGBoostæ¨¡å‹åŸç†è¯¦è§£ä¸å®æˆ˜</title>
      <link href="2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/"/>
      <url>2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<p>XGBoostæ¨¡å‹æ˜¯é›†æˆå­¦ä¹ ä¸­æœ€ä¸ºè‘—åçš„ä¸€ä¸ªæ¨¡å‹ã€‚ä¸ç”¨æˆ‘è¯´ï¼Œæˆ‘ç›¸ä¿¡åªè¦åšML/DM/DLé¢†åŸŸçš„ç­’å­ä»¬ï¼Œéƒ½ä¼šå¬è¯´è¿‡è¿™ä¸ªæ¨¡å‹ã€‚è¿™ç¯‡åšå®¢å°†è¯¦ç»†åœ°è®²è§£XGBoostæ¨¡å‹çš„åŸç†ï¼Œå¹¶ä¸”ä½¿ç”¨XGBooståº“æ¥å®è·µã€‚æ³¨æ„ï¼š<strong>åœ¨çœ‹XGBoostä¹‹å‰ï¼Œè¯·åŠ¡å¿…è¦è¯»æ‡‚CARTä¸GBDTï¼Œå…·ä½“å¯å‚çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://codewithzichao.github.io/2020/02/27/ç»Ÿè®¡å­¦ä¹ æ–¹æ³•-å†³ç­–æ ‘æ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°/">CART</a>ã€<a href="https://codewithzichao.github.io/2020/02/27/ç»Ÿè®¡å­¦ä¹ æ–¹æ³•-AdaBoostæ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°/#more">GBDT</a>ã€‚</strong></p><a id="more"></a><h2 id="XGBoostæ¨¡å‹ä»‹ç»"><a href="#XGBoostæ¨¡å‹ä»‹ç»" class="headerlink" title="XGBoostæ¨¡å‹ä»‹ç»"></a>XGBoostæ¨¡å‹ä»‹ç»</h2><p><strong>XGBoostæ¨¡å‹æ˜¯å¯¹GBDTå¾ˆå¥½åœ°å·¥ç¨‹åŒ–çš„å®ç°ã€‚</strong>æ‰€ä»¥ï¼ŒXGBoostæ¨¡å‹ä¹Ÿæ˜¯åŠ æ³•æ¨¡å‹ï¼Œå¯¹äºç»™å®šçš„æ ·æœ¬$x_i$ï¼Œæˆ‘ä»¬ä½¿ç”¨XGBoostå¯¹å…¶åˆ†æ•°$\hat y_i$è¿›è¡Œé¢„æµ‹ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/0.jpg" style="zoom:80%;"></p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/1.jpg" style="zoom: 50%;"></p><p>å…¶ä¸­ï¼Œ$K$è¡¨ç¤ºæ€»å…±æœ‰$K$ä¸ªå†³ç­–æ ‘ï¼Œ$f_k$è¡¨ç¤ºç¬¬$k$ä¸ªå†³ç­–æ ‘ï¼Œåœ¨XGBoostä¸­ä½¿ç”¨CARTæ ‘ï¼›$\cal F$è¡¨ç¤ºå‡è®¾å‡è®¾ç©ºé—´ï¼Œå³æ‰€æœ‰å†³ç­–æ ‘çš„é›†åˆã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç»™å‡ºXGBoostæ¨¡å‹çš„æŸå¤±å‡½æ•°(ä¸¥æ ¼æ¥è®²ï¼Œå«åš cost function)ï¼Œä»¥ä¾¿æ±‚å‡ºæ‰€æœ‰çš„$f_k$ã€‚é‚£ä¹ˆï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/2.jpg" style="zoom:80%;"></p><p>å…¶ä¸­ï¼Œ$\sum_{i}l(\hat y_i,y_i)$æ˜¯æŸå¤±å‡½æ•°ï¼Œè¡¨ç¤ºçš„æ˜¯æ¨¡å‹å¯¹äºè®­ç»ƒé›†çš„æ‹Ÿåˆç¨‹åº¦ï¼Œ$\sum_k \Omega(f_k)$è¡¨ç¤ºæ­£åˆ™é¡¹ï¼Œä¹Ÿå«åšæƒ©ç½šé¡¹ï¼ŒXGBoostä¸­å¯¹æ¯ä¸€ä¸ªå›å½’æ ‘è¿›è¡Œæƒ©ç½šï¼Œè®©æ¨¡å‹çš„å¤æ‚åº¦ä¸è¿‡é«˜ï¼Œä»è€Œä¸ä¼šè½»æ˜“è¿‡æ‹Ÿåˆã€‚è€Œè¡¡é‡æ ‘çš„å¤æ‚åº¦çš„æŒ‡æ ‡æœ‰å¾ˆå¤šï¼Œè­¬å¦‚ï¼šæ ‘çš„æ·±åº¦ã€å¶å­ç»“ç‚¹çš„æ•°ç›®ã€å†…éƒ¨èŠ‚ç‚¹æ•°ç›®ç­‰ç­‰ã€‚<strong>åœ¨XGBoostä¸­ï¼Œé‡‡ç”¨äº†å¶å­ç»“ç‚¹çš„æ•°ç›®æ¥è¡¡é‡æ ‘çš„å¤æ‚åº¦</strong>ã€‚å…¶ä¸­ï¼Œ$T$è¡¨ç¤ºçš„æ˜¯å¶å­ç»“ç‚¹çš„æ•°ç›®ï¼Œ$w$è¡¨ç¤ºçš„æ˜¯å¶å­ç»“ç‚¹çš„åˆ†æ•°ï¼Œä¹Ÿå°±æ˜¯å›å½’æ ‘é¢„æµ‹çš„å€¼ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ­£åˆ™åŒ–é¡¹ä¹Ÿç›¸å½“äºå‰ªæäº†ã€‚</p><h3 id="cost-functionçš„æ¨å¯¼"><a href="#cost-functionçš„æ¨å¯¼" class="headerlink" title="cost functionçš„æ¨å¯¼"></a>cost functionçš„æ¨å¯¼</h3><p>æ¥ä¸‹æ¥ï¼Œé‡ç‚¹æ¥äº†ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æŸå¤±å‡½æ•°è¿™ä¸€å—è¿›è¡Œæ³°å‹’å±•å¼€ï¼æ€ä¹ˆåšå‘¢ï¼Ÿå§‹ç»ˆè¦è®°ä½ä¸€å¥è¯ï¼š<strong>XGBoostæ¨¡å‹æ˜¯å¯¹GBDTæ¨¡å‹å¾ˆå¥½åœ°å·¥ç¨‹åŒ–çš„å®ç°ã€‚</strong>æ‰€ä»¥ï¼ŒXGBoostæ¨¡å‹ä»ç„¶æ˜¯<strong>å‰å‘åˆ†æ­¥ç®—æ³•</strong>ã€‚æˆ‘ä»¬éœ€è¦<strong>å¯¹æŸå¤±å‡½æ•°è¿›è¡ŒäºŒé˜¶æ³°å‹’å±•å¼€</strong>ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/3.jpg" style="zoom: 67%;"></p><p>æ‰€ä»¥ï¼Œé€šè¿‡æ³°å‹’å±•å¼€å’ŒåŒ–ç®€ï¼Œæˆ‘ä»¬å¾—åˆ°æœ€ä¼˜çš„cost functionå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">L^{*(t)}=-\frac{1}{2}\mathop{\sum}\limits_{j=1}^{T}\frac{G_j^2}{H_j+\lambda}+\gamma T</script><p>æ‰€ä»¥ï¼Œä»ä¸Šå¼å¯ä»¥çœ‹å‡ºï¼Œ<strong>åªè¦æˆ‘ä»¬ç¡®å®šäº†å›å½’æ ‘çš„ç»“æ„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¾—åˆ°æœ€å°çš„æŸå¤±</strong>ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆå»ç¡®å®šå›å½’æ ‘çš„ç»“æ„å‘¢ï¼Ÿ</p><h3 id="ç¡®å®šå›å½’æ ‘çš„ç»“æ„"><a href="#ç¡®å®šå›å½’æ ‘çš„ç»“æ„" class="headerlink" title="ç¡®å®šå›å½’æ ‘çš„ç»“æ„"></a>ç¡®å®šå›å½’æ ‘çš„ç»“æ„</h3><p>å…³äºå›å½’æ ‘çš„å­¦ä¹ ï¼Œä¸€ä¸ªå¾ˆç›´æ¥çš„æƒ³æ³•ï¼Œå°±æ˜¯éå†æ‰€æœ‰ç‰¹å¾çš„æ‰€æœ‰åˆ‡åˆ†ç‚¹ï¼Œæ‰¾åˆ°æœ€ä½³åˆ‡åˆ†å˜é‡ä¸åˆ‡åˆ†ç‚¹ï¼Œä»è€Œç¡®å®šå›å½’æ ‘çš„ç»“æ„ã€‚é‚£ä¹ˆï¼Œå…³é”®æ˜¯ï¼šæˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆæ ·çš„è¯„ä»·å‡†åˆ™æ¥è¯„åˆ¤åˆ‡åˆ†çš„è´¨é‡å¥½åï¼Ÿåœ¨XGBoostä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å¼å­æ¥è¯„åˆ¤åˆ†è£‚çš„å¥½åï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/4.jpg" style="zoom:67%;"></p><p>å½“$\cal L_{split}$è¶Šå¤§ï¼Œé‚£ä¹ˆè¯´æ˜å¶å­ç»“ç‚¹åˆ†è£‚çš„è´¨é‡è¶Šå¥½ï¼Œæœ€ç»ˆçš„æŸå¤±å‡½æ•°çš„å€¼ä¹Ÿä¼šè¶Šå°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¾æ¬¡æ‰€æœ‰ç‰¹å¾çš„æ‰€æœ‰åˆ‡åˆ†ç‚¹ï¼Œä»ä¸­æ‰¾åˆ°æœ€å¤§çš„$\cal L_{split}$çš„åˆ‡åˆ†ç‚¹å’Œæ‰€å¯¹åº”çš„å€¼ã€‚è¿™ç§æ–¹æ³•å«åšï¼š<strong>ç²¾ç¡®è´ªå¿ƒç®—æ³•</strong>ã€‚</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/5.jpg" style="zoom: 67%;"></p><p>ä½†æ˜¯ï¼Œè¿™ç§åˆ†è£‚ç®—æ³•ï¼Œåœ¨ç‰¹å¾æ•°ç›®ä»¥åŠå…¶å¯¹åº”çš„å–å€¼å¤ªå¤šçš„æ—¶å€™ï¼Œæ•ˆç‡ä¼šéå¸¸çš„æ…¢ï¼Œæ‰€ä»¥ï¼Œåœ¨XGBoostä¸­ï¼Œè¿˜æå‡ºçš„è¿‘ä¼¼è´ªå¿ƒç®—æ³•ã€‚<strong>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæˆ‘ä»¬ä¸éœ€è¦ä¾æ¬¡éå†æ‰€æœ‰ç‰¹å¾å€¼çš„æ‰€æœ‰åˆ‡åˆ†ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°å¹¶éå†æœ‰å¯èƒ½çš„åˆ‡åˆ†ç‚¹ï¼Œä»ä¸­æ‰¾åˆ°$\cal L_{split}$çš„å€¼æœ€å¤§çš„åˆ‡åˆ†å˜é‡ä¸åˆ‡åˆ†ç‚¹å°±å¯ä»¥äº†ã€‚</strong></p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/6.jpg" style="zoom:67%;"></p><p>ä¸è¿‡ï¼Œåœ¨è¿‘ä¼¼ç®—æ³•ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æ ¹æ®æ ·æœ¬æ•°ç›®æ¥è¿›è¡Œåˆ†ä½ï¼Œè€Œæ˜¯ä»¥æ¯ä¸€ä¸ªæ ·æœ¬çš„äºŒé˜¶å¯¼æ•°ä½œä¸ºæƒé‡ï¼Œä»¥æ­¤æ’åºï¼Œæ¥è¿›è¡Œåˆ†ä½ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå¯ä»¥é‡‡ç”¨äºŒé˜¶å¯¼æ•°æ¥åšæƒé‡å‘¢ï¼Ÿæ¨å¯¼å¦‚ä¸‹ï¼ˆå‚çœ‹é“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/75217528" target="_blank" rel="noopener">xgboost</a>ï¼‰ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/8.jpg" style="zoom: 33%;"></p><h2 id="ç¨€ç–å€¼çš„å¤„ç†"><a href="#ç¨€ç–å€¼çš„å¤„ç†" class="headerlink" title="ç¨€ç–å€¼çš„å¤„ç†"></a>ç¨€ç–å€¼çš„å¤„ç†</h2><p>ç¨€ç–å€¼æœ‰ä¸‰ç§ï¼š<strong>å¤§é‡çš„0å€¼ã€å¤§é‡çš„ç±»åˆ«one-hotç¼–ç ã€ç¼ºå¤±å€¼ã€‚</strong>XGBoostå¯ä»¥è‡ªåŠ¨å­¦ä¹ å‡ºç¨€ç–å€¼çš„èŠ‚ç‚¹åˆ†è£‚æ–¹å‘ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-XGBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/7.jpg" style="zoom:67%;"></p><ul><li>é¦–å…ˆéœ€è¦æ³¨æ„åˆ°è¾“å…¥çš„ä¸¤ä¸ªé›†åˆï¼š<strong>ä¸€ä¸ªæ˜¯$I$ï¼Œå…¶åŒ…å«æ‰€æœ‰çš„æ ·æœ¬(åŒ…æ‹¬å«ç©ºç¼ºå€¼çš„æ ·æœ¬)ï¼›å¦ä¸€ä¸ªæ˜¯$I_k$ï¼Œæ˜¯ä¸åŒ…å«ç©ºç¼ºå€¼æ ·æœ¬çš„é›†åˆã€‚åœ¨è®¡ç®—æ€»çš„$G$å’Œ$H$çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯$I$ã€‚</strong></li><li>æ­¤å¤–ï¼Œå¯ä»¥çœ‹åˆ°å†…å±‚å¾ªç¯é‡Œé¢æœ‰ä¸¤ä¸ªforã€‚<strong>ç¬¬ä¸€ä¸ªforæ˜¯ä»æŠŠç‰¹å¾å–å€¼ä»å°åˆ°å¤§æ’åºã€‚</strong>è¿™ä¸ªæ—¶å€™ï¼Œåœ¨è®¡ç®—$G_R$çš„æ—¶å€™ï¼Œæ˜¯ç”¨æ€»çš„$G$å‡å»$G_L$ï¼Œè®¡ç®—$H_R$ä¹Ÿæ˜¯ä½¿ç”¨$H$å‡å»$H_L$ã€‚è¿™å°±ç›¸å½“äºå°†ç¨€ç–å€¼å½’åˆ°äº†å³èŠ‚ç‚¹ã€‚</li><li><strong>ç¬¬äºŒä¸ªforæ˜¯ä»æŠŠç‰¹å¾å–å€¼ä»å¤§åˆ°å°æ’åºã€‚</strong>è¿™ä¸ªæ—¶å€™ï¼Œåœ¨è®¡ç®—$G_L$ çš„æ—¶å€™ï¼Œæ˜¯ç”¨æ€»çš„$G$å‡å»$G_R$ï¼Œè®¡ç®—$H_L$ä¹Ÿæ˜¯ä½¿ç”¨$H$å‡å»$H_R$ã€‚è¿™å°±ç›¸å½“äºå°†ç¨€ç–å€¼å½’åˆ°äº†å·¦èŠ‚ç‚¹ã€‚</li><li><strong>æˆ‘ä»¬åªè¦æ¯”è¾ƒæœ€å¤§çš„å¢ç›Šå‡ºç°åœ¨ç¬¬ä¸€ä¸ªforï¼Œè¿˜æ˜¯ç¬¬äºŒä¸ªforï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“ç¨€ç–å€¼çš„åˆ†è£‚æ–¹å‘æ˜¯åœ¨å·¦è¿˜æ˜¯å³ã€‚</strong>è¿™å°±æ˜¯XGBoostæ¨¡å‹å¤„ç†ç¨€ç–å€¼çš„æ–¹æ³•ã€‚</li></ul><h2 id="two-tricks"><a href="#two-tricks" class="headerlink" title="two tricks"></a>two tricks</h2><p>åœ¨XGBoostæ¨¡å‹ä¸­ï¼Œé™¤äº†é€šè¿‡æ·»åŠ æ­£åˆ™åŒ–é¡¹æ¥é˜²æ­¢è¿‡æ‹Ÿåˆä¹‹å¤–ï¼Œè¿˜ç”¨äº†å¦å¤–ä¸¤ä¸ªç”¨æ¥é˜²æ­¢è¿‡æ‹Ÿåˆçš„trickï¼š<strong>shrinkage(ç¼©å‡)ã€column subsampling(åˆ—æŠ½æ ·)ã€‚</strong>æˆ‘ä»¬ä¸€ä¸€ä»‹ç»ã€‚<strong>shrinkage</strong>ã€‚æ‰€è°“çš„shrinkageï¼Œå°±æ˜¯å°†å­¦ä¹ é€Ÿç‡å‡å°ï¼Œå¢åŠ è¿­ä»£æ¬¡æ•°ï¼Œä»è€Œèµ·åˆ°æ­£åˆ™åŒ–çš„ä½œç”¨ã€‚<strong>column subsampling</strong>ã€‚è¿™ä¸ªå’ŒRFä¸­æ˜¯ä¸€æ ·çš„ï¼Œæ²¡ä»€ä¹ˆå¯è¯´çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒXGBoostæ¨¡å‹è¿˜æœ‰ä¸€äº›å·¥ç¨‹åŒ–çš„ä¸œè¥¿ï¼Œåƒcacheçš„è®¾è®¡ç­‰ç­‰ã€‚è¿™äº›æ„Ÿå…´è¶£çš„ç­’å­ä»¬ï¼Œå¯ä»¥å»çœ‹åŸå§‹paperğŸ‰ï½</p><h2 id="XGBoostæ¨¡å‹å®æˆ˜"><a href="#XGBoostæ¨¡å‹å®æˆ˜" class="headerlink" title="XGBoostæ¨¡å‹å®æˆ˜"></a>XGBoostæ¨¡å‹å®æˆ˜</h2><p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šä»å¤´å»å»å®ç°ä¸€ä¸ªXGBoostæ¨¡å‹ï¼Œé‚£æ ·ååˆ†å¤æ‚ï¼Œè€Œä¸”ä¸ªäººè§‰å¾—æ„ä¹‰ä¸æ˜¯å¾ˆå¤§å“ˆã€‚æ„Ÿå…´è¶£çš„é€šçŸ¥å¯ä»¥å»ç›´æ¥å»é˜…è¯»æºç ç»†èŠ‚ï¼Œè¿™æ ·åè€Œæ›´å¥½äº›ğŸ‰åœ¨è¿™é‡Œï¼Œæˆ‘å°†ä½¿ç”¨xgbåº“æ¥å¯¹XGBoostæ¨¡å‹è¿›è¡Œå®è·µã€‚(å¤œæ·±äº†ï¼Œæ˜å¤©å†™å§ğŸ¥±)</p><p>é™„ä¸Šä»£ç ğŸ‘‡ä¸è¿‡è¯´å®è¯ï¼ŒXGBoostçš„å‚æ•°çœŸçš„å¤šğŸ˜£ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š1.0</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š53.53627586364746</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">print(pd.__version__)</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">path = os.getcwd()</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"></span><br><span class="line">train = pd.read_csv(path + <span class="string">"/MnistData/mnist_train.csv"</span>, names=list(i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">784</span>)))</span><br><span class="line">test = pd.read_csv(path + <span class="string">"/MnistData/mnist_test.csv"</span>, names=list(i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">784</span>)))</span><br><span class="line"></span><br><span class="line">train_data = train.iloc[:, <span class="number">1</span>:]</span><br><span class="line">train_label = train.iloc[:, <span class="number">0</span>]</span><br><span class="line">print(train_data.shape)</span><br><span class="line">print(train_label.shape)</span><br><span class="line">test_data = test.iloc[:, <span class="number">1</span>:]</span><br><span class="line">test_label = test.iloc[:, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'booster'</span>: <span class="string">'gbtree'</span>,</span><br><span class="line">    <span class="string">'objective'</span>: <span class="string">'multi:softmax'</span>,  <span class="comment"># å¤šåˆ†ç±»çš„é—®é¢˜</span></span><br><span class="line">    <span class="string">'num_class'</span>: <span class="number">10</span>,  <span class="comment"># ç±»åˆ«æ•°ï¼Œä¸ multisoftmax å¹¶ç”¨</span></span><br><span class="line">    <span class="string">'gamma'</span>: <span class="number">0.1</span>,  <span class="comment"># ç”¨äºæ§åˆ¶æ˜¯å¦åå‰ªæçš„å‚æ•°,è¶Šå¤§è¶Šä¿å®ˆï¼Œä¸€èˆ¬0.1ã€0.2è¿™æ ·å­ã€‚</span></span><br><span class="line">    <span class="string">'max_depth'</span>: <span class="number">12</span>,  <span class="comment"># æ„å»ºæ ‘çš„æ·±åº¦ï¼Œè¶Šå¤§è¶Šå®¹æ˜“è¿‡æ‹Ÿåˆ</span></span><br><span class="line">    <span class="string">'lambda'</span>: <span class="number">2</span>,  <span class="comment"># æ§åˆ¶æ¨¡å‹å¤æ‚åº¦çš„æƒé‡å€¼çš„L2æ­£åˆ™åŒ–é¡¹å‚æ•°ï¼Œå‚æ•°è¶Šå¤§ï¼Œæ¨¡å‹è¶Šä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚</span></span><br><span class="line">    <span class="string">'subsample'</span>: <span class="number">0.7</span>,  <span class="comment"># éšæœºé‡‡æ ·è®­ç»ƒæ ·æœ¬</span></span><br><span class="line">    <span class="string">'colsample_bytree'</span>: <span class="number">0.7</span>,  <span class="comment"># ç”Ÿæˆæ ‘æ—¶è¿›è¡Œçš„åˆ—é‡‡æ ·</span></span><br><span class="line">    <span class="string">'min_child_weight'</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="comment"># è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯ 1ï¼Œæ˜¯æ¯ä¸ªå¶å­é‡Œé¢ h çš„å’Œè‡³å°‘æ˜¯å¤šå°‘ï¼Œå¯¹æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡æ—¶çš„ 0-1 åˆ†ç±»è€Œè¨€</span></span><br><span class="line">    <span class="comment"># ï¼Œå‡è®¾ h åœ¨ 0.01 é™„è¿‘ï¼Œmin_child_weight ä¸º 1 æ„å‘³ç€å¶å­èŠ‚ç‚¹ä¸­æœ€å°‘éœ€è¦åŒ…å« 100 ä¸ªæ ·æœ¬ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªå‚æ•°éå¸¸å½±å“ç»“æœï¼Œæ§åˆ¶å¶å­èŠ‚ç‚¹ä¸­äºŒé˜¶å¯¼çš„å’Œçš„æœ€å°å€¼ï¼Œè¯¥å‚æ•°å€¼è¶Šå°ï¼Œè¶Šå®¹æ˜“ overfittingã€‚</span></span><br><span class="line">    <span class="string">'silent'</span>: <span class="number">0</span>,  <span class="comment"># è®¾ç½®æˆ1åˆ™æ²¡æœ‰è¿è¡Œä¿¡æ¯è¾“å‡ºï¼Œæœ€å¥½æ˜¯è®¾ç½®ä¸º0.</span></span><br><span class="line">    <span class="string">'eta'</span>: <span class="number">0.007</span>,  <span class="comment"># å¦‚åŒå­¦ä¹ ç‡</span></span><br><span class="line">    <span class="string">'seed'</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="string">'nthread'</span>: <span class="number">7</span>,  <span class="comment"># cpu çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="comment"># 'eval_metric': 'auc'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">num_rounds = <span class="number">5000</span>  <span class="comment"># è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line">X_train, X_validation, Y_train, Y_validation = train_test_split(train_data, train_label, test_size=<span class="number">0.3</span>, random_state=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># random_state is of big influence for val-auc</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xgb_val = xgb.DMatrix(X_validation, label=Y_validation)</span><br><span class="line">xgb_train = xgb.DMatrix(X_train, label=Y_train)</span><br><span class="line">xgb_test = xgb.DMatrix(test_data)</span><br><span class="line"></span><br><span class="line">watchlist = [(xgb_train, <span class="string">'train'</span>), (xgb_val, <span class="string">'val'</span>)]  <span class="comment"># å…è®¸æŸ¥çœ‹train setä¸dev setçš„è¯¯å·®è¡¨ç°</span></span><br><span class="line"><span class="comment"># training model</span></span><br><span class="line"><span class="comment"># early_stopping_rounds å½“è®¾ç½®çš„è¿­ä»£æ¬¡æ•°è¾ƒå¤§æ—¶ï¼Œearly_stopping_rounds å¯åœ¨ä¸€å®šçš„è¿­ä»£æ¬¡æ•°å†…å‡†ç¡®ç‡æ²¡æœ‰æå‡å°±åœæ­¢è®­ç»ƒ</span></span><br><span class="line">model = xgb.train(params, xgb_train, num_rounds, watchlist, early_stopping_rounds=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">model.save_model(path + <span class="string">"/xgboost/xgb.model"</span>)  <span class="comment"># ç”¨äºå­˜å‚¨è®­ç»ƒå‡ºçš„æ¨¡å‹</span></span><br><span class="line">print(<span class="string">"best best_ntree_limit"</span>, model.best_ntree_limit)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"è·‘åˆ°è¿™é‡Œäº†model.predict"</span>)</span><br><span class="line">preds = model.predict(xgb_test, ntree_limit=model.best_ntree_limit)</span><br><span class="line"></span><br><span class="line">accuracy_test = accuracy_score(preds, test_label)</span><br><span class="line">print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy_test&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="comment"># è¾“å‡ºè¿è¡Œæ—¶é•¿</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f"xgboost success! cost time:<span class="subst">&#123;end - start&#125;</span>(s)."</span>)</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>1 ã€ŠXGBoost: A Scalable Tree Boosting Systemã€‹ </p><p>2 <a href="https://www.jianshu.com/p/ac1c12f3fba1" target="_blank" rel="noopener">https://www.jianshu.com/p/ac1c12f3fba1</a></p><p>3 <a href="https://zhuanlan.zhihu.com/p/86816771" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/86816771</a></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> python </tag>
            
            <tag> é›†æˆå­¦ä¹  </tag>
            
            <tag> XGBoost </tag>
            
            <tag> GBDT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|AdaBoostæ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-AdaBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-AdaBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>AdaBoostæ¨¡å‹æ˜¯æå‡æ–¹æ³•çš„ä»£è¡¨ï¼Œå¯¹äºä¹‹åç†è§£XGBoostç­‰é›†æˆå­¦ä¹ æ¨¡å‹å¾ˆæœ‰å¸®åŠ©ã€‚<strong>ä½†æ˜¯ï¼Œåœ¨å­¦ä¹ AdaBoostæ¨¡å‹ä¹‹å‰ï¼Œè¯·åŠ¡å¿…è¦å…ˆææ‡‚å›å½’æ ‘(CART)ï¼Œå› ä¸ºå½“AdaBoostçš„åŸºæœ¬åˆ†ç±»å™¨æ˜¯å›å½’æ ‘æ—¶ï¼Œéœ€è¦ç”¨åˆ°å›å½’æ ‘ã€‚</strong>æœ¬ç¯‡åšå®¢å°†è¯¦ç»†è®²è§£AdaBoostæ¨¡å‹çš„åŸç†ï¼Œå¹¶ä¼šè®²è§£æ¢¯åº¦æå‡æ ‘æ¨¡å‹(GBDT)ï¼Œå¹¶é‡‡ç”¨pythonä¸scikit-learnå¯¹å…¶è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="AdaBoostæ¨¡å‹ä»‹ç»"><a href="#AdaBoostæ¨¡å‹ä»‹ç»" class="headerlink" title="AdaBoostæ¨¡å‹ä»‹ç»"></a>AdaBoostæ¨¡å‹ä»‹ç»</h2><p>AdaBoostæ¨¡å‹æ˜¯å…¸å‹çš„æå‡æ–¹æ³•ã€‚é‚£ä¹ˆä½•è°“æå‡(boosting)æ–¹æ³•å‘¢ï¼Ÿ<strong>å½“æˆ‘ä»¬å¾ˆéš¾ä¸€æ¬¡æ€§æ‰¾åˆ°ä¸€ä¸ªæ•ˆæœå¾ˆå¥½çš„æ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‰¾åˆ°ä¸€äº›æ•ˆæœä¸é‚£ä¹ˆå¥½çš„æ¨¡å‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå¼±å­¦ä¹ ç®—æ³•ï¼Œç„¶åå°†è¿™äº›å¼±å­¦ä¹ ç®—æ³•é€šè¿‡æŸç§ç»„åˆï¼Œå°†å…¶æå‡(boost)ä¸ºå¼ºå­¦ä¹ ç®—æ³•ï¼Œè¿™å°±æ˜¯æå‡æ–¹æ³•çš„æ€æƒ³ã€‚</strong>é‚£ä¹ˆï¼ŒAdaBoostæ¨¡å‹å°±æ˜¯å…¸å‹çš„åº”ç”¨äºåˆ†ç±»é—®é¢˜çš„æå‡ç®—æ³•ã€‚AdaBoostæ¨¡å‹çš„åšæ³•æ˜¯ï¼šä»å¼±å­¦ä¹ ç®—æ³•ä¸­å­¦ä¹ ä¸€ç³»åˆ—å¼±åˆ†ç±»å™¨ï¼Œç„¶åé€šè¿‡æŸç§ç»„åˆï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„å¼ºåˆ†ç±»å™¨ã€‚é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼š<strong>AdaBoostæ¨¡å‹æ˜¯æ€ä¹ˆå¾—åˆ°ä¸€ç³»åˆ—å¼±åˆ†ç±»å™¨çš„å‘¢ï¼Ÿ</strong>åœ¨æå‡æ–¹æ³•ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡è°ƒæ•´è®­ç»ƒæ•°æ®é›†çš„æ¦‚ç‡åˆ†å¸ƒï¼Œé€šè¿‡ä¸åŒçš„è®­ç»ƒé›†åˆ†å¸ƒæ¥å¾—åˆ°ä¸€ç³»åˆ—çš„å¼±åˆ†ç±»å™¨ã€‚é‚£ä¹ˆï¼Œé—®é¢˜åˆæ¥äº†ï¼š<strong>AdaBoostæ¨¡å‹æ˜¯æ€ä¹ˆæ”¹å˜è®­ç»ƒé›†çš„æ¦‚ç‡åˆ†å¸ƒçš„å‘¢ï¼ŸAdaBoostæ¨¡å‹åˆæ˜¯æ€ä¹ˆå°†ä¸€ç³»åˆ—å¼±åˆ†ç±»å™¨ç»„åˆæˆå¼ºåˆ†ç±»å™¨çš„å‘¢ï¼Ÿ</strong></p><ul><li>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<strong>AdaBoostæ¨¡å‹æé«˜åœ¨ä¸Šä¸€è½®è¢«é”™è¯¯åˆ†ç±»çš„å®ä¾‹çš„æƒé‡ï¼Œé™ä½è¢«æ­£ç¡®åˆ†ç±»çš„å®ä¾‹çš„æƒé‡ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåœ¨ä¸‹ä¸€è½®çš„å­¦ä¹ ä¸­ï¼Œè¢«é”™è¯¯åˆ†ç±»çš„å®ä¾‹å°†å¾—åˆ°æ›´å¤§çš„å…³æ³¨ï¼Œä»è€Œæœ‰æ›´å¤§æ¦‚ç‡è¢«æ­£ç¡®åˆ†ç±»ã€‚</strong></li><li>å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼š<strong>AdaBoostæ¨¡å‹é‡‡å–åŠ æƒè¡¨å†³çš„åšæ³•ã€‚ç»™äºˆé‚£äº›åˆ†ç±»å‡†ç¡®ç‡é«˜çš„å¼±åˆ†ç±»å™¨æ›´å¤§çš„æƒé‡ï¼Œè€Œå¯¹äºåˆ†ç±»å‡†ç¡®ç‡ä½çš„å¼±åˆ†ç±»å™¨æ›´å°çš„æƒé‡ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆåˆç†çš„ã€‚</strong></li></ul><p>é‚£ä¹ˆä»‹ç»å®ŒAdaBoostæ¨¡å‹çš„åŸºæœ¬æ€æƒ³ä¹‹åï¼Œä¸‹é¢æˆ‘å°†ç»™å‡ºAdaBoostæ¨¡å‹çš„å…·ä½“å…¬å¼ç»†èŠ‚ï¼š</p><p>è¾“å…¥ï¼šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2,â€¦,x_N,y_N)\}$ï¼Œå…¶ä¸­$x_i\in R^n$ï¼Œ$y_i\in \{-1,+1\}$ï¼›å¼±å­¦ä¹ ç®—æ³•ï¼›</p><p>è¾“å‡ºï¼šåˆ†ç±»å™¨$G(x)$ã€‚</p><p>(1) åˆå§‹åŒ–è®­ç»ƒæ•°æ®é›†çš„æƒå€¼åˆ†å¸ƒ$D_1$ï¼Œå®é™…ä¸Šæ˜¯å‡åŒ€åˆ†å¸ƒã€‚å³ï¼š$D_1=\{w_{11},w_{12},w_{13},â€¦,w_{1N}\}$ï¼Œå…¶ä¸­$w_{1i}=\frac 1N$ã€‚</p><p>(2) å¯¹äº$m=1,2,3,â€¦,M$ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>â€‹    (a) æ ¹æ®å¸¦æœ‰æƒå€¼åˆ†å¸ƒçš„è®­ç»ƒæ•°æ®é›†ï¼Œå­¦ä¹ å¼±åˆ†ç±»å™¨ï¼š</p><script type="math/tex; mode=display">G_m(x) : \cal{X}->\{-1,+1\}</script><p>â€‹    (b) è®¡ç®—è®­ç»ƒæ•°æ®é›†çš„åˆ†ç±»è¯¯å·®ç‡ï¼š</p><script type="math/tex; mode=display">e_m=\sum_{i=1}^{N}w_{mi}I(G_m(x_i)\not=y_i)</script><p>â€‹    (c) è®¡ç®—è¯¥åˆ†ç±»å™¨çš„æƒé‡ï¼š</p><script type="math/tex; mode=display">\alpha_m=\frac 12log\frac {(1-e_m)}{e_m}</script><p>â€‹    (d) æ›´æ–°è®­ç»ƒæ•°æ®é›†çš„æƒå€¼åˆ†å¸ƒï¼š</p><script type="math/tex; mode=display">D_{m+1}=(w_{m+1,1},w_{m+1,2},...,w_{m=1,i},...,w_{m+1,N}),\\w_{m+1,i}=\frac{w_{mi}}{Z_m}exp(-\alpha_my_iG_m(x_i)),\\Z_m=\sum_{i=1}^{N}w_{mi}exp(-\alpha_my_iG_m(x_i)),\\æˆ–è€…ï¼Œ\ \  w_{m+1,i}=\begin{cases}                                        \frac{w_{mi}}{Z_m}exp(\alpha_m)& G_m(x_i)\not=y_i\\                    \frac{w_{mi}}{Z_m}exp(-\alpha_m)& G_m(x_i)=y_i                                        \end{cases}</script><p>(3) æ„å»ºåŸºæœ¬åˆ†ç±»å™¨çš„çº¿æ€§ç»„åˆï¼š</p><script type="math/tex; mode=display">G(x)=\sum_{m=1}^{M}\alpha_mG_m(x)</script><p>(4) å¾—åˆ°æœ€ç»ˆçš„åˆ†ç±»å™¨ï¼š</p><script type="math/tex; mode=display">f(x)=sign(G(x))</script><h2 id="AdaBoostæ¨¡å‹çš„å¦ä¸€ç§è¡¨è¿°å½¢å¼"><a href="#AdaBoostæ¨¡å‹çš„å¦ä¸€ç§è¡¨è¿°å½¢å¼" class="headerlink" title="AdaBoostæ¨¡å‹çš„å¦ä¸€ç§è¡¨è¿°å½¢å¼"></a>AdaBoostæ¨¡å‹çš„å¦ä¸€ç§è¡¨è¿°å½¢å¼</h2><p>AdaBoostæ¨¡å‹è¿˜æœ‰å¦å¤–ä¸€ç§è§£é‡Šï¼šAdaBoostæ¨¡å‹æ˜¯<strong>æ¨¡å‹ä¸ºåŠ æ³•æ¨¡å‹ã€æŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°ã€å­¦ä¹ ç®—æ³•æ˜¯å‰å‘åˆ†æ­¥ç®—æ³•çš„äºŒç±»åˆ†ç±»æ¨¡å‹ã€‚</strong></p><p><strong>åŠ æ³•æ¨¡å‹</strong>ã€‚åŠ æ³•æ¨¡å‹çš„å½¢å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f(x)=\sum_{m=1}^{M}\beta_mb(x,\gamma_m)</script><p>å…¶ä¸­ï¼Œ$\beta$æ˜¯ç³»æ•°ï¼Œ$b(x,\gamma_m)$æ˜¯åŸºæœ¬åˆ†ç±»å™¨ï¼Œ$\gamma$æ˜¯å…¶å‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å­¦ä¹ çš„å‚æ•°å°±æ˜¯$\beta_m,\gamma_m$ã€‚</p><p><strong>æŸå¤±å‡½æ•°</strong>ã€‚å½“ç»™å®šæŸå¤±å‡½æ•°$L(y,f(x))=exp(-yf(x))$ä¹‹åï¼Œæ•´ä¸ªæ±‚è§£é—®é¢˜å˜æˆå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\mathop{min}\limits_{\beta_m,\gamma_m}\sum_{i=1}^{N}L(y_i,\sum_{m=1}^{M}\beta_mb(x_i,\gamma_m))</script><p>ä½†æ˜¯ï¼Œä¸€æ¬¡æ€§è¦æ±‚è§£Mä¸ªåŸºåˆ†ç±»å™¨çš„å‚æ•°ä¸ç³»æ•°ï¼Œæ˜¯éå¸¸å›°éš¾çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡‡ç”¨å‰å‘åˆ†æ­¥ç®—æ³•æ¥è¿›è¡Œæ±‚è§£ã€‚</p><p><strong>å‰å‘åˆ†æ­¥ç®—æ³•</strong>ã€‚æ‰€è°“çš„å‰å‘åˆ†æ­¥ç®—æ³•ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸€æ¬¡åªæ±‚è§£ä¸€ä¸ªåŸºåˆ†ç±»å™¨çš„å‚æ•°ä¸ç³»æ•°ï¼Œä»è€Œèƒ½å¤Ÿå¤§å¤§ç®€åŒ–è¿ç®—ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\mathop{min}\limits_{\beta,\gamma}\sum_{i=1}^{N}L(y_i,\beta b(x_i,\gamma))</script><p>æ‰€ä»¥ï¼Œæ•´ä¸ªAdaBoostæ¨¡å‹å¦‚ä¸‹ï¼š</p><p>è¾“å…¥ï¼šç»™å®šè®­ç»ƒé›†ä¸æŸå¤±å‡½æ•°ä»¥åŠåŸºæœ¬åˆ†ç±»å™¨é›†åˆã€‚</p><p>è¾“å‡ºï¼šæœ€ç»ˆçš„æ¨¡å‹$f(x)$ã€‚</p><p>(1) åˆå§‹åŒ–$f_0(x)=0$ã€‚</p><p>(2) å¯¹$m=1,2,â€¦,M$ï¼Œæœ‰</p><p>â€‹    (a) æå°åŒ–æŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">(\beta_m,\gamma_m)=\mathop{argmin}\limits_{\beta,\gamma}\sum_{i=1}^{N}L(y_i,f_{m-1}(x_i)+\beta b(x_i,\gamma))</script><p>å¾—åˆ°å‚æ•°$\beta_m, \gamma_m$ã€‚</p><p>â€‹    (b) æ›´æ–°æ¨¡å‹</p><script type="math/tex; mode=display">f_m(x)=f_{m-1}(x)+\beta_m b(x,\gamma_m)</script><p>(3) å¾—åˆ°æœ€ç»ˆçš„æ¨¡å‹</p><script type="math/tex; mode=display">f(x)=\sum_{m=1}^{M}\beta_m b(x,\gamma_m)</script><h2 id="GBDT"><a href="#GBDT" class="headerlink" title="GBDT"></a>GBDT</h2><p>æå‡æ ‘æ¨¡å‹æ˜¯ä»¥åˆ†ç±»æ ‘æˆ–è€…å›å½’æ ‘ä¸ºåŸºæœ¬åˆ†ç±»å™¨çš„æå‡æ–¹æ³•ã€‚å®ƒä¹Ÿæ˜¯ä½¿ç”¨åŠ æ³•æ¨¡å‹ä»¥åŠå‰å‘åˆ†æ­¥ç®—æ³•æ¥è¿›è¡Œæ±‚è§£æ¨¡å‹çš„ã€‚å½“å¯¹äºäºŒç±»åˆ†ç±»é—®é¢˜çš„æ—¶å€™ï¼Œå…¶ç­‰ä»·äºAdaBoostæ¨¡å‹ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚è¿™é‡Œï¼Œç€é‡è®²ä¸€ä¸‹å…³äºåº”ç”¨äºå›å½’é—®é¢˜çš„æå‡æ ‘æ¨¡å‹ã€‚</p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-AdaBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" style="zoom:50%;"></p><p>åœ¨å›å½’é—®é¢˜ä¸­ï¼ŒæŸå¤±å‡½æ•°å¸¸ä½¿ç”¨å‡æ–¹è¯¯å·®MSEã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">L(y,f(x))=(y-f(x))^2</script><p>å†åŒ–ç®€ä¸€ä¸‹ï¼š</p><script type="math/tex; mode=display">L(y,f(x))=L(y,f_{m-1}(x)+T(x,\theta_m))^2=(y-f_{m-1}(x)=T(x,\theta))^2</script><p>æˆ‘ä»¬è®°$y-f_{m-1}(x)$ä¸ºæ®‹å·®$r$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ä½¿æŸå¤±å‡½æ•°æœ€å°ï¼Œåªè¦è®©å½“å‰æ¨¡å‹å»æ‹Ÿåˆæ•°æ®çš„æ®‹å·®å³å¯ã€‚</p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-AdaBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom:50%;"></p><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å›å½’æ ‘ï¼š$f_M(x)=\sum_{m=1}^{M}T(x,\theta_m)$ã€‚è®¡ç®—çš„ä¾‹å­å¯ä»¥å‚è€ƒè¿™é‡Œï¼š<a href="https://zhuanlan.zhihu.com/p/36108972" target="_blank" rel="noopener">GBDTçš„è®¡ç®—ç¤ºä¾‹</a></p><p>å¯¹äºæŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°æˆ–è€…æ˜¯MSEï¼Œå…¶å®å­¦ä¹ å›å½’æ ‘æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä½†æ˜¯å½“æŸå¤±å‡½æ•°æ˜¯ä¸€èˆ¬çš„æŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œè®¡ç®—å¾€å¾€å°±ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªå¤§è‡´çš„æ¡†æ¶ï¼Œè€Œä¹‹åè¦è®²çš„XGBoost/Light GBM/catBoostç­‰æ ‘æ¨¡å‹å°±æ˜¯å¯¹GBDTçš„å¾ˆå¥½åœ°å·¥ç¨‹åŒ–çš„å®ç°ã€‚</p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-AdaBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.jpg" style="zoom:50%;"></p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-AdaBoost%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" style="zoom:50%;"></p><p>ç†è®ºéƒ¨åˆ†å°±è®²åˆ°è¿™é‡ŒğŸ‰</p><h2 id="AdaBoostæ¨¡å‹çš„å®ç°"><a href="#AdaBoostæ¨¡å‹çš„å®ç°" class="headerlink" title="AdaBoostæ¨¡å‹çš„å®ç°"></a>AdaBoostæ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°AdaBoostæ¨¡å‹ï¼špythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><h3 id="scikit-learnå®ç°"><a href="#scikit-learnå®ç°" class="headerlink" title="scikit-learnå®ç°"></a>scikit-learnå®ç°</h3><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1 ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹</p><p>2 <a href="https://zhuanlan.zhihu.com/p/105497113" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/105497113</a></p>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> å†³ç­–æ ‘ </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> CART </tag>
            
            <tag> å›å½’æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|å†³ç­–æ ‘æ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>å†³ç­–æ ‘æ¨¡å‹ä¸€ç§åŸºæœ¬çš„åˆ†ç±»ä¸å›å½’æ–¹æ³•ï¼Œæ˜¯shallow learningçš„Adaboostã€XGBoostã€Light GBMã€catBoostç­‰æ ‘æ¨¡å‹çš„åŸºç¡€ï¼Œå¯¹äºç†è§£è¿™äº›æ¨¡å‹å¤§æœ‰è£¨ç›Šã€‚è¿™ç¯‡åšå®¢å°†è¯¦ç»†åœ°è®²è§£åŸºæœ¬çš„å†³ç­–æ ‘æ¨¡å‹ï¼Œä¸»è¦ä¼šä¾§é‡å›å½’æ ‘çš„è®²è§£ï¼Œå› ä¸ºè¿™æ˜¯Adaboostã€XGBoostã€Light GBMã€catBoostç­‰æ ‘æ¨¡å‹çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚å¹¶é‡‡ç”¨pythonä¸scikit-learnæ¥å¯¹å…¶è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="å†³ç­–æ ‘æ¨¡å‹ä»‹ç»"><a href="#å†³ç­–æ ‘æ¨¡å‹ä»‹ç»" class="headerlink" title="å†³ç­–æ ‘æ¨¡å‹ä»‹ç»"></a>å†³ç­–æ ‘æ¨¡å‹ä»‹ç»</h2><p>å†³ç­–æ ‘æ¨¡å‹æ˜¯æ¯”è¾ƒç®€å•çš„æ¨¡å‹ã€‚å®ƒçš„ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯ï¼š<strong>ç‰¹å¾é€‰æ‹©ã€å†³ç­–æ ‘çš„ç”Ÿæˆã€å†³ç­–æ ‘çš„å‰ªæ</strong>ã€‚</p><h3 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="headerlink" title="ç‰¹å¾é€‰æ‹©"></a>ç‰¹å¾é€‰æ‹©</h3><p>æ‰€è°“çš„ç‰¹å¾é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæƒ³ï¼šåœ¨æ²¡æœ‰æ„å»ºå†³ç­–æ ‘ä¹‹å‰ï¼Œåªçœ‹è®­ç»ƒæ•°æ®é›†ï¼Œæ˜¯å¾ˆæ··ä¹±çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æ ¹æ®è®­ç»ƒæ•°æ®é›†ï¼Œç›´æ¥åˆ¤æ–­æ–°çš„å®ä¾‹çš„ç±»åˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®­ç»ƒé›†æ˜¯æ²¡æœ‰åˆ†ç±»èƒ½åŠ›çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æ„å»ºä¸€å¥—è§„åˆ™ï¼Œå½“æˆ‘ä»¬åº”ç”¨è¿™å¥—è§„åˆ™çš„æ—¶å€™ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°å®ä¾‹çš„ç±»åˆ«ã€‚é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼š<strong>æˆ‘ä»¬æ€ä¹ˆé€‰æ‹©åˆ†ç±»çš„ç‰¹å¾ï¼Œæ‰èƒ½ä½¿å¾—åˆ†ç±»çš„æ•ˆæœæœ€å¥½å‘¢ï¼Ÿ</strong>è¿™å°±æ˜¯ç‰¹å¾é€‰æ‹©éœ€è¦åšçš„äº‹æƒ…ã€‚å¸¸è§çš„åº”ç”¨ä¸ç‰¹å¾é€‰æ‹©çš„å‡†åˆ™æœ‰ï¼š<strong>ä¿¡æ¯å¢ç›Šä¸ä¿¡æ¯å¢ç›Šæ¯”ã€‚</strong></p><h4 id="ä¿¡æ¯å¢ç›Š"><a href="#ä¿¡æ¯å¢ç›Š" class="headerlink" title="ä¿¡æ¯å¢ç›Š"></a>ä¿¡æ¯å¢ç›Š</h4><p><strong>ä¿¡æ¯å¢ç›Šè¡¨ç¤ºåœ¨å·²çŸ¥ç‰¹å¾$A$çš„æ¡ä»¶ä¸‹ï¼Œä»è€Œä½¿å¾—æ•°æ®é›†çš„ä¸ç¡®å®šæ€§å‡å°‘çš„ç¨‹åº¦ã€‚</strong>çœ‹åˆ°ä¸ç¡®å®šæ€§ï¼Œå¾ˆè‡ªç„¶åœ°å°±ä¼šè”æƒ³åˆ°ç†µï¼å› ä¸ºç†µæ­£æ˜¯ç”¨æ¥åº¦é‡éšæœºå˜é‡ä¸ç¡®å®šæ€§çš„ç¨‹åº¦ã€‚é‚£ä¹ˆï¼Œä¸‹é¢ç»™å‡ºç†µçš„å®šä¹‰ï¼š</p><p>å‡è®¾ç¦»æ•£éšæœºå˜é‡$X$çš„æ¦‚ç‡åˆ†å¸ƒæ˜¯ï¼š$P(X=i)=p_i,i=1,2,â€¦,n$ï¼Œé‚£ä¹ˆéšæœºå˜é‡$X$çš„ç†µå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H(p)=-\sum_{i=1}^{n}p_ilog(p_i)</script><p>åœ¨ç»™å®š$X$çš„æƒ…å†µä¸‹ï¼Œéšæœºå˜é‡$Y$çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ$P(Y|X)$çš„æ¡ä»¶ç†µå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H(Y|X)=\sum_{i=1}^{n}p_iP(Y|X=x_i)</script><p>å½“å…¶ä¸­çš„æ¦‚ç‡æ˜¯ç”±æ•°æ®ä¼°è®¡(MLE)å¾—åˆ°çš„æ—¶å€™ï¼Œå°±ç§°ä¸ºç»éªŒæ¡ä»¶ç†µã€‚</p><p>åœ¨çŸ¥é“ç†µçš„æ¦‚å¿µä¹‹åï¼Œé‚£ä¹ˆä¿¡æ¯å¢ç›Šçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">g(D,A)=H(D)-H(D|A)</script><p>å…¶ä¸­ï¼Œ$D$è¡¨ç¤ºè®­ç»ƒæ•°æ®é›†ï¼Œ$A$è¡¨ç¤ºç‰¹å¾ã€‚å³ï¼šç‰¹å¾Aå¯¹äºè®­ç»ƒæ•°æ®é›†$D$çš„ä¿¡æ¯å¢ç›Šå°±ç­‰äº$D$çš„ç»éªŒç†µä¸ç»™å®šç‰¹å¾$A$çš„æƒ…å†µä¸‹$D$çš„ç»éªŒæ¡ä»¶ç†µä¹‹å·®ã€‚é‚£ä¹ˆå¯¹äºå†³ç­–æ ‘æ¨¡å‹æ¥è¯´ï¼Œç‰¹å¾é€‰æ‹©çš„å‡†åˆ™æ˜¯ï¼š<strong>é€‰æ‹©ä¿¡æ¯å¢ç›Šå¤§çš„ç‰¹å¾ï¼Œå› ä¸ºä¿¡æ¯å¢ç›Šå¤§çš„ç‰¹å¾å…·æœ‰æ›´å¼ºçš„åˆ†ç±»èƒ½åŠ›ã€‚</strong>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" alt></p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom: 50%;"></p><h4 id="ä¿¡æ¯å¢ç›Šæ¯”"><a href="#ä¿¡æ¯å¢ç›Šæ¯”" class="headerlink" title="ä¿¡æ¯å¢ç›Šæ¯”"></a>ä¿¡æ¯å¢ç›Šæ¯”</h4><p>é‚£ä¹ˆæœ‰äº†ä¿¡æ¯å¢ç›Šï¼Œä¸ºå•¥è¿˜è¦æœ‰ä¿¡æ¯å¢ç›Šæ¯”å‘¢ï¼ŸåŸå› åœ¨äºï¼šä½¿ç”¨ä¿¡æ¯å¢ç›Šå‡†åˆ™ä¼šå¯¼è‡´å†³ç­–æ ‘ä¼šæ›´åŠ åå‘äºç‰¹å¾å–å€¼æ•°ç›®å¤šçš„ç‰¹å¾ã€‚å› ä¸ºï¼Œé€‰å–ç‰¹å¾å–å€¼æ•°ç›®å¤šçš„ç‰¹å¾ï¼Œä¼šè®©è®­ç»ƒé›†çš„ä¿¡æ¯å¢ç›Šå¢å¤§ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªè®­ç»ƒé›†çš„ä¸çº¯åº¦é™ä½ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä»¥æ¥ï¼Œä¼šå¯¼è‡´æ„å»ºçš„å†³ç­–æ ‘æ¨¡å‹å®¹æ˜“è¿‡æ‹Ÿåˆã€‚å› æ­¤ï¼Œå°±æœ‰äº†ä¿¡æ¯å¢ç›Šæ¯”ã€‚</p><script type="math/tex; mode=display">g_R(D,A)=\frac {g(D,A)}{H_A(D)},\\H_A(D)=-\sum_{i=1}^{n}\frac {|D_i|}{|D|}log_2\frac {|D_i|}{|D|}</script><h3 id="å†³ç­–æ ‘çš„ç”Ÿæˆ"><a href="#å†³ç­–æ ‘çš„ç”Ÿæˆ" class="headerlink" title="å†³ç­–æ ‘çš„ç”Ÿæˆ"></a>å†³ç­–æ ‘çš„ç”Ÿæˆ</h3><p>å†³ç­–æ ‘çš„ç”Ÿæˆç®—æ³•æœ‰3ä¸­ï¼šID3ã€C4.5ã€CARTã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†è®²è§£ID3ã€C4.5ã€‚CARTå°†å•ç‹¬è®²ï¼Œå› ä¸ºå…¶æ˜¯åæ¥é‚£äº›å¤§ç«çš„é›†æˆæ¨¡å‹çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ID3ä¸C4.5å…¶å®å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºç‰¹å¾é€‰æ‹©çš„å‡†åˆ™ä¸åŒï¼š<strong>ID3ä½¿ç”¨äº†ä¿¡æ¯å¢ç›Šï¼ŒC4.5ä½¿ç”¨äº†ä¿¡æ¯å¢ç›Šæ¯”ã€‚</strong>åœ¨è¿™é‡Œï¼Œæˆ‘æ”¾ä¸Šã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸­å…³äºC4.5çš„ç®—æ³•è¿‡ç¨‹ã€‚</p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.jpg" style="zoom:50%;"></p><h3 id="å†³ç­–æ ‘çš„å‰ªæ"><a href="#å†³ç­–æ ‘çš„å‰ªæ" class="headerlink" title="å†³ç­–æ ‘çš„å‰ªæ"></a>å†³ç­–æ ‘çš„å‰ªæ</h3><p>å½“æˆ‘ä»¬æ„å»ºå¥½äº†å†³ç­–æ ‘ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™æ ·æ„å»ºçš„å†³ç­–æ ‘å¾ˆå®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆã€‚åŸå› åœ¨äºï¼š<strong>æˆ‘ä»¬åœ¨æ„å»ºå†³ç­–æ ‘çš„æ—¶å€™ï¼Œå°½å¯èƒ½åœ°å»æ‹Ÿåˆè®­ç»ƒæ•°æ®ï¼Œä»è€Œå¾—åˆ°äº†è¿‡äºå¤æ‚çš„å†³ç­–æ ‘ã€‚</strong>é‚£ä¹ˆä¸€ç§å¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯ï¼šå¯¹å†³ç­–æ ‘è¿›è¡Œå‰ªæï¼Œä»è€Œè®©å†³ç­–æ ‘ä¸é‚£ä¹ˆå¤æ‚ã€‚å½“ç„¶ï¼Œè¿™æ ·ä»¥æ¥ï¼Œå°±ä¼šä½¿å¾—å†³ç­–æ ‘çš„å‡†ç¡®ç‡ä¸‹é™ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ¨¡å‹å¤æ‚åº¦ä¸å¯¹è®­ç»ƒé›†çš„é¢„æµ‹è¯¯å·®ä¹‹é—´åšä¸€ä¸ªtradeoffã€‚æˆ‘ä»¬æ‰€ç”¨çš„æŸå¤±å‡½æ•°å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">C_{\alpha}(T)=C(T)+\alpha|T|</script><p>å…¶ä¸­ï¼Œ$T$è¡¨ç¤ºå†³ç­–æ ‘ï¼Œ$\alpha$æ˜¯å‚æ•°ï¼Œç”¨æ¥å¹³è¡¡æ¨¡å‹å¤æ‚åº¦ä¸é¢„æµ‹è¯¯å·®ä¹‹é—´çš„å…³ç³»ã€‚$C(T)$è¡¨ç¤ºæ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„è¯¯å·®ï¼Œ$|T|$è¡¨ç¤ºæ¨¡å‹çš„å¤æ‚åº¦ã€‚å½“$\alpha$è¶Šå¤§ï¼Œæ¨¡å‹è¶Šç®€å•ã€‚(æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè®°ï¼šå½“$\alpha$ä¸º0çš„æ—¶å€™ï¼Œå†³ç­–æ ‘æ˜¯è¿‡æ‹Ÿåˆçš„ï¼Œæ‰€ä»¥å¢å¤§$\alpha$ï¼Œä¼šè®©å†³ç­–æ ‘å˜å¾—ç®€å•ã€‚)</p><h2 id="CART"><a href="#CART" class="headerlink" title="CART"></a>CART</h2><p>CARTï¼Œå…¨åå«ä½œï¼šåˆ†ç±»ä¸å›å½’æ ‘ã€‚æ‰€ä»¥ï¼Œæ­£å¦‚åå­—ä¸€æ ·ï¼Œå®ƒæ—¢å¯ä»¥ç”¨äºåˆ†ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨äºå›å½’é—®é¢˜ã€‚åœ¨<strong>åˆ†ç±»é—®é¢˜</strong>ä¸­ï¼Œä½¿ç”¨çš„ç‰¹å¾é€‰æ‹©çš„å‡†åˆ™æ˜¯ï¼š<strong>åŸºå°¼æŒ‡æ•°(Gini)æœ€å°åŒ–</strong>ï¼›å¯¹äº<strong>å›å½’é—®é¢˜</strong>ï¼Œä½¿ç”¨çš„ç”Ÿæˆæ–¹æ³•æ˜¯ï¼š<strong>å¹³æ–¹è¯¯å·®æœ€å°åŒ–</strong>ã€‚åˆ†ç±»é—®é¢˜æˆ‘å°±ä¸ä»‹ç»äº†ï¼Œåªä»‹ç»ä¸€ä¸‹ç”¨äºå›å½’é—®é¢˜çš„å›å½’æ ‘ã€‚</p><p>ç»™å®šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),â€¦,(x_N,y_N)\}$ï¼Œé‚£ä¹ˆå›å½’é—®é¢˜å°±æ˜¯æˆ‘ä»¬è¦æ„é€ ä¸€ä¸ªå‡½æ•°$f(x)$ï¼Œèƒ½å¤Ÿä½¿å¾—è®­ç»ƒæ•°æ®é›†çš„MSEæœ€å°ï¼Œå³ï¼š</p><script type="math/tex; mode=display">min\sum_{i=1}^{N}(f(x_i)-y_i)^2</script><p>å‡è®¾ï¼Œæˆ‘ä»¬å°†è¾“å…¥ç©ºé—´åˆ’åˆ†ä¸º$R_1,R_2,â€¦,R_M$ï¼Œå¹¶ä¸”åœ¨æ¯ä¸€ä¸ªåŒºåŸŸæœ‰ä¸€ä¸ªè¾“å‡ºå¸¸æ•°$c_m$ã€‚é‚£ä¹ˆç›®æ ‡å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">min\sum_{i=1}^{N}\sum_{x_i\in R_m}(c_m-y_i)^2</script><p>è€Œå…¶ä¸­$c_m$çš„æœ€ä¼˜å€¼ä¸ºå°±æ˜¯ä¸ºè¯¥åŒºåŸŸçš„å‡å€¼ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\hat c_m=ave(y_i|x_i\in R_m)</script><p>æ‰€ä»¥ï¼Œå›å½’æ ‘å°±å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">f(x)=\sum_{m=1}^{M}c_mI(x\in R_m)</script><p>é‚£ä¹ˆå…³é”®æ˜¯ï¼Œ<strong>æ€ä¹ˆå¯¹è¾“å…¥ç©ºé—´è¿›è¡Œåˆ’åˆ†å‘¢ï¼Ÿ</strong>æ–¹æ³•ï¼šæ¯”é‚£é‡Œæ‰€æœ‰çš„åˆ‡åˆ†å˜é‡ä¸åˆ‡åˆ†ç‚¹ï¼Œæ‰¾åˆ°ä½¿å¾—MSEæœ€å°çš„åˆ’åˆ†ã€‚å‡è®¾é¦–å…ˆéšæœºé€‰æ‹©ç¬¬$j$ä¸ªç‰¹å¾åšä¸ºåˆ’åˆ†å˜é‡ï¼Œå…¶å¯¹åº”çš„å€¼ä¸º$s$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®²ç©ºé—´åˆ’åˆ†ä¸ºä¸¤ä¸ªï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">R_1(j,s)=\{x|x^{(j)}<=s\},\\R_2(j,s)=\{x|x^{(j)}>s\}</script><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¦‚ä¸‹å‡½æ•°$m(s)$ï¼Œä»è€Œæ‰¾åˆ°æœ€ä¼˜çš„åˆ’åˆ†å˜é‡ä¸åˆ’åˆ†å€¼ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\mathop{min}\limits_{j,s}[\mathop{min}\limits_{c_1}\sum_{x_i\in R_1}{(y_i-c_1)^2}+\mathop{min}\limits_{c_2}\sum_{x_i\in R_2}{(y_i-c_2)^2}]</script><p>å…¶ä¸­ï¼Œ$\hat c_m=ave(y_i|x_i\in R_m),m=1,2$ã€‚é‚£ä¹ˆï¼Œéå†æ‰€æœ‰çš„å˜é‡ï¼Œæ‰¾åˆ°æœ€å°$m(s)$çš„$j,s,c_m$ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°æœ€åçš„å›å½’æ ‘äº†ã€‚(åœ¨è¿™é‡Œé™„ä¸Šã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹çš„å›¾)ã€‚å…·ä½“çš„è®¡ç®—ä¾‹å­ï¼Œå‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/36108972" target="_blank" rel="noopener">GBDTè®¡ç®—</a>ï¼Œè¿™é‡Œè™½ç„¶è®²è§£çš„æ˜¯æå‡æ ‘ï¼Œä½†æ˜¯ç”±äºå›å½’é—®é¢˜çš„æå‡æ ‘æ˜¯ä»¥å›å½’æ ‘åšä¸ºåŸºæœ¬åˆ†ç±»å™¨ï¼Œæ‰€ä»¥å…¶ä¸­ä¹Ÿæ¶‰åŠåˆ°äº†å›å½’æ ‘çš„æ„å»ºè¿‡ç¨‹ã€‚</p><p><img src="/2020/02/27/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" style="zoom:50%;"></p><p>OKï¼Œç†è®ºéƒ¨åˆ†å°±è®²å®Œäº†ğŸ‰ï½</p><h2 id="å†³ç­–æ ‘æ¨¡å‹çš„å®ç°"><a href="#å†³ç­–æ ‘æ¨¡å‹çš„å®ç°" class="headerlink" title="å†³ç­–æ ‘æ¨¡å‹çš„å®ç°"></a>å†³ç­–æ ‘æ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°å†³ç­–æ ‘æ¨¡å‹ï¼špythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><h3 id="scikit-learnå®ç°"><a href="#scikit-learnå®ç°" class="headerlink" title="scikit-learnå®ç°"></a>scikit-learnå®ç°</h3>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> CART </tag>
            
            <tag> å›å½’æ ‘ </tag>
            
            <tag> decision tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|Kè¿‘é‚»ç®—æ³•åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/26/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%9C%80%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/26/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%9C%80%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>KNNç®—æ³•æ˜¯ä¸€ç§è¾ƒä¸ºç®€å•çš„åˆ†ç±»ç®—æ³•ï¼ˆä¹Ÿå¯ç”¨äºå›å½’é—®é¢˜ï¼‰ï¼Œå…¶å¯ä»¥å®ç°å¤šåˆ†ç±»é—®é¢˜ã€‚æœ¬ç¯‡åšå®¢å°†è¯¦ç»†åœ°è®²è§£KNNç®—æ³•ï¼Œå¹¶é‡‡ç”¨pythonä¸scikit-learnåº“ä¸¤ç§æ–¹å¼ï¼Œå¯¹KNNç®—æ³•è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="KNNç®—æ³•ä»‹ç»"><a href="#KNNç®—æ³•ä»‹ç»" class="headerlink" title="KNNç®—æ³•ä»‹ç»"></a>KNNç®—æ³•ä»‹ç»</h2><p>KNNç®—æ³•æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚å®ƒçš„æ•´ä¸ªåº”ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>è¾“å…¥ï¼šç»™å®šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),â€¦,(x_N,y_N)\}$ï¼Œå…¶ä¸­ï¼Œ$x_i=\{x_i^{(1)},x_i^{(2)},â€¦,x_i^{(n)}\}$ï¼Œå³æ¯ä¸€ä¸ªç‰¹å¾å‘é‡éƒ½æœ‰nç»´ï¼Œ$y_i\in \{c_1,c_2,â€¦,c_k\}$ï¼Œå³æ€»å…±æœ‰$k$ä¸ªæ ‡ç­¾ç±»åˆ«ï¼›å¾…é¢„æµ‹å®ä¾‹$x$ã€‚</p><p>è¾“å‡ºï¼šè¾“å‡ºå®ä¾‹$x$æ‰€å±çš„æ ‡ç­¾ç±»åˆ«$y$ã€‚</p><ul><li>è®¡ç®—å®ä¾‹$x$ä¸æ‰€æœ‰è®­ç»ƒé›†å®ä¾‹çš„è·ç¦»ï¼Œå¹¶ä»ä¸­é€‰å–$K$ä¸ªæœ€è¿‘çš„å®ä¾‹ï¼Œè¿™$K$ä¸ªç‚¹æ‰€ç»„æˆçš„åŒºåŸŸå«åš$x$çš„é‚»åŸŸã€‚</li><li>æ ¹æ®åˆ†ç±»å†³ç­–è§„åˆ™ï¼Œç¡®å®š$x$æ‰€å±çš„æ ‡ç­¾ç±»åˆ«$y$ã€‚</li></ul><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ŸğŸ¤©ä»ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒKNNç®—æ³•ä¸­ï¼Œæœ€é‡è¦çš„ä¸‰ä¸ªè¦ç´ æ˜¯ï¼š<strong>Kå€¼çš„é€‰æ‹©ã€è·ç¦»çš„è®¡ç®—ã€åˆ†ç±»å†³ç­–è§„åˆ™</strong>ã€‚ä¸‹é¢å°±è®²ä¸€ä¸€ä»‹ç»ã€‚</p><h2 id="Kå€¼çš„é€‰æ‹©"><a href="#Kå€¼çš„é€‰æ‹©" class="headerlink" title="Kå€¼çš„é€‰æ‹©"></a>Kå€¼çš„é€‰æ‹©</h2><p>Kå€¼çš„é€‰æ‹©ï¼Œå¯ä»¥è¯´æ˜¯æ•´ä¸ªæ¨¡å‹çš„æ ¸å¿ƒã€‚ä½†æ˜¯åœ¨å®é™…ä¸Šï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„å…¬å¼ç²¾ç¡®åœ°å‘Šè¯‰æˆ‘ä»¬ï¼ŒKå€¼çš„é€‰æ‹©ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸€ä¸‹ï¼š</p><ul><li>å½“Kå€¼éå¸¸å¤§çš„æ—¶å€™(è­¬å¦‚K=N)ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œä¸ç®¡è¾“å…¥çš„$x$æ˜¯ä»€ä¹ˆï¼Œç»“æœéƒ½ä¸ä¼šå˜ï¼Œéƒ½ä¼šåå‘äºè®­ç»ƒé›†ä¸­å¤§å¤šæ•°çš„é‚£ä¸ªæ ‡ç­¾ç±»åˆ«ï¼Œæ¨¡å‹è¿‡äºç®€å•ã€‚</li><li>å½“Kå€¼éå¸¸å°çš„æ—¶å€™(è­¬å¦‚K=1)ï¼Œé‚£ä¹ˆï¼Œåªæœ‰ä¸è¾“å…¥å®ä¾‹ç›¸è¿‘çš„ç‚¹æ‰ä¼šèµ·ä½œç”¨ï¼Œé‚£ä¹ˆå¦‚æœæ°å·§æ˜¯å™ªå£°çš„è¯ï¼Œå°±ä¼šé¢„æµ‹é”™è¯¯ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒKå€¼å¤ªå°çš„è¯ï¼Œæ¨¡å‹ä¼šå˜å¾—å¤æ‚ï¼Œå®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆã€‚</li></ul><p>æ‰€ä»¥ï¼Œåœ¨å®é™…ä¸­ï¼Œä¼šè®©Kå€¼å–ä¸€ä¸ªé€‚ä¸­çš„å€¼ï¼Œæˆ–è€…é‡‡ç”¨äº¤å‰éªŒè¯çš„æ–¹å¼æ¥é€‰å–æœ€ä¼˜çš„Kå€¼ã€‚</p><h2 id="è·ç¦»çš„è®¡ç®—"><a href="#è·ç¦»çš„è®¡ç®—" class="headerlink" title="è·ç¦»çš„è®¡ç®—"></a>è·ç¦»çš„è®¡ç®—</h2><p>åœ¨KNNç®—æ³•ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨æ¬§å¼è·ç¦»ï¼Œä½†æ˜¯ä¹Ÿæœ‰å…¶ä»–çš„è·ç¦»ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">{\text{æ¬§å¼è·ç¦»}}\ \ \ \ \  L_2(x_i,x_j)=(\sum_{k=1}^{n}|x_i^{(k)}-x_j^{(k)}|^2)^{\frac 12}\\{\text{æ›¼å“ˆé¡¿è·ç¦»}}\ \ \ \ \ \ L_1(x_i,x_j)=(\sum_{k=1}^{n}|x_i^{(k)}-x_j^{(k)}|)\\{\text{åˆ‡æ¯”é›ªå¤«è·ç¦»}}\ \ \ \ \ \ L_\infty(x_i,x_j)=\mathop{max}\limits_{k=1}^{n}|x_i^{(k)}-x_j^{(k)}|</script><p>åœ¨KNNä¸­ï¼Œä½¿ç”¨ä¸åŒçš„è·ç¦»åº¦é‡ï¼Œæ‰€å¾—åˆ°çš„æœ€è¿‘é‚»ç‚¹æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><h2 id="åˆ†ç±»å†³ç­–è§„åˆ™"><a href="#åˆ†ç±»å†³ç­–è§„åˆ™" class="headerlink" title="åˆ†ç±»å†³ç­–è§„åˆ™"></a>åˆ†ç±»å†³ç­–è§„åˆ™</h2><p>åœ¨KNNä¸­ï¼Œåˆ†ç±»å†³ç­–è§„åˆ™ä¸€èˆ¬éƒ½æ˜¯å¤šæ•°è¡¨å†³ã€‚å³ï¼š<strong>ç”±Kä¸ªå®ä¾‹ä¸­çš„å¤šæ•°æ ‡ç­¾ç±»åˆ«å†³å®šã€‚</strong>ä½¿ç”¨å…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">y=argmax_{c_j}\sum_{x_i\in N_k(x)}I(y_i=c_j)</script><p>å…¶ä¸­ï¼Œ$I$æ˜¯æŒ‡ç¤ºå‡½æ•°ã€‚</p><h2 id="kd-tree"><a href="#kd-tree" class="headerlink" title="kd tree"></a>kd tree</h2><p>å…¶å®ï¼Œä»‹ç»å®Œä¸‰è¦ç´ åï¼ŒKNNç®—æ³•ç®—æ˜¯å®Œæˆäº†ã€‚ä½†æ˜¯æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹KNNç®—æ³•ã€‚æˆ‘ä»¬æ¯é¢„æµ‹ä¸€ä¸ªå®ä¾‹ï¼Œéƒ½éœ€è¦è®¡ç®—å…¶ä¸è®­ç»ƒé›†æ‰€æœ‰å®ä¾‹çš„è·ç¦»ï¼Œå¹¶ä¸”ä»ä¸­å–å‡ºKä¸ªå®ä¾‹ã€‚å¦‚æœè¯´ï¼Œæ•°æ®æ˜¯é«˜ç»´çš„ï¼Œå¹¶ä¸”è®­ç»ƒé›†éå¸¸çš„å¤§(mnistè®­ç»ƒæ•°æ®é›†ä¸­ï¼Œæœ‰60000ä¸ª)ï¼Œé‚£ä¹ˆè®¡ç®—å°±ä¼šå˜å¾—éå¸¸çš„æ…¢ã€‚å¦‚æœè¯´æµ‹è¯•é›†ä¹Ÿéå¸¸å¤§çš„è¯ï¼Œé‚£ä¹ˆæ‰€èŠ±è´¹çš„æ—¶å€™å°±ä¼šæ›´é•¿ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æœ‰äººæå‡ºäº†kdtreeã€‚<strong>æ³¨æ„ï¼šè¿™é‡Œçš„kè¯´çš„æ˜¯å¯¹kç»´ç©ºé—´è¿›è¡Œåˆ’åˆ†ï¼Œä¸Kå€¼ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼</strong></p><p><strong>æ‰€è°“çš„kdtreeï¼Œå°±æ˜¯å°†ç‰¹å¾ç©ºé—´åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œå¦‚æœè¯´ä¸€äº›åŒºåŸŸç¦»å¾…é¢„æµ‹çš„å®ä¾‹çš„è·ç¦»å¤ªè¿œï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¾å¼ƒæ‰è¿™äº›åŒºåŸŸï¼Œè¿™æ ·å°±å¤§å¤§å‡å°äº†æ¯”è¾ƒæ¬¡æ•°ï¼Œæé«˜äº†è®¡ç®—æ•ˆç‡ã€‚</strong></p><p>é‚£æˆ‘ä»¬å…·ä½“æ¥å‰–æä¸€ä¸‹kdtreeã€‚å®ƒå…¶å®æ˜¯BSTçš„å˜ä½“ã€‚BSTï¼Œç›¸ä¿¡åªè¦å­¦è¿‡æ•°æ®ç»“æ„ï¼Œåº”è¯¥éƒ½éå¸¸ç†Ÿæ‚‰ã€‚<strong>BSTçš„å·¦å­æ ‘éƒ½æ¯”èµ·çˆ¶èŠ‚ç‚¹çš„å€¼è¦å°ï¼Œå…¶å³å­æ ‘éƒ½æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼è¦å¤§ã€‚</strong>ä½†æ˜¯åœ¨BSTä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ä¸€ç»´æ•°æ®ï¼Œè€Œåœ¨ï¼Œkdtreeä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¤šç»´æ•°æ®ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜kdtreeæ˜¯æ€ä¹ˆå·¥ä½œçš„(ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸­å…¶å®å¹¶æ²¡æœ‰è®²åœ°ç‰¹åˆ«æ¸…æ¥šğŸ˜©)ï¼š</p><p><img src="/2020/02/26/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%9C%80%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" alt></p><p>è­¬å¦‚è¯´æœ‰é›†åˆ$\{(2,3)ï¼Œ(5,4)ï¼Œ(9,6)ï¼Œ(4,7)ï¼Œ(8,1)ï¼Œ(7,2)\}$ã€‚é‚£ä¹ˆkdtreeæ„å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ„å»ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶çš„åˆ‡åˆ†ç»´åº¦ä¸º$x$ï¼Œé›†åˆåœ¨xç»´ä»å°åˆ°å¤§æ’åºä¸º$(2,3)ï¼Œ(4,7)ï¼Œ(5,4)ï¼Œ(7,2)ï¼Œ(8,1)ï¼Œ(9,6)$ï¼›å®ƒçš„ä¸­å€¼ä¸º(7,2)ã€‚<strong>æ³¨æ„ï¼š2,4,5,7,8,9åœ¨æ•°å­¦ä¸­çš„ä¸­å€¼ä¸º(5 + 7)/2=6ï¼Œä½†å› è¯¥ç®—æ³•çš„ä¸­å€¼éœ€åœ¨ç‚¹é›†åˆä¹‹å†…ï¼Œæ‰€ä»¥ä¸­å€¼è®¡ç®—ç”¨çš„æ˜¯ $len(points)//2=3, points[3]=(7,2) $ï¼‰ã€‚</strong>æ‰€ä»¥ï¼Œ$(2,3)ï¼Œ(4,7)ï¼Œ(5,4)$æŒ‚åœ¨$(7,2)$èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œ$(8,1)ï¼Œ(9,6)$æŒ‚åœ¨$(7,2)$èŠ‚ç‚¹çš„å³å­æ ‘ã€‚</li><li>æ„å»º$(7,2)$èŠ‚ç‚¹çš„å·¦å­æ ‘æ—¶ï¼Œç‚¹é›†åˆ$(2,3)ï¼Œ(4,7)<a href>$</a>ï¼Œ(5,4)æ­¤æ—¶çš„åˆ‡åˆ†ç»´åº¦ä¸ºyï¼Œä¸­å€¼ä¸º$(5,4)$ä½œä¸ºåˆ†å‰²å¹³é¢ï¼Œ$(2,3)$æŒ‚åœ¨å…¶å·¦å­æ ‘ï¼Œ$(4,7)$æŒ‚åœ¨å…¶å³å­æ ‘ã€‚</li><li>æ„å»º$(7,2)$èŠ‚ç‚¹çš„å³å­æ ‘æ—¶ï¼Œç‚¹é›†åˆ$(8,1)ï¼Œ(9,6)$æ­¤æ—¶çš„åˆ‡åˆ†ç»´åº¦ä¹Ÿä¸ºyï¼Œä¸­å€¼ä¸º$(9,6)$ä½œä¸ºåˆ†å‰²å¹³é¢ï¼Œ$(8,1)$æŒ‚åœ¨å…¶å·¦å­æ ‘ã€‚è‡³æ­¤kd treeæ„å»ºå®Œæˆã€‚ä½¿ç”¨äºŒç»´ç©ºé—´ç”»å‡ºæ¥çš„è¯ï¼Œå¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/02/26/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%9C%80%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" alt></p><p>OKï¼Œå½“æ„å»ºå®Œkdtreeä¹‹åï¼Œé‚£ä¹ˆ<strong>å¦‚ä½•å¯¹å…¶è¿›è¡Œæœç´¢å‘¢ï¼Ÿ</strong></p><ul><li><p>æˆ‘ä»¬æ¥æŸ¥æ‰¾ç‚¹$(2.1,3.1)$ï¼Œåœ¨$(7,2)$ç‚¹æµ‹è¯•åˆ°è¾¾$(5,4)$ï¼Œåœ¨$(5,4)$ç‚¹æµ‹è¯•åˆ°è¾¾$(2,3)$ï¼Œç„¶åsearch_pathä¸­çš„ç»“ç‚¹ä¸º&lt;(7,2), (5,4), (2,3)&gt;ï¼Œä»search_pathä¸­å–å‡º$(2,3)$ä½œä¸ºå½“å‰æœ€ä½³ç»“ç‚¹nearest, distä¸º$0.141$ï¼›</p></li><li><p>ç„¶åå›æº¯è‡³$(5,4)$ï¼Œä»¥$(2.1,3.1)$ä¸ºåœ†å¿ƒï¼Œä»¥$dist=0.141$ä¸ºåŠå¾„ç”»ä¸€ä¸ªåœ†ï¼Œå¹¶ä¸å’Œè¶…å¹³é¢$y=4$ç›¸äº¤ï¼Œæ‰€ä»¥ä¸å¿…è·³åˆ°ç»“ç‚¹$(5,4)$çš„å³å­ç©ºé—´å»æœç´¢ï¼Œå› ä¸ºå³å­ç©ºé—´ä¸­ä¸å¯èƒ½æœ‰æ›´è¿‘æ ·æœ¬ç‚¹äº†ã€‚</p></li><li><p>äºæ˜¯åœ¨å›æº¯è‡³$(7,2)$ï¼ŒåŒç†ï¼Œä»¥$(2.1,3.1)$ä¸ºåœ†å¿ƒï¼Œä»¥$dist=0.141$ä¸ºåŠå¾„ç”»ä¸€ä¸ªåœ†å¹¶ä¸å’Œè¶…å¹³é¢$x=7$ç›¸äº¤ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨è·³åˆ°ç»“ç‚¹$(7,2)$çš„å³å­ç©ºé—´å»æœç´¢ã€‚</p></li><li><p>è‡³æ­¤ï¼Œsearch_pathä¸ºç©ºï¼Œç»“æŸæ•´ä¸ªæœç´¢ï¼Œè¿”å›nearest$(2,3)$ä½œä¸º$(2.1,3.1)$çš„æœ€è¿‘é‚»ç‚¹ï¼Œæœ€è¿‘è·ç¦»ä¸º0.141ã€‚</p></li></ul><p><strong>æ³¨æ„ï¼šä¸Šè¿°æ˜¯æœ€è¿‘é‚»çš„è¿‡ç¨‹ï¼Œå¾—å‡ºä¸€ä¸ªæœ€é è¿‘å¾…é¢„æµ‹å®ä¾‹çš„ç‚¹ï¼Œå¦‚æœæ˜¯Kè¿‘é‚»çš„è¯ï¼ŒåŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹æ³•ï¼Œæ¥å¾—åˆ°Kä¸ªæœ€è¿‘é‚»çš„ç‚¹ã€‚</strong>è‡³æ­¤ï¼ŒKNNç®—æ³•çš„ç†è®ºéƒ¨åˆ†å°±è®²å®Œå•¦ğŸ‰</p><h2 id="KNNç®—æ³•çš„å®ç°"><a href="#KNNç®—æ³•çš„å®ç°" class="headerlink" title="KNNç®—æ³•çš„å®ç°"></a>KNNç®—æ³•çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°KNNæ¨¡å‹ï¼špythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#Author:codewithzichao</span></span><br><span class="line"><span class="comment">#E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnistæ•°æ®é›†(åªä½¿ç”¨äº†1000æ¥è®­ç»ƒï¼Œåªä½¿ç”¨äº†1000æ¥æµ‹è¯•ã€‚)</span></span><br><span class="line"><span class="string">ç»“æœ(å‡†ç¡®ç‡)ï¼š0.738</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š28.6643168926239</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span>  numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName: æ•°æ®è·¯å¾„</span></span><br><span class="line"><span class="string">    :return: è¿”å›ç‰¹å¾å‘é‡ä¸æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list=[]</span><br><span class="line">    label_list=[]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName,<span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline=line.strip().split(<span class="string">","</span>)</span><br><span class="line"></span><br><span class="line">            data_list.append([int(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line">            label_list.append(int(curline[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">        data_matrix=np.array(data_list)</span><br><span class="line">        label_matrix=np.array(label_list)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data_matrix,label_matrix</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KNN</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,train_data,train_label,K)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="string">        :param train_data: è®­ç»ƒé›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param train_label: è®­ç»ƒé›†çš„ç±»åˆ«å‘é‡</span></span><br><span class="line"><span class="string">        :param K: æŒ‡å®šçš„Kå€¼</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.train_data=train_data</span><br><span class="line">        self.train_label=train_label</span><br><span class="line">        self.input_num=self.train_data.shape[<span class="number">0</span>]</span><br><span class="line">        self.feature=self.train_data.shape[<span class="number">1</span>]</span><br><span class="line">        self.K=K</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_distance</span><span class="params">(self,x1,x2)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—ä¸¤ä¸ªæ ·æœ¬ä¹‹é—´çš„è·ç¦»ï¼Œä½¿ç”¨æ¬§å¼è·ç¦»</span></span><br><span class="line"><span class="string">        :param x1: ç¬¬ä¸€ä¸ªæ ·æœ¬</span></span><br><span class="line"><span class="string">        :param x2: ç¬¬äºŒæ­¥æ ·æœ¬</span></span><br><span class="line"><span class="string">        :return: æ ·æœ¬ä¹‹é—´çš„è·ç¦»</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> np.sqrt(np.sum(np.square(x1-x2)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_K</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        dist_group=np.zeros(self.input_num)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.input_num):</span><br><span class="line">            x1=self.train_data[i]</span><br><span class="line">            dist=self.cal_distance(x,x1)</span><br><span class="line">            dist_group[i]=dist</span><br><span class="line"></span><br><span class="line">        topK=np.argsort(dist_group)[:self.K]<span class="comment">#å‡åºæ’åº</span></span><br><span class="line"></span><br><span class="line">        labeldist=np.zeros(<span class="number">10</span>)<span class="comment">#10ä¸ªæ ‡ç­¾ï¼Œåœ¨æ¯ä¸€ä¸ªæ ‡ç­¾å¯¹åº”çš„ä½ç½®ä¸ŠåŠ 1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(topK)):</span><br><span class="line">            labeldist[int(self.train_label[topK[i]])]+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> np.argmax(labeldist)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self,test_data,test_label)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•</span></span><br><span class="line"><span class="string">        :param test_data: æµ‹è¯•é›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param test_label: æµ‹è¯•é›†çš„æ ‡ç­¾å‘é‡</span></span><br><span class="line"><span class="string">        :return: å‡†ç¡®ç‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        error=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">        test_num=test_data.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(test_num):</span><br><span class="line">            print(<span class="string">f"the current sample is <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>,the total samples is<span class="subst">&#123;test_num&#125;</span>."</span>)</span><br><span class="line">            x=test_data[i]</span><br><span class="line">            y=self.get_K(x)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(y!=test_label[i]):</span><br><span class="line">                error+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        accuracy=(test_num-error)/test_num</span><br><span class="line">        <span class="keyword">return</span> accuracy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    start=time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start load data."</span>)</span><br><span class="line">    train_data,train_label=loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data,test_label=loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    a=KNN(train_data[:<span class="number">1000</span>],train_label[:<span class="number">1000</span>],<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"finished training."</span>)</span><br><span class="line"></span><br><span class="line">    accuracy=a.test(test_data[:<span class="number">1000</span>],test_label[:<span class="number">1000</span>])</span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    end=time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end-start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure><h3 id="scikit-learnå®ç°"><a href="#scikit-learnå®ç°" class="headerlink" title="scikit-learnå®ç°"></a>scikit-learnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#Author:codewithzichao</span></span><br><span class="line"><span class="comment">#E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnistæ•°æ®é›†(åªä½¿ç”¨äº†1000æ¥è®­ç»ƒï¼Œåªä½¿ç”¨äº†1000æ¥æµ‹è¯•ã€‚)</span></span><br><span class="line"><span class="string">ç»“æœ(å‡†ç¡®ç‡)ï¼š0.799</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š16.832828998565674</span></span><br><span class="line"><span class="string">---------------------------</span></span><br><span class="line"><span class="string">æœç„¶ï¼Œè‡ªå·±å†™çš„pythonæ²¡æœ‰ç¼–å†™kdtreeç­‰éƒ¨åˆ†ï¼Œæ•ˆæœä¸æ—¶é—´ä¸Šéƒ½æ¯”ä¸ä¸Šsklearnã€‚</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName: æ•°æ®è·¯å¾„</span></span><br><span class="line"><span class="string">    :return: è¿”å›ç‰¹å¾å‘é‡ä¸æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list=[]</span><br><span class="line">    label_list=[]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName,<span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline=line.strip().split(<span class="string">","</span>)</span><br><span class="line"></span><br><span class="line">            data_list.append([int(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line">            label_list.append(int(curline[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">        data_matrix=np.array(data_list)</span><br><span class="line">        label_matrix=np.array(label_list)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data_matrix,label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start load data."</span>)</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    knn=KNeighborsClassifier(n_neighbors=<span class="number">10</span>)</span><br><span class="line">    knn.fit(train_data[:<span class="number">1000</span>],train_label[:<span class="number">1000</span>])</span><br><span class="line"></span><br><span class="line">    prediction=knn.predict(test_data[:<span class="number">1000</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        print(<span class="string">f"predict is <span class="subst">&#123;prediction[i]&#125;</span>,the true is <span class="subst">&#123;test_label[i]&#125;</span>."</span>)</span><br><span class="line">    accuracy=knn.score(test_data[:<span class="number">1000</span>],test_label[:<span class="number">1000</span>])</span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    end=time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end-start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> KNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|æ¡ä»¶éšæœºåœºæ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>æ¡ä»¶éšæœºåœº(CRF)ï¼Œå±äºåˆ¤åˆ«æ¨¡å‹ï¼Œå®ƒåœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸç”¨é€”éå¸¸å¹¿æ³›ã€‚ç”±äºå…¶æ¶‰åŠè¾ƒå¤šçš„æ¦‚ç‡å›¾æ¨¡å‹çš„çŸ¥è¯†ï¼Œæ‰€ä»¥ï¼Œè¿™ç¯‡åšå®¢å°†é¦–å…ˆä»‹ç»ä¸€ä¸‹å…³äºCRFæ¨¡å‹çš„æå‡ºçš„åŸå› ï¼Œæ¥ç€å†ä»‹ç»CRFæ¨¡å‹éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œå¹¶é’ˆå¯¹æ¯ä¸ªé—®é¢˜ä»‹ç»å…¶è§£å†³çš„ç®—æ³•ï¼Œæœ€åå°†ä½¿ç”¨pythonä¸sklearnåº“æ¥å¯¹å…¶è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="æ¡ä»¶éšæœºåœºæ¨¡å‹æå‡ºçš„åŸå› "><a href="#æ¡ä»¶éšæœºåœºæ¨¡å‹æå‡ºçš„åŸå› " class="headerlink" title="æ¡ä»¶éšæœºåœºæ¨¡å‹æå‡ºçš„åŸå› "></a>æ¡ä»¶éšæœºåœºæ¨¡å‹æå‡ºçš„åŸå› </h2><p>å¦‚æœç”¨ä¸€å¥è¯æ¥æ€»ç»“CRFè¢«æå‡ºçš„åŸå› å°±æ˜¯ï¼š<strong>CRFè§£å†³äº†MEMMæ¨¡å‹çš„æ ‡æ³¨åå·®é—®é¢˜ï¼Œæ‰“ç ´äº†é½æ¬¡markovå‡è®¾ï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ åˆç†ã€‚</strong>ï¼ˆå¦‚æœä¸æƒ³çœ‹åˆ†æè¿‡ç¨‹çš„è¯ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ï¼Œçœ‹ç¬¬äºŒéƒ¨åˆ†CRFæ¨¡å‹çš„ä»‹ç»ã€‚ï¼‰å…·ä½“åˆ†æè¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p><h3 id="åˆ†ç±»æ¨¡å‹"><a href="#åˆ†ç±»æ¨¡å‹" class="headerlink" title="åˆ†ç±»æ¨¡å‹"></a>åˆ†ç±»æ¨¡å‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´çœ‹ä¸€ä¸‹åˆ†ç±»æ¨¡å‹ã€‚æ•´ä¸ªåˆ†ç±»æ¨¡å‹å¯ä»¥è¢«åˆ†ä¸ºï¼š<strong>ç¡¬åˆ†ç±»ä¸è½¯åˆ†ç±»</strong>ã€‚ç¡¬åˆ†ç±»çš„ä»£è¡¨æ¨¡å‹æœ‰ï¼š<strong>æ„ŸçŸ¥æœº(PLA)ã€æ”¯æŒå‘é‡æœº(SVM)ã€çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA)</strong>ï¼›è½¯åˆ†ç±»æ¨¡å‹åˆå¯åˆ†ä¸ºä¸¤ç±»ï¼šåˆ¤åˆ«æ¨¡å‹ä¸ç”Ÿæˆæ¨¡å‹ã€‚åˆ¤åˆ«æ¨¡å‹çš„ä»£è¡¨ï¼š<strong>é€»è¾‘å›å½’(LR)æ¨¡å‹ä»¥åŠæœ€å¤§ç†µ(MaxEnt)æ¨¡å‹</strong>ï¼›ç”Ÿæˆæ¨¡å‹çš„ä»£è¡¨ï¼š<strong>æœ´ç´ è´å¶æ–¯(Naive Bayes)æ¨¡å‹ã€éšé©¬å°”å¯å¤«(HMM)æ¨¡å‹</strong>ã€‚ä¹‹åï¼Œæˆ‘ä»¬æ ¹æ®MaxEntæ¨¡å‹ä¸HMMæ¨¡å‹ï¼Œå¯ä»¥å¾—å‡ºä¸€ä¸ª<strong>åˆ¤åˆ«æ¨¡å‹â€”â€”æœ€å¤§ç†µé©¬å°”å¯å¤«æ¨¡å‹(MEMM)</strong>ï¼Œæœ€ååœ¨MEMMæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå¾—å‡ºäº†<strong>æ¡ä»¶éšæœºåœº(CRF)æ¨¡å‹</strong>ã€‚</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" alt></p><p>æ‰€ä»¥ï¼ŒCRFæ¨¡å‹æ˜¯ä»HMMåˆ°MEMMæ¨¡å‹ï¼Œä¸€æ­¥æ­¥æ¨å‡ºæ¥çš„ã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹æ˜¯æ€ä¹ˆå¾—æ¥çš„ã€‚</p><h3 id="HMM-vs-MEMM"><a href="#HMM-vs-MEMM" class="headerlink" title="HMM vs MEMM"></a>HMM vs MEMM</h3><p>HMMæ¨¡å‹ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œå®ƒå¯è¢«ç”¨æ¥è§£å†³è¯æ€§æ ‡æ³¨ç­‰é—®é¢˜ã€‚HMMæ¨¡å‹æœ‰ä¸¤ä¸ªå¾ˆè‘—åçš„å‡è®¾ï¼š<strong>é½æ¬¡ä¸€é˜¶Markovå‡è®¾ä¸è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªå‡è®¾éƒ½æ˜¯åˆç†çš„å—ï¼Ÿå…¶å®ä¸æ˜¯çš„ï¼Œå¦‚æœå¯¹æ¦‚ç‡å›¾æ¨¡å‹çš„åŸºæœ¬çŸ¥è¯†æœ‰äº›äº†è§£çš„è¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¸¤ä¸ªå‡è®¾å…¶å®éƒ½æ˜¯ä¸ºäº†ç®€åŒ–è¿ç®—ã€‚è­¬å¦‚è¯´ï¼Œæˆ‘ä»¬æ¥çœ‹<strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>ã€‚å®ƒè¢«æè¿°ä¸ºè§‚æµ‹å˜é‡ $o_t$ åªä¸ $i_t$ æœ‰å…³ç³»ï¼Œå…¶å®è¿™æ˜¯ä¸åˆç†çš„ã€‚ä»¥è¯æ€§æ ‡æ³¨é—®é¢˜ä¸ºä¾‹ï¼Œå•è¯ä¸å•è¯ä¹‹é—´å…¶å®éƒ½æ˜¯æœ‰å…³ç³»çš„ã€‚é‚£ä¹ˆï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMEMMæ¨¡å‹ä¾¿è¢«æå‡ºæ¥äº†ï¼Œå…·ä½“åšæ³•æ˜¯ï¼š<strong>å°†åŸæ¥çš„è§‚æµ‹å˜é‡å˜ä¸ºè¾“å…¥(ä»å›¾çš„è§’åº¦æ¥è¯´ï¼Œå°±æ˜¯å‰ªç®­å¤´åå‘ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™æ ·åšå°±æ‰“ç ´äº†è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾å‘¢ï¼Ÿå…¶å®å’Œæœ‰å‘å›¾çš„D-seperationæœ‰å…³ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»äº†è§£äº†è§£è¿™ä¸ª)</strong>ã€‚MEMMçš„ä¼˜ç‚¹æœ‰ï¼š<strong>1.æ‰“ç ´äº†è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾ï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ åˆç†ï¼›2.MEMMæ¨¡å‹æ˜¯åˆ¤åˆ«æ¨¡å‹ï¼Œç›¸æ¯”HMMæ¨¡å‹æ¥è¯´ï¼Œè®¡ç®—æ›´ä¸ºç®€å•</strong>ã€‚ä½†æ˜¯MEMMæ¨¡å‹ä¹Ÿå­˜åœ¨ä¸€ä¸ªéå¸¸ä¸¥é‡çš„ç¼ºé™·ï¼š<strong>æ ‡æ³¨åå·®é—®é¢˜(label bias problem)</strong>ã€‚è¿™ä¸ªé—®é¢˜ä¼šå¯¼è‡´è¯æ€§æ ‡æ³¨å‡†ç¡®ç‡å¤§ä¸ºé™ä½ã€‚è¿™ä¹Ÿæ˜¯MEMMæ¨¡å‹æ²¡æœ‰æµè¡Œçš„åŸå› ã€‚</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" alt></p><h3 id="MEMM-vs-CRF"><a href="#MEMM-vs-CRF" class="headerlink" title="MEMM vs CRF"></a>MEMM vs CRF</h3><p>MEMMæ¨¡å‹å­˜åœ¨æ ‡æ³¨åå·®é—®é¢˜ï¼Œé‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯æ ‡æ³¨åå·®é—®é¢˜å‘¢ï¼Ÿ(å¦‚æœæƒ³æ·±å…¥äº†è§£çš„è¯ï¼Œå¯ä»¥å»çœ‹John Laffertyçš„é‚£ç¯‡è®ºæ–‡)ã€‚ å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.png" alt></p><p>å›¾ä¸­ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸€ä¸ªæ—¶åˆ»ï¼Œä¹Ÿå°±ä»£è¡¨ä¸€ä¸ªçŠ¶æ€ã€‚å½“æˆ‘ä»¬ä½¿ç”¨Viterbiç®—æ³•å»æ±‚å…·æœ‰æœ€å¤§æ¦‚ç‡çš„è·¯å¾„çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°1-&gt;2-&gt;2-&gt;2ï¼Œæ¦‚ç‡æ˜¯0.6*0.3*0.3=0.054ï¼Œç„¶è€Œå®é™…ä¸Šæœ€å¤§æ¦‚ç‡çš„è·¯å¾„æ˜¯:1-&gt;1-&gt;1-&gt;1ï¼Œå…¶æ¦‚ç‡æ˜¯ï¼š0.4*0.45*0.5=0.09ã€‚é‚£ä¹ˆï¼Œå¦‚æœåœ¨è¯æ€§æ ‡æ³¨é—®é¢˜ä¸­ï¼Œå°±ä¼šå¯¼è‡´æ ‡æ³¨å‘ç”Ÿé”™è¯¯ã€‚è¿™å°±æ˜¯æ ‡æ³¨åå·®é—®é¢˜ã€‚é‚£ä¹ˆå¯¼è‡´è¿™ä¸€é—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºï¼š<strong>å±€éƒ¨å½’ä¸€åŒ–</strong>ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸€æ¬¡ä»tæ—¶åˆ»è½¬ç§»åˆ°t+1æ—¶åˆ»çš„æ—¶å€™ï¼Œéƒ½ä¼šå¯¹è½¬ç§»æ¦‚ç‡åšå½’ä¸€åŒ–ã€‚ä»è€Œï¼Œå°±ä¼š<strong>å¯¼è‡´æ¨¡å‹åå‘äºçŠ¶æ€è½¬ç§»å°‘çš„æ ‡ç­¾ï¼Œä»è€Œä½¿å¾—åéªŒæ¦‚ç‡æœ€å¤§</strong>ï¼Œå¯¼è‡´æ¨¡å‹è¶Šä¸ä¼šå»ç†ç¬è§‚æµ‹å˜é‡çš„å€¼ï¼Œå°±ä¼šè¿›è¡Œè¯æ€§æ ‡æ³¨ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå°±æå‡ºäº†CRFæ¨¡å‹ã€‚CRFæ¨¡å‹çš„å…·ä½“åšæ³•æ˜¯ï¼š<strong>å°†æ¨¡å‹å˜æˆæ— å‘å›¾ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±ä¸éœ€è¦åœ¨æ¯ä¸€æ­¥éƒ½è¿›è¡Œå½’ä¸€åŒ–ï¼Œåªéœ€è¦è¿›è¡Œå…¨å±€å½’ä¸€åŒ–å³å¯</strong>ã€‚è¿™æ ·ï¼Œå°±è§£å†³äº†æ ‡æ³¨åå·®é—®é¢˜ã€‚ä¸‹é¢å°±è®²å…·ä½“ä»‹ç»CRFæ¨¡å‹ã€‚</p><h2 id="æ¡ä»¶éšæœºåœºæ¨¡å‹ä»‹ç»"><a href="#æ¡ä»¶éšæœºåœºæ¨¡å‹ä»‹ç»" class="headerlink" title="æ¡ä»¶éšæœºåœºæ¨¡å‹ä»‹ç»"></a>æ¡ä»¶éšæœºåœºæ¨¡å‹ä»‹ç»</h2><p>åœ¨ä»‹ç»CRFä¹‹å‰ï¼Œé¦–å…ˆå¾—å…ˆå»äº†è§£æœ‰å‘å›¾æ¨¡å‹(è´å¶æ–¯ç½‘ç»œ)çš„å› å­åˆ†è§£ä¸D-seperationï¼Œä»¥åŠæ— å‘å›¾(markovéšæœºåœº)çš„D-separation(ä¸¥æ ¼æ¥è®²ï¼Œæ— å‘å›¾æ²¡æœ‰D-seperationï¼Œä½†æ˜¯å®ƒçš„ç»“æ„å’Œæœ‰å‘å›¾çš„D-separationå·®ä¸å¤šï¼Œå…¶å®å°±æ˜¯å…¨å±€markovæ€§)ä¸å› å­åˆ†è§£ã€‚å®é™…ä¸Šï¼Œæ‰€è°“çš„å› å­åˆ†è§£å…¶å®éƒ½æ˜¯ä¸ºäº†ä½“ç°æ¦‚ç‡å›¾æ¨¡å‹çš„æ¡ä»¶ç‹¬ç«‹æ€§ã€‚åœ¨æ— å‘å›¾ä¸­ï¼Œæ¡ä»¶ç‹¬ç«‹æ€§è¡¨ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼šå…¨å±€markovæ€§ã€å±€éƒ¨markovæ€§ã€æˆå¯¹markovæ€§ã€‚é‚£ä¹ˆå› å­åˆ†è§£ä¸ºäº†è¡¨ç°å…¶æ¡ä»¶ç‹¬ç«‹æ€§ï¼Œä½¿ç”¨äº†åŸºäºå›¢çš„æ–¹æ³•ï¼Œå¹¶æœ‰hammesley-Cliffordå®šç†å¾—ä»¥ä¿è¯ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°±ä¸è¯¦ç»†è®²äº†ï¼Œå¦‚æœè®²çš„è¯ï¼Œé‚£å°±å¤ªå¤šå¤ªå¤šå•¦ï½æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»è¡¥è¡¥æ¦‚ç‡å›¾çš„çŸ¥è¯†ï¼Œå°±æŒ‰ç…§æˆ‘ä¸Šé¢è®²çš„è¿™äº›å³å¯ï½</p><p>OKï¼Œç›´æ¥è¿›å…¥ä¸»é¢˜ã€‚</p><p>CRFæ¨¡å‹æ˜¯ç»™å®šéšæœºå˜é‡$X$çš„æ¡ä»¶ä¸‹ï¼Œéšæœºå˜é‡$Y$çš„markovéšæœºåœºã€‚å…¶æ¦‚ç‡å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" alt></p><p>ç”±äºCRFæ¨¡å‹æ˜¯åˆ¤åˆ«å¼æ¨¡å‹ï¼Œæ‰€ä»¥å»ºæ¨¡å¯¹è±¡å°±æ˜¯ï¼š$P(Y|X)$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦æ±‚çš„æ˜¯$P(Y|X)$ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ¨å¯¼ä¸€ä¸‹çº¿æ€§é“¾CRFçš„å‚æ•°å½¢å¼ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/4.jpg" alt></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨å¾—åˆ°äº†CRFçš„å‚æ•°å½¢å¼ï¼Œå½“éšæœºå˜é‡$X$å–$x$ï¼Œéšæœºå˜é‡$Y$å–$y$çš„æ—¶å€™ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(y|x)=\frac {1}{z}exp\sum_{t=1}^{T}[\sum_{k=1}^{K}\lambda_kf_k(y_{t-1},y_t,x_{1:T})+\sum_{l=1}^{L}\eta_lg_l(y_t,x_{1:T})]</script><p>å…¶ä¸­ï¼Œ$\lambdaã€\eta$ éƒ½æ˜¯éœ€è¦è®­ç»ƒçš„å‚æ•°ï¼Œ$fã€g$ æ˜¯ç‰¹å¾å‡½æ•°ï¼Œå½“æ»¡è¶³æŸä¸€æ¡ä»¶çš„æ—¶å€™ï¼Œä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚åœ¨è¿™é‡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘æ‰€ä½¿ç”¨çš„ç¬¦å·ä¸æèˆªè€å¸ˆçš„ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯è¡¨è¾¾éƒ½æ˜¯ä¸€æ ·çš„ï¼Œã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸­å°†æœ€å¤–é¢çš„é‚£ä¸ª$\sum$æ”¾è¿›å»äº†ï¼Œæ‰€ä»¥ç‰¹å¾å‡½æ•°çš„å‚æ•°å°±ä¼šå¤šä¸€ä¸ªã€‚å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ<strong>æˆ‘è§‰å¾—æœ€é‡è¦çš„æ˜¯è‡ªå·±èƒ½å¤Ÿç†è§£ï¼Œå¹¶ä¸”æ–¹ä¾¿è‡ªå·±è®°å¿†å’Œæ¨å¯¼å°±å¯ä»¥äº†</strong>ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/6.jpg" style="zoom:50%;"></p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ä½¿ç”¨å°†å…¶åŒ–ç®€ä¸ºå‘é‡åŒ–çš„å½¢å¼ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/5.jpg" alt></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†CRFçš„å‘é‡åŒ–å½¢å¼ï¼š</p><script type="math/tex; mode=display">P(y|x)=\frac {1}{z(x,\theta)}exp[\theta^T(H(y_{t-1},y_t,x)]</script><p> é‚£ä¹ˆï¼Œå¾—åˆ°è¿™ä¸ªä¹‹åï¼Œæˆ‘ä»¬å°±æ¥è§£å†³CRFæ¨¡å‹ä¸­çš„é—®é¢˜ã€‚CRFæ€»å…±éœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li>æ±‚è¾¹ç¼˜æ¦‚ç‡ã€‚å³ï¼šæ±‚$P(y_t|x)$ã€‚</li><li>å­¦ä¹ é—®é¢˜ã€‚å³ï¼šç»™å®šè®­ç»ƒé›†$\{x^{(i)},y^{(i)}\}_1^N$ï¼Œæ±‚ï¼š$\theta=\mathop{argmax}\limits_{\theta}\prod_{i=1}^{N}P(y^{(i)}|x^{(i)})$ã€‚Nä¸ªæ ·æœ¬ï¼Œå…¶ä¸­xéƒ½æ˜¯Tç»´çš„ã€‚</li><li>Decodingé—®é¢˜ã€‚å³ï¼šæ±‚ï¼š$y=\mathop{argmax}\limits_{y}P(y|x)$ã€‚</li></ul><h2 id="è¾¹ç¼˜æ¦‚ç‡é—®é¢˜çš„æ±‚è§£"><a href="#è¾¹ç¼˜æ¦‚ç‡é—®é¢˜çš„æ±‚è§£" class="headerlink" title="è¾¹ç¼˜æ¦‚ç‡é—®é¢˜çš„æ±‚è§£"></a>è¾¹ç¼˜æ¦‚ç‡é—®é¢˜çš„æ±‚è§£</h2><p>åœ¨è¿™é‡Œï¼Œå…¶å®è®¡ç®—è¿‡ç¨‹ä¸HMMä¸­çš„æ¦‚ç‡è®¡ç®—å…¶å®æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·å¼•è¿›<strong>å‰å‘åå‘ç®—æ³•</strong>ï¼Œæ¥å‡å°è®¡ç®—å¤æ‚åº¦ã€‚å…·ä½“æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼ˆæ¨å¯¼è¿‡ç¨‹é‡‡ç”¨äº†<strong>å˜é‡æ¶ˆé™¤æ³•</strong>ï¼‰ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/7.jpg" alt></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸæ¥çš„è®¡ç®—å¤æ‚åº¦ä¸ºï¼š$O(T|S|^T)$ã€‚å½“$T$å¾ˆå¤§çš„æ—¶å€™ï¼Œå¤æ‚åº¦æ˜¯ä»¥æŒ‡æ•°å½¢å¼å¢é•¿çš„ï¼Œè¿™æ˜¯ä¸å¯è§£çš„ã€‚å½“æˆ‘ä»¬å·²ç»å¼•è¿›å‰å‘å‘é‡ä¸åå‘å‘é‡ï¼Œé‚£ä¹ˆå°±å¯è§£äº†ã€‚</p><h2 id="æ¨¡å‹å‚æ•°çš„æ±‚è§£"><a href="#æ¨¡å‹å‚æ•°çš„æ±‚è§£" class="headerlink" title="æ¨¡å‹å‚æ•°çš„æ±‚è§£"></a>æ¨¡å‹å‚æ•°çš„æ±‚è§£</h2><p>å…³äºCRFæ¨¡å‹å‚æ•°çš„æ±‚è§£æ–¹æ³•ï¼Œå…¶å®æœ‰å¾ˆå¤šã€‚æ¯”å¦‚æœ‰ï¼šæ”¹è¿›çš„è¿­ä»£å°ºåº¦æ³•ã€æ‹Ÿç‰›é¡¿æ³•ã€ç‰›é¡¿æ³•ç­‰ç­‰ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯æ¢¯åº¦ä¸Šå‡æ³•ï¼Œå› ä¸ºæ˜¯æ±‚æœ€å¤§ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ±‚æœ€å°é—®é¢˜ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ¥è§£å†³ã€‚å…¶å®è¿‡ç¨‹å·®ä¸å¤šçš„ã€‚å…·ä½“æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹(åŸè°…æˆ‘æ‰‹æœºçš„æ¸£æ¸£åƒç´ ï¼Œä»¥åæœ‰æ—¶é—´å†ç”¨markdownæŠŠå…¬å¼æ‰“å‡ºæ¥å§ğŸ˜©)ï¼š</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/9.jpg" alt></p><h2 id="Decodingé—®é¢˜çš„æ±‚è§£"><a href="#Decodingé—®é¢˜çš„æ±‚è§£" class="headerlink" title="Decodingé—®é¢˜çš„æ±‚è§£"></a>Decodingé—®é¢˜çš„æ±‚è§£</h2><p>æ¯æ¬¡å†™åšå®¢ï¼Œéƒ½æ„Ÿè§‰å¥½ç´¯ğŸ¥±ã€‚CRFçš„decodingé—®é¢˜ï¼Œä»ç„¶æ˜¯ä½¿ç”¨Viterbiç®—æ³•è¿›è¡Œæ±‚è§£ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å°±ä¸æ¨å¯¼äº†ï¼Œç›´æ¥æ”¾ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹çš„æˆªå›¾å§ï¼Œå¦‚æœä½ ä¹‹å‰çœ‹è¿‡æˆ‘å…³äºHMMæ¨¡å‹çš„è®²è§£é‚£ä¸€ç¯‡çš„è¯ï¼Œé‚£ä¹ˆCRFçš„Viterbiç®—æ³•ä¹Ÿç»å¯¹èƒ½çœ‹å¾—æ‡‚ï½</p><p><img src="/2020/02/24/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/8.jpg" alt></p><p>è‡³æ­¤ï¼Œå…³äºCRFçš„ç†è®ºéƒ¨åˆ†å°±è®²å®Œäº†ï½</p><h2 id="CRFæ¨¡å‹çš„å®ç°"><a href="#CRFæ¨¡å‹çš„å®ç°" class="headerlink" title="CRFæ¨¡å‹çš„å®ç°"></a>CRFæ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°CRFæ¨¡å‹ï¼špythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹åœ¨åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#Author:codewithzichao</span></span><br><span class="line"><span class="comment">#E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ç”±äºCRFæ¨¡å‹ï¼Œä¸€èˆ¬éƒ½æ˜¯æ¥è§£å†³å…¶Decodingé—®é¢˜ï¼Œæ‰€ä»¥åœ¨æ­¤ï¼Œæˆ‘åªå®ç°Viterbiç®—æ³•ï½</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRF</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''å®ç°æ¡ä»¶éšæœºåœºé¢„æµ‹é—®é¢˜çš„ç»´ç‰¹æ¯”ç®—æ³•</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, V, VW, E, EW)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        :param V:æ˜¯å®šä¹‰åœ¨èŠ‚ç‚¹ä¸Šçš„ç‰¹å¾å‡½æ•°ï¼Œç§°ä¸ºçŠ¶æ€ç‰¹å¾</span></span><br><span class="line"><span class="string">        :param VW:æ˜¯Vå¯¹åº”çš„æƒå€¼</span></span><br><span class="line"><span class="string">        :param E:æ˜¯å®šä¹‰åœ¨è¾¹ä¸Šçš„ç‰¹å¾å‡½æ•°ï¼Œç§°ä¸ºè½¬ç§»ç‰¹å¾</span></span><br><span class="line"><span class="string">        :param EW:æ˜¯Eå¯¹åº”çš„æƒå€¼</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.V = V  <span class="comment"># ç‚¹åˆ†å¸ƒè¡¨</span></span><br><span class="line">        self.VW = VW  <span class="comment"># ç‚¹æƒå€¼è¡¨</span></span><br><span class="line">        self.E = E  <span class="comment"># è¾¹åˆ†å¸ƒè¡¨</span></span><br><span class="line">        self.EW = EW  <span class="comment"># è¾¹æƒå€¼è¡¨</span></span><br><span class="line">        self.D = []  <span class="comment"># Deltaè¡¨ï¼Œæœ€å¤§éè§„èŒƒåŒ–æ¦‚ç‡çš„å±€éƒ¨çŠ¶æ€è·¯å¾„æ¦‚ç‡</span></span><br><span class="line">        self.P = []  <span class="comment"># Psiè¡¨ï¼Œå½“å‰çŠ¶æ€å’Œæœ€ä¼˜å‰å¯¼çŠ¶æ€çš„ç´¢å¼•è¡¨s</span></span><br><span class="line">        self.BP = []  <span class="comment"># BestPathï¼Œæœ€ä¼˜è·¯å¾„</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Viterbi</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ¡ä»¶éšæœºåœºé¢„æµ‹é—®é¢˜çš„ç»´ç‰¹æ¯”ç®—æ³•ï¼Œæ­¤ç®—æ³•ä¸€å®šè¦ç»“åˆCRFå‚æ•°åŒ–å½¢å¼å¯¹åº”çš„çŠ¶æ€è·¯å¾„å›¾æ¥ç†è§£ï¼Œæ›´å®¹æ˜“ç†è§£.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.D = np.full(shape=(np.shape(self.V)), fill_value=<span class="number">.0</span>)</span><br><span class="line">        self.P = np.full(shape=(np.shape(self.V)), fill_value=<span class="number">.0</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(np.shape(self.V)[<span class="number">0</span>]):</span><br><span class="line">            <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> == i:</span><br><span class="line">                self.D[i] = np.multiply(self.V[i], self.VW[i])</span><br><span class="line">                self.P[i] = np.array([<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">                print(<span class="string">'self.V[%d]='</span> % i, self.V[i], <span class="string">'self.VW[%d]='</span> % i, self.VW[i], <span class="string">'self.D[%d]='</span> % i, self.D[i])</span><br><span class="line">                print(<span class="string">'self.P:'</span>, self.P)</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="comment"># é€’æ¨æ±‚è§£å¸ƒå±€æœ€ä¼˜çŠ¶æ€è·¯å¾„</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> y <span class="keyword">in</span> range(np.shape(self.V)[<span class="number">1</span>]):  <span class="comment"># delta[i][y=1,2...]</span></span><br><span class="line">                    <span class="keyword">for</span> l <span class="keyword">in</span> range(np.shape(self.V)[<span class="number">1</span>]):  <span class="comment"># V[i-1][l=1,2...]</span></span><br><span class="line">                        delta = <span class="number">0.0</span></span><br><span class="line">                        delta += self.D[i - <span class="number">1</span>, l]  <span class="comment"># å‰å¯¼çŠ¶æ€çš„æœ€ä¼˜çŠ¶æ€è·¯å¾„çš„æ¦‚ç‡</span></span><br><span class="line">                        delta += self.E[i - <span class="number">1</span>][l, y] * self.EW[i - <span class="number">1</span>][l, y]  <span class="comment"># å‰å¯¼çŠ¶æ€åˆ°å½“å‰çŠ¶ä½“çš„è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">                        delta += self.V[i, y] * self.VW[i, y]  <span class="comment"># å½“å‰çŠ¶æ€çš„æ¦‚ç‡</span></span><br><span class="line">                        print(<span class="string">'(x%d,y=%d)--&gt;(x%d,y=%d):%.2f + %.2f + %.2f='</span> % (i - <span class="number">1</span>, l, i, y, \</span><br><span class="line">                                                                               self.D[i - <span class="number">1</span>, l], \</span><br><span class="line">                                                                               self.E[i - <span class="number">1</span>][l, y] * self.EW[i - <span class="number">1</span>][</span><br><span class="line">                                                                                   l, y], \</span><br><span class="line">                                                                               self.V[i, y] * self.VW[i, y]), delta)</span><br><span class="line">                        <span class="keyword">if</span> <span class="number">0</span> == l <span class="keyword">or</span> delta &gt; self.D[i, y]:</span><br><span class="line">                            self.D[i, y] = delta</span><br><span class="line">                            self.P[i, y] = l</span><br><span class="line">                    print(<span class="string">'self.D[x%d,y=%d]=%.2f\n'</span> % (i, y, self.D[i, y]))</span><br><span class="line">        print(<span class="string">'self.Delta:\n'</span>, self.D)</span><br><span class="line">        print(<span class="string">'self.Psi:\n'</span>, self.P)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿”å›ï¼Œå¾—åˆ°æ‰€æœ‰çš„æœ€ä¼˜å‰å¯¼çŠ¶æ€</span></span><br><span class="line">        N = np.shape(self.V)[<span class="number">0</span>]</span><br><span class="line">        self.BP = np.full(shape=(N,), fill_value=<span class="number">0.0</span>)</span><br><span class="line">        t_range = <span class="number">-1</span> * np.array(sorted(<span class="number">-1</span> * np.arange(N)))</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> t_range:</span><br><span class="line">            <span class="keyword">if</span> N - <span class="number">1</span> == t:  <span class="comment"># å¾—åˆ°æœ€ä¼˜çŠ¶æ€</span></span><br><span class="line">                self.BP[t] = np.argmax(self.D[<span class="number">-1</span>])</span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># å¾—åˆ°æœ€ä¼˜å‰å¯¼çŠ¶æ€</span></span><br><span class="line">                self.BP[t] = self.P[t + <span class="number">1</span>, int(self.BP[t + <span class="number">1</span>])]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ€ä¼˜çŠ¶æ€è·¯å¾„è¡¨ç°åœ¨å­˜å‚¨çš„æ˜¯çŠ¶æ€çš„ä¸‹æ ‡ï¼Œæˆ‘ä»¬æ‰§è¡Œå­˜å‚¨å€¼+1è½¬æ¢æˆç¤ºä¾‹ä¸­çš„çŠ¶æ€å€¼</span></span><br><span class="line">        <span class="comment"># ä¹Ÿå¯ä»¥ä¸ç”¨è½¬æ¢ï¼Œåªè¦ä½ èƒ½ç†è§£ï¼Œself.BPä¸­å­˜å‚¨çš„0æ˜¯çŠ¶æ€1å°±å¯ä»¥~~~~</span></span><br><span class="line">        self.BP += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">'æœ€ä¼˜çŠ¶æ€è·¯å¾„ä¸ºï¼š'</span>, self.BP)</span><br><span class="line">        <span class="keyword">return</span> self.BP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    S = np.array([[<span class="number">1</span>, <span class="number">1</span>],  <span class="comment"># X1:S(Y1=1), S(Y1=2)</span></span><br><span class="line">                  [<span class="number">1</span>, <span class="number">1</span>],  <span class="comment"># X2:S(Y2=1), S(Y2=2)</span></span><br><span class="line">                  [<span class="number">1</span>, <span class="number">1</span>]])  <span class="comment"># X3:S(Y3=1), S(Y3=1)</span></span><br><span class="line">    SW = np.array([[<span class="number">1.0</span>, <span class="number">0.5</span>],  <span class="comment"># X1:SW(Y1=1), SW(Y1=2)</span></span><br><span class="line">                   [<span class="number">0.8</span>, <span class="number">0.5</span>],  <span class="comment"># X2:SW(Y2=1), SW(Y2=2)</span></span><br><span class="line">                   [<span class="number">0.8</span>, <span class="number">0.5</span>]])  <span class="comment"># X3:SW(Y3=1), SW(Y3=1)</span></span><br><span class="line">    E = np.array([[[<span class="number">1</span>, <span class="number">1</span>],  <span class="comment"># Edge:Y1=1---&gt;(Y2=1, Y2=2)</span></span><br><span class="line">                   [<span class="number">1</span>, <span class="number">0</span>]],  <span class="comment"># Edge:Y1=2---&gt;(Y2=1, Y2=2)</span></span><br><span class="line">                  [[<span class="number">0</span>, <span class="number">1</span>],  <span class="comment"># Edge:Y2=1---&gt;(Y3=1, Y3=2)</span></span><br><span class="line">                   [<span class="number">1</span>, <span class="number">1</span>]]])  <span class="comment"># Edge:Y2=2---&gt;(Y3=1, Y3=2)</span></span><br><span class="line">    EW = np.array([[[<span class="number">0.6</span>, <span class="number">1</span>],  <span class="comment"># EdgeW:Y1=1---&gt;(Y2=1, Y2=2)</span></span><br><span class="line">                    [<span class="number">1</span>, <span class="number">0.0</span>]],  <span class="comment"># EdgeW:Y1=2---&gt;(Y2=1, Y2=2)</span></span><br><span class="line">                   [[<span class="number">0.0</span>, <span class="number">1</span>],  <span class="comment"># EdgeW:Y2=1---&gt;(Y3=1, Y3=2)</span></span><br><span class="line">                    [<span class="number">1</span>, <span class="number">0.2</span>]]])  <span class="comment"># EdgeW:Y2=2---&gt;(Y3=1, Y3=2)</span></span><br><span class="line"></span><br><span class="line">    crf = CRF(S, SW, E, EW)</span><br><span class="line">    ret = crf.Viterbi()</span><br><span class="line">    print(<span class="string">'æœ€ä¼˜çŠ¶æ€è·¯å¾„ä¸º:'</span>, ret)</span><br></pre></td></tr></table></figure><h3 id="sklearnå®ç°"><a href="#sklearnå®ç°" class="headerlink" title="sklearnå®ç°"></a>sklearnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#Author:codewithzichao</span></span><br><span class="line"><span class="comment">#E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">è®­ç»ƒæ•°æ®é›†ï¼š1998äººæ°‘æ—¥æŠ¥æ ‡æ³¨è¯­æ–™åº“</span></span><br><span class="line"><span class="string">ç›®æ ‡ï¼šå¯¹å…¶è¿›è¡Œå‘½åå®ä½“è¯†åˆ«</span></span><br><span class="line"><span class="string">ç»“æœï¼š</span></span><br><span class="line"><span class="string">æ•°æ®ï¼šæ–°åç¤¾åŒ—äº¬åäºŒæœˆä¸‰åä¸€æ—¥ç”µ(ä¸­å¤®äººæ°‘å¹¿æ’­ç”µå°è®°è€…åˆ˜æŒ¯è‹±ã€æ–°åç¤¾è®°è€…å¼ å®¿å ‚)ä»Šå¤©æ˜¯ä¸€ä¹ä¹ä¸ƒå¹´çš„æœ€åä¸€å¤©ã€‚</span></span><br><span class="line"><span class="string">ç»“æœï¼šæ–°åç¤¾ åŒ—äº¬ åäºŒæœˆä¸‰åä¸€æ—¥  ä¸­å¤®äººæ°‘å¹¿æ’­ç”µå°  åˆ˜æŒ¯è‹±  æ–°åç¤¾  å¼ å®¿å ‚  ä»Šå¤©  ä¸€ä¹ä¹ä¸ƒå¹´</span></span><br><span class="line"><span class="string">----------------------------------------------------------</span></span><br><span class="line"><span class="string">æ•°æ®ï¼šä¸­å›½ï¼Œæˆ‘çˆ±ä½ ã€‚</span></span><br><span class="line"><span class="string">ç»“æœï¼šä¸­å›½</span></span><br><span class="line"><span class="string">æ¥æºï¼šhttps://www.jianshu.com/p/7fa260e91382</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sklearn_crfsuite</span><br><span class="line"><span class="keyword">from</span> sklearn_crfsuite <span class="keyword">import</span> metrics</span><br><span class="line"><span class="keyword">import</span> joblib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CorpusProcess</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ–"""</span></span><br><span class="line">        self.train_corpus_path =<span class="string">"1980_01.txt"</span></span><br><span class="line">        self.process_corpus_path =<span class="string">"result-rmrb.txt"</span></span><br><span class="line">        self._maps = &#123;<span class="string">u't'</span>: <span class="string">u'T'</span>, <span class="string">u'nr'</span>: <span class="string">u'PER'</span>, <span class="string">u'ns'</span>: <span class="string">u'ORG'</span>, <span class="string">u'nt'</span>: <span class="string">u'LOC'</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_corpus_from_file</span><span class="params">(self, file_path)</span>:</span></span><br><span class="line">        <span class="string">"""è¯»å–è¯­æ–™"""</span></span><br><span class="line">        f = open(file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> lines</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_corpus_to_file</span><span class="params">(self, data, file_path)</span>:</span></span><br><span class="line">        <span class="string">"""å†™è¯­æ–™"""</span></span><br><span class="line">        f = open(file_path, <span class="string">'wb'</span>)</span><br><span class="line">        f.write(data)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">q_to_b</span><span class="params">(self, q_str)</span>:</span></span><br><span class="line">        <span class="string">"""å…¨è§’è½¬åŠè§’"""</span></span><br><span class="line">        b_str = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> uchar <span class="keyword">in</span> q_str:</span><br><span class="line">            inside_code = ord(uchar)</span><br><span class="line">            <span class="keyword">if</span> inside_code == <span class="number">12288</span>:  <span class="comment"># å…¨è§’ç©ºæ ¼ç›´æ¥è½¬æ¢</span></span><br><span class="line">                inside_code = <span class="number">32</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="number">65374</span> &gt;= inside_code &gt;= <span class="number">65281</span>:  <span class="comment"># å…¨è§’å­—ç¬¦ï¼ˆé™¤ç©ºæ ¼ï¼‰æ ¹æ®å…³ç³»è½¬åŒ–</span></span><br><span class="line">                inside_code -= <span class="number">65248</span></span><br><span class="line">            b_str += chr(inside_code)</span><br><span class="line">        <span class="keyword">return</span> b_str</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">b_to_q</span><span class="params">(self, b_str)</span>:</span></span><br><span class="line">        <span class="string">"""åŠè§’è½¬å…¨è§’"""</span></span><br><span class="line">        q_str = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> uchar <span class="keyword">in</span> b_str:</span><br><span class="line">            inside_code = ord(uchar)</span><br><span class="line">            <span class="keyword">if</span> inside_code == <span class="number">32</span>:  <span class="comment"># åŠè§’ç©ºæ ¼ç›´æ¥è½¬åŒ–</span></span><br><span class="line">                inside_code = <span class="number">12288</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="number">126</span> &gt;= inside_code &gt;= <span class="number">32</span>:  <span class="comment"># åŠè§’å­—ç¬¦ï¼ˆé™¤ç©ºæ ¼ï¼‰æ ¹æ®å…³ç³»è½¬åŒ–</span></span><br><span class="line">                inside_code += <span class="number">65248</span></span><br><span class="line">            q_str += chr(inside_code)</span><br><span class="line">        <span class="keyword">return</span> q_str</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pre_process</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¯­æ–™é¢„å¤„ç† """</span></span><br><span class="line">        lines = self.read_corpus_from_file(self.train_corpus_path)</span><br><span class="line">        new_lines = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            words = self.q_to_b(line.strip()).split(<span class="string">u'  '</span>)</span><br><span class="line">            pro_words = self.process_t(words)</span><br><span class="line">            pro_words = self.process_nr(pro_words)</span><br><span class="line">            pro_words = self.process_k(pro_words)</span><br><span class="line">            new_lines.append(<span class="string">'  '</span>.join(pro_words[<span class="number">1</span>:]))</span><br><span class="line">        self.write_corpus_to_file(data=<span class="string">'\n'</span>.join(new_lines).encode(<span class="string">'utf-8'</span>), file_path=self.process_corpus_path)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_k</span><span class="params">(self, words)</span>:</span></span><br><span class="line">        <span class="string">"""å¤„ç†å¤§ç²’åº¦åˆ†è¯,åˆå¹¶è¯­æ–™åº“ä¸­æ‹¬å·ä¸­çš„å¤§ç²’åº¦åˆ†è¯,ç±»ä¼¼ï¼š[å›½å®¶/n  ç¯ä¿å±€/n]nt """</span></span><br><span class="line">        pro_words = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        temp = <span class="string">u''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            word = words[index] <span class="keyword">if</span> index &lt; len(words) <span class="keyword">else</span> <span class="string">u''</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">u'['</span> <span class="keyword">in</span> word:</span><br><span class="line">                temp += re.sub(pattern=<span class="string">u'/[a-zA-Z]*'</span>, repl=<span class="string">u''</span>, string=word.replace(<span class="string">u'['</span>, <span class="string">u''</span>))</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">u']'</span> <span class="keyword">in</span> word:</span><br><span class="line">                w = word.split(<span class="string">u']'</span>)</span><br><span class="line">                temp += re.sub(pattern=<span class="string">u'/[a-zA-Z]*'</span>, repl=<span class="string">u''</span>, string=w[<span class="number">0</span>])</span><br><span class="line">                pro_words.append(temp + <span class="string">u'/'</span> + w[<span class="number">1</span>])</span><br><span class="line">                temp = <span class="string">u''</span></span><br><span class="line">            <span class="keyword">elif</span> temp:</span><br><span class="line">                temp += re.sub(pattern=<span class="string">u'/[a-zA-Z]*'</span>, repl=<span class="string">u''</span>, string=word)</span><br><span class="line">            <span class="keyword">elif</span> word:</span><br><span class="line">                pro_words.append(word)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> pro_words</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_nr</span><span class="params">(self, words)</span>:</span></span><br><span class="line">        <span class="string">""" å¤„ç†å§“åï¼Œåˆå¹¶è¯­æ–™åº“åˆ†å¼€æ ‡æ³¨çš„å§“å’Œåï¼Œç±»ä¼¼ï¼šæ¸©/nr  å®¶å®/nr"""</span></span><br><span class="line">        pro_words = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            word = words[index] <span class="keyword">if</span> index &lt; len(words) <span class="keyword">else</span> <span class="string">u''</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">u'/nr'</span> <span class="keyword">in</span> word:</span><br><span class="line">                next_index = index + <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> next_index &lt; len(words) <span class="keyword">and</span> <span class="string">u'/nr'</span> <span class="keyword">in</span> words[next_index]:</span><br><span class="line">                    pro_words.append(word.replace(<span class="string">u'/nr'</span>, <span class="string">u''</span>) + words[next_index])</span><br><span class="line">                    index = next_index</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pro_words.append(word)</span><br><span class="line">            <span class="keyword">elif</span> word:</span><br><span class="line">                pro_words.append(word)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> pro_words</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_t</span><span class="params">(self, words)</span>:</span></span><br><span class="line">        <span class="string">"""å¤„ç†æ—¶é—´,åˆå¹¶è¯­æ–™åº“åˆ†å¼€æ ‡æ³¨çš„æ—¶é—´è¯ï¼Œç±»ä¼¼ï¼š ï¼ˆ/w  ä¸€ä¹ä¹ä¸ƒå¹´/t  åäºŒæœˆ/t  ä¸‰åä¸€æ—¥/t  ï¼‰/w   """</span></span><br><span class="line">        pro_words = []</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        temp = <span class="string">u''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            word = words[index] <span class="keyword">if</span> index &lt; len(words) <span class="keyword">else</span> <span class="string">u''</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">u'/t'</span> <span class="keyword">in</span> word:</span><br><span class="line">                temp = temp.replace(<span class="string">u'/t'</span>, <span class="string">u''</span>) + word</span><br><span class="line">            <span class="keyword">elif</span> temp:</span><br><span class="line">                pro_words.append(temp)</span><br><span class="line">                pro_words.append(word)</span><br><span class="line">                temp = <span class="string">u''</span></span><br><span class="line">            <span class="keyword">elif</span> word:</span><br><span class="line">                pro_words.append(word)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> pro_words</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pos_to_tag</span><span class="params">(self, p)</span>:</span></span><br><span class="line">        <span class="string">"""ç”±è¯æ€§æå–æ ‡ç­¾"""</span></span><br><span class="line">        t = self._maps.get(p, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> t <span class="keyword">if</span> t <span class="keyword">else</span> <span class="string">u'O'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tag_perform</span><span class="params">(self, tag, index)</span>:</span></span><br><span class="line">        <span class="string">"""æ ‡ç­¾ä½¿ç”¨BIOæ¨¡å¼"""</span></span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span> <span class="keyword">and</span> tag != <span class="string">u'O'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u'B_&#123;&#125;'</span>.format(tag)</span><br><span class="line">        <span class="keyword">elif</span> tag != <span class="string">u'O'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u'I_&#123;&#125;'</span>.format(tag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> tag</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pos_perform</span><span class="params">(self, pos)</span>:</span></span><br><span class="line">        <span class="string">"""å»é™¤è¯æ€§æºå¸¦çš„æ ‡ç­¾å…ˆéªŒçŸ¥è¯†"""</span></span><br><span class="line">        <span class="keyword">if</span> pos <span class="keyword">in</span> self._maps.keys() <span class="keyword">and</span> pos != <span class="string">u't'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u'n'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> pos</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ– """</span></span><br><span class="line">        lines = self.read_corpus_from_file(self.process_corpus_path)</span><br><span class="line">        words_list = [line.strip().split(<span class="string">'  '</span>) <span class="keyword">for</span> line <span class="keyword">in</span> lines <span class="keyword">if</span> line.strip()]</span><br><span class="line">        <span class="keyword">del</span> lines</span><br><span class="line">        self.init_sequence(words_list)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_sequence</span><span class="params">(self, words_list)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ–å­—åºåˆ—ã€è¯æ€§åºåˆ—ã€æ ‡è®°åºåˆ— """</span></span><br><span class="line">        words_seq = [[word.split(<span class="string">u'/'</span>)[<span class="number">0</span>] <span class="keyword">for</span> word <span class="keyword">in</span> words] <span class="keyword">for</span> words <span class="keyword">in</span> words_list]</span><br><span class="line">        pos_seq = [[word.split(<span class="string">u'/'</span>)[<span class="number">1</span>] <span class="keyword">for</span> word <span class="keyword">in</span> words] <span class="keyword">for</span> words <span class="keyword">in</span> words_list]</span><br><span class="line">        tag_seq = [[self.pos_to_tag(p) <span class="keyword">for</span> p <span class="keyword">in</span> pos] <span class="keyword">for</span> pos <span class="keyword">in</span> pos_seq]</span><br><span class="line">        self.pos_seq = [[[pos_seq[index][i] <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(words_seq[index][i]))]</span><br><span class="line">                         <span class="keyword">for</span> i <span class="keyword">in</span> range(len(pos_seq[index]))] <span class="keyword">for</span> index <span class="keyword">in</span> range(len(pos_seq))]</span><br><span class="line">        self.tag_seq = [[[self.tag_perform(tag_seq[index][i], w) <span class="keyword">for</span> w <span class="keyword">in</span> range(len(words_seq[index][i]))]</span><br><span class="line">                         <span class="keyword">for</span> i <span class="keyword">in</span> range(len(tag_seq[index]))] <span class="keyword">for</span> index <span class="keyword">in</span> range(len(tag_seq))]</span><br><span class="line">        self.pos_seq = [[<span class="string">u'un'</span>] + [self.pos_perform(p) <span class="keyword">for</span> pos <span class="keyword">in</span> pos_seq <span class="keyword">for</span> p <span class="keyword">in</span> pos] + [<span class="string">u'un'</span>] <span class="keyword">for</span> pos_seq <span class="keyword">in</span></span><br><span class="line">                        self.pos_seq]</span><br><span class="line">        self.tag_seq = [[t <span class="keyword">for</span> tag <span class="keyword">in</span> tag_seq <span class="keyword">for</span> t <span class="keyword">in</span> tag] <span class="keyword">for</span> tag_seq <span class="keyword">in</span> self.tag_seq]</span><br><span class="line">        self.word_seq = [[<span class="string">u'&lt;BOS&gt;'</span>] + [w <span class="keyword">for</span> word <span class="keyword">in</span> word_seq <span class="keyword">for</span> w <span class="keyword">in</span> word] + [<span class="string">u'&lt;EOS&gt;'</span>] <span class="keyword">for</span> word_seq <span class="keyword">in</span> words_seq]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_feature</span><span class="params">(self, word_grams)</span>:</span></span><br><span class="line">        <span class="string">"""ç‰¹å¾é€‰å–"""</span></span><br><span class="line">        features, feature_list = [], []</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(len(word_grams)):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word_grams[index])):</span><br><span class="line">                word_gram = word_grams[index][i]</span><br><span class="line">                feature = &#123;<span class="string">u'w-1'</span>: word_gram[<span class="number">0</span>], <span class="string">u'w'</span>: word_gram[<span class="number">1</span>], <span class="string">u'w+1'</span>: word_gram[<span class="number">2</span>],</span><br><span class="line">                           <span class="string">u'w-1:w'</span>: word_gram[<span class="number">0</span>] + word_gram[<span class="number">1</span>], <span class="string">u'w:w+1'</span>: word_gram[<span class="number">1</span>] + word_gram[<span class="number">2</span>],</span><br><span class="line">                           <span class="comment"># u'p-1': self.pos_seq[index][i], u'p': self.pos_seq[index][i+1],</span></span><br><span class="line">                           <span class="comment"># u'p+1': self.pos_seq[index][i+2],</span></span><br><span class="line">                           <span class="comment"># u'p-1:p': self.pos_seq[index][i]+self.pos_seq[index][i+1],</span></span><br><span class="line">                           <span class="comment"># u'p:p+1': self.pos_seq[index][i+1]+self.pos_seq[index][i+2],</span></span><br><span class="line">                           <span class="string">u'bias'</span>: <span class="number">1.0</span>&#125;</span><br><span class="line">                feature_list.append(feature)</span><br><span class="line">            features.append(feature_list)</span><br><span class="line">            feature_list = []</span><br><span class="line">        <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">segment_by_window</span><span class="params">(self, words_list=None, window=<span class="number">3</span>)</span>:</span></span><br><span class="line">        <span class="string">"""çª—å£åˆ‡åˆ†"""</span></span><br><span class="line">        words = []</span><br><span class="line">        begin, end = <span class="number">0</span>, window</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>, len(words_list)):</span><br><span class="line">            <span class="keyword">if</span> end &gt; len(words_list): <span class="keyword">break</span></span><br><span class="line">            words.append(words_list[begin:end])</span><br><span class="line">            begin = begin + <span class="number">1</span></span><br><span class="line">            end = end + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> words</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generator</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è®­ç»ƒæ•°æ®"""</span></span><br><span class="line">        word_grams = [self.segment_by_window(word_list) <span class="keyword">for</span> word_list <span class="keyword">in</span> self.word_seq]</span><br><span class="line">        features = self.extract_feature(word_grams)</span><br><span class="line">        <span class="keyword">return</span> features, self.tag_seq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRF_NER</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ–å‚æ•°"""</span></span><br><span class="line">        self.algorithm = <span class="string">"lbfgs"</span></span><br><span class="line">        self.c1 = <span class="string">"0.1"</span></span><br><span class="line">        self.c2 = <span class="string">"0.1"</span></span><br><span class="line">        self.max_iterations = <span class="number">100</span></span><br><span class="line">        self.model_path =<span class="string">"model.pkl"</span></span><br><span class="line">        self.corpus = CorpusProcess()  <span class="comment"># Corpus å®ä¾‹</span></span><br><span class="line">        self.corpus.pre_process()  <span class="comment"># è¯­æ–™é¢„å¤„ç†</span></span><br><span class="line">        self.corpus.initialize()  <span class="comment"># åˆå§‹åŒ–è¯­æ–™</span></span><br><span class="line">        self.model = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initialize_model</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ–"""</span></span><br><span class="line">        algorithm = self.algorithm</span><br><span class="line">        c1 = float(self.c1)</span><br><span class="line">        c2 = float(self.c2)</span><br><span class="line">        max_iterations = int(self.max_iterations)</span><br><span class="line">        self.model = sklearn_crfsuite.CRF(algorithm=algorithm, c1=c1, c2=c2,</span><br><span class="line">                                          max_iterations=max_iterations, all_possible_transitions=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è®­ç»ƒ"""</span></span><br><span class="line">        self.initialize_model()</span><br><span class="line">        x, y = self.corpus.generator()</span><br><span class="line">        x_train, y_train = x[<span class="number">500</span>:], y[<span class="number">500</span>:]</span><br><span class="line">        x_test, y_test = x[:<span class="number">500</span>], y[:<span class="number">500</span>]</span><br><span class="line">        self.model.fit(x_train, y_train)</span><br><span class="line">        labels = list(self.model.classes_)</span><br><span class="line">        labels.remove(<span class="string">'O'</span>)</span><br><span class="line">        y_predict = self.model.predict(x_test)</span><br><span class="line">        metrics.flat_f1_score(y_test, y_predict, average=<span class="string">'weighted'</span>, labels=labels)</span><br><span class="line">        sorted_labels = sorted(labels, key=<span class="keyword">lambda</span> name: (name[<span class="number">1</span>:], name[<span class="number">0</span>]))</span><br><span class="line">        print(metrics.flat_classification_report(y_test, y_predict, labels=sorted_labels, digits=<span class="number">3</span>))</span><br><span class="line">        self.save_model()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, sentence)</span>:</span></span><br><span class="line">        <span class="string">"""é¢„æµ‹"""</span></span><br><span class="line">        self.load_model()</span><br><span class="line">        u_sent = self.corpus.q_to_b(sentence)</span><br><span class="line">        word_lists = [[<span class="string">u'&lt;BOS&gt;'</span>] + [c <span class="keyword">for</span> c <span class="keyword">in</span> u_sent] + [<span class="string">u'&lt;EOS&gt;'</span>]]</span><br><span class="line">        word_grams = [self.corpus.segment_by_window(word_list) <span class="keyword">for</span> word_list <span class="keyword">in</span> word_lists]</span><br><span class="line">        features = self.corpus.extract_feature(word_grams)</span><br><span class="line">        y_predict = self.model.predict(features)</span><br><span class="line">        entity = <span class="string">u''</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(len(y_predict[<span class="number">0</span>])):</span><br><span class="line">            <span class="keyword">if</span> y_predict[<span class="number">0</span>][index] != <span class="string">u'O'</span>:</span><br><span class="line">                <span class="keyword">if</span> index &gt; <span class="number">0</span> <span class="keyword">and</span> y_predict[<span class="number">0</span>][index][<span class="number">-1</span>] != y_predict[<span class="number">0</span>][index - <span class="number">1</span>][<span class="number">-1</span>]:</span><br><span class="line">                    entity += <span class="string">u' '</span></span><br><span class="line">                entity += u_sent[index]</span><br><span class="line">            <span class="keyword">elif</span> entity[<span class="number">-1</span>] != <span class="string">u' '</span>:</span><br><span class="line">                entity += <span class="string">u' '</span></span><br><span class="line">        <span class="keyword">return</span> entity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_model</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åŠ è½½æ¨¡å‹ """</span></span><br><span class="line">        self.model = joblib.load(self.model_path)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_model</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""ä¿å­˜æ¨¡å‹"""</span></span><br><span class="line">        joblib.dump(self.model, self.model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    ner = CRF_NER()</span><br><span class="line">    <span class="comment">#è®­ç»ƒæ¨¡å‹ï¼Œå½“è®­ç»ƒå®Œæ¯•åï¼Œå°±å¯ä»¥ç›´æ¥åŠ è½½æ¨¡å‹å‚æ•°ï¼Œä¸ç”¨å†æ¬¡è®­ç»ƒäº†</span></span><br><span class="line">    <span class="comment">#mode=ner.train()</span></span><br><span class="line"></span><br><span class="line">    result1=ner.predict(<span class="string">u'æ–°åç¤¾åŒ—äº¬åäºŒæœˆä¸‰åä¸€æ—¥ç”µ(ä¸­å¤®äººæ°‘å¹¿æ’­ç”µå°è®°è€…åˆ˜æŒ¯è‹±ã€æ–°åç¤¾è®°è€…å¼ å®¿å ‚)ä»Šå¤©æ˜¯ä¸€ä¹ä¹ä¸ƒå¹´çš„æœ€åä¸€å¤©ã€‚'</span>)</span><br><span class="line">    print(result1)</span><br><span class="line">    result2=ner.predict(<span class="string">u'ä¸­å›½ï¼Œæˆ‘çˆ±ä½ ã€‚'</span>)</span><br><span class="line">    print(result2)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> CRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|éšé©¬å°”å¯å¤«æ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>éšé©¬å°”å¯å¤«æ¨¡å‹(HMM)ï¼Œæ˜¯ä¸€ä¸ªå¯ç”¨æ¥è§£å†³æ ‡æ³¨é—®é¢˜çš„ç”Ÿæˆæ¨¡å‹ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ã€è¯­éŸ³è¯†åˆ«ç­‰é¢†åŸŸæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚æœ¬ç¯‡åšå®¢å°†è¯¦ç»†åœ°ä»‹ç»HMMæ¨¡å‹çš„ä¸‰ä¸ªé—®é¢˜ä¸è§£å†³ç®—æ³•ï¼ŒåŒ…æ‹¬ï¼šå‰å‘-åå‘ç®—æ³•ã€Baum-Welchç®—æ³•ä»¥åŠå¤§åé¼é¼çš„Viterbiç®—æ³•ã€‚æœ€åï¼Œå¹¶é‡‡ç”¨pythonä»¥åŠhmmlearnåº“è¿™ä¸¤ç§æ–¹å¼ï¼Œæ¥å¯¹HMMæ¨¡å‹è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="éšé©¬å°”å¯å¤«æ¨¡å‹ä»‹ç»"><a href="#éšé©¬å°”å¯å¤«æ¨¡å‹ä»‹ç»" class="headerlink" title="éšé©¬å°”å¯å¤«æ¨¡å‹ä»‹ç»"></a>éšé©¬å°”å¯å¤«æ¨¡å‹ä»‹ç»</h2><p>éšé©¬å°”å¯å¤«æ¨¡å‹(HMM)ï¼Œå±äºæ¦‚ç‡å›¾æ¨¡å‹ã€‚å®ƒçš„åŸç†ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ä¸‰å¥è¯ï¼š<strong>ä¸€ä¸ªæ¨¡å‹ï¼Œä¸¤ä¸ªå‡è®¾ï¼Œä¸‰ä¸ªé—®é¢˜(ç®—æ³•)</strong>ã€‚ä¸‹é¢å°±è®²ä¸€ä»‹ç»ã€‚</p><h3 id="ä¸€ä¸ªæ¨¡å‹"><a href="#ä¸€ä¸ªæ¨¡å‹" class="headerlink" title="ä¸€ä¸ªæ¨¡å‹"></a>ä¸€ä¸ªæ¨¡å‹</h3><p>HMMæ¨¡å‹æè¿°çš„æ˜¯ä¸€ä¸ªéšè—çš„é©¬å°”å¯å¤«é“¾ç”Ÿæˆä¸å¯è§‚æµ‹çš„çŠ¶æ€åºåˆ—ï¼Œå†ç”±çŠ¶æ€åºåˆ—ç”Ÿæˆè§‚æµ‹åºåˆ—çš„è¿‡ç¨‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›ç¬¦å·ã€‚æˆ‘ä»¬å°†çŠ¶æ€åºåˆ—è®°ä¸ºï¼š$I=\{i_1,i_2,â€¦,i_T\}$ï¼Œå…¶ä¸­$T$è¡¨ç¤ºåºåˆ—çš„é•¿åº¦ï¼Œæ‰€æœ‰çš„çŠ¶æ€å˜é‡çš„å–å€¼é›†åˆè®°åšï¼š$Q=\{q_1,q_2,â€¦,q_N\}$ï¼Œå…¶ä¸­$N$è¡¨ç¤ºçŠ¶æ€å–å€¼çš„æ€»æ•°ã€‚æˆ‘ä»¬å°†è§‚æµ‹åºåˆ—è®°ä¸ºï¼š$O=\{o_1,o_2,â€¦,o_T\}$ï¼Œå…¶ä¸­$T$è¡¨ç¤ºåºåˆ—çš„é•¿åº¦ï¼Œæ‰€æœ‰çš„è§‚æµ‹å˜é‡çš„å–å€¼é›†åˆè®°åšï¼š$V=\{v_1,v_2,â€¦,v_M\}$ã€‚è®°HMMæ¨¡å‹çš„å‚æ•°ä¸ºï¼š$\lambda=(\pi,A,B)$ã€‚å…¶ä¸­ï¼Œ$\pi$è¡¨ç¤ºåˆå§‹æ¦‚ç‡åˆ†å¸ƒï¼Œ$A$è¡¨ç¤ºçŠ¶æ€è½¬ç§»çŸ©é˜µï¼›$B$è¡¨ç¤ºè§‚æµ‹æ¦‚ç‡åˆ†å¸ƒã€‚å…·ä½“å®ƒçš„æ¦‚ç‡å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" style="zoom:50%;"></p><h3 id="ä¸¤ä¸ªå‡è®¾"><a href="#ä¸¤ä¸ªå‡è®¾" class="headerlink" title="ä¸¤ä¸ªå‡è®¾"></a>ä¸¤ä¸ªå‡è®¾</h3><p>HMMæ¨¡å‹ä¸­æœ‰ä¸¤ä¸ªå‡è®¾ï¼š<strong>é½æ¬¡é©¬å°”å¯å¤«å‡è®¾</strong>ã€<strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>ã€‚</p><p><strong>é½æ¬¡é©¬å°”å¯å¤«å‡è®¾</strong>ã€‚åœ¨ç»™å®š$i_t$çš„æƒ…å†µä¸‹ï¼Œ$i_{t+1}$ä¸$i_{t-1}$ä»¥åŠä¹‹å‰çš„çŠ¶æ€å˜é‡æ— å…³ã€‚å³ï¼š</p><script type="math/tex; mode=display">P(i_{t+1}|i_t,i_{t-2},...,i_1,o_1,o_2,...,o_t)=P(i_{t+1}|i_t)</script><p><strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>ã€‚åœ¨ç»™å®š$i_t$çš„æƒ…å†µä¸‹ï¼Œ$o_t$ä¸ä¹‹å‰çš„çŠ¶æ€ä¸è§‚æµ‹å˜é‡éƒ½æ— å…³ã€‚å³ï¼š</p><script type="math/tex; mode=display">P(o_t|o_1,o_2,...,o_{t-1},i_1,i_2,...,i_t)=P(o_t|i_t)</script><h3 id="ä¸‰ä¸ªé—®é¢˜-ç®—æ³•"><a href="#ä¸‰ä¸ªé—®é¢˜-ç®—æ³•" class="headerlink" title="ä¸‰ä¸ªé—®é¢˜(ç®—æ³•)"></a>ä¸‰ä¸ªé—®é¢˜(ç®—æ³•)</h3><p>HMMæ¨¡å‹ä¸»è¦è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š<strong>Evaluationã€Learningã€Decoding</strong>ã€‚</p><p><strong>Evaluation</strong>ã€‚å³ï¼šåœ¨ç»™å®šæ¨¡å‹å‚æ•°$\lambda$çš„æƒ…å†µï¼Œç”Ÿæˆè§‚æµ‹åºåˆ—$O$çš„æ¦‚ç‡$P(O|\lambda)$ã€‚</p><p><strong>Learning</strong>ã€‚å³ï¼šæ±‚$\lambda$ï¼Œå³ï¼š$\lambda=\mathop{argmax}\limits_{\lambda}P(O|\lambda)$ã€‚</p><p><strong>Decoding</strong>ã€‚å³ï¼šç»™å®šæ¨¡å‹å‚æ•°ä¸è§‚æµ‹åºåˆ—çš„æƒ…å†µä¸‹ï¼Œæ±‚æ¦‚ç‡æœ€å¤§çš„çŠ¶æ€åºåˆ—ã€‚å³ï¼š$I=\mathop {argmax} \limits_{I}P(I|O)$ã€‚</p><p>å…³äºEvaluationé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰å‘ç®—æ³•æˆ–è€…åå‘ç®—æ³•è¿›è¡Œæ±‚è§£ï¼›å…³äºLearningé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨Baum-Welchç®—æ³•æ¥æ±‚è§£ï¼›å…³äºDecodingé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨Viterbiç®—æ³•æ¥æ±‚è§£ã€‚ä¸‹é¢å°†ä¸€ä¸€ä»‹ç»è¿™äº›ç®—æ³•ã€‚</p><h2 id="Evaluationé—®é¢˜çš„æ±‚è§£"><a href="#Evaluationé—®é¢˜çš„æ±‚è§£" class="headerlink" title="Evaluationé—®é¢˜çš„æ±‚è§£"></a>Evaluationé—®é¢˜çš„æ±‚è§£</h2><p>å…³äºEvaluationé—®é¢˜çš„æ±‚è§£ï¼Œæœ‰ä¸¤ç§ç®—æ³•ï¼š<strong>å‰å‘ç®—æ³•ä¸åå‘ç®—æ³•ã€‚</strong>å…¶å®ï¼Œæœ€åç»“æœæ˜¯ä¸€æ ·ï¼Œåªæ˜¯æ±‚è§£è¿‡ç¨‹ä¸å¤ªä¸€æ ·ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†ç›´æ¥ç»™å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆéœ€è¦åŒ–ç®€$P(O|\lambda)$ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom: 50%;"></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¬å¼ï¼š$P(O|\lambda)=\mathop{\sum}\limits_{I}\prod_{t=1}^{T}b_{i_t}(o_t) \pi (a_{i_1})\prod_{t=2}^{T}a_{i_{t-1},i_{t-2}}$ã€‚å…¶è®¡ç®—å¤æ‚åº¦ä¸ºï¼š$O(TN^T)$ã€‚å½“Tå¾ˆå¤§çš„æ—¶å€™ï¼Œè®¡ç®—å¤æ‚åº¦æ˜¯ä»¥æŒ‡æ•°å½¢å¼å¢é•¿çš„ï¼Œæ‰€ä»¥è¿‘ä¹æ˜¯ä¸å¯è§£çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»æ‰¾æ–°çš„ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="å‰å‘ç®—æ³•"><a href="#å‰å‘ç®—æ³•" class="headerlink" title="å‰å‘ç®—æ³•"></a>å‰å‘ç®—æ³•</h3><p>ä½¿ç”¨å‰å‘ç®—æ³•ï¼Œå¾—å‡ºé€’æ¨å…¬å¼ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" style="zoom: 67%;"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°é€’æ¨å…¬å¼ï¼š$\alpha_{t+1}(i)=\mathop{\sum}\limits_{j=1}^{N}\alpha_t(j)a_{ji}b_i(o_{t+1})$ã€‚åˆ$\alpha_1(i)=\pi_ib_i(o_1)$ï¼Œ$P(O|\lambda)=\mathop{\sum}\limits_{i=1}^{N}\alpha_T(i)$ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ±‚å‡º$p(O|\lambda)$çš„å€¼äº†ã€‚</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/4.jpg" style="zoom:50%;"></p><h3 id="åå‘ç®—æ³•"><a href="#åå‘ç®—æ³•" class="headerlink" title="åå‘ç®—æ³•"></a>åå‘ç®—æ³•</h3><p>é™¤äº†ä½¿ç”¨å‰å‘ç®—æ³•ï¼Œåå‘ç®—æ³•ä¹Ÿæ˜¯æ±‚è§£$P(O|\lambda)$çš„ä¸€ç§æ–¹æ³•ã€‚é€’æ¨å…¬å¼çš„æ¨å¯¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/5.jpg" style="zoom:67%;"></p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/6.jpg" style="zoom:67%;"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†é€’æ¨å…¬å¼ï¼š$\beta_t(i)=\mathop{\sum}\limits_{j=1}^{N}b_j(o_{t+1})\beta_{t+1}(j)$ã€‚åˆ$\beta_T(i)=1$ï¼Œ$P(O|\lambda)=\mathop{\sum}\limits_{i=1}^{N}\pi_ib_i(o_1)\beta_1(i)$ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ±‚å‡º$P(O|\lambda)$çš„å€¼äº†ã€‚</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/7.jpg" style="zoom:50%;"></p><h2 id="Learningé—®é¢˜çš„æ±‚è§£"><a href="#Learningé—®é¢˜çš„æ±‚è§£" class="headerlink" title="Learningé—®é¢˜çš„æ±‚è§£"></a>Learningé—®é¢˜çš„æ±‚è§£</h2><p>æ‰€è°“çš„Learningé—®é¢˜ï¼Œå…¶å®å°±æ˜¯æ±‚$\lambda=\mathop{argmax}\limits_{\lambda}P(O|\lambda)$ã€‚é‚£ä¹ˆï¼Œç›´æ¥æ±‚çš„è¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ªå¼å­æ˜¯æ²¡æœ‰è§£æè§£çš„ã€‚æ‰€ä»¥ï¼Œåœ¨HMMæ¨¡å‹ä¸­ï¼Œé‡‡ç”¨Baum-Welchç®—æ³•ï¼Œä¹Ÿå°±æ˜¯EMç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="Baum-Welchç®—æ³•-EMç®—æ³•"><a href="#Baum-Welchç®—æ³•-EMç®—æ³•" class="headerlink" title="Baum-Welchç®—æ³•(EMç®—æ³•)"></a>Baum-Welchç®—æ³•(EMç®—æ³•)</h3><p>Baum-Welchç®—æ³•æ¨å¯¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/8.jpg" style="zoom:67%;"></p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/11.jpg" style="zoom:50%;"></p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/10.jpg" style="zoom:50%;"></p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/9.jpg" style="zoom:50%;"></p><h2 id="Decodingé—®é¢˜çš„æ±‚è§£"><a href="#Decodingé—®é¢˜çš„æ±‚è§£" class="headerlink" title="Decodingé—®é¢˜çš„æ±‚è§£"></a>Decodingé—®é¢˜çš„æ±‚è§£</h2><p>æ‰€è°“çš„decodingé—®é¢˜ï¼Œå°±æ˜¯ï¼šç»™å®šæ¨¡å‹å‚æ•°$\lambda$ä¸è§‚æµ‹åºåˆ—$O$ï¼Œæ±‚æœ€å¤§æ¦‚ç‡çš„çŠ¶æ€å˜é‡$I$ã€‚å³ï¼š$I=\mathop{argmax}\limits_{I}P(I|O)$ã€‚åœ¨HMMä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Viterbiç®—æ³•æ¥æ±‚è§£ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œéå¸¸ç®€å•ã€‚</p><h3 id="Viterbiç®—æ³•"><a href="#Viterbiç®—æ³•" class="headerlink" title="Viterbiç®—æ³•"></a>Viterbiç®—æ³•</h3><p>æˆ‘ä»¬å®šä¹‰$\delta_t(i)$ä¸ºç¬¬tæ—¶åˆ»çŠ¶æ€ä¸º$q_i$çš„æ‰€æœ‰å•ä¸ªè·¯å¾„ä¸­çš„æ¦‚ç‡æœ€å¤§å€¼ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\delta_t(i)=\mathop{max}\limits_{i_1,i_2,i_3,...,i_{t-1}}P(i_t=q_i,i_1,...,i_{t-1},o_1,o_2,...,o_t|\lambda).</script><p>é‚£ä¹ˆï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¾—åˆ°é€’æ¨å…¬å¼ï¼š</p><script type="math/tex; mode=display">\delta_{t+1}(i)=\mathop{max}\limits_{i_1,i_2,i_3,...,i_{t}}P(i_{t+1}=q_i,i_1,...,i_{t},o_1,o_2,...,o_{t+1}|\lambda)\\=\mathop{max}\limits_{1<=j<=N}\delta_{t}(j)a_{ji}b_i(o_{t+1})</script><p>å…¶ä¸­ï¼Œ$i=1,2,â€¦,N$ã€‚æ ¹æ®è¿™ä¸ªé€’æ¨å…¬å¼ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½å¾—åˆ°æ‰€æœ‰è·¯å¾„ä¸­æ¦‚ç‡çš„æœ€å¤§å€¼ã€‚é‚£ä¹ˆæ€ä¹ˆæ±‚å¾—æ¦‚ç‡æœ€å¤§çš„è·¯å¾„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å®šä¹‰$\psi_t(i)$è¡¨ç¤ºtæ—¶åˆ»çŠ¶æ€ä¸ºä½ $q_i$çš„æ‰€æœ‰å•ä¸ªè·¯å¾„ä¸­æ¦‚ç‡æœ€å¤§çš„è·¯å¾„çš„ç¬¬$t-1$ä¸ªèŠ‚ç‚¹ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\psi_t(i)=\mathop{argmax}\limits_{1<=j<=N}\delta_{t-1}(j)a_{ji}</script><p>æ•´ç†å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/12.jpg" style="zoom:50%;"></p><p><img src="/2020/02/23/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/13.jpg" style="zoom:50%;"></p><p>è‡³æ­¤ï¼ŒHMMæ¨¡å‹ï¼Œç†è®ºéƒ¨åˆ†å°±è®²å®Œäº†ğŸ‰ï½</p><h2 id="HMMæ¨¡å‹çš„å®ç°"><a href="#HMMæ¨¡å‹çš„å®ç°" class="headerlink" title="HMMæ¨¡å‹çš„å®ç°"></a>HMMæ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†pythonä»¥åŠhmmlearnåº“è¿™ä¸¤ç§æ–¹å¼æ¥å®ç°HMMæ¨¡å‹ï¼Œæˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹åœ¨åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹</p><h3 id="ä½¿ç”¨hmmlearnåº“å®ç°"><a href="#ä½¿ç”¨hmmlearnåº“å®ç°" class="headerlink" title="ä½¿ç”¨hmmlearnåº“å®ç°"></a>ä½¿ç”¨hmmlearnåº“å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># E-mail:lzichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">hmmlearnä¸­æœ‰ä¸¤ä¸ªæ¨¡å‹ï¼šé«˜æ–¯HMMä¸å¤šé¡¹å¼HMMï¼Œåˆ†åˆ«å¯¹åº”äºï¼šå˜é‡æ˜¯è¿ç»­çš„ä¸ç¦»æ•£çš„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> hmmlearn <span class="keyword">import</span> hmm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 ä¸ªç›’å­çŠ¶æ€</span></span><br><span class="line">states = [<span class="string">'box1'</span>, <span class="string">'box2'</span>, <span class="string">'box3'</span>]</span><br><span class="line"><span class="comment"># 2 ä¸ªçƒè§‚å¯ŸçŠ¶æ€</span></span><br><span class="line">observations = [<span class="string">'red'</span>, <span class="string">'white'</span>]</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¦‚ç‡</span></span><br><span class="line">start_probability = np.array([<span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.4</span>])</span><br><span class="line"><span class="comment"># è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">transition_probability = np.array([</span><br><span class="line">    [<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.3</span>],</span><br><span class="line">    [<span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.2</span>],</span><br><span class="line">    [<span class="number">0.2</span>, <span class="number">0.3</span>, <span class="number">0.5</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘å°„çŠ¶æ€æ¦‚ç‡</span></span><br><span class="line">emission_probability = np.array([</span><br><span class="line">    [<span class="number">0.5</span>, <span class="number">0.5</span>],</span><br><span class="line">    [<span class="number">0.4</span>, <span class="number">0.6</span>],</span><br><span class="line">    [<span class="number">0.7</span>, <span class="number">0.3</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># å»ºç«‹æ¨¡å‹ï¼Œè®¾ç½®å‚æ•°</span></span><br><span class="line">    model = hmm.MultinomialHMM(n_components=len(states))</span><br><span class="line">    model.startprob_ = start_probability</span><br><span class="line">    model.transmat_ = transition_probability</span><br><span class="line">    model.emissionprob_ = emission_probability</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é¢„æµ‹é—®é¢˜,æ‰§è¡ŒViterbiç®—æ³•</span></span><br><span class="line">    seen = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">    logprob, box = model.decode(seen.reshape(<span class="number">-1</span>, <span class="number">1</span>), algorithm=<span class="string">'viterbi'</span>)</span><br><span class="line">    print(<span class="string">'The ball picked:'</span>, <span class="string">','</span>.join(map(<span class="keyword">lambda</span> x: observations[x], seen)))</span><br><span class="line">    print(<span class="string">'The hidden box:'</span>, <span class="string">','</span>.join(map(<span class="keyword">lambda</span> x: states[x], box)))</span><br><span class="line"></span><br><span class="line">    box_pre = model.predict(seen.reshape(<span class="number">-1</span>, <span class="number">1</span>))</span><br><span class="line">    print(<span class="string">'The ball picked:'</span>, <span class="string">','</span>.join(map(<span class="keyword">lambda</span> x: observations[x], seen)))</span><br><span class="line">    print(<span class="string">'The hidden box predict:'</span>, <span class="string">','</span>.join(map(<span class="keyword">lambda</span> x: states[x], box_pre)))</span><br><span class="line">    <span class="comment"># è§‚æµ‹åºåˆ—çš„æ¦‚ç‡è®¡ç®—é—®é¢˜</span></span><br><span class="line">    <span class="comment"># scoreå‡½æ•°è¿”å›çš„æ˜¯ä»¥è‡ªç„¶å¯¹æ•°ä¸ºåº•çš„å¯¹æ•°æ¦‚ç‡å€¼</span></span><br><span class="line">    <span class="comment"># ln0.13022â‰ˆâˆ’2.0385</span></span><br><span class="line">    print(model.score(seen.reshape(<span class="number">-1</span>, <span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"-------------------------------"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å­¦ä¹ é—®é¢˜</span></span><br><span class="line">    states = [<span class="string">"box1"</span>, <span class="string">"box2"</span>, <span class="string">"box3"</span>]</span><br><span class="line">    n_states = len(states)</span><br><span class="line"></span><br><span class="line">    observations = [<span class="string">"red"</span>, <span class="string">"white"</span>]</span><br><span class="line">    n_observations = len(observations)</span><br><span class="line"></span><br><span class="line">    model = hmm.MultinomialHMM(n_components=n_states)</span><br><span class="line">    <span class="comment"># ä¸‰ä¸ªè§‚æµ‹åºåˆ—ï¼Œç”¨æ¥è®­ç»ƒ</span></span><br><span class="line">    X = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]])</span><br><span class="line">    model.fit(X)  <span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    print(model.startprob_)  <span class="comment"># å¾—åˆ°åˆå§‹æ¦‚ç‡çŸ©é˜µ</span></span><br><span class="line">    print(model.transmat_)  <span class="comment"># å¾—åˆ°çŠ¶æ€è½¬ç§»çŸ©é˜µ</span></span><br><span class="line">    print(model.emissionprob_)  <span class="comment"># å¾—åˆ°è§‚æµ‹æ¦‚ç‡åˆ†å¸ƒ</span></span><br><span class="line">    <span class="comment"># æ¦‚ç‡è®¡ç®—</span></span><br><span class="line">    print(model.score(X))</span><br></pre></td></tr></table></figure><h3 id="Pythonå®ç°"><a href="#Pythonå®ç°" class="headerlink" title="Pythonå®ç°"></a>Pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf8</span></span><br><span class="line"><span class="comment"># Author:codeiwithzichao</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HMM</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, N, M)</span>:</span></span><br><span class="line">        self.A = np.zeros((N, N))  <span class="comment"># çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</span></span><br><span class="line">        self.B = np.zeros((N, M))  <span class="comment"># è§‚æµ‹æ¦‚ç‡çŸ©é˜µ</span></span><br><span class="line">        self.Pi = np.array([<span class="number">1.0</span> / N] * N)  <span class="comment"># åˆå§‹çŠ¶æ€æ¦‚ç‡çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">        self.N = N  <span class="comment"># å¯èƒ½çš„çŠ¶æ€æ•°</span></span><br><span class="line">        self.M = M  <span class="comment"># å¯èƒ½çš„è§‚æµ‹æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_probality</span><span class="params">(self, O)</span>:</span></span><br><span class="line">        self.T = len(O)</span><br><span class="line">        self.O = O</span><br><span class="line"></span><br><span class="line">        self.forward()</span><br><span class="line">        <span class="keyword">return</span> sum(self.alpha[self.T - <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‰å‘ç®—æ³•</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.alpha = np.zeros((self.T, self.N))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…¬å¼ 10.15</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">            self.alpha[<span class="number">0</span>][i] = self.Pi[i] * self.B[i][self.O[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…¬å¼10.16</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, self.T):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">                sum = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">                    sum += self.alpha[t - <span class="number">1</span>][j] * self.A[j][i]</span><br><span class="line">                self.alpha[t][i] = sum * self.B[i][self.O[t]]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åå‘ç®—æ³•</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.beta = np.zeros((self.T, self.N))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…¬å¼10.19</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">            self.beta[self.T - <span class="number">1</span>][i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…¬å¼10.20</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(self.T - <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">                    self.beta[t][i] += self.A[i][j] * self.B[j][self.O[t + <span class="number">1</span>]] * self.beta[t + <span class="number">1</span>][j]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_gamma</span><span class="params">(self, i, t)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å…¬å¼ 10.24</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        numerator = self.alpha[t][i] * self.beta[t][i]</span><br><span class="line">        denominator = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">            denominator += self.alpha[t][j] * self.beta[t][j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> numerator / denominator</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_ksi</span><span class="params">(self, i, j, t)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å…¬å¼ 10.26</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        numerator = self.alpha[t][i] * self.A[i][j] * self.B[j][self.O[t + <span class="number">1</span>]] * self.beta[t + <span class="number">1</span>][j]</span><br><span class="line">        denominator = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">                denominator += self.alpha[t][i] * self.A[i][j] * self.B[j][self.O[t + <span class="number">1</span>]] * self.beta[t + <span class="number">1</span>][j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> numerator / denominator</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        éšæœºç”Ÿæˆ Aï¼ŒBï¼ŒPi</span></span><br><span class="line"><span class="string">        å¹¶ä¿è¯æ¯è¡Œç›¸åŠ ç­‰äº 1</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">            randomlist = [random.randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> t <span class="keyword">in</span> range(self.N)]</span><br><span class="line">            Sum = sum(randomlist)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">                self.A[i][j] = randomlist[j] / Sum</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">            randomlist = [random.randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> t <span class="keyword">in</span> range(self.M)]</span><br><span class="line">            Sum = sum(randomlist)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.M):</span><br><span class="line">                self.B[i][j] = randomlist[j] / Sum</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, O, MaxSteps=<span class="number">100</span>)</span>:</span></span><br><span class="line">        self.T = len(O)</span><br><span class="line">        self.O = O</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        self.init()</span><br><span class="line"></span><br><span class="line">        step = <span class="number">0</span></span><br><span class="line">        <span class="comment"># é€’æ¨</span></span><br><span class="line">        <span class="keyword">while</span> step &lt; MaxSteps:</span><br><span class="line">            step += <span class="number">1</span></span><br><span class="line">            print(step)</span><br><span class="line">            tmp_A = np.zeros((self.N, self.N))</span><br><span class="line">            tmp_B = np.zeros((self.N, self.M))</span><br><span class="line">            tmp_pi = np.array([<span class="number">0.0</span>] * self.N)</span><br><span class="line"></span><br><span class="line">            self.forward()</span><br><span class="line">            self.backward()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># a_&#123;ij&#125;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">                    numerator = <span class="number">0.0</span></span><br><span class="line">                    denominator = <span class="number">0.0</span></span><br><span class="line">                    <span class="keyword">for</span> t <span class="keyword">in</span> range(self.T - <span class="number">1</span>):</span><br><span class="line">                        numerator += self.cal_ksi(i, j, t)</span><br><span class="line">                        denominator += self.cal_gamma(i, t)</span><br><span class="line">                    tmp_A[i][j] = numerator / denominator</span><br><span class="line"></span><br><span class="line">            <span class="comment"># b_&#123;jk&#125;</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.N):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(self.M):</span><br><span class="line">                    numerator = <span class="number">0.0</span></span><br><span class="line">                    denominator = <span class="number">0.0</span></span><br><span class="line">                    <span class="keyword">for</span> t <span class="keyword">in</span> range(self.T):</span><br><span class="line">                        <span class="keyword">if</span> k == self.O[t]:</span><br><span class="line">                            numerator += self.cal_gamma(j, t)</span><br><span class="line">                        denominator += self.cal_gamma(j, t)</span><br><span class="line">                    tmp_B[j][k] = numerator / denominator</span><br><span class="line"></span><br><span class="line">            <span class="comment"># pi_i</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">                tmp_pi[i] = self.cal_gamma(i, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            self.A = tmp_A</span><br><span class="line">            self.B = tmp_B</span><br><span class="line">            self.Pi = tmp_pi</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self, length)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        I = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># start</span></span><br><span class="line">        ran = random.randint(<span class="number">0</span>, <span class="number">1000</span>) / <span class="number">1000.0</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> self.Pi[i] &lt; ran <span class="keyword">or</span> self.Pi[i] &lt; <span class="number">0.0001</span>:</span><br><span class="line">            ran -= self.Pi[i]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        I.append(i)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”ŸæˆçŠ¶æ€åºåˆ—</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">            last = I[<span class="number">-1</span>]</span><br><span class="line">            ran = random.randint(<span class="number">0</span>, <span class="number">1000</span>) / <span class="number">1000.0</span></span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> self.A[last][i] &lt; ran <span class="keyword">or</span> self.A[last][i] &lt; <span class="number">0.0001</span>:</span><br><span class="line">                ran -= self.A[last][i]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            I.append(i)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”Ÿæˆè§‚æµ‹åºåˆ—</span></span><br><span class="line">        Y = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">            k = <span class="number">0</span></span><br><span class="line">            ran = random.randint(<span class="number">0</span>, <span class="number">1000</span>) / <span class="number">1000.0</span></span><br><span class="line">            <span class="keyword">while</span> self.B[I[i]][k] &lt; ran <span class="keyword">or</span> self.B[I[i]][k] &lt; <span class="number">0.0001</span>:</span><br><span class="line">                ran -= self.B[I[i]][k]</span><br><span class="line">                k += <span class="number">1</span></span><br><span class="line">            Y.append(k)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">triangle</span><span class="params">(length)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä¸‰è§’æ³¢</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    X = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(length)]</span><br><span class="line">    Y = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> X:</span><br><span class="line">        x = x % <span class="number">6</span></span><br><span class="line">        <span class="keyword">if</span> x &lt;= <span class="number">3</span>:</span><br><span class="line">            Y.append(x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Y.append(<span class="number">6</span> - x)</span><br><span class="line">    <span class="keyword">return</span> X, Y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sin</span><span class="params">(length)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä¸‰è§’æ³¢</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">import</span> math</span><br><span class="line">    X = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(length)]</span><br><span class="line">    Y = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> X:</span><br><span class="line">        x = x % <span class="number">20</span></span><br><span class="line">        Y.append(int(math.sin((x * math.pi) / <span class="number">10</span>) * <span class="number">50</span>) + <span class="number">50</span>)</span><br><span class="line">    <span class="keyword">return</span> X, Y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_data</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">    plt.plot(x, y, <span class="string">'g'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">     hmm = HMM(<span class="number">15</span>,<span class="number">101</span>)</span><br><span class="line">     sin_x, sin_y = sin(<span class="number">40</span>)</span><br><span class="line">     show_data(sin_x, sin_y)</span><br><span class="line">     hmm.train(sin_y)</span><br><span class="line">     y = hmm.generate(<span class="number">100</span>)</span><br><span class="line">     x = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>)]</span><br><span class="line">     show_data(x,y)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> HMM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|EMç®—æ³•åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>EMç®—æ³•ï¼Œä¸­æ–‡åå«æœŸæœ›æœ€å¤§ç®—æ³•ï¼Œä¸»è¦ç”¨æ¥æ±‚è§£å«æœ‰éšå˜é‡çš„æ¦‚ç‡æ¨¡å‹çš„å‚æ•°ã€‚åœ¨é«˜æ–¯æ··åˆæ¨¡å‹(GMM)ã€éšé©¬å°”å¯å¤«æ¨¡å‹(HMM)ä¸­éƒ½æœ‰åº”ç”¨(åœ¨HMMæ¨¡å‹ä¸­å«åšBaum-Welchç®—æ³•)ã€‚æœ¬ç¯‡åšå®¢å°†å¯¹EMç®—æ³•çš„åŸç†ä»¥åŠé«˜æ–¯æ··åˆæ¨¡å‹(GMM)è¿›è¡Œè¯¦ç»†åœ°è®²è§£ï¼Œå¹¶å¯¹å…¶é‡‡ç”¨pythonä¸scikit-learnåº“è¿™ä¸¤ç§æ–¹å¼è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦æœ‰EMç®—æ³•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰EMç®—æ³•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰EMç®—æ³•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰EMç®—æ³•ï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£<strong>ä¸ºä»€ä¹ˆè¦æœ‰EMç®—æ³•ï¼Ÿ</strong>å¯¹äºæ™®é€šçš„ä¼°è®¡æ¦‚ç‡æ¨¡å‹çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡æ±‚ä»–ä»¬çš„æå¤§ä¼¼ç„¶ä¼°è®¡$P(y|\theta)$ã€‚è­¬å¦‚è¯´ï¼Œæ·ä¸€æšç¡¬å¸æ­£é¢æœä¸Šçš„æ¦‚ç‡ä¸º$q$ï¼Œè¿ç»­æ·5æ¬¡ï¼Œç»“æœä¸ºï¼šæ­£é¢ã€æ­£é¢ã€åé¢ã€æ­£é¢ã€åé¢ï¼Œæ±‚$q$æ˜¯å¤šå°‘ï¼Ÿé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œå…¶ä¸­$q$å°±æ˜¯æˆ‘ä»¬éœ€è¦ä¼°è®¡çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æå¤§ä¼¼ç„¶ä¼°è®¡ï¼š$q=argmax_q \{q^3(1-q)^2\}$ã€‚æˆ‘ä»¬åªè¦æ±‚å…¶æ±‚å¯¼ï¼Œå°±å¯ä»¥å¾—åˆ°ï¼Œ$q=\frac 35$ã€‚è¿™ç›¸ä¿¡ï¼Œå¯¹ç†Ÿæ‚‰MLEçš„åŒå­¦æ¥è¯´ï¼Œæ˜¯éå¸¸å®¹æ˜“çš„ã€‚ä½†æ˜¯ï¼Œ<strong>å¦‚æœè¯´åŠ å…¥éšå˜é‡å‘¢ï¼Ÿ</strong>å…·ä½“å¦‚ä¸‹ï¼š</p><p>å‡è®¾æœ‰ä¸‰æšç¡¬å¸Aã€Bå’ŒCï¼ŒAæ­£é¢æœä¸Šçš„æ¦‚ç‡æ˜¯$q_1$ï¼ŒBæ­£é¢æœä¸Šçš„æ¦‚ç‡æ˜¯$q_2$ï¼ŒCæ­£é¢æœä¸Šçš„æ¦‚ç‡æ˜¯$q_3$ã€‚å½“æŠ•æ·Aç¡¬å¸æ­£é¢æœä¸Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å†æŠ•æ·Bï¼Œè®°å½•Bçš„ç»“æœï¼›å½“æŠ•æ·Aç¡¬å¸åé¢æœä¸Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å†æŠ•æ·Cï¼Œè®°å½•Cçš„ç»“æœã€‚å‡è®¾åªèƒ½è§‚å¯Ÿåˆ°ç»“æœï¼Œä¸­é—´æ˜¯é€‰æ‹©äº†Bæˆ–è€…Cï¼Œéƒ½ä¸çŸ¥é“ï¼Œé‡å¤äº”æ¬¡å®éªŒï¼Œç»“æœä¸ºï¼šæ­£é¢ã€æ­£é¢ã€åé¢ã€æ­£é¢ã€åé¢ã€‚æ±‚$q_1,q_2,q_3$ï¼Ÿï¼ˆä¾‹å­æ¥æºäºã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ï¼‰</p><p>é‚£ä¹ˆï¼Œéå¸¸æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½åƒä¼°è®¡æ™®é€šçš„æ¦‚ç‡æ¨¡å‹çš„å‚æ•°çš„æ–¹å¼æ¥ä¼°è®¡ä¸‰ä¸ªç¡¬å¸æ­£é¢æœä¸Šçš„æ¦‚ç‡ã€‚å› ä¸ºï¼Œä¸­é—´é€‰æ‹©Bæˆ–è€…Cçš„ç»“æœæˆ‘ä»¬å¹¶ä¸çŸ¥é“ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®è§‚å¯Ÿåˆ°çš„ç»“æœï¼Œæˆ‘ä»¬ä¸çŸ¥é“æ¯æ¬¡Açš„ç»“æœæ˜¯æ­£é¢è¿˜æ˜¯åé¢ã€‚è¿™å°±è¯´æ˜é—®é¢˜ä¸­å«æœ‰äº†éšå˜é‡ã€‚è¿™ä¸ªæ—¶å€™ï¼Œ<strong>å°±éœ€è¦æ–°çš„ç®—æ³•æ¥ä¼°è®¡åƒè¿™ç§å«æœ‰éšå˜é‡çš„æ¦‚ç‡æ¨¡å‹çš„å‚æ•°</strong>ã€‚æ‰€ä»¥ï¼ŒEMç®—æ³•åº”è¿è€Œç”Ÿã€‚</p><h2 id="EMç®—æ³•çš„æ¨å¯¼"><a href="#EMç®—æ³•çš„æ¨å¯¼" class="headerlink" title="EMç®—æ³•çš„æ¨å¯¼"></a>EMç®—æ³•çš„æ¨å¯¼</h2><p>é¦–å…ˆï¼Œæˆ‘ç›´æ¥ç»™å‡ºæ•´ä¸ªEMç®—æ³•ï¼Œç„¶åå†ç»™å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚</p><p><img src="/2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" style="zoom:50%;"></p><p><img src="/2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom:50%;"></p><p>æ­¤å¤–ï¼Œæ”¶æ•›æ¡ä»¶å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">||\theta^{(i+1)}-\theta^{(i)}||<\varepsilon_1, ||Q(\theta^{(i+1)},\theta^{(i)})-Q(\theta^{(i)},\theta^{(i)})||<\varepsilon_2</script><p><strong>ä¸‹é¢ç»™å‡ºæ¨å¯¼è¿‡ç¨‹ï¼ˆæ¨å¯¼è¿‡ç¨‹å¯èƒ½ä¸ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸ä¸€æ ·ï¼Œå…¶å®é“ç†æ˜¯ä¸€æ ·çš„ï¼‰ï¼š</strong></p><p><img src="/2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.jpg" alt></p><p>OKï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨å¾—åˆ°äº†å¦‚ä¸‹å¼å­ï¼š</p><script type="math/tex; mode=display">L(\theta)>=ELBO,\\ELBO=\sum_{z}P(Z|Y,\theta)log\frac {P(Y,Z|\theta)}{P(Z|Y,\theta)}</script><p>é‚£ä¹ˆï¼Œè¦è®©$L(\theta)$æœ€å¤§åŒ–ï¼Œä¹Ÿå°±æ˜¯è®©ä¸‹ç•ŒELBOæœ€å¤§åŒ–å³å¯ã€‚ä¹Ÿå°±æ˜¯è¯´:</p><script type="math/tex; mode=display">\theta^{(i+1)}=\mathop{argmax}\limits_{\theta}\sum_{z}P(Z|Y,\theta^{(i)})log\frac {P(Y,Z|\theta)}{P(Z|Y,\theta^{(i)})}</script><p>ç”±äº${P(Z|Y,\theta^{(i)})}$æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œä¸å½±å“$\theta^{(i+1)}$çš„æ›´æ–°ï¼Œæ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">\theta^{(i+1)}=\mathop{argmax}\limits_{\theta}\sum_{z}P(Z|Y,\theta^{(i)})log{P(Y,Z|\theta)}</script><p>æˆ‘ä»¬å¯¹å…¶æ•´ç†ä¸€ä¸‹ï¼š</p><script type="math/tex; mode=display">Q(\theta,\theta^{(i)})=\sum_{z}P(Z|Y,\theta^{(i)})log{P(Y,Z|\theta)},\\\theta^{(i+1)}==\mathop{argmax}\limits_{\theta}Q(\theta,\theta^{(i)})</script><p>æ˜¯ä¸æ˜¯ä¸æœ€å¼€å§‹ç»™å‡ºçš„EMç®—æ³•ä¸€æ‘¸ä¸€æ ·äº†ğŸ¤©ï¼Ÿåˆ°æ­¤ï¼Œæ¨å¯¼å®Œæ¯•ğŸ‰ï½</p><p>è¿˜æœ‰å¦å¤–ä¸€ç§æ¨å¯¼æ–¹æ³•ï¼Œä½¿ç”¨KLæ•£åº¦æ¥åš(ä¸ªäººè®¤ä¸ºè¿™ç§æ¨å¯¼è¿‡ç¨‹ä¼šæ›´å¥½ç†è§£ä¸€äº›)ï¼Œå…·ä½“æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/KLæ•£åº¦.jpg" alt></p><p>æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š<strong>EMç®—æ³•å¯¹åˆå€¼æ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¯´å–ä¸åŒçš„åˆå€¼$\theta^{(0)}$ï¼Œé‚£ä¹ˆç»“æœä¼šä¸ä¸€æ ·ï¼›å¦å¤–ï¼ŒEMç®—æ³•ä¸èƒ½ä¿è¯å…¨å±€æœ€ä¼˜ã€‚</strong></p><h2 id="EMç®—æ³•çš„æ”¶æ•›æ€§è¯æ˜"><a href="#EMç®—æ³•çš„æ”¶æ•›æ€§è¯æ˜" class="headerlink" title="EMç®—æ³•çš„æ”¶æ•›æ€§è¯æ˜"></a>EMç®—æ³•çš„æ”¶æ•›æ€§è¯æ˜</h2><p>å…¶å®ï¼ŒçŸ¥é“EMç®—æ³•çš„æ¨å¯¼å°±å·®ä¸å¤šäº†ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š<strong>è¿™æ ·è¿­ä»£æ›´æ–°ï¼Œæ˜¯å¦èƒ½å¤Ÿä¿è¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°$L(\theta)$èƒ½æ”¶æ•›å‘¢ï¼Ÿ</strong>è¯æ˜è¿‡ç¨‹å¦‚ä¸‹:</p><p><img src="/2020/02/22/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-EM%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpeg" alt></p><p>OKï¼Œè¯æ˜å®Œæ¯•ğŸ‰ï½å½“ç„¶ï¼ŒEMç®—æ³•çš„ä¸€ä¸ªå…¸å‹åº”ç”¨å°±æ˜¯GMMæ¨¡å‹ï¼Œè¿™ä¸ªä¹‹åæœ‰æ—¶é—´å†å†™ä¸€ç¯‡æ–‡ç« å§ï½</p><h2 id="EMç®—æ³•çš„å®ç°"><a href="#EMç®—æ³•çš„å®ç°" class="headerlink" title="EMç®—æ³•çš„å®ç°"></a>EMç®—æ³•çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†pythonæ¥å®ç°EMç®—æ³•ï¼Œä»¥åŠscikit-learnåº“æ¥å®ç°GMMæ¨¡å‹ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹åœ¨åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹</p><h3 id="EMç®—æ³•çš„pythonå®ç°"><a href="#EMç®—æ³•çš„pythonå®ç°" class="headerlink" title="EMç®—æ³•çš„pythonå®ç°"></a>EMç®—æ³•çš„pythonå®ç°</h3><h3 id="GMMæ¨¡å‹çš„scikit-learnå®ç°"><a href="#GMMæ¨¡å‹çš„scikit-learnå®ç°" class="headerlink" title="GMMæ¨¡å‹çš„scikit-learnå®ç°"></a>GMMæ¨¡å‹çš„scikit-learnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#Author:codewithzichao</span></span><br><span class="line"><span class="comment">#Date:2020-1-10</span></span><br><span class="line"><span class="comment">#E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"><span class="keyword">from</span> sklearn.mixture <span class="keyword">import</span> GaussianMixture</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    X, y_true = make_blobs(n_samples=<span class="number">400</span>, centers=<span class="number">4</span>,</span><br><span class="line">                           cluster_std=<span class="number">0.60</span>, random_state=<span class="number">0</span>)</span><br><span class="line">    X = X[:, ::<span class="number">-1</span>]  <span class="comment"># äº¤æ¢åˆ—æ˜¯ä¸ºäº†æ–¹ä¾¿ç”»å›¾</span></span><br><span class="line"></span><br><span class="line">    gmm = GaussianMixture(n_components=<span class="number">4</span>).fit(X)</span><br><span class="line">    labels = gmm.predict(X)</span><br><span class="line">    plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=labels, s=<span class="number">40</span>, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> EMç®—æ³• </tag>
            
            <tag> GMM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++|æ»‘åŠ¨çª—å£ä¸“é¢˜</title>
      <link href="2020/02/22/C-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%93%E9%A2%98/"/>
      <url>2020/02/22/C-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%93%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æ•´ç†ä¹‹å‰åˆ·è¿‡çš„leetcodeé¢˜ç›®ï¼Œæƒ³å†™å†™ä¸€äº›å¸¸è§çš„ã€å…¸å‹çš„è§£é¢˜æŠ€å·§æˆ–è€…æ–¹æ³•ã€‚æœ€å¼€å§‹åˆ·é¢˜çš„æ—¶å€™ï¼Œæ€»è§‰å¾—é¢˜ç›®å¥½éš¾ï¼Œå…¶å®åˆ·å¤šäº†é¢˜ï¼Œä¹Ÿå°±é‚£ä¹ˆå›äº‹ğŸ˜†ã€‚è¿™ç¯‡åšå®¢ä¸»è¦æƒ³ä»‹ç»ä¸€ä¸‹æ»‘åŠ¨çª—å£æ–¹æ³•(sliding window)ï¼Œå¯¹äºè§£å†³å­—ç¬¦ä¸²é—®é¢˜éå¸¸æœ‰ç”¨ğŸ¤©ï½</p><a id="more"></a><blockquote><p>è¿™ä¸€ç¯‡è§£ç­”å†™çš„éå¸¸çš„é€å½»ï¼Œè¯¦ç»†è¯·å‚çœ‹é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/minimum-window-substring/solution/hua-dong-chuang-kou-suan-fa-tong-yong-si-xiang-by-/" target="_blank" rel="noopener">æ»‘åŠ¨çª—å£æ€æƒ³</a></p></blockquote><p><strong>æ»‘åŠ¨çª—å£</strong>ï¼Œä¸»è¦æ˜¯ç”¨æ¥è§£å†³å­ä¸²é—®é¢˜ã€‚ä¸€èˆ¬çš„è§£å†³æ€è·¯æ˜¯ï¼š<strong>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰leftä¸rightä¸¤ä¸ªæ ‡å¿—ï¼Œç”¨æ¥ç•Œå®šæ»‘åŠ¨çª—å£çš„å·¦å³è¾¹ç•Œï¼›æ¥ç€ï¼Œæˆ‘ä»¬ä¸æ–­åœ°ç§»åŠ¨å³è¾¹ç•Œï¼Œå³right++ï¼›å½“æ»¡è¶³æŸä¸€æ¡ä»¶ä¹‹åï¼Œæˆ‘ä»¬ä¸æ–­åœ°ç§»åŠ¨å·¦è¾¹ç•Œï¼Œå³left++ï¼Œç¼©å‡æ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œç›´åˆ°æ»¡è¶³æœ€åçš„æ¡ä»¶ï¼Œç„¶åè¿”å›ç»“æœã€‚</strong>ä¸‹é¢ä»¥leetcodeä¸Šçš„ä¸‰é“é¢˜ä¸ºä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„Â æœ€é•¿å­ä¸²Â çš„é•¿åº¦ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç¤ºä¾‹Â 1:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è¾“å…¥: "abcabcbb"</span></span><br><span class="line"><span class="comment">è¾“å‡º: 3 </span></span><br><span class="line"><span class="comment">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "abc"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ»‘åŠ¨çª—å£çš„æ€æƒ³ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; m;</span><br><span class="line">        <span class="keyword">int</span> maxsize=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(right&lt;s.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">char</span> c1=s[right];</span><br><span class="line">            m[c1]++;</span><br><span class="line">            right++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(m[c1]&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">char</span> c2=s[left];</span><br><span class="line">                m[c2]--;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            maxsize=<span class="built_in">max</span>(maxsize,right-left);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  maxsize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line">Solution so1;</span><br><span class="line"><span class="keyword">int</span> ans=so1.lengthOfLongestSubstring(s);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">76. æœ€å°è¦†ç›–å­ä¸²</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² Sã€ä¸€ä¸ªå­—ç¬¦ä¸² Tï¼Œè¯·åœ¨å­—ç¬¦ä¸² S é‡Œé¢æ‰¾å‡ºï¼šåŒ…å« T æ‰€æœ‰å­—æ¯çš„æœ€å°å­ä¸²ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è¾“å…¥: S = "ADOBECODEBANC", T = "ABC"</span></span><br><span class="line"><span class="comment">è¾“å‡º: "BANC"</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ»‘åŠ¨çª—å£æ€æƒ³ã€‚ç¢°åˆ°å­—ä¸²é—®é¢˜ï¼Œç¬¬ä¸€æ—¶é—´å°±åº”è¯¥æƒ³åˆ°æ»‘åŠ¨çª—å£ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">minWindow</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(t.<span class="built_in">size</span>()==<span class="number">0</span> || s.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; <span class="keyword">m_t</span>;</span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; window;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;t.<span class="built_in">size</span>();i++) <span class="keyword">m_t</span>[t[i]]++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>;<span class="comment">//åŒæŒ‡é’ˆï¼Œæ»‘åŠ¨çª—å£çš„å·¦å³ä½ç½®</span></span><br><span class="line"><span class="keyword">int</span> start=<span class="number">0</span>,minlen=INT_MAX;<span class="comment">//startè¡¨ç¤ºæœ€åçš„å­—ç¬¦ä¸²çš„å¼€å§‹çš„ä½ç½®,minlenè¡¨ç¤ºæœ€åçš„å­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="keyword">int</span> match=<span class="number">0</span>;<span class="comment">//çª—å£å†…ä¸ç›®æ ‡å­—ç¬¦ä¸²åŒ¹é…çš„æ•°ç›®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç§»åŠ¨right</span></span><br><span class="line"><span class="keyword">while</span>(right&lt;s.<span class="built_in">size</span>())&#123;</span><br><span class="line"><span class="keyword">char</span> c1=s[right];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">m_t</span>.count(c1))&#123;</span><br><span class="line">window[c1]++;</span><br><span class="line"><span class="keyword">if</span>(window[c1]==<span class="keyword">m_t</span>[c1])&#123;</span><br><span class="line">match++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">right++;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœå·²ç»åŒ¹é…äº†ï¼Œè¯´æ˜çª—å£å†…çš„å­—ç¬¦ä¸²åŒ…å«äº†ç›®æ ‡å­—ç¬¦ä¸²ï¼Œæ¥ä¸‹æ¥ï¼Œå°±éœ€è¦ç¼©å‡çª—å£å¤§å°ï¼Œç§»åŠ¨leftï¼Œæ‰¾åˆ°åŒ…å«ç›®æ ‡å­—ç¬¦ä¸²çš„æœ€å°å­ä¸²</span></span><br><span class="line"><span class="keyword">while</span>(match==<span class="keyword">m_t</span>.<span class="built_in">size</span>())&#123;</span><br><span class="line"><span class="keyword">char</span> c2=s[left];</span><br><span class="line"><span class="keyword">if</span>(right-left&lt;minlen)&#123;</span><br><span class="line">                    start=left;</span><br><span class="line">                    minlen=right-left;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">m_t</span>.count(c2))&#123;</span><br><span class="line">window[c2]--;</span><br><span class="line"><span class="keyword">if</span>(window[c2]&lt;<span class="keyword">m_t</span>[c2])&#123;</span><br><span class="line">match--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">left++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> minlen==INT_MAX?<span class="string">""</span>:s.substr(start,minlen);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">string</span> s,t;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;s&gt;&gt;t;</span><br><span class="line"></span><br><span class="line">Solution so1;</span><br><span class="line"><span class="built_in">string</span> ans=so1.minWindow(s,t);</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Â sÂ å’Œä¸€ä¸ªéç©ºå­—ç¬¦ä¸²Â pï¼Œæ‰¾åˆ°Â sÂ ä¸­æ‰€æœ‰æ˜¯Â pÂ çš„å­—æ¯å¼‚ä½è¯çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²Â sÂ å’Œ pÂ çš„é•¿åº¦éƒ½ä¸è¶…è¿‡ 20100ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="comment">ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚</span></span><br><span class="line"><span class="comment">ç¤ºä¾‹Â 1:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è¾“å…¥:</span></span><br><span class="line"><span class="comment">s: "cbaebabacd" p: "abc"</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è¾“å‡º:</span></span><br><span class="line"><span class="comment">[0, 6]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è§£é‡Š:</span></span><br><span class="line"><span class="comment">èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ "cba", å®ƒæ˜¯ "abc" çš„å­—æ¯å¼‚ä½è¯ã€‚</span></span><br><span class="line"><span class="comment">èµ·å§‹ç´¢å¼•ç­‰äº 6 çš„å­ä¸²æ˜¯ "bac", å®ƒæ˜¯ "abc" çš„å­—æ¯å¼‚ä½è¯ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ»‘åŠ¨çª—å£æ€æƒ³ã€‚https://leetcode-cn.com/problems/minimum-window-substring/solution/hua-dong-chuang-kou-suan-fa-tong-yong-si-xiang-by-/</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">findAnagrams</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> p)</span> </span>&#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans;</span><br><span class="line"><span class="keyword">if</span>(s.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; m_p;</span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; window;</span><br><span class="line"><span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> match=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;p.<span class="built_in">size</span>();i++) m_p[p[i]]++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(right&lt;s.<span class="built_in">size</span>())&#123;</span><br><span class="line"><span class="keyword">char</span> c1=s[right];</span><br><span class="line"><span class="keyword">if</span>(m_p.count(c1))&#123;</span><br><span class="line">window[c1]++;</span><br><span class="line"><span class="keyword">if</span>(window[c1]==m_p[c1])&#123;</span><br><span class="line">match++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">right++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(match==m_p.<span class="built_in">size</span>())&#123;</span><br><span class="line"><span class="keyword">char</span> c2=s[left];</span><br><span class="line"><span class="keyword">if</span>(right-left==p.<span class="built_in">size</span>())&#123;</span><br><span class="line">ans.push_back(left);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(m_p.count(c2))&#123;</span><br><span class="line">window[c2]--;</span><br><span class="line"><span class="keyword">if</span>(window[c2]&lt;m_p[c2])&#123;</span><br><span class="line">match--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">left++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">string</span> s,p;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;s&gt;&gt;p;</span><br><span class="line">Solution so1;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans=so1.findAnagrams(s,p);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ans.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>,ans[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“ä»£ç åº”è¯¥å¾ˆæ¸…æ¥šå•¦ï¼Œoverâ˜•ï¸ï½</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> leetcode </tag>
            
            <tag> æ»‘åŠ¨çª—å£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|æœ€å¤§ç†µæ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ€å¤§ç†µæ¨¡å‹(MaxEntropy)ï¼Œæ˜¯æœºå™¨å­¦ä¹ ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„åˆ†ç±»æ¨¡å‹ï¼Œå…¶æ˜¯æœ€å¤§ç†µæ€æƒ³åº”ç”¨åˆ°åˆ†ç±»é—®é¢˜çš„ç»“æœã€‚æœ¬ç¯‡åšå®¢å°†å¯¹æœ€å¤§ç†µæ¨¡å‹çš„åŸç†è¿›è¡Œè¯¦ç»†çš„è®²è§£ï¼Œå¹¶é‡‡ç”¨pythonå®ç°å¯¹æœ€å¤§ç†µæ¨¡å‹è¿›è¡Œå®ç°(scikit-learnåº“æ²¡æœ‰å…³äºæœ€å¤§ç†µçš„ç±»åº“)ã€‚æ­¤å¤–ï¼Œè¿˜ä¼šå¯¹æ¯”è®²è§£å…¶logisticå›å½’çš„åŒºåˆ«ï¼Œå¹¶å®ç°logisticå›å½’æ¨¡å‹(pythonä¸scikit-learnåº“)ã€‚</p><a id="more"></a><h2 id="æœ€å¤§ç†µæ¨¡å‹æ¦‚è¿°"><a href="#æœ€å¤§ç†µæ¨¡å‹æ¦‚è¿°" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹æ¦‚è¿°"></a>æœ€å¤§ç†µæ¨¡å‹æ¦‚è¿°</h2><p>å…³äºä½¿ç”¨æœ€å¤§ç†µæ¨¡å‹ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦æ±‚çš„æ˜¯ï¼šç»™å®šå®ä¾‹çš„ç‰¹å¾å‘é‡$x$ï¼Œä½¿å¾—æ¡ä»¶æ¦‚ç‡$p(y|x)$æœ€å¤§çš„$y$ã€‚ä½†æ˜¯å®ƒä¸æœ´ç´ è´å¶æ–¯ä¸ä¸€æ ·ï¼Œæœ´ç´ è´å¶æ–¯æ˜¯é€šè¿‡æ±‚è”åˆæ¦‚ç‡ï¼Œç„¶åæ ¹æ®è´å¶æ–¯å®šç†æ±‚å¾—$p(y|x)$ï¼›è€Œæœ€å¤§ç†µæ¨¡å‹æ˜¯ç›´æ¥æ±‚$p(y|x)$ã€‚å®ƒæ‰€ä½¿ç”¨çš„æ€æƒ³å°±æ˜¯ï¼š<strong>æœ€å¤§ç†µæ€æƒ³</strong>ã€‚æ‰€è°“çš„æœ€å¤§ç†µæ€æƒ³å°±æ˜¯ï¼š<strong>å½“æˆ‘ä»¬è¦æ±‚ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä»»ä½•çš„å…ˆéªŒçŸ¥è¯†çš„æ—¶å€™ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥é€‰ç†µæœ€å¤§çš„åˆ†å¸ƒï¼›å¦‚æœæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€äº›å…ˆéªŒçŸ¥è¯†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥é€‰æ»¡è¶³è¿™äº›å…ˆéªŒçŸ¥è¯†çš„æƒ…å†µä¸‹ï¼Œç†µæœ€å¤§çš„åˆ†å¸ƒã€‚</strong>ä¸‹é¢æˆ‘å°†ä»‹ç»æœ€å¤§ç†µæ¨¡å‹å¦‚ä½•è´¯å½»æœ€å¤§ç†µæ€æƒ³çš„ã€‚</p><h2 id="æœ€å¤§ç†µæ¨¡å‹"><a href="#æœ€å¤§ç†µæ¨¡å‹" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹"></a>æœ€å¤§ç†µæ¨¡å‹</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç†µçš„æ¦‚å¿µï¼Œå¦‚æœç¦»æ•£éšæœºå˜é‡çš„æ¦‚ç‡åˆ†å¸ƒæ˜¯$P(x)$ï¼Œé‚£ä¹ˆå®ƒçš„ç†µå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H(P)=-\sum_xP(x)log(P(x))</script><p>å…¶ä¸­ï¼Œ$x$è¡¨ç¤ºéšæœºå˜é‡$X$çš„å–å€¼ã€‚é‚£ä¹ˆå¯¹äºæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ$P(y|x)$ï¼Œå®ƒçš„ç†µï¼Œæˆ‘ä»¬å¯ä»¥å¥—ç”¨å…¬å¼ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H(P)=-\sum_{y}P(y|x)log(P(y|x))</script><p>ä½†æ˜¯è¿™æ ·è¿˜ä¸å¤Ÿã€‚å› ä¸ºæˆ‘ä»¬è¦ä¿è¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œç†µéƒ½æ˜¯æœ€å¤§çš„ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥$\tilde P(x)$ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H(P)=-\sum_{x,y}\tilde P(x)P(y|x)log(P(y|x))</script><p>å…³äº$\tilde P(x)$ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼š<strong>ç”±äºæˆ‘ä»¬è¦æ±‚çš„æ˜¯æœ€å¤§ç†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ»¡è¶³å…ˆéªŒçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œæ€»çš„ç†µæ˜¯æœ€å¤§çš„ã€‚ç”±äºå¯¹äºæ¯ä¸€ä¸ª$x$ï¼Œéƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒ$P(y|x)$ï¼Œä¹Ÿå°±ä¼šå¯¹åº”ä¸€ä¸ªç†µã€‚æ‰€ä»¥ï¼Œæœ€å¤§åŒ–ç†µï¼Œä¹Ÿå°±æ˜¯æœ€å¤§åŒ–è¿™äº›æ‰€æœ‰çš„ç†µçš„å’Œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½“ç°å‡ºæ¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒçš„ç†µçš„é‡è¦æ€§ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œ$\tilde P(x)$å°±ç›¸å½“äºæƒé‡ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸€äº›çº¦æŸæ¡ä»¶ã€‚å› ä¸ºè®­ç»ƒé›†å°±ç›¸å½“äºæ˜¯å…ˆéªŒçŸ¥è¯†ï¼Œæœ€å¤§ç†µå°±æ˜¯æ»¡è¶³å…ˆéªŒçŸ¥è¯†çš„åŸºç¡€ä¸Šçš„ç†µæœ€å¤§çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒã€‚æˆ‘ä»¬å®šä¹‰ç‰¹å¾å‡½æ•°$f_i(x,y)$ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">f_i(x,y)=\begin{cases}1&,\ xä¸yæ»¡è¶³æŸä¸€äº‹å® \\0&,\ å¦åˆ™ \end{cases}</script><p>å…¶ä¸­$i$è¡¨ç¤ºç¬¬$i$ä¸ªç‰¹å¾ï¼Œ$i=1,2,3,â€¦,n$ã€‚é‚£ä¹ˆ$f(x,y)$å…³äº$\tilde P(x,y)$çš„æœŸæœ›å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">E_{\tilde P}=\sum_{x,y}\tilde P(x,y)f(x,y)=\sum_{x,y}\tilde P(x)\tilde P(y|x)f(x,y)</script><p>å¦‚æœè¯´æˆ‘ä»¬çš„æ¨¡å‹æ­£ç¡®çš„è¯ï¼Œé‚£ä¹ˆ$P(y|x)=\tilde P(y|x)$ã€‚æ‰€ä»¥è¿™å°±æ˜¯ä¸€ç§çº¦æŸï¼Œçº¦æŸæˆ‘ä»¬å¿…é¡»è¦å»å¾—åˆ°æ­£ç¡®çš„æ¨¡å‹ï¼</p><p><strong>æœ€å¤§ç†µæ¨¡å‹æ€»ç»“å¦‚ä¸‹ï¼š</strong></p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" style="zoom:50%;"></p><p>ç”±äºæˆ‘ä»¬ä¹ æƒ¯æœ€å°åŒ–é—®é¢˜ï¼Œæ‰€ä»¥ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom:50%;"></p><h2 id="æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ "><a href="#æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ " class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ "></a>æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ </h2><p>æˆ‘ä»¬é¦–å…ˆå°†æœ€å¤§ç†µæ¨¡å‹æ‘˜æŠ„ä¸‹æ¥ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom:50%;"></p><p>é‚£ä¹ˆï¼Œå¯¹äºæœ‰çº¦æŸçš„æœ€ä¼˜åŒ–é—®é¢˜ï¼Œå¾ˆè‡ªç„¶åœ°å°±æƒ³åˆ°æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.jpg" style="zoom:50%;"></p><p>æ‰€ä»¥ï¼Œå¯¹äºåŸå§‹é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š$min_Pmax_wL(P,w)$ï¼›å¯¹äºå¯¹å¶é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ï¼š$max_wmin_PL(P,w)$ã€‚æˆ‘ä»¬é¦–å…ˆæ±‚$min_PL(P,w)$ï¼Œä¹Ÿå°±æ˜¯æ±‚$\frac {\partial L}{\partial P}=0$ï¼Œå‡è®¾æˆ‘ä»¬å¾—åˆ°çš„æœ€ä¼˜è§£è®°ä¸ºï¼š$P_w(y|x)$ï¼Œæœ€åç»“æœæ˜¯ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" style="zoom:50%;"></p><p>åœ¨æ±‚å¾—äº†$P_w(y|x)$ä¹‹åï¼Œæˆ‘ä»¬å°±åªéœ€è¦æ±‚$max_w(P_w,w)$å³å¯ã€‚å°†$P_w$ å¸¦å…¥åˆ°åŸæ¥çš„æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼ŒåŒ–ç®€ï¼Œç„¶åæ±‚å¯¼ï¼Œå³ï¼š$\frac {\partial L(P_w,w)}{\partial w}=0$ã€‚ä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°ï¼ŒåŒ–ç®€åå¤ªéš¾æ±‚äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±é‡‡ç”¨å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯<strong>å°†å¯¹å¶å‡½æ•°çš„æœ€å¤§åŒ–è½¬åŒ–ä¸ºæœ€å¤§ç†µæ¨¡å‹çš„æå¤§ä¼¼ç„¶ä¼°è®¡</strong>ã€‚ä¸‹é¢æ˜¯æ¨å¯¼å‡ºæœ€å¤§ç†µæ¨¡å‹çš„æå¤§ä¼¼ç„¶ä¼°è®¡è¿‡ç¨‹(ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸­å¹¶æ²¡æœ‰ç»™å‡ºæ¨å¯¼è¿‡ç¨‹)ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/4.jpeg" style="zoom:50%;"></p><p>æ­¤å¤–ï¼Œå¯ä»¥è¯æ˜åŒ–ç®€åçš„å¯¹å¶é—®é¢˜ä¸æœ€å¤§ç†µæ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°æ˜¯ä¸€æ ·çš„ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œè¯æ˜ä¸€ä¸‹ã€‚</p><h2 id="æœ€å¤§ç†µæ¨¡å‹å­¦ä¹ çš„ä¼˜åŒ–ç®—æ³•"><a href="#æœ€å¤§ç†µæ¨¡å‹å­¦ä¹ çš„ä¼˜åŒ–ç®—æ³•" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹å­¦ä¹ çš„ä¼˜åŒ–ç®—æ³•"></a>æœ€å¤§ç†µæ¨¡å‹å­¦ä¹ çš„ä¼˜åŒ–ç®—æ³•</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ•´ç†ä¸€ä¸‹ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°çš„ä¸œè¥¿ï¼š<strong>æœ€å¤§ç†µæ¨¡å‹ã€æ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°</strong>ã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªè¦å¯¹å¯¹æ•°ä¼¼ç„¶å‡½æ•°æ±‚å¯¼ï¼Œå¾—å‡ºå‚æ•°$w$çš„å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€å¤§ç†µæ¨¡å‹$P_w(y|x)$ã€‚ç”±äºæœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°æ˜¯ä¸€ä¸ªå‡¸ä¼˜åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰›é¡¿æ³•ã€IISç­‰ç®—æ³•æ±‚è§£ã€‚åœ¨è¿™é‡Œä¸»è¦ä»‹ç»IISï¼ˆæ”¹è¿›çš„è¿­ä»£ç¨‹åº¦æ³•ï¼‰ã€‚</p><p>IISçš„æ€æƒ³æ˜¯ï¼š<strong>å¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°ä¸€ç§å‚æ•°æ›´æ–°æ–¹æ³•ï¼š$r:w-&gt;w+\delta$ï¼Œä½¿å¾—å¯¹æ•°ä¼¼ç„¶å‡½æ•°èƒ½å¤Ÿå¢å¤§ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡å¤ä½¿ç”¨æ”¹æ–¹æ³•ï¼Œä»è€Œå¾—åˆ°æœ€ä¼˜è§£ã€‚</strong>æˆ‘ä»¬å¯ä»¥é¦–å…ˆè®¡ç®—ä¼¼ç„¶å‡½æ•°çš„æ”¹å˜é‡ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/5.jpg" style="zoom:50%;"></p><p>æ ¹æ®ä¸ç­‰å¼ï¼š$-loga&gt;=1-a$ï¼Œé‚£ä¹ˆå°†ä¸Šå¼è¿›è¡Œæ”¾ç¼©ï¼Œå¾—åˆ°å¦‚ä¸‹å¼å­ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/6.jpg" style="zoom:50%;"></p><p>æˆ‘ä»¬è®°å³è¾¹çš„å¼å­ä¸ºï¼š$A(\delta|w)$ã€‚è¿™å°±æ˜¯ä¼¼ç„¶å‡½æ•°æ”¹å˜é‡çš„ä¸‹ç•Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æˆ‘ä»¬æ‰¾åˆ°åˆé€‚çš„$\delta$ï¼Œä¸æ–­æé«˜ä¸‹ç•Œï¼Œå°±èƒ½å¤Ÿä½¿å¾—ä¼¼ç„¶å‡½æ•°ä¸æ–­å¢å¤§ã€‚ä½†æ˜¯IISç®—æ³•ä¸€æ¬¡åªèƒ½ä¼˜åŒ–ä¸€ä¸ªå‚æ•°$w_i$ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†å¯¹ä¸‹ç•Œè¿›è¡Œæ”¾ç¼©ï¼ˆè¿™å…¶ä¸­ç”¨åˆ°äº†Jensenä¸ç­‰å¼ï¼‰ã€‚å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/7.jpg" style="zoom:50%;"></p><p>è®°å³è¾¹çš„å¼å­ä¸º$B(\delta|w)$ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åªè¦å¯¹$B(\delta|w$æ±‚å¯¼ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€åçš„ç»“æœäº†ã€‚<strong>æ€»ç»“å¦‚ä¸‹ï¼š</strong></p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/8.jpg" style="zoom:50%;"></p><p>åˆ°æ­¤ï¼Œæœ€å¤§ç†µæ¨¡å‹çš„ç†è®ºéƒ¨åˆ†æ±‚è®²è§£å®Œäº†ï½</p><h2 id="æœ€å¤§ç†µæ¨¡å‹ä¸LRæ¨¡å‹çš„åŒºåˆ«ä¸è”ç³»"><a href="#æœ€å¤§ç†µæ¨¡å‹ä¸LRæ¨¡å‹çš„åŒºåˆ«ä¸è”ç³»" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹ä¸LRæ¨¡å‹çš„åŒºåˆ«ä¸è”ç³»"></a>æœ€å¤§ç†µæ¨¡å‹ä¸LRæ¨¡å‹çš„åŒºåˆ«ä¸è”ç³»</h2><p>ç”±äºæœ€å¤§ç†µæ¨¡å‹ä¸LRæ¨¡å‹æ€»æ˜¯è¢«æ”¾åœ¨ä¸€èµ·è®²ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ä¸è”ç³»ã€‚æœ€å¤§ç†µæ¨¡å‹ä¸logisticå›å½’æ¨¡å‹æœ€å¤§çš„ç›¸ä¼¼ä¹‹å¤„åœ¨äºï¼š<strong>æœ€åéƒ½æ˜¯æ±‚æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒå…³äºè®­ç»ƒé›†çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æœ€å¤§åŒ–</strong>ï¼ŒåŒºåˆ«åœ¨äºï¼š<strong>æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒçš„å½¢å¼ä¸åŒ</strong>ï¼ŒLRæ¨¡å‹çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒå°±æ˜¯sigmoidå‡½æ•°ã€‚å…·ä½“å…³äºLRæ¨¡å‹çš„ç»†èŠ‚ï¼Œæˆ‘å°±ä¸è®²äº†ï¼Œå› ä¸ºå®åœ¨å¤ªç®€å•äº†ï¼Œæˆ‘å°±æ”¾ä¸€å¼ LRæ¨¡å‹çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æœ€å¤§åŒ–çš„æ¨å¯¼è¿‡ç¨‹å§ï½</p><p><img src="/2020/02/20/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/9.jpeg" style="zoom:50%;"></p><h2 id="æœ€å¤§ç†µæ¨¡å‹çš„å®ç°"><a href="#æœ€å¤§ç†µæ¨¡å‹çš„å®ç°" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹çš„å®ç°"></a>æœ€å¤§ç†µæ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†pythonæ¥å®ç°æœ€å¤§ç†µæ¨¡å‹ä¸logisticå›å½’æ¨¡å‹ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹åœ¨åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="logisticå›å½’æ¨¡å‹pythonå®ç°"><a href="#logisticå›å½’æ¨¡å‹pythonå®ç°" class="headerlink" title="logisticå›å½’æ¨¡å‹pythonå®ç°"></a>logisticå›å½’æ¨¡å‹pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2020-1-2</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.9919</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š29.48268699645996</span></span><br><span class="line"><span class="string">--------------</span></span><br><span class="line"><span class="string">tips:åœ¨åŠ è½½æ•°æ®çš„æ—¶å€™ï¼ŒæŠŠ&gt;=5ä¸º1ï¼Œ&lt;5ä¸º0è¿™æ ·å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œåœ¨åŒæ ·çš„è®­ç»ƒæ¬¡æ•°ä¸å­¦ä¹ ç‡çš„æ—¶å€™ï¼Œæœ€åçš„å‡†ç¡®ç‡åªæœ‰78%å·¦å³ã€‚</span></span><br><span class="line"><span class="string">å¯èƒ½æ˜¯æ•°æ®ç±»åˆ«å¤ªå¤šï¼Œå¯¼è‡´æ¯”è¾ƒæ··ä¹±ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–çš„æ˜¯æ ‡ç­¾ä¸º0çš„ä¸º1ï¼Œä¸ä¸º0çš„å…¨ä¸º0ã€‚</span></span><br><span class="line"><span class="string">è¿™æ ·å‡†ç¡®ç‡å¤§å¤§æé«˜äº†ã€‚</span></span><br><span class="line"><span class="string">--------------</span></span><br><span class="line"><span class="string">æ³¨æ„ï¼Œè¿™é‡Œå®ç°çš„LRæ¨¡å‹é‡‡ç”¨çš„æ˜¯ç¥ç»ç½‘ç»œçš„æ€æƒ³ï¼Œå°±æ˜¯å°†LRæ¨¡å‹è§†ä¸ºä¸€ä¸ªå•å±‚ç¥ç»ç½‘ç»œã€‚æŒ‰ç…§å‰å‘ä¼ æ’­ä¸åå‘ä¼ æ’­çš„æ–¹å¼æ¥å†™çš„ä»£ç ã€‚</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName:æ•°æ®è·¯å¾„å</span></span><br><span class="line"><span class="string">    :return: ç‰¹å¾å‘é‡çŸ©é˜µã€è¿˜æœ‰æ ‡ç­¾çŸ©é˜µ</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list = [];</span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            <span class="keyword">if</span> (int(curline[<span class="number">0</span>]) ==<span class="number">0</span>):</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">0</span>)</span><br><span class="line">            data_list.append([int(feature) / <span class="number">255</span> <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list).reshape(<span class="number">1</span>, <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(z)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å®šä¹‰sigmoidå‡½æ•°</span></span><br><span class="line"><span class="string">    :param z: è¾“å…¥</span></span><br><span class="line"><span class="string">    :return: è¿”å›ï¼ˆ0ï¼Œ1ï¼‰çš„æ•°</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    result = <span class="number">1</span> / (<span class="number">1</span> + np.exp(-z))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize_params</span><span class="params">(feature_dim)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åˆå§‹åŒ–å‚æ•°w,b</span></span><br><span class="line"><span class="string">    :param feature_dim:å®ä¾‹ç‰¹å¾æ•°ç›®</span></span><br><span class="line"><span class="string">    :return: å‚æ•°w,b</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    w = np.zeros((feature_dim, <span class="number">1</span>))</span><br><span class="line">    b = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> w, b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">propagation</span><span class="params">(w, b, X, Y)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä¸€æ¬¡å‰å‘ä¸åå‘ä¼ æ’­è¿‡ç¨‹</span></span><br><span class="line"><span class="string">    :param w:å‚æ•°w</span></span><br><span class="line"><span class="string">    :param b: å‚æ•°b</span></span><br><span class="line"><span class="string">    :param X: è¾“å…¥çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">    :param Y: è¾“å…¥çš„ç±»åˆ«å‘é‡</span></span><br><span class="line"><span class="string">    :return:dw,db,costs</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    N, _ = np.shape(X)  <span class="comment"># è®­ç»ƒé›†æ•°ç›®</span></span><br><span class="line">    X = X.T</span><br><span class="line">    <span class="comment"># print(X.shape)</span></span><br><span class="line">    A = sigmoid(np.dot(w.T, X) + b)</span><br><span class="line">    <span class="comment"># epsilon=1e-5</span></span><br><span class="line">    cost = <span class="number">-1</span> / N * (np.sum(Y * np.log(A) + (<span class="number">1</span> - Y) * np.log(<span class="number">1</span> - A)))</span><br><span class="line"></span><br><span class="line">    dz = A - Y</span><br><span class="line">    dw = <span class="number">1</span> / N * np.dot(X, dz.T)</span><br><span class="line">    db = <span class="number">1</span> / N * np.sum(dz)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> (dw.shape == w.shape)</span><br><span class="line">    <span class="keyword">assert</span> (db.dtype == float)</span><br><span class="line"></span><br><span class="line">    cost = np.squeeze(cost)</span><br><span class="line">    <span class="keyword">assert</span> (cost.shape == ())</span><br><span class="line"></span><br><span class="line">    grads = &#123;<span class="string">"dw"</span>: dw, <span class="string">"db"</span>: db&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> grads, cost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">optimization</span><span class="params">(w, b, X, Y, iterations, learning_rate)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä¼˜åŒ–ï¼Œä½¿ç”¨batch GD</span></span><br><span class="line"><span class="string">    :param w: å‚æ•°w</span></span><br><span class="line"><span class="string">    :param b: å‚æ•°b</span></span><br><span class="line"><span class="string">    :param X: è¾“å…¥çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">    :param Y: è¾“å…¥çš„ç±»åˆ«å‘é‡</span></span><br><span class="line"><span class="string">    :param iterations: è¿­ä»£æ¬¡æ•°(å…¶å®å°±æ˜¯epoch)</span></span><br><span class="line"><span class="string">    :param learning_rate: å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">    :return: æœ€ä¼˜åŒ–çš„å‚æ•°w,b,ä»¥åŠcostsï¼ˆcostså¯æœ‰å¯æ— ï¼Œå–å†³äºä½ æ˜¯å¦æƒ³çœ‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„costçš„å˜åŒ–ï¼‰</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    costs = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> iter <span class="keyword">in</span> range(iterations):</span><br><span class="line">        grads, cost = propagation(w, b, X, Y)</span><br><span class="line"></span><br><span class="line">        dw = grads[<span class="string">"dw"</span>]</span><br><span class="line">        db = grads[<span class="string">"db"</span>]</span><br><span class="line"></span><br><span class="line">        w = w - learning_rate * dw</span><br><span class="line">        b = b - learning_rate * db</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¯100æ¬¡epochæ‰“å°ä¸€æ¬¡ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> (iter % <span class="number">100</span> == <span class="number">0</span>):</span><br><span class="line">            costs.append(cost)</span><br><span class="line">            print(<span class="string">f"the current iteration is <span class="subst">&#123;iter&#125;</span>,the current cost is <span class="subst">&#123;cost&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">        params = &#123;<span class="string">"w"</span>: w, <span class="string">"b"</span>: b&#125;</span><br><span class="line">        grads = &#123;<span class="string">"dw"</span>: dw, <span class="string">"db"</span>: db&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> params, grads, costs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(w, b, X)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    é¢„æµ‹æ–°å®ä¾‹çš„ç±»åˆ«</span></span><br><span class="line"><span class="string">    :param w:æœ€ä¼˜åŒ–çš„å‚æ•°w</span></span><br><span class="line"><span class="string">    :param b:æœ€ä¼˜åŒ–çš„å‚æ•°b</span></span><br><span class="line"><span class="string">    :param X:å®ä¾‹çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">    :return:å®ä¾‹çš„ç±»åˆ«</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    N = X.shape[<span class="number">0</span>]</span><br><span class="line">    prediction = np.zeros((<span class="number">1</span>, N))</span><br><span class="line">    X = X.T</span><br><span class="line">    A = sigmoid(np.dot(w.T, X) + b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        <span class="keyword">if</span> (A[<span class="number">0</span>][i] &lt;= <span class="number">0.5</span>):</span><br><span class="line">            prediction[<span class="number">0</span>][i] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prediction[<span class="number">0</span>][i] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> (prediction.shape == (<span class="number">1</span>, N))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> prediction</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model</span><span class="params">(train_data, train_label, test_data, test_label, iterations, learning_rate)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å°†ä¸Šè¿°å®šä¹‰çš„å‡½æ•°ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯æ•´ä¸ªLRæ¨¡å‹çš„æ‰§è¡Œè¿‡ç¨‹</span></span><br><span class="line"><span class="string">    :param train_data: è®­ç»ƒæ•°æ®é›†</span></span><br><span class="line"><span class="string">    :param train_label: è®­ç»ƒæ•°æ®é›†çš„æ ‡ç­¾</span></span><br><span class="line"><span class="string">    :param test_data: æµ‹è¯•æ•°æ®é›†</span></span><br><span class="line"><span class="string">    :param test_label: æµ‹è¯•æ•°æ®é›†çš„æ ‡ç­¾</span></span><br><span class="line"><span class="string">    :param iterations: è¿­ä»£æ¬¡æ•°(epoch)</span></span><br><span class="line"><span class="string">    :param learning_rate: å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">    :return: åœ¨æµ‹è¯•æ•°æ®é›†ä¸Šçš„å‡†ç¡®ç‡</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    w, b = initialize_params(train_data.shape[<span class="number">1</span>])</span><br><span class="line">    params, grads, costs = optimization(w, b, train_data, train_label, iterations, learning_rate)</span><br><span class="line"></span><br><span class="line">    w = params[<span class="string">"w"</span>]</span><br><span class="line">    b = params[<span class="string">"b"</span>]</span><br><span class="line"></span><br><span class="line">    prediction = predict(w, b, test_data)</span><br><span class="line">    error = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(prediction.shape[<span class="number">1</span>]):</span><br><span class="line">        <span class="keyword">if</span> (prediction[<span class="number">0</span>][i] != test_label[<span class="number">0</span>][i]):</span><br><span class="line">            error += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    accuracy = (prediction.shape[<span class="number">1</span>] - error) / prediction.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    d = &#123;<span class="string">"w"</span>: w, <span class="string">"b"</span>: b, <span class="string">"costs"</span>: costs&#125;</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start load data."</span>)</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    d = model(train_data, train_label, test_data, test_label, iterations=<span class="number">200</span>, learning_rate=<span class="number">0.7</span>)</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure><h3 id="logisticå›å½’æ¨¡å‹sckit-learnå®ç°"><a href="#logisticå›å½’æ¨¡å‹sckit-learnå®ç°" class="headerlink" title="logisticå›å½’æ¨¡å‹sckit-learnå®ç°"></a>logisticå›å½’æ¨¡å‹sckit-learnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2020-1-2</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.8707.</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š89.82440423965454.</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> linear_model</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName:æ•°æ®è·¯å¾„å</span></span><br><span class="line"><span class="string">    :return: ç‰¹å¾å‘é‡çŸ©é˜µã€è¿˜æœ‰æ ‡ç­¾çŸ©é˜µ</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list = []</span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            <span class="keyword">if</span> (int(curline[<span class="number">0</span>]) &gt;= <span class="number">5</span>):</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">0</span>)</span><br><span class="line">            data_list.append([int(feature) / <span class="number">255</span> <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start load data."</span>)</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../Mnistdata/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é»˜è®¤è¿­ä»£æ¬¡æ•°ä¸º100,ä½¿ç”¨çš„ç®—æ³•æ˜¯lbfgsï¼Œä½¿ç”¨L2æ­£åˆ™åŒ–ã€‚è¿™é‡Œè¦åŠ å¤§è¿­ä»£æ¬¡æ•°ï¼Œè¦ä¸ç„¶çš„åŒ–ï¼Œä¸ä¼šæ”¶æ•›ã€‚</span></span><br><span class="line">    clf = linear_model.LogisticRegression(max_iter=<span class="number">1000</span>)</span><br><span class="line">    clf.fit(train_data, train_label)</span><br><span class="line"></span><br><span class="line">    accuracy = clf.score(test_data, test_label)</span><br><span class="line">    print(<span class="string">f"the  accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure><h3 id="æœ€å¤§ç†µæ¨¡å‹çš„å®ç°-1"><a href="#æœ€å¤§ç†µæ¨¡å‹çš„å®ç°-1" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹çš„å®ç°"></a>æœ€å¤§ç†µæ¨¡å‹çš„å®ç°</h3><p><strong>æ­¤å®ç°å€Ÿç”¨äºpkudodoçš„å®ç°ï¼Œå› ä¸ºå®åœ¨æ˜¯å†™çš„å¤ªå¥½äº†ï¼</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="comment">#Author:codewithzichao</span></span><br><span class="line"><span class="comment">#Date:2020-1-2</span></span><br><span class="line"><span class="comment">#E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist</span></span><br><span class="line"><span class="string">è®­ç»ƒé›†æ•°é‡ï¼š60000(å®é™…ä½¿ç”¨:20000)</span></span><br><span class="line"><span class="string">æµ‹è¯•é›†æ•°é‡ï¼š10000</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName:æ•°æ®è·¯å¾„å</span></span><br><span class="line"><span class="string">    :return: ç‰¹å¾å‘é‡çŸ©é˜µã€è¿˜æœ‰æ ‡ç­¾çŸ©é˜µ</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list = [];label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            <span class="keyword">if</span> (int(curline[<span class="number">0</span>]) &gt;= <span class="number">5</span>):</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">0</span>)</span><br><span class="line">            data_list.append([int(int(feature)&gt;<span class="number">128</span>)  <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">maxEnt</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    æœ€å¤§ç†µç±»</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, trainDataList, trainLabelList, testDataList, testLabelList)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        å„å‚æ•°åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.trainDataList = trainDataList          <span class="comment">#è®­ç»ƒæ•°æ®é›†</span></span><br><span class="line">        self.trainLabelList = trainLabelList        <span class="comment">#è®­ç»ƒæ ‡ç­¾é›†</span></span><br><span class="line">        self.testDataList = testDataList            <span class="comment">#æµ‹è¯•æ•°æ®é›†</span></span><br><span class="line">        self.testLabelList = testLabelList          <span class="comment">#æµ‹è¯•æ ‡ç­¾é›†</span></span><br><span class="line">        self.featureNum = len(trainDataList[<span class="number">0</span>])     <span class="comment">#ç‰¹å¾æ•°é‡</span></span><br><span class="line"></span><br><span class="line">        self.N = len(trainDataList)                 <span class="comment">#æ€»è®­ç»ƒé›†é•¿åº¦</span></span><br><span class="line">        self.n = <span class="number">0</span>                                  <span class="comment">#è®­ç»ƒé›†ä¸­ï¼ˆxiï¼Œyï¼‰å¯¹æ•°é‡</span></span><br><span class="line">        self.M = <span class="number">10000</span>                              <span class="comment">#</span></span><br><span class="line">        self.fixy = self.calc_fixy()                <span class="comment">#æ‰€æœ‰(x, y)å¯¹å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">        self.w = [<span class="number">0</span>] * self.n                       <span class="comment">#Pw(y|x)ä¸­çš„w</span></span><br><span class="line">        self.xy2idDict, self.id2xyDict = self.createSearchDict()        <span class="comment">#(x, y)-&gt;idå’Œid-&gt;(x, y)çš„æœç´¢å­—å…¸</span></span><br><span class="line">        self.Ep_xy = self.calcEp_xy()               <span class="comment">#Ep_xyæœŸæœ›å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcEpxy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—ç‰¹å¾å‡½æ•°f(x, y)å…³äºæ¨¡å‹P(Y|X)ä¸ç»éªŒåˆ†å¸ƒP_(X, Y)çš„æœŸæœ›å€¼ï¼ˆPåå¸¦ä¸‹åˆ’çº¿â€œ_â€è¡¨ç¤ºPä¸Šæ–¹çš„æ¨ªçº¿</span></span><br><span class="line"><span class="string">        ç¨‹åºä¸­éƒ¨åˆ†ä¸‹åˆ’çº¿è¡¨ç¤ºâ€œ|â€ï¼Œéƒ¨åˆ†è¡¨ç¤ºä¸Šæ–¹æ¨ªçº¿ï¼Œè¯·æ ¹æ®å…·ä½“å…¬å¼è‡ªè¡Œåˆ¤æ–­,ï¼‰</span></span><br><span class="line"><span class="string">        å³â€œ6.2.2 æœ€å¤§ç†µæ¨¡å‹çš„å®šä¹‰â€ä¸­ç¬¬äºŒä¸ªæœŸæœ›ï¼ˆ83é¡µæœ€ä¸Šæ–¹çš„æœŸæœ›ï¼‰</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        Epxy = [<span class="number">0</span>] * self.n</span><br><span class="line">        <span class="comment">#å¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬è¿›è¡Œéå†</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.N):</span><br><span class="line">            <span class="comment">#åˆå§‹åŒ–å…¬å¼ä¸­çš„P(y|x)åˆ—è¡¨</span></span><br><span class="line">            Pwxy = [<span class="number">0</span>] * <span class="number">2</span></span><br><span class="line">            <span class="comment">#è®¡ç®—P(y = 0 &#125; X)</span></span><br><span class="line">            <span class="comment">#æ³¨ï¼šç¨‹åºä¸­Xè¡¨ç¤ºæ˜¯ä¸€ä¸ªæ ·æœ¬çš„å…¨éƒ¨ç‰¹å¾ï¼Œxè¡¨ç¤ºå•ä¸ªç‰¹å¾ï¼Œè¿™é‡Œæ˜¯å…¨éƒ¨ç‰¹å¾çš„ä¸€ä¸ªæ ·æœ¬</span></span><br><span class="line">            Pwxy[<span class="number">0</span>] = self.calcPwy_x(self.trainDataList[i], <span class="number">0</span>)</span><br><span class="line">            <span class="comment">#è®¡ç®—P(y = 1 &#125; X)</span></span><br><span class="line">            Pwxy[<span class="number">1</span>] = self.calcPwy_x(self.trainDataList[i], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> feature <span class="keyword">in</span> range(self.featureNum):</span><br><span class="line">                <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                    <span class="keyword">if</span> (self.trainDataList[i][feature], y) <span class="keyword">in</span> self.fixy[feature]:</span><br><span class="line">                        id = self.xy2idDict[feature][(self.trainDataList[i][feature], y)]</span><br><span class="line">                        Epxy[id] += (<span class="number">1</span> / self.N) * Pwxy[y]</span><br><span class="line">        <span class="keyword">return</span> Epxy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcEp_xy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—ç‰¹å¾å‡½æ•°f(x, y)å…³äºç»éªŒåˆ†å¸ƒP_(x, y)çš„æœŸæœ›å€¼ï¼ˆä¸‹åˆ’çº¿è¡¨ç¤ºPä¸Šæ–¹çš„æ¨ªçº¿ï¼Œ</span></span><br><span class="line"><span class="string">        åŒç†Ep_xyä¸­çš„â€œ_â€ä¹Ÿè¡¨ç¤ºpä¸Šæ–¹çš„æ¨ªçº¿ï¼‰</span></span><br><span class="line"><span class="string">        å³â€œ6.2.2 æœ€å¤§ç†µçš„å®šä¹‰â€ä¸­ç¬¬ä¸€ä¸ªæœŸæœ›ï¼ˆ82é¡µæœ€ä¸‹æ–¹é‚£ä¸ªå¼å­ï¼‰</span></span><br><span class="line"><span class="string">        :return: è®¡ç®—å¾—åˆ°çš„Ep_xy</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment">#åˆå§‹åŒ–Ep_xyåˆ—è¡¨ï¼Œé•¿åº¦ä¸ºn</span></span><br><span class="line">        Ep_xy = [<span class="number">0</span>] * self.n</span><br><span class="line"></span><br><span class="line">        <span class="comment">#éå†æ¯ä¸€ä¸ªç‰¹å¾</span></span><br><span class="line">        <span class="keyword">for</span> feature <span class="keyword">in</span> range(self.featureNum):</span><br><span class="line">            <span class="comment">#éå†æ¯ä¸ªç‰¹å¾ä¸­çš„(x, y)å¯¹</span></span><br><span class="line">            <span class="keyword">for</span> (x, y) <span class="keyword">in</span> self.fixy[feature]:</span><br><span class="line">                <span class="comment">#è·å¾—å…¶id</span></span><br><span class="line">                id = self.xy2idDict[feature][(x, y)]</span><br><span class="line">                <span class="comment">#å°†è®¡ç®—å¾—åˆ°çš„Ep_xyå†™å…¥å¯¹åº”çš„ä½ç½®ä¸­</span></span><br><span class="line">                <span class="comment">#fixyä¸­å­˜æ”¾æ‰€æœ‰å¯¹åœ¨è®­ç»ƒé›†ä¸­å‡ºç°è¿‡çš„æ¬¡æ•°ï¼Œå¤„äºè®­ç»ƒé›†æ€»é•¿åº¦Nå°±æ˜¯æ¦‚ç‡äº†</span></span><br><span class="line">                Ep_xy[id] = self.fixy[feature][(x, y)] / self.N</span><br><span class="line"></span><br><span class="line">        <span class="comment">#è¿”å›æœŸæœ›</span></span><br><span class="line">        <span class="keyword">return</span> Ep_xy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createSearchDict</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åˆ›å»ºæŸ¥è¯¢å­—å…¸</span></span><br><span class="line"><span class="string">        xy2idDictï¼šé€šè¿‡(x,y)å¯¹æ‰¾åˆ°å…¶id,æ‰€æœ‰å‡ºç°è¿‡çš„xyå¯¹éƒ½æœ‰ä¸€ä¸ªid</span></span><br><span class="line"><span class="string">        id2xyDictï¼šé€šè¿‡idæ‰¾åˆ°å¯¹åº”çš„(x,y)å¯¹</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment">#è®¾ç½®xyæœå¤šidå­—å…¸</span></span><br><span class="line">        <span class="comment">#è¿™é‡Œçš„xæŒ‡çš„æ˜¯å•ä¸ªçš„ç‰¹å¾ï¼Œè€Œä¸æ˜¯æŸä¸ªæ ·æœ¬ï¼Œå› æ­¤å°†ç‰¹å¾å­˜å…¥å­—å…¸æ—¶ä¹Ÿéœ€è¦å­˜å…¥è¿™æ˜¯ç¬¬å‡ ä¸ªç‰¹å¾</span></span><br><span class="line">        <span class="comment">#è¿™ä¸€ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸ºäº†åç»­çš„æ–¹ä¾¿ï¼Œå¦åˆ™ä¼šä¹±å¥—ã€‚</span></span><br><span class="line">        <span class="comment">#æ¯”å¦‚è¯´ä¸€ä¸ªæ ·æœ¬X = (0, 1, 1) label =(1)</span></span><br><span class="line">        <span class="comment">#ç”Ÿæˆçš„æ ‡ç­¾å¯¹æœ‰(0, 1), (1, 1), (1, 1)ï¼Œä¸‰ä¸ª(xï¼Œy)å¯¹å¹¶ä¸èƒ½åˆ¤æ–­å±äºå“ªä¸ªç‰¹å¾çš„ï¼Œåç»­å°±æ²¡æ³•å¾€ä¸‹å†™</span></span><br><span class="line">        <span class="comment">#ä¸å¯èƒ½é€šè¿‡(1, 1)å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„idï¼Œå› ä¸ºå¯¹äº(1, 1),å­—å…¸ä¸­æœ‰å¤šé‡æ˜ å°„</span></span><br><span class="line">        <span class="comment">#æ‰€ä»¥åœ¨ç”Ÿæˆå­—å…¸çš„æ—¶æ€»å…±ç”Ÿæˆäº†ç‰¹å¾æ•°ä¸ªå­—å…¸ï¼Œä¾‹å¦‚åœ¨mnistä¸­æ ·æœ¬æœ‰784ç»´ç‰¹å¾ï¼Œæ‰€ä»¥ç”Ÿæˆ784ä¸ªå­—å…¸ï¼Œå±äº</span></span><br><span class="line">        <span class="comment">#ä¸åŒç‰¹å¾çš„xyå­˜å…¥ä¸åŒç‰¹å¾å†…çš„å­—å…¸ä¸­ï¼Œä½¿å…¶ä¸ä¼šæ··æ·†</span></span><br><span class="line">        xy2idDict = [&#123;&#125; <span class="keyword">for</span> i <span class="keyword">in</span> range(self.featureNum)]</span><br><span class="line">        <span class="comment">#åˆå§‹åŒ–idåˆ°xyå¯¹çš„å­—å…¸ã€‚å› ä¸ºidä¸(xï¼Œy)çš„æŒ‡å‘æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå­—å…¸</span></span><br><span class="line">        id2xyDict = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#è®¾ç½®ç¼©å½±ï¼Œå…¶å®å°±æ˜¯æœ€åçš„id</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="comment">#å¯¹ç‰¹å¾è¿›è¡Œéå†</span></span><br><span class="line">        <span class="keyword">for</span> feature <span class="keyword">in</span> range(self.featureNum):</span><br><span class="line">            <span class="comment">#å¯¹å‡ºç°è¿‡çš„æ¯ä¸€ä¸ª(x, y)å¯¹è¿›è¡Œéå†</span></span><br><span class="line">            <span class="comment">#fixyï¼šå†…éƒ¨å­˜æ”¾ç‰¹å¾æ•°ç›®ä¸ªå­—å…¸ï¼Œå¯¹äºéå†çš„æ¯ä¸€ä¸ªç‰¹å¾ï¼Œå•ç‹¬è¯»å–å¯¹åº”å­—å…¸å†…çš„(x, y)å¯¹</span></span><br><span class="line">            <span class="keyword">for</span> (x, y) <span class="keyword">in</span> self.fixy[feature]:</span><br><span class="line">                <span class="comment">#å°†è¯¥(x, y)å¯¹å­˜å…¥å­—å…¸ä¸­ï¼Œè¦æ³¨æ„å­˜å…¥æ—¶é€šè¿‡[feature]æŒ‡å®šäº†å­˜å…¥å“ªä¸ªç‰¹å¾å†…éƒ¨çš„å­—å…¸</span></span><br><span class="line">                <span class="comment">#åŒæ—¶å°†indexä½œä¸ºè¯¥å¯¹çš„idå·</span></span><br><span class="line">                xy2idDict[feature][(x, y)] = index</span><br><span class="line">                <span class="comment">#åŒæ—¶åœ¨id-&gt;xyå­—å…¸ä¸­å†™å…¥idå·ï¼Œvalä¸º(x, y)å¯¹</span></span><br><span class="line">                id2xyDict[index] = (x, y)</span><br><span class="line">                <span class="comment">#idåŠ ä¸€</span></span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#è¿”å›åˆ›å»ºçš„ä¸¤ä¸ªå­—å…¸</span></span><br><span class="line">        <span class="keyword">return</span> xy2idDict, id2xyDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calc_fixy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—(x, y)åœ¨è®­ç»ƒé›†ä¸­å‡ºç°è¿‡çš„æ¬¡æ•°</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment">#å»ºç«‹ç‰¹å¾æ•°ç›®ä¸ªå­—å…¸ï¼Œå±äºä¸åŒç‰¹å¾çš„(x, y)å¯¹å­˜å…¥ä¸åŒçš„å­—å…¸ä¸­ï¼Œä¿è¯ä¸è¢«æ··æ·†</span></span><br><span class="line">        fixyDict = [defaultdict(int) <span class="keyword">for</span> i <span class="keyword">in</span> range(self.featureNum)]</span><br><span class="line">        <span class="comment">#éå†è®­ç»ƒé›†ä¸­æ‰€æœ‰æ ·æœ¬</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(self.trainDataList)):</span><br><span class="line">            <span class="comment">#éå†æ ·æœ¬ä¸­æ‰€æœ‰ç‰¹å¾</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.featureNum):</span><br><span class="line">                <span class="comment">#å°†å‡ºç°è¿‡çš„(x, y)å¯¹æ”¾å…¥å­—å…¸ä¸­å¹¶è®¡æ•°å€¼åŠ 1</span></span><br><span class="line">                fixyDict[j][(self.trainDataList[i][j], self.trainLabelList[i])] += <span class="number">1</span></span><br><span class="line">        <span class="comment">#å¯¹æ•´ä¸ªå¤§å­—å…¸è¿›è¡Œè®¡æ•°ï¼Œåˆ¤æ–­å»é‡åè¿˜æœ‰å¤šå°‘(x, y)å¯¹ï¼Œå†™å…¥n</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> fixyDict:</span><br><span class="line">            self.n += len(i)</span><br><span class="line">        <span class="comment">#è¿”å›å¤§å­—å…¸</span></span><br><span class="line">        <span class="keyword">return</span> fixyDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcPwy_x</span><span class="params">(self, X, y)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—â€œ6.23 æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ â€ å¼6.22</span></span><br><span class="line"><span class="string">        :param X: è¦è®¡ç®—çš„æ ·æœ¬Xï¼ˆä¸€ä¸ªåŒ…å«å…¨éƒ¨ç‰¹å¾çš„æ ·æœ¬ï¼‰</span></span><br><span class="line"><span class="string">        :param y: è¯¥æ ·æœ¬çš„æ ‡ç­¾</span></span><br><span class="line"><span class="string">        :return: è®¡ç®—å¾—åˆ°çš„Pw(Y|X)</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment">#åˆ†å­</span></span><br><span class="line">        numerator = <span class="number">0</span></span><br><span class="line">        <span class="comment">#åˆ†æ¯</span></span><br><span class="line">        Z = <span class="number">0</span></span><br><span class="line">        <span class="comment">#å¯¹æ¯ä¸ªç‰¹å¾è¿›è¡Œéå†</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.featureNum):</span><br><span class="line">            <span class="comment">#å¦‚æœè¯¥(xi,y)å¯¹åœ¨è®­ç»ƒé›†ä¸­å‡ºç°è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (X[i], y) <span class="keyword">in</span> self.xy2idDict[i]:</span><br><span class="line">                <span class="comment">#åœ¨xy-&gt;idå­—å…¸ä¸­æŒ‡å®šå½“å‰ç‰¹å¾iï¼Œä»¥åŠ(x, y)å¯¹ï¼š(X[i], y)ï¼Œè¯»å–å…¶id</span></span><br><span class="line">                index = self.xy2idDict[i][(X[i], y)]</span><br><span class="line">                <span class="comment">#åˆ†å­æ˜¯wiå’Œfi(xï¼Œy)çš„è¿ä¹˜å†æ±‚å’Œï¼Œæœ€åæŒ‡æ•°</span></span><br><span class="line">                <span class="comment">#ç”±äºå½“(x, y)å­˜åœ¨æ—¶fi(xï¼Œy)ä¸º1ï¼Œå› ä¸ºxyå¯¹è‚¯å®šå­˜åœ¨ï¼Œæ‰€ä»¥ç›´æ¥å°±æ˜¯1</span></span><br><span class="line">                <span class="comment">#å¯¹äºåˆ†å­æ¥è¯´ï¼Œå°±æ˜¯nä¸ªwiç´¯åŠ ï¼Œæœ€åå†æŒ‡æ•°å°±å¯ä»¥äº†</span></span><br><span class="line">                <span class="comment">#å› ä¸ºæœ‰nä¸ªwï¼Œæ‰€ä»¥é€šè¿‡idå°†wä¸xyç»‘å®šï¼Œå‰æ–‡çš„ä¸¤ä¸ªæœç´¢å­—å…¸ä¸­çš„idå°±æ˜¯ç”¨åœ¨è¿™é‡Œ</span></span><br><span class="line">                numerator += self.w[index]</span><br><span class="line">            <span class="comment">#åŒæ—¶è®¡ç®—å…¶ä»–ä¸€ç§æ ‡ç­¾yæ—¶å€™çš„åˆ†å­ï¼Œä¸‹é¢çš„zå¹¶ä¸æ˜¯å…¨éƒ¨çš„åˆ†æ¯ï¼Œå†åŠ ä¸Šä¸Šå¼çš„åˆ†å­ä»¥å</span></span><br><span class="line">            <span class="comment">#æ‰æ˜¯å®Œæ•´çš„åˆ†æ¯ï¼Œå³z = z + numerator</span></span><br><span class="line">            <span class="keyword">if</span> (X[i], <span class="number">1</span>-y) <span class="keyword">in</span> self.xy2idDict[i]:</span><br><span class="line">                <span class="comment">#åŸç†ä¸ä¸Šå¼ç›¸åŒ</span></span><br><span class="line">                index = self.xy2idDict[i][(X[i], <span class="number">1</span>-y)]</span><br><span class="line">                Z += self.w[index]</span><br><span class="line">        <span class="comment">#è®¡ç®—åˆ†å­çš„æŒ‡æ•°</span></span><br><span class="line">        numerator = np.exp(numerator)</span><br><span class="line">        <span class="comment">#è®¡ç®—åˆ†æ¯çš„z</span></span><br><span class="line">        Z = np.exp(Z) + numerator</span><br><span class="line">        <span class="comment">#è¿”å›Pw(y|x)</span></span><br><span class="line">        <span class="keyword">return</span> numerator / Z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxEntropyTrain</span><span class="params">(self, iter = <span class="number">500</span>)</span>:</span></span><br><span class="line">        <span class="comment">#è®¾ç½®è¿­ä»£æ¬¡æ•°å¯»æ‰¾æœ€ä¼˜è§£</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(iter):</span><br><span class="line">            <span class="comment">#å•æ¬¡è¿­ä»£èµ·å§‹æ—¶é—´ç‚¹</span></span><br><span class="line">            iterStart = time.time()</span><br><span class="line"></span><br><span class="line">            <span class="comment">#è®¡ç®—â€œ6.2.3 æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ â€ä¸­çš„ç¬¬äºŒä¸ªæœŸæœ›ï¼ˆ83é¡µæœ€ä¸Šæ–¹å“ªä¸ªï¼‰</span></span><br><span class="line">            Epxy = self.calcEpxy()</span><br><span class="line"></span><br><span class="line">            <span class="comment">#ä½¿ç”¨çš„æ˜¯IISï¼Œæ‰€ä»¥è®¾ç½®sigmaåˆ—è¡¨</span></span><br><span class="line">            sigmaList = [<span class="number">0</span>] * self.n</span><br><span class="line">            <span class="comment">#å¯¹äºæ‰€æœ‰çš„nè¿›è¡Œä¸€æ¬¡éå†</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.n):</span><br><span class="line">                <span class="comment">#ä¾æ®â€œ6.3.1 æ”¹è¿›çš„è¿­ä»£å°ºåº¦æ³•â€ å¼6.34è®¡ç®—</span></span><br><span class="line">                sigmaList[j] = (<span class="number">1</span> / self.M) * np.log(self.Ep_xy[j] / Epxy[j])</span><br><span class="line"></span><br><span class="line">            <span class="comment">#æŒ‰ç…§ç®—æ³•6.1æ­¥éª¤äºŒä¸­çš„ï¼ˆbï¼‰æ›´æ–°w</span></span><br><span class="line">            self.w = [self.w[i] + sigmaList[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n)]</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å•æ¬¡è¿­ä»£ç»“æŸ</span></span><br><span class="line">            iterEnd = time.time()</span><br><span class="line">            <span class="comment">#æ‰“å°è¿è¡Œæ—¶é•¿ä¿¡æ¯</span></span><br><span class="line">            print(<span class="string">'iter:%d:%d, time:%d'</span>%(i, iter, iterStart - iterEnd))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        é¢„æµ‹æ ‡ç­¾</span></span><br><span class="line"><span class="string">        :param X:è¦é¢„æµ‹çš„æ ·æœ¬</span></span><br><span class="line"><span class="string">        :return: é¢„æµ‹å€¼</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment">#å› ä¸ºyåªæœ‰0å’Œ1ï¼Œæ‰€æœ‰å»ºç«‹ä¸¤ä¸ªé•¿åº¦çš„æ¦‚ç‡åˆ—è¡¨</span></span><br><span class="line">        result = [<span class="number">0</span>] * <span class="number">2</span></span><br><span class="line">        <span class="comment">#å¾ªç¯è®¡ç®—ä¸¤ä¸ªæ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="comment">#è®¡ç®—æ ·æœ¬xçš„æ ‡ç­¾ä¸ºiçš„æ¦‚ç‡</span></span><br><span class="line">            result[i] = self.calcPwy_x(X, i)</span><br><span class="line">        <span class="comment">#è¿”å›æ ‡ç­¾</span></span><br><span class="line">        <span class="comment">#max(result)ï¼šæ‰¾åˆ°resultä¸­æœ€å¤§çš„é‚£ä¸ªæ¦‚ç‡å€¼</span></span><br><span class="line">        <span class="comment">#result.index(max(result))ï¼šé€šè¿‡æœ€å¤§çš„é‚£ä¸ªæ¦‚ç‡å€¼å†æ‰¾åˆ°å…¶ç´¢å¼•ï¼Œç´¢å¼•æ˜¯0å°±è¿”å›0ï¼Œ1å°±è¿”å›1</span></span><br><span class="line">        <span class="keyword">return</span> result.index(max(result))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        å¯¹æµ‹è¯•é›†è¿›è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="comment">#é”™è¯¯å€¼è®¡æ•°</span></span><br><span class="line">        errorCnt = <span class="number">0</span></span><br><span class="line">        <span class="comment">#å¯¹æµ‹è¯•é›†ä¸­æ‰€æœ‰æ ·æœ¬è¿›è¡Œéå†</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(self.testDataList)):</span><br><span class="line">            <span class="comment">#é¢„æµ‹è¯¥æ ·æœ¬å¯¹åº”çš„æ ‡ç­¾</span></span><br><span class="line">            result = self.predict(self.testDataList[i])</span><br><span class="line">            <span class="comment">#å¦‚æœé”™è¯¯ï¼Œè®¡æ•°å€¼åŠ 1</span></span><br><span class="line">            <span class="keyword">if</span> result != self.testLabelList[i]:   errorCnt += <span class="number">1</span></span><br><span class="line">        <span class="comment">#è¿”å›å‡†ç¡®ç‡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> - errorCnt / len(self.testDataList)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–è®­ç»ƒé›†åŠæ ‡ç­¾</span></span><br><span class="line">    print(<span class="string">'start read transSet'</span>)</span><br><span class="line">    trainData, trainLabel = loadData(<span class="string">'../Mnist/mnist_train.csv'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–æµ‹è¯•é›†åŠæ ‡ç­¾</span></span><br><span class="line">    print(<span class="string">'start read testSet'</span>)</span><br><span class="line">    testData, testLabel = loadData(<span class="string">'../Mnist/mnist_test.csv'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#åˆå§‹åŒ–æœ€å¤§ç†µç±»</span></span><br><span class="line">    maxEnt = maxEnt(trainData[:<span class="number">20000</span>], trainLabel[:<span class="number">20000</span>], testData, testLabel)</span><br><span class="line"></span><br><span class="line">    maxEnt.maxEntropyTrain()</span><br><span class="line"></span><br><span class="line">    accuracy = maxEnt.test()</span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°æ—¶é—´</span></span><br><span class="line">    print(<span class="string">'time span:'</span>, time.time() - start)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> Logistic Regression </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> MaxEntropy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|æœ´ç´ è´å¶æ–¯æ¨¡å‹è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/18/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/18/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ´ç´ è´å¶æ–¯æ¨¡å‹(naive bayes)å±äºåˆ†ç±»æ¨¡å‹ï¼Œä¹Ÿæ˜¯æœ€ä¸ºç®€å•çš„æ¦‚ç‡å›¾æ¨¡å‹ï¼Œå¯¹äºä¹‹åç†è§£HMMã€CRFç­‰æ¨¡å‹ï¼Œå¤§æœ‰è£¨ç›Šã€‚æœ¬ç¯‡åšå®¢å°†å¯¹æœ´ç´ è´å¶æ–¯æ¨¡å‹çš„åŸç†è¿›è¡Œè¯¦ç»†çš„è®²è§£ï¼Œå¹¶é‡‡ç”¨çº¯pythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“å®ç°ï¼Œè¿™ä¸¤ç§æ–¹å¼å¯¹æœ´ç´ è´å¶æ–¯æ¨¡å‹è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="æœ´ç´ è´å¶æ–¯æ¨¡å‹æ¦‚è¿°"><a href="#æœ´ç´ è´å¶æ–¯æ¨¡å‹æ¦‚è¿°" class="headerlink" title="æœ´ç´ è´å¶æ–¯æ¨¡å‹æ¦‚è¿°"></a>æœ´ç´ è´å¶æ–¯æ¨¡å‹æ¦‚è¿°</h2><p>åœ¨æœ´ç´ è´å¶æ–¯ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡æ˜¯ï¼šç»™å®šå®ä¾‹çš„ç‰¹å¾å‘é‡$X=x$ï¼Œæ±‚å¾—å®ä¾‹çš„ç±»åˆ«æ ‡ç­¾$Y$ï¼Œå³<strong>æ±‚ä»¤$ P(Y=c_k|X) $å€¼æœ€å¤§çš„ç±»åˆ«æ ‡ç­¾$c_k$ã€‚</strong>é‚£ä¹ˆæ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬ä¼šé€šè¿‡æ±‚<strong>å…ˆéªŒæ¦‚ç‡</strong>$P(Y)$ä¸<strong>æ¡ä»¶æ¦‚ç‡</strong>$P(X|Y)$ï¼Œå¾—åˆ°è”åˆæ¦‚ç‡åˆ†å¸ƒ(ä¹Ÿå°±æ˜¯è¯´æœ´ç´ è´å¶æ–¯æ¨¡å‹å±äºç”Ÿæˆæ¨¡å‹)ï¼Œæœ€åæ ¹æ®<strong>è´å¶æ–¯å®šç†</strong>æ±‚å¾—$P(Y|X)$ï¼Œä»ä¸­é€‰æ‹©$P(Y=c_k|X)$çš„å€¼æœ€å¤§çš„ç±»åˆ«æ ‡ç­¾$c_k$ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±ç»“æŸäº†ã€‚å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿè¿™ä¸ªè¿‡ç¨‹çš„è¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰å‡ ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š<strong>1.å…ˆéªŒæ¦‚ç‡$P(Y)$ä¸æ¡ä»¶æ¦‚ç‡$P(X|Y)$æ€ä¹ˆæ±‚å‡ºçš„ï¼Ÿ 2. å¦‚æœå®ä¾‹çš„ç‰¹å¾å‘é‡ç‰¹åˆ«å¤šçš„è¯ï¼Œä¼šé€ æˆè®¡ç®—é‡ç‰¹åˆ«å¤§ï¼Œæ€ä¹ˆè§£å†³çš„ï¼Ÿ</strong>ä¸‹é¢æˆ‘ä»¬å°†ä¸€ä¸€ä»‹ç»ã€‚</p><h2 id="æœ´ç´ è´å¶æ–¯çš„ä¸¤å¤§å‰ææ¡ä»¶"><a href="#æœ´ç´ è´å¶æ–¯çš„ä¸¤å¤§å‰ææ¡ä»¶" class="headerlink" title="æœ´ç´ è´å¶æ–¯çš„ä¸¤å¤§å‰ææ¡ä»¶"></a>æœ´ç´ è´å¶æ–¯çš„ä¸¤å¤§å‰ææ¡ä»¶</h2><p><strong>è´å¶æ–¯å®šç†</strong>ã€‚è´å¶æ–¯å®šç†ï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥ç‰¹åˆ«ç†Ÿæ‚‰ã€‚å‡è®¾$X$æ˜¯ç‰¹å¾å‘é‡ï¼Œ$Y$æ˜¯ç±»åˆ«æ ‡ç­¾ï¼Œæœ‰$K$ç§å–å€¼ï¼Œæˆ‘ä»¬è¦é€šè¿‡$X$æ¥é¢„æµ‹$Y$ã€‚é‚£ä¹ˆå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(Y|X)=\frac {P(X|Y)P(Y)}{P(X)}.</script><p>å…¶ä¸­ï¼Œ$P(Y)$å«åšå…ˆéªŒæ¦‚ç‡ï¼Œ$P(X|Y)$å«åšæ¡ä»¶æ¦‚ç‡ï¼Œ$P(Y|X)$å«åšåéªŒæ¦‚ç‡ã€‚</p><p><strong>æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾</strong>ã€‚å‡è®¾æ¯ä¸ªå®ä¾‹ç‰¹å¾å‘é‡æœ‰$n$ç»´çš„è¯ï¼Œç¬¬$j$ä¸ªç‰¹å¾æœ‰$S_j$ä¸ªå–å€¼ã€‚æˆ‘ä»¬å‡è®¾ç‰¹å¾ä¹‹é—´éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆæœ‰</p><script type="math/tex; mode=display">P(X=x|Y=c_k)=\prod _{i=1}^{n}P(X^{(i)}=x^{(i)}|Y=c_k)</script><p>æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾æ˜¯éå¸¸å¼ºçš„å‡è®¾ï¼Œä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†ç®€åŒ–è¿ç®—ï¼Œå®é™…ä¸Šï¼Œç‰¹å¾ä¹‹é—´åº”è¯¥æ˜¯æœ‰å…³ç³»çš„æ‰æ›´åˆç†ä¸€äº›ã€‚è€Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå‡è®¾çš„è¯ï¼Œé‚£ä¹ˆä¸Šå¼çš„å‚æ•°å®é™…æœ‰:$K\prod_{j=1}^{n}S_j$ï¼Œå½“ç‰¹å¾ç»´åº¦ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªå‚æ•°é‡æ˜¯éå¸¸å¤§çš„ã€‚å½“é‡‡ç”¨äº†è¿™ä¸ªå‡è®¾ä¹‹åï¼Œå‚æ•°é‡å°±å˜ä¸ºï¼š$K\sum_{j=1}^{n}S_j$ï¼Œè¿™æ ·å°±å°å¾ˆå¤šã€‚å¦‚æœé‡‡ç”¨æ¦‚ç‡å›¾æ¥è¡¨ç¤ºçš„è¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/02/18/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpeg" style="zoom: 25%;"></p><p>æˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šç»™å®š$Y=c_k$ï¼Œä¸¤ä¸ªç‰¹å¾ä¹‹é—´ï¼Œç”±äºè¢«$Y$ç»™é˜»æ–­äº†ï¼Œæ‰€ä»¥å½¼æ­¤ç‹¬ç«‹ã€‚</p><p>é‚£ä¹ˆï¼Œæ ¹æ®ä¸Šé¢ä¸¤å¤§å‰ææ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æœ´ç´ è´å¶æ–¯æ¨¡å‹ã€‚å®é™…ä¸Šæˆ‘ä»¬å°±æ˜¯è¦æœ€å¤§åŒ–åéªŒæ¦‚ç‡ï¼Œä»è€Œå¾—åˆ°ç±»åˆ«æ ‡ç­¾ã€‚å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(Y=c_k|X=x)=\frac {P(X=x|Y=c_k)P(Y=c_k)}{P(X=x)}=\frac {P(Y=c_k)\prod_{j=1}^{n}P(X=x^{(i)}|Y=c_k)}{P(X=x)}</script><p>ç”±äº$P(X=x)$å¯¹äºæ‰€æœ‰çš„ç±»åˆ«æ ‡ç­¾æ¥è¯´çš„è¯ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥å»æ‰ï¼Œæœ€ç»ˆå¾—åˆ°çš„å…¬å¼å¦‚ä¸‹:</p><script type="math/tex; mode=display">y=argmax_{c_k}P(Y=c_k){\prod_{j=1}^{n}P(X=x^{(i)}|Y=c_k)}</script><p>è¿™å°±æ˜¯æœ´ç´ è´å¶æ–¯å…¬å¼ï¼Œæ˜¯ä¸æ˜¯éå¸¸ç®€å•ï½</p><h2 id="å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡çš„è®¡ç®—"><a href="#å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡çš„è®¡ç®—" class="headerlink" title="å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡çš„è®¡ç®—"></a>å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡çš„è®¡ç®—</h2><p>å½“å¾—åˆ°äº†æœ´ç´ è´å¶æ–¯çš„å…¬å¼åï¼Œé‚£ä¹ˆå…¶ä¸­çš„$P(Y=c_k)$ä¸$P(X=x|Y=c_k)$æ€ä¹ˆæ±‚å‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åˆ†æƒ…å†µè®¨è®ºï¼šå¾—çœ‹ç‰¹å¾æœ¬èº«æ˜¯ç¦»æ•£çš„è¿˜æ˜¯è¿ç»­çš„ã€‚å½“ç‰¹å¾æ˜¯ç¦»æ•£çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Œå«åš<strong>å¤šé¡¹å¼æ¨¡å‹</strong>ï¼›å½“ç‰¹å¾æ˜¯è¿ç»­çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®©å…¶æ»¡è¶³é«˜æ–¯åˆ†å¸ƒï¼Œå«åš<strong>é«˜æ–¯æ¨¡å‹</strong>ã€‚ä¸‹é¢å°±ä¸€ä¸€ä»‹ç»ã€‚</p><h3 id="å¤šé¡¹å¼æ¨¡å‹"><a href="#å¤šé¡¹å¼æ¨¡å‹" class="headerlink" title="å¤šé¡¹å¼æ¨¡å‹"></a>å¤šé¡¹å¼æ¨¡å‹</h3><p>å½“ç‰¹å¾æ˜¯ç¦»æ•£çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å»å¾—åˆ°å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡ã€‚ï¼ˆå…¬å¼å¤ªéš¾æ•²äº†ï¼Œæˆ‘å°±ç›´æ¥è´´å›¾äº†ğŸ˜­å›¾ç‰‡æ¥æºï¼šã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ï¼‰</p><p><img src="/2020/02/18/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1.jpg" style="zoom: 50%;"></p><p>ä½†æ˜¯ï¼Œåœ¨è®¡ç®—å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šåšä¸€äº›å¹³æ»‘å¤„ç†ï¼Œä»¥é˜²å‡ºç°ä¸º0çš„æƒ…å†µï¼Œä»è€Œå½±å“åˆ°åéªŒæ¦‚ç‡çš„è®¡ç®—ã€‚è¿™ç§æ“ä½œå«åšlaplaceå¹³æ»‘ã€‚ï¼ˆå›¾ç‰‡æ¥æºï¼šã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ï¼‰</p><p><img src="/2020/02/18/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.jpg" style="zoom:50%;"></p><h3 id="é«˜æ–¯æ¨¡å‹"><a href="#é«˜æ–¯æ¨¡å‹" class="headerlink" title="é«˜æ–¯æ¨¡å‹"></a>é«˜æ–¯æ¨¡å‹</h3><p>å½“ç‰¹å¾ä¸ºè¿ç»­å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸èƒ½é‡‡å–å¤šé¡¹å¼æ¨¡å‹æ¥ä¼°è®¡å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡äº†ï¼Œå› ä¸ºä¼šå¯¼è‡´å¾ˆå¤š$P(X=x_i|Y=c_k)$ç­‰äº0ã€‚æ‰€ä»¥éœ€è¦é‡‡ç”¨é«˜æ–¯æ¨¡å‹ã€‚é«˜æ–¯æ¨¡å‹çš„æ€æƒ³æ˜¯ï¼š<strong>è®©ç‰¹å¾çš„æ¯ä¸€ç»´éƒ½æ»¡è¶³é«˜æ–¯åˆ†å¸ƒ(æ­£æ€åˆ†å¸ƒ)ï¼Œä»è€Œæ¥å¤„ç†è¿ç»­ç‰¹å¾</strong>ã€‚æ³¨æ„ï¼Œå…ˆéªŒæ¦‚ç‡çš„è®¡ç®—ä¸å¤šé¡¹å¼æ¨¡å‹ç›¸åŒã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P(X^{(j)}=a|Y=c_k)=\frac {1}{\sqrt {2\pi \sigma^{2}_{c_k,j}}}e^{-\frac {({a-\mu_{c_k,j}})^2}{2\sigma^{2}_{c_k,j}}}</script><p>å…¶ä¸­ï¼Œ$\sigma^{2}_{c_k,j}$è¡¨ç¤ºç±»åˆ«æ˜¯$c_k$çš„å®ä¾‹ä¸­ï¼Œç¬¬$j$ç»´ç‰¹å¾çš„æ–¹å·®ï¼Œ$\mu_{c_k,j}$è¡¨ç¤ºç±»åˆ«æ˜¯$c_k$çš„å®ä¾‹ä¸­ï¼Œç¬¬$j$ç»´ç‰¹å¾çš„å‡å€¼ã€‚</p><p>å½“æ±‚å‡ºå…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡ä¹‹åï¼Œå†å¸¦å…¥åˆ°æœ´ç´ è´å¶æ–¯å…¬å¼ä¸­ï¼Œå°±å¯ä»¥å¾—åˆ°å®ä¾‹çš„ç±»åˆ«æ ‡ç­¾äº†ã€‚åˆ°æ­¤ï¼Œæœ´ç´ è´å¶æ–¯çš„ç†è®ºéƒ¨åˆ†å°±è®²å®Œå•¦ï¼Œç›¸è¾ƒäºHMMã€CRFç­‰æ¨¡å‹ï¼ŒçœŸçš„å¯ä»¥è¯´æ˜¯éå¸¸ç®€å•äº†ğŸ‰ï½</p><h2 id="æœ´ç´ è´å¶æ–¯æ¨¡å‹çš„å®ç°"><a href="#æœ´ç´ è´å¶æ–¯æ¨¡å‹çš„å®ç°" class="headerlink" title="æœ´ç´ è´å¶æ–¯æ¨¡å‹çš„å®ç°"></a>æœ´ç´ è´å¶æ–¯æ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°æœ´ç´ è´å¶æ–¯æ¨¡å‹ï¼šçº¯pythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹è½½åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"><span class="comment"># Date:2019-12-30</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.8433</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š130.05937218666077</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy  <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    data_list = []</span><br><span class="line">    label_list = []</span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            label_list.append(int(curline[<span class="number">0</span>]))</span><br><span class="line">            data_list.append([int(int(feature) &gt; <span class="number">128</span>) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])  <span class="comment"># äºŒå€¼åŒ–ï¼Œä¿è¯æ¯ä¸€ä¸ªç‰¹å¾åªèƒ½å–åˆ°0å’Œ1ä¸¤ä¸ªå€¼</span></span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Naive_Bayes</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, train_data, train_label)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="string">        :param train_data:è®­ç»ƒé›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param train_label: è®­ç»ƒé›†çš„ç±»åˆ«æ ‡ç­¾</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.train_data = train_data</span><br><span class="line">        self.train_label = train_label</span><br><span class="line">        self.input_num, self.feature_num = self.train_data.shape  <span class="comment"># input_numã€feature_numè¡¨ç¤ºè®­ç»ƒé›†æ•°ç›®ã€ç‰¹å¾æ•°ç›®</span></span><br><span class="line">        self.classes_num = self.count_classes()</span><br><span class="line">        self.p_y, self.p_x_y = self.get_probabilities()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count_classes</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—ç±»åˆ«æ•°ç›®</span></span><br><span class="line"><span class="string">        :return:ç±»åˆ«æ•°</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        s = set()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.train_label:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> s:</span><br><span class="line">                s.add(i)</span><br><span class="line">        <span class="keyword">return</span> len(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_probabilities</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡</span></span><br><span class="line"><span class="string">        :return: è¿”å›å…ˆéªŒæ¦‚ç‡ä¸æ¡ä»¶æ¦‚ç‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        print(<span class="string">"start training"</span>)</span><br><span class="line">        p_y = np.zeros(self.classes_num)</span><br><span class="line">        p_x_y = np.zeros((self.classes_num, self.input_num, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—å…ˆéªŒæ¦‚ç‡p_y</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.classes_num):</span><br><span class="line">            p_y[i] = (np.sum((self.train_label == i)) + <span class="number">1</span>) / (self.input_num + self.classes_num)</span><br><span class="line">        p_y = np.log(p_y)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—æ¡ä»¶æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.input_num):</span><br><span class="line">            label = self.train_label[i]</span><br><span class="line">            x = self.train_data[i]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.feature_num):</span><br><span class="line">                p_x_y[label][j][x[j]] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.classes_num):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.feature_num):</span><br><span class="line">                p_x_y_0 = p_x_y[i][j][<span class="number">0</span>]</span><br><span class="line">                p_x_y_1 = p_x_y[i][j][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">                p_x_y[i][j][<span class="number">0</span>] = np.log((p_x_y_0 + <span class="number">1</span>) / (p_x_y_0 + p_x_y_1 + <span class="number">2</span>))</span><br><span class="line">                p_x_y[i][j][<span class="number">1</span>] = np.log((p_x_y_1 + <span class="number">1</span>) / (p_x_y_0 + p_x_y_1 + <span class="number">2</span>))</span><br><span class="line">        print(<span class="string">"finished training."</span>)</span><br><span class="line">        <span class="keyword">return</span> p_y, p_x_y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">naive_bayes_predict</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        é¢„æµ‹å•ä¸ªå®ä¾‹xçš„ç±»åˆ«æ ‡ç­¾</span></span><br><span class="line"><span class="string">        :param x: ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :return: xçš„ç±»åˆ«æ ‡ç­¾</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        p = np.zeros(self.classes_num)</span><br><span class="line">        p_y, p_x_y = self.p_y, self.p_x_y</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.classes_num):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.feature_num):</span><br><span class="line">                p[i] += p_x_y[i][j][x[j]]</span><br><span class="line">            p[i] += p_y[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> np.argmax(p)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_model</span><span class="params">(self, test_train, test_label)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åœ¨æ•´ä¸ªæµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹</span></span><br><span class="line"><span class="string">        :param test_train: æµ‹è¯•é›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param test_label: æµ‹è¯•é›†çš„ç±»åˆ«æ ‡ç­¾</span></span><br><span class="line"><span class="string">        :return: å‡†ç¡®ç‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        print(<span class="string">"start testing"</span>)</span><br><span class="line">        error = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(test_label)):</span><br><span class="line">            <span class="keyword">if</span> (self.naive_bayes_predict(test_train[i]) != test_label[i]):</span><br><span class="line">                error += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        accuarcy = (len(test_label) - error) / (len(test_label))</span><br><span class="line">        print(<span class="string">"finished testing."</span>)</span><br><span class="line">        <span class="keyword">return</span> accuarcy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start loading data."</span>)</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    a = Naive_Bayes(train_data, train_label)</span><br><span class="line">    accuracy = a.test_model(test_data, test_label)</span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure><h3 id="sckit-learnå®ç°"><a href="#sckit-learnå®ç°" class="headerlink" title="sckit-learnå®ç°"></a>sckit-learnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"><span class="comment"># Date:2019-12-30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    data_list = []</span><br><span class="line">    label_list = []</span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            label_list.append(int(curline[<span class="number">0</span>]))</span><br><span class="line">            data_list.append([int(int(feature) &gt; <span class="number">128</span>) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])  <span class="comment"># äºŒå€¼åŒ–ï¼Œä¿è¯æ¯ä¸€ä¸ªç‰¹å¾åªèƒ½å–åˆ°0å’Œ1ä¸¤ä¸ªå€¼</span></span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start loading data."</span>)</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line"></span><br><span class="line">    clf=MultinomialNB()</span><br><span class="line">    clf.fit(train_data,train_label)</span><br><span class="line"></span><br><span class="line">    accuracy=clf.score(test_data,test_label)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    test_predict=clf.predict(test_data)</span><br><span class="line">    print(classification_report(test_label, test_predict))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> naive bayes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|æ”¯æŒå‘é‡æœºæ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>æ”¯æŒå‘é‡æœº(SVM)æ˜¯ä¸€ç§äºŒç±»åˆ†ç±»æ¨¡å‹ï¼Œå±äºç›‘ç£å­¦ä¹ ï¼Œèƒ½å¤Ÿç”¨æ¥è§£å†³æ•°æ®çº¿æ€§ä¸å¯åˆ†çš„é—®é¢˜ï¼Œæ˜¯å¯¹æ„ŸçŸ¥æœºæ¨¡å‹çš„è¡¥å……å’Œæ‰©å±•ã€‚æœ¬ç¯‡åšå®¢å°†å¯¹SVMçš„ä¸‰ç§æƒ…å½¢è¿›è¡Œè¯¦ç»†åœ°è®²è§£ï¼Œå¹¶é‡‡ç”¨çº¯pythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“å®ç°ï¼Œè¿™ä¸¤ç§æ–¹å¼å¯¹æ„ŸçŸ¥æœºæ¨¡å‹è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="æ”¯æŒå‘é‡æœºæ¨¡å‹æ¦‚è¿°"><a href="#æ”¯æŒå‘é‡æœºæ¨¡å‹æ¦‚è¿°" class="headerlink" title="æ”¯æŒå‘é‡æœºæ¨¡å‹æ¦‚è¿°"></a>æ”¯æŒå‘é‡æœºæ¨¡å‹æ¦‚è¿°</h2><p>æ”¯æŒå‘é‡æœºæ¨¡å‹æœ¬èº«æ˜¯ä¸€ç§äºŒç±»åˆ†ç±»æ¨¡å‹ï¼Œå½“ç„¶ç›®å‰å·²ç»æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä»è€Œä½¿å¾—SVMå®ç°å¤šåˆ†ç±»ã€‚SVMå¯ä»¥å±äºç¡¬åˆ†ç±»æ¨¡å‹ï¼Œå®ƒæ‰“ç ´äº†æ„ŸçŸ¥æœºè®­ç»ƒæ•°æ®é›†çº¿æ€§å¯åˆ†çš„å‡è®¾ï¼Œä»è€Œèƒ½å¤Ÿå¤„ç†è®­ç»ƒæ•°æ®é›†çº¿æ€§ä¸å¯åˆ†çš„æƒ…å†µã€‚SVMæœ‰ä¸‰ç§æƒ…å½¢ï¼š<strong>è®­ç»ƒæ•°æ®é›†çº¿æ€§å¯åˆ†ã€è®­ç»ƒæ•°æ®é›†è¿‘ä¼¼çº¿æ€§å¯åˆ†ã€è®­ç»ƒæ•°æ®é›†çº¿æ€§ä¸å¯åˆ†</strong>ã€‚å½“è®­ç»ƒæ•°æ®é›†çº¿æ€§å¯åˆ†æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¡¬é—´éš”æœ€å¤§åŒ–ç­–ç•¥ï¼Œè®­ç»ƒä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œç§°ä¸º<strong>çº¿æ€§å¯åˆ†SVM</strong>ï¼›å½“è®­ç»ƒæ•°æ®é›†è¿‘ä¼¼çº¿æ€§å¯åˆ†æ—¶ï¼ˆä¸¥æ ¼æ¥è¯´å°±æ˜¯çº¿æ€§ä¸å¯åˆ†ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨è½¯é—´éš”æœ€å¤§åŒ–ç­–ç•¥ï¼Œè®­ç»ƒä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œç§°ä¸º<strong>çº¿æ€§SVM</strong>ï¼›å½“è®­ç»ƒæ•°æ®é›†çº¿æ€§ä¸å¯åˆ†æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ¸æŠ€å·§+è½¯é—´éš”æœ€å¤§åŒ–ç­–ç•¥ï¼Œè®­ç»ƒä¸€ä¸ªéçº¿æ€§åˆ†ç±»å™¨ï¼Œ ç§°ä¸º<strong>éçº¿æ€§SVMæˆ–kernel SVM</strong>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€æ­¥è®²è§£è¿™ä¸‰ç§æƒ…å†µï¼Œä¾ç„¶ä»<strong>æ¨¡å‹ã€ç­–ç•¥ã€ç®—æ³•</strong>çš„è§’åº¦ï¼Œæ¥è¿›è¡Œè®²è§£ã€‚</p><h2 id="çº¿æ€§å¯åˆ†SVM"><a href="#çº¿æ€§å¯åˆ†SVM" class="headerlink" title="çº¿æ€§å¯åˆ†SVM"></a>çº¿æ€§å¯åˆ†SVM</h2><p>å½“è®­ç»ƒæ•°æ®é›†æ—¶çº¿æ€§å¯åˆ†æ—¶ï¼Œè®­ç»ƒå‡ºæ¥çš„åˆ†ç±»å™¨ã€‚æˆ‘ä»¬ç§°ä¸ºçº¿æ€§å¯åˆ†SVMã€‚</p><h3 id="çº¿æ€§å¯åˆ†SVMæ¨¡å‹"><a href="#çº¿æ€§å¯åˆ†SVMæ¨¡å‹" class="headerlink" title="çº¿æ€§å¯åˆ†SVMæ¨¡å‹"></a>çº¿æ€§å¯åˆ†SVMæ¨¡å‹</h3><p>çº¿æ€§å¯åˆ†SVMæ¨¡å‹å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">y=f(x)=sign(wx+b),</script><script type="math/tex; mode=display">sign(z)=\begin{cases}+1,& \text{x>=0}\\-1,& \text{x<0}\end{cases}.</script><p>å…¶ä¸­ï¼Œ$x$æ˜¯æ¨¡å‹è¾“å…¥ï¼Œ$y$æ˜¯æ¨¡å‹è¾“å‡ºï¼Œå¹¶ä¸”$x\in R^nï¼Œy\in  \{1,-1\}$ï¼›$wï¼Œb$æ˜¯æ¨¡å‹å‚æ•°ï¼Œå¹¶ä¸”$w\in R^nï¼Œb\in R$ã€‚çœ‹åˆ°è¿™ä¸ªæ¨¡å‹ï¼Œæ˜¯ä¸æ˜¯éå¸¸ç†Ÿæ‚‰ï¼Ÿå¯¹ï¼Œå°±æ˜¯ä¹‹å‰è®²è¿‡çš„æ„ŸçŸ¥æœºæ¨¡å‹(perceptron)ï¼å®é™…ä¸Šï¼Œæˆ‘ä»¬å°±æ˜¯è¦æ‰¾ä¸€ä¸ªåˆ†ç¦»è¶…å¹³é¢ï¼Œå°†æ•°æ®é›†ä¸­çš„æ­£ä¾‹ä¸è´Ÿä¾‹å®Œå…¨åˆ†å¼€ã€‚ä½†æ˜¯åœ¨æ„ŸçŸ¥æœºä¸­ï¼Œåˆ†ç¦»è¶…å¹³é¢ä¸å”¯ä¸€ã€‚é‚£ä¹ˆï¼Œåˆ°åº•å“ªä¸ªè¶…å¹³é¢æ‰æ˜¯æœ€ä¼˜çš„å‘¢ï¼Ÿåœ¨SVMä¸­ï¼Œå°±æ˜¯è¦æ‰¾åˆ°æœ€ä¼˜çš„è¶…å¹³é¢ã€‚</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.jpg" alt></p><p>é‚£ä¹ˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºè¢«æ¨¡å‹åˆ†ç±»çš„ç‚¹ï¼Œæˆ‘ä»¬å…³æ³¨ä¸¤ä¸ªæ–¹é¢ï¼šæ¨¡å‹åˆ†ç±»çš„ç¡®ä¿¡ç¨‹åº¦ï¼Œæ¨¡å‹åˆ†ç±»æ˜¯å¦æ­£ç¡®ã€‚å¯¹äºæ¨¡å‹åˆ†ç±»çš„ç¡®å®šç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‚¹åˆ°å¹³é¢çš„è·ç¦»æ¥è¡¨ç¤ºï¼›å¯¹äºæ¨¡å‹æ˜¯å¦åˆ†ç±»æ­£ç¡®ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡å‹çš„é¢„æµ‹å€¼ä¸è¯¥å®ä¾‹æœ¬èº«çš„ç±»åˆ«æ ‡å·æ˜¯å¦ä¸€è‡´æ¥è¡¨ç¤ºã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨$y_i(wx_i+b)$æ¥è¡¨ç¤ºæ¨¡å‹çš„æ­£ç¡®æ€§ä¸ç¡®ä¿¡ç¨‹åº¦ï¼Œè¿™å°±æ˜¯å‡½æ•°é—´éš”ã€‚ä½†æ˜¯ï¼Œåªæœ‰å‡½æ•°é—´éš”æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå½“$w,b$å¢å¤§è‹¥å¹²å€çš„æ—¶å€™ï¼Œè¶…å¹³é¢æ²¡å˜ï¼Œä½†æ˜¯å‡½æ•°é—´éš”å´å˜å¤§äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å…¶åŠ ä¸€äº›çº¦æŸï¼Œè¿™å°±æ˜¯å‡ ä½•é—´éš”ã€‚å‡ ä½•é—´éš”è¶Šå¤§ï¼Œé‚£ä¹ˆç‚¹è·ç¦»è¶…å¹³é¢å°±è¶Šè¿œ(è·ç¦»è¶…å¹³é¢è¶Šè¿‘çš„ç‚¹ï¼Œé‚£ä¹ˆè¶Šéš¾è¢«æ­£ç¡®åˆ†ç±»)ï¼Œé‚£ä¹ˆè¯´æ˜è¿™æ ·çš„è¶…å¹³é¢çš„æ³›åŒ–èƒ½åŠ›åº”è¯¥è¶Šå¥½ã€‚æ‰€ä»¥ï¼Œ<strong>çº¿æ€§å¯åˆ†SVMçš„ç­–ç•¥å°±æ˜¯æ‰¾åˆ°èƒ½å¤Ÿæ­£ç¡®åˆ†ç±»å¹¶ä¸”å‡ ä½•é—´éš”æœ€å¤§çš„åˆ†ç¦»è¶…å¹³é¢ã€‚</strong></p><h3 id="çº¿æ€§å¯åˆ†SVMæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥"><a href="#çº¿æ€§å¯åˆ†SVMæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥" class="headerlink" title="çº¿æ€§å¯åˆ†SVMæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥"></a>çº¿æ€§å¯åˆ†SVMæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥</h3><p><strong>åŸå§‹å½¢å¼</strong></p><p>çº¿æ€§å¯åˆ†SVMæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥å«åšæœ€å¤§é—´éš”æ³•ã€‚å°±æ˜¯æ‰¾åˆ°é—´éš”æœ€å¤§çš„åˆ†ç¦»è¶…å¹³é¢ã€‚é‚£ä¹ˆå°±è½¬æ¢ä¸ºä¸‹é¢è¿™ä¸ªæœ€ä¼˜åŒ–é—®é¢˜ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/1..jpg" style="zoom: 50%;"></p><p>å…¶ä¸­ï¼Œ$\gamma$ è¡¨ç¤ºå‡ ä½•é—´éš”ï¼Œæ­¤å¤–ï¼Œå¸¦æœ‰ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼šæ‰€æœ‰çš„ç‚¹åˆ°è¶…å¹³é¢çš„å‡ ä½•é—´éš”éƒ½å¿…é¡»å¤§äºæœ€å°çš„å‡ ä½•é—´éš”ï¼Œè¿™æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚åˆç”±äºå‡ ä½•é—´éš”ä¸å‡½æ•°é—´éš”çš„è½¬æ¢å…³ç³»ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°æœ€ä¼˜åŒ–é—®é¢˜ï¼Œå˜æ¢ä¸€ä¸‹å½¢å¼ï¼Œå¦‚ä¸‹:</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/2.jpg" style="zoom:50%;"></p><p>æˆ‘ä»¬ä»”ç»†åˆ†æä¸€ä¸‹è¿™ä¸ªæœ€ä¼˜åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå‘ç°å‡½æ•°é—´éš”$\hat \gamma$ ä¸å½±å“ç›®æ ‡å‡½æ•°ä¸çº¦æŸæ¡ä»¶ã€‚å› ä¸ºå½“å‡½æ•°é—´éš”$\hat \gamma$ å¢å¤§$\lambda$å€åï¼ŒåŠ$w,b$å‡å¢å¤§$\lambda$å€åï¼Œå°†å…¶å¸¦å…¥ä¸Šè¿°ç›®æ ‡å‡½æ•°ä¸çº¦æŸæ¡ä»¶ï¼Œä¼šå‘ç°æ•´ä¸ªé—®é¢˜å¹¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› ä¸º$\lambda$éƒ½è¢«çº¦æ‰äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸å¦¨å°±è®¾$\lambda=1$ã€‚æ­¤å¤–ï¼Œåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬æ›´åŠ ä¹ æƒ¯æ±‚è§£æœ€å°åŒ–é—®é¢˜ï¼Œé‚£ä¹ˆï¼ŒåŒ–ç®€åå°±æ˜¯æœ€ç»ˆçš„æœ€ä¼˜åŒ–é—®é¢˜ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" style="zoom:50%;"></p><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼š</p><p>è¾“å…¥ï¼šç»™å®šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),(x_3,y_3),â€¦,(x_N,y_N)\}$ï¼Œå…¶ä¸­$x_i\in R^nï¼Œy\in Rï¼Œi=1â€¦N$ã€‚</p><p>è¾“å‡ºï¼šå‚æ•°$wï¼Œb$ï¼Œä»è€Œå¾—åˆ°SVMæ¨¡å‹ä¸åˆ†ç¦»è¶…å¹³é¢ã€‚</p><ul><li>æ„é€ æœ€ä¼˜åŒ–é—®é¢˜ï¼š</li></ul><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/3.jpg" style="zoom:50%;"></p><p>é€šè¿‡æ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜çš„æœ€ä¼˜åŒ–ç®—æ³•ï¼Œæ±‚å¾—$w^{\ast},b^{\ast}$ã€‚</p><ul><li>å°†$w^{\ast},b^{\ast}$ å¸¦å…¥å…¬å¼ä¸­ï¼Œå¾—åˆ°SVMæ¨¡å‹ä¸åˆ†ç¦»è¶…å¹³é¢ã€‚å¦‚ä¸‹ï¼š</li></ul><script type="math/tex; mode=display">f(x)=sign(w^{\ast}x+b^{\ast})ï¼Œw^{\ast}x+b^{\ast}=0.</script><p><strong>å¯¹å¶å½¢å¼</strong></p><p>å¯¹äºå‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚è§£å…¶å¯¹å¶é—®é¢˜ï¼Œä»è€Œæ¥æ±‚åŸå§‹é—®é¢˜çš„è§£ã€‚æˆ‘ä»¬ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼Œæ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼Œå¦‚ä¸‹:</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/4.0.jpg" style="zoom:50%;"></p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦æ±‚çš„å…¬å¼å°±æ˜¯ï¼š$max_{\alpha}min_{w,b}L(w,b,\alpha)$ã€‚æ‰€ä»¥å°±åˆ†ä¸¤æ­¥ï¼šå…ˆæ±‚ä»¤$L(w,b,\alpha)$æœ€å°çš„$w,b$(æ­¤æ—¶çš„$w,b$çš„å€¼æ—¶å¸¦æœ‰æœªçŸ¥å˜é‡$\alpha$çš„ï¼Œè¿˜ä¸æ˜¯æœ€ç»ˆçš„å€¼)ï¼Œå†æ±‚ä»¤ä»¤$L(w,b,\alpha)$æœ€å¤§çš„$\alpha$çš„å€¼ï¼Œæœ€åæ ¹æ®$\alpha$çš„å€¼ï¼Œå¾—å‡º$w,b$æœ€ç»ˆçš„å€¼ã€‚</p><ul><li>å…ˆæ±‚$min_{w,b}L(w,b,\alpha)$ã€‚æˆ‘ä»¬å¯¹$w,b$æ±‚åå¯¼ï¼Œå³ä»¤$\frac {\partial L}{\partial w}=0ï¼Œ\frac {\partial L}{\partial b}=0$ï¼Œå¯ä»¥å¾—åˆ°ä¸‹è¿°å¼å­ï¼š</li></ul><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/4.0.1.jpg" style="zoom: 50%;"></p><p>å°†ä¸Šè¿°å¼å­å¸¦å…¥åˆ°æœ€åˆçš„æ‹‰æ ¼æœ—æ—¥å‡½æ•°ä¸­ï¼Œå¹¶åŒ–ç®€å¾—åˆ°å¦‚ä¸‹å…¬å¼ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/4.jpg" style="zoom:50%;"></p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/5.jpg" alt></p><ul><li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ±‚$max_{\alpha}min_{w,b}L(w,b,\alpha)$ã€‚</li></ul><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/6.jpg" style="zoom:50%;"></p><p>ç”±äºå…¶æ»¡è¶³KKTæ¡ä»¶ï¼Œæ‰€è°“KKTæ¡ä»¶å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/7.jpeg" alt></p><p>æˆ‘ä»¬ä¼šæ ¹æ®KKTæ¡ä»¶ï¼Œå°¤å…¶æ˜¯äº’è¡¥æ¾å¼›æ¡ä»¶ï¼Œå¯ä»¥å¾—å‡ºbçš„å€¼ã€‚å‚æ•°$w,b$æœ€ç»ˆçš„å€¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/8.jpg" style="zoom:50%;"></p><p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong></p><p>è¾“å…¥ï¼šç»™å®šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),(x_3,y_3),â€¦,(x_N,y_N)\}$ï¼Œå…¶ä¸­$x_i\in R^nï¼Œy\in Rï¼Œi=1â€¦N$ã€‚</p><p>è¾“å‡ºï¼šå‚æ•°$wï¼Œb$ï¼Œä»è€Œå¾—åˆ°SVMæ¨¡å‹ä¸åˆ†ç¦»è¶…å¹³é¢ã€‚</p><ul><li>æ„é€ æœ€ä¼˜åŒ–é—®é¢˜ï¼Œå¹¶æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜ï¼š</li></ul><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/9.jpg" style="zoom:50%;"></p><p>æ±‚å¾—æœ€ä¼˜è§£$\alpha^{\ast}=\{\alpha^{\ast}_{1},\alpha^{\ast}_{2},â€¦,\alpha^{\ast}_{N}\}$ã€‚</p><ul><li>æ ¹æ®$\alpha^{\ast}$ï¼Œè®¡ç®—å¾—åˆ°æœ€ä¼˜å‚æ•°$w^{\ast},b^{\ast}$ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</li></ul><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/8.jpg" style="zoom:50%;"></p><ul><li>å°†å‚æ•°$w^{\ast},b^{\ast}$å¸¦å…¥SVMæ¨¡å‹ä¸è¶…å¹³é¢å…¬å¼ä¸­ï¼Œå°±å¾—åˆ°äº†ç»“æœã€‚</li></ul><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/10.jpg" style="zoom:50%;"></p><h3 id="å­¦ä¹ ç®—æ³•"><a href="#å­¦ä¹ ç®—æ³•" class="headerlink" title="å­¦ä¹ ç®—æ³•"></a>å­¦ä¹ ç®—æ³•</h3><p>å³ä¾¿åœ¨å¯¹å¶å½¢å¼çš„SVMä¸­ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦æ±‚$\alpha^{\ast}$çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é‡‡å–æ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜çš„ç®—æ³•æ±‚è§£ï¼Œåœ¨SVMä¸­ï¼Œæˆ‘ä»¬é‡‡å–çš„æ–¹æ³•å«åšï¼š<strong>åºåˆ—æœ€å°æœ€ä¼˜åŒ–ç®—æ³•(SMO)</strong>ã€‚åé¢ä¼šä»‹ç»ã€‚</p><h2 id="çº¿æ€§SVM"><a href="#çº¿æ€§SVM" class="headerlink" title="çº¿æ€§SVM"></a>çº¿æ€§SVM</h2><p>å½“çº¿æ€§å¯åˆ†ä¸­æ•°æ®é›†æ··å…¥ä¸€äº›å™ªéŸ³(outlier)ï¼Œä¹Ÿå°±æ˜¯åˆ†ç±»ä¸æ­£ç¡®çš„ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæ•´ä¸ªæ•°æ®é›†å°±å˜å¾—çº¿æ€§ä¸å¯åˆ†äº†ï¼›ä½†æ˜¯ç”±äºå™ªéŸ³çš„æ•°é‡è¾ƒå°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜ä¸€ä¸‹çº¿æ€§å¯åˆ†SVMçš„å­¦ä¹ ç­–ç•¥ï¼Œä»è€Œè®­ç»ƒå¤„çº¿æ€§SVMã€‚</p><p><strong>æ³¨æ„ï¼šç”±äºçº¿æ€§å¯åˆ†SVMä¸çº¿æ€§SVMçš„æ¨¡å‹ä¸å¯¹å¶æœ€ä¼˜åŒ–é—®é¢˜çš„åŒ–ç®€æ±‚è§£æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘åªä¼šå°†è®²è§£å…¶ä¸çº¿æ€§å¯åˆ†SVMä¸é€šçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å­¦ä¹ ç­–ç•¥ï¼šè½¯é—´éš”æœ€å¤§åŒ–ã€‚</strong></p><p>æ‰€è°“çš„å™ªéŸ³$(x_i,y_i)$ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„å‡ ä½•é—´éš”ä¸æ»¡è¶³çº¦æŸï¼Œä¹Ÿå°±æ˜¯$y_i(wx_i+b)&lt;1$ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ å…¥ä¸€ä¸ªæ¾å¼›å˜é‡$\varepsilon_i$ï¼Œä½¿å¾—å…¶çº¦æŸæ¡ä»¶å¤§äºæˆ–ç­‰äº1ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç›®æ ‡å‡½æ•°ä¸­åŠ å…¥æƒ©ç½šé¡¹$C$ï¼Œæƒ©ç½šè¢«è¯¯åˆ†ç±»çš„ç‚¹ï¼Œä»è€Œä½¿å¾—å®ä¾‹æ›´éš¾è¢«è¯¯åˆ†ç±»ã€‚å…·ä½“å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/11.jpg" style="zoom:50%;"></p><p>è¿™æ˜¯ä¸€ä¸ªå‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼ŒåŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚å…¶å¯¹å¶æœ€ä¼˜åŒ–é—®é¢˜ï¼Œæ¥æ±‚è§£å‚æ•°$w,bï¼Œä»è€Œå¾—åˆ°SVMæ¨¡å‹ä¸åˆ†ç¦»è¶…å¹³é¢ï¼Œæ­¥éª¤ä¸çº¿æ€§å¯åˆ†SVMæ­¥éª¤ä¸€æ ·(è¿™ä¸ªæ¨å¯¼æ­¥éª¤ï¼Œæœ€å¥½è‡ªå·±æ‰‹æ¨ä¸€éï½)ã€‚æœ€åç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/12.jpg" style="zoom:50%;"></p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/13.jpg" style="zoom:50%;"></p><h2 id="éçº¿æ€§SVM-kernel-SVM"><a href="#éçº¿æ€§SVM-kernel-SVM" class="headerlink" title="éçº¿æ€§SVM / kernel SVM"></a>éçº¿æ€§SVM / kernel SVM</h2><p>å½“çº¿æ€§å¯åˆ†æ•°æ®é›†ä¸­ï¼Œæ··å…¥äº†å¤§é‡çš„å™ªéŸ³ï¼Œå¯¼è‡´æ•´ä¸ªæ•°æ®é›†å®Œå…¨ä¸å¯é€šè¿‡çº¿æ€§æ¨¡å‹æ¥è¿›è¡Œåˆ†ç±»çš„è¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦éçº¿æ€§SVMäº†ã€‚å½“ç„¶ï¼Œåœ¨è¿™ç§SVMä¸­ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå«åš <strong>kernel trick</strong>ã€‚ä¸‹é¢å°±ç®€å•åœ°ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯kernel trickã€‚(å…³äºkernel trickè¯¦ç»†çš„æ•°å­¦è¯æ˜ä¸æ¨å¯¼ï¼Œè¯·å‚çœ‹<strong>ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹æˆ–è€…PRML</strong>ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘åªè®²è§£kernel trickçš„åŸç†ã€‚)</p><h3 id="kernel-trick"><a href="#kernel-trick" class="headerlink" title="kernel trick"></a>kernel trick</h3><p>ç”±äºåœ¨åŸæ¥çš„è¾“å…¥ç©ºé—´ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°çš„åˆ†ç¦»è¶…å¹³é¢æœ€ç»ˆä¼šæ˜¯ä¸€ä¸ªæ›²é¢ï¼Œé‚£ä¹ˆè¿™æ ·çš„éçº¿æ€§æ¨¡å‹æ˜¯ä¸å¥½è®­ç»ƒçš„ã€‚é‚£ä¹ˆä¸€ç§æƒ³æ³•æ˜¯ï¼šå°†åŸæ¥çš„è¾“å…¥ç©ºé—´é€šè¿‡éçº¿æ€§å˜æ¢ï¼Œå°†å…¶æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´ç©ºé—´ï¼Œå°†éçº¿æ€§é—®é¢˜è½¬æ¢ä¸ºçº¿æ€§é—®é¢˜ï¼Œä»è€Œåœ¨æ–°çš„ç‰¹å¾ç©ºé—´ä¸­å­¦ä¹ çº¿æ€§åˆ†ç±»æ¨¡å‹ã€‚(è¿™æ˜¯æœ‰å®šç†ä¿è¯çš„ï¼Œé«˜ç»´æ¯”ä½ç»´æ›´æ˜“çº¿æ€§å¯åˆ†ã€‚)è¿™å…¶å®å°±æ˜¯kernel trickçš„æ€æƒ³ã€‚</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/14.jpg" style="zoom:50%;"></p><p>è¿™ä¸ªå…¬å¼ä¸­ï¼Œ$\phi$æ˜¯éçº¿æ€§æ˜ å°„ï¼Œ$x,z$å‡å±äºåŸæ¥çš„è¾“å…¥ç©ºé—´ï¼Œæ­£å®šæ ¸å‡½æ•°$K(x,z)$æ˜¯å˜æ¢åçš„ç»“æœã€‚é€šè¿‡è¿™ä¸ªå˜æ¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†åŸæ¥è¾“å…¥ç©ºé—´ä¸­çš„å†…ç§¯$x_ix$ï¼Œå˜æ¢åˆ°æ–°çš„ç‰¹å¾ç©ºé—´ä¸­çš„å†…ç§¯$\phi(x_i)\phi(x)$ï¼Œä»è€Œåœ¨æ–°çš„ç‰¹å¾ç©ºé—´ä¸­å­¦ä¹ çº¿æ€§åˆ†ç±»æ¨¡å‹å³å¯ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ ·å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šéçº¿æ€§æ˜ å°„$\phi$æ˜¯éå¸¸éš¾æ±‚çš„ï¼Œæ±‚å®ƒä»¬çš„å†…ç§¯æ›´åŠ éš¾æ±‚ã€‚é‚£ä¹ˆï¼Œåœ¨å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯ç›´æ¥å»$K(x,z)$ï¼Œè€Œä¸é€šè¿‡æ‰¾$\phi$æ¥è®¡ç®—ç»“æœï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†è®¡ç®—é‡ã€‚é‚£ä¹ˆå¦‚æœåˆ¤æ–­ä¸€ä¸ªå‡½æ•°æ˜¯æ­£å®šæ ¸å‡½æ•°(kernel function)å‘¢ï¼Ÿåœ¨è¿™é‡Œæœ‰ä¸€ä¸ªå®šç†ï¼Œå«åš<strong>Mercerå®šç†</strong>ã€‚å®ƒå…¶å®æ˜¯ä»æ ¸å‡½æ•°çš„å®šä¹‰å‡ºå‘çš„(è¿™é‡Œå¯èƒ½å’Œã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹è¡¨è¿°ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ„æ€æ˜¯ä¸€æ ·çš„)ã€‚å¦‚ä¸‹ï¼š</p><p><strong>è®¾$x,z\in\cal X\in R^n$ï¼Œ$\cal X$è¡¨ç¤ºåŸæ¥çš„è¾“å…¥ç©ºé—´ï¼Œå¯¹äºä»»æ„çš„$x,z$ï¼Œå­˜åœ¨å‡½æ•°$K:\cal X *\cal X -&gt;R^p$ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°$K$æ»¡è¶³ä¸¤ä¸ªæ€§è´¨ï¼šå¯¹ç§°æ€§ä¸æ­£å®šæ€§ï¼Œé‚£ä¹ˆå°±è¯´å‡½æ•°$K$æ˜¯æ­£å®šæ ¸å‡½æ•°ã€‚</strong>æ‰€è°“å¯¹ç§°æ€§ï¼Œå°±æ˜¯$K(x,z)=K(z,x)$ã€‚æ‰€è°“æ­£å®šæ€§ï¼Œå°±æ˜¯$K(x,z)$æ‰€å¯¹åº”çš„GramçŸ©é˜µæ˜¯åŠæ­£å®šçš„ï¼ŒåŠæ­£å®šçš„æ„æ€æ˜¯è¯¥çŸ©é˜µçš„ç‰¹å¾å€¼å¤§äºç­‰äº0ã€‚å¯¹ç§°æ€§æ˜¾è€Œæ˜“è§ï¼Œé‚£ä¹ˆåˆ¤æ–­ä¸€ä¸ª<strong>å¯¹ç§°å‡½æ•°æ˜¯ä¸æ˜¯çš„æ­£å®šæ ¸å‡½æ•°çš„å……è¦æ¡ä»¶å°±æ˜¯å…¶æ„æˆçš„GramçŸ©é˜µæ˜¯åŠæ­£å®šçš„</strong>ã€‚å…·ä½“è¯æ˜è¿‡ç¨‹ï¼Œå¯ä»¥å‚çœ‹ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ­£å®šæ ¸å‡½æ•°æ˜¯é«˜æ–¯æ ¸å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/15.jpg" style="zoom:50%;"></p><p>é‚£ä¹ˆï¼Œæ ¹æ®é«˜æ–¯æ ¸å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°SVMæ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯åˆ†ç±»å†³ç­–å‡½æ•°å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/16.jpg" style="zoom:50%;"></p><h2 id="åºåˆ—æœ€å°æœ€ä¼˜åŒ–ç®—æ³•-SMO"><a href="#åºåˆ—æœ€å°æœ€ä¼˜åŒ–ç®—æ³•-SMO" class="headerlink" title="åºåˆ—æœ€å°æœ€ä¼˜åŒ–ç®—æ³•(SMO)"></a>åºåˆ—æœ€å°æœ€ä¼˜åŒ–ç®—æ³•(SMO)</h2><p>è¿™æ˜¯SVMä¸­æœ€åä¸€ä¸ªéƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ç”¨æ¥æ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æ±‚$\alpha$çš„å€¼ï¼Œåªæœ‰æ±‚å‡ºäº†$\alpha$çš„å€¼ï¼Œ$w,b$çš„å€¼æ‰ç®—æ˜¯çœŸæ­£çš„æ±‚å‡ºæ¥ã€‚æˆ‘ä»¬å°†æ ¸å‡½æ•°å¸¦å…¥åˆ°æœ€ä¼˜åŒ–é—®é¢˜å½“ä¸­ï¼Œå¾—åˆ°å¦‚ä¸‹å¼å­ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/17.0.jpg" style="zoom:50%;"></p><p>å…¶å®æœ‰å¾ˆå¤šæœ€ä¼˜åŒ–ç®—æ³•æ¥æ±‚è§£è¿™ä¸ªå‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œåœ¨SVMä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨SMOç®—æ³•æ¥æ±‚è§£ï¼Œå› ä¸ºå½“æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œè¯¥ç®—æ³•ä¹Ÿèƒ½å¾ˆå¥½å¾ˆå¿«åœ°æ±‚è§£ã€‚è¯¥ç®—æ³•çš„æ€æƒ³æ˜¯ï¼šç”±äºKKTæ¡ä»¶æ˜¯æœ€ä¼˜åŒ–é—®é¢˜æœ€ä¼˜è§£çš„å……è¦æ¡ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„å˜é‡$\alpha$éƒ½æ»¡è¶³KKTæ¡ä»¶çš„è¯ï¼Œé‚£ä¹ˆæœ€ä¼˜è§£å°±æ±‚å‡ºæ¥äº†ã€‚å¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸æ–­åœ°å»è°ƒæ•´$\alpha$çš„å€¼ï¼Œç›´åˆ°æ‰€æœ‰çš„$\alpha$éƒ½æ»¡è¶³KKT1æ¡ä»¶ã€‚é‚£ä¹ˆæ€ä¹ˆè°ƒæ•´å‘¢ï¼Ÿæ–¹æ³•æ˜¯ï¼š<strong>æˆ‘ä»¬æ„å»ºå¤šä¸ªåªæœ‰ä¸¤ä¸ªå˜é‡çš„äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œæœ€ç»ˆæ‰¾åˆ°æ‰€æœ‰æœ€ä¼˜çš„$\alpha$çš„å€¼</strong>ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/17.jpeg" style="zoom: 50%;"></p><p>é€šè¿‡ä¸Šè¿°è®¡ç®—ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æœªä¿®å»ºçš„$\alpha_2$ä¸$\alpha_1$çš„å€¼ã€‚ä½†æ˜¯åœ¨å¾—åˆ°è¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è€ƒè™‘çº¦æŸæ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°†çº¦æŸæ¡ä»¶åŠ ä¸Šï¼Œå¾—åˆ°æœ€ç»ˆçš„$\alpha_2$çš„å€¼ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/18.jpeg" style="zoom:50%;"></p><p>é‚£å¾—åˆ°$\alpha_2$çš„åï¼Œå…¶å®$\alpha_1$çš„å°±å¾ˆå®¹æ˜“æ±‚å‡ºæ¥äº†ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/19.jpeg" style="zoom: 33%;"></p><p>ä¹‹åï¼Œæˆ‘ä»¬ä¸æ–­å»é‡å¤è¿™æ ·çš„è¿‡ç¨‹ï¼Œä¾¿å¯å°†æ‰€æœ‰çš„$\alpha$çš„å€¼éƒ½æ±‚å‡ºæ¥ã€‚ä½†æ˜¯ï¼Œé—®é¢˜æ¥äº†ï¼Œ<strong>æˆ‘ä»¬æ¯æ¬¡æ€ä¹ˆå»é€‰æ‹©è¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Ÿ</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“é€‰æ‹©å“ªä¸¤ä¸ªå˜é‡ï¼Œæ‰èƒ½ä½¿å¾—æœ€ä¼˜åŒ–é—®é¢˜èƒ½å¤Ÿæœç€æœ€å°çš„æ–¹å‘èµ°å‘¢ï¼Ÿ</p><p>åœ¨SMOä¸­ï¼Œ<strong>ç¬¬ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è¿åKKTæ¡ä»¶æœ€æ˜æ˜¾çš„å˜é‡ä½œä¸º$\alpha_1$ã€‚</strong>KKTæ¡ä»¶å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95-%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/20.jpg" style="zoom:50%;"></p><p>åœ¨å®é™…æ“ä½œä¸­ï¼Œå¯ä»¥éå†æ‰€æœ‰çš„æ ·æœ¬ç‚¹ï¼Œçœ‹å“ªä¸ªè¿åæœ€ä¸¥é‡ï¼Œä»è€Œå°†è¯¥ç‚¹æœ€ä¸ºç¬¬ä¸€ä¸ªå˜é‡ã€‚</p><p><strong>ç¬¬äºŒä¸ªå˜é‡ï¼Œæ‰¾ä½¿$|E_1-E_2|$çš„å˜é‡</strong>ã€‚$E_i$çš„è®¡ç®—å…¬å¼ï¼Œå‰é¢å·²ç»æåˆ°äº†ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨çš„SVMçš„ç†è®ºéƒ¨åˆ†äº†ï½</p><h2 id="SVMçš„å®ç°"><a href="#SVMçš„å®ç°" class="headerlink" title="SVMçš„å®ç°"></a>SVMçš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°SVMæ¨¡å‹ï¼šçº¯pythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹åœ¨åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="pythonå®ç°"><a href="#pythonå®ç°" class="headerlink" title="pythonå®ç°"></a>pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2019-12-20</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnist(å®é™…åªä½¿ç”¨äº†å‰1000ä¸ªï¼Œå½“ç„¶å¯ä»¥å…¨éƒ¨ä½¿ç”¨ï¼Œå¦‚æœç®—åŠ›å¤Ÿçš„è¯ã€‚)</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.98</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š0.98</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="string">    :param fileName:è·¯å¾„å</span></span><br><span class="line"><span class="string">    :return: è¿”å›ç‰¹å¾å‘é‡ä¸æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">    åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šæœ€åä½¿ç”¨è¦np.arrayï¼Œä»¥ä¿è¯ç»´åº¦ã€‚</span></span><br><span class="line"><span class="string">    å½“ç„¶ä½¿ç”¨np.matç­‰ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç›¸å…³æ“ä½œå®¹æ˜“ææ··ã€‚</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    data_list = []</span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            <span class="keyword">if</span> (int(curline[<span class="number">0</span>]) ==<span class="number">0</span>):</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">-1</span>)</span><br><span class="line">            data_list.append([int(num)/<span class="number">255</span> <span class="keyword">for</span> num <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SVM</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data_matrix, label_matrix, sigma, C, toler, iteration)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="string">        :param data_matrix: è®­ç»ƒæ•°æ®é›†çŸ©é˜µ</span></span><br><span class="line"><span class="string">        :param label_matrix: è®­ç»ƒæ•°æ®æ ‡ç­¾çŸ©é˜µ</span></span><br><span class="line"><span class="string">        :param sigma: é«˜æ–¯æ ¸å‡½æ•°çš„sigma</span></span><br><span class="line"><span class="string">        :param C: æƒ©ç½šå‚æ•°</span></span><br><span class="line"><span class="string">        :param toler: æ¾å¼›å˜é‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        self.train_data = data_matrix</span><br><span class="line">        self.train_label = label_matrix.T</span><br><span class="line">        self.input_num,self.feature_num = np.shape(self.train_data)</span><br><span class="line"></span><br><span class="line">        self.sigma = sigma</span><br><span class="line">        self.C = C</span><br><span class="line">        self.toler = toler</span><br><span class="line">        self.K = self.kernel_for_train()</span><br><span class="line">        self.b = <span class="number">0</span></span><br><span class="line">        self.alpha = np.zeros(self.input_num)</span><br><span class="line">        self.E = np.zeros(self.input_num)</span><br><span class="line">        self.iteration = iteration</span><br><span class="line">        self.support_vector = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kernel_for_train</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—æ ¸å‡½æ•°</span></span><br><span class="line"><span class="string">        ä½¿ç”¨çš„æ˜¯é«˜æ–¯æ ¸ è¯¦è§â€œ7.3.3 å¸¸ç”¨æ ¸å‡½æ•°â€ å¼7.90</span></span><br><span class="line"><span class="string">        :return: é«˜æ–¯æ ¸çŸ©é˜µ</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        k=np.zeros((self.input_num,self.input_num))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.input_num):</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">'construct the kernel:'</span>, i, self.input_num)</span><br><span class="line">            X = self.train_data[i, :]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i, self.input_num):</span><br><span class="line">                Z = self.train_data[j, :]</span><br><span class="line">                result =np.matmul((X - Z) , (X - Z).T)</span><br><span class="line">                result = np.exp(<span class="number">-1</span> * result / (<span class="number">2</span> * self.sigma**<span class="number">2</span>))</span><br><span class="line">                k[i][j] = result</span><br><span class="line">                k[j][i] = result</span><br><span class="line">        <span class="comment">#è¿”å›é«˜æ–¯æ ¸çŸ©é˜µ</span></span><br><span class="line">        <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_satisfied_kkt_condition</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åˆ¤æ–­alpha_iæ˜¯å¦æ»¡è¶³KKTæ¡ä»¶</span></span><br><span class="line"><span class="string">        :param i: ç´¢å¼•ç¬¬iä¸ªalpha</span></span><br><span class="line"><span class="string">        :return: è¿”å›true/false</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        g_xi = self.cal_g_xi(i)</span><br><span class="line">        y_i = self.train_label[i]</span><br><span class="line">        <span class="keyword">if</span> ((abs(self.alpha[i]) &lt; self.toler) <span class="keyword">and</span> (y_i * g_xi &gt;= <span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> (abs(self.alpha[i] - self.C) &lt; self.toler <span class="keyword">and</span> (y_i * g_xi &lt;= <span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> (self.alpha[i] &gt; -self.toler) <span class="keyword">and</span> (self.alpha[i] &lt; (self.C + self.toler)) \</span><br><span class="line">                <span class="keyword">and</span> (abs(y_i * g_xi - <span class="number">1</span>) &lt; self.toler):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_g_xi</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—g_xiï¼Œä»è€Œè¾…åŠ©åˆ¤æ–­å˜é‡æ˜¯ä¸æ˜¯æ»¡è¶³KKTæ¡ä»¶</span></span><br><span class="line"><span class="string">        :return: è¿”å›g_xiçš„å€¼,æ˜¯æ ‡é‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        g_xi = <span class="number">0</span></span><br><span class="line">        index = [i <span class="keyword">for</span> i,alpha <span class="keyword">in</span> enumerate(self.alpha) <span class="keyword">if</span> alpha!=<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> index:</span><br><span class="line">            g_xi += self.alpha[j] * self.train_label[j] * self.K[j][i]</span><br><span class="line">        g_xi += self.b</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> g_xi</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_ei</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—eiçš„å€¼ï¼Œæ ‡é‡</span></span><br><span class="line"><span class="string">        :param i: è¡¨ç¤ºç¬¬iä¸ªæ ·æœ¬ï¼Œi=1ï¼Œ2</span></span><br><span class="line"><span class="string">        :return: è¿”å›Ei</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> self.cal_g_xi(i) - self.train_label[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_alpha_j</span><span class="params">(self, e1, i)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åœ¨SMOä¸­ï¼Œé€‰æ‹©ç¬¬2ä¸ªå˜é‡</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param e1: ç¬¬ä¸€ä¸ªå˜é‡çš„e1</span></span><br><span class="line"><span class="string">        :param i: ç¬¬ä¸€ä¸ªå˜é‡alpha1çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="string">        :return: è¿”å›E2ï¼Œç¬¬äºŒä¸ªéå†å˜é‡çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        e2 = <span class="number">0</span></span><br><span class="line">        max_e1_e2 = <span class="number">-1</span></span><br><span class="line">        max_index = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        none_0_e = [i <span class="keyword">for</span> i, ei <span class="keyword">in</span> enumerate(self.E) <span class="keyword">if</span> ei != <span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> none_0_e:</span><br><span class="line">            <span class="comment"># è®¡ç®—E2</span></span><br><span class="line">            e2_tmp = self.cal_ei(j)</span><br><span class="line">            <span class="comment"># å¦‚æœ|E1-E2|å¤§äºç›®å‰æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">if</span> abs(e1 - e2_tmp) &gt; max_e1_e2:</span><br><span class="line">                <span class="comment"># æ›´æ–°æœ€å¤§å€¼</span></span><br><span class="line">                max_e1_e2 = abs(e1 - e2_tmp)</span><br><span class="line">                <span class="comment"># æ›´æ–°æœ€å¤§å€¼E2</span></span><br><span class="line">                e2 = e2_tmp</span><br><span class="line">                <span class="comment"># æ›´æ–°æœ€å¤§å€¼E2çš„ç´¢å¼•j</span></span><br><span class="line">                max_index = j</span><br><span class="line">        <span class="comment"># å¦‚æœåˆ—è¡¨ä¸­æ²¡æœ‰é0å…ƒç´ äº†ï¼ˆå¯¹åº”ç¨‹åºæœ€å¼€å§‹è¿è¡Œæ—¶çš„æƒ…å†µï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> max_index == <span class="number">-1</span>:</span><br><span class="line">            max_index = i</span><br><span class="line">            <span class="keyword">while</span> max_index == i:</span><br><span class="line">                <span class="comment"># è·å¾—éšæœºæ•°ï¼Œå¦‚æœéšæœºæ•°ä¸ç¬¬ä¸€ä¸ªå˜é‡çš„ä¸‹æ ‡iä¸€è‡´åˆ™é‡æ–°éšæœº</span></span><br><span class="line">                max_index = int(np.random.uniform(<span class="number">0</span>, self.input_num))</span><br><span class="line">            <span class="comment"># è·å¾—E2</span></span><br><span class="line">            e2 = self.cal_ei(max_index)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> e2, max_index</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self)</span>:</span></span><br><span class="line">        cur_iter_step = <span class="number">0</span></span><br><span class="line">        params_changed = <span class="number">1</span></span><br><span class="line">        <span class="comment">#ç»“æŸå¾ªç¯æ¡ä»¶ï¼š1.è¾¾åˆ°å¾ªç¯æ¬¡æ•°ï¼›2.å½“å‚æ•°ä¸å†å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œè¯´æ˜æ”¶æ•›äº†</span></span><br><span class="line">        <span class="keyword">while</span> ((cur_iter_step &lt; self.iteration) <span class="keyword">and</span> (params_changed &gt; <span class="number">0</span>)):</span><br><span class="line">            print(<span class="string">f"the current iteration is <span class="subst">&#123;cur_iter_step&#125;</span>,the total iteration is <span class="subst">&#123;self.iteration&#125;</span>."</span>)</span><br><span class="line">            cur_iter_step += <span class="number">1</span></span><br><span class="line">            params_changed = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(self.input_num):</span><br><span class="line">                <span class="keyword">if</span> (self.is_satisfied_kkt_condition(i) == <span class="literal">False</span>):</span><br><span class="line">                    e1 = self.cal_ei(i)</span><br><span class="line">                    e2, j = self.cal_alpha_j(e1, i)</span><br><span class="line"></span><br><span class="line">                    y1 = self.train_label[i]</span><br><span class="line">                    y2 = self.train_label[j]</span><br><span class="line"></span><br><span class="line">                    alpha_old_1 = self.alpha[i]</span><br><span class="line">                    alpha_old_2 = self.alpha[j]</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (y1 != y2):</span><br><span class="line">                        L = max(<span class="number">0</span>, alpha_old_2 - alpha_old_1)</span><br><span class="line">                        H = min(self.C, self.C - alpha_old_1 + alpha_old_2)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        L = max(<span class="number">0</span>, alpha_old_1 + alpha_old_2 - self.C)</span><br><span class="line">                        H = min(self.C, alpha_old_1 + alpha_old_2)</span><br><span class="line">                    <span class="keyword">if</span> (L == H):</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                    k11 = self.K[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line">                    k22 = self.K[<span class="number">2</span>][<span class="number">2</span>]</span><br><span class="line">                    k12 = self.K[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">                    k21 = self.K[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">                    alpha_new_2 = alpha_old_2 + y2 * (e1 - e2) / (k11 + k22 - <span class="number">2</span> * k12)</span><br><span class="line">                    <span class="keyword">if</span> (alpha_new_2 &lt; L):</span><br><span class="line">                        alpha_new_2 = L</span><br><span class="line">                    <span class="keyword">elif</span> (alpha_new_2 &gt; H):</span><br><span class="line">                        alpha_new_2 = H</span><br><span class="line"></span><br><span class="line">                    alpha_new_1 = alpha_old_1 + y1 * y2 * (alpha_old_2 - alpha_new_2)</span><br><span class="line"></span><br><span class="line">                    b1_new = <span class="number">-1</span> * e1 - y1 * k11 * (alpha_new_1 - alpha_old_1) \</span><br><span class="line">                             - y2 * k21 * (alpha_new_2 - alpha_old_2) + self.b</span><br><span class="line">                    b2_new = <span class="number">-1</span> * e2 - y1 * k12 * (alpha_new_1 - alpha_old_1) \</span><br><span class="line">                             - y2 * k22 * (alpha_new_2 - alpha_old_2) + self.b</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (alpha_new_1 &gt; <span class="number">0</span>) <span class="keyword">and</span> (alpha_new_1 &lt; self.C):</span><br><span class="line">                        b_new = b1_new</span><br><span class="line">                    <span class="keyword">elif</span> (alpha_new_2 &gt; <span class="number">0</span>) <span class="keyword">and</span> (alpha_new_2 &lt; self.C):</span><br><span class="line">                        b_new = b2_new</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        b_new = (b1_new + b2_new) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                    self.alpha[i] = alpha_new_1</span><br><span class="line">                    self.alpha[j] = alpha_new_2</span><br><span class="line">                    self.b = b_new</span><br><span class="line"></span><br><span class="line">                    self.E[i] = self.cal_ei(i)</span><br><span class="line">                    self.E[j] = self.cal_ei(j)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> abs(alpha_new_2 - alpha_old_2) &gt;= <span class="number">0.00001</span>:</span><br><span class="line">                        params_changed += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.input_num):</span><br><span class="line">            <span class="comment"># å¦‚æœÎ±&gt;0ï¼Œè¯´æ˜æ˜¯æ”¯æŒå‘é‡</span></span><br><span class="line">            <span class="keyword">if</span> self.alpha[i] &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># å°†æ”¯æŒå‘é‡çš„ç´¢å¼•ä¿å­˜èµ·æ¥</span></span><br><span class="line">                self.support_vector.append(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kernel_for_predict</span><span class="params">(self, x, z)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        è®¡ç®—æ ¸å‡½æ•°ï¼Œç”¨äºæµ‹è¯•é›†ä¸å¼€å‘é›†</span></span><br><span class="line"><span class="string">        :param x:å‘é‡x</span></span><br><span class="line"><span class="string">        :param z: å‘é‡z</span></span><br><span class="line"><span class="string">        :return: è¿”å›æ ¸å‡½æ•°</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        result = np.matmul((x - z), (x - z).T)</span><br><span class="line">        result = np.exp(-result / (<span class="number">2</span> * self.sigma ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        é¢„æµ‹å•ä¸ªæ ·æœ¬çš„ç±»åˆ«</span></span><br><span class="line"><span class="string">        :param x: æ ·æœ¬çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :return: æ ·æœ¬çš„é¢„æµ‹ç±»åˆ«</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.support_vector:</span><br><span class="line">            result_temp = self.kernel_for_predict(x, self.train_data[i])</span><br><span class="line">            result += self.alpha[i] * self.train_label[i] * result_temp</span><br><span class="line"></span><br><span class="line">        result += self.b</span><br><span class="line">        <span class="keyword">return</span> np.sign(result)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, test_data, test_label)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹</span></span><br><span class="line"><span class="string">        :param test_train:æµ‹è¯•é›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param test_label:æµ‹è¯•é›†çš„ç±»åˆ«</span></span><br><span class="line"><span class="string">        :return:å‡†ç¡®ç‡</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        test_label=test_label.T</span><br><span class="line">        error = <span class="number">0</span></span><br><span class="line">        test_input_num = test_data.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(test_input_num):</span><br><span class="line">            result = self.predict(test_data[i])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (result != test_label[i]):</span><br><span class="line">                error += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (test_input_num - error) / test_input_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line">    svm = SVM(train_data[:<span class="number">1000</span>], train_label[:<span class="number">1000</span>], sigma=<span class="number">10</span>, C=<span class="number">200</span>, toler=<span class="number">0.001</span>,iteration=<span class="number">50</span>)</span><br><span class="line">    svm.train()</span><br><span class="line">    print(<span class="string">"finish the training."</span>)</span><br><span class="line">    accuracy = svm.test(test_data[:<span class="number">100</span>], test_label[:<span class="number">100</span>])</span><br><span class="line">    print(<span class="string">f"accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure><h3 id="scikit-learnå®ç°"><a href="#scikit-learnå®ç°" class="headerlink" title="scikit-learnå®ç°"></a>scikit-learnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2019-12-20</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> svm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    data_list = []</span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            <span class="keyword">if</span> (int(curline[<span class="number">0</span>]) == <span class="number">0</span>):</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">-1</span>)</span><br><span class="line">            data_list.append([int(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    train_data, train_label = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data, test_label = loadData(<span class="string">"../Mnistdata/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line">    <span class="comment">#åˆ›å»ºæ¨¡å‹</span></span><br><span class="line">    clf = svm.SVC()</span><br><span class="line">    <span class="comment">#è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    clf.fit(train_data[:<span class="number">1000</span>], train_label[:<span class="number">1000</span>])</span><br><span class="line">    print(<span class="string">"finished training."</span>)</span><br><span class="line">    <span class="comment">#åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹</span></span><br><span class="line">    accuracy = clf.score(test_data, test_label)</span><br><span class="line">    print(<span class="string">f"the accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> SVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•|æ„ŸçŸ¥æœºæ¨¡å‹åŸç†è¯¦è§£ä¸å®ç°</title>
      <link href="2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%84%9F%E7%9F%A5%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%84%9F%E7%9F%A5%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>æ„ŸçŸ¥æœºæ¨¡å‹(perceptron)å¯ä»¥è¯´æ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€ä¸ºç®€å•çš„æ¨¡å‹ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ä¹‹åçš„ç¥ç»ç½‘ç»œçš„åŸå‹ä¸åŸºç¡€ã€‚æœ¬ç¯‡åšå®¢å°†å¯¹æ„ŸçŸ¥æœºæ¨¡å‹çš„åŸç†è¿›è¡Œè¯¦ç»†çš„è®²è§£ï¼Œå¹¶é‡‡ç”¨çº¯pythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“å®ç°ï¼Œè¿™ä¸¤ç§æ–¹å¼å¯¹æ„ŸçŸ¥æœºæ¨¡å‹è¿›è¡Œå®ç°ã€‚</p><a id="more"></a><h2 id="æ„ŸçŸ¥æœºæ¨¡å‹æ¦‚è¿°"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹æ¦‚è¿°" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹æ¦‚è¿°"></a>æ„ŸçŸ¥æœºæ¨¡å‹æ¦‚è¿°</h2><p>æ„ŸçŸ¥æœºæ¨¡å‹æ˜¯äºŒåˆ†ç±»çš„æ¨¡å‹ï¼Œå±äºç›‘ç£å­¦ä¹ çš„èŒƒç•´ã€‚å½“è¾“å…¥å®ä¾‹çš„ç‰¹å¾å‘é‡åˆ°<strong>æ„ŸçŸ¥æœºæ¨¡å‹</strong>ä¸­åï¼Œæ¨¡å‹èƒ½å¤Ÿè¾“å‡ºå®ä¾‹çš„ç±»åˆ«(1æˆ–è€…-1)ã€‚æ‰€ä»¥ï¼Œæ„ŸçŸ¥æœºçš„æ ¸å¿ƒåœ¨äºæ‰¾åˆ°èƒ½å¤Ÿå®Œå…¨æ­£ç¡®åˆ†ç¦»æ­£ç±»ä¸è´Ÿç±»çš„åˆ†ç¦»è¶…å¹³é¢ã€‚é‚£ä¹ˆï¼Œä¸ºäº†èƒ½å¤Ÿæ±‚å¾—æ­¤åˆ†ç¦»è¶…å¹³é¢ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰<strong>å­¦ä¹ ç­–ç•¥</strong>ã€‚åœ¨æ„ŸçŸ¥æœºä¸­ï¼Œå®šä¹‰äº†è¯¯åˆ†ç±»é©±åŠ¨çš„æŸå¤±å‡½æ•°ï¼Œå¹¶é‡‡ç”¨<strong>éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•</strong>ï¼Œå¯¹æŸå¤±å‡½æ•°è¿›è¡Œæ±‚è§£ã€‚ä¸‹é¢ï¼Œå°†ä»<strong>æ¨¡å‹ã€ç­–ç•¥ã€ç®—æ³•</strong>ä¸‰æ–¹é¢ï¼Œä¾æ­¤å¯¹æ„ŸçŸ¥æœºè¿›è¡Œè¯¦ç»†åœ°è®²è§£ã€‚</p><h2 id="æ„ŸçŸ¥æœºæ¨¡å‹"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹"></a>æ„ŸçŸ¥æœºæ¨¡å‹</h2><p>æ„ŸçŸ¥æœºæ¨¡å‹å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">y=f(x)=sign(wx+b),</script><script type="math/tex; mode=display">sign(z)=\begin{cases}+1,& \text{x>=0}\\-1,& \text{x<0}\end{cases}</script><p>å…¶ä¸­ï¼Œ$x$æ˜¯æ¨¡å‹è¾“å…¥ï¼Œ$y$æ˜¯æ¨¡å‹è¾“å‡ºï¼Œå¹¶ä¸”$x\in R^nï¼Œy\in  \{1,-1\}$ï¼›$wï¼Œb$æ˜¯æ¨¡å‹å‚æ•°ï¼Œå¹¶ä¸”$w\in R^nï¼Œb\in R$ã€‚é‚£ä¹ˆè¯¥æ¨¡å‹æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¯ä»¥åšå¦‚ä¸‹è§£é‡Šï¼š</p><p><img src="/2020/02/17/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%EF%BD%9C%E6%84%9F%E7%9F%A5%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/0.åˆ†ç¦»è¶…å¹³é¢.jpg" alt></p><p>æ„ŸçŸ¥æœºæ¨¡å‹å®é™…ä¸Šæ˜¯åœ¨æ‰¾ä¸€ä¸ªåˆ†ç¦»è¶…å¹³é¢ï¼š$wx+b=0$ï¼Œå®ƒå°†ç‰¹å¾ç©ºé—´åˆ†æˆä¸¤éƒ¨åˆ†ã€‚å½“å®ä¾‹ç±»åˆ«æ˜¯+1çš„æ—¶å€™ï¼Œå®ƒåœ¨è¶…å¹³é¢çš„ä¸Šæ–¹ï¼Œå³ä½¿å¾—$wx+b&gt;0$ï¼›å½“å®ä¾‹ç±»åˆ«æ˜¯-1çš„æ—¶å€™ï¼Œå®ƒåœ¨è¶…å¹³é¢çš„ä¸‹æ–¹ï¼Œå³ä½¿å¾—$wx+b&lt;0$ã€‚é‚£ä¹ˆï¼ŒçŸ¥é“äº†æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬å‘ç°æ„ŸçŸ¥æœºæ¨¡å‹ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼š$w,b$ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°ä¸€ç§å­¦ä¹ ç­–ç•¥æ¥æ±‚è§£è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä»è€Œå¾—åˆ°çœŸæ­£çš„æ„ŸçŸ¥æœºæ¨¡å‹ã€‚</p><h2 id="æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥"></a>æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œæ„ŸçŸ¥æœºçš„è®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œè¦ä¸ç„¶çš„è¯ï¼Œå­¦ä¹ å‡ºæ¥çš„æ„ŸçŸ¥æœºæ¨¡å‹ä¸ä¼šæ”¶æ•›ã€‚é‚£ä»€ä¹ˆæ˜¯çº¿æ€§å¯åˆ†çš„æ•°æ®é›†å‘¢ï¼Ÿå¦‚ä¸‹ï¼š</p><blockquote><p>ç»™å®šæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),(x_3,y_3),â€¦,(x_N,y_N)\}$ï¼Œå…¶ä¸­$x_i\in R^nï¼Œy\in Rï¼Œi=1â€¦N$ã€‚å¦‚æœå­˜åœ¨æŸä¸ªè¶…å¹³é¢$S$ï¼Œèƒ½å¤Ÿå°†$X$ä¸­çš„æ‰€æœ‰æ­£ä¾‹ä¸è´Ÿä¾‹èƒ½å¤Ÿå®Œå…¨åŒºåˆ†å¼€æ¥ï¼Œé‚£ä¹ˆå°±è¯´æ•°æ®é›†$X$æ˜¯çº¿æ€§å¯åˆ†çš„ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œç°åœ¨ç»™å®šçº¿æ€§å¯åˆ†è®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),(x_3,y_3),â€¦,(x_N,y_N)\}$ï¼Œæˆ‘ä»¬è¦ä»ä¸­å­¦ä¹ å‡ºæ„ŸçŸ¥æœºæ¨¡å‹ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„æ˜¯å­¦ä¹ ç­–ç•¥ï¼Œå³æŸå¤±å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆæ ·æ‰èƒ½å¾—åˆ°å‚æ•°$w,b$ã€‚</p><p>å¯¹äºæŸå¤±å‡½æ•°ï¼Œä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼Œå°±æ˜¯ä»¥è¯¯åˆ†ç±»çš„å®ä¾‹çš„æ•°ç›®ä¸ºæ¨¡å‹çš„æŸå¤±å‡½æ•°ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšçš„ä¸€ä¸ªç¼ºé™·åœ¨äºï¼Œè¿™æ ·çš„æŸå¤±å‡½æ•°ä¸æ˜¯$w,b$çš„å¯å¯¼å‡½æ•°ï¼Œä¸æ˜“ä¼˜åŒ–ã€‚æ‰€ä»¥ï¼Œåœ¨æ„ŸçŸ¥æœºä¸­ï¼Œé‡‡å–ä»¥è¯¯åˆ†ç±»å®ä¾‹åˆ°åˆ†ç¦»è¶…å¹³é¢çš„æ€»è·ç¦»ä¸ºæŸå¤±å‡½æ•°ã€‚å¯¹äºè¯¯åˆ†ç±»ç‚¹$(x_i,y_i)$ï¼Œå½“$y_i=1$çš„æ—¶å€™ï¼Œ$wx_i+b<0$ï¼›å½“$y_i=-1$çš„æ—¶å€™ï¼Œ$wx_i+b>0$ã€‚é‚£ä¹ˆæˆ‘ä»¬å°†å…¶ç”¨ä¸€ä¸ªå…¬å¼è¡¨è¾¾ï¼Œå¦‚ä¸‹ï¼š</0$ï¼›å½“$y_i=-1$çš„æ—¶å€™ï¼Œ$wx_i+b></p><script type="math/tex; mode=display">-y_i(wx_i+b)>0</script><p>é‚£ä¹ˆï¼Œå‡è®¾è¯¯åˆ†ç±»é›†åˆä¸º$M$ï¼Œæˆ‘ä»¬æ ¹æ®ç‚¹åˆ°å¹³é¢çš„è·ç¦»å…¬å¼ï¼Œæ‰€æœ‰è¯¯åˆ†ç±»ç‚¹åˆ°åˆ†ç¦»è¶…å¹³é¢çš„æ€»è·ç¦»å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">D=-\sum_{x_i\in M}\frac {y_i(wx_i+b)}{\left \|w\right \|}</script><p>æˆ‘ä»¬ä¸è€ƒè™‘$\frac {1}{\left|w\right|}$ï¼Œä¾¿å¾—åˆ°äº†æ„ŸçŸ¥æœºæ¨¡å‹çš„æŸå¤±å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">L(w,b)=-\sum_{x_i\in M}{y_i(wx_i+b)}</script><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€å°åŒ–è¯¥æŸå¤±å‡½æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ä¼˜çš„å‚æ•°$w,b$ã€‚æ­¤å¤–ï¼Œè¯¥æŸå¤±å‡½æ•°æ˜¯éè´Ÿçš„ï¼Œå¦‚æœæ²¡æœ‰è¯¯åˆ†ç±»ç‚¹ï¼Œé‚£ä¹ˆæŸå¤±å‡½æ•°ä¸º0ï¼Œå¹¶ä¸”ï¼Œå¯¹äºä¸€ä¸ªç‰¹ç‚¹çš„è¯¯åˆ†ç±»ç‚¹çš„æ—¶å€™ï¼Œè¯¯åˆ†ç±»ç‚¹ç¦»åˆ†ç¦»è¶…å¹³é¢è¶Šè¿‘ï¼ŒæŸå¤±å‡½æ•°è¶Šå°ã€‚å½“åˆ†ç¦»è¶…å¹³é¢è¶Šè¿‡è¯¥è¯¯åˆ†ç±»ç‚¹çš„æ—¶å€™ï¼ŒæŸå¤±å‡½æ•°ä¸º0ã€‚</p><h2 id="æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç®—æ³•"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç®—æ³•" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç®—æ³•"></a>æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç®—æ³•</h2><p>å½“æˆ‘ä»¬å®šä¹‰äº†æ„ŸçŸ¥æœºæ¨¡å‹çš„å­¦ä¹ ç­–ç•¥(æŸå¤±å‡½æ•°)åï¼Œé‚£ä¹ˆæ±‚è§£å‚æ•°å°±å˜æˆä¸€ä¸ªæœ€ä¼˜åŒ–é—®é¢˜äº†ã€‚åœ¨è¿™é‡Œï¼Œå­¦ä¹ ç®—æ³•æœ‰å…¶åŸå§‹å½¢å¼ä¸å¯¹å¶å½¢å¼ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä¸€ä¸€ä»‹ç»ã€‚</p><h3 id="æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„åŸå§‹å½¢å¼"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„åŸå§‹å½¢å¼" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„åŸå§‹å½¢å¼"></a>æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„åŸå§‹å½¢å¼</h3><p>åœ¨æ„ŸçŸ¥æœºæ¨¡å‹ä¸­ï¼Œé‡‡å–çš„å­¦ä¹ ç®—æ³•æ˜¯éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•(SGD)ã€‚é‚£ä¸ºä»€ä¹ˆä¸é‡‡å–batchæ¢¯åº¦ä¸‹é™å‘¢ï¼ŸåŸå› åœ¨äºï¼Œåªæœ‰è¯¯åˆ†ç±»ç‚¹æ‰èƒ½è¢«è®¡ç®—å…¥æŸå¤±å‡½æ•°ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨æ‰€æœ‰çš„æ ·æœ¬æ¥è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äºå•ä¸ªè¯¯åˆ†ç±»ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨æŸå¤±å‡½æ•°å¯¹$wï¼Œb$æ±‚åå¯¼ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\frac {\partial L}{\partial w}=-y_ix_i,</script><script type="math/tex; mode=display">\frac {\partial L}{\partial b}=-y_i.</script><p><strong>åŸå§‹å½¢å¼</strong></p><p>è¾“å…¥ï¼šç»™å®šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),(x_3,y_3),â€¦,(x_N,y_N)\}$ï¼Œå…¶ä¸­$x_i\in R^nï¼Œy\in Rï¼Œi=1â€¦N$ã€‚å­¦ä¹ ç‡$\eta\in (0,1]$ã€‚</p><p>è¾“å‡ºï¼šå‚æ•°$w,b$ã€‚</p><ol><li>åˆå§‹åŒ–å‚æ•°$w,b$ï¼Œç»™å®šåˆå€¼ä¸º$w_0,b_0$ã€‚</li><li>åœ¨è®­ç»ƒæ•°æ®é›†ä¸­é€‰å–å®ä¾‹$(x_i,y_i)$ã€‚</li><li>å¦‚æœ$y_i(wx_i+b)&lt;0$ï¼Œé‚£ä¹ˆ</li></ol><script type="math/tex; mode=display">w:=w-\eta(-y_ix_i)  ==>  w:=w+\eta y_ix_i</script><script type="math/tex; mode=display">b:=b-\eta (-y_i)==>b:=b+\eta y_i</script><ol><li>è½¬åˆ°ç¬¬2æ­¥ï¼Œå¾ªç¯ï¼Œç›´åˆ°æŸå¤±å‡½æ•°ä¸º0ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¯¯åˆ†ç±»ç‚¹ä¸ºæ­¢ã€‚</li></ol><p><strong>æ³¨æ„ï¼šæ„ŸçŸ¥æœºå­¦ä¹ ç®—æ³•ä¼šç”±äºé€‰å–ä¸åŒçš„å‚æ•°åˆå€¼ä»¥åŠé€‰å–è¯¯åˆ†ç±»ç‚¹çš„é¡ºåºï¼Œè€Œå¯¼è‡´æœ€åçš„æ¨¡å‹ä¸åŒï¼Œå³æ„ŸçŸ¥æœºæ¨¡å‹ä¸å”¯ä¸€ã€‚</strong></p><h3 id="æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„å¯¹å¶å½¢å¼"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„å¯¹å¶å½¢å¼" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„å¯¹å¶å½¢å¼"></a>æ„ŸçŸ¥æœºæ¨¡å‹å­¦ä¹ ç®—æ³•çš„å¯¹å¶å½¢å¼</h3><p>å¯¹å¶å½¢å¼é‡‡å–çš„æ˜¯å¦å¤–ä¸€ç§æƒ³æ³•ï¼Œæˆ‘ä»¬å°†å‚æ•°$w,b$è¡¨ç¤ºä¸º$x_i,y_i$çš„çº¿æ€§ç»„åˆï¼Œé€šè¿‡æ±‚è§£å‚æ•°$w,b$çš„ç³»æ•°ï¼Œä»è€Œæ±‚å¾—å‚æ•°$w,b$ã€‚å…·ä½“åšæ³•æ˜¯ï¼šä»¤å‚æ•°$w,b$çš„åˆå€¼ä¸º0ï¼Œè¿™æ ·çš„è¯ï¼Œæœ€ç»ˆçš„$w,b$å¯ä»¥ç”¨å¦‚ä¸‹çš„å…¬å¼æ¥è¡¨ç¤ºï¼š</p><script type="math/tex; mode=display">w=\sum_{i=1}^{N}\alpha_iy_ix_iï¼Œb=\sum_{i=1}^{N}\alpha_iy_i.</script><p>å…¶ä¸­ï¼Œ$\alpha_i=n_i\eta$ï¼Œ$\eta$è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$n_i$è¡¨ç¤ºç”±äºç¬¬iä¸ªå®ä¾‹è¢«è¯¯åˆ†ç±»ï¼Œä»è€Œæ›´æ–°çš„æ¬¡æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦æ±‚å¾—$\alpha=\{\alpha_1,\alpha_2,â€¦,\alpha_N\}$ï¼Œå°±å¯ä»¥å¾—åˆ°å‚æ•°$w,b$ã€‚</p><p><strong>å¯¹å¶å½¢å¼</strong></p><p>è¾“å…¥ï¼šç»™å®šè®­ç»ƒæ•°æ®é›†$X=\{(x_1,y_1),(x_2,y_2),(x_3,y_3),â€¦,(x_N,y_N)\}$ï¼Œå…¶ä¸­$x_i\in R^nï¼Œy\in Rï¼Œi=1â€¦N$ã€‚å­¦ä¹ ç‡$\eta\in (0,1]$ã€‚</p><p>è¾“å‡ºï¼šå‚æ•°$w,b$ã€‚æ„ŸçŸ¥æœºæ¨¡å‹$f(x)=sign(\sum_{j=1}^{N}\alpha_jy_jx_jx+b)$ï¼Œå…¶ä¸­ï¼Œ$\alpha=\{\alpha_1,\alpha_2,â€¦,\alpha_N\}$ã€‚</p><ol><li>åˆå§‹åŒ–å‚æ•°$w,b$ï¼Œç»™å®šåˆå€¼ä¸º$w_0=0,b_0=0$ã€‚</li><li>åœ¨è®­ç»ƒæ•°æ®é›†ä¸­é€‰å–å®ä¾‹$(x_i,y_i)$ã€‚</li><li>å¦‚æœ$y_i(\sum_{j=1}^{N}\alpha_jy_jx_jx_i+b)&lt;0$ï¼Œé‚£ä¹ˆ</li></ol><script type="math/tex; mode=display">\alpha_i:=\alpha_i+\eta,</script><script type="math/tex; mode=display">b:=b+\eta y_i.</script><ol><li>è½¬åˆ°ç¬¬2æ­¥ï¼Œç›´åˆ°æŸå¤±å‡½æ•°ä¸º0ï¼Œæ²¡æœ‰è¯¯åˆ†ç±»ç‚¹ä¸ºæ­¢ã€‚</li></ol><p><strong>æ³¨æ„ï¼šæˆ‘ä»¬å¦‚æœä»”ç»†çœ‹è®­ç»ƒè¿‡ç¨‹çš„è¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨ç¬¬3æ­¥ï¼Œæˆ‘ä»¬éœ€è¦é¢‘ç¹è®¡ç®—è®­ç»ƒå®ä¾‹çš„å†…ç§¯ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æŠŠæ‰€æœ‰å®ä¾‹çš„å†…ç§¯éƒ½ç®—å‡ºæ¥ï¼Œæ”¾å…¥ä¸€ä¸ªçŸ©é˜µ(è¯¥çŸ©é˜µå«GramçŸ©é˜µ)åªèƒ½å¤Ÿå­˜å‚¨ã€‚å½“éœ€è¦çš„æ—¶å€™ï¼Œç›´æ¥æŸ¥çŸ©é˜µå°±å¯ä»¥äº†ï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å¤§å¤§åŠ å¿«è®¡ç®—é€Ÿåº¦ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯¹å¶å½¢å¼æ¯”åŸå§‹å½¢å¼æ›´ä¼˜çš„åŸå› ã€‚</strong></p><p>ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ€»æ˜¯é€‰æ‹©å¯¹å¶å½¢å¼ã€‚å½“å®ä¾‹ç‰¹å¾æ•°é‡ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€‰æ‹©å¯¹å¶å½¢å¼ï¼›å½“æ ·æœ¬æ•°é‡ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€‰æ‹©åŸå§‹å½¢å¼ã€‚</p><p>åˆ°æ­¤ï¼Œæ„ŸçŸ¥æœºçš„ç†è®ºéƒ¨åˆ†å°±è®²å®Œäº†ï¼Œæ˜¯ä¸æ˜¯éå¸¸ç®€å•ğŸ˜ï¼Ÿæˆ‘ä»¬å¯ä»¥å›é¡¾ä¸€ä¸‹ï¼Œåœ¨æ„ŸçŸ¥æœºä¸­ï¼Œä¸€ä¸ªæœ€é‡è¦çš„å‰ææ¡ä»¶å°±æ˜¯ï¼šè®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„ã€‚é‚£å¦‚æœè®­ç»ƒæ•°æ®é›†ä¸æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¿™å°±éœ€è¦å¤§åé¼é¼çš„æ”¯æŒå‘é‡æœº(SVM)æ¥è¿›è¡Œè§£å†³äº†ï¼Œåé¢å°±ä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»æ”¯æŒå‘é‡æœºï½</p><h2 id="æ„ŸçŸ¥æœºæ¨¡å‹çš„å®ç°"><a href="#æ„ŸçŸ¥æœºæ¨¡å‹çš„å®ç°" class="headerlink" title="æ„ŸçŸ¥æœºæ¨¡å‹çš„å®ç°"></a>æ„ŸçŸ¥æœºæ¨¡å‹çš„å®ç°</h2><p>æŠŠæ¨¡å‹å®ç°ä¸€éæ‰ç®—æ˜¯çœŸæ­£çš„åƒé€äº†è¿™ä¸ªæ¨¡å‹å‘€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§æ–¹å¼æ¥å®ç°æ„ŸçŸ¥æœºæ¨¡å‹ï¼šçº¯pythonå®ç°ä»¥åŠè°ƒç”¨scikit-learnåº“æ¥å®ç°ã€‚æˆ‘çš„githubé‡Œé¢å¯ä»¥ä¸‹åœ¨åˆ°æ‰€æœ‰çš„ä»£ç ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„githubï¼Œä¹Ÿæ¬¢è¿å¤§å®¶starå’Œforkã€‚é™„ä¸Š<strong>GitHubåœ°å€: <a href="https://github.com/codewithzichao/Machine_Learning_Code" target="_blank" rel="noopener">ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹åŠå¸¸è§„æœºå™¨å­¦ä¹ æ¨¡å‹å®ç°</a></strong>ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="çº¯pythonå®ç°"><a href="#çº¯pythonå®ç°" class="headerlink" title="çº¯pythonå®ç°"></a>çº¯pythonå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2019-12-15</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnistæ•°æ®é›†</span></span><br><span class="line"><span class="string">æ¨¡å‹ï¼šæ„ŸçŸ¥æœºæ¨¡å‹ï¼Œå¯¹å…¶åŸå§‹å½¢å¼ä¸å¯¹å¶å½¢å¼å‡è¿›è¡Œäº†å®ç°</span></span><br><span class="line"><span class="string">å®ç°æ–¹å¼ï¼špython+numpy</span></span><br><span class="line"><span class="string">-----------------------------------</span></span><br><span class="line"><span class="string">ä½¿ç”¨åŸå§‹å½¢å¼</span></span><br><span class="line"><span class="string">æ•°æ®é‡ï¼š1000ï¼ˆå¯ä»¥å…¨éƒ¨ä½¿ç”¨ï¼Œä¸»è¦æ˜¯å¯¹å¶å½¢å¼åšå¯¹æ¯”ï¼‰</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.7691</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š19.176676034927368</span></span><br><span class="line"><span class="string">-----------------------------------</span></span><br><span class="line"><span class="string">ä½¿ç”¨å¯¹å¶å½¢å¼</span></span><br><span class="line"><span class="string">å¦‚æœä½¿ç”¨å¯¹å¶å½¢å¼çš„è¯ï¼Œæ•°æ®é›†æœ€å¥½ä¸è¦å…¨éƒ¨ä½¿ç”¨ï¼Œä¼šéå¸¸æ…¢ï¼</span></span><br><span class="line"><span class="string">(ä¸»è¦å°±æ˜¯åœ¨è®¡ç®—gramçŸ©é˜µçš„æ—¶å€™ï¼Œ60000âœ–ï¸60000çš„çŸ©é˜µæŒºå¤§çš„äº†)</span></span><br><span class="line"><span class="string">æ•°æ®é‡ï¼š1000</span></span><br><span class="line"><span class="string">å‡†ç¡®ç‡ï¼š0.7796.</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š40.42902708053589</span></span><br><span class="line"><span class="string">------------------------------------</span></span><br><span class="line"><span class="string">ä½†æ˜¯å¦‚æœæŠŠè®­ç»ƒæ ·æœ¬æ•°ç›®æ”¹ä¸º10çš„è¯ï¼Œä¼šå‘ç°ï¼ŒåŸå§‹:54.4%,14.43s;å¯¹å¶ï¼š65.05%ï¼Œ14.715s!</span></span><br><span class="line"><span class="string">æ‰€ä»¥ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå½“æ ·æœ¬æ•°è¿œå°äºç‰¹å¾æ•°çš„æ—¶å€™ã€‚é€‰æ‹©å¯¹å¶ä¼šæ›´å¥½ï¼Œå…¶ä½™æƒ…å†µï¼Œé€‰åŸå§‹å½¢å¼ã€‚</span></span><br><span class="line"><span class="string">é€šè¿‡å®éªŒå°±çœ‹å‡ºæ¥äº†ï½</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä»fileNameæ•°æ®æ–‡ä»¶ä¸­åŠ è½½Mnistæ•°æ®é›†</span></span><br><span class="line"><span class="string">    :param fileName: æ•°æ®é›†çš„è·¯å¾„</span></span><br><span class="line"><span class="string">    :return: è¿”å›æ•°æ®çš„ç‰¹å¾å‘é‡ä¸æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment"># å­˜æ”¾æ•°æ®çš„ç‰¹å¾å‘é‡</span></span><br><span class="line">    data_list = []</span><br><span class="line">    <span class="comment"># å­˜æ”¾æ•°æ®çš„æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–æ–‡ä»¶ï¼Œå°†ç‰¹å¾å‘é‡ä¸æ ‡ç­¾åˆ†åˆ«å­˜å…¥data_listä¸label_list</span></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            data_list.append([int(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line">            <span class="keyword">if</span> int(curline[<span class="number">0</span>]) &gt;= <span class="number">5</span>:</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†listç±»å‹çš„ç‰¹å¾å‘é‡ï¼Œå˜æ¢æˆçŸ©é˜µï¼Œç»´åº¦ä¸ºï¼ˆ60000ï¼Œ784ï¼‰</span></span><br><span class="line">    data_matrix = np.array(data_list)</span><br><span class="line">    <span class="comment"># å°†listç±»å‹çš„æ ‡ç­¾ç±»åˆ«ï¼Œå˜æ¢æˆçŸ©é˜µï¼Œç»´åº¦ä¸ºï¼ˆ1,60000ï¼‰</span></span><br><span class="line">    label_matrix = np.array(label_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Perceptron</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å®šä¹‰Peceptronç±»ï¼Œé‡Œé¢åŒ…æ‹¬äº†å…¶å­¦ä¹ ç®—æ³•çš„åŸå§‹å½¢å¼ä¸å¯¹å¶å½¢å¼çš„å®ç°å‡½æ•°</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data_matrix, label_matrix, iteration=<span class="number">30</span>, learning_rate=<span class="number">0.0001</span>)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="string">        :param data_matrix: æ•°æ®çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">        :param label_matrix: æ•°æ®çš„æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">        :param iteration: è¿­ä»£æ¬¡æ•°,é»˜è®¤ä¸º100</span></span><br><span class="line"><span class="string">        :param learning_rate: å­¦ä¹ ç‡ï¼Œé»˜è®¤ä¸º0.001</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self.data_matrix = data_matrix</span><br><span class="line">        self.label_matrix = label_matrix</span><br><span class="line">        self.iteration = iteration</span><br><span class="line">        self.learning_rate = learning_rate</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">original_method</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„ŸçŸ¥æœºå­¦ä¹ ç®—æ³•çš„åŸå§‹å½¢å¼çš„å®ç°</span></span><br><span class="line"><span class="string">        :return: è¿”å›å‚æ•°wï¼Œb</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        data_matrix = self.data_matrix</span><br><span class="line">        label_matrix = self.label_matrix</span><br><span class="line">        <span class="comment"># input_numè¡¨ç¤ºè®­ç»ƒé›†æ•°ç›®ï¼Œfeature_numè¡¨ç¤ºç‰¹å¾æ•°ç›®</span></span><br><span class="line">        input_num, feature_num = np.shape(data_matrix)</span><br><span class="line">        print(data_matrix.shape)</span><br><span class="line">        w = np.random.randn(<span class="number">1</span>, feature_num)</span><br><span class="line">        b = np.random.randn()</span><br><span class="line">        <span class="comment"># è¿­ä»£iterationæ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> iter <span class="keyword">in</span> range(self.iteration):</span><br><span class="line">            <span class="comment"># åœ¨æ¯ä¸€ä¸ªæ ·æœ¬ä¸Šéƒ½è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(input_num):</span><br><span class="line">                x_i = data_matrix[i]</span><br><span class="line">                y_i = label_matrix[i]</span><br><span class="line">                result = y_i * (np.matmul(w, x_i.T) + b)</span><br><span class="line">                <span class="keyword">if</span> result &lt;= <span class="number">0</span>:</span><br><span class="line">                    w = w + self.learning_rate * y_i * x_i</span><br><span class="line">                    b = b + self.learning_rate * y_i</span><br><span class="line">            print(<span class="string">f"this is <span class="subst">&#123;iter&#125;</span> round ,the total round is <span class="subst">&#123;self.iteration&#125;</span>."</span>)</span><br><span class="line">        <span class="keyword">assert</span> (w.shape == (<span class="number">1</span>, feature_num))</span><br><span class="line">        <span class="keyword">return</span> w, b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dual_method</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        æ„ŸçŸ¥æœºå­¦ä¹ ç®—æ³•çš„å¯¹å¶å½¢å¼çš„å®ç°</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        data_matrix = self.data_matrix</span><br><span class="line">        label_matrix = self.label_matrix.T</span><br><span class="line"></span><br><span class="line">        <span class="comment"># input_numè¡¨ç¤ºè®­ç»ƒé›†æ•°ç›®ï¼Œfeature_numè¡¨ç¤ºç‰¹å¾æ•°ç›®</span></span><br><span class="line">        input_num, feature_num = np.shape(data_matrix)</span><br><span class="line">        <span class="comment"># ç³»æ•°aï¼Œåˆå§‹åŒ–ä¸ºå…¨0çš„(1,input_num)çš„çŸ©é˜µ</span></span><br><span class="line">        a = np.zeros(input_num)</span><br><span class="line">        <span class="comment"># ç³»æ•°bï¼Œåˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        b = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—å‡ºgramçŸ©é˜µ</span></span><br><span class="line">        print(a.shape)</span><br><span class="line">        gram = np.matmul(data_matrix, data_matrix.T)</span><br><span class="line">        <span class="keyword">assert</span> (gram.shape == (input_num, input_num))</span><br><span class="line">        print(gram.shape)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿­ä»£iterationæ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> iter <span class="keyword">in</span> range(self.iteration):</span><br><span class="line">            <span class="comment"># åœ¨æ¯ä¸€ä¸ªæ ·æœ¬ä¸Šéƒ½è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(input_num):</span><br><span class="line">                result = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(input_num):</span><br><span class="line">                    result += a[j] * label_matrix[j] * gram[j][i]</span><br><span class="line">                result += b</span><br><span class="line">                result *= label_matrix[i]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># åˆ¤æ–­å½“å‰æ ·æœ¬ä¼šä¸ä¼šè¢«è¯¯åˆ†ç±»</span></span><br><span class="line">                <span class="keyword">if</span> (result &lt;= <span class="number">0</span>):</span><br><span class="line">                    a[i] = a[i] + self.learning_rate</span><br><span class="line">                    b = b + self.learning_rate * label_matrix[i]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            print(<span class="string">f"this is <span class="subst">&#123;iter&#125;</span> round,the total round is <span class="subst">&#123;self.iteration&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line">        w = np.matmul(np.multiply(a,self.label_matrix),self.data_matrix)</span><br><span class="line">        print(w.shape)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> w, b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_model</span><span class="params">(test_data_matrix, test_label_matrix, w, b)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    å†æµ‹è¯•æ•°æ®é›†ä¸Šæµ‹è¯•</span></span><br><span class="line"><span class="string">    :param test_data_matrix: æµ‹è¯•é›†çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"><span class="string">    :param test_label_matrix: æµ‹è¯•é›†çš„æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">    :param w: è®¡ç®—å¾—åˆ°çš„å‚æ•°w</span></span><br><span class="line"><span class="string">    :param b: è®¡ç®—å¾—åˆ°çš„å‚æ•°b</span></span><br><span class="line"><span class="string">    :return: è¿”å›å‡†ç¡®ç‡</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    test_input_num, _ = np.shape(test_data_matrix)</span><br><span class="line">    error_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»Ÿè®¡åœ¨æµ‹è¯•é›†ä¸Šæ•°æ®è¢«è¯¯åˆ†ç±»çš„æ•°ç›®</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(test_input_num):</span><br><span class="line">        result = (test_label_matrix[i]) * (np.matmul(w, test_data_matrix[i].T) + b)</span><br><span class="line">        <span class="keyword">if</span> (result &lt;= <span class="number">0</span>):</span><br><span class="line">            error_num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    accuracy = (test_input_num - error_num) / test_input_num</span><br><span class="line">    <span class="comment"># è¿”å›æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡</span></span><br><span class="line">    <span class="keyword">return</span> accuracy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´,ä½œä¸ºç¨‹åºå¼€å§‹è¿è¡Œæ—¶é—´</span></span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    train_data_list, train_label_list = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data_list, test_label_list = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line">    print(<span class="string">"finished load data."</span>)</span><br><span class="line">    perceptron = Perceptron(train_data_list[:<span class="number">1000</span>], train_label_list[:<span class="number">1000</span>], iteration=<span class="number">30</span>, learning_rate=<span class="number">0.0001</span>)</span><br><span class="line">    w, b = perceptron.dual_method()</span><br><span class="line"></span><br><span class="line">    accuracy = test_model(test_data_list, test_label_list, w, b)</span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´ï¼Œä½œä¸ºç¨‹åºç»“æŸè¿è¡Œæ—¶é—´</span></span><br><span class="line">    end = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡</span></span><br><span class="line">    print(<span class="string">f"accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line">    <span class="comment"># æ‰“å°ç¨‹åºè¿è¡Œæ€»æ—¶é—´</span></span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨scikit-learnå®ç°"><a href="#ä½¿ç”¨scikit-learnå®ç°" class="headerlink" title="ä½¿ç”¨scikit-learnå®ç°"></a>ä½¿ç”¨scikit-learnå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># Author:codewithzichao</span></span><br><span class="line"><span class="comment"># Date:2019-12-15</span></span><br><span class="line"><span class="comment"># E-mail:lizichao@pku.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ•°æ®é›†ï¼šMnistæ•°æ®é›†</span></span><br><span class="line"><span class="string">æ¨¡å‹ï¼šæ„ŸçŸ¥æœºæ¨¡å‹ï¼Œå¯¹å…¶åŸå§‹å½¢å¼ä¸å¯¹å¶å½¢å¼å‡è¿›è¡Œäº†å®ç°</span></span><br><span class="line"><span class="string">å®ç°æ–¹å¼ï¼šä½¿ç”¨scikit-learnåº“</span></span><br><span class="line"><span class="string">ç»“æœï¼š</span></span><br><span class="line"><span class="string">åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ï¼š0.7849</span></span><br><span class="line"><span class="string">æ—¶é—´ï¼š25,72s</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Perceptron</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä»fileNameæ•°æ®æ–‡ä»¶ä¸­åŠ è½½Mnistæ•°æ®é›†</span></span><br><span class="line"><span class="string">    :param fileName: æ•°æ®é›†çš„è·¯å¾„</span></span><br><span class="line"><span class="string">    :return: è¿”å›æ•°æ®çš„ç‰¹å¾å‘é‡ä¸æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment"># å­˜æ”¾æ•°æ®çš„ç‰¹å¾å‘é‡</span></span><br><span class="line">    data_list = []</span><br><span class="line">    <span class="comment"># å­˜æ”¾æ•°æ®çš„æ ‡ç­¾ç±»åˆ«</span></span><br><span class="line">    label_list = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–æ–‡ä»¶ï¼Œå°†ç‰¹å¾å‘é‡ä¸æ ‡ç­¾åˆ†åˆ«å­˜å…¥data_listä¸label_list</span></span><br><span class="line">    <span class="keyword">with</span> open(fileName, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">            curline = line.strip().split(<span class="string">","</span>)</span><br><span class="line">            data_list.append([int(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> curline[<span class="number">1</span>:]])</span><br><span class="line">            <span class="keyword">if</span> int(curline[<span class="number">0</span>]) &gt;= <span class="number">5</span>:</span><br><span class="line">                label_list.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                label_list.append(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    data_matrix = np.array(np.mat(data_list))</span><br><span class="line">    label_matrix = np.array(np.mat(label_list))</span><br><span class="line">    <span class="keyword">return</span> data_matrix, label_matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰æ„ŸçŸ¥æœº</span></span><br><span class="line">    <span class="comment"># n_iter_no_changeè¡¨ç¤ºè¿­ä»£æ¬¡æ•°ï¼Œeta0è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œshuffleè¡¨ç¤ºæ˜¯å¦æ‰“ä¹±æ•°æ®é›†</span></span><br><span class="line">    clf = Perceptron(n_iter_no_change=<span class="number">30</span>, eta0=<span class="number">0.0001</span>, shuffle=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># ä½¿ç”¨è®­ç»ƒæ•°æ®è¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">    train_data_matrix, train_label_matrix = loadData(<span class="string">"../MnistData/mnist_train.csv"</span>)</span><br><span class="line">    test_data_matrix, test_label_matrix = loadData(<span class="string">"../MnistData/mnist_test.csv"</span>)</span><br><span class="line"></span><br><span class="line">    print(train_data_matrix.shape)</span><br><span class="line">    print(test_data_matrix.shape)</span><br><span class="line"></span><br><span class="line">    train_label_matrix = np.squeeze(train_label_matrix)</span><br><span class="line">    test_label_matrix = np.squeeze(test_label_matrix)</span><br><span class="line"></span><br><span class="line">    print(train_label_matrix.shape)</span><br><span class="line">    print(test_label_matrix.shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    clf.fit(train_data_matrix, train_label_matrix)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ©ç”¨æµ‹è¯•é›†è¿›è¡ŒéªŒè¯ï¼Œå¾—åˆ°æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡</span></span><br><span class="line">    accuracy = clf.score(test_data_matrix, test_label_matrix)</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">f"accuracy is <span class="subst">&#123;accuracy&#125;</span>."</span>)</span><br><span class="line">    print(<span class="string">f"the total time is <span class="subst">&#123;end - start&#125;</span>."</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç»Ÿè®¡å­¦ä¹ æ–¹æ³• </tag>
            
            <tag> scikit-learn </tag>
            
            <tag> perceptron </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|æ·±å…¥æ¢ç©¶Transformeræ¨¡å‹</title>
      <link href="2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/"/>
      <url>2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»å­¦äº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯æ²¡æœ‰è¾“å‡ºï¼Œæ€»æ„Ÿè§‰ä¼¼ä¹å°‘äº†ç‚¹ä»€ä¹ˆã€‚è¿™ç‰‡åšå®¢å°†å›é¡¾ç»å…¸çš„Transformeræ¨¡å‹ã€‚Transformeræ¨¡å‹æ˜¯Googleåœ¨2017å¹´æ‰€æå‡ºçš„æ¨¡å‹ã€‚è¯¥æ¨¡å‹æŠ›å¼ƒäº†ä¼ ç»Ÿçš„RNNä¸CNNï¼Œå…¨éƒ¨é‡‡ç”¨Attentionæœºåˆ¶ï¼Œç»“æœè¯æ˜å…¶åœ¨å½“æ—¶å–å¾—äº†SOTAçš„æ•ˆæœï¼Œå¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚Transformerä¹Ÿæ˜¯åæ¥å¤§ç«çš„BERTä¸­çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œæ‰€ä»¥Transformeræ¨¡å‹çš„æå‡ºæ˜¯éå¸¸å…·æœ‰å¼€åˆ›æ€§çš„å·¥ä½œã€‚æœ¬æ–‡å°†é¦–å…ˆä»‹ç»Transformeræå‡ºçš„èƒŒæ™¯ï¼Œç´§æ¥ç€è¯¦ç»†è®²è§£å…¶å†…éƒ¨æ¶æ„ï¼Œæœ€åå¯¹Transformeråšä¸€ä¸ªå°å°çš„æ€»ç»“ã€‚</p><a id="more"></a><h2 id="Transformeræ¨¡å‹æå‡ºçš„åŸå› "><a href="#Transformeræ¨¡å‹æå‡ºçš„åŸå› " class="headerlink" title="Transformeræ¨¡å‹æå‡ºçš„åŸå› "></a>Transformeræ¨¡å‹æå‡ºçš„åŸå› </h2><p>åœ¨åŸºäºRNNçš„seq2seq+attentionæ¨¡å‹ä¸­ï¼Œç”±äºattentionæœºåˆ¶çš„åŠ å…¥ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³ä¿¡æ¯æŸå¤±ä¸å¥å­é•¿è·ç¦»ä¾èµ–é—®é¢˜ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸æ™®é€šRNNåŒæ ·çš„é—®é¢˜ã€‚å…¶tæ—¶åˆ»çš„hidden stateä¾èµ–äºt-1æ—¶åˆ»çš„hidden stateä¸tæ—¶åˆ»çš„è¾“å…¥ï¼Œåªæœ‰t-1æ—¶åˆ»çš„hidden stateè®¡ç®—å®Œæˆåï¼Œæ‰èƒ½å¤Ÿå»è®¡ç®—tæ—¶åˆ»çš„hidden stateã€‚è¿™æ ·å›ºå®šçš„é¡ºåºè®¡ç®—åœ¨è®­ç»ƒæ—¶ä¼šéå¸¸ç¼“æ…¢ï¼Œæ— æ³•å¹¶è¡Œè®¡ç®—ï¼Œè®¡ç®—æ•ˆç‡ä½ä¸‹ï¼›æ­¤å¤–ï¼Œå½“è®­ç»ƒé›†éå¸¸å¤§çš„æ—¶å€™ï¼Œç½‘ç»œçš„è®¡ç®—é‡ä¹Ÿä¼šå˜å¾—éå¸¸åºå¤§ã€‚</p><p>åæ¥ï¼ŒåŸºäºCNNçš„seq2seq+attentionæ¨¡å‹è¢«æå‡ºï¼Œå®ƒå…·æœ‰åŸºäºRNNçš„seq2seq+attentionæ¨¡å‹çš„æ•æ‰é•¿è·ç¦»ä¾èµ–çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å¯ä»¥å¹¶è¡ŒåŒ–å®ç°ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ï¼šè¾“å…¥åºåˆ—ä¸è¾“å‡ºåºåˆ—è¶Šé•¿ï¼Œè®¡ç®—é‡è¶Šå¤§ã€‚</p><p>æ‰€ä»¥ï¼ŒTransformeræ¨¡å‹çš„æå‡ºä¸»è¦æ˜¯æƒ³åœ¨ä¸æŸå®³æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œå‡å°‘è®¡ç®—é‡å¹¶æé«˜å¹¶è¡Œæ•ˆç‡ã€‚</p><h2 id="Transformeræ¨¡å‹åˆ†æ"><a href="#Transformeræ¨¡å‹åˆ†æ" class="headerlink" title="Transformeræ¨¡å‹åˆ†æ"></a>Transformeræ¨¡å‹åˆ†æ</h2><h3 id="Transformeræ¨¡å‹æ¦‚è§ˆ"><a href="#Transformeræ¨¡å‹æ¦‚è§ˆ" class="headerlink" title="Transformeræ¨¡å‹æ¦‚è§ˆ"></a>Transformeræ¨¡å‹æ¦‚è§ˆ</h3><p>é¦–å…ˆï¼Œæ²¡é”™ï¼ŒTransformeræ¨¡å‹è¿˜æ˜¯encoder-decoderæ¶æ„ï¼Œè¾“å…¥åºåˆ—$(x_1,x_2,x_3,â€¦,x_{T_X})$ç»è¿‡encoderï¼Œè¾“å‡º$(h_1,h_2,h_3,â€¦,h_{T_X})$ä½œä¸ºdecoderçš„è¾“å…¥ï¼Œæœ€åç»è¿‡decoderå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºåºåˆ—$(y_1,y_2,y_3,..,y_{T_Y})$ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/0.0..png" alt></p><p>é‚£ä¹ˆå†å…·ä½“ä¸€ç‚¹ï¼Œåœ¨Transformerä¸­ï¼ŒEncoderéƒ¨åˆ†ç”±å¤šä¸ªencoderå †å ç»„æˆï¼ŒDecoderéƒ¨åˆ†ä¹Ÿæ˜¯ç”±å¤šä¸ªdecoderå †å è€Œæˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>Encoderéƒ¨åˆ†çš„è¾“å‡ºä¼šä¸Decoderéƒ¨åˆ†çš„æ¯ä¸€ä¸ªdecoderç›¸ç»“åˆï¼Œè¿™æ˜¯ä¸åŒçš„åœ°æ–¹ã€‚</strong></p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/0.æ¨¡å‹æ¶æ„æ¦‚è§ˆ.png" alt></p><p>å®è§‚ä¸Šçš„ç»“æ„æˆ‘ä»¬çŸ¥é“äº†ï¼Œæœ€åæ¥çœ‹æ¯ä¸€ä¸ªencoderä¸decoderçš„å†…éƒ¨ç»“æ„ã€‚</p><p><strong>encoderå±‚ï¼š</strong>æ¯ä¸€ä¸ªencoderå±‚ç”±ä¸¤ä¸ªå­å±‚æ„æˆã€‚</p><p><strong>ç¬¬ä¸€ä¸ªå­å±‚(multi-head attention layer)ï¼š</strong>å…¶è¾“å…¥æ˜¯å‰ä¸€ä¸ªencoderå±‚çš„è¾“å‡ºï¼Œè¾“å…¥é¦–å…ˆè¿›å…¥multi-head attentionæœºåˆ¶ï¼Œå†æ¥ä¸€ä¸ªæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ï¼›</p><p><strong>ç¬¬äºŒä¸ªå­å±‚(FFN layer)ï¼š</strong>å…¶è¾“å…¥æ˜¯ç¬¬ä¸€ä¸ªå­å±‚çš„è¾“å‡ºï¼Œå°†ç¬¬ä¸€ä¸ªå­å±‚çš„è¾“å‡ºè¾“å…¥åˆ°ä¸€ä¸ªå…¨è¿æ¥çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œå†æ¥ä¸€ä¸ªæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ï¼Œæœ€åä½œä¸ºè¯¥encoderå±‚çš„è¾“å‡ºã€‚</p><p><strong>decoderå±‚ï¼š</strong>æ¯ä¸€ä¸ªdecoderå±‚ç”±ä¸‰ä¸ªå­å±‚æ„æˆã€‚</p><p><strong>ç¬¬ä¸€ä¸ªå­å±‚(masked multi-head attention layer)ï¼š</strong>å…¶è¾“å…¥æ˜¯å‰ä¸€ä¸ªdecoderå±‚çš„è¾“å‡ºï¼Œè¾“å…¥è¿›å…¥Masked multi-head attentionæœºåˆ¶ï¼Œå†æ¥ä¸€ä¸ªæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ï¼›</p><p><strong>ç¬¬äºŒä¸ªå­å±‚(encoder-decoder attention layer)ï¼š</strong>å…¶è¾“å…¥æœ‰ä¸¤ä¸ªï¼š<strong>Encoderçš„è¾“å‡ºä¸ç¬¬ä¸€ä¸ªå­å±‚çš„è¾“å‡º</strong>ï¼Œç»è¿‡multi-head attentionæœºåˆ¶ï¼Œå†æ¥ä¸€ä¸ªæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ï¼›</p><p><strong>ç¬¬ä¸‰ä¸ªå­å±‚(FFN layer)ï¼š</strong>å…¶è¾“å…¥æ˜¯ç¬¬äºŒä¸ªå­å±‚çš„è¾“å‡ºï¼Œå°†ç¬¬äºŒä¸ªå­å±‚çš„è¾“å‡ºè¾“å…¥åˆ°ä¸€ä¸ªå…¨è¿æ¥çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œå†æ¥ä¸€ä¸ªæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ï¼Œä¹‹åéœ€è¦å†æ¥ä¸€ä¸ªçº¿æ€§è½¬æ¢å±‚ï¼Œæœ€åé€šè¿‡softmaxï¼Œå¾—åˆ°è¯¥decoderå±‚è¾“å‡ºçš„å•è¯ã€‚</p><p><strong>è¿™é‡Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼šåœ¨decoderéƒ¨åˆ†ï¼Œå¹¶ä¸æ˜¯æœ€åä¸€æ¬¡æ€§æŠŠæ‰€æœ‰çš„åºåˆ—å…¨éƒ¨decodeå‡ºæ¥ï¼Œè€Œæ˜¯åƒRNNä¸€æ ·ï¼Œä¸€æ¬¡åªdecodeä¸€ä¸ªå•è¯ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªdecoderå±‚è¿˜éœ€è¦ç”¨åˆ°å‰ä¸€ä¸ªçš„è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚</strong></p><p>ä¸‹é¢å°†ä¸€ä¸€è®²è§£æ¯ä¸€ä¸ªéƒ¨åˆ†ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/1.encoder-decoderå†…éƒ¨æ¶æ„.jpg" alt></p><h3 id="æ ¸å¿ƒâ€”Scaled-Dot-Product-Attentionä¸Multi-Head-Attention"><a href="#æ ¸å¿ƒâ€”Scaled-Dot-Product-Attentionä¸Multi-Head-Attention" class="headerlink" title="æ ¸å¿ƒâ€”Scaled Dot-Product Attentionä¸Multi-Head Attention"></a>æ ¸å¿ƒâ€”Scaled Dot-Product Attentionä¸Multi-Head Attention</h3><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/2.scaled -dot-product  .jpg" alt></p><blockquote><p>åœ¨è¿™é‡Œï¼Œé¦–å…ˆè¦ç†è§£ï¼Œä¼ ç»Ÿçš„attentionæœºåˆ¶çš„æœ¬è´¨å…¶å®å¯ä»¥ç†è§£ä¸ºï¼šè¾“å…¥åºåˆ—ä¸­çš„å…ƒç´ å¯ä»¥æƒ³è±¡ä¸º<key,value>å¯¹ï¼Œé‚£ä¹ˆç»™å®štargetä¸­æŸä¸ªè¦é¢„æµ‹çš„å…ƒç´ Qï¼Œé€šè¿‡è®¡ç®—Qä¸æ¯ä¸ªkeyçš„ç›¸å…³æ€§ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªkeyå¯¹åº”valueçš„æƒé‡ç³»æ•°ï¼ˆattention weightsï¼‰ï¼Œå†å¯¹valueè¿›è¡ŒåŠ å’Œå¹³å‡ï¼Œå°±æ˜¯æœ€ç»ˆçš„attentionå€¼ï¼ˆcontext vectorï¼‰ã€‚åœ¨NLPä¸­ï¼Œkeyå’Œvalueå¸¸å¸¸çœ‹åšä¸€ä¸ªå€¼ï¼ˆhidden stateï¼‰ã€‚å‚çœ‹ï¼š<a href="https://blog.csdn.net/malefactor/article/details/78767781" target="_blank" rel="noopener">attentionæœºåˆ¶æœ¬è´¨</a></key,value></p></blockquote><p>ç›´æ¥æ”¾å…¬å¼ï¼š</p><script type="math/tex; mode=display">Attention(Q,K,V)=softmax(\frac {QK^{T}}{\sqrt{d_k}})V,</script><script type="math/tex; mode=display">MultiHead(Q,K,V)=Concat(head_1,...,head_h)W^O,å…¶ä¸­ head_i=Attention(QW_i^Q,KW_i^K,VW_i^V).</script><ol><li>é¦–å…ˆç†è§£Scaled Dot-Product Attentionä¸­çš„Qã€Kã€Væ˜¯æ€ä¹ˆå¾—æ¥çš„ã€‚æ¯”å¦‚ç»™å‡ºè¾“å…¥åºåˆ—çš„word embedding$x=\{x_1,x_2\}$ï¼Œé€šè¿‡çº¿æ€§å˜æ¢ï¼Œå¾—åˆ°Qã€Kã€Vã€‚å…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼š</li></ol><script type="math/tex; mode=display">Q=xW^Q,K=xW^K,V=xW^V.</script><p>å…¶ä¸­å‚æ•°$W^Q,W^K,W^V$é€šè¿‡ç½‘ç»œçš„è®­ç»ƒå¾—å‡ºã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š</p><p>è¾“å…¥ï¼šä¸¤ä¸ªå•è¯ï¼ŒThinking, Machines. é€šè¿‡åµŒå…¥å˜æ¢ä¼š$x_1,x_2$ä¸¤ä¸ªå‘é‡[1 x 4]ã€‚åˆ†åˆ«ä¸ $W^Q,W^K,W^V$ ä¸‰ä¸ªçŸ©é˜µ[4x3]åšç‚¹ä¹˜å¾—åˆ°ï¼Œ${q_1,q_2},{k_1,k_2},{v_2,v_2} $6ä¸ªå‘é‡[1x3]ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/3.qkvçš„è®¡ç®—.png" alt></p><ol><li>æ¥ç€ï¼Œè®¡ç®—self-attentionçš„åˆ†æ•°å€¼ã€‚è¯¥åˆ†æ•°è¡¨ç¤ºå½“æˆ‘ä»¬åœ¨encodeä¸€ä¸ªè¯çš„æ—¶å€™ï¼Œå¯¹å¥å­å…¶ä»–è¯çš„å…³æ³¨ç¨‹åº¦ã€‚æˆ‘ä»¬é€šè¿‡Qä¸Kåšç‚¹ä¹˜å¾—åˆ°åˆ†æ•°å€¼ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š</li></ol><p>æˆ‘ä»¬éœ€è¦è®¡ç®—å…¶ä»–è¯ç›¸å¯¹äºthinkingè¿™ä¸ªè¯çš„åˆ†æ•°ã€‚é¦–å…ˆæ˜¯thinkingè‡ªå·±: $q_1Â·k_1$ï¼›machinesç›¸å¯¹äºthinkingçš„åˆ†æ•°ï¼š$q_1Â·k_2$ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/4.QKscore.png" alt></p><ol><li>å¯¹scoreè¿›è¡Œç¼©æ”¾ï¼Œå³è§„èŒƒåŒ–ï¼Œå¹¶å¯¹scoreä½¿ç”¨softmaxï¼Œå¾—åˆ°åˆ†å¸ƒã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š</li></ol><p>scoreä¹‹æ‰€ä»¥éœ€è¦è¿›è¡Œç¼©æ”¾æ˜¯å› ä¸ºï¼šè¦ä½¿æ¢¯åº¦æ›´åŠ ç¨³å®šã€‚å› ä¸ºå½“$d_k$éå¸¸å¤§çš„æ—¶å€™ï¼Œç‚¹ä¹˜ç»“æœä¼šéå¸¸å¤§ï¼Œå¦‚æœä¸åšç¼©æ”¾ï¼Œé‚£ä¹ˆç»è¿‡sofmaxå½’ä¸€åŒ–ä¹‹åï¼ŒäºŒè€…å·®è·ä¼šéå¸¸å¤§ï¼Œä»è€Œä½¿å¾—åœ¨åå‘ä¼ æ’­çš„æ—¶å€™ï¼Œæ¢¯åº¦ä¼šéå¸¸å°ï¼Œéš¾ä»¥è®­ç»ƒã€‚è­¬å¦‚ï¼šå¦‚æœä¸è¿›è¡Œç¼©æ”¾ï¼Œç»è¿‡softmaxçš„ç»“æœæ˜¯ï¼š0.99999â€¦ï¼Œ0.0000000â€¦ï¼Œè¿™æ˜¾ç„¶ä¸åˆ©äºä¹‹åçš„è®¡ç®—ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/5.softmax.png" alt></p><ol><li>å°†å½’ä¸€åŒ–çš„scoreä¸vç›¸ä¹˜ï¼Œå¾—åˆ°attentionå€¼ï¼Œå¹¶å¯¹åŠ æƒå‘é‡å€¼æ±‚å’Œï¼Œ è¿™å°†åœ¨æ­¤ä½ç½®ï¼ˆå¯¹äºç¬¬ä¸€ä¸ªå•è¯thinkingï¼‰äº§ç”Ÿself-attentionå±‚çš„è¾“å‡ºã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š</li></ol><p>æœ€ç»ˆçš„è¾“å‡ºï¼š$z_1=0.88v_1+0.12v_2$.</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/6.sum.png" alt></p><p>ä¸Šè¿°æ˜¯è®¡ç®—çš„ä¸€ä¸ªå•è¯çš„attentionå€¼ï¼Œåœ¨å®é™…æ“ä½œä¸­ï¼Œå¾€å¾€ä»¥çŸ©é˜µå½¢å¼æ“ä½œã€‚å¦‚ä¸‹ï¼š</p><p>è¾“å…¥æ˜¯ä¸€ä¸ª[2x4]çš„çŸ©é˜µï¼ˆå•è¯åµŒå…¥ï¼‰ï¼Œæ¯ä¸ªè¿ç®—æ˜¯[4x3]çš„çŸ©é˜µï¼Œæ±‚å¾—Q,K,Vã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/7.çŸ©é˜µè®¡ç®—.png" alt></p><p>Qå¯¹Kè½¬åˆ¶åšç‚¹ä¹˜ï¼Œé™¤ä»¥dkçš„å¹³æ–¹æ ¹ã€‚åšä¸€ä¸ªsoftmaxå¾—åˆ°åˆä¸º1çš„æ¯”ä¾‹ï¼Œå¯¹Våšç‚¹ä¹˜å¾—åˆ°è¾“å‡ºZã€‚é‚£ä¹ˆè¿™ä¸ªZå°±æ˜¯self-attentionçš„è¾“å‡ºï¼ŒZçš„ç¬¬ä¸€è¡Œå°±æ˜¯thinkingçš„self-attentionå€¼ï¼Œç¬¬äºŒè¡Œå°±æ˜¯machinesçš„self-attentionå€¼ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/8.çŸ©é˜µè®¡ç®—.png" alt></p><p>Scaled Dot-Product Attentionå¤§è‡´å°±è®²å®Œäº†ï¼Œé‚£ä¹ˆå¯¹äºMulti-Head Attentionï¼Œå…¶å®å°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯å°†ä¸Šè¿°è¿‡ç¨‹é‡å¤Hæ¬¡ï¼Œç„¶åå†concatï¼Œæœ€åè¾“å‡ºã€‚ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿå¹¶è¡Œè¿ç®—ï¼ŒåŠ å¿«è®¡ç®—æ•ˆç‡ï¼Œçœ‹å›¾ğŸ‘‡ã€‚</p><p>åœ¨Multi-Head attentionä¸­ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªheadç»´æŠ¤å•ç‹¬çš„Q / K / Væƒé‡çŸ©é˜µï¼Œä»è€Œå¯¼è‡´ä¸åŒçš„Q / K / VçŸ©é˜µã€‚ åœ¨transformeråŸæ–‡ä¸­ï¼Œä½¿ç”¨äº†8ä¸ªheadï¼Œæ‰€ä»¥æœ€åä¼šå¾—åˆ°8ä¸ªçŸ©é˜µã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/9.multihead.png" alt></p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/10..png" alt></p><p>å¾—åˆ°8ä¸ªçŸ©é˜µä¹‹åï¼Œå†concatå˜æˆä¸€ä¸ªçŸ©é˜µï¼Œä¸$W^O$åšç‚¹ä¹˜åï¼Œè¾“å…¥åˆ°FFNä¸­ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/11.png" alt></p><p>Multi-Head Attentionéƒ¨åˆ†å°±è®²å®Œäº†ã€‚ç„¶è€Œè¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦å…³æ³¨ã€‚æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹self-attentionçš„è®¡ç®—å…¬å¼ï¼š</p><script type="math/tex; mode=display">Attention(Q,K,V)=softmax(\frac {QK^{T}}{\sqrt{d_k}})V,</script><p>Qã€Kã€Væ˜¯ç”±è¾“å…¥ä¸Wç›¸ä¹˜å¾—åˆ°çš„ï¼Œè¾“å…¥çš„ç»´åº¦ä¸ºï¼š(m,512)ï¼Œmæ˜¯ä¸€ä¸ªå¥å­çš„å•è¯æ•°ï¼Œ512æ˜¯word embeddingçš„ç»´åº¦ï¼Œé‚£ä¹ˆQã€Kã€Vçš„ç»´åº¦æ˜¯ï¼š(m,64)ï¼Œé‚£ä¹ˆ$QK^T$çš„ç»´åº¦æ˜¯ï¼š(m,m)ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªattention mapï¼Œæ¯”å¦‚è¯´è¾“å…¥æ˜¯ä¸€å¥è¯ â€œi have a dreamâ€ æ€»å…±4ä¸ªå•è¯ï¼Œ è¿™é‡Œå°±ä¼šå½¢æˆä¸€å¼ 4x4çš„æ³¨æ„åŠ›æœºåˆ¶çš„å›¾ï¼Œæ¯ä¸€ä¸ªæ ¼å­å°±å¯¹åº”ä¸€ä¸ªæƒé‡ï¼Œå¦‚ä¸‹ğŸ‘‡ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/12.jpg" style="zoom:50%;"></p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨encoderä¸­ï¼Œå«åšself-attentionï¼Œåœ¨decoderä¸­ï¼Œå«åšmasked self-attention</strong>ã€‚æ‰€è°“çš„maskï¼Œæ„æ€å°±æ˜¯ä¸ç»™æ¨¡å‹çœ‹åˆ°æœªæ¥çš„ä¿¡æ¯ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/13.jpg" style="zoom:50%;"></p><p>å°±æ¯”å¦‚è¯´ï¼Œiä½œä¸ºç¬¬ä¸€ä¸ªå•è¯ï¼Œåªèƒ½æœ‰å’Œiè‡ªå·±çš„attentionã€‚haveä½œä¸ºç¬¬äºŒä¸ªå•è¯ï¼Œæœ‰å’Œi, have ä¸¤ä¸ªattentionã€‚ a ä½œä¸ºç¬¬ä¸‰ä¸ªå•è¯ï¼Œæœ‰å’Œi,have,a å‰é¢ä¸‰ä¸ªå•è¯çš„attentionã€‚åˆ°äº†æœ€åä¸€ä¸ªå•è¯dreamçš„æ—¶å€™ï¼Œæ‰æœ‰å¯¹æ•´ä¸ªå¥å­4ä¸ªå•è¯çš„attentionã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/14.jpg" style="zoom:50%;"></p><p>è¿™æ˜¯åšå®Œsoftmaxä¹‹åçš„ç»“æœã€‚</p><p>å¯¹ä¸self-attentionæ¥è¯´ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœè¾“å…¥çš„å¥å­ç‰¹åˆ«é•¿ï¼Œé‚£å°±ä¸ºå½¢æˆä¸€ä¸ª NxNçš„attention mapï¼Œè¿™å°±ä¼šå¯¼è‡´å†…å­˜çˆ†ç‚¸â€¦æ‰€ä»¥è¦ä¹ˆå‡å°‘batch sizeå¤šgpuè®­ç»ƒï¼Œè¦ä¹ˆå‰ªæ–­è¾“å…¥çš„é•¿åº¦ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨convå¯¹K,Våšå·ç§¯å‡å°‘é•¿åº¦ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/15.jpg" style="zoom:50%;"></p><p>å¯¹K,Våšå·ç§¯å’Œstrideï¼ˆstrideçš„è¯(n,1)æ˜¯å¯¹seq_lenå•è¾¹è¿›è¡Œè·³è·ƒï¼‰ï¼Œä¼šå‡å°‘seq_lençš„é•¿åº¦è€Œä¸ä¼šå‡å°‘hid_dimçš„é•¿åº¦ã€‚æ‰€ä»¥æœ€åçš„ç»“æœZè¿˜æ˜¯å’ŒåŸå…ˆä¸€æ ·ï¼ˆå› ä¸ºQæ²¡æœ‰æ”¹å˜ï¼‰ã€‚maskçš„è¯æ¯”è¾ƒéº»çƒ¦äº†ï¼Œä½œè€…ç”¨çš„æ˜¯local attentionã€‚</p><p>Encoderå’ŒDecoderéƒ¨åˆ†çš„åŒºåˆ«å¦‚ä¸‹ï¼š<br>1ã€ Encoderéƒ¨åˆ†çš„self-attentionè®¡ç®—çš„æ˜¯ä¸¤ä¸¤å•è¯ä¹‹é—´attentionã€‚ç„¶ådecoderéƒ¨åˆ†è®¡ç®—çš„å°±æ˜¯å½“å‰çš„å•è¯å’Œå®ƒå‰é¢å•è¯çš„attentionäº†ã€‚<br>2ã€ Decoderéƒ¨åˆ†å¤šäº†ä¸€å±‚ï¼ŒEncoder-Decoderçš„attentionï¼Œå°±æ˜¯å°†decoderçš„self attentionéƒ¨åˆ†å’ŒEncoderéƒ¨åˆ†outputè¿›è¡Œattentionã€‚ç„¶åå†å»Feed Forwardã€‚</p><h3 id="Positional-Encoding"><a href="#Positional-Encoding" class="headerlink" title="Positional Encoding"></a>Positional Encoding</h3><p>åœ¨transformerä¸­ï¼Œç”±äºèˆå¼ƒäº†CNNä¸RNNï¼Œé‚£ä¹ˆå°±å•è¯çš„ä½ç½®ä¿¡æ¯å°±æ²¡æœ‰è¢«è€ƒè™‘åˆ°ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œtransformerä¸­åœ¨encoderä¸decoderçš„è¾“å…¥ä¸­ï¼Œæ·»åŠ äº†positional encodingã€‚ç»´åº¦å’Œembeddingçš„ç»´åº¦ä¸€æ ·ï¼Œè¿™ä¸ªå‘é‡é‡‡ç”¨äº†ä¸€ç§å¾ˆç‹¬ç‰¹çš„æ–¹æ³•æ¥è®©æ¨¡å‹å­¦ä¹ åˆ°è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªå‘é‡èƒ½å†³å®šå½“å‰è¯çš„ä½ç½®ï¼Œæˆ–è€…è¯´åœ¨ä¸€ä¸ªå¥å­ä¸­ä¸åŒçš„è¯ä¹‹é—´çš„è·ç¦»ã€‚è¿™ä¸ªä½ç½®å‘é‡çš„å…·ä½“è®¡ç®—æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œè®ºæ–‡ä¸­çš„è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">PE_{(pos,2i)}=sin(pos/10000^{2i/d_{model}}),</script><script type="math/tex; mode=display">PE_{(pos,2i+1)}=cos(pos/10000^{2i/d_{model}}).</script><p>å…¶ä¸­posæ˜¯æŒ‡å½“å‰è¯åœ¨å¥å­ä¸­çš„ä½ç½®ï¼Œiæ˜¯æŒ‡å‘é‡ä¸­æ¯ä¸ªå€¼çš„indexï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨<strong>å¶æ•°ä½ç½®ï¼Œä½¿ç”¨æ­£å¼¦ç¼–ç ï¼Œåœ¨å¥‡æ•°ä½ç½®ï¼Œä½¿ç”¨ä½™å¼¦ç¼–ç </strong>ã€‚</p><p>æœ€åæŠŠè¿™ä¸ªPositional Encodingä¸embeddingçš„å€¼ç›¸åŠ ï¼Œä½œä¸ºè¾“å…¥é€åˆ°ä¸‹ä¸€å±‚ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/16.png" alt></p><h3 id="Layer-Normalization"><a href="#Layer-Normalization" class="headerlink" title="Layer Normalization"></a>Layer Normalization</h3><p>åœ¨transformerä¸­ï¼Œæ¯ä¸€ä¸ªå­å±‚ï¼ˆself-attetionï¼Œffnnï¼‰ä¹‹åéƒ½ä¼šæ¥ä¸€ä¸ªæ®‹ç¼ºæ¨¡å—ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªLayer normalizationã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Transformer%E6%A8%A1%E5%9E%8B/17.png" alt></p><p>æ®‹å·®è¿æ¥å¾ˆç®€å•ï¼Œåœ¨è¿™é‡Œï¼Œä¸»è¦è®²è§£ä¸€ä¸‹Layer normalizationã€‚å…¶å®æ‰€æœ‰çš„normalizationéƒ½æ˜¯ä¸ºäº†è§£å†³covariate shfité—®é¢˜ã€‚å°±æ˜¯å¦‚æœåœ¨è®­ç»ƒé›†ä¸Šå·²ç»å»ºç«‹å¥½äº†xåˆ°yçš„æ˜ å°„ï¼Œé‚£ä¹ˆå¦‚æœtest setçš„åˆ†å¸ƒä¸training setçš„åˆ†å¸ƒä¸ä¸€æ ·ï¼Œé‚£ä¹ˆæ¨¡å‹æ•ˆæœä¸ä¼šå¾ˆå¥½ã€‚æ¯”è¾ƒè‘—åçš„å°±æ˜¯Batch normalizationã€‚é€šè¿‡å°†è¾“å…¥æ•°æ®è½¬åŒ–ä¸ºå›ºå®šå‡å€¼ä¸æ–¹å·®çš„æ•°æ®ï¼Œä»è€Œèƒ½å¤ŸåŠ é€Ÿè®­ç»ƒã€‚è€ŒLayer Normalizationä¸BNæœ€å¤§çš„ä¸åŒåœ¨äºï¼ŒLNæ˜¯å›ºå®šä½æ¯ä¸€å±‚çš„å‡å€¼å’Œæ–¹å·®ï¼Œä»è€Œé™ä½covariate shiftå¸¦æ¥çš„å½±å“ã€‚å‚çœ‹é“¾æ¥ï¼š<a href="https://blog.csdn.net/zhangjunhit/article/details/53169308" target="_blank" rel="noopener">Layer Normalization</a></p><h3 id="Position-wise-Feed-Forward-Networks"><a href="#Position-wise-Feed-Forward-Networks" class="headerlink" title="Position-wise Feed-Forward Networks"></a>Position-wise Feed-Forward Networks</h3><p>åœ¨multi-head attentionåï¼Œä¼šæ¥ä¸€ä¸ªFFNå±‚ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">FFN(x)=max(0,xW_1+b_1)W_2+b_2.</script><h3 id="MASK"><a href="#MASK" class="headerlink" title="MASK"></a>MASK</h3><p>mask è¡¨ç¤ºæ©ç ï¼Œå®ƒå¯¹æŸäº›å€¼è¿›è¡Œæ©ç›–ï¼Œä½¿å…¶åœ¨å‚æ•°æ›´æ–°æ—¶ä¸äº§ç”Ÿæ•ˆæœã€‚Transformer æ¨¡å‹é‡Œé¢æ¶‰åŠä¸¤ç§ maskï¼Œåˆ†åˆ«æ˜¯ padding mask å’Œ sequence maskã€‚å…¶ä¸­ï¼Œpadding mask åœ¨æ‰€æœ‰çš„ scaled dot-product attention é‡Œé¢éƒ½éœ€è¦ç”¨åˆ°ï¼Œè€Œ sequence mask åªæœ‰åœ¨ decoder çš„ self-attention é‡Œé¢ç”¨åˆ°ã€‚</p><p><strong>Padding Mask</strong></p><p>ä»€ä¹ˆæ˜¯ padding mask å‘¢ï¼Ÿå› ä¸ºæ¯ä¸ªæ‰¹æ¬¡è¾“å…¥åºåˆ—é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦å¯¹è¾“å…¥åºåˆ—è¿›è¡Œå¯¹é½ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ç»™åœ¨è¾ƒçŸ­çš„åºåˆ—åé¢å¡«å…… 0ã€‚ä½†æ˜¯å¦‚æœè¾“å…¥çš„åºåˆ—å¤ªé•¿ï¼Œåˆ™æ˜¯æˆªå–å·¦è¾¹çš„å†…å®¹ï¼ŒæŠŠå¤šä½™çš„ç›´æ¥èˆå¼ƒã€‚å› ä¸ºè¿™äº›å¡«å……çš„ä½ç½®ï¼Œå…¶å®æ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„attentionæœºåˆ¶ä¸åº”è¯¥æŠŠæ³¨æ„åŠ›æ”¾åœ¨è¿™äº›ä½ç½®ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†ã€‚</p><p>å…·ä½“çš„åšæ³•æ˜¯ï¼ŒæŠŠè¿™äº›ä½ç½®çš„å€¼åŠ ä¸Šä¸€ä¸ªéå¸¸å¤§çš„è´Ÿæ•°(è´Ÿæ— ç©·)ï¼Œè¿™æ ·çš„è¯ï¼Œç»è¿‡ softmaxï¼Œè¿™äº›ä½ç½®çš„æ¦‚ç‡å°±ä¼šæ¥è¿‘0ï¼</p><p>è€Œæˆ‘ä»¬çš„ padding mask å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¼ é‡ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªBooleanï¼Œå€¼ä¸º false çš„åœ°æ–¹å°±æ˜¯æˆ‘ä»¬è¦è¿›è¡Œå¤„ç†çš„åœ°æ–¹ã€‚</p><p><strong>Sequence mask</strong></p><p>æ–‡ç« å‰é¢ä¹Ÿæåˆ°ï¼Œsequence mask æ˜¯ä¸ºäº†ä½¿å¾— decoder ä¸èƒ½çœ‹è§æœªæ¥çš„ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªåºåˆ—ï¼Œåœ¨ time_step ä¸º t çš„æ—¶åˆ»ï¼Œæˆ‘ä»¬çš„è§£ç è¾“å‡ºåº”è¯¥åªèƒ½ä¾èµ–äº t æ—¶åˆ»ä¹‹å‰çš„è¾“å‡ºï¼Œè€Œä¸èƒ½ä¾èµ– t ä¹‹åçš„è¾“å‡ºã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æƒ³ä¸€ä¸ªåŠæ³•ï¼ŒæŠŠ t ä¹‹åçš„ä¿¡æ¯ç»™éšè—èµ·æ¥ã€‚</p><p>é‚£ä¹ˆå…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼šäº§ç”Ÿä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µï¼Œä¸Šä¸‰è§’çš„å€¼å…¨ä¸º0ã€‚æŠŠè¿™ä¸ªçŸ©é˜µä½œç”¨åœ¨æ¯ä¸€ä¸ªåºåˆ—ä¸Šï¼Œå°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚</p><p>å¯¹äº decoder çš„ self-attentionï¼Œé‡Œé¢ä½¿ç”¨åˆ°çš„ scaled dot-product attentionï¼ŒåŒæ—¶éœ€è¦padding mask å’Œ sequence mask ä½œä¸º attn_maskï¼Œå…·ä½“å®ç°å°±æ˜¯ä¸¤ä¸ªmaskç›¸åŠ ä½œä¸ºattn_maskã€‚<br>å…¶ä»–æƒ…å†µï¼Œattn_mask ä¸€å¾‹ç­‰äº padding maskã€‚</p><h2 id="é‡è¦çš„ç»†èŠ‚"><a href="#é‡è¦çš„ç»†èŠ‚" class="headerlink" title="é‡è¦çš„ç»†èŠ‚"></a>é‡è¦çš„ç»†èŠ‚</h2><ol><li><strong>Maskæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿæ˜¯å¦åªæœ‰åœ¨decoderçš„æ—¶å€™ï¼Œæ‰ä¼šç”¨åˆ°maskï¼Ÿå¦‚æœä¸æ˜¯ï¼Œè¯·è¯¦ç»†æè¿°encoderä¸decoderçš„maskçš„å·¥ä½œçŠ¶å†µã€‚</strong></li></ol><p>ç­”ï¼šå…¶å®å¦‚æœçœ‹æºç çš„è¯ï¼Œè¿™ä¸ªé—®é¢˜éå¸¸ç®€å•æ˜äº†ï¼ˆpadding mask ä¸sentence maskï¼‰ã€‚è¿™é‡Œå…ˆä¸å†™ï¼Œæ”¾ä¸€ä¸ªè¿æ¥ï¼š<a href="https://blog.csdn.net/u012526436/article/details/86295971" target="_blank" rel="noopener">Mask</a></p><ol><li><strong>æœ€åä¸€å±‚çš„encoderè¾“å‡ºäº†ä»€ä¹ˆï¼Ÿæ˜¯è¾“å‡ºäº†Zè¿˜æ˜¯è¾“å‡ºäº†Kä¸Vï¼Ÿå¦‚æœæ˜¯è¾“å‡ºäº†Kä¸Vï¼Œé‚£ä¹ˆä¸å‰é¢çš„encoderå±‚çš„è®¡ç®—æ˜¯å¦æœ‰åŒºåˆ«ï¼Ÿ</strong></li></ol><p>ç­”ï¼šç­”æ¡ˆæ˜¯è¾“å‡ºKã€Våˆ°æ¯ä¸ªdecoderå±‚ï¼Œè€Œä¸”Kä¸Væ˜¯åŒä¸€ä¸ªçŸ©é˜µï¼Œè¿˜è®°å¾—æˆ‘è¯´çš„attentionæœ¬è´¨å—ï¼Ÿå…·ä½“è¿‡ç¨‹ï¼Œè¿˜æ˜¯çœ‹æºç ï¼Œå…ˆä¸å†™äº†ï¼Œç å­—å¤ªéš¾å—äº†ã€‚</p><ol><li><strong>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ˜¯teacher forcingè¿˜æ˜¯free runï¼Ÿ</strong></li></ol><p>ç­”ï¼šè®ºæ–‡è¯´çš„æ˜¯free runï¼Œä½†æ˜¯å®é™…æ“ä½œè¿˜æ˜¯ä¼šæœ‰teacher forcingã€‚ä¸€èˆ¬ä¼šè®¾ç½®ä¸€ä¸ªteacher_forcing_probï¼Œä¸ä¼šä¸€ç›´éƒ½æ˜¯teacher forcingï¼Œè¿™æ ·æ•ˆæœä¼šå¥½äº›ã€‚</p><ol><li><strong>ä»€ä¹ˆæ˜¯BPEï¼Ÿåœ¨transformerä¸­èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></li></ol><p>ç­”ï¼šä¹‹åå†å†™å§ï¼Œè¿™æ˜¯ä¸€ç§ç¼–ç æ–¹å¼ï¼Œç‰¹ç®€å•ï¼Œä½†æ˜¯å¾ˆå¤šåœ°æ–¹éƒ½ä¼šç”¨åˆ°ï¼Œä¹‹ååº”è¯¥ä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« ä»‹ç»ï½</p><ol><li><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨multi-head self-attentionï¼Ÿ</strong></li></ol><p>ç­”ï¼šå…¶å®è¿™ä¸ªåŸæ–‡é‡Œä¹Ÿæ²¡æœ‰è®²çš„ç‰¹åˆ«æ¸…æ¥šï¼Œä¸ªäººç†è§£æ˜¯ï¼šmulti-headå°±åƒæ˜¯cnnä¸­çš„å¤šä¸ªfilterï¼Œä¸åŒçš„headå¯ä»¥å…³æ³¨å¥å­ä¸­ä¸åŒä½ç½®çš„ä¿¡æ¯ï¼ˆä½ç½®ä¿¡æ¯ã€å¥æ³•ä¿¡æ¯ã€ç½•è§å­—ä¿¡æ¯ç­‰ç­‰ï¼‰ï¼Œå¯ä»¥æ›´åŠ ç»¼åˆåœ°åˆ©ç”¨å„æ–¹é¢çš„ä¿¡æ¯ï¼Œæå–å‡ºæ›´åŠ ä¸°å¯Œçš„ç‰¹å¾ã€‚</p><ol><li><strong>transformerçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</strong></li></ol><p>ç­”ï¼šä¼˜ç‚¹ï¼šç›¸æ¯”rnnæ¥è¯´ï¼Œèƒ½å¤Ÿå¹¶è¡Œè®¡ç®—ï¼›ç›¸æ¯”cnnæ¥è¯´ï¼Œä¸éœ€è¦å åŠ éå¸¸å¤šçš„å±‚æ¥æ‰©å¤§æ„Ÿå—é‡ã€‚</p><p>â€‹       ç¼ºç‚¹ï¼šå› ä¸ºæŠ›å¼ƒäº†rnnï¼Œæ‰€ä»¥å¤±å»äº†å¥å­ä¹‹é—´çš„ä½ç½®ä¿¡æ¯ï¼Œè™½ç„¶åŠ äº†positional encodingï¼Œä½†æ˜¯ä»ç„¶æ— æ³•åšåˆ°åƒrnné‚£æ ·ï¼Œå®Œå…¨åœ°è€ƒè™‘å•è¯ä¹‹é—´çš„ä½ç½®å…³ç³»ã€‚æ­¤å¤–ï¼Œtransformerçš„ç©ºé—´å¤æ‚åº¦éå¸¸å¤§ï¼Œå¦‚æœå¥å­é•¿åº¦ä¸º$L$ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªheadéƒ½éœ€è¦å­˜å‚¨$L^2$çš„scoreï¼Œå½“$L$éå¸¸å¤§çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°OOMçš„æƒ…å†µï¼Œé‚£ä¹ˆï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦è®²å¥å­éå¸¸å¤šä¸ªå¥å­ï¼Œä½†æ˜¯ä¸€æ—¦åˆ†å‰²å¥å­ï¼Œé‚£ä¹ˆå¥å­ä¹‹é—´çš„å‰åå…³ç³»å°±æ²¡æœ‰äº†ï¼Œé‚£ä¹ˆæ¨¡å‹ç»“æœä¹Ÿä¼šå—å½±å“ã€‚</p><ol><li><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨label-smoothingï¼Ÿ</strong></li></ol><p>ç­”ï¼š<a href="https://zhuanlan.zhihu.com/p/60821628" target="_blank" rel="noopener">transformerç»†èŠ‚</a></p><p>â€‹    </p><p>æˆ‘çš„è¿™ç‰‡åšæ–‡åªæ˜¯è¯¦ç»†åœ°å‰–ætransformerçš„åŸç†ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼ˆè­¬å¦‚ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ï¼‰ï¼ŒåŸè®ºæ–‡å…¶ä¸­è®²çš„å¹¶ä¸æ¸…æ¥šğŸ¤·â€â™‚ï¸ã€‚anywayï¼Œéœ€è¦çœ‹æºç ï¼Œç„¶åè‡ªå·±äº²è‡ªè°ƒè¯•æ‰èƒ½çœŸæ­£åœ°çœ‹æ‡‚ï¼Œæ‰€ä»¥ï¼ŒRTFSCï¼Œæºç é“¾æ¥ï¼š<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">pytorch-transformer</a>ã€<a href="https://github.com/tensorflow/tensor2tensor" target="_blank" rel="noopener">tensorflow-transformer</a></p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li>ã€ŠAttention Is All You Needã€‹</li><li><a href="https://jalammar.github.io/illustrated-transformer/" target="_blank" rel="noopener">https://jalammar.github.io/illustrated-transformer/</a></li><li><a href="https://zhuanlan.zhihu.com/p/39034683" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/39034683</a></li><li><a href="https://zhuanlan.zhihu.com/p/60821628" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/60821628</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> Attention </tag>
            
            <tag> Transformer </tag>
            
            <tag> self-attention </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|Bahdanau Attentionä¸Luong Attention</title>
      <link href="2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/"/>
      <url>2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»å­¦äº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯æ²¡æœ‰è¾“å‡ºï¼Œæ€»æ„Ÿè§‰ä¼¼ä¹å°‘äº†ç‚¹ä»€ä¹ˆã€‚è¿™ç‰‡åšå®¢å°†å›é¡¾ç»å…¸çš„Attentionæœºåˆ¶ã€‚Attentionæ¨¡å‹æ˜¯æ·±åº¦å­¦ä¹ é¢†åŸŸæœ€æœ‰å½±å“åŠ›çš„å·¥ä½œä¹‹ä¸€ï¼Œæœ€åˆåº”ç”¨äºå›¾åƒé¢†åŸŸ(hard attention)ï¼Œåæ¥åœ¨NMTä»»åŠ¡ä¸Šå–å¾—å·¨å¤§æˆåŠŸåï¼Œä¾¿å¼€å§‹é£é¡äºæ•´ä¸ªæ·±åº¦å­¦ä¹ ç¤¾åŒºï¼Œå°¤å…¶æ˜¯åœ¨NLPé¢†åŸŸã€‚éšåæå‡ºçš„GPTã€ELMoã€transformerã€BERTã€GPT-2ã€XLNETç­‰æ¨¡å‹ï¼Œå‡æœ‰Attentionæœºåˆ¶çš„å½±å­ã€‚æœ¬æ–‡å°†è¯¦ç»†è®²è§£ä¸¤ç§ç»å…¸çš„Attentionæ¨¡å‹ï¼šBahdanau Attentionä¸Luong Attentionï¼Œå¹¶å¯¹Attentionæ¨¡å‹è¿›è¡Œä¸€ä¸ªå°å°çš„æ€»ç»“ã€‚</p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦æœ‰Attentionæœºåˆ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰Attentionæœºåˆ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰Attentionæœºåˆ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰Attentionæœºåˆ¶ï¼Ÿ</h2><p>çœŸæ­£çš„Attentionæœºåˆ¶æºäºç¥ç»æœºå™¨ç¿»è¯‘ï¼ˆNMTï¼‰ã€‚åœ¨NMTä¸­ï¼Œæœ€å¸¸ç”¨çš„æ¨¡å‹æ¶æ„æ˜¯ï¼šencoder-decoderã€‚æˆ‘ä»¬å°†è¾“å…¥åºåˆ—è¾“å…¥åˆ°encoderéƒ¨åˆ†ï¼Œencoderæœ€ç»ˆè¾“å‡ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„vectorï¼Œä»è€Œä½œä¸ºdecoderéƒ¨åˆ†çš„è¾“å…¥ï¼Œæœ€ç»ˆï¼Œdecoderéƒ¨åˆ†è¾“å‡ºç¿»è¯‘åçš„ç»“æœã€‚encoder-decoderæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/0.encoder-decoder.png" alt></p><p>ä½†æ˜¯ä¸Šè¿°çš„encoder-decoderæ¶æ„å­˜åœ¨ç¼ºé™·ï¼š<strong>è¾“å…¥åºåˆ—ä¸è®ºé•¿çŸ­ï¼Œéƒ½ä¼šè¢«ç¼–ç æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„vectorï¼Œä½œä¸ºdecoderçš„è¾“å…¥ï¼Œè€Œdecoderçš„æ•ˆæœä¼šå—åˆ¶äºè¯¥vector</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šè¿°æ¶æ„è¦æ±‚å½“å‰çŠ¶æ€è®°å½•åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•é€šè¿‡ä¸€ä¸ªvectoræ¥ä¿å­˜æ‰€æœ‰åºåˆ—çš„ä¿¡æ¯ã€‚è¿™ä¼šé™åˆ¶æ•´ä¸ªæ¨¡å‹çš„æ€§èƒ½ã€‚å°¤å…¶å½“æºè¾“å…¥åºåˆ—éå¸¸é•¿çš„æ—¶å€™ï¼Œæ¨¡å‹çš„æ€§èƒ½ä¼šä¸‹é™åœ°è¶Šè¿…é€Ÿã€‚åœ¨æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸Šï¼Œå°±è¡¨ç°ä¸ºï¼šå½“è¾“å…¥åºåˆ—éå¸¸é•¿çš„æ—¶å€™ï¼Œç¿»è¯‘çš„æ–‡æœ¬è´¨é‡ä¼šéå¸¸å·®ã€‚è¿™å°±å¼•è¿›äº†Attentionæ¨¡å‹ã€‚</p><p>ä¼ ç»Ÿçš„Attentionæ¨¡å‹æœ‰ä¸¤ç§ã€‚ä¸€ä¸ªæ˜¯Dzmitry Bahdanauç­‰äººåœ¨ã€ŠNeural Machine Translation by Jointly Learning to Align and Translateã€‹è®ºæ–‡ä¸­æå‡ºçš„Attentionæ¨¡å‹ï¼Œç®€ç§°ï¼šBahdanau Attentionï¼›å¦ä¸€ä¸ªæ˜¯Minh-Thang Luongç­‰äººåœ¨ã€ŠEffective Approaches to Attention-based Neural Machine Translationã€‹è®ºæ–‡ä¸­æå‡ºçš„Attentionæ¨¡å‹ï¼Œç®€ç§°ï¼šLuong Attentionã€‚ä¸‹é¢å°†åˆ†åˆ«è¯¦ç»†åœ°ä»‹ç»ä¸¤ç§Attentionæ¨¡å‹ã€‚</p><h2 id="Bahdanau-Attention"><a href="#Bahdanau-Attention" class="headerlink" title="Bahdanau Attention"></a>Bahdanau Attention</h2><p>é¦–å…ˆç»™å‡ºAttentionæ¨¡å‹çš„æ¶æ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/1.Attentionæœºåˆ¶.png" alt></p><p>æ•´ä¸ªæ¨¡å‹çš„è®¡ç®—ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>encoding</li><li>è®¡ç®—attention weights</li><li>è®¡ç®—context vector</li><li>decoding</li></ul><p>ä¸‹é¢å°†è¯¦ç»†åœ°ä»‹ç»æ¯ä¸€ä¸ªæ­¥éª¤ã€‚</p><h3 id="Encoding"><a href="#Encoding" class="headerlink" title="Encoding"></a>Encoding</h3><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/3.å›¾4.png" alt></p><ol><li>è¾“å…¥åºåˆ—ï¼š$X=\{x_1,x_2,x_3,â€¦,x_{T_X}\}$ï¼Œå…¶ä¸­$T_X$è¡¨ç¤ºè¾“å…¥åºåˆ—çš„é•¿åº¦ã€‚</li><li>åœ¨encoderéƒ¨åˆ†ï¼Œä½¿ç”¨BRNNã€‚<script type="math/tex">\overrightarrow h_1,\overrightarrow h_2,\overrightarrow h_3,...,\overrightarrow h_{T_X}</script>ï¼Œè¡¨ç¤ºå‰å‘RNNçš„æ¯ä¸€æ—¶é—´æ­¥çš„hidden stateï¼Œäº¦å¯ä»¥å«åšæ¿€æ´»å€¼ï¼›<script type="math/tex">\overleftarrow h_1,\overleftarrow h_2,\overleftarrow h_3,...,\overleftarrow h_{T_x}</script>ï¼Œè¡¨ç¤ºåå‘RNNçš„æ¯ä¸€æ—¶é—´æ­¥çš„hidden stateï¼Œäº¦å¯ä»¥å«åšæ¿€æ´»å€¼ã€‚(ä¸æ‡‚BRNNçš„è¯ï¼Œå»ºè®®ç›´æ¥çœ‹è®ºæ–‡æˆ–è€…Andrew Ngçš„ã€ŠDeep Learningã€‹ã€‚)</li><li>ä½¿ç”¨$h_j=(\overrightarrow h_j,\overleftarrow h_j)$è¡¨ç¤ºencoderéƒ¨åˆ†ä¸­jæ—¶åˆ»çš„hidden stateã€‚</li></ol><h3 id="è®¡ç®—attention-weights"><a href="#è®¡ç®—attention-weights" class="headerlink" title="è®¡ç®—attention weights"></a>è®¡ç®—attention weights</h3><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/4.å›¾5.png" alt></p><ol><li>Attention weights $\alpha_{t,j}$çš„å«ä¹‰æ˜¯ï¼šåœ¨ç”Ÿæˆç¬¬tä¸ªè¾“å‡ºçš„æ—¶å€™ï¼Œåº”è¯¥åœ¨ç¬¬jä¸ªencoderå•å…ƒçš„æ³¨æ„åŠ›å¤§å°ã€‚Attention weightsçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li></ol><script type="math/tex; mode=display">\alpha_{t,j}=\frac {exp(e_{t,j})}{\sum_{k=1}^{T_x}exp(e_{t,k})},</script><script type="math/tex; mode=display">e_{t,j}=a(s_{t-1},h_j)</script><p>è¿™å®é™…ä¸Šå°±æ˜¯é€šè¿‡softmaxå¾—åˆ°çš„attentionçš„åˆ†å¸ƒã€‚</p><ol><li>éœ€è¦ç€é‡ç†è§£çš„æ˜¯å¯¹é½æ¨¡å‹(alignment model)ã€‚åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼š$e_{t,j}=a(s_{t-1},h_j)$ï¼Œaæ˜¯å¯¹é½æ¨¡å‹ï¼Œç”¨æ¥è¯„ä¼°å½“å‰é¢„æµ‹è¯ä¸è¾“å…¥åºåˆ—ä¸­æ¯ä¸€ä¸ªè¾“å…¥è¯çš„ç›¸å…³åº¦ã€‚ç›´è§‚åœ°ç†è§£å°±æ˜¯ï¼šåœ¨decoderçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›´åŠ å…³æ³¨äºé‚£äº›ä¸é¢„æµ‹è¯ç›¸å…³çš„éƒ¨åˆ†ã€‚åœ¨ç”Ÿæˆä¸€ä¸ªé¢„æµ‹è¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘è¾“å…¥åºåˆ—ä¸­æ¯ä¸€ä¸ªè¾“å…¥è¯ä¸å½“å‰é¢„æµ‹è¯çš„å¯¹é½å…³ç³»ï¼ˆç›¸å…³ç¨‹åº¦ï¼‰ï¼Œå¯¹é½è¶Šå¥½çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥ç»™äºˆå®ƒæ›´å¤§çš„æƒé‡ï¼Œå› ä¸ºå®ƒå¯¹å½“å‰é¢„æµ‹è¯çš„å½±å“è¶Šå¤§ã€‚</li></ol><h3 id="è®¡ç®—context-vector"><a href="#è®¡ç®—context-vector" class="headerlink" title="è®¡ç®—context vector"></a>è®¡ç®—context vector</h3><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/5.å›¾6.png" alt></p><p>Context vectorçš„è®¡ç®—éå¸¸ç®€å•ï¼Œå°±æ˜¯æ‰€æœ‰encoderéƒ¨åˆ†çš„hidden stateçš„åŠ æƒå¹³å‡ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">c_t=\sum_{j=1}^{T_x}\alpha_{t,j}h_{j}</script><p>å…¶ä¸­ï¼Œ$\alpha_{t,j}$å°±æ˜¯Attention weightsï¼Œ$h_j$å°±æ˜¯åœ¨encoderéƒ¨åˆ†ï¼Œè®¡ç®—çš„æ¯ä¸€ä¸ªæ—¶åˆ»çš„hidden stateã€‚ä»è¿™ä¸ªå¼å­å¯ä»¥çŸ¥é“ï¼Œ$\alpha_{t,j}$ å†³å®šäº†$h_j$å¯¹$c_t$çš„å½±å“ã€‚å½“$\alpha_{t,j}$ è¶Šå¤§ï¼Œé‚£ä¹ˆ$h_j$å¯¹å¯¹$c_t$çš„å½±å“å°±è¶Šå¤§ã€‚</p><h3 id="Decoding"><a href="#Decoding" class="headerlink" title="Decoding"></a>Decoding</h3><p>é€šè¿‡ä¸Šè¿°å‡ æ­¥ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æ‹¥æœ‰çš„ä¸œè¥¿æœ‰ï¼š$h_j$ã€$c_t$ã€$s_{t-1}$ã€$\hat y_{t-1}$ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è®¡ç®—tæ—¶åˆ»çš„hidden stateï¼Œå¹¶å¾—åˆ°è¾“å‡º$\hat y_{t}$ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/6.å›¾7.png" alt></p><script type="math/tex; mode=display">s_{t}=g(s_{t-1},\hat y_{t-1},c_t)</script><script type="math/tex; mode=display">p(\hat y_{t}|y_1,y_2,y_3,...,X)=f(\hat y_t,s_t,c_t)</script><p>å…¶ä¸­ï¼Œgå¯ä»¥æ˜¯GRUæˆ–è€…LSTMå•å…ƒç­‰ï¼Œfå¯ä»¥æ˜¯softmaxå•å…ƒç­‰ã€‚</p><p>å½“ç„¶ï¼Œåœ¨é¢„æµ‹é˜¶æ®µï¼Œéœ€è¦ä½¿ç”¨Beam Searchï¼Œä»è€Œæ¥å¾—åˆ°æœ€æ¥è¿‘åŸæ„çš„ç¿»è¯‘ï¼Œåœ¨è¿™ï¼Œå°±ä¸å±•å¼€è®¨è®ºäº†ï¼Œç­‰æœ‰æ—¶é—´ï¼Œå†å†™å†™å…³äºBeam Searchçš„æ–‡ç« ï½</p><p>è‡³æ­¤ï¼ŒBahdanau Attentionçš„åŸç†å°±è®²è§£å®Œæ¯•äº†ï¼Œå…¶å®å›é¡¾ä¸€ä¸‹ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸€ç‚¹éƒ½ä¸å¤æ‚ã€‚</p><h2 id="Luong-Attention"><a href="#Luong-Attention" class="headerlink" title="Luong Attention"></a>Luong Attention</h2><p>Luongç­‰äººæå‡ºäº†æ–°çš„æ›´ä¸ºç®€å•å’Œæœ‰æ•ˆçš„Attentionæ¨¡å‹ã€‚æ•´ä¸ªæ¨¡å‹åˆåˆ†ä¸ºä¸¤ä¸ªæ¨¡å‹ï¼šglobal attentionä¸local attentionã€‚global attentionä¸local attentionçš„æœ¬è´¨åŒºåˆ«åœ¨äºï¼šglobal attentionä½¿ç”¨æ•´ä¸ªè¾“å…¥åºåˆ—çš„hidden stateæ¥è®¡ç®—context vectorï¼Œè€Œlocal attentionåªä½¿ç”¨è¾“å…¥åºåˆ—çš„hidden stateçš„ä¸€ä¸ªå­é›†æ¥è®¡ç®—context vectorã€‚ä¸‹é¢å°†å…·ä½“é˜è¿°è¿™ä¸¤ç§æ¨¡å‹ã€‚</p><h3 id="Global-Attention"><a href="#Global-Attention" class="headerlink" title="Global Attention"></a>Global Attention</h3><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/7.global attentionæ¦‚è§ˆ.jpg" alt></p><p>Global Attentionå®é™…ä¸Šå¯ä»¥çœ‹ä½œBahdanau Attentionçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä½†æ˜¯åˆæœ‰äº›åŒºåˆ«ã€‚å…·ä½“æ­¥éª¤ä¸‹é¢å°†ä¸€ä¸€ä»‹ç»ã€‚</p><p>å…·ä½“æ­¥éª¤æœ‰ï¼š</p><ul><li>encoding</li><li>è®¡ç®—decoderçš„hidden state</li><li>è®¡ç®—å¯¹é½å‘é‡ï¼Œå…¶å®å°±æ˜¯æ³¨æ„åŠ›æƒé‡</li><li>è®¡ç®—context vector</li><li>è®¡ç®—decoderæ¯ä¸€ä¸ªæ—¶åˆ»æœ€ç»ˆçš„hidden state</li><li>è®¡ç®—è¾“å‡º</li></ul><h4 id="Encoding-1"><a href="#Encoding-1" class="headerlink" title="Encoding"></a>Encoding</h4><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/8.gobal 1æ­¥.jpg" alt></p><ol><li>è¾“å…¥åºåˆ—ï¼š$X=\{x_1,x_2,x_3,â€¦,x_{T_X}\}$ï¼Œå…¶ä¸­$T_X$è¡¨ç¤ºè¾“å…¥åºåˆ—çš„é•¿åº¦ã€‚</li><li>è®¡ç®—encoderæ¯ä¸€ä¸ªæ—¶åˆ»çš„hidden stateï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</li></ol><script type="math/tex; mode=display">h_t=RNN_{enc}(h_{t-1},x_{t}).</script><p>å…¶ä¸­ï¼Œ$h_{t-1}$è¡¨ç¤ºä¸Šä¸€ä¸ªæ—¶åˆ»çš„hidden stateï¼Œ$x_t$è¡¨ç¤ºtæ—¶åˆ»çš„è¾“å…¥è¯çš„word embeddingã€‚</p><h4 id="è®¡ç®—decoderçš„hidden-state"><a href="#è®¡ç®—decoderçš„hidden-state" class="headerlink" title="è®¡ç®—decoderçš„hidden state"></a>è®¡ç®—decoderçš„hidden state</h4><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/9.2æ­¥.jpg" alt></p><p>è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">s_t=RNN_{dec}(s_{t-1},\hat y_{t-1})</script><p>å…¶ä¸­ï¼Œ$s_t$è¡¨ç¤ºdecoderä¸­tæ—¶åˆ»çš„hidden stateï¼Œ$s_{t-1}$è¡¨ç¤ºdecoderä¸­t-1æ—¶åˆ»çš„hidden stateï¼Œ$\hat y_{t-1}$è¡¨ç¤ºdecoderä¸­t-1æ—¶åˆ»çš„è¾“å‡ºè¯çš„word embeddingã€‚</p><h4 id="è®¡ç®—å¯¹é½å‘é‡ï¼Œå…¶å®å°±æ˜¯æ³¨æ„åŠ›æƒé‡"><a href="#è®¡ç®—å¯¹é½å‘é‡ï¼Œå…¶å®å°±æ˜¯æ³¨æ„åŠ›æƒé‡" class="headerlink" title="è®¡ç®—å¯¹é½å‘é‡ï¼Œå…¶å®å°±æ˜¯æ³¨æ„åŠ›æƒé‡"></a>è®¡ç®—å¯¹é½å‘é‡ï¼Œå…¶å®å°±æ˜¯æ³¨æ„åŠ›æƒé‡</h4><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/10.jpg" alt></p><p>è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\alpha_{t,j}=\frac{exp(e_{t,j})}{\sum_{k=1}^{T_X}exp(e_{t,k})},</script><script type="math/tex; mode=display">e_{t,j}=score(s_t,h_j).</script><p>å…¶ä¸­ï¼Œ$\alpha_{t,j}$æ˜¯å¯¹é½å‘é‡ï¼Œä¹Ÿå°±æ˜¯æ³¨æ„åŠ›æƒé‡ï¼Œè¡¨ç¤ºç”Ÿæˆé¢„æµ‹è¯$\hat y_{t}$ï¼Œéœ€è¦åœ¨$h_j$ä¸Šéœ€è¦èŠ±è´¹çš„æ³¨æ„åŠ›å¤§å°ï¼›$e_{t,j}$è¡¨ç¤ºä¸€ä¸ªåˆ†æ•°ï¼Œé€šè¿‡scoreå‡½æ•°å¾—åˆ°ã€‚scoreå‡½æ•°æœ‰ä¸‰ç§æ–¹æ¡ˆï¼ˆgeneralæ–¹æ¡ˆæ•ˆæœæœ€å¥½ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><script type="math/tex; mode=display">score(s_t,h_j)=\left\{\begin{array}{rcl}{s_t}^{T}h_j,       &      & dot\\{s_t}^{T}W_ah_j,     &      & general\\W_a[s_t,h_j],     &      & concat\end{array} \right.</script><p>æœ€åï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£scoreå‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h4 id="è®¡ç®—context-vector-1"><a href="#è®¡ç®—context-vector-1" class="headerlink" title="è®¡ç®—context vector"></a>è®¡ç®—context vector</h4><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/10.jpg" alt> </p><p>context vectorçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">c_t=\sum_{j=1}^{T_X}\alpha_{t,j}h_{j},</script><p>å…¶ä¸­ï¼Œ$\alpha_{t,j}$è¡¨ç¤ºå¯¹é½å‘é‡ï¼Œä¹Ÿå°±æ˜¯æ³¨æ„åŠ›æƒé‡ï¼Œ$h_j$è¡¨ç¤ºencoderä¸­jæ—¶åˆ»çš„hidden stateã€‚</p><h4 id="è®¡ç®—decoderä¸­æ¯ä¸€ä¸ªæ—¶åˆ»æœ€ç»ˆçš„hidden-state"><a href="#è®¡ç®—decoderä¸­æ¯ä¸€ä¸ªæ—¶åˆ»æœ€ç»ˆçš„hidden-state" class="headerlink" title="è®¡ç®—decoderä¸­æ¯ä¸€ä¸ªæ—¶åˆ»æœ€ç»ˆçš„hidden state"></a>è®¡ç®—decoderä¸­æ¯ä¸€ä¸ªæ—¶åˆ»æœ€ç»ˆçš„hidden state</h4><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/11.jpg" alt></p><p>å°†context vector å’Œ decoderçš„hidden states ä¸²èµ·æ¥ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\hat s_t=tanh(W_c[c_t,s_t])</script><h4 id="è®¡ç®—è¾“å‡º"><a href="#è®¡ç®—è¾“å‡º" class="headerlink" title="è®¡ç®—è¾“å‡º"></a>è®¡ç®—è¾“å‡º</h4><p>context vectorå’Œdecoderçš„hidden stateåˆèµ·æ¥é€šè¿‡ä¸€ç³»åˆ—éçº¿æ€§è½¬æ¢ä»¥åŠsoftmaxæœ€åè®¡ç®—å‡ºæ¦‚ç‡ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">p(\hat y_{t}|\hat y_1,\hat y_2,...,\hat. y_{t-1},X)=softmax(W_s\hat s_t)</script><p>åœ¨ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œå°†$s_t$ã€$\hat y_t$ä½œä¸ºç¬¬äºŒä¸ªèŠ‚ç‚¹çš„è¾“å…¥ï¼Œå¾ªç¯ä¸Šè¿°è¿‡ç¨‹ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œè¿˜å°†$\hat s_t$ä½œä¸ºç¬¬äºŒä¸ªèŠ‚ç‚¹çš„è¾“å…¥ï¼Œç”¨æ¥è¾…åŠ©å½“å‰èŠ‚ç‚¹çš„å¯¹é½å†³ç­–è¿‡ç¨‹ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/12.jpg" alt></p><p>å…³äºglobal attentionï¼Œè¿˜æœ‰ä¸€ä¸ªæ²¡æœ‰è®²çš„çŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯scoreå‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä¸‹é¢ä»¥dotä¸generalä¸ºä¾‹ï¼Œè¿›è¡Œè¯´æ˜ã€‚</p><p><strong>dot</strong></p><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/dot.jpg" alt></p><p>è¿‡ç¨‹ï¼š</p><blockquote><p>æ³¨æ„ï¼Œä¸‹é¢æè¿°éƒ¨åˆ†å¯èƒ½ä¸å‰é¢å…¬å¼ä¸ç¬¦åˆï¼Œæ˜¯å› ä¸ºå‰é¢çš„å…¬å¼çš„è¡¨ç¤ºæ˜¯ç”¨åŠ æƒå¹³å‡å’Œæ¥è¡¨ç¤ºï¼Œè€Œä¸‹é¢æè¿°æ˜¯ç”¨çŸ©é˜µç›¸ä¹˜æ¥æè¿°çš„ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼</p></blockquote><p>è¾“å…¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š1.encoderä¸­æ‰€æœ‰çš„hidden state Hï¼Œç»´åº¦æ˜¯: (hid dim1 ,sequence length)ï¼›2.decoderä¸­åœ¨åŒä¸€æ—¶åˆ»çš„hidden state sï¼Œå…¶ç»´åº¦æ˜¯: (hid dim1,1)ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šè½¬ç½®Hï¼Œå†ä¸sç‚¹ä¹˜ï¼Œå¾—åˆ°ç»´åº¦ä¸º(sequence,1)çš„åˆ†æ•°ï¼›</p><p>ç¬¬äºŒæ­¥ï¼šå¯¹åˆ†æ•°è¿›è¡Œsoftmaxï¼Œå¾—åˆ°å’Œä¸º1çš„<strong>æƒé‡ï¼ˆå¯¹é½å‘é‡ï¼‰</strong>ï¼›</p><p>ç¬¬ä¸‰æ­¥ï¼šå°†Hä¸ç¬¬äºŒæ­¥å¾—åˆ°çš„åˆ†æ•°ç›¸ä¹˜ï¼Œå¾—åˆ°(dim1,1)çš„context vectorã€‚</p><p><strong>general</strong></p><p><img src="/2020/02/17/NLP%EF%BD%9CBahdanau-Attention%E4%B8%8ELuong-Attention/general.jpg" alt></p><p>è¿‡ç¨‹ï¼š</p><blockquote><p>æ³¨æ„ï¼Œä¸‹é¢æè¿°éƒ¨åˆ†å¯èƒ½ä¸å‰é¢å…¬å¼ä¸ç¬¦åˆï¼Œæ˜¯å› ä¸ºå‰é¢çš„å…¬å¼çš„è¡¨ç¤ºæ˜¯ç”¨åŠ æƒå¹³å‡å’Œæ¥è¡¨ç¤ºï¼Œè€Œä¸‹é¢æè¿°æ˜¯ç”¨çŸ©é˜µç›¸ä¹˜æ¥æè¿°çš„ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼</p></blockquote><p>è¾“å…¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š1.encoderä¸­æ‰€æœ‰çš„hidden state Hï¼Œç»´åº¦æ˜¯: (hid dim1 ,sequence length)ï¼›2.decoderä¸­åœ¨åŒä¸€æ—¶åˆ»çš„hidden state sï¼Œå…¶ç»´åº¦æ˜¯: (hid dim2,1)ã€‚<strong>äºŒè€…ç»´åº¦å¹¶ä¸ä¸€æ ·ï¼</strong></p><p>ç¬¬ä¸€æ­¥ï¼šè½¬ç½®Hä¸º(sequence length,hid dim1)ï¼Œå†ä¸$W_a$ç›¸ä¹˜ï¼Œ$W_a$çš„ç»´åº¦ï¼š(hid dim1,hid dim2)ï¼Œæœ€åå†ä¸$s$åšç‚¹ä¹˜ï¼Œå¾—åˆ°ä¸€ä¸ª(sequence,1)çš„åˆ†æ•°ï¼›</p><p>ç¬¬äºŒæ­¥ï¼šå¯¹åˆ†æ•°è¿›è¡Œsoftmaxï¼Œå¾—åˆ°å’Œä¸º1çš„<strong>æƒé‡ï¼ˆå¯¹é½å‘é‡ï¼‰</strong>ï¼›</p><p>ç¬¬ä¸‰æ­¥ï¼šå°†Hä¸ç¬¬äºŒæ­¥å¾—åˆ°çš„åˆ†æ•°åšç‚¹ä¹˜ï¼Œå¾—åˆ°(hid dim2,1)çš„<strong>context vevtorã€‚</strong></p><h3 id="Local-attention"><a href="#Local-attention" class="headerlink" title="Local attention"></a>Local attention</h3><p>local attentionæ˜¯soft attentionä¸hard attentionçš„ä¸€ç§æŠ˜è¡·æ–¹æ¡ˆã€‚å…¶åœ¨è®¡ç®—context vectorçš„æ—¶å€™ï¼Œæ¯æ¬¡åªè€ƒè™‘encoderä¸­æ‰€æœ‰hidden stateçš„ä¸€ä¸ªå­é›†ã€‚ç”±äºlocal attentionä¸global attentionååˆ†ç±»ä¼¼ï¼Œä¸‹é¢å°†ç€é‡ä»‹ç»å…¶ä¸global attentionä¸åŒçš„åœ°æ–¹ï¼Œç›¸åŒéƒ¨åˆ†å°±çœç•¥äº†ã€‚</p><p>local attentionåœ¨è®¡ç®—context vectorçš„æ—¶å€™ï¼Œåªè€ƒè™‘encoderä¸­æ‰€æœ‰hidden stateçš„ä¸€ä¸ªå­é›†ã€‚é‚£ä¹ˆå¦‚ä½•æ‰¾åˆ°è¿™ä¸ªå­é›†å‘¢ï¼Ÿlocal attentionçš„åšæ³•å¦‚ä¸‹ï¼š</p><p>local attentioné’ˆå¯¹tæ—¶åˆ»çš„è¾“å‡ºï¼Œç”Ÿæˆä¸€ä¸ªä»–åœ¨æºè¾“å…¥åºåˆ—ä¸­çš„å¯¹é½ä½ç½®$p_t$ï¼Œæ¥ç€åœ¨æºè¾“å…¥åºåˆ—ä¸­é€‰å–ä¸€ä¸ªçª—å£ï¼š$[p_t-D,p_t+D]$ï¼Œå…¶ä¸­$D$æ ¹æ®ç»éªŒç»™å‡ºã€‚context vectorçš„è®¡ç®—åˆ™æ ¹æ®çª—å£å†…æ‰€æœ‰çš„hidden stateçš„åŠ æƒå¹³å‡å¾—åˆ°ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å¾—åˆ°è¿™ä¸ªå¯¹é½ä½ç½®$p_t$å‘¢ï¼Ÿlocal attentionç»™å‡ºäº†ä¸¤ç§æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><ol><li>å•ä¸€å¯¹é½ï¼šå³ç®€å•ç²—æš´åœ°è®¾ç½®$p_t=t$ï¼Œå¯¹é½å‘é‡ä¸context vectorçš„è®¡ç®—å…¬å¼ï¼Œä¸å‰é¢çš„å…¬å¼ä¸€æ ·ï¼š$\alpha_{t,j}=\frac {exp(e_{t,j})}{\sum_{k={p_t-D}}^{p_t+D}exp(e_{t,k})}$ï¼Œ$c_t=\sum_{j=p_t-D}^{p_t+D}\alpha_{t,j}h_j$ã€‚</li><li>é¢„æµ‹å¯¹é½ï¼šé’ˆå¯¹æ¯ä¸ªé¢„æµ‹è¯ï¼Œé¢„æµ‹å…¶åœ¨æºè¾“å…¥åºåˆ—ä¸­çš„å¯¹é½ä½ç½®ã€‚å…¬å¼å¦‚ä¸‹ï¼š</li></ol><script type="math/tex; mode=display">p_t=SÂ·sigmoid(v_p^Ttanh(W_ph_t))</script><script type="math/tex; mode=display">\alpha_{t,j}=\frac {exp(e_{t,j})}{\sum_{k={p_t-D}}^{p_t+D}exp(e_{t,k})}exp(-\frac{(j-p_t)^2}{2\sigma^2})</script><p>å…¶ä¸­ï¼Œ$S$è¡¨ç¤ºæºè¾“å…¥åºåˆ—çš„é•¿åº¦ï¼Œæ‰€ä»¥$p_t$çš„å¤§å°åœ¨åŒºé—´$[0,S]$ä¹‹é—´ã€‚</p><p><strong>Luong attentionåˆ°æ­¤å°±è®²å®Œäº†ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š</strong></p><ol><li><p>luong attentionæ˜¯bahdanau attentionçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œè€Œä¸”è®¡ç®—ä»£ä»·ä¹Ÿæ›´å°ã€‚global attentionä¸bandanau attentionéå¸¸çš„ç±»ä¼¼ï¼Œåªæ˜¯è®¡ç®—è·¯å¾„ä¸åŒï¼Œglobal attentionçš„è®¡ç®—è·¯å¾„æ˜¯: $s_t-&gt;\alpha_t(s)-&gt;c_t-&gt;\hat s_{t}$;bahdanau attentionçš„è®¡ç®—è·¯å¾„æ˜¯ï¼š$s_{t-1}-&gt;\alpha_{t}(s)-&gt;c_t-&gt;s_{t}$ã€‚</p></li><li><p>local attentionæ˜¯soft attentionä¸hard attentionçš„æŠ˜è¡·æ–¹æ¡ˆï¼Œä¸global ä¸åŒçš„åœ°æ–¹åœ¨äºï¼šè®¡ç®—context vectorçš„æ—¶å€™ï¼Œåªè€ƒè™‘encoderä¸­æ‰€æœ‰hidden stateçš„å­é›†ï¼Œå…¶ä½™éƒ¨åˆ†ä¸€æ ·ã€‚</p></li></ol><h2 id="Attentionæœºåˆ¶æ€»ç»“"><a href="#Attentionæœºåˆ¶æ€»ç»“" class="headerlink" title="Attentionæœºåˆ¶æ€»ç»“"></a>Attentionæœºåˆ¶æ€»ç»“</h2><p>Soft Attentionï¼šæŒ‡çš„æ˜¯åœ¨æ±‚æ³¨æ„åŠ›æƒé‡çš„æ—¶å€™ï¼Œå¯¹äºæºè¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¯éƒ½ç»™äºˆæƒé‡ï¼›</p><p>Hard Attentionï¼šç›´æ¥ä»è¾“å…¥å¥å­é‡Œé¢æ‰¾åˆ°æŸä¸ªç‰¹å®šçš„å•è¯ï¼Œç„¶åæŠŠç›®æ ‡å¥å­å•è¯å’Œè¿™ä¸ªå•è¯å¯¹é½ï¼Œè€Œå…¶å®ƒè¾“å…¥å¥å­ä¸­çš„å•è¯ç¡¬æ€§åœ°è®¤ä¸ºå¯¹é½æ¦‚ç‡ä¸º0ã€‚</p><p>Global attentionå±äºsoft attentionï¼›</p><p>local Attentionä¸¥æ ¼æ¥è¯´ä¹Ÿå±äºsoft attentionï¼Œä½†æ˜¯ä¸€èˆ¬çœ‹ä½œæ˜¯softå’Œhardçš„ä¸€ç§ç»“åˆï¼›</p><p>è¿˜æœ‰ attention over attentionã€self -attentionç­‰ç­‰ã€‚</p><p>å…³äºattentionçš„åº”ç”¨éå¸¸å¤šï¼Œä¹‹åæœ‰æœºä¼šè¿˜ä¼šå†å†™å†™å…³äºAttentionçš„æ–‡ç« ï½</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li>ã€ŠNeural Machine Translation by Jointly Learning to Align and Translateã€‹</li><li>ã€ŠEffective Approaches to Attention-based Neural Machine Translationã€‹</li><li><a href="https://medium.com/@shashank7.iitd/understanding-attention-mechanism-35ff53fc328e" target="_blank" rel="noopener">https://medium.com/@shashank7.iitd/understanding-attention-mechanism-35ff53fc328e</a></li><li><a href="https://zhuanlan.zhihu.com/p/40920384" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/40920384</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> Attention </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP|LSTMä¸GRU</title>
      <link href="2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/"/>
      <url>2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/</url>
      
        <content type="html"><![CDATA[<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»å­¦äº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯æ²¡æœ‰è¾“å‡ºï¼Œæ€»æ„Ÿè§‰ä¼¼ä¹å°‘äº†ç‚¹ä»€ä¹ˆã€‚è¿™ç¯‡åšå®¢å°†å›é¡¾ç»å…¸çš„LSTMä¸GRUã€‚LSTMä¸GRUæ˜¯RNNä¸­æœ€ä¸ºç»å…¸çš„unitï¼Œå®ƒçš„æå‡ºè§£å†³äº†RNNä¸­æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œéå¸¸åœ°å…·æœ‰å¼€åˆ›æ€§ã€‚æœ¬æ–‡å°†å…·ä½“æ¢ç©¶å…¶åŸç†ç»†èŠ‚ã€‚</p><a id="more"></a><blockquote><p>æœ¬æ–‡çš„ç¬¦å·ä½“ç³»å€Ÿé‰´andrew Ngçš„ã€Šdeep learningã€‹è¯¾ç¨‹ã€‚</p></blockquote><h2 id="ä¸ºä»€ä¹ˆè¦æœ‰LSTMï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰LSTMï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰LSTMï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰LSTMï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹åŸºæœ¬çš„RNNç½‘ç»œæ¶æ„ï¼š</p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/RNN.jpg" alt></p><p><strong>å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼š</strong></p><p>tæ—¶åˆ»çš„æ¿€æ´»å€¼ä¸è¾“å‡ºå€¼çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">a^{<t>}=tanh(W_a[a^{<t-1>},x^{<t>}]+b_a)</script><script type="math/tex; mode=display">y^{<t>}=g(W_ya^{<t>}+b_y)</script><blockquote><p> æ³¨æ„ï¼šåŒä¸€å±‚ï¼Œæ‰€æœ‰çš„$W_a$å‚æ•°éƒ½æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çš„$W_y$å‚æ•°éƒ½æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çš„$b_a$å‚æ•°éƒ½æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çš„$b_y$å‚æ•°éƒ½æ˜¯å…±äº«çš„ã€‚</p></blockquote><p><strong>åå‘ä¼ æ’­è¿‡ç¨‹ï¼ˆBPTTï¼‰ï¼š</strong></p><p>ç¡®å®šä¼˜åŒ–å‚æ•°ï¼š$W_a$ã€$W_y$ã€$b_a$ã€$b_y$ã€‚</p><p>æ¥ä¸‹æ¥éœ€è¦å®šä¹‰loss functionï¼Œä»¥äºŒåˆ†ç±»é—®é¢˜ä¸ºä¾‹ï¼Œä½¿ç”¨åäº¤å‰ç†µï¼Œåˆ™è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">L^{<t>}(y^{<t>},\widehat{y}^{<t>})=-y^{<t>}log(\widehat{y}^{<t>})-(1-y^{<t>})log(\widehat{y}^{<1-t>})</script><script type="math/tex; mode=display">L(y^{<t>},\widehat{y}^{<t>})=\sum_{t=1}^{T_x}L^{}(y^{<t>},\widehat{y}^{<t>})</script><p>ä¹‹åä¸æ–­ä½¿ç”¨SGD/mini-batch GDæˆ–è€…å…¶ä»–çš„ä¼˜åŒ–ç®—æ³•ï¼Œä¼˜åŒ–å‚æ•°ï¼š$W_a$ã€$W_y$ã€$b_a$ã€$b_y$ï¼Œä¾¿å¯å®Œæˆæ•´ä¸ªåå‘ä¼ æ’­è¿‡ç¨‹ã€‚</p><p><strong>æ¢¯åº¦æ¶ˆå¤±</strong></p><p>ä½†æ˜¯RNNä¸ä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œä¸€æ ·ï¼Œå¦‚æœéšç€åºåˆ—é•¿åº¦çš„å¢åŠ ï¼Œä¼šå­˜åœ¨æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚åŸå› åœ¨äºï¼šå½“æˆ‘ä»¬å¯¹è¿›è¡Œåå‘ä¼ æ’­çš„æ—¶å€™ï¼Œè­¬å¦‚æˆ‘ä»¬è®¡ç®—$W_a$ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°è¿™ä¸ªå¼å­ï¼š$W_a=\prod_{t=1}^{T_x}{tanh}â€™W_a$ã€‚ç”±äºtanhå‡½æ•°çš„å¯¼æ•°åœ¨(0,1)ä¹‹é—´ï¼Œå¦‚æœåœ¨åå‘ä¼ æ’­çš„æ—¶å€™ï¼Œå½“å‚æ•°$W_a$åˆå§‹åŒ–ä¸ºå°äº1çš„æ•°ï¼Œé‚£ä¹ˆåå¯¼ç›¸ä¹˜çš„ç»“æœå°±ä¼šè¿œè¿œå°äº1ï¼Œä»è€Œå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚ä½†æ˜¯ç”±äºRNNä¸­æ¢¯åº¦ç›¸åŠ ï¼Œæ‰€ä»¥æ¢¯åº¦æ°¸è¿œä¸ä¼šç­‰äº0ã€‚å‚çœ‹é“¾æ¥ï¼š<a href="https://blog.csdn.net/jizhidexiaoming/article/details/81743584" target="_blank" rel="noopener">RNNæ¢¯åº¦æ¶ˆå¤±çš„åŸå› </a></p><p>ç”±äºRNNæ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æ¢¯åº¦è¢«è¿‘è·ç¦»ä¸»å¯¼ï¼Œä»è€Œå¯¼è‡´æ¨¡å‹éš¾ä»¥å­¦åˆ°è¿œè·ç¦»çš„ä¾èµ–å…³ç³»ï¼ˆé•¿æ—¶æœŸä¾èµ–é—®é¢˜ï¼‰ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆLSTMè¢«æå‡ºçš„åŸå› ï¼Œå› ä¸ºLSTMèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><h2 id="LSTMåŸç†å‰–æ"><a href="#LSTMåŸç†å‰–æ" class="headerlink" title="LSTMåŸç†å‰–æ"></a>LSTMåŸç†å‰–æ</h2><p>LSTMï¼Œå…¨ç§°long-short term memory networksã€‚LSTMçš„è®¾è®¡å°±æ˜¯ä¸ºäº†é¿å…ä¸ŠèŠ‚æ‰€è¯´çš„é•¿æ—¶æœŸä¾èµ–é—®é¢˜ï¼Œèƒ½å¤Ÿè®°ä½å¾ˆé•¿æ—¶é—´å†…åœ°ä¿¡æ¯ã€‚</p><h3 id="RNNä¸LSTMå†…éƒ¨ç»“æ„"><a href="#RNNä¸LSTMå†…éƒ¨ç»“æ„" class="headerlink" title="RNNä¸LSTMå†…éƒ¨ç»“æ„"></a>RNNä¸LSTMå†…éƒ¨ç»“æ„</h3><p>RNNå†…éƒ¨ç»“æ„å¦‚ä¸‹ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/2.RNNå†…éƒ¨ç»“æ„.png" alt></p><p>LSTMå†…éƒ¨ç»“æ„å¦‚ä¸‹ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/3.lstmå†…éƒ¨ç»“æ„.png" alt></p><h3 id="LSTMå†…éƒ¨ç»“æ„å‰–æ"><a href="#LSTMå†…éƒ¨ç»“æ„å‰–æ" class="headerlink" title="LSTMå†…éƒ¨ç»“æ„å‰–æ"></a>LSTMå†…éƒ¨ç»“æ„å‰–æ</h3><h4 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a>é—å¿˜é—¨</h4><p>é—å¿˜é—¨å†³å®šè¦ä¿ç•™å“ªäº›ä¿¡æ¯ç»§ç»­é€šè¿‡å½“å‰çš„cellã€‚$f_t$é€šè¿‡sigmoidå‡½æ•°å®ç°ï¼Œä»è€Œå°†$f_t$é™åˆ¶åœ¨(0,1)ä¹‹é—´ã€‚0è¡¨ç¤ºä¸è®©ä»»ä½•ä¿¡æ¯é€šè¿‡ï¼Œ1è¡¨ç¤ºè®©æ‰€æœ‰ä¿¡æ¯é€šè¿‡ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/4.é—å¿˜é—¨.png" alt></p><h4 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a>è¾“å…¥é—¨</h4><p>è¾“å…¥é—¨å†³å®šè®©å¤šå°‘æ–°çš„ä¿¡æ¯åŠ å…¥åˆ°å½“å‰cellçš„çŠ¶æ€ä¸­ã€‚è¿™åˆ†æˆä¸¤æ­¥ï¼šé¦–å…ˆé€šè¿‡sigmoidå‡½æ•°å¾—åˆ°è¾“å…¥é—¨$i_t$ï¼Œå†é€šè¿‡tanhå¾—åˆ°å¤‡é€‰çš„è¦æ›´æ–°çš„å†…å®¹ã€‚æœ€åï¼Œè”åˆè¿™ä¸¤éƒ¨åˆ†ï¼Œä»è€Œå¯¹å½“å‰cellçš„çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/5.æ›´æ–°é—¨.png" alt></p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/6.æ›´æ–°èŠ‚ç‚¹çŠ¶æ€.png" alt></p><h4 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h4><p>è¾“å‡ºé—¨å†³å®šè¦è¾“å‡ºå“ªäº›ä¿¡æ¯ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªcellã€‚å½“å‰cellçš„è¾“å‡ºæ˜¯ä¾èµ–äº$C_t$çš„å€¼ï¼Œä½†æ˜¯ä¸å®Œå…¨ä¾èµ–äº$C_t$çš„å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨tanhå‡½æ•°å¯¹å…¶è¿›è¡Œäº†è¿‡æ»¤ã€‚è€Œè¾“å‡ºé—¨$o_t$é€šè¿‡sigmoidå‡½æ•°å¾—åˆ°ä¸€ä¸ª(0,1)çš„å€¼ï¼Œä»è€Œå†³å®šè¾“å‡ºè¿‡æ»¤åçš„$C_t$å€¼çš„å“ªäº›éƒ¨åˆ†ã€‚</p><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/7.è¾“å‡ºé—¨.png" alt></p><h2 id="LSTMå˜ç§â€”GRU"><a href="#LSTMå˜ç§â€”GRU" class="headerlink" title="LSTMå˜ç§â€”GRU"></a>LSTMå˜ç§â€”GRU</h2><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/8.GRU.png" alt></p><h2 id="LSTMå˜ç§â€”peehole-connection"><a href="#LSTMå˜ç§â€”peehole-connection" class="headerlink" title="LSTMå˜ç§â€”peehole connection"></a>LSTMå˜ç§â€”peehole connection</h2><p><img src="/2020/02/17/NLP%EF%BD%9CLSTM%E4%B8%8EGRU/8.peehole connection.png" alt></p><h2 id="ä¸€äº›ç»†èŠ‚"><a href="#ä¸€äº›ç»†èŠ‚" class="headerlink" title="ä¸€äº›ç»†èŠ‚"></a>ä¸€äº›ç»†èŠ‚</h2><p>1.LSTMä¸ºä»€ä¹ˆèƒ½å¤Ÿè§£å†³æ¢¯åº¦æ¶ˆå¤±ï¼Ÿ</p><p>ç­”ï¼šç§˜è¯€å°±åœ¨è¿™ä¸ªå…¬å¼: <script type="math/tex">C_t=i_t*\widehat{C}_t+f_t*C_{t}</script>ã€‚åœ¨RNNä¸­ï¼Œæ¯ä¸ªè®°å¿†å•å…ƒh_t-1éƒ½ä¼šä¹˜ä¸Šä¸€ä¸ªWå’Œæ¿€æ´»å‡½æ•°çš„å¯¼æ•°ï¼Œè¿™ç§è¿ä¹˜ä½¿å¾—è®°å¿†è¡°å‡çš„å¾ˆå¿«ï¼Œè€ŒLSTMæ˜¯é€šè¿‡è®°å¿†å’Œå½“å‰è¾“å…¥â€ç›¸åŠ â€ï¼Œä½¿å¾—ä¹‹å‰çš„è®°å¿†ä¼šç»§ç»­å­˜åœ¨è€Œä¸æ˜¯å—åˆ°ä¹˜æ³•çš„å½±å“è€Œéƒ¨åˆ†â€œæ¶ˆå¤±â€ï¼Œå› æ­¤ä¸ä¼šè¡°å‡ã€‚å› ä¸ºLSTMå¯¹è®°å¿†çš„æ“ä½œæ˜¯ç›¸åŠ çš„ï¼Œçº¿æ€§çš„ï¼Œä½¿å¾—ä¸åŒæ—¶åºçš„è®°å¿†å¯¹å½“å‰çš„å½±å“ç›¸åŒï¼Œä¸ºäº†è®©ä¸åŒæ—¶åºçš„è®°å¿†å¯¹å½“å‰å½±å“å˜å¾—å¯æ§ï¼ŒLSTMå¼•å…¥äº†è¾“å…¥é—¨å’Œè¾“å‡ºé—¨ï¼Œä¹‹ååˆæœ‰äººå¯¹LSTMè¿›è¡Œäº†æ‰©å±•ï¼Œå¼•å…¥äº†é—å¿˜é—¨ã€‚</p><p>2.RNNä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨tanhï¼Ÿä¸ºå•¥ä¸ä½¿ç”¨Reluï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥ç”¨ï¼Œä½†æ˜¯ä¸ç”¨ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š1.reluå‡½æ•°çš„å€¼åŸŸæ˜¯0åˆ°æ— ç©·ï¼Œå¦‚æœç›´æ¥ç›´æ¥æŠŠæ¿€æ´»å‡½æ•°æ¢æˆReLUï¼Œä¼šå¯¼è‡´éå¸¸å¤§çš„è¾“å‡ºå€¼ï¼Œä¼šé€ æˆæº¢å‡ºï¼›2.ä½¿ç”¨reluä»ç„¶æ— æ³•è§£å†³æ¢¯åº¦åœ¨é•¿ç¨‹ä¸Šä¼ é€’çš„é—®é¢˜ã€‚å½“åå‘ä¼ æ’­çš„æ—¶å€™ï¼Œæœ€åè®¡ç®—çš„ç»“æœä¼šå˜æˆå¤šä¸ªWè¿ä¹˜ï¼Œå¦‚æœWä¸­å­˜åœ¨ç‰¹å¾å€¼&gt;1çš„ï¼Œé‚£ä¹ˆç»è¿‡BPTTè¿ä¹˜åå¾—åˆ°çš„å€¼ä¼šçˆ†ç‚¸ï¼Œäº§ç”Ÿæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œä½¿å¾—RNNä»ç„¶æ— æ³•ä¼ é€’è¾ƒè¿œè·ç¦»ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/" target="_blank" rel="noopener">http://colah.github.io/posts/2015-08-Understanding-LSTMs/</a></p>]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> LSTM </tag>
            
            <tag> GRU </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>githubä¸Šä¼ é¡¹ç›®æŒ‡å—</title>
      <link href="2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/"/>
      <url>2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©åˆ·å®Œäº†ã€Šå‰‘æŒ‡offerã€‹(repo:<a href="https://github.com/codewithzichao/CodingInterviewCode" target="_blank" rel="noopener">CodingInterviewCode</a>)ï¼Œæ’’èŠ±ğŸ‰å¹¶ä¸”ï¼Œæ‹¾èµ·äº†æ—©æ—©å°±æ³¨å†Œä½¿ç”¨å´æ²¡æœ‰å¥½å¥½åœ°ç®¡ç†çš„æˆ‘çš„githubã€‚å› æ­¤ï¼Œæ€»ç»“ä¸€ä¸‹ä½¿ç”¨gitä¸Šä¼ æœ¬åœ°é¡¹ç›®åˆ°è‡ªå·±çš„githubä¸Šçš„æµç¨‹ï¼Œä»¥ä¾¿ä»¥åæŸ¥é˜…ã€‚</p><a id="more"></a><p><strong>ç›®æ ‡ï¼š</strong>ä¸Šä¼ æœ¬åœ°é¡¹ç›®åˆ°è‡ªå·±githubçš„repoä¸­ã€‚</p><p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><h3 id="æ£€æŸ¥gitæ˜¯å¦å®‰è£…"><a href="#æ£€æŸ¥gitæ˜¯å¦å®‰è£…" class="headerlink" title="æ£€æŸ¥gitæ˜¯å¦å®‰è£…"></a>æ£€æŸ¥gitæ˜¯å¦å®‰è£…</h3><p>è¾“å…¥git â€”versionæŸ¥çœ‹æœ¬åœ°æ˜¯å¦å·²ç»å®‰è£…gitã€‚</p><p><img src="/2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/1.gitç‰ˆæœ¬.jpg" alt></p><h3 id="åˆ›å»ºssh"><a href="#åˆ›å»ºssh" class="headerlink" title="åˆ›å»ºssh"></a>åˆ›å»ºssh</h3><p>åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºsshï¼Œå‘½ä»¤ï¼š<code>ssh-keygen -t rsa -C xxx@xx.com</code>ã€‚</p><p><img src="/2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/2.åˆ›å»ºssh.jpg" alt></p><h3 id="æ‰“å¼€id-rsa-pubæ–‡ä»¶ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°gtihubä¸­"><a href="#æ‰“å¼€id-rsa-pubæ–‡ä»¶ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°gtihubä¸­" class="headerlink" title="æ‰“å¼€id_rsa.pubæ–‡ä»¶ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°gtihubä¸­"></a>æ‰“å¼€id_rsa.pubæ–‡ä»¶ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°gtihubä¸­</h3><p>æ‰“å¼€id_rsa.pubæ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>open id_sra.pub</code>æˆ–è€…<code>cat id_rsa.pub</code>ã€‚</p><p><img src="/2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/3.åˆ›å»ºssh key.jpg" alt></p><h3 id="æ£€éªŒæ˜¯å¦è¿æ¥æˆåŠŸ"><a href="#æ£€éªŒæ˜¯å¦è¿æ¥æˆåŠŸ" class="headerlink" title="æ£€éªŒæ˜¯å¦è¿æ¥æˆåŠŸ"></a>æ£€éªŒæ˜¯å¦è¿æ¥æˆåŠŸ</h3><p>åœ¨æœ¬åœ°çš„ç”µè„‘ä¸Šæ·»åŠ ç§é’¥ ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>ssh-add id_rsa</code>ï¼›ä¹‹åï¼Œåœ¨è¾“å…¥å‘½ä»¤ï¼š<code>ssh -T git@github.com</code>ã€‚å¦‚æœæ­¤æ—¶å“åº”ï¼šHi encoreMiao! Youâ€™ve successfully authenticated, but GitHub does not provide shell access.ä¾¿æ˜¯é…ç½®æˆåŠŸäº†ã€‚</p><h3 id="åœ¨è‡ªå·±çš„-githubä¸­åˆ›å»ºæ–°çš„repo"><a href="#åœ¨è‡ªå·±çš„-githubä¸­åˆ›å»ºæ–°çš„repo" class="headerlink" title="åœ¨è‡ªå·±çš„ githubä¸­åˆ›å»ºæ–°çš„repo"></a>åœ¨è‡ªå·±çš„ githubä¸­åˆ›å»ºæ–°çš„repo</h3><p>æ³¨æ„ï¼Œæ­¤æ—¶ä¸è¦é€‰æ‹©initialize this repository with a READMEã€‚</p><p><img src="/2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/4.åˆ›å»ºrepo.jpg" alt></p><h3 id="cloneåˆšåˆšåˆ›å»ºå¥½çš„repoåˆ°è‡ªå·±æƒ³åˆ°çš„è·¯å¾„ä¸‹"><a href="#cloneåˆšåˆšåˆ›å»ºå¥½çš„repoåˆ°è‡ªå·±æƒ³åˆ°çš„è·¯å¾„ä¸‹" class="headerlink" title="cloneåˆšåˆšåˆ›å»ºå¥½çš„repoåˆ°è‡ªå·±æƒ³åˆ°çš„è·¯å¾„ä¸‹"></a>cloneåˆšåˆšåˆ›å»ºå¥½çš„repoåˆ°è‡ªå·±æƒ³åˆ°çš„è·¯å¾„ä¸‹</h3><p>ä½¿ç”¨å‘½ä»¤ï¼š<code>git clone https://github.com/codewithzichao/CodingInterviewCode.git</code>å³å¯ã€‚</p><h3 id="åˆ‡æ¢åˆ°åˆšåˆšä¸‹è½½å¥½çš„repoæ–‡ä»¶å¤¹ä¸‹"><a href="#åˆ‡æ¢åˆ°åˆšåˆšä¸‹è½½å¥½çš„repoæ–‡ä»¶å¤¹ä¸‹" class="headerlink" title="åˆ‡æ¢åˆ°åˆšåˆšä¸‹è½½å¥½çš„repoæ–‡ä»¶å¤¹ä¸‹"></a>åˆ‡æ¢åˆ°åˆšåˆšä¸‹è½½å¥½çš„repoæ–‡ä»¶å¤¹ä¸‹</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ğŸ‘‡ï¼Œä»è€Œåˆ›å»ºæœ¬åœ°ä»“åº“ä»¥åŠä»£ç ä¸Šä¼ ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ touch README.md                                         //æ–°å»ºä¸€ä¸ªREADMEæ–‡æ¡£ï¼Œè‹¥ä¸Šä¸€æ­¥å‹¾é€‰äº†åˆ›å»ºREADME.mdï¼Œæäº¤æ—¶å¯¼è‡´å†²çª</span><br><span class="line">$ git init                                                //åˆå§‹åŒ–æœ¬åœ°ä»“åº“</span><br><span class="line">$ git add README.md                                       //æ·»åŠ åˆšåˆšåˆ›å»ºçš„READMEæ–‡æ¡£</span><br><span class="line">$ git commit -m <span class="string">"ä½ çš„æ³¨é‡Š...."</span>                             //æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå¹¶å†™ä¸€äº›æ³¨é‡Š</span><br><span class="line">$ git remote add origin git@github.com:yourname/xxxx.git  //è¿æ¥è¿œç¨‹ä»“åº“å¹¶å»ºäº†ä¸€ä¸ªåå«ï¼šoriginçš„åˆ«åï¼Œå½“ç„¶å¯ä»¥ä¸ºå…¶ä»–åå­—ï¼Œä½†æ˜¯originä¸€çœ‹å°±çŸ¥é“æ˜¯åˆ«åï¼Œyounameè®°å¾—æ›¿æ¢æˆä½ çš„ç”¨æˆ·å</span><br><span class="line">$ git push -u origin master                              //å°†æœ¬åœ°ä»“åº“çš„æ–‡ä»¶æäº¤åˆ°åˆ«åä¸ºoriginçš„åœ°å€çš„masteråˆ†æ”¯ä¸‹ï¼Œ-uä¸ºç¬¬ä¸€æ¬¡æäº¤ï¼Œéœ€è¦åˆ›å»ºmasteråˆ†æ”¯ï¼Œä¸‹æ¬¡å°±ä¸éœ€è¦äº†</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬é¡¹ç›®çš„æºä»£ç æäº¤ä¸Šå»ï¼Œä½¿ç”¨git addå‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git add ç³»ç»Ÿç­¾å/                                      // æ·»åŠ éœ€è¦æäº¤çš„æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨git add .  åˆ™æ·»åŠ å…¨éƒ¨</span><br><span class="line">$ git add assets/</span><br><span class="line">$ git add project.properties </span><br><span class="line">$ git add res/</span><br><span class="line">$ git add src/</span><br><span class="line">$ git commit -m <span class="string">"ä¸Šä¼ é¡¹ç›®æºä»£ç "</span>                         // æäº¤åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line">$ git push origin master                               // å°†æœ¬åœ°ä»“åº“åˆå¹¶åˆ°åˆ«åä¸ºoriginåœ°å€çš„masteråˆ†æ”¯ä¸‹</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼Œåˆ™ä»£ç ä¸Šä¼ æˆåŠŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Counting objects: 63, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (53/53), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (63/63), 1.41 MiB | 217.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 63 (delta 16), reused 0 (delta 0)</span><br><span class="line">To git@github.com:codewithzichao/CodingInterview.git</span><br><span class="line">   000a667..61357d8  master -&gt; master</span><br></pre></td></tr></table></figure><p>åˆ·æ–°ä¸€ä¸‹GitHubï¼Œåˆ™æ˜¾ç¤ºåˆšåˆšæäº¤çš„é¡¹ç›®æºä»£ç ã€‚</p><p><img src="/2020/02/17/github%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%8D%97/5,repo.jpg" alt></p><p>åˆ°æ­¤ï¼ŒæˆåŠŸï½</p><h3 id="æ³¨æ„äº‹é¡¹-è¸©è¿‡çš„å‘"><a href="#æ³¨æ„äº‹é¡¹-è¸©è¿‡çš„å‘" class="headerlink" title="æ³¨æ„äº‹é¡¹(è¸©è¿‡çš„å‘)"></a>æ³¨æ„äº‹é¡¹(è¸©è¿‡çš„å‘)</h3><p>1.å¦‚æœè¦åˆ é™¤æœ¬åœ°ä»“åº“é‡Œçš„æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥æ‰‹åŠ¨åˆ é™¤ï¼Œè¦ä½¿ç”¨å‘½ä»¤ï¼š<code>git rm &lt;æ–‡ä»¶å&gt;</code>æˆ–è€…<code>git rm -r &lt;æ–‡ä»¶å¤¹å&gt;</code>ã€‚è¦ä¸ç„¶çš„è¯ï¼Œgithubä¸Šä»ç„¶ä¼šæœ‰åŸæ¥çš„æ–‡ä»¶ã€‚</p><p>2.å½“ä¿®æ”¹æˆ–è€…å¢åŠ æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨å‘½ä»¤<code>git add &lt;æ–‡ä»¶å¤¹&gt;/</code>æˆ–è€…<code>git add &lt;æ–‡ä»¶å&gt;</code>ä¹‹åï¼Œä¸€å®šè¦æ‰§è¡Œ<code>git commit -m &quot;title&quot;</code>ï¼Œè¦å…ˆæäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œæœ€åå†æ‰§è¡Œ<code>git push origin master</code>å‘½ä»¤ï¼Œæ‰èƒ½å¤Ÿæ›´æ–°åˆ°githubã€‚å¦‚æœçœç•¥æ‰<code>git commit -m &quot;title&quot;</code>è¿™ä¸€æ­¥çš„è¯ï¼Œé‚£ä¹ˆä¿®æ”¹å°±ä¸ä¼šåŒæ­¥åˆ°githubä¸­ã€‚</p><p>overâ˜•ï¸ï½</p>]]></content>
      
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿ç ”PKUä¹‹è·¯</title>
      <link href="2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/"/>
      <url>2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘çš„ä¿ç ”ä¹‹è·¯äº2018å¹´9æœˆ28æ—¥ç¡®è®¤åŒ—å¤§çš„å½•å–é€šçŸ¥çš„é‚£ä¸€åˆ»ï¼Œå°±æ­£å¼å®£å‘Šç»“æŸäº†ã€‚ç°åœ¨ç®—ç®—ï¼Œå…¶å®å·²ç»è¿‡å»äº†ä¸€å¹´åŠäº†ã€‚æœ€è¿‘çªç„¶å¿ƒè¡€æ¥æ½®ï¼Œæƒ³è®°å½•ä¸€ä¸‹é‚£æ®µå…µæ…Œé©¬ä¹±å´åˆæ— æ¯”å……å®çš„æ—¥å­ã€‚ä¸€æ–¹é¢ï¼Œè¶è‡ªå·±å¯¹è¿™æ®µè®°å¿†è¿˜æ¸…æ™°çš„æ—¶å€™ï¼Œè®°å½•ä¸‹æ¥å‹‰åŠ±è‡ªå·±ï¼›å¦ä¸€æ–¹é¢ï¼Œä¹Ÿæ˜¯å¸Œæœ›èƒ½å¤Ÿå¯¹ç´ æ˜§è°‹é¢çš„ä¿ç ”erä»¬èƒ½å¤Ÿæœ‰æ‰€å¸®åŠ©ï½</p><a id="more"></a><h2 id="ä¸ªäººæƒ…å†µ"><a href="#ä¸ªäººæƒ…å†µ" class="headerlink" title="ä¸ªäººæƒ…å†µ"></a>ä¸ªäººæƒ…å†µ</h2><p><strong>æœ¬ç§‘å­¦æ ¡ï¼š</strong>æœ«æµ985</p><p><strong>ç»©ç‚¹æ’åï¼š</strong>2/70ï¼ˆæœ€ç»ˆ1/70ï¼‰</p><p><strong>å…­çº§æˆç»©ï¼š</strong>500è¾¹ç¼˜</p><p><strong>ç§‘ç ”æƒ…å†µï¼š</strong>ä¸€ç¯‡ä¸­æ–‡æ ¸å¿ƒï¼Œä¸€ç¯‡è‹±æ–‡åœ¨æŠ•ï¼ˆç›®å‰å·²å‘è¡¨ï¼‰</p><p><strong>è·å¥–æƒ…å†µï¼š</strong>3æ¬¡å›½å®¶å¥–å­¦é‡‘ï¼Œçœéƒ¨çº§åŠä»¥ä¸Šå¥–é¡¹5é¡¹</p><p><strong>ç¤¾ä¼šå®è·µï¼š</strong>2é¡¹</p><h2 id="å¤ä»¤è¥ç»å†ï¼ˆ2018å¹´3æœˆ1æ—¥â€”â€”2018å¹´7æœˆ27æ—¥ï¼‰"><a href="#å¤ä»¤è¥ç»å†ï¼ˆ2018å¹´3æœˆ1æ—¥â€”â€”2018å¹´7æœˆ27æ—¥ï¼‰" class="headerlink" title="å¤ä»¤è¥ç»å†ï¼ˆ2018å¹´3æœˆ1æ—¥â€”â€”2018å¹´7æœˆ27æ—¥ï¼‰"></a>å¤ä»¤è¥ç»å†ï¼ˆ2018å¹´3æœˆ1æ—¥â€”â€”2018å¹´7æœˆ27æ—¥ï¼‰</h2><p>å…¨å›½é«˜æ ¡çš„å¤ä»¤è¥ä»3æœˆä»½å¼€å­¦å°±é™†é™†ç»­ç»­åœ°å¼€å§‹äº†ï¼Œè€Œä¸”è¶Šå¥½çš„å­¦æ ¡å¼€å§‹æ—¶é—´è¶Šæ—©ï¼Œ6æœˆåˆ°8æœˆæ˜¯å¤ä»¤è¥å¼€è¥æ—¶é—´ã€‚æˆ‘åŒå­¦åœ¨3æœˆåˆçš„æ—¶å€™ï¼Œæ‹¿åˆ°äº†æ¸…åçš„offerï¼Œå°±ç»“æŸäº†ä»–çš„æ¨å…ä¹‹è·¯äº†ã€‚ã€‚ã€‚è†œ(sang)æ‹œ(xin)å·¨(bing)ä½¬(kuang)ğŸ˜·ã€‚æ‰€ä»¥åŠæ—¶è·å–ä¿¡æ¯å¾ˆé‡è¦ã€‚æˆ‘ä¸»è¦æ˜¯åœ¨ä¿ç ”è®ºå›ä»¥åŠå„ä¸ªå­¦æ ¡å­¦é™¢çš„å®˜ç½‘å¯»æ‰¾å¤ä»¤è¥ä¿¡æ¯ã€‚ä¹‹åæŒ‰ç…§å„ä¸ªå¤ä»¤è¥çš„è¦æ±‚ï¼Œå‡†å¤‡å¥½ç®€å†ã€æ¨èä¿¡ã€è·å¥–è¯ä¹¦ã€ç§‘ç ”è®ºæ–‡ç­‰ç­‰ï¼Œé‚®å¯„æˆ–è€…ç½‘ä¸Šç”³æŠ¥ã€‚  </p><p>å…³äºé€‰æ‹©å¤ä»¤è¥ï¼Œæˆ‘é‡‡å–äº†â€œé¢˜æµ·æˆ˜æœ¯â€ï¼Œå…¶å®æŠ•äº†æŒºå¤šå­¦æ ¡çš„ã€‚ä½†æ˜¯ç°åœ¨å›è¿‡å¤´æ¥çœ‹ï¼Œå…¶å®å¹¶ä¸æ¨èå¤§å®¶è¿™æ ·åšã€‚åŸå› æœ‰ä¸¤ä¸ªï¼šä¸€æ–¹é¢æ˜¯ï¼Œå¤§ä¸‰ä¸‹å­¦æœŸè¿˜æœ‰å¾ˆå¤šè¯¾ç¨‹ä¸è€ƒè¯•ï¼Œå…¶å®æ ¹æœ¬æ²¡æœ‰é‚£ä¹ˆå¤šçš„æ—¶é—´å»å‚åŠ å¾ˆå¤šçš„å¤ä»¤è¥ï¼›å¦ä¸€æ–¹é¢ï¼Œå‚åŠ å¤ä»¤è¥å¹¶æ²¡æœ‰å¤§å®¶æƒ³è±¡åœ°é‚£ä¹ˆè½»æ¾ï¼Œå‚è¥å‡†å¤‡è¿‡ç¨‹å…¶å®éå¸¸åœ°è€—è´¹ç²¾åŠ›ï¼›æ­¤å¤–ï¼Œè¿˜æœ‰å‡†å¤‡å¤ä»¤è¥çš„ææ–™ï¼Œä¹Ÿæ˜¯éå¸¸åŠ³æ°‘ä¼¤è´¢çš„äº‹æƒ…ã€‚æ‰€ä»¥å¤§å®¶åœ¨å‚åŠ å¤ä»¤è¥çš„æ—¶å€™ï¼Œä¸€å®šè¦æœ‰æ‰€é€‰æ‹©ã€‚</p><p>æˆ‘æ”¶åˆ°çš„å¤ä»¤è¥å‚è¥é€šçŸ¥æŒºå¤šçš„ï¼Œä»ä¸­é€‰æ‹©å‚åŠ äº†å‡ ä¸ªè‡ªå·±å–œæ¬¢çš„å¤ä»¤è¥ã€‚</p><h3 id="äººå¤§ä¿¡é™¢-2018å¹´7æœˆ8æ—¥â€”â€”2018å¹´7æœˆ10æ—¥"><a href="#äººå¤§ä¿¡é™¢-2018å¹´7æœˆ8æ—¥â€”â€”2018å¹´7æœˆ10æ—¥" class="headerlink" title="äººå¤§ä¿¡é™¢(2018å¹´7æœˆ8æ—¥â€”â€”2018å¹´7æœˆ10æ—¥)"></a>äººå¤§ä¿¡é™¢(2018å¹´7æœˆ8æ—¥â€”â€”2018å¹´7æœˆ10æ—¥)</h3><p>äººå¤§ä¿¡é™¢æ˜¯æˆ‘æœ€å…ˆæ”¶åˆ°å¤ä»¤è¥å‚è¥é€šçŸ¥(6æœˆ19æ—¥)ï¼Œæ­£å¥½é‚£æ®µæ—¶é—´æ²¡æœ‰è€ƒè¯•ï¼Œæ‰€ä»¥å°±æŠ±ç€å…´å¥‹çš„å¿ƒæƒ…å»å‚åŠ äº†ã€‚æˆ‘æ˜¯7æœˆ8æ—¥åˆ°çš„äººå¤§ï¼Œå½“æ—¶è¢«å®‰æ’ä½åœ¨å“å›­ï¼Œè¯´å®è¯æœ‰ç‚¹å¤±æœ›ï¼Œå› ä¸ºå“å›­çš„å®¿èˆçœŸçš„æå…¶åœ°ç ´ï¼Œä»¥è‡³äºæˆ‘ç°åœ¨å›å¿†èµ·æ¥ä»ç„¶æ˜¯è®°å¿†çŠ¹æ–°â€¦â€¦</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/äººå¤§å®‰æ’.jpeg" style="zoom:50%;"></p><center><font face="Times New Roman">1.äººå¤§ä¿¡é™¢å¤ä»¤è¥æ—¶é—´å®‰æ’</font></center><p>9å·ä¸Šåˆæœ‰å¼€è¥ä»ªå¼ï¼Œä¸»è¦æ˜¯ä»‹ç»å­¦é™¢çš„æ¦‚å†µã€ç§‘ç ”å›¢é˜Ÿä»¥åŠå­¦é™¢å°±ä¸šæƒ…å†µç­‰ç­‰ï¼Œæ€»ä¹‹å°±æ˜¯ä¸€é¡¿å¤¸ã€‚</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/äººå¤§ä¿¡é™¢å¼€è¥ä»ªå¼.jpeg" style="zoom:50%;"></p><center><font face="Times New Roman">2.äººå¤§ä¿¡é™¢å¼€è¥ä»ªå¼</font></center><p>9å·ä¸‹åˆæ˜¯æ­£å¼çš„é¢è¯•ã€‚é¢è¯•åˆ†ä¸ºè‹±æ–‡é¢è¯•+ä¸­æ–‡é¢è¯•ã€‚è‹±æ–‡é¢è¯•ä¼šç®€å•åœ°é—®ä¸€äº›å¤§å­¦ç”Ÿæ´»ï¼ŒåŸºæœ¬ä¸ä¼šæ¶‰åŠåˆ°ç§‘ç ”ç­‰æ–¹é¢ï¼›ä¸­æ–‡é¢è¯•å°±æ¯”è¾ƒä¸¥è‹›ï¼Œä¼šæ ¹æ®ç®€å†æ¥æé—®ã€‚æ¯”å¦‚ï¼Œå› ä¸ºæˆ‘å½“æ—¶ç®€å†ä¸Šæœ‰è®ºæ–‡ï¼Œæ‰€ä»¥è€å¸ˆç›´æ¥é—®äº†è®ºæ–‡çš„å†…å®¹ï¼Œè€Œä¸”è€å¸ˆé—®çš„éå¸¸çš„æ·±ï¼Œç”šè‡³è¦æˆ‘ä»‹ç»è®ºæ–‡ä¸­ä¸€äº›å…¬å¼çš„å˜é‡æ˜¯ä»€ä¹ˆæ„æ€ï¼Œèµ·äº†ä»€ä¹ˆä½œç”¨ï¼Œä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ªå˜é‡â€¦â€¦</p><p>10å·ä¸Šåˆï¼Œé¦–å…ˆæ˜¯ç¬”è¯•ã€‚ä¸»è¦æ˜¯æ¶‰åŠåˆ°C++ã€JAVAä¸­çš„åŸºç¡€å†…å®¹ï¼Œä¸è¿‡æœ€åæœ‰å‡ é“å¤§é¢˜ï¼Œéœ€è¦æ‰‹å†™ä»£ç ï¼Œæˆ‘è®°å¾—å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯ï¼šç»™å®šä¸€æ®µè¯ï¼Œç»Ÿè®¡å…¶è¯é¢‘ã€‚æ€»ä½“æ¥è¯´ï¼Œéš¾åº¦ä¸­ç­‰ã€‚ç¬”è¯•å®Œåï¼Œå°±æ˜¯æœºè¯•ã€‚äººå¤§ä¿¡é™¢æœºè¯•æ‰€ç”¨çš„å¹³å°æ˜¯åŒ—å¤§çš„POJï¼Œå½“æ—¶å¥½åƒæ˜¯ä¸‰é“é¢˜ï¼Œå…·ä½“æ˜¯å•¥æˆ‘å¿˜è®°äº†ï¼Œæˆ‘å½“æ—¶ACäº†ä¸€é“æœ€ç®€å•å…³äºå­—ç¬¦ä¸²çš„é¢˜ç›®ï¼Œè¿˜æ˜¯å¤ªèœäº†Â·â€¦â€¦</p><p>æœ€åï¼Œäººå¤§ä¿¡é™¢çš„offeræˆ‘æ²¡æ‹¿åˆ°ã€‚æˆ‘è§‰å¾—ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š1.äººå¤§ä¿¡é™¢çš„å¤ä»¤è¥å½•å–ç‡å¤ªä½äº†ï¼Œ39ä¸ªäººåªå½•äº†3ä¸ªäººï¼Œ7.6%çš„å½•å–ç‡ï¼Œæ˜¯æˆ‘å¬è¯´è¿‡çš„æ‰€æœ‰å¤ä»¤è¥æœ€ä½çš„â€¦â€¦è€Œä¸”é€‰äººæ ‡å‡†å¾ˆè¿·å•Šï¼Œå½“æ—¶å’Œæˆ‘ä¸€èµ·ä½çš„ä¸¤ä¸ªå“¥ä»¬ï¼Œä¹Ÿéƒ½æ²¡æœ‰æ”¶åˆ°äººå¤§ä¿¡é™¢çš„offerï¼Œä½†æ˜¯åˆ°æœ€åï¼Œä¸€ä¸ªå»äº†ä¸­ç§‘é™¢ä¿¡å·¥æ‰€ï¼Œä¸€ä¸ªå»äº†åŒ—å¤§å‰é™¢ï¼Œå¯¹ï¼Œæ²¡é”™ï¼Œå°±æ˜¯å‰é™¢â€¦â€¦2.æœºè¯•å‘æŒ¥ä¸å¥½ï¼Œå°±ACäº†ä¸€é“ï¼Œè¿˜æ˜¯è‡ªå·±å¤ªèœäº†ã€‚</p><h3 id="å¤®è´¢ä¿¡é™¢-2018å¹´7æœˆ12æ—¥â€”â€”2018å¹´7æœˆ15æ—¥"><a href="#å¤®è´¢ä¿¡é™¢-2018å¹´7æœˆ12æ—¥â€”â€”2018å¹´7æœˆ15æ—¥" class="headerlink" title="å¤®è´¢ä¿¡é™¢(2018å¹´7æœˆ12æ—¥â€”â€”2018å¹´7æœˆ15æ—¥)"></a>å¤®è´¢ä¿¡é™¢(2018å¹´7æœˆ12æ—¥â€”â€”2018å¹´7æœˆ15æ—¥)</h3><p>å¤®è´¢æ˜¯æˆ‘ç¬¬äºŒä¸ªå†³å®šå‚åŠ çš„å¤ä»¤è¥ã€‚å½“æ—¶å…¶å®è¿˜æ¥åˆ°äº†å¤©å¤§çš„é€šçŸ¥ï¼Œè€Œä¸”åœ¨å¤©å¤§å¤ä»¤è¥å‚è¥åå•å…¬ç¤ºä¹‹å‰ï¼Œè€å¸ˆä¸»åŠ¨å‘é‚®ä»¶è¡¨ç¤ºå¯¹æˆ‘å¾ˆæ„Ÿå…´è¶£ï¼Œè¦æˆ‘å»å‚åŠ ã€‚ä¸è¿‡æˆ‘æƒè¡¡å†ä¸‰ï¼Œè¿˜æ˜¯æ‹’ç»äº†å¤©å¤§ï¼Œé€‰æ‹©å‚åŠ å¤®è´¢çš„å¤ä»¤è¥ï¼Œå¯èƒ½è¿˜æ˜¯å–œæ¬¢åŒ—äº¬å§ã€‚ï¼ˆåæ¥æˆ‘æ‰çŸ¥é“å¤®è´¢ä¿¡é™¢åœ¨æ²™æ²³â€¦ï¼‰</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/å¤®è´¢ä¿¡é™¢å®‰æ’.jpg" style="zoom:50%;"></p><center><font face="Times New Roman">3.å¤®è´¢ä¿¡é™¢å¤ä»¤è¥æ—¶é—´å®‰æ’</font></center><p>7æœˆ12æ—¥æ™šä¸Šï¼Œç ´å†°ä»ªå¼ï¼Œè¿™è®©æˆ‘å°è±¡å¾ˆæ·±åˆ»ï¼Œå› ä¸ºå…¶ä»–çš„å¤ä»¤è¥éƒ½æ²¡æœ‰è¿™ä¸ªç¯èŠ‚ï¼Œéƒ½æ˜¯ç›´æ¥ä»‹ç»å­¦é™¢æ¦‚å†µï¼Œç„¶åé¢è¯•ã€ç¬”è¯•ä¹‹ç±»çš„ã€‚å½“æ—¶è€å¸ˆä»¬å¼€å±•äº†å¾ˆå¤šæ¸¸æˆè®©æˆ‘ä»¬å½¼æ­¤ç†Ÿæ‚‰ï¼Œç¬é—´è®©æˆ‘åœ¨è¿™ä¸ªæ®‹é…·çš„ä¿ç ”å¤ä»¤è¥ä¸­ï¼Œæ„Ÿè§‰åˆ°äº†ä¸€ä¸çš„æ¸©æš–ã€‚</p><p>7æœˆ13æ—¥ä¸Šåˆï¼Œå­¦é™¢æ¦‚å†µå®£è®²ã€‚ä¸‹åˆï¼Œç¬”è¯•ã€‚ç¬”è¯•å†…å®¹ä¸»è¦æ¥æºäºã€Šç®¡ç†ä¿¡æ¯ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œå½“ç„¶è¿˜æœ‰å¼€æ”¾é¢˜ï¼Œæˆ‘å°è±¡æ¯”è¾ƒæ·±çš„æ˜¯ï¼šå¦‚ä½•çœ‹å¾…æ™®æƒ é‡‘èï¼Ÿ</p><p>7æœˆ14æ—¥ä¸Šåˆï¼Œå­¦ç”Ÿæˆæœå±•ç¤ºã€‚ä¸»è¦æ˜¯åœ¨3åˆ†é’Ÿä¹‹å†…ï¼Œé€šè¿‡PPTå±•ç¤ºè‡ªå·±çš„ç§‘ç ”æƒ…å†µï¼Œè¿™æ—¶å€™æœ‰è®ºæ–‡ç®€ç›´ä¸è¦å¤ªçˆ½å“ˆå“ˆã€‚ä¸‹åˆï¼Œé¢è¯•ç¯èŠ‚ã€‚è¿™ä¸ªé¢è¯•æ¯”è¾ƒæœ‰æ„æ€ï¼Œé¢è¯•é—®é¢˜ä¸æ˜¯ç”±è€å¸ˆæ¥æé—®ï¼Œè€Œæ˜¯åƒæŠ½ç­¾ä¸€æ ·ç”±å­¦ç”ŸæŠ½å–é—®é¢˜ï¼Œè€Œä¸”ä¼šæœ‰1-2åˆ†é’Ÿçš„æ€è€ƒæ—¶é—´ã€‚æˆ‘å½“æ—¶æŠ½åˆ°çš„é—®é¢˜æ˜¯ï¼šä»€ä¹ˆæ˜¯ç»æµæ–°å¸¸æ€ï¼Ÿè¡¨è¿°æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚</p><p>7æœˆ15æ—¥ï¼Œç¦»è¥ã€‚</p><p>ä¿¡é™¢çš„offeræ˜¯æˆ‘åæ¥æ‰æ”¶åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘å½“æ—¶å°±æ‹’æ‰äº†ã€‚å½“ç„¶ï¼Œä¹Ÿä¸åªæ˜¯è¿™ä¸ªåŸå› ï¼Œæ›´å¤šçš„è¿˜æ˜¯è§‰å¾—ï¼Œä¿¡é™¢å’Œè‡ªå·±æƒ³è±¡ä¸­çš„å·®è·æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æ¯…ç„¶å†³ç„¶åœ°æ‹’æ‰äº†ã€‚</p><h3 id="å—å¤§å·¥ç®¡é™¢-2018å¹´7æœˆ25æ—¥â€”â€”2018å¹´7æœˆ27æ—¥"><a href="#å—å¤§å·¥ç®¡é™¢-2018å¹´7æœˆ25æ—¥â€”â€”2018å¹´7æœˆ27æ—¥" class="headerlink" title="å—å¤§å·¥ç®¡é™¢(2018å¹´7æœˆ25æ—¥â€”â€”2018å¹´7æœˆ27æ—¥)"></a>å—å¤§å·¥ç®¡é™¢(2018å¹´7æœˆ25æ—¥â€”â€”2018å¹´7æœˆ27æ—¥)</h3><p>å—å¤§å·¥ç®¡é™¢æ˜¯æˆ‘å‚åŠ çš„ç¬¬ä¸‰ä¸ªå¤ä»¤è¥ã€‚åœ¨å‚åŠ è¿™ä¸ªå¤ä»¤è¥ä¹‹å‰ï¼Œæˆ‘è¿˜æ”¶åˆ°äº†ä¸­å±±ä»¥åŠæ¸…åçš„é€šçŸ¥ï¼Œä½†æ˜¯çº ç»“å†ä¸‰(å½“æ—¶å› ä¸ºæ‹’æ‰äº†å¤®è´¢ï¼Œæ‰‹é‡Œæ²¡æœ‰ä¸€ä¸ªofferï¼Œæ¯”è¾ƒæ…Œ)ï¼Œè¿˜æ˜¯å‚åŠ äº†å—å¤§ã€‚(æ‰€ä»¥çœŸçš„ä¸è¦æŠ¥å¤ªå¤šçš„å¤ä»¤è¥ï¼Œé€‰æ‹©çš„æ—¶å€™çœŸçš„éå¸¸çš„çº ç»“ï¼Œå°¤å…¶æ˜¯æ‹’æ‰äº†æ¸…åçš„æ—¶å€™ğŸ˜·)</p><p>æˆ‘å‚åŠ çš„æ˜¯äºŒæœŸçš„å¤ä»¤è¥ï¼Œä¸€æœŸçš„å¤ä»¤è¥ä¸¾åŠæ—¶é—´å’Œè€ƒè¯•æ—¶é—´æ’äº†ï¼Œéå¸¸åœ°é—æ†¾ï¼Œæ‰€ä»¥åªèƒ½å‚åŠ äºŒæœŸã€‚ä½†æ˜¯å»ºè®®å¤§å®¶èƒ½å‚åŠ ä¸€æœŸï¼Œè¿˜æ˜¯è¦å»å‚åŠ ä¸€æœŸï¼Œå› ä¸ºåæ¥æˆ‘æ‰çŸ¥é“ï¼Œä¸€æœŸäºŒæœŸå·®åˆ«å¾…é‡éå¸¸å¤§ã€‚å‚åŠ ä¸€æœŸçš„åŒå­¦ä¸ä»…ä½çš„é…’åº—éå¸¸è±ªåï¼Œè€Œä¸”è¿˜ç»™æŠ¥é”€è·¯è´¹ï¼Œæœ€åå½•å–ç‡è¿˜æå…¶åœ°é«˜ï¼›å‚åŠ äºŒæœŸçš„åŒå­¦ï¼Œå•¥éƒ½æ²¡æœ‰â€¦â€¦</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/å—å¤§å®‰æ’.jpg" style="zoom:50%;"></p><center><font face="Times New Roman">4.å—å¤§å·¥ç®¡é™¢å¤ä»¤è¥æ—¶é—´å®‰æ’</font></center><p>7æœˆ25æ—¥ï¼ŒæŠ¥é“ã€‚</p><p>7æœˆ26æ—¥ä¸Šåˆï¼Œç¬”è¯•ã€‚å†…å®¹æ˜¯æ ¹æ®å‚è¥é€šçŸ¥é‚®ä»¶ä¸­çš„è®ºæ–‡ï¼Œå›ç­”ç›¸å…³é—®é¢˜ã€‚æ¯ä¸€ä¸ªäººå‘çš„è®ºæ–‡éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘çš„æ˜¯è¿™ä¸€ç¯‡è®ºæ–‡ğŸ‘‡ï¼›ä¸‹åˆæ˜¯ç”±ä¸€ä¸ªæ»´æ»´çš„ç§‘å­¦å®¶åšçš„å­¦æœ¯æŠ¥å‘Šï¼›æ™šä¸Šæ˜¯å­¦é™¢ä»¥åŠå­¦ç§‘ä»‹ç»ã€‚</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/å—å¤§è®ºæ–‡.jpg" style="zoom:50%;"></p><center><font face="Times New Roman">5.è®ºæ–‡æˆªå›¾</font></center><p>7æœˆ27æ—¥ä¸Šåˆï¼Œé¢è¯•ã€‚é¢è¯•å†…å®¹æ˜¯è€å¸ˆæ ¹æ®ä½ ç®€å†æ¥è¿›è¡Œæé—®ã€‚å› ä¸ºæˆ‘ç®€å†ä¸Šæœ‰äº›ç§‘ç ”ç»å†ï¼Œè€å¸ˆä¹Ÿå°±é’ˆå¯¹è®ºæ–‡å¼€å§‹æé—®äº†(æ‰€ä»¥æœ‰ç§‘ç ”ç»å†çœŸçš„éå¸¸åŠ åˆ†) ã€‚æ•´ä¸ªé¢è¯•è¿‡ç¨‹éå¸¸åœ°é¡ºåˆ©ï¼Œé¢è¯•å®Œåï¼Œæˆ‘å°±çŸ¥é“æˆ‘è‚¯å®šèƒ½æ‹¿åˆ°offerã€‚</p><p>æœ€åä¹Ÿæ˜¯ä¸å‡ºæ„æ–™åœ°æ‹¿åˆ°äº†offerï½</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/å—å¤§å½•å–.jpg" style="zoom:50%;"></p><center><font face="Times New Roman">6.å—å¤§å·¥ç®¡é™¢å¤ä»¤è¥offer</font></center><h2 id="é¢„æ¨å…â€”â€”å¾æˆ˜åŒ—å¤§ï¼ˆ2018å¹´9æœˆ21æ—¥ï¼‰"><a href="#é¢„æ¨å…â€”â€”å¾æˆ˜åŒ—å¤§ï¼ˆ2018å¹´9æœˆ21æ—¥ï¼‰" class="headerlink" title="é¢„æ¨å…â€”â€”å¾æˆ˜åŒ—å¤§ï¼ˆ2018å¹´9æœˆ21æ—¥ï¼‰"></a>é¢„æ¨å…â€”â€”å¾æˆ˜åŒ—å¤§ï¼ˆ2018å¹´9æœˆ21æ—¥ï¼‰</h2><p>å…¶å®å¤ä»¤è¥æ‹¿åˆ°äº†å—å¤§çš„offerï¼Œå…¶å®è¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„ï¼Œæ‰€ä»¥é¢„æ¨å…é˜¶æ®µå°±æ²¡æœ‰èŠ±å¤ªå¤šå¿ƒæ€ï¼Œä¸è¿‡æˆ‘å¥½å¥½å‡†å¤‡äº†åŒ—å¤§çš„é¢„æ¨å…ã€‚åŸå› æœ‰ä¸¤ä¸ªï¼š1.åœ¨å¤ä»¤è¥çš„æ—¶å€™ï¼Œæœ¬æ¥æƒ³æŠ¥åŒ—å¤§ä¿¡ç§‘å’Œå‰é™¢ï¼Œä½†æ˜¯æŠ¥åé˜¶æ®µç½‘ç«™å´©äº†ï¼Œå¯¼è‡´æ²¡æŠ¥ä¸Šï¼Œæ€»è§‰å¾—æ˜¯é—æ†¾ï¼Œè™½ç„¶æŠ¥äº†ä¹Ÿä¸ä¸€å®šå½•å¾—ä¸Šå“ˆå“ˆå“ˆï¼›2.è‡ªèº«è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹åæ ¡æƒ…ç»“çš„ï¼Œå¯¹åŒ—å¤§åˆæ¯”è¾ƒæœ‰å¥½æ„Ÿï¼Œæ‰€ä»¥é¢„æ¨å…é˜¶æ®µå°±å¥½å¥½åœ°å‡†å¤‡äº†åŒ—å¤§çš„é¢„æ¨å…ã€‚</p><p>æˆ‘æŠ¥çš„æ˜¯åŒ—å¤§è½¯å¾®é™¢ï¼Œæœ‰ä¸¤ä¸ªåŸå› ï¼šä¸€æ–¹é¢æ˜¯å½“æ—¶é€šè¿‡å¤ä»¤è¥æ‹¿åˆ°äº†ä¿¡ç§‘offerçš„åŒå­¦äº†è§£åˆ°ï¼Œæˆ‘æƒ³æ‰¾çš„ä¿¡ç§‘çš„å¯¼å¸ˆå·²ç»æ²¡æœ‰åé¢äº†ï¼›å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä¹‹åçš„è§„åˆ’æ˜¯ä¸å‡ºæ„å¤–çš„æƒ…å†µä¸‹ï¼Œå¤§æ¦‚ç‡æ˜¯è¯»ç ”ä¹‹åå‡†å¤‡å·¥ä½œï¼Œæ‰€ä»¥è½¯å¾®é™¢ä¹Ÿæ¯”è¾ƒç¬¦åˆæˆ‘çš„æœŸå¾…ã€‚(9æœˆ18æ—¥æ”¶åˆ°é¢è¯•é€šçŸ¥ğŸ‘‡)</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/åŒ—å¤§æ¨å…é€šçŸ¥.jpg" alt></p><center><font face="Times New Roman">7.åŒ—å¤§è½¯å¾®é™¢é¢è¯•é€šçŸ¥</font></center><p>9æœˆ21æ—¥ï¼Œé¢è¯•ã€‚é¢è¯•æœ‰ä¸‰ä½è€å¸ˆï¼ˆæˆ‘ç°åœ¨å›æƒ³èµ·æ¥æœ‰ä¸€ä½æ˜¯æ²ˆè€å¸ˆï¼‰ã€‚è€å¸ˆäººéƒ½éå¸¸å’Œè”¼ï¼Œä¸ä¼šç»™äººå‹åŠ›ã€‚é¢è¯•å†…å®¹è¿˜æ˜¯æ ¹æ®ç®€å†å†…å®¹æ¥è¿›è¡Œæé—®ã€‚å› ä¸ºæˆ‘ç®€å†ä¸Šæœ‰ç§‘ç ”ç»å†ï¼Œæ‰€ä»¥è€å¸ˆé—®åˆ°äº†æˆ‘è®ºæ–‡çš„ideaä»¥åŠinnovationï¼ˆæœ‰è®ºæ–‡çœŸçš„éå¸¸éå¸¸åŠ åˆ†ï½ï¼‰ã€‚å¦å¤–ï¼Œç”±äºæˆ‘çš„è®ºæ–‡æ˜¯å…³äºå¤§è§„æ¨¡ç¾¤å†³ç­–å…±è¯†é—®é¢˜çš„ç ”ç©¶ï¼Œè€Œä¸”è€å¸ˆä¼¼ä¹æ˜¯åšåŒºå—é“¾æ–¹å‘çš„ï¼Œæ‰€ä»¥è€å¸ˆå°±é—®åˆ°äº†æˆ‘è®ºæ–‡çš„å…±è¯†ä¸åŒºå—é“¾ä¸­çš„å…±è¯†çš„åŒºåˆ«ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¤§ä¸‰ä¸Šå­¦æœŸçš„æ—¶å€™ï¼Œæˆ‘åœ¨å¦ä¸€ä¸ªåšåŒºå—é“¾çš„è¯¾é¢˜ç»„å¾…è¿‡ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥å¯¹è¿™ä¸ªè¿˜äº†è§£ä¸€äº›ï¼Œè¿˜ç»™è€å¸ˆå¤§è®²ç‰¹è®²äº†é—ªç”µç½‘ç»œã€RSMCã€HTLCç­‰ç­‰ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“å½“æ—¶æˆ‘å“ªæ¥çš„å‹‡æ°”ï¼Œä»…å‡­é›¶æ˜Ÿçš„è®°å¿†å°±æ•¢å»è®²è¿™äº›ğŸ¤£ã€‚ä¸è¿‡ä¼¼ä¹è€å¸ˆä»¬éƒ½æ¯”è¾ƒæ»¡æ„ï¼Œé¢äº†å°†è¿‘30åˆ†é’Ÿï¼Œæˆ‘å°±å‡ºæ¥äº†ã€‚ï¼ˆæœ€åçš„å¾—åˆ†è¿˜æ¯”è¾ƒé«˜å“ˆå“ˆå“ˆï¼‰</p><p>9æœˆ26æ—¥ï¼Œæ­£å¼æ”¶åˆ°äº†åŒ—å¤§çš„offerï¼Œluckyï½</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/é¢„æ¨å…æˆåŠŸ.jpg" alt></p><center><font face="Times New Roman">8.åŒ—å¤§è½¯å¾®é™¢å½•å–offer</font></center><h2 id="æ³¨å®šæ˜¯éš¾å¿˜çš„æ—¥å­â€”â€”2018å¹´9æœˆ28æ—¥"><a href="#æ³¨å®šæ˜¯éš¾å¿˜çš„æ—¥å­â€”â€”2018å¹´9æœˆ28æ—¥" class="headerlink" title="æ³¨å®šæ˜¯éš¾å¿˜çš„æ—¥å­â€”â€”2018å¹´9æœˆ28æ—¥"></a>æ³¨å®šæ˜¯éš¾å¿˜çš„æ—¥å­â€”â€”2018å¹´9æœˆ28æ—¥</h2><p>9æœˆ28æ—¥ï¼Œæˆ‘åœ¨ç ”æ‹›ç½‘æ¨å…ç³»ç»Ÿä¸­ç¡®è®¤äº†åŒ—å¤§å½•å–é€šçŸ¥ï¼Œæˆ‘çš„ä¿ç ”ä¹‹è·¯ä¹Ÿå°±æ­£å¼ç»“æŸäº†ï¼Œæˆ‘ä¹Ÿæ­£å¼è¿ˆå…¥åŒ—å¤§ï¼Œæ„Ÿæ©â¤ï¸ï½</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/1.å¤è¯•ç¡®è®¤.png" alt></p><center><font face="Times New Roman">9.ç¡®è®¤å¤è¯•é€šçŸ¥</font></center><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/2.å¾…å½•å–ç¡®è®¤.png" alt></p><center><font face="Times New Roman">10.æ¥å—å¾…å½•å–é€šçŸ¥</font></center><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/3.æˆåŠŸå½•å–.png" alt></p><center><font face="Times New Roman">11.æˆåŠŸå½•å–</font></center><h2 id="2019å¹´6æœˆ27æ—¥"><a href="#2019å¹´6æœˆ27æ—¥" class="headerlink" title="2019å¹´6æœˆ27æ—¥"></a>2019å¹´6æœˆ27æ—¥</h2><p>æ”¶åˆ°åŒ—å¤§å½•å–é€šçŸ¥ä¹¦ï½  </p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/å½•å–é€šçŸ¥ä¹¦æ­£é¢.jpeg" style="zoom: 33%;"></p><center><font face="Times New Roman">12.å½•å–é€šçŸ¥ä¹¦</font></center><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/æœ‹å‹åœˆ.jpeg" style="zoom: 33%;"></p><center><font face="Times New Roman">13.æœ‹å‹åœˆ</font></center><h2 id="2019å¹´9æœˆ6æ—¥"><a href="#2019å¹´9æœˆ6æ—¥" class="headerlink" title="2019å¹´9æœˆ6æ—¥"></a>2019å¹´9æœˆ6æ—¥</h2><p>å¼€å­¦å•¦â¤ï¸PKUï½</p><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/åŒ—å¤§å¼€å­¦1.jpeg" style="zoom: 33%;"></p><center><font face="Times New Roman">14.å¼€å­¦å…¸ç¤¼</font></center><p><img src="/2020/02/17/%E4%BF%9D%E7%A0%94PKU%E4%B9%8B%E8%B7%AF/åŒ—å¤§å¼€å­¦.jpeg" style="zoom: 33%;"></p><center><font face="Times New Roman">15.æœ‹å‹åœˆ</font></center><h2 id="ç°åœ¨"><a href="#ç°åœ¨" class="headerlink" title="ç°åœ¨"></a>ç°åœ¨</h2><p>ç°åœ¨æ­£åœ¨åŠªåŠ›å­¦ä¹ ï¼Œæƒ³æ‹¥æœ‰çš„å¤ªå¤šï¼Œè‡ªèº«è¿˜ä»æœ‰ä¸è¶³ï¼Œä»»é‡è€Œé“è¿œï¼ŒåŠªåŠ›åŠªåŠ›å†åŠªåŠ›â¤ï¸ï½</p><p>ç¥æ„¿æ¯ä¸ªäººéƒ½èƒ½æˆä¸ºæƒ³è¦çš„è‡ªå·±â¤ï¸ï½</p>]]></content>
      
      
      
        <tags>
            
            <tag> PKU </tag>
            
            <tag> ä¿ç ” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++|ä¸€äº›çŸ¥è¯†ç‚¹æ€»ç»“</title>
      <link href="2020/02/17/C-%EF%BD%9C%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/"/>
      <url>2020/02/17/C-%EF%BD%9C%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹ã€Šå‰‘æŒ‡offerã€‹ï¼Œä¹Ÿä¸€ç›´åœ¨ç”¨C++åˆ·é¢˜ï¼Œæ€»æ˜¯ä¼šé‡åˆ°ä¸€äº›æ˜“æ··çš„åœ°æ–¹ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥ä¾¿ä»¥åç¿»é˜…ã€‚</p><a id="more"></a><h3 id="thisæŒ‡é’ˆ"><a href="#thisæŒ‡é’ˆ" class="headerlink" title="thisæŒ‡é’ˆ"></a>thisæŒ‡é’ˆ</h3><blockquote><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://blog.csdn.net/xiaohaijiejie/article/details/51787351" target="_blank" rel="noopener">https://blog.csdn.net/xiaohaijiejie/article/details/51787351</a></p><p><a href="https://blog.csdn.net/qq_40354578/article/details/88088048" target="_blank" rel="noopener">https://blog.csdn.net/qq_40354578/article/details/88088048</a>   </p></blockquote><p><strong>thisæŒ‡é’ˆæ˜¯æŒ‡å‘å®ä¾‹æœ¬èº«ï¼Œä¸»è¦åœ¨è¿è¡Œå¯¹è±¡è‡ªèº«çš„å‡½æ•°å¯¹å‡½æ•°æ•°æ®æˆå‘˜é‡åçš„æƒ…å†µæœ‰ç”¨ã€‚</strong></p><p>ä¸‹é¢æˆ‘ä»¬è®¾ç½®é‡åçš„å‡½æ•°æ•°æ®æˆå‘˜ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Array</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Array(<span class="keyword">int</span> len)<span class="comment">//æœ‰å‚æ„é€ å‡½æ•°</span></span><br><span class="line">&#123;</span><br><span class="line">len=len;</span><br><span class="line">&#125;</span><br><span class="line">~Array()<span class="comment">//ææ„å‡½æ•°</span></span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setLen</span><span class="params">(<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">len=len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printInfo</span><span class="params">()</span><span class="comment">//æ‰“å°å€¼</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"len="</span>&lt;&lt;len&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">int</span> len;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Array <span class="title">arr1</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">arr1.printInfo();</span><br><span class="line">system(<span class="string">"pause"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹: </p><p><img src="/2020/02/17/C-%EF%BD%9C%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/1.jpg" alt></p><p>æˆ‘ä»¬å¯ä»¥å‘ç°ç»“æœé”™è¯¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨thisæŒ‡é’ˆã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Array</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">int</span> len;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Array(<span class="keyword">int</span> len)&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;len=len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~Array()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setLen</span><span class="params">(<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;len=len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLen</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"len:"</span>&lt;&lt;<span class="keyword">this</span>-&gt;len&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="function">Array <span class="title">a</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"><span class="keyword">int</span> b =a.getLen();</span><br><span class="line">a.PrintInfo();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/2020/02/17/C-%EF%BD%9C%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/2.jpg" alt></p><p>è¿è¡ŒæˆåŠŸã€‚</p><h3 id="constçš„ä½¿ç”¨"><a href="#constçš„ä½¿ç”¨" class="headerlink" title="constçš„ä½¿ç”¨"></a>constçš„ä½¿ç”¨</h3><h5 id="constä¿®é¥°æ™®é€šå˜é‡"><a href="#constä¿®é¥°æ™®é€šå˜é‡" class="headerlink" title="constä¿®é¥°æ™®é€šå˜é‡"></a>constä¿®é¥°æ™®é€šå˜é‡</h5><ul><li>constä¿®é¥°æ™®é€šå˜é‡çš„æ—¶å€™ï¼Œå¿…é¡»åˆå§‹åŒ–ï¼›</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a=<span class="number">14</span>;</span><br></pre></td></tr></table></figure><ul><li>ä¸èƒ½é€šè¿‡ä¿®æ”¹å¸¸é‡çš„å¼•ç”¨æ¥ä¿®æ”¹ç»‘å®šçš„å¯¹è±¡ï¼›</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i=<span class="number">42</span>;</span><br><span class="line"><span class="keyword">int</span> &amp;r1=i;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> &amp;r2=i;<span class="comment">//r2ä¹Ÿç»‘å®šäº†å¯¹è±¡i,ä½†ä¸å…è®¸é€šè¿‡r2ä¿®æ”¹içš„å€¼</span></span><br><span class="line">r1=<span class="number">0</span>;           <span class="comment">//æ­£ç¡®</span></span><br><span class="line">r2=<span class="number">0</span>;           <span class="comment">//é”™è¯¯ï¼Œr2æ˜¯ä¸€ä¸ªå¸¸é‡å¼•ç”¨</span></span><br></pre></td></tr></table></figure><ul><li>ä¸èƒ½å°†éå¸¸é‡å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¸¸é‡å¯¹è±¡ï¼›</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i=<span class="number">42</span>;</span><br><span class="line"><span class="keyword">int</span> &amp;r1=i;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> &amp;r2=i;<span class="comment">//r2ä¹Ÿç»‘å®šäº†å¯¹è±¡i,ä½†ä¸å…è®¸é€šè¿‡r2ä¿®æ”¹içš„å€¼</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ci=<span class="number">1024</span>;</span><br><span class="line"><span class="keyword">int</span> &amp;r2=ci;<span class="comment">//é”™è¯¯</span></span><br></pre></td></tr></table></figure><h5 id="constä¿®é¥°å‡½æ•°çš„è¿”å›ç±»å‹"><a href="#constä¿®é¥°å‡½æ•°çš„è¿”å›ç±»å‹" class="headerlink" title="constä¿®é¥°å‡½æ•°çš„è¿”å›ç±»å‹"></a>constä¿®é¥°å‡½æ•°çš„è¿”å›ç±»å‹</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">const</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//ä¸¤ç§å†™æ³•ç­‰ä»·</span></span><br></pre></td></tr></table></figure><h5 id="constä¿®é¥°å‡½æ•°çš„å½¢å‚å˜é‡"><a href="#constä¿®é¥°å‡½æ•°çš„å½¢å‚å˜é‡" class="headerlink" title="constä¿®é¥°å‡½æ•°çš„å½¢å‚å˜é‡"></a>constä¿®é¥°å‡½æ•°çš„å½¢å‚å˜é‡</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> <span class="keyword">const</span> val)</span></span>;</span><br><span class="line"><span class="comment">//ä¸¤ç§å†™æ³•ç­‰ä»·</span></span><br></pre></td></tr></table></figure><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ</strong>æœ‰æ—¶å€™ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼š<code>void func(const int &amp;val)</code>.constè¢«ç”¨æ¥ä¿®é¥°å‡½æ•°å‚æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šé˜²æ­¢ä¼ å…¥çš„å‚æ•°å†…å®¹åœ¨å‡½æ•°ä½“å†…è¢«æ”¹å˜ï¼Œä½†æ˜¯ä»…å¯¹æŒ‡é’ˆå’Œå¼•ç”¨æœ‰ç”¨ã€‚å› ä¸ºå¦‚æœæ˜¯æŒ‰å€¼ä¼ é€’ï¼Œä¼ ç»™å‚æ•°çš„ä»…ä»…æ˜¯å®å‚çš„å‰¯æœ¬ï¼Œå³ä½¿åœ¨å‡½æ•°ä½“å†…æ”¹å˜äº†å½¢å‚ï¼Œå®å‚ä¹Ÿä¸ä¼šå¾—åˆ°å½±å“ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">i = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°ä½“ä¸­ï¼Œæ˜¯ä¸èƒ½æ”¹å˜içš„å€¼çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">h</span><span class="params">(<span class="keyword">const</span> A &amp; a)</span></span>&#123;</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ é€’è¿›æ¥çš„å‚æ•°aæ˜¯å®å‚å¯¹è±¡çš„å‰¯æœ¬ï¼Œè¦è°ƒç”¨æ„é€ å‡½æ•°æ¥æ„é€ è¿™ä¸ªå‰¯æœ¬ï¼Œè€Œä¸”å‡½æ•°ç»“æŸåè¦è°ƒç”¨ææ„å‡½æ•°æ¥é‡Šæ”¾è¿™ä¸ªå‰¯æœ¬ï¼Œåœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½é€ æˆäº†æµªè´¹ï¼Œæ‰€ä»¥å‡½æ•°å‚æ•°ä¸ºç±»å¯¹è±¡çš„æƒ…å†µï¼Œæ¨èç”¨å¼•ç”¨ã€‚ä½†æŒ‰å¼•ç”¨ä¼ é€’ï¼Œé€ æˆäº†å®‰å…¨éšæ‚£ï¼Œé€šè¿‡å‡½æ•°å‚æ•°çš„å¼•ç”¨å¯ä»¥ä¿®æ”¹å®å‚çš„å†…éƒ¨æ•°æ®æˆå‘˜ï¼Œæ‰€ä»¥ç”¨constæ¥ä¿æŠ¤å®å‚ã€‚  </p><h3 id="amp-å¼•ç”¨"><a href="#amp-å¼•ç”¨" class="headerlink" title="&amp;å¼•ç”¨"></a>&amp;å¼•ç”¨</h3><p>åœ¨å‡½æ•°å‚æ•°ä¸­ï¼Œä½¿ç”¨&amp;ä¼šé¿å…å¤§é‡çš„æ•°æ®å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚å› ä¸ºå¯¹å¼•ç”¨çš„ä¿®æ”¹ï¼Œå°±æ˜¯å¯¹åŸå€¼çš„ä¿®æ”¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//äº¤æ¢ä¸¤ä¸ªå€¼ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span> <span class="params">(<span class="keyword">int</span>&amp; x, <span class="keyword">int</span>&amp; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    temp = x;</span><br><span class="line">    x= y;</span><br><span class="line">    y =temp;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    swap(a,b);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;a &lt;&lt;<span class="string">"   "</span> &lt;&lt;b&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> val)</span><span class="comment">//æŒ‰å€¼ä¼ é€’å‚æ•°</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    val = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">(<span class="keyword">int</span>&amp; val)</span><span class="comment">//æŒ‰å¼•ç”¨ä¼ é€’å‚æ•°</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    val = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">zoo</span><span class="params">(<span class="keyword">int</span> *pval)</span><span class="comment">//æŒ‰æŒ‡é’ˆä¼ é€’å‚æ•°</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *pval = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">1</span>;</span><br><span class="line">    foo(a);</span><br><span class="line">    bar(b);</span><br><span class="line">    zoo(&amp;c);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;a &lt;&lt;<span class="string">"   "</span> &lt;&lt;b&lt;&lt;<span class="string">"   "</span>&lt;&lt;c &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/2020/02/17/C-%EF%BD%9C%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/3.jpg" alt></p><p>åˆ†æï¼š</p><ul><li><p>fooå‡½æ•°æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œæ‰§è¡Œfooå‡½æ•°çš„æ‰§è¡Œï¼Œç›¸å½“äºå¯¹açš„å‰¯æœ¬è¿›è¡Œä¿®æ”¹ã€‚åœ¨è°ƒç”¨å®Œfooå‡½æ•°åï¼Œaçš„å€¼è¿˜æ˜¯1ï¼Œä¸ä¼šæ”¹å˜ã€‚</p></li><li><p>barä¸­valueçš„ä¼ é€’æ˜¯å¼•ç”¨ï¼Œå¯¹å¼•ç”¨çš„ä¿®æ”¹å’Œå¯¹åŸå€¼ä¿®æ”¹æ˜¯ä¸€æ ·çš„ã€‚</p></li><li>zooä¸­valueçš„ä¼ é€’æ˜¯æŒ‡é’ˆï¼ŒæŒ‡é’ˆå¯¹å€¼å¾—ä¿®æ”¹ï¼ŒåŸå€¼ä¹Ÿä¼šä¿®æ”¹ã€‚</li></ul><h3 id="stringstream"><a href="#stringstream" class="headerlink" title="stringstream"></a>stringstream</h3><h4 id="1-å£°æ˜ä¸€ä¸ªstringstreamå¯¹è±¡"><a href="#1-å£°æ˜ä¸€ä¸ªstringstreamå¯¹è±¡" class="headerlink" title="1.å£°æ˜ä¸€ä¸ªstringstreamå¯¹è±¡"></a>1.å£°æ˜ä¸€ä¸ªstringstreamå¯¹è±¡</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">stringstream</span> ss;</span><br></pre></td></tr></table></figure><h4 id="2-å¸¸ç”¨å‡½æ•°"><a href="#2-å¸¸ç”¨å‡½æ•°" class="headerlink" title="2.å¸¸ç”¨å‡½æ•°"></a>2.å¸¸ç”¨å‡½æ•°</h4><h5 id="2-1-ss-str"><a href="#2-1-ss-str" class="headerlink" title="2.1.ss.str()"></a>2.1.ss.str()</h5><p>str()å‡½æ•°çš„ä½œç”¨æ˜¯ï¼šå°†ssä¸­çš„å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²è¾“å‡ºã€‚<code>ss.str(&quot;&quot;)</code>è¿™æ®µä»£ç è¡¨ç¤ºçš„æ˜¯å°†ssæµæ¸…é›¶ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">stringstream</span> ss;</span><br><span class="line">ss &lt;&lt; <span class="string">"hello "</span>;</span><br><span class="line">ss &lt;&lt; <span class="string">"world!"</span>;</span><br><span class="line">  <span class="built_in">cout</span>&lt;&lt;ss.str()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œstringstreamæœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<strong>ä»stringstreamæµä¸­çš„æ•°æ®è¾“å…¥å­—ç¬¦ä¸²åˆ°ä¸€ä¸ªå˜é‡é‡Œï¼Œæ˜¯ä»¥é‡åˆ°ç©ºæ ¼è·³åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²çš„è¿™æ ·çš„å½¢å¼è¿ç»­è¯»å–çš„</strong>ã€‚è¿™åœ¨åˆ·é¢˜è¿‡ç¨‹ä¸­ï¼Œä¼šä½“ç°åœ¨ä½¿ç”¨å¾ªç¯çš„è¿‡ç¨‹ä¸­ã€‚å¦‚ä¸‹ï¼š</p><h4 id="151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯"><a href="#151-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯" class="headerlink" title="151. ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯"></a><a href="https://leetcode-cn.com/problems/reverse-words-in-a-string/" target="_blank" rel="noopener">151. ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯</a></h4><p>&lt;/br&gt;</p><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€ä¸ªç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå•è¯ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><blockquote><p>è¾“å…¥: â€œthe sky is blueâ€<br>è¾“å‡º: â€œblue is sky theâ€  </p></blockquote><p> ç¤ºä¾‹ 2ï¼š</p><blockquote><p>è¾“å…¥: â€œ  hello world!  â€œ<br>è¾“å‡º: â€œworld! helloâ€<br>è§£é‡Š: è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚</p></blockquote><p>ç¤ºä¾‹ 3ï¼š</p><blockquote><p>è¾“å…¥: â€œa good   exampleâ€<br>è¾“å‡º: â€œexample good aâ€<br>è§£é‡Š: å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚</p></blockquote><p>ACä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">reverseWords</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line"><span class="built_in">stringstream</span> ss;</span><br><span class="line">ss&lt;&lt;s;</span><br><span class="line"><span class="built_in">string</span> ans=<span class="string">""</span>;</span><br><span class="line"><span class="built_in">string</span> temp;</span><br><span class="line"><span class="keyword">while</span>(ss&gt;&gt;temp)&#123;</span><br><span class="line">ans=<span class="string">" "</span>+temp+ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(ans!=<span class="string">""</span>)&#123;</span><br><span class="line">ans.erase(ans.<span class="built_in">begin</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line">getline(<span class="built_in">cin</span>,s);<span class="comment">//ciné‡åˆ°ç©ºæ ¼å°±ä¼šç»ˆæ­¢è¾“å…¥ï¼Œç´¢å¼•éœ€è¦ä½¿ç”¨getlineå‡½æ•°ã€‚</span></span><br><span class="line">Solution so1;</span><br><span class="line"><span class="built_in">string</span> ans=so1.reverseWords(s);</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/2020/02/17/C-%EF%BD%9C%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/4.jpg" alt></p><p>overâ˜•ï¸ï½</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> stringstram </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’|è´­ä¹°è‚¡ç¥¨é—®é¢˜ç³»åˆ—</title>
      <link href="2020/02/17/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%EF%BD%9C%E8%B4%AD%E4%B9%B0%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%B3%BB%E5%88%97/"/>
      <url>2020/02/17/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%EF%BD%9C%E8%B4%AD%E4%B9%B0%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<font face="Times New Roman">æœ€è¿‘å¤ªå¿™äº†ï¼Œæ²¡æœ‰æ—¶é—´æ¥æ›´æ–°blogï¼Œä»Šå¤©åˆ·é¢˜åˆ·çš„æœ‰ç‚¹çŒ›,æ›´æ–°ä¸€æ³¢ï½</font><font face="Times New Roman">è‚¡ç¥¨é—®é¢˜æ˜¯åŠ¨æ€è§„åˆ’éå¸¸å…¸å‹çš„é—®é¢˜ï¼Œç„¶åæœ‰ä¸€å¥—é˜¶æ¢¯æ¡†æ¶ï¼Œä¸»è¦å°±æ˜¯è¦æ‰¾åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚anywayï¼Œlet's do it.</font><a id="more"></a><hr><p>ä»¥<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iii/" target="_blank" rel="noopener">123ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a>ä¸ºä¾‹ï¼Œè¿›è¡Œå‰–æã€‚</p><h4 id="1-æ€»ä½“æ€è·¯ï¼šç©·ä¸¾ï¼Œæˆ–è€…è¯´æ˜¯çŠ¶æ€æœº"><a href="#1-æ€»ä½“æ€è·¯ï¼šç©·ä¸¾ï¼Œæˆ–è€…è¯´æ˜¯çŠ¶æ€æœº" class="headerlink" title="1.æ€»ä½“æ€è·¯ï¼šç©·ä¸¾ï¼Œæˆ–è€…è¯´æ˜¯çŠ¶æ€æœº"></a>1.æ€»ä½“æ€è·¯ï¼šç©·ä¸¾ï¼Œæˆ–è€…è¯´æ˜¯çŠ¶æ€æœº</h4><p> åœ¨è¯¥é¢˜ä¸­ï¼Œæ€»å…±æœ‰ä¸‰ç§çŠ¶æ€ï¼šå¤©æ•°ã€å¯ä»¥è¿›è¡Œçš„äº¤æ˜“çš„æ•°ç›®ã€æŒæœ‰çŠ¶æ€ã€‚ç„¶åéå†æ‰€æœ‰çŠ¶æ€ï¼Œä»è€Œå¾—åˆ°æœ€åçš„ç»“æœã€‚ï¼ˆå…¶å®å°±æ˜¯ç©·ä¸¾çš„æ€è·¯ï¼‰ä»£ç å¦‚ä¸‹ï¼š  </p><p><img src="/2020/02/17/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%EF%BD%9C%E8%B4%AD%E4%B9%B0%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%B3%BB%E5%88%97/1.png" alt=" "></p><p>ä»¥è¿™é“é¢˜ä¸ºä¾‹ï¼Œ$dp[i][k][1]$ è¡¨ç¤ºåœ¨ç¬¬$i$å¤©ï¼Œæ­¤åˆ»æŒæœ‰è‚¡ç¥¨ï¼Œè‡³ä»Šä¸ºæ­¢æ€»å…±è¿›è¡Œè¿‡$k$æ¬¡äº¤æ˜“ï¼Œè¿™ä¸ªæ—¶å€™çš„æ€»åˆ©æ¶¦ï¼›$dp[i][k][0]$ è¡¨ç¤ºåœ¨ç¬¬ $i$ å¤©ï¼Œæ­¤åˆ»æ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œè‡³ä»Šä¸ºæ­¢æ€»å…±è¿›è¡Œè¿‡$k$æ¬¡äº¤æ˜“ï¼Œè¿™ä¸ªæ—¶å€™çš„æ€»åˆ©æ¶¦ã€‚</p><h4 id="2-çŠ¶æ€è½¬ç§»æ¡†æ¶"><a href="#2-çŠ¶æ€è½¬ç§»æ¡†æ¶" class="headerlink" title="2.çŠ¶æ€è½¬ç§»æ¡†æ¶"></a>2.çŠ¶æ€è½¬ç§»æ¡†æ¶</h4><p><img src="/2020/02/17/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%EF%BD%9C%E8%B4%AD%E4%B9%B0%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%B3%BB%E5%88%97/2.png" alt="image-20191018213809486"></p><p>ä¸Šè¿°å›¾ç‰‡è§£é‡Šäº†çŠ¶æ€è½¬ç§»æ¡†æ¶ã€‚åœ¨è¿™é‡Œï¼Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p><p>â€‹        ç¬¬ä¸€ï¼šåœ¨è®¡ç®—<script type="math/tex">dp[i][k][1]</script>çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°<script type="math/tex">dp[i-1][k-1][0]</script>ï¼Œåœ¨è¿™é‡Œï¼Œéœ€è¦å°†$k$å˜æˆ$k-1$ï¼Œå› ä¸ºæ­£æ˜¯å› ä¸ºåœ¨$i-1$å¤©æ²¡æœ‰è¿›è¡ŒæŒæœ‰è‚¡ç¥¨ï¼Œé‚£ä¹ˆç»è¿‡ä¸€æ¬¡äº¤æ˜“åï¼Œæ‰ä¼šåœ¨$i$å¤©æŒæœ‰è‚¡ç¥¨ï¼Œé‚£ä¹ˆè‡ªç„¶è€Œè¨€çš„ï¼Œäº¤æ˜“æ¬¡æ•°è¦å¢åŠ 1.</p><p>â€‹        ç¬¬äºŒï¼šåœ¨ä»æ— åˆ°æŒæœ‰è‚¡ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å‡å»è‚¡ç¥¨çš„ä»·å€¼ï¼›è€Œåè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åŠ ä¸Šè‚¡ç¥¨çš„ä»·å€¼ã€‚</p><hr><h4 id="3-base-caseçš„å¤„ç†"><a href="#3-base-caseçš„å¤„ç†" class="headerlink" title="3.base caseçš„å¤„ç†"></a>3.base caseçš„å¤„ç†</h4><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><script type="math/tex; mode=display">dp[i][k][0]=max(dp[i-1][k][0],dp[i-1][k][1]+prices[i])</script><script type="math/tex; mode=display">dp[i][k][1]=max(dp[i-1][k][1],dp[i-1][k-1][0]-prices[i])</script><p>åœ¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹å½“ä¸­ï¼Œå½“$i=0$çš„æ—¶å€™ï¼Œéœ€è¦è®¡ç®—$dp[-1]$ã€‚é‚£ä¹ˆå®é™…ä¸Šindexä¸º-1ï¼Œå…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›æ–¹æ³•å¤„ç†è¿™äº›caseã€‚</p><p>å®é™…ä¸Šï¼Œå¤„ç†è¿™äº›base caseï¼Œä¹Ÿæ˜¯æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ¥è¿›è¡Œåˆ†æã€‚å½“$i=0$çš„æ—¶å€™ï¼Œå…¶çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºä¸‹ï¼š</p><script type="math/tex; mode=display">dp[0][k][0]=max(dp[-1][k][0],dp[-1][k][1]+prices[0])</script><script type="math/tex; mode=display">dp[0][k][1]=max(dp[-1][k][1],dp[-1][k-1][0]-prices[0])</script><p>é‚£ä¹ˆå…·ä½“åˆ†æä¸Šè¿°æ–¹ç¨‹çš„ç»†èŠ‚ã€‚$dp[-1][k][0]$è¡¨ç¤ºçš„æ˜¯ç¬¬-1å¤©çš„æ—¶å€™ï¼Œä¸æŒæœ‰è‚¡ç¥¨ã€‚é‚£ä¹ˆå®é™…ä¸Šå¤©æ•°æ˜¯ä»ç¬¬0å¤©å¼€å§‹çš„ï¼Œå½“$i=-1$çš„æ—¶å€™ï¼Œæ„å‘³ç€è¿˜æ²¡æœ‰å¼€å§‹ã€‚æ‰€ä»¥ï¼š$dp[-1][k][0]=0$ã€‚$dp[-1][k-1][1]$è¡¨ç¤ºæ˜¯åœ¨ç¬¬-1å¤©çš„æ—¶å€™ï¼ŒæŒæœ‰è‚¡ç¥¨ã€‚å®é™…ä¸Šï¼Œå½“è¿˜æ²¡æœ‰å¼€å§‹çš„æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ã€‚æ‰€ä»¥ï¼š$dp[-1][k-1][1]=-infinity$</p><p>ã€‚å…¶ä»–çš„ä¾æ¬¡ç±»æ¨ã€‚</p><hr><h4 id="4-ç¨‹åºä»£ç ï¼š"><a href="#4-ç¨‹åºä»£ç ï¼š" class="headerlink" title="4.ç¨‹åºä»£ç ï¼š"></a>4.ç¨‹åºä»£ç ï¼š</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NINF -INF-1</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//è¿˜æ˜¯å¥—ç”¨å…¬å¼ï¼Œè¿™æ˜¯k=2çš„æƒ…å†µ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> n=prices.<span class="built_in">size</span>();</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> k_max=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span> dp[n+<span class="number">1</span>][k_max+<span class="number">1</span>][<span class="number">2</span>];</span><br><span class="line"><span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k=k_max;k&gt;=<span class="number">1</span>;k--)&#123;</span><br><span class="line"><span class="keyword">if</span>(i<span class="number">-1</span>==<span class="number">-1</span>)&#123;</span><br><span class="line">dp[i][k][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">dp[i][k][<span class="number">1</span>]=-prices[i];</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">dp[i][k][<span class="number">0</span>]=<span class="built_in">max</span>(dp[i<span class="number">-1</span>][k][<span class="number">0</span>],dp[i<span class="number">-1</span>][k][<span class="number">1</span>]+prices[i]);</span><br><span class="line">dp[i][k][<span class="number">1</span>]=<span class="built_in">max</span>(dp[i<span class="number">-1</span>][k][<span class="number">1</span>],dp[i<span class="number">-1</span>][k<span class="number">-1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dp[n<span class="number">-1</span>][k_max][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; prices;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">prices.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Solution so1;</span><br><span class="line"><span class="keyword">int</span> ans = so1.maxProfit(prices);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„å…³äºè‚¡ç¥¨çš„é—®é¢˜è¿˜æœ‰ï¼š<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/" target="_blank" rel="noopener">121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a>ã€<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/" target="_blank" rel="noopener">122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a>ã€<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iv/" target="_blank" rel="noopener">188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV</a>ã€<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/" target="_blank" rel="noopener">309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ</a>ã€<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/" target="_blank" rel="noopener">714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹</a>ã€‚å¥—ç”¨æ¡†æ¶å‡å¯ä»¥è§£å†³ã€‚</p><p>OKï¼Œç»ˆäºå†™å®Œäº†ï½ğŸ¤©â˜•ï¸</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++|STLåº“æ€»ç»“</title>
      <link href="2020/02/17/C-STL%E5%BA%93%E6%80%BB%E7%BB%93/"/>
      <url>2020/02/17/C-STL%E5%BA%93%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´åœ¨ç”¨C++åˆ·é¢˜ï¼ŒSTLåº“ç”¨çš„å¾ˆé¢‘ç¹ï¼Œä½†æ˜¯æ€»æ˜¯è®°ä¸å…¨ï¼Œæ‰€ä»¥å†™ä¸€ç¯‡blogæ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><a id="more"></a><h4 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h4><p>Vectorå®é™…ä¸Šå°±æ˜¯é•¿åº¦å¯å˜çš„æ•°ç»„ã€‚</p><blockquote><p><code>vector&lt;int&gt; vec</code>:å®šä¹‰äº†vectorç±»å‹çš„å˜é‡vecï¼Œå…¶ä¸­çš„å…ƒç´ ä¸ºintç±»å‹ã€‚å®é™…ä¸Šç›¸å½“äºå®šä¹‰äº†é•¿åº¦å¯å˜çš„ä¸€ä½æ•°ç»„ã€‚</p><p><code>vector&lt;vector&lt;int&gt; &gt; vec</code>:å®šä¹‰äº†vectorç±»å‹çš„å˜é‡vecï¼Œå…¶ä¸­çš„å…ƒç´ ä¸ºvectorç±»å‹ã€‚å®é™…ä¸Šç›¸å½“äºå®šä¹‰äº†é•¿åº¦å¯å˜çš„äºŒç»´æ•°ç»„ã€‚å…¶ä¸­å…ƒç´ çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ã€‚</p></blockquote><h5 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h5><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªvectorå¯¹è±¡:<code>vector&lt;int&gt; vec</code>ã€‚ å¸¸ç”¨å‡½æ•°å¦‚ä¸‹ï¼š</p><p><strong>vec.push_back(a)</strong> :å°†å…ƒç´ åŠ å…¥vecä¸­ã€‚</p><p><strong>vec.pop_back()</strong></p><p><strong>vec.insert</strong>:</p><hr><ol><li><code>set</code>åŸºäºçº¢é»‘æ ‘å®ç°ï¼Œçº¢é»‘æ ‘å…·æœ‰<strong>è‡ªåŠ¨æ’åºçš„åŠŸèƒ½</strong>ï¼Œå› æ­¤mapå†…éƒ¨æ‰€æœ‰çš„æ•°æ®ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œéƒ½æ˜¯æœ‰åºçš„ã€‚</li><li><code>unordered_set</code>åŸºäºå“ˆå¸Œè¡¨ï¼Œæ•°æ®æ’å…¥å’ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å¾ˆä½ï¼Œå‡ ä¹æ˜¯å¸¸æ•°æ—¶é—´ï¼Œè€Œä»£ä»·æ˜¯æ¶ˆè€—æ¯”è¾ƒå¤šçš„å†…å­˜ï¼Œ<strong>æ— è‡ªåŠ¨æ’åºåŠŸèƒ½</strong>ã€‚åº•å±‚å®ç°ä¸Šï¼Œä½¿ç”¨ä¸€ä¸ªä¸‹æ ‡èŒƒå›´æ¯”è¾ƒå¤§çš„æ•°ç»„æ¥å­˜å‚¨å…ƒç´ ï¼Œå½¢æˆå¾ˆå¤šçš„æ¡¶ï¼Œåˆ©ç”¨<code>hash</code>å‡½æ•°å¯¹<code>key</code>è¿›è¡Œæ˜ å°„åˆ°ä¸åŒåŒºåŸŸè¿›è¡Œä¿å­˜ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> STLåº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡æ–°æ­å»ºäº†blog</title>
      <link href="2020/02/17/hello-world/"/>
      <url>2020/02/17/hello-world/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é‡æ–°æ­å»ºäº†è‡ªå·±çš„blogï¼Œæ¸…é™¤äº†å¾ˆå¤šä¹‹å‰çš„æ–‡ç« ï¼Œæ²¡åŠæ³•ï¼Œè‡ªå·±çš„å¼ºè¿«ç—‡åˆçŠ¯äº†ğŸ˜†ï¼Œå®¹ä¸å¾—ä¸ç¾è§‚çš„ä¸œè¥¿ï¼Œäººç”Ÿåœ¨äºæŠ˜è…¾ï¼Œå“ˆå“ˆå“ˆğŸ¤£ï¼Œä¹Ÿç®—æ˜¯å¯¹ä¹‹å‰çš„blogçš„æ•´ç†å§ğŸ˜‹ã€‚2020ï¼Œå¸Œæœ›ä¸€åˆ‡é¡ºåˆ©ğŸ¤©ï¼Œè¿æ°”çˆ†æ£šğŸ‰ï½</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
